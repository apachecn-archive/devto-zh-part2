# ç‰©è”ç½‘:ä½¿ç”¨ Node.jsã€Elastic Stack å’Œ MQTT è¿›è¡Œç©ºæ°”æ±¡æŸ“è·Ÿè¸ª

> åŸæ–‡:[https://dev . to/sema text/IOT-air-pollution-tracking-with-nodejs-elastic-stack-and-mqtt-3 LMI](https://dev.to/sematext/iot-air-pollution-tracking-with-nodejs-elastic-stack-and-mqtt-3lmi)

[![](../Images/09d97862284dd79c20b3220bce15c32e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--TU665XIL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/iot-for-environment-protection%402x-1-1024x573.png)

ä½ èƒ½ç”¨å‡ ä¸ªç‰©è”ç½‘è®¾å¤‡ Node.jsã€Elasticsearch å’Œ MQTT åšä»€ä¹ˆï¼Ÿä½ å¯ä»¥åƒæˆ‘ä¸€æ ·ï¼Œå»ºç«‹è‡ªå·±çš„ç‰©è”ç½‘ç³»ç»Ÿæ¥æµ‹é‡ç©ºæ°”æ±¡æŸ“ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«å…³äºç¡¬ä»¶è®¾ç½®ã€è½¯ä»¶é…ç½®ã€æ•°æ®åˆ†æã€ç‰©è”ç½‘ä»ªè¡¨æ¿ä»¥åŠ MQTT åŸºäºä»£ç†ä¸ç‰©è”ç½‘ç”Ÿæ€ç³»ç»Ÿä¸­å…¶ä»–å·¥å…·(å¦‚ Node-Red å’Œ Octoblu)çš„é›†æˆçš„æ‰€æœ‰ç»†èŠ‚ã€‚å½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šåˆ†äº«ä¸€äº›åœ¨å¾·å›½å‡ ä¸ªåœ°ç‚¹è¿›è¡Œçš„ç©ºæ°”æ±¡æŸ“ç‰©è”ç½‘ä¼ æ„Ÿå™¨æµ‹é‡çš„æœ‰è¶£å‘ç°ã€‚çœ‹ä¸€çœ‹â€”â€”å½“ä½ ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ—¶ï¼Œåšè¿™ä»¶äº‹æ¯”ä½ æƒ³è±¡çš„è¦å®¹æ˜“å¾—å¤šï¼

# **åŠ¨æœº**

æœ€è¿‘[å¤§ä¼—æ’æ”¾ä¸‘é—»](https://en.wikipedia.org/wiki/Volkswagen_emissions_scanda)(ç»´åŸºç™¾ç§‘)å†æ¬¡å‡çº§ã€‚åŸå› æ˜¯çº½çº¦æ—¶æŠ¥æŠ¥é“çš„[æœ‰äº‰è®®çš„åŠ¨ç‰©å®éªŒã€‚è¿™å¼•å‘äº†æ— æ•°å…³äº T4 ç¦æ­¢æŸ´æ²¹è½¦åœ¨æˆ‘å±…ä½çš„å¾·å›½åŸå¸‚ä¸­å¿ƒè¡Œé©¶çš„äº‰è®ºã€‚äººä»¬è°ˆè®ºå…¨çƒæ±½è½¦ç¦ä»¤ï¼Œä½†æˆ‘å¾ˆæƒŠè®¶æ²¡æœ‰äººçœŸæ­£è°ˆè®ºæ™ºèƒ½åŸå¸‚çš„æ¦‚å¿µã€‚é™¤äº†å›´ç»•æ°®æ°§åŒ–ç‰©æ’æ”¾ä½œå¼Šçš„è®¨è®ºä¹‹å¤–ï¼Œæ¬§ç›Ÿè¿˜æƒ³åœ¨å¾·å›½å¼ºåˆ¶æ‰§è¡Œé¢—ç²’çš„ä¸‹é™(ä»¥ PM10 å’Œ PM2.5 æ¥è¡¡é‡)ã€‚é«˜ PM10 æµ“åº¦å¯¹å¥åº·çš„å½±å“åœ¨â€œ](https://www.nytimes.com/2018/01/30/opinion/animal-experiment-volkswagen.html)[ç¯å¢ƒç©ºæ°”ä¸­é¢—ç²’çš„å¥åº·å½±å“](https://www.sciencedirect.com/science/article/pii/S143846390470303X)ä¸­æœ‰æ‰€æè¿°ã€‚

è¿™å°±æ˜¯æ”¿æ²»å’ŒåŒ»å­¦ï¼Œæˆ‘ä»¬æ˜¯è®¡ç®—æœºç§‘å­¦å®¶ã€æ•°æ®å·¥ç¨‹å¸ˆæˆ–å¼€å‘ä¸“å®¶ï¼Œæ‰€ä»¥æˆ‘é—®è‡ªå·±

***æˆ‘ä»¬èƒ½ä¸ºç¯ä¿åšäº›ä»€ä¹ˆ*ï¼Ÿç”Ÿæ´»åœ¨ä¸€ä¸ªæ•°æ®é©±åŠ¨çš„å†³ç­–è¶Šæ¥è¶Šæ™®éçš„ä¸–ç•Œï¼Œæ”¶é›†æ•°æ®å’Œå¯è§†åŒ–äº‹å®æ˜¯åšå‡ºè´¡çŒ®çš„ä¸€ç§æ–¹å¼ã€‚**

å‘æ¨æ–‡åˆ°@sematext

æ­£å¦‚æœ€è¿‘çš„ä¸‘é—»æ‰€æ˜¾ç¤ºçš„ï¼Œå¤§å…¬å¸å¯èƒ½ä¼šå½±å“ç§‘å­¦ç ”ç©¶ï¼Œæ¸¸è¯´è€…æ­£åœ¨å½±å“æ”¿åºœï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸æ”¶é›†å¼€æºæ•°æ®ï¼Œå¹¶åŸºäºå¼€æ”¾æ•°æ®æˆ–ä½ è‡ªå·±çš„æ•°æ®åˆ›å»ºç‹¬ç«‹çš„åˆ†æå’Œç‹¬ç«‹çš„è§‚ç‚¹å‘¢ï¼æˆ‘ä»¬å¯ä»¥å¸®åŠ©æä¾›è®¾å¤‡è®¾ç½®ã€è½¯ä»¶é…ç½®æˆ–åœ¨å¹³å°ä¸­å…±äº«æ•°æ®æˆ–åˆ†ææ•°æ®çš„æ–¹æ³•ï¼Œå¸®åŠ©è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¬å…±åœºåˆã€èšä¼šã€ä¼šè®®ç­‰åœºåˆè°ˆè®ºå®ƒã€‚

å¯¹æˆ‘æ¥è¯´ï¼Œæˆ‘åªæ˜¯æƒ³åœ¨æˆ‘çš„ç¯å¢ƒä¸­çœ‹åˆ°æµ‹é‡ç»“æœï¼Œå› ä¸ºå…¬å…±æ”¿åºœæ•°æ®åªåˆ—å‡ºäº†ä¸»è¦åŸå¸‚ï¼Œä»–ä»¬æä¾›çš„æŠ¥å‘Šé€šå¸¸éƒ½æ˜¯ä½åˆ†è¾¨ç‡çš„åœ°å›¾ã€‚æ‰€ä»¥æˆ‘å†³å®šç”¨ç°æˆçš„ç»„ä»¶å¼€å§‹ä¸€ä¸ªå°å°çš„ç‰©è”ç½‘ DIY é¡¹ç›®ï¼Œç”¨ç‰¹å®šçš„ç‰©è´¨/ç°å°˜ä¼ æ„Ÿå™¨æ¥æµ‹é‡ç©ºæ°”æ±¡æŸ“ï¼Œè·Ÿè¸ª PM10ã€PM2.5 ä»¥åŠ PM2.5/PM10 æ¯”å€¼ã€‚æˆ‘å¸Œæœ›èƒ½å¤Ÿç”¨ç§»åŠ¨è®¾å¤‡å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå¹¶åœ¨æˆ‘å·¥ä½œå’Œç”Ÿæ´»çš„å„ä¸ªåœ°æ–¹è¿›è¡Œæµ‹é‡ã€‚æˆ‘çš„åŠå…¬å®¤é è¿‘ä¸»è¡—é“ï¼Œé è¿‘ä¸€ä¸ªå·¥ä¸šåŒºï¼Œä½†æˆ‘æœ€è¿‘æ¬è¿›äº†ä¸€ä¸ªå†œæ‘å°é•‡çš„æ–°æˆ¿å­ï¼Œæ„Ÿè§‰åƒä¸€ä¸ªâ€œæ°”å€™æ¸©æ³‰â€ï¼Œå®é™…ä¸Šæœ‰ä¸€ä¸ªç–—å…»èƒœåœ°ã€‚ä¸ºäº†è®©å…¶ä»–äººæ›´å®¹æ˜“ç»„è£…åƒè¿™é‡Œæè¿°çš„ç‰©è”ç½‘ç³»ç»Ÿï¼Œæˆ‘åˆ›å»ºäº†[â€œç©ºæ°”æ±¡æŸ“è·Ÿè¸ªå™¨â€](https://github.com/megastef/AirPollutionTracker)ï¼Œè¿™æ ·ä»»ä½•äººéƒ½å¯ä»¥åœ¨ä»–ä»¬çš„ä½ç½®æ”¶é›†æ•°æ®ï¼Œè¯•éªŒè®¾ç½®ï¼Œå¹¶åˆ†äº«ä»–ä»¬çš„æ•°æ®ã€‚

# **ç¡¬ä»¶**

å¥½äº†ï¼Œè®©æˆ‘ä»¬ä»æŠ€æœ¯è§’åº¦å‡ºå‘ï¼Œé¦–å…ˆçœ‹çœ‹æˆ‘ç»„è£…çš„ç‰©è”ç½‘ä¼ æ„Ÿå™¨è®¾å¤‡çš„ç¡¬ä»¶è®¾ç½®:

[![](../Images/c1915afae5eb2a09e911999956f00c04.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_9E6GFxX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image10.png)

è¿™å°±æ˜¯æˆ‘ä»¬çš„è®¾ç½®ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ¬¾ç‰©è”ç½‘ä¼ æ„Ÿå™¨è®¾å¤‡çš„å„ä¸ªéƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä½œç”¨:

*   ä½¿ç”¨ Nova SDS011 ç°å°˜ä¼ æ„Ÿå™¨æµ‹é‡é¢—ç²’ç‰©
*   ç”¨ GPS ä¼ æ„Ÿå™¨è®°å½•æµ‹é‡ä½ç½®
*   Wi-Fi è¿æ¥åˆ°æˆ‘çš„æ‰‹æœºï¼Œé€šè¿‡ MQTT ä¼ è¾“æµ‹é‡ç»“æœ
*   ç”µæºç»„ä¸º Banana-Pi è®¾å¤‡æä¾›ç”µæº
*   [Banana-Pi](https://en.wikipedia.org/wiki/Banana_Pi) (æ¯” [Raspberry Pi](https://www.raspberrypi.org/) åŠŸèƒ½æ›´å¼ºå¤§)å¸¦ Debian Linux å’Œ [Node.js](https://nodejs.org) ç”¨äºä¼ æ„Ÿå™¨æ•°æ®çš„æ•°æ®æ”¶é›†å’Œå‘é€

è¯·æ³¨æ„ï¼ŒUSB ç”µæºå¯èƒ½ä¸è¶³ä»¥æ”¯æŒ GPSã€Wi-Fiã€PM ä¼ æ„Ÿå™¨å’Œå†…éƒ¨ä»¥å¤ªç½‘æ¥å£ã€‚

# **è½¯ä»¶**

è½¯ä»¶æ¶æ„åŸºäº [MQTT](https://en.wikipedia.org/wiki/MQTT) æ¶ˆæ¯ï¼Œæ—¨åœ¨æ‰©å±•åˆ°æ•°åƒå°è®¾å¤‡ï¼Œå¹¶æ”¯æŒä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®æ—¶å…±äº«æ•°æ®ä»¥è¿›è¡Œä»»ä½•ç±»å‹çš„å¤„ç†ã€‚æˆ‘ä»¬ä¸º Node.js ä¸­çš„ [@sematext/logagent](https://github.com/sematext/logagent-js) åˆ›å»ºäº†[å¼€æºæ’ä»¶](https://sematext.com/docs/logagent/plugins/)ï¼Œç”¨äºæ”¶é›†å’Œå…³è”æ¥è‡ª *Nova SDS011* ä¼ æ„Ÿå™¨å’Œ GPS è®¾å¤‡çš„æ•°æ®ã€‚æµ‹é‡ç»“æœä»¥ JSON æ ¼å¼å‘é€ç»™ MQTT ä»£ç†ï¼Œå®ƒå¯ä»¥å°†æ•°æ®å­˜å‚¨åœ¨ Elasticsearch ä¸­ï¼Œæˆ–è€…åƒæˆ‘ä»¬ä¸€æ ·ï¼Œå­˜å‚¨åœ¨ Sematext Cloud ä¸­ã€‚åŸºäº MQTT çš„æ¶æ„å…è®¸å…¶ä»–å®¢æˆ·ç«¯ç›‘å¬äº‹ä»¶æµï¼Œå¹¶åœ¨è¾¾åˆ° PM10 é™åˆ¶æ—¶åˆ›å»ºè­¦æŠ¥æˆ–å…¬å…± tweets æˆ–æ§åˆ¶äº¤é€šç¯ã€‚æ­¤å¤–ï¼ŒMQTT æ¶ˆæ¯è¢«è®°å½•ä¸‹æ¥ç”¨äºå†å²åˆ†æå’Œå¯è§†åŒ–ã€‚

<figure>[![](../Images/8d5cc1230c2d74a8888791d0f0a64048.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rBlDlV7A--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image11.png) 

<figcaption>*å»ºç­‘*</figcaption>

</figure>

## **å¸å…¥æ–°é²œç©ºæ°”å¹¶ä» PM ä¼ æ„Ÿå™¨æ”¶é›†æ•°æ®**

è¯¥é¡¹ç›®ä»è°·æ­Œæœç´¢é¢—ç²’ç‰©ä¼ æ„Ÿå™¨å’Œè®¾å¤‡çš„å¯ç”¨æ€§ä»¥åŠ Node.js é©±åŠ¨ç¨‹åºå¼€å§‹ï¼Œå› ä¸º Node.js æ˜¯æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ã€‚ç»è¿‡ä¸€ç•ªç ”ç©¶ï¼Œæˆ‘è®¢è´­äº†å¸¦ USB è½¬ä¸²è¡Œè½¬æ¢å™¨çš„ *Nova SDS011* ã€‚ä»ä¸²è¡Œç«¯å£è¯»å–å€¼çœ‹èµ·æ¥å¾ˆå®¹æ˜“å®ç°ï¼ŒUSB æ¥å£åœ¨æˆ‘çš„ MacBook å’Œ Banana-Pi è®¾å¤‡ä¸Šå·¥ä½œæ­£å¸¸ã€‚ä¸‹ä¸€æ­¥æ˜¯ä¸º [@sematext/logagent](https://sematext.com/logagent/) åˆ›å»ºä¸€ä¸ªè¾“å…¥æ’ä»¶ï¼Œå°†ä¼ æ„Ÿå™¨æ•°æ®æ³¨å…¥ logagent å¤„ç†ç®¡é“ã€‚Logagent å¯ä»¥å°†æ•°æ®å‘é€åˆ° MQTTã€Elasticsearchã€Apache Kafka æˆ–ç®€å•çš„æ–‡ä»¶è¾“å‡ºã€‚

æˆ‘æƒ³æµ‹é‡å¤šä¸ªä½ç½®çš„ç©ºæ°”è´¨é‡ï¼Œæ‰€ä»¥æˆ‘éœ€è¦æ”¶é›†æµ‹é‡ä½ç½®ã€‚è¿™å¯ä»¥è®©æˆ‘åœ¨åœ°å›¾ä¸Šçœ‹åˆ°ç©ºæ°”æ±¡æŸ“ã€‚æœ€åˆçš„æ–¹æ³•æ˜¯åœ¨æ’ä»¶é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªé™æ€çš„ä½ç½®ä¿¡æ¯ï¼Œä½†åæ¥æˆ‘æ”¹å˜äº†åšæ³•ï¼Œä»å…¶ä»–æ¥æºè·å–ä½ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ GPS æˆ–é€šè¿‡è·Ÿè¸ªæˆ‘çš„ iPhoneã€‚Nova SDS011 ä¼ æ„Ÿå™¨çš„ [Logagent æ’ä»¶æ˜¯å¼€æºçš„ï¼Œå¹¶åœ¨ NPM æ³¨å†Œä¸­å¿ƒå‘å¸ƒã€‚Nova SDS011 æ’ä»¶çš„ Logagent é…ç½®éœ€è¦æ¨¡å—åç§°å’Œä¸²è¡Œç«¯å£åç§°ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥åˆ†é’Ÿä¸ºå•ä½çš„å·¥ä½œå‘¨æœŸè®¾ç½®æ¥æŒ‡å®šæµ‹é‡æ”¶é›†é¢‘ç‡:](https://www.npmjs.com/package/logagent-novasds) 

```
input: 
  novaSDS011: 
    module: input-nova-sda011 
    comPort: /dev/ttyUSB0 
    # persistent setting for measurement interval in minutes 
    workingPeriod: 1 
```

## **è·å–ç²¾ç¡®çš„ GPS ä½ç½®**

åœ¨è®¾ç½®å¥½ä¸²å£é©±åŠ¨å’Œ Logagent ä¹‹åï¼Œç¬¬ä¸€æ¬¡å®éªŒåœ¨æˆ‘çš„ MacBook ä¸Šå¼€å§‹äº†ã€‚ä¸ºäº†åœ¨æ¢åœ°æ–¹æ—¶è·å¾—å‡†ç¡®çš„ GPS ä½ç½®ï¼Œæˆ‘æƒ³è‡ªåŠ¨è·Ÿè¸ªæˆ‘çš„ä½ç½®ã€‚èµ·åˆï¼Œæˆ‘ä½¿ç”¨ Logagent æ’ä»¶ [logagent-apple-location](https://www.npmjs.com/package/logagent-apple-location) æ¥è·Ÿè¸ªæˆ‘çš„ iPhone çš„ä½ç½®ã€‚ä¸ºæ­¤ï¼Œæˆ‘å¿…é¡»æ‰©å±• PM ä¼ æ„Ÿå™¨æ’ä»¶æ¥ç›‘å¬â€œ*ä½ç½®*äº‹ä»¶ï¼Œä»¥ä¾¿ç”¨ GPS åæ ‡å’Œæ£€ç´¢åˆ°çš„åœ°å€æ¥ä¸°å¯Œä¼ æ„Ÿå™¨æ•°æ®ã€‚è¿™æ˜¯å®éªŒçš„ä¸€ä¸ªè‰¯å¥½å¼€ç«¯ï¼Œç›´åˆ°æˆ‘çš„æ–° gps è®¾å¤‡æœ€ç»ˆåˆ°æ¥ï¼Œæˆ‘æ”¹ç”¨ [logagent-gps](https://www.npmjs.com/package/logagent-gps) æ’ä»¶æ¥è·å¾—ç‹¬ç«‹äºäº’è”ç½‘è¿æ¥çš„ç²¾ç¡® GPS ä½ç½®ã€‚å½“äº’è”ç½‘è¿æ¥å­˜åœ¨æ—¶ï¼Œè¯¥æ’ä»¶æŸ¥è¯¢ Google Maps API æ¥æŸ¥æ‰¾å½“å‰ä½ç½®çš„åœ°å€ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜æ¥é¿å…å¿«é€Ÿè¾¾åˆ° Google API é™åˆ¶ã€‚ç¼“å­˜çš„ç¼ºç‚¹æ˜¯å‡†ç¡®æ€§çš„æŸå¤±ã€‚æœ‰äº†ç¼“å­˜ï¼Œå‡ ç™¾ç±³å†…çš„è¡—é“å·ç å’Œåœ°å€ä¸ä¼šæ”¹å˜ã€‚Logagent GPS æ’ä»¶çš„é…ç½®éå¸¸ç®€å•ã€‚å®ƒåªéœ€è¦ä¸²è¡Œæ¥å£çš„ COM ç«¯å£å’Œ npm æ¨¡å—å:

```
input: 
  gps: 
    module: logagent-gps
    comPort: /dev/ttyACM0 
```

## **è®¡ç®—ä¼ æ„Ÿå™¨æµ‹é‡å€¼**

è¾ƒå°çš„é¢—ç²’è¢«è®¤ä¸ºæ›´å±é™©ï¼Œå› æ­¤è§‚å¯Ÿ PM10 å’Œ PM2.5 å€¼çš„æ¯”ç‡å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚Nova SDS011 åªæä¾› PM10 å’Œ PM2.5 æµ‹é‡ï¼Œéœ€è¦è®¡ç®— PM2.5/PM10 çš„æ¯”å€¼ã€‚è¯·æ³¨æ„ï¼ŒPM2.5 ç²’å­çš„è´¨é‡æ˜¯ PM10 ç²’å­çš„å­é›†ã€‚å› æ­¤ï¼ŒPM2.5 å€¼æ€»æ˜¯å°äº PM10 å€¼ã€‚ [Logagent æ”¯æŒ JavaScript å‡½æ•°](https://sematext.com/docs/logagent/filters/#output-filter)ç”¨äºé…ç½®æ–‡ä»¶ä¸­çš„è¾“å…¥å’Œè¾“å‡ºè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„ã€‚

```
# calculate PM2.5/PM10 ratio in percent 
outputFilter:
  - module: !!js/function >
      function (context, config, eventEmitter, data, callback)  {
        if (data.PM10 && data.PM10 > 0) {
            data.PM25ratio = (data['PM2.5']/data.PM10) * 100
        }
        callback(null, data)
      } 
```

â€œæ•°æ®â€å˜é‡ä¿å­˜å½“å‰çš„æµ‹é‡å€¼ï¼Œè®¡ç®—åéœ€è¦è°ƒç”¨å›è°ƒå‡½æ•°æ¥è¿”å›ä¿®æ”¹åçš„æ•°æ®å¯¹è±¡ã€‚æ–°çš„æ•°æ®å¯¹è±¡ç°åœ¨åŒ…å« PM10ã€PM2.5 å’Œè®¡ç®—å‡ºçš„ PM2.5 æ¯”å€¼ï¼

## **ç”¨ MQTT è¿é€å’Œæ¶ˆè´¹ä¼ æ„Ÿå™¨æ•°æ®**

æ ‡å‡†åŒ–çš„ MQTT åè®®å¼€é”€éå¸¸å°ï¼Œå¤§å¤šæ•°ç‰©è”ç½‘å·¥å…·éƒ½æ”¯æŒ MQTTã€‚MQTT ä½¿ç”¨å‘å¸ƒ/è®¢é˜…æœºåˆ¶å°†æ¶ˆæ¯åˆ†å‘åˆ°å¤šä¸ªå®¢æˆ·ç«¯ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¼ æ„Ÿå™¨è®¾å¤‡ä½¿ç”¨åä¸ºâ€œsensor-dataâ€çš„ä¸»é¢˜å‘ MQTT ä»£ç†å‘é€ JSON æ¶ˆæ¯ã€‚æˆ‘ä»¬ä½¿ç”¨ [Logagent MQTT è¾“å‡ºæ’ä»¶](https://sematext.com/docs/logagent/output-plugin-mqtt/)å’Œå…¬å…±æœåŠ¡ mqtt://test.mosquitto.orgã€‚è¯·æ³¨æ„ï¼Œæ‚¨åº”è¯¥åªåœ¨çŸ­æ—¶é—´çš„æµ‹è¯•ä¸­ä½¿ç”¨ test.mosquitto.org æœåŠ¡å™¨ã€‚å¯¹äºç”Ÿäº§è®¾ç½®ï¼Œæ‚¨åº”è¯¥è¿è¡Œè‡ªå·±çš„ MQTT ä»£ç†ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ[èšŠå­ MQTT ä»£ç†ï¼Œæˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨](https://hub.docker.com/_/eclipse-mosquitto/) [Logagent MQTT-broker æ’ä»¶](https://sematext.com/docs/logagent/input-plugin-mqtt-broker/)å¹¶è¿è¡Œ Logagent çš„å¦ä¸€ä¸ªå®ä¾‹ä½œä¸º MQTT ä»£ç†ã€‚

```
output:  
  mqtt:    
    module: output-mqtt    
    url: mqtt://test.mosquitto.org
    topic: sensor-data
    debug: false
    # optional filter settings matching data field with regular expressions
    filter:
      field: logSource
      match: Nova 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ä»»ä½• MQTT å®¢æˆ·æœºï¼Œè¿æ¥åˆ°åŒä¸€ä¸ª MQTT ä»£ç†ï¼Œå¹¶è®¢é˜…åˆ°è¾¾â€œä¼ æ„Ÿå™¨æ•°æ®â€ä¸»é¢˜çš„æ¶ˆæ¯ã€‚

å¦‚æœä½ æƒ³ä»¥æŸç§æ–¹å¼å¤„ç†æµ‹é‡ç»“æœæˆ–å¯¹å…¶é‡‡å–è¡ŒåŠ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ [Node-Red](https://nodered.org/) æˆ– [Octoblu](https://octoblu.github.io/) è¿™æ ·çš„å·¥å…·ï¼Œå¹¶åˆ›å»ºç‰©è”ç½‘å·¥ä½œæµã€‚ä¾‹å¦‚ï¼ŒNode-Red ä¸­çš„ MQTT æ’ä»¶å°† MQTT broker åœ°å€å’Œä¸»é¢˜ä½œä¸ºå‚æ•°ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¢é˜…â€œä¼ æ„Ÿå™¨æ•°æ®â€ä¸»é¢˜ï¼Œå¹¶åœ¨å¯åŠ¨ Node-Red æŒ‡å‘ MQTT broker æ—¶è·å–å‘é€åˆ° MQTT broker çš„æµ‹é‡å€¼ï¼Œæ‚¨å°†ä¼šåœ¨ Node-Red å·¥ä½œæµä¸­è·å–ç©ºæ°”æ±¡æŸ“æ•°æ®ã€‚ç„¶åï¼Œæ‚¨æ ¹æ®æ”¶åˆ°çš„æµ‹é‡ç»“æœæ‰§è¡Œå„ç§æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨æ¡ä»¶åŒ¹é…æ—¶å‘å¸ƒæ¶ˆæ¯ï¼Œæˆ–è€…æ ¹æ®ä¼ æ„Ÿå™¨å€¼æ”¹å˜ LED ç¯çš„é¢œè‰²ï¼Œæˆ–è€…æ‚¨å¯ä»¥æ§åˆ¶ç©ºè°ƒâ€¦â€¦è¿™é‡Œçš„å¯èƒ½æ€§æ˜¯æ— é™çš„ï¼ä»æ›´å¤§çš„è§’åº¦è€ƒè™‘ï¼Œæ™ºèƒ½åŸå¸‚å¯èƒ½ä¼šé€‰æ‹©æ§åˆ¶äº¤é€šï¼Œå¹¶å°†ç©ºæ°”æ±¡æŸ“ä½œä¸ºäº¤é€šè·¯çº¿å†³ç­–çš„æ ‡å‡†ä¹‹ä¸€ã€‚èŠ‚ç‚¹çº¢è‰²æ¶æ„å¯ä»¥æ’å…¥è®¾å¤‡ã€é€»è¾‘å…ƒä»¶æˆ–[ç¥ç»ç½‘ç»œ](https://flows.nodered.org/node/node-red-contrib-neuralnet)ç»„ä»¶ã€‚Node-Red æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¹³å°ï¼Œå¯ä»¥æ ¹æ®ç©ºæ°”æ±¡æŸ“æµ‹é‡ç»“æœæ„å»ºä»»ä½•é€»è¾‘çš„åŸå‹ã€‚

<figure>[![](../Images/de5a3a25f1e72611a8ba187275c1a026.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--C_RSUHTs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image8.png) 

<figcaption>èŠ‚ç‚¹-çº¢è‰²ç‰©è”ç½‘å·¥ä½œæµç¨‹</figcaption>

</figure>

## **åœ¨ Elasticsearch æˆ– Sematext Cloud ä¸­å­˜å‚¨æ•°æ®**

æˆ‘ä»¬é€šè¿‡ [Logagent Elasticsearch æ’ä»¶](https://sematext.com/docs/logagent/output-elasticsearch/)å°†æœ‰æ•ˆçš„ç‰©è”ç½‘æ—¶é—´åºåˆ—ä¼ æ„Ÿå™¨æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ Sematext Cloud ä¸­ã€‚Sematext Cloud ä¸ºæ•°æ®ã€ä»ªè¡¨ç›˜å’Œè­¦æŠ¥æä¾› Elasticsearch API å…¼å®¹ç«¯ç‚¹ã€‚Elasticsearch æ’ä»¶éœ€è¦ Elasticsearch URL å’Œç´¢å¼•åã€‚å¯¹äº Sematext Cloudï¼Œæˆ‘ä»¬ä½¿ç”¨ Sematext UI æä¾›çš„å†™ä»¤ç‰Œä½œä¸ºç´¢å¼•å:

```
sematext-cloud:
    module: elasticsearch
    url: https://logsene-receiver.sematext.com
    index: 9eed3c42-1e14-44d2-b319-XXXXXXX 
```

## **é¦™è•‰-PI çš„å®Œæ•´è®¾å¤‡è®¾ç½®**

Banana-PI è®¾å¤‡çš„è®¾ç½®æ­¥éª¤å¦‚ä¸‹:

1.  åˆ›å»º Bananian (Debian) SD å¡
2.  é€šè¿‡ä¸º wlan0 æ¥å£è®¾ç½® wpa _â€“*essid å’Œ wpa*-password _ in*/etc/network/interfaces*ä¸ºæ‰‹æœºé…ç½® Wi-Fi å¡ã€‚åœ¨æ‰‹æœºä¸Šå¯ç”¨ç½‘ç»œå…±äº«(iPhone ä¸Šçš„â€œçƒ­ç‚¹â€)ã€‚
3.  å®‰è£… Node.js

```
 curl -sL https://deb.nodesource.com/setup\_8.x | bash - && apt-get install -y nodejs 
```

1.  å®‰è£…@sematext/logagent å’Œç›¸å…³æ’ä»¶

```
 npm i -g --unsafe-perm @sematext/logagent logagent-gps logagent-novasds      npm i -g --unsafe-perm @sematext/logagent-nodejs-monitor      logagent-setup -t YOUR-TOKEN -e [https://logsene-receiver.sematext.com](https://logsene-receiver.sematext.com)        service logagent stop 
```

1.  åˆ›å»º Logagent é…ç½®(è§ä¸‹æ–‡)ã€‚ä½¿ç”¨æµ‹è¯•é…ç½®

```
logagent --config logagent.conf 
```

å°†å·¥ä½œé…ç½®å¤åˆ¶åˆ°*/etc/sema text/log agent . conf*ï¼Œç”¨
å¯åŠ¨æœåŠ¡

```
# Example for Logagent configuration
# Plase adjust following settings: 
#   input.novaSDS011.comPort
#   input.gps.comPort
#   input.nodejsMonitor.SPM_TOKEN
#   output.mqtt.url
#   output.elasticsearch.url
#   output.elasticsearch.indices

options: 
  # suppress log event output to console
  suppress: true
  # Write Logagent stats in the Logagent log file /var/log/logagent.log
  # The stats show how many events have been processed and shipped
  # Log interval in seconds
  printStats: 60

input:
  novaSDS011:
    module: input-nova-sda011
    # Find TTY name: ls -l /dev/tty* | grep 'dialout'
    comPort: /dev/ttyUSB0
    # Working period in minutes. The setting is persistent 
    # for the connected Nova SDS011 sensor
    # 1 minute measurement interval
    workingPeriod: 1

  gps: 
    module: logagent-gps
    # Find TTY name: ls -l /dev/tty* | grep 'dialout'
    comPort: /dev/ttyACM0
    # Emit only location event, to share the location with nova sensor
    emitOnlyLocationEvent: true
    # disable debug output
    debug: false

  # Optional, monitor logagent and device performance
  # Create in Sematext Cloud a Node.js monitoring app
  # to obtain the SPM_TOKEN
  nodejsMonitor: 
    module: @sematext/logagent-nodejs-monitor
    SPM_TOKEN: YOUR_SEMATEXT_NODEJS_MONITORING_TOKEN

  # collect all system logs for troubleshooting
  files: 
    - /var/log/**/*.log

# calculate PM2.5/PM10 ratio in percent 
outputFilter:
  - module: !!js/function >
      function (context, config, eventEmitter, data, callback)  {
        if (data.PM10 && data.PM10 > 0) {
            data.PM25ratio = (data['PM2.5']/data.PM10) * 100
        }
        callback(null, data)
      }

output: 
  # print log events in yaml format
  # when options.suppress=false
  stdout: yaml
  # Forward sensor logs to MQTT broker
  mqtt:
    module: output-mqtt
    url: mqtt://test.mosquitto.org
    topic: sensor-data
    debug: false
    # optional filter settings matching data field with regular expressions
    # we use the filter to exclude the system log files
    filter: 
      field: logSource
      match: Nova

  # Store log events & sensor data in Sematext Cloud or Elasticsearch
  # Create a log application in Sematext Cloud to obtain a token
  elasticsearch:
    module: elasticsearch
    url: https://logsene-receiver.sematext.com
    # url: https://logsene-receiver.eu.sematext.com
    # url: http://127.0.0.1:9200 
    # We route system logs and sensor data to different indices
    # each index has a list of regular expressions matching the logSource field
    indices:
      # sensor data index
      YOUR_SEMATEXT_LOGS_TOKEN: 
        - Nova
      # system logs index
      ANOTHER__SEMATEXT_LOGS_TOKEN:
        - var.log.* 
```

## **CPU å’Œå†…å­˜å ç”¨**

æˆ‘åœ¨ Sematext åšçš„å¾ˆå¤šäº‹æƒ…éƒ½ä¸[æ€§èƒ½ç›‘æ§](https://sematext.com/spm/)æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘æ§åˆ¶ä¸ä½è‡ªå·±ï¼Œä¸å¾—ä¸æŸ¥çœ‹æˆ‘çš„è¿™ä¸ª DIY ç‰©è”ç½‘è®¾ç½®çš„é¥æµ‹æ•°æ®ã€‚åŸºäº Node.js çš„ Logagent çš„ä½èµ„æºä½¿ç”¨ç‡ä»¤äººå°è±¡æ·±åˆ»ï¼Œå®ƒåªæœ‰ä¸åˆ° 1%çš„ CPU å’Œä¸åˆ° 34 MB çš„å†…å­˜ã€‚å…¶ä»–æ—¥å¿—å·¥å…·ï¼Œå¦‚ Logstashï¼Œéœ€è¦ 20 å€ä»¥ä¸Šçš„å†…å­˜(600 MB ä»¥ä¸Š),å¹¶ä¸”ä¼šä½¿ç”¨ Banana-Pi æˆ– Raspberry-Pi ç­‰å¾®å‹è®¡ç®—æœºä¸Šçš„å¤§éƒ¨åˆ†èµ„æºï¼Œå¾ˆå¿«å°±ä¼šè€—å°½ç”µæ± ï¼

[![](../Images/7e5e0bca7af1c5c03314e8412c4ca801.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--s9An2h8x--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image1.png)

å¦‚æœä½ åƒæˆ‘ä¸€æ ·å¯¹æ€§èƒ½æ„Ÿå…´è¶£ï¼Œè€Œä¸”å¦‚æœä½ æƒ³åœ¨ä½ çš„è®¾ç½®å‡ºç°æ€§èƒ½æˆ–ç¨³å®šæ€§é—®é¢˜æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä½ å¯ä»¥æ·»åŠ å¦‚ä¸‹æ‰€ç¤ºçš„ [logagent-nodejs-monitor](https://github.com/megastef/logagent-nodejs-monitor) æ’ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡æ–‡ä»¶è¾“å…¥æ’ä»¶æ”¶é›†æ‰€æœ‰è®¾å¤‡æ—¥å¿—æ¥å®Œæˆé…ç½®ã€‚/var/log ä¸­çš„æ—¥å¿—æ–‡ä»¶åŒ…å«æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œå¦‚ Wi-Fi çŠ¶æ€æˆ– USB è®¾å¤‡ä¿¡æ¯ã€‚

```
input:
  nodejs-monitor:
    module: '@sematext/logagent-nodejs-monitor'
    SPM_TOKEN: 2f3e0e1f-94b5-47ad-8c72-6a09721515d8
  files: 
    - /var/log/**/*.log 
```

æˆ‘ä»¬é‡æ–°å¯åŠ¨ Logagent æ¥åº”ç”¨é…ç½®æ›´æ”¹:

```
_service restart logagent_ 
```

å‡ ç§’é’Ÿåï¼Œæˆ‘ä»¬å°†åœ¨ Sematext UI ä¸­çœ‹åˆ°æ—¥å¿—å’ŒæŒ‡æ ‡ã€‚åœ¨ä¸€ä¸ªè§†å›¾ä¸­æ‹¥æœ‰æ€§èƒ½æŒ‡æ ‡å’Œæ—¥å¿—å¯¹äºä»»ä½•ç±»å‹çš„æ•…éšœæ’é™¤éƒ½éå¸¸æœ‰ä»·å€¼ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼ŒUSB çº¿æ¥è§¦ä¸è‰¯ï¼Œä¸¢å¤±çš„ USB è¿æ¥è®°å½•åœ¨/var/kern.log ä¸­(è§æˆªå›¾)ã€‚

<figure>[![](../Images/7f76f7acfb669d422f272539c040f5c7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EWKwYYAA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image4.png) 

<figcaption>Node.js æ€§èƒ½æŒ‡æ ‡å’Œé¦™è•‰-Pi æ—¥å¿—åœ¨ Sematext Cloud</figcaption>

</figure>

## **å¯è§†åŒ–ç©ºæ°”æ±¡æŸ“**

åœ¨æˆ‘ä»¬åˆ›å»ºå¯è§†åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¼ æ„Ÿå™¨/logagent äº§ç”Ÿçš„æ¶ˆæ¯çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†æ•°å€¼ç»˜åˆ¶æˆæ—¥æœŸç›´æ–¹å›¾ï¼Œä¾‹å¦‚ *PM10ï¼Œã€PM2 _ 5ã€‘*å’Œ*pm25 æ¯”ç‡*ã€‚å¯ä»¥ç”¨åœ°ç†åæ ‡åˆ›å»ºåœ°å›¾ã€‚æœ‰äº†æ¯ä¸ªæµ‹é‡çš„åœ°å€ï¼Œå°±å¾ˆå®¹æ˜“æ‰¾åˆ°ç‰¹å®šåŸå¸‚çš„æµ‹é‡ï¼Œä¸»æœºåå¯èƒ½æœ‰åŠ©äºæˆ‘ä»¬è¯†åˆ«ä¼ æ„Ÿå™¨è®¾å¤‡ã€‚

```
{
  "@timestamp": "2018-02-05T20:59:38.230Z",
  "severity": "info",
  "host": "bananapi",
  "ip": "172.20.10.9",
  "PM2_5": 7.6,
  "PM10": 18,
  "geoip": {
    "location": [
      6.83125466218682,
      49.53914001560465
    ]
  }
  "address": "Weiskirchen, Germany",
  "city": "Weiskirchen",
  "country": "Germany",
  "logSource": "NovaSDS011",
  "PM25ratio": 42.22222222222222,
  "@timestamp_received": "2018-02-05T20:59:58.569Z",
  "logsene_original_type": "logs"
} 
```

*å­˜å‚¨åœ¨ Elasticsearch / Sematext Cloud ä¸­çš„ JSON æ¶ˆæ¯ç¤ºä¾‹*

ä¸ºäº†å¯è§†åŒ–æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä½¿ç”¨äº†é›†æˆåœ¨ Sematext Cloud ä¸­çš„ Kibanaã€‚ä¸€æ—¦åœ¨ Kibana ä¸­åˆ›å»ºäº†å¯è§†åŒ–ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºåœ°å›¾å’Œä¼ æ„Ÿå™¨å€¼çš„ä»ªè¡¨æ¿ã€‚ä¹çœ‹ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å‘ç°ï¼ŒåŒ—éƒ¨(æˆ‘å±…ä½çš„åœ°æ–¹)çš„ç©ºæ°”æ±¡æŸ“æ¯”é è¿‘ä¸»è¦è¡—é“çš„åŠå…¬å®¤ä½ 50%ã€‚

<figure>[![](../Images/88c2ea7e5cdc31f5a0759f7e9b268fba.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--YEW5oT_E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image13.png) 

<figcaption>åŸºå·´çº³ä»ªè¡¨ç›˜ä¸­çš„è¯­ä¹‰äº‘</figcaption>

</figure>

## **å„ç§åœºæ™¯ä¸‹é¢—ç²’ç‰©æµ“åº¦çš„è§‚æµ‹**

ä¸‹å›¾æ˜¯æˆ‘ä»åŠå…¬å®¤åˆ°å®¶çš„æ—…é€”ä¸­è®°å½•çš„ã€‚å›¾è¡¨ä¸­çš„å°–å³°å‘ç”Ÿåœ¨æˆ‘åœè½¦å¹¶ä»è½¦é‡Œæ‹¿å‡ºæµ‹é‡è®¾å¤‡çš„æ—¶å€™ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼ŒPM10 å€¼åœ¨çŸ­æ—¶é—´å†…è·ƒå‡è‡³ 80 å…‹/å¹³æ–¹ç±³(T2 )( T3 ),è¿™æ˜¯æ¬§ç›Ÿå¹³å‡æ¯å¹´ 40 å…‹/å¹³æ–¹ç±³ä¸Šé™çš„ä¸¤å€ï¼Œå°½ç®¡åªæ˜¯ä¸€åˆ†é’Ÿã€‚å¾ˆé«˜å…´çŸ¥é“ï¼Œä¸åŠå…¬å®¤ç›¸æ¯”ï¼Œæˆ‘å®¶ä¹¡çš„ç©ºæ°”ä¸­åªæœ‰ä¸€åŠçš„é¢—ç²’ç‰©â€”â€”è‡³å°‘åªè¦æˆ‘ä¸å¯åŠ¨æˆ‘çš„æŸ´æ²¹å‘åŠ¨æœºâ€¦â€¦æ€»ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç•™åœ¨å®¶åº­åŠå…¬å®¤çš„å¥½ç†ç”±ã€‚ [![ğŸ™‚](../Images/1bb31e891282bfa40812655c9c9ace9e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--DvXCaIjD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s.w.org/images/core/emoji/11/72x72/1f642.png)

[![](../Images/3c796151c56c5893138fa7b2b0e01116.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KpRM2pCT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image5.png)

<figure>[![](../Images/bf40fcd5b764fd9ad8b8121e78739c60.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zLNDkstv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image3.png)

<figcaption>ã€PM10ã€‘ç»´æ–¯åŸºå…´(æ©™è‰²)å’Œçº³å°”å·´èµ«(çº¢è‰²)</figcaption>

</figure>

## **ã€é›¾éœ¾ã€‘ã€è­¦æŠ¥ã€‘**

æ‹¥æœ‰ä»ªè¡¨æ¿å¾ˆé…·ï¼Œä½†æ˜¯ä½ ä¸èƒ½æ•´å¤©çœ‹ç€ä»ªè¡¨æ¿ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨è­¦æŠ¥ã€‚å¼€æºçš„ ELK å †æ ˆæœ‰å…¶å±€é™æ€§â€”â€”æ²¡æœ‰å†…ç½®è­¦æŠ¥â€”â€”ä½†æˆ‘ä»¬å¯ä»¥åœ¨ Sematext Cloud ä¸­ä½¿ç”¨è­¦æŠ¥ã€‚æ­¤å¤„ä¿å­˜çš„æŸ¥è¯¢ä»…è¿‡æ»¤å¤§äº 40(æ¬§ç›Ÿé™å€¼)æˆ– 50(å¾·å›½é™å€¼)çš„ PM10 å€¼ï¼Œç”¨äºè§¦å‘è­¦æŠ¥:

<figure>[![](../Images/b1a16ceed9db942e9bd5f2db2f5445ac.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--j0DmqXi9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image14.png) 

<figcaption>ä¸º PM10 å€¼ 50 ä»¥ä¸Šè®¾ç½®é¢„è­¦ã€‚</figcaption>

</figure>

<figure>[![](../Images/a1ba01995283c2f13523acb4a30bb732.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--r2z1xfFO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image12.png) 

<figcaption>è¯­ä¹‰ç•Œé¢</figcaption>

</figure>

ä¸­çš„é¢„è­¦é€šçŸ¥

æœ‰äº†è¿™æ ·çš„è­¦æŠ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¸¦æœ‰è­¦æŠ¥çš„äº‹ä»¶æµ(ä¸Šé¢çš„æˆªå›¾)æ·»åŠ åˆ°ä»ªè¡¨æ¿(ä¸‹é¢çš„æˆªå›¾)ï¼Œå¹¶é€šè¿‡ç§»åŠ¨ç”µè¯ä¸Šçš„ Slack é¢‘é“æ¥æ”¶è­¦æŠ¥ã€‚

è¯­ä¹‰ç•Œé¢ä¸­çš„

<figure>[![](../Images/40ec4e7f02ee675ddf4141c014e9bade.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--R-452d5J--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image15.png) 

<figcaption>ä»ªè¡¨ç›˜ï¼ŒåŒ…æ‹¬é¢„è­¦é€šçŸ¥</figcaption>

</figure>

<figure>[![](../Images/c7f6fcaa93321482ea020025934c10e9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--aUXh2bbU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://sematext.com/wp-content/uploads/2018/02/image2.png)

<figcaption>PM10 è¾¾åˆ° PM10 > 40 æˆ– PM10 > 50</figcaption>

</figure>

çš„é…ç½®é˜ˆå€¼æ—¶çš„æ¾å¼›é€šçŸ¥

# **ç»“è®º**

å„ç§ä¼ æ„Ÿå™¨è®¾å¤‡çš„æˆæœ¬éƒ½å¾ˆä½ï¼Œç»„è£…è¿™äº›è®¾å¤‡å’Œå®‰è£…è½¯ä»¶åªéœ€å‡ ä¸ªå°æ—¶ã€‚æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ¥ä¸ºå„ç§å°é—®é¢˜æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ç¼–å†™äº†å‡ ä¸ª Logagent æ’ä»¶ï¼Œä½†å³ä½¿ç¼–å†™ä¸€ä¸ªæ’ä»¶æ¨¡å—ä¹Ÿåªéœ€è¦å‡ ä¸ªå°æ—¶ã€‚ä½¿ç”¨ [Sematext Cloud](https://sematext.com/cloud) è€Œä¸æ˜¯æœ¬åœ° ELK æ ˆä¸ºæœåŠ¡å™¨è®¾ç½®èŠ‚çœäº†å¤§é‡æ—¶é—´(æˆ‘ä¸éœ€è¦ä»»ä½•ç‰©ç†æˆ–äº‘æœåŠ¡å™¨ï¼Œåªéœ€è¦è®¾å¤‡å’Œ Sematext SaaS)ã€‚å¯¹ Elasticsearch æŸ¥è¯¢çš„æé†’å’Œå¯¹ Slack çš„æé†’ä½¿è§£å†³æ–¹æ¡ˆæ›´åŠ å®Œæ•´ã€‚

è¿™ä¸ªé¡¹ç›®ä¸­æœ€å¤§çš„æ»¡è¶³æ„Ÿæ¥æºæ˜¯ç”¨â€œç”µå­é¼»â€è®©çœ‹ä¸è§çš„ä¸œè¥¿å˜å¾—å¯è§â€”â€”ä½ ä¼šè§‰å¾—è‡ªå·±åƒä¸€ä¸ªæ‰é¬¼æ•¢æ­»é˜Ÿå‘˜ï¼å½“ä¸€æ‰‡çª—æˆ·è¢«æ‰“å¼€æ—¶ï¼Œæˆ–è€…å½“ä½ å¼€å§‹ç”¨å¸å°˜å™¨æ‰“æ‰«å®¢å…æ—¶ï¼Œæˆ–è€…å½“ä½ åœ¨ç¼–ç¨‹æ—¶å¿˜è®°æŠŠæ„å¤§åˆ©é¢æ”¾åœ¨ç‚‰å­ä¸Šæ—¶ï¼Œä½ ä¼šå‘ç° PM10 å€¼åœ¨å¢åŠ â€¦â€¦[![ğŸ™‚](../Images/1bb31e891282bfa40812655c9c9ace9e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--DvXCaIjD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s.w.org/images/core/emoji/11/72x72/1f642.png)å½“é‚»å±…å‘åŠ¨æ±½è½¦å¼•æ“æ—¶ï¼Œå½“ä¸€ä¸ªæ¸¸å®¢æŠŠè½¦åœåœ¨ä½ å®¶é—¨å‰æ—¶ï¼Œå½“ä¸€ä¸ªå®¢äººå¼€å§‹åœ¨é˜³å°ä¸ŠæŠ½çƒŸæ—¶ï¼Œå¤–éƒ¨ä¼ æ„Ÿå™¨ä¼šâ€œé—»åˆ°â€

ä¸€ä¸ªæœ‰è¶£çš„äº‹å®æ˜¯ï¼Œé è¿‘ä¸»è¦è¡—é“çš„ PM10 å€¼æ›´é«˜ï¼Œå®é™…ä¸Šåœ¨æˆ‘åŠå…¬å®¤å‰é¢çš„é«˜å³°æ—¶é—´è¾¾åˆ°äº†æ¬§ç›Ÿé™åˆ¶(PM10>40)å’Œå¾·å›½é™åˆ¶(PM10>50 )!åœ¨æˆ‘çš„åŠå…¬å®¤çª—å£æµ‹å¾—çš„æœ€å¤§å€¼æ˜¯ PM10=69ã€‚åœ¨è·ç¦»ä¸»è¡—é“å‡ ç™¾ç±³çš„åœ°æ–¹ï¼ŒPM10 å€¼ä¼šå‡å°ã€‚æƒ³æƒ³æ„è¯†åˆ°è¿™ä¸€ç‚¹ä¼šå¦‚ä½•å½±å“ä½ çš„ç”Ÿæ´»å†³å®šâ€”â€”æ¬åˆ°ä¸€ä¸ªæ–°çš„å…¬å¯“æˆ–åŠå…¬å®¤çœŸçš„ä¼šå½±å“ä½ çš„å¥åº·ã€‚äº†è§£ç©ºæ°”æ±¡æŸ“æœ€ä¸¥é‡çš„æ—¶é—´ä¹Ÿæœ‰åŠ©äºé˜²æ­¢å¾®ç²’è¿›å…¥ä½ çš„å…¬å¯“ã€‚æˆ‘çš„æµ‹é‡æ˜¾ç¤ºï¼Œåœ¨ä¸‹åˆ 2 ç‚¹ä¹‹å‰å’Œæ™šä¸Š 9 ç‚¹ä¹‹åç»™åŠå…¬å®¤é€šé£æ˜¯ä¿æŒ pm æµ“åº¦è¾ƒä½çš„æœ€å¥½æ–¹æ³•ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘æœ€è¿‘æ¬åˆ°äº†ä¸€ä¸ªå°æ‘åº„ï¼Œæˆ‘åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°çš„å¥½ä¸œè¥¿æ˜¯æ–°é²œçš„ç©ºæ°”ï¼Œæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œçµæ„Ÿå’Œæ–°é²œæƒ³æ³•çš„æ—¶é—´ï¼

çœŸæ­£è®©æˆ‘åƒæƒŠçš„æ˜¯ï¼Œæˆ‘æ‰“ç”µè¯ç»™å¸‚æ”¿å½“å±€ï¼Œè¦æ±‚çº¦è§å¸‚é•¿ï¼Œä¸ä»–è®¨è®ºä¸€æ—¦è¾¾åˆ° PM10 é™åˆ¶ï¼Œäº¤é€šç¯å°±ä¼šå˜æˆçº¢è‰²çš„é—®é¢˜ï¼Œæœ€ç»ˆæˆ‘è¿›å…¥äº†æ”¿ç•Œã€‚æ±½è½¦å¯ä»¥è¢«æŒ¡åœ¨é•‡å¤–ï¼Œå› ä¸ºä¸€æ¡æ—è·¯å·²ç»å­˜åœ¨ï¼Œä½†ç›®å‰æ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œåº”è¯¥æ›´å¤šåœ°ä½¿ç”¨ã€‚æˆ‘å¸Œæœ›æˆ‘èƒ½å¾ˆå¿«å®‰æ’å¥½ä¸å¸‚é•¿çš„ä¼šé¢ï¼Œå½“æˆ‘ä¸ä»–äº¤è°ˆæ—¶ï¼Œæˆ‘ä¼šæœ‰æ•°æ®æ¥æ”¯æŒæˆ‘çš„å»ºè®®ã€‚æ”¿åºœé¦–å…ˆè¦æ±‚ç»™æˆ‘ä¸€å°ä¹¦é¢ä¿¡ä»¶ï¼Œç»™æˆ‘ä¸€ä»½æ­£å¼å£°æ˜â€”â€”è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ˜Ÿçƒä¸Šæ˜¯å¦è¿˜æœ‰ä¸€ä¸ªæ™ºèƒ½åŸå¸‚æœ€ç»ˆåšå‡ºåº”ç”¨äºç°å®ç”Ÿæ´»çš„æ•°æ®é©±åŠ¨å‹å†³ç­–ï¼Œè€Œä¸ä»…ä»…æ˜¯å•†ä¸š [![ğŸ™‚](../Images/1bb31e891282bfa40812655c9c9ace9e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--DvXCaIjD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s.w.org/images/core/emoji/11/72x72/1f642.png) æ•¬è¯·å…³æ³¨ï¼

å¸–å­ [IoT:ç”¨ Node.jsã€Elastic Stackã€MQTT](https://sematext.com/blog/iot-air-pollution-tracking-with-node-js-elastic-stack-and-mqtt/) è¿›è¡Œç©ºæ°”æ±¡æŸ“è¿½è¸ªæœ€æ—©å‡ºç°åœ¨ [Sematext](https://sematext.com) ä¸Šã€‚