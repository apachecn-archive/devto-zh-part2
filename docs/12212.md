# 我如何将 Cronjob 的运行时间减少 94%

> 原文:[https://dev . to/roelofjanelsinga/how-I-reduced-the-runtime-of-a-cron job-by-94-336n](https://dev.to/roelofjanelsinga/how-i-reduced-the-runtime-of-a-cronjob-by-94-336n)

[![Sand walker](../Images/c96a8501ea3e35d487035a9821c484df.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--13J8w2CD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6ll8jc6hig1efl21nxqw.jpeg)

# 我如何将一个 Cronjob 的运行时间减少了 94%

我们都需要 Cronjob 来完成某些自动化任务，但有时这些任务需要很长时间，以至于成为您和您的生态系统的巨大负担。我有一个 Cronjob，花了 36 个小时，改进后它在 2 个小时内完全运行。让我们来看看我是如何做到的！

### [](#clean-up-your-code)清理你的代码

第一步是清理我的代码。一些脚本必须通过三四种方法才能获得所需的数据并被正确格式化。这确实有一个合理的原因(当我第一次写脚本的时候):我想避免重复代码。我需要其他方法提供给我的类似格式的数据，所以我只需获取数据并修改它以满足我的需要，而不是编写一个新的定制(但非常相似)方法来立即获得我需要的数据。

这种方法奏效了，但从长远来看却非常缓慢。我想我更喜欢快速高效的代码，而不是到处都不重复的缓慢代码。所以我把所有代码都移到一个方法中，并不断减少代码，直到它变得干净为止。这已经将脚本加速了大约 2 个小时。

### [](#caching)缓存

另一个性能提升是通过缓存尽可能多的数据实现的。如果数据在 Cronjob 的整个生命周期中不太可能改变，并且会被重复请求，那么我会在其上添加一个缓存层。这并没有像我想象的那样加快脚本的速度，因为在整个生命周期中并没有很多资源是重复的。然而，这为我赢得了 30 分钟的提升时间。不是完全浪费时间，但也没有重要到真的有所作为。

### [](#asynchronous-jobs)异步作业

通过将脚本的一些长时间运行的部分转移到异步作业中，我获得了最大的性能提升。这包括与数据库交互的作业、图像处理和大型计算。这将脚本从大约 33 小时加速到了 2.5 小时。这些过程与主脚本的进展没有什么关系，所以我决定将它们从主过程中完全分离出来，成为它们自己的小而隐蔽的任务。

### [](#the-take-away)该拿走了

如果有一个脚本需要很长时间，或者至少有阻塞进程，那么使用异步作业。这些作业将在自己的时间完成，不会阻碍主脚本的进度。但是，您需要记住，在这些作业中处理的任何数据在您的主流程中都不可用。如果您绝对需要作业为您的主脚本生成的数据，不幸的是，没有一种简单的方法可以将它变成异步作业，因为您不能期望某件事情在您希望它完成的时候完成。但是如果只是一些图像操作或者大量的计算，而这些都不是主脚本所需要的，那么就让它异步吧！

如果你有任何问题或意见，请给我留言，我很乐意帮助你。如果你有任何关于如何得到比我在这里描述的更好的结果的建议，也让我知道！我很乐意向你学习！