# åœ¨ express ä¸­å³æ—¶ç”Ÿæˆæ–‡æ¡£

> åŸæ–‡:[https://dev . to/akshendra/generating-documentation-on-the-fly-in-express-2652](https://dev.to/akshendra/generating-documentation-on-the-fly-in-express-2652)

ä¸ä¹…å‰ï¼Œæˆ‘å†³å®šä¸ºæˆ‘å°†è¦æ„å»ºçš„ä¸€äº› HTTP APIs ç”Ÿæˆæ–‡æ¡£ã€‚è¿™äº› API å°†åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸æƒ³æ‰¿è¯ºä»»ä½•åœ¨çº¿è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ [API è“å›¾](https://apiblueprint.org/)ã€[å…»èœ‚åœº](https://apiary.io/)æˆ–[æ‹›æ‘‡](https://swagger.io/)ã€‚ä»å¤´å¼€å§‹å»ºç«‹ä¸€äº›ä¸œè¥¿ï¼Œ...æœ‰ç‚¹å¤šã€‚æ­¤å¤–ï¼Œæˆ‘å¸Œæœ›å°†æ–‡æ¡£é›†æˆåˆ°ä»£ç ä¸­ï¼Œé¿å…ä»…ä»…ä¸ºäº†ç¼–å†™æ–‡æ¡£è€Œè¿›è¡Œä»»ä½•ç±»å‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

æˆ‘çŸ¥é“`jsdoc`å’Œ`esdoc`ï¼Œå®ƒä»¬éƒ½å…è®¸æˆ‘ä»¬åœ¨æ³¨é‡Šä¸­å†™æ–‡æ¡£ã€‚ç„¶è€Œï¼Œä»–ä»¬çš„å·¥ä½œæ˜¯è®°å½• javascript ä»£ç ï¼Œè€Œä¸æ˜¯ HTTP APIsã€‚ç„¶åï¼Œæˆ‘æ‰¾äº†ä¸€ä¸ªå·¥å…· [`swagger-jsdoc`](%7B%%20raw%20%%7D%60https://github.com/Surnet/swagger-jsdoc%60%7B%%20endraw%20%%7D) ï¼Œä»æ³¨é‡Šä¸­ç”Ÿæˆ swagger / OpenAPI è§„èŒƒã€‚è¿™æ­£æ˜¯æˆ‘ä¸€ç›´åœ¨å¯»æ‰¾çš„ã€‚

### ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›`code`

åªæ˜¯ä¸€ä¸ªç®€å•çš„åˆ—å‡ºåŠ¨ç‰©çš„æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥æ·»åŠ ä½ æœ€å–œæ¬¢çš„åŠ¨ç‰©ã€‚*ç›¸å½“æ–°é¢–çš„æ¦‚å¿µ*ã€‚

```
const express = require('express');
const bodyparser = require('body-parser');

const app = express();
app.use(bodyparser.json({
  strict: false,
}));

const animals = [
  'panda', 'racoon', 'python',
];

app.get('/list', (req, res) => {
  return res.json(req.query.sort === 'yes' ? Array.from(animals).sort() : animals); // why is .sort inplace ğŸ˜ 
});

app.post('/add', (req, res) => {
  animals.push(...req.body.animals);
  return res.json({
    message: 'Added',
  });
});

app.listen(3000, () => {
  console.log('Server started at port 3000');
}); 
```

Enter fullscreen mode Exit fullscreen mode

`swagger-jsdoc`è¦æ±‚æ³¨é‡Šéµå¾ª [OpenAPI è§„èŒƒ](https://swagger.io/docs/specification/about/)ï¼Œç›¸å½“ç›´è§‚ã€‚

æ·»åŠ `/list`è·¯çº¿çš„æ–‡æ¡£æ³¨é‡Šã€‚

```
/**
 * @swagger
 * /list:
 *   get:
 *     summary: List all the animals
 *     description: Returns a list of all the animals, optionally sorted
 *     tags:
 *       - animals
 *     parameters:
 *       - in: query
 *         name: sort
 *         type: string
 *         required: false
 *         enum:
 *           - yes
 *           - no
 *     responses:
 *       200:
 *         description: List of animals
 *         schema:
 *           type: object
 *           properties:
 *             animals:
 *               type: array
 *               description: all the animals
 *               items:
 *                 type: string
 */

app.get('/list', (req, res) => {
  // ...
}); 
```

Enter fullscreen mode Exit fullscreen mode

ç¬¬ä¸€è¡Œæ˜¯`@swagger`ï¼Œå®ƒå¸®åŠ©`swagger-jsdoc`å°†è¿™ä¸ªæ³¨é‡Šå—è¯†åˆ«ä¸º swagger (OpenAPI)è§„èŒƒã€‚æ¥ä¸‹æ¥çš„å‡ è¡Œå®šä¹‰äº†è·¯å¾„ã€æ–¹æ³•ã€ä¸€äº›æ€»ç»“å’Œæè¿°ã€‚`tags`ç”¨äºå¯¹ API è¿›è¡Œåˆ†ç»„ã€‚

æ¥ä¸‹æ¥æè¿°é¢„æœŸå‚æ•°`query`å’Œ`path`ã€‚æˆ‘ä»¬çš„`/list` API éœ€è¦ä¸€ä¸ªå¯é€‰çš„`sort`æŸ¥è¯¢å‚æ•°ï¼Œç”¨äºåœ¨å‘é€ä¹‹å‰å†³å®šåŠ¨ç‰©åˆ—è¡¨æ˜¯å¦åº”è¯¥æ’åºã€‚

ç„¶åæˆ‘ä»¬å®šä¹‰å›åº”ã€‚é¦–å…ˆæ˜¯çŠ¶æ€ï¼Œç¨åŠ æè¿°ï¼Œç„¶åæ˜¯å“åº”çš„æ¨¡å¼ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè¿”å› JSONã€‚ä½†æ˜¯ï¼Œè®°å½•å…¶ä»–å†…å®¹ç±»å‹ä¹Ÿå¾ˆå®¹æ˜“ã€‚

æˆ‘ä»¬å°†ä¸º`/add`è¯·æ±‚åšåŒæ ·çš„äº‹æƒ…ã€‚

```
/**
 * @swagger
 * /add:
 *   post:
 *     summary: Add more animal
 *     description: Add animals to the list
 *     tags:
 *       - animals
  *     requestBody:
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               animals:
 *                 type: array
 *                 items:
 *                   type: string
 *     responses:
 *       200:
 *         description: Adds the animals in body
 *         schema:
 *           type: object
 *           properties:
 *             message:
 *               type: string
 *               default: 'Added'
 */
app.post('/add', (req, res) => {
  // ...
}); 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ³¨é‡Šï¼Œæˆ‘ä»¬å°†è¿æ¥`swagger-jsdoc`æ¨¡å—ã€‚

```
// ... other modules
const swaggerJSDoc = require('swagger-jsdoc');

const app = express();
app.use(bodyparser.json({
  strict: false,
}));

const animals = [
  'panda', 'racoon', 'python',
];

// -- setup up swagger-jsdoc --
const swaggerDefinition = {
  info: {
    title: 'Animals',
    version: '1.0.0',
    description: 'All things animlas',
  },
  host: 'localhost:3000',
  basePath: '/',
};
const options = {
  swaggerDefinition,
  apis: [path.resolve(__dirname, 'server.js')],
};
const swaggerSpec = swaggerJSDoc(options);

// -- routes for docs and generated swagger spec --

app.get('/swagger.json', (req, res) => {
  res.setHeader('Content-Type', 'application/json');
  res.send(swaggerSpec);
});

// other routes 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å°†åœ¨`/swagger.json`æä¾›ä¸€ä¸ªå¤§æ‘‡å¤§æ‘†çš„è§„æ ¼ã€‚å‰©ä¸‹è¦åšçš„å°±æ˜¯ä»¥ä¸€ç§æ›´åŠ äººæ€§åŒ–çš„æ–¹å¼æ¥æ¸²æŸ“è¿™ä¸ªè§„èŒƒã€‚ä¸ºæ­¤æˆ‘é€‰æ‹©äº† [ReDoc](https://github.com/Rebilly/ReDoc) ã€‚å®ƒæœ‰ä¸€ä¸ªç®€å•çš„è®¾ç½®ã€‚

åŒ…å«ä¸€ä¸ª HTML æ–‡ä»¶

```
<!DOCTYPE html>
<html>
  <head>
    Quizizz Docs
    <!-- needed for adaptive design -->
    <meta charset="utf-8"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://quizizz.com/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">

    <!--
    ReDoc doesn't change outer page styles
    -->
    <style>
      body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <!-- we provide is specification here -->
    <redoc spec-url='http://localhost:3000/swagger.json' expand-responses="all"></redoc>
    <script src="https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js"> </script>
  </body>
</html> 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å·²ç»å°†`http://localhost:3000/docs/swagger.json`è®¾ç½®ä¸ºæœåŠ¡å™¨ JSON è§„èŒƒçš„ä½ç½®ã€‚è®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªè·¯ç”±æ¥æœåŠ¡è¿™ä¸ª HTMLã€‚

```
app.get('/docs', (req, res) => {
  res.sendFile(path.join(__dirname, 'redoc.html'));
}); 
```

Enter fullscreen mode Exit fullscreen mode

ç»“æœï¼Œ

[![ReDoc rendered documentation](../Images/0a888395326ae55f2608663e75906f82.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--9z8K6R4r--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i.imgur.com/QN1LULM.gif)

> OpenAPI å’Œ`swagger-jsdoc`æœ‰æ›´å¤šçš„ç»„ä»¶ï¼Œä½¿å¾—è¿™ä¸ªè¿‡ç¨‹æ›´åŠ å®¹æ˜“ã€‚æ‚¨å¯ä»¥ä¸ºå¤šæ¬¡ä½¿ç”¨çš„æ¨¡å¼/è¯·æ±‚/å“åº”ç¼–å†™å®šä¹‰ï¼Œç„¶ååœ¨æ–‡æ¡£ä¸­ä½¿ç”¨å®ƒä»¬ã€‚æŸ¥çœ‹[ç»„ä»¶éƒ¨åˆ†| Swagger](https://swagger.io/docs/specification/components/) å’Œ[å…¥é—¨| Swagger JSDoc](https://github.com/Surnet/swagger-jsdoc/blob/master/docs/GETTING-STARTED.md) ä»¥ JavaScripty æ–¹å¼å®šä¹‰å®ƒä»¬ã€‚
> 
> ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/akshendra/akshendra.github.io/tree/master/docs-on-fly/code)æ‰¾åˆ°