# 监控政府网站的内容变化

> 原文:[https://dev . to/malcolmkee/monitoring-government-website-for-content-change-23ck](https://dev.to/malcolmkee/monitoring-government-website-for-content-change-23ck)

作为一名软件工程师，工作中最有成就感的部分就是解决让人们生活更轻松的问题。

最近，应我的一个老朋友的请求，我开发了一个网页抓取应用程序，可以检查政府网站的任何变化。

## [](#problem-statement)问题陈述

在马来西亚，会计师必须确保他们根据最新的公司法编制财务报告。不幸的是，当局有时在没有适当渠道通知会计师的情况下更新公司法。

会计人员只能参考政府网站进行修改，但是那里有 100 多份文件，每次都浏览是不切实际的。因此，会计师经常根据过时的规定提交报告，结果报告被拒绝，造成时间和精力的浪费。

## [](#the-solution)解

该解决方案由三部分组成:

1.  抓取内容
2.  检查更新，当检测到任何更改时:
    *   向订阅者发送电子邮件
    *   用最新数据触发静态站点的构建
3.  安排步骤 1 和步骤 2 每天运行

### [](#1-scraping-the-content)1。抓取内容

现在浏览网页很容易，而且有很多方法可以做到。然而，正如俗话所说，“当你是一把锤子时，一切看起来都像钉子”，我选择 NodeJS，因为它是我最熟悉的服务器端平台。

我使用以下 npm 库来删除内容:

*   `request`:向站点发出 http 请求
*   `cheerio`:解析页面内容

这样，通过检查页面上的 html 并相应地编写选择器，我能够提取出页面上所有公司行为的信息。

然后将结果保存到 MongoDB 数据库中。

### [](#2-checking-for-update-and-notifybuild-site)2。检查更新和通知/建立网站

由于内容在前一步骤中被保存，检查更新仅仅是比较今天和昨天的结果的任何差异。

如果有任何不同，

1.  电子邮件将通过[发送网格](https://sendgrid.com/)发送。
2.  nodejs 脚本还将向 [Netlify 构建钩子](https://www.netlify.com/docs/webhooks/)发出 post 请求，这将触发静态站点的构建。

静态站点是用 [Gatsby](https://www.gatsbyjs.org/) 生成的，它被配置为在构建时发出一个 http 请求来获取差异列表并输出静态 html 文件。

静态站点可以在这里查看[。(您可能看不到任何数据，因为该应用程序仅启动了几天，因此还没有可用的数据)](https://ssm-update.netlify.com/)

### [](#3-scheduling)3。行程安排

由于我将 nodejs 应用程序托管在我自己的服务器实例上，在那里我有完全的访问权限，所以我利用 unix crontab 来安排这两个步骤。

这是我第一次自己安装 crontab，当它们工作的时候我非常激动！:)

## [](#conclusion)结论

即使应用程序看起来很好，最好的解决方案是政府网站为会计师提供 newletter/RSS 订阅，以进行任何更改。尽管如此，开发这个应用程序的经历既有趣又令人满意，因为我可以在学习新技术的同时帮助他人。

## [](#source-code)源代码

nodejs app repo

[盖茨比网站](https://github.com/malcolm-kee/ssm-update)