# 将新的主要功能部署到生产环境时需要考虑的 5 件事

> 原文：<https://dev.to/geshan/5-things-to-consider-when-deploying-a-new-major-feature-to-production-43e5>

在更短的时间内完成从开发者机器到产品的特性代码是高效技术/工程团队的品质。使用像 [capistrano](http://capistranorb.com/) 或 [fabric](http://fabfile.org/) 这样的工具进行自动化部署，使得部署比一个可怕的操作更容易，在这个操作中，您会错过一个步骤，然后在生产中搞砸。

如今，Docker 和 T2【Kubernetes】让部署变得轻而易举。这篇文章将强调当你部署一个新的主要特性时需要考虑的事情，这个新特性涉及到一些大的代码和数据库变化。

[![5 Things to consider when deploying a new major feature to production](../Images/7550674aa91f0b37e0460bfcbc196c85.png "5 Things to consider when deploying a new major feature to production")T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--BQZ1_VC1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://geshan.com.np/images/5-deployment-considerations/capistrano-deployment.png)

## 主要特征是什么

如何区分常规和主要特性部署？例如，如果您在一个电子商务网站中部署了一个客户钱包子系统，或者您将一个多租户功能部署到一个单租户应用程序中，那么这应该被视为一个正在推广的主要功能。

常规功能不需要部署计划或大量的预先考虑，它们可以通过运行常规部署程序来部署，这没问题。主要特性是常规特性和缺陷中的一种子项目。部署重要特性是开发、系统管理/开发运维以及产品团队的共同责任。

## TLDR；

> 在一个新的主要特性投入使用/生产之前，一定要在试运行阶段进行严格的测试。做一个数据库备份和部署小的向后兼容。总是要有一个回滚计划，并且将特性保持在一个特性标志下。

## 需要考虑的事项

那么，当您想要部署团队已经完成开发并想要继续生产的新的主要特性时，您需要考虑什么呢？

在进行涉及大量代码更改和一些数据库模式迁移更改的重大部署之前，您应该列出以下事项:

### 1.严格的试运行测试

这是显而易见的，您必须在试运行环境中严格测试新特性，并确保您涵盖了不同的用例。我甚至建议用谷歌表单列出可能的案例并进行测试。如果你有质量保证部门，你肯定会得到他们的帮助。

> 开发人员级别的测试也非常重要，在试运行时发现并修复一个 bug 比上线并进行回滚花费要少得多。

您可能需要回滚，因为在生产环境中发现了重大错误。这是一个你不想处于的情况。问题是它是否已经准备好发布，或者测试时间太长是否会延迟发布。

### 2.始终进行数据库备份

在对生产数据库进行任何更改之前，进行备份是您需要做的最重要的事情。这是一件小事，如果你忘记了，你可能会招致一场灾难。

> 当你没有做好基本的事情时，问题会滚雪球般变得更大。

因此，请注意，在运行这些迁移/变更查询之前，一定要备份数据库。还要注意，部署脚本不会自动运行迁移。这可能会使主要特性的部署过程变得很痛苦，因此要为困难的情况做好准备。

### 3.小型多重部署，保持向后兼容性

当您必须将一个主要特性部署到生产环境中时，在完全向后兼容的生产环境中进行所需的数据库更改是一个好主意。

> 您可以在生产数据库中修改表和新列。这有助于您将主要功能分解成较小的部分，并逐步部署它们。

这给团队带来了灵活性和信心，让他们可以继续使用新特性进行生产。如果处理得当，这可以成为零停机部署的促成因素。

### 4.不要忘记回滚计划

如果您计划进行一次主要部署来发布主要功能，请制定一个推广计划。它详细说明了如何通过阐述推广策略的适当步骤来执行部署。

> 即使您认为推出/部署将会成功，也要有一个回滚计划。

列出您需要回滚到应用程序当前工作版本的东西，以防事情没有按计划进行，您需要恢复。如果您有可以快速修复的小问题，您不需要回滚，但如果有重大问题，回滚将是唯一的出路。

### 5.基于条件的特征

最后但同样重要的是，如果您正在部署一个主要特性，让您公司的员工(或公司内的一个小组)尽早访问总是一个完美的主意。

> 比如产品团队可以在生产中测试这个特性。

你现在问如何？很简单，当用户使用@yourcompnay.com 电子邮件地址登录时，只需限制要执行的特征码。有一次，我记得我们这样做是为了推出一种支付方式，只有当你使用一个特定的电子邮件地址时，它才会显示出来。因此，主要功能可以部署到生产环境中，并且仍然具有过滤的访问权限。在相关团队批准后，您只需取消访问该功能的条件，并向所有客户/用户提供该功能。

## 结论

尽可能实现零停机部署，并在流量最低时在生产环境中运行数据库迁移脚本。即使必须停机，也要确保事先想办法尽可能减少停机时间，这样系统就可以在最少的时间内进行定期维护。部署愉快。

* * *

最初发表于[Geshan.com.np](https://geshan.com.np)，你可以在那里读到更多的东西。