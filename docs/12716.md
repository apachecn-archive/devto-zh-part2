# 用“curl”代码库卷起

> 原文:[https://dev . to/captainsafia/curling-up-with-curl-code-base-38gi](https://dev.to/captainsafia/curling-up-with-the-curl-code-base-38gi)

前几天，我在想(什么时候我想知道的事情不是随机的？)浏览器如何工作。更正:我想知道当你在浏览器中输入一个网址并点击“回车”会发生什么我对 DNS 解析或 TCP 连接或互联网上其他与网络相关的方面并不好奇。我想知道浏览器如何将所有这些连接到一个应用程序中。我以前了解过这些概念，但我一直想知道它们是如何连接到一个单一的功能应用程序中的。

像往常一样，我想通过阅读应用程序的源代码来了解更多这方面的知识。起初，我想我可能会阅读 Chromium 或 Firefox 或其他一些开源浏览器的代码。然后我意识到，这些应用程序中可能有很多代码会影响我对网络方面的分析。相反，我想通过查看`curl`的代码库来找出这些概念之间的联系。

`curl`是一个命令行工具，允许用户将数据从一台服务器传输到另一台服务器。尽管它通常用于通过超文本传输协议(HTTP)查询站点，但实际上您也可以使用它通过其他协议(如 FTP)传输数据。实际上，在开始这次探索之前，我并不知道这一点，所以我想这是我学到的新东西！

无论如何，作为开始，我想弄清楚当我在命令行上运行以下命令时会发生什么。

```
$ curl https://safia.rocks 
```

此命令将我的个人网站的 HTML 源代码打印到控制台。你可以试试看。

`curl`的源代码托管在 [GitHub](https://github.com/curl/curl) 上。首要任务是找到`curl`可执行文件的入口点。我四处窥探源代码，试图找到这个。

补充说明:在这些博客文章中，我经常使用“四处窥探”这个短语。一般来说，这意味着浏览目录，阅读文件中我认为可能与我想要的相关的前几行，并阅读头文件的源代码。

浏览了一会儿之后，我开始注意到`curl`的源代码结构的一些趋势。特别是，与命令行工具相关的源代码散布在`src/tool_*.c`路径下的文件中。这包括解析参数、打印帮助语句、处理传入`curl`的 url 以及与 libcurl 接口的代码。

侧边栏:当我提到`curl`时，我指的是命令行工具。还有`libcurl`，它是包含处理所有传输协议的代码的库。

一旦我弄明白了这个`src/tool_*.c`模式，没多久我就找到了命令行工具的切入点。它位于 [`src/tool_main.c`](https://github.com/curl/curl/blob/36f0f47887563b2e016554dc0b8747cef39f746f/src/tool_main.c#L241-L282) 文件的`main`功能中。太棒了。现在，我们可以开始有趣的部分了。

该函数中引用的最重要的代码如下。

```
/* Start our curl operation */
result = operate(&global, argc, argv); 
```

因此，看起来大部分繁重的工作都是由模糊命名的`operate`函数完成的。

侧栏:`argc`和`argv`参数是不言自明的。`global`参数是对`curl`的全局配置的引用，默认情况下，T3 是存储在用户主目录中的`.curlrc`文件。

好吧！所以是时候研究一下 [`src/tool_operate.c`](https://github.com/curl/curl/blob/36f0f47887563b2e016554dc0b8747cef39f746f/src/tool_operate.c) 文件中定义的`operate`函数了。我决定从查看`operate`函数的函数声明开始我的探索。

```
CURLcode operate(struct GlobalConfig *config, int argc, argv_item_t argv[]) 
```

特别是，我对函数返回的`CURLcode`对象感兴趣。我试图在代码库中找到这个对象的定义。我假设它是一个结构，所以我搜索了那个定义。我用来查找 struct 定义的查询没有找到任何东西(我实际上是在 curl 的本地副本上使用命令行查找的)。相反，我选择了关于`CURLcode`的文档，我在这里找到了。所以事实证明，CURLcode 实际上是一个类似 enum 的结构，它包含了在`curl`中可能出现的不同错误代码的整数表示。考虑到大多数(所有)C 函数使用整数返回它们的状态，以及在返回主函数`curl`的入口点时`operate`函数的结果被类型转换为整数，这是有意义的。

好吧！这篇博文有点长，所以在下一篇博文中，我将深入到`operate`函数的核心部分，并尝试分析那里发生了什么。为了不让自己误入歧途，我想在阅读代码时回答以下问题。

1.  在`operate`函数中有哪些对`libcurl`的调用？
2.  对传递给`operate`函数的参数做了什么预处理(如果有的话)？

下一篇博文再见！