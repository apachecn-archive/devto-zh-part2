# (不)实际连续交货

> 原文：<https://dev.to/nikoheikkila/the-impractical-continuous-delivery-4gel>

本周，我参加了一个为期两天的培训课程，内容是关于持续集成、交付和部署的实用解决方案。我去那里是因为我们工作的战略目标之一是提高我们产品开发的速度。

如前所述，作为工作流程的一部分，实现一个完善的开发、集成和测试管道将极大地帮助您交付一个一致的产品，通过所有的质量关，并让您的客户持续兴奋。如果你想了解更多关于持续交付的好处，我强烈建议你阅读由 [@stenpittet](https://dev.to/stenpittet) 写的这篇文章。

## 文章不再可用

起初，我想实现一致的管道会有多难？我的工作流程已经最大限度地提高了，只要有合适的工具，我就能在一天内解决多个问题。多亏了我们伟大的导师，我很快明白了现实...

> ![𝚗𝚒𝚔𝚘 𝚑𝚎𝚒𝚔𝚔𝚒𝚕𝚊 ✍️ profile image](img/bc16ff461121cc135efa7c79f6714a8e.png)[【nikoheikkila】](https://dev.to/nikoheikkila)![twitter logo](img/4c8a2313941dda016bf4d78d103264aa.png)关于持续集成和持续交付的教育只是让我意识到我当前的工作流是上述方法的非常反模式的。嗯，永远不要停止学习。🤔2018 年 4 月 26 日下午 18:58[![Twitter reply action](img/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=989579416404709377)[![Twitter retweet action](img/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=989579416404709377)[![Twitter like action](img/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=989579416404709377)

因此，在这篇文章中，我将列出我在工作中已经习惯的方法，但是这些方法却是持续集成和交付的可怕的反模式。当然，作为免责声明，有很多文章解释了更多的反模式，所以请记住，这个列表本质上是个人的，而不是完整的。下面所有的反模式都反映了我的个人经历。

## 反模式#1:特征分支

在持续集成模型中，开发人员应该至少每天一次将他们的代码直接推送到*主线*(比如你的 Git 库的主分支)。

相反，我所做的是在我的功能分支上呆上几天，如果不是几周的话，经常从父分支重新设定变更的基础，但从不推回到主线。这是因为在工作中，我们遵循一个严格的看板工作流程，为了安全和授权，我们需要在特性被合并到主线之前进行同行评审和手工测试。

特性分支的一个缺点是，它将开发人员与其团队的其他成员完全隔离开来。尽管进行了积极的重新定基，我仍然不时地遇到血腥的合并冲突。这是为什么呢？

答案很简单:**孤立阻碍交流。**

我倾向于将代码牢牢掌握在手中，除非遇到真正的障碍，否则不会讨论它。这实际上导致了两种结果: **a)** 我最终实现了超过需求的东西([*【YAGNI】*](https://www.martinfowler.com/bliki/Yagni.html))让我慢下来，或者 **b)** 实现了错误的东西让我更慢，因为我需要重写代码。

为了解决这个问题，为了让持续集成真正按书上说的进行，我们应该完全放弃特性分支，但是我不相信我和我的团队已经准备好了。另一方面，尽可能以最小的增量设计新特性，并将它们从特性分支快速合并到主线中也是可行的。

相反，我想通过做更多的结对编程来提高我的沟通技巧。最近，我一直在以一种真正 DevOps 的方式实践它，与我们的一个运营人员配对——他敲打服务器，而我敲打代码。如果你问我，我会说我们在这方面做得非常好。

此外，当我需要审查代码时，我应该大胆地让我的同事来审查它，而不是让这个问题搁置很久。我知道，我知道。很简单吧？或者不适合像我这样内向的人。作为开发人员，我们应该开始更多地关注开发的软技能，比如交流、合作和移情等等。

## 反模式#2:只有在特性准备好之后才开始测试

大多数质量保证专家可能都觉得这是一个生锈的钉子扎进了他们的脚后跟。想象一对巨大的用户故事，由 20-30 个并行开发的新增量组成。在所有(痛苦的)合并完成之后，代码已经在*代码冻结仪式*(一个反模式本身)中被合并到主线上，是时候在发布到产品之前开始测试回归错误了。

即使是专业的测试部门，回归测试至少也要花上几天时间，而开发人员要么无所事事地等待测试报告可能的错误，要么转移到下一个功能，从而导致不同任务之间不必要的上下文切换。拿我来说，当几天或几周后被问到我写的代码时，我很难记住它。

这里显而易见的解决方案是，在您仍在开发代码时，邀请您的同行来测试您的代码。同样，结对是解决这个问题的有利方法。事实上，从最早的可行会议一直到最后的冲刺评审，测试专家都应该被包括在开发冲刺中。让他们进来作为迭代的最后一步，只会伤害他们自己和开发者。

## 反模式#3:后备箱里的垃圾

持续集成清单要求所有代码在进入主线之前都要进行本地测试。通常，在本地开发代码时，我会运行静态代码分析和单元测试，在创建新的提交之前等待它们通过。那么，即使所有的测试都通过了，测试覆盖率也很高，为什么我的一些变更仍然会引入错误和突破性的变更呢？

好吧，如果你一直在认真阅读这篇文章，我在*反模式#1* 部分解释了它。您的主线(*主干*)中的错误和突破性变更(*垃圾*)削弱了持续集成和交付管道，使其不太可靠，需要更多的手动测试。此外，你的版本控制历史将会因为那些试图修复的提交而看起来很怪异。

## 结论

对于您经常在单个分支中工作的个人项目，很容易配置例如 [Travis CI](https://travis-ci.org/) 来构建管道的提交阶段，并在打包软件或将其交付生产之前报告可能的错误。

对于涉及几十个人的开源和封闭的商业项目，向持续集成和交付的最佳实践的转换将会更加困难，因为这首先是一个文化问题。我认为任何社区或公司，如果他们真的想要的话，都可以让这种转变发生。我致力于开始尽可能多地处理提到的反模式，无论我在这个职业生涯中可能会结束。

* * *

Nhan Ngo 根据知识共享协议 BY-SA 许可使用封面图片。