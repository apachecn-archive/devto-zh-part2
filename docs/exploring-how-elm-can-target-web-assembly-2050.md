# 探索 Elm 如何瞄准 Web 程序集

> 原文：<https://dev.to/robinheghan/exploring-how-elm-can-target-web-assembly-2050>

标题听起来很有趣，不是吗？上周我脑子里有个想法挥之不去。所以，我宣布 ELS。

ELS 是什么？这是一个静态类型 Lisp 的实验性编译器，可以编译成 Web 程序集。至于 ELS 真正的意思是什么...我还不确定，但是一旦我找到一个短语，我一定会让你知道它可能是=)的首字母缩写

我想在这一点上你可能有点困惑。您甚至可能会仔细检查标题，以确保它确实包含单词 Elm，事实也确实如此。那我为什么要说 Lisp 呢？

## 网页组装

有几个人问 Elm 是否或者何时会把 Web Assembly (WASM)作为目标。我相信 Elm 最终会把 WASM 作为目标，因为它会让我们避开一些奇怪的 Javascript 语义(比如 53 位整数)，承诺更小的资产规模和(可能)更好的性能。

然而，现在还为时尚早，瞄准 WASM 并不像瞄准 Javascript 那么容易。WASM 没有对象。没有数组、字符串或闭包。见鬼，甚至没有内置的内存分配器，更不用说垃圾收集器了。

现在，垃圾收集器将在未来的某个时候出现。所以在此期间，埃文(《榆树》作者)的时间最好花在其他事情上。

## 那么这个 ELS 的事情是怎么回事呢？

好吧。即使在编译器中添加 Elm 支持将是一项巨大的工作，但可能收效甚微(老实说，有比编译更好的方法来改进 Elm)，这并不意味着探索空间是浪费精力。正如 Evan 之前所说:“代码是最简单的部分。”

港口在 WASM 世界应该如何运作？弦应该如何工作？使用未来的内置 GC 是最好的，还是像 Elm 这样的语言使用定制的 GC 方案会做得更好？我们如何将 curried 函数编译成 WASM？REPL 是如何工作的？可以实现类似 Erlang 的流程吗？

有一堆问题需要回答，没有理由不尽早探索这个领域。如果我们幸运的话，在 Elm 准备瞄准 WASM 的时候，一些基础工作已经完成了。

## 但是...Lisp？

所以，我遇到了一个问题。我想探索 Elm 如何向下编译到 WASM，但是我真的不知道 Elm 编译器是如何工作的，更重要的是，我不知道 Haskell。幸运的是，重要的事情实际上不是编译 Elm，而是编译一种与 Elm 具有相同语义的语言。所以我决定用 Javascript 构建自己的语言来满足这个需求。因为我并不真正关心语言看起来像什么，所以我选择了易于解析的语法，那就是 Lisp(当然，带有类型注释)。

还有其他的考虑。Javascript 中已经有用于 WASM 的工具，要执行 WASM 需要一个 Javascript 环境。因此，用 JS 编写编译器会使事情变得简单一些。

最大的缺点是，我所做的任何编译器工作都不能在将来的某个时候合并到 Elm 编译器中。但是没关系。这是一个实验，我不期望我写的代码是任何人都想重用的。

我真正希望的是，我从中获得的经验能够在将来帮助我将 Elm 移植到 WASM。我甚至可以写一些模块，当这种情况发生时，Elm 可以使用，比如一个字符串库，甚至一个基本的垃圾收集器，它可以作为一个临时的缺口，直到 WASM 有了自己的垃圾收集器。

## 可以试用一下吗？

当然可以。代码和试用说明可在[这里](https://github.com/els-lang/compiler)找到。