# åˆ›å»ºæ´»åŠ¨ç¥¨åŠ¡æœåŠ¡(Laravel API+react js+NextJS+Material UI)

> åŸæ–‡:[https://dev . to/whoisryosuke/creating-an-event-ticketing-service-laravel-API-react js-nextjs-material-ui-2c2b](https://dev.to/whoisryosuke/creating-an-event-ticketing-service-laravel-api--reactjs--nextjs--material-ui-2c2b)

Laravel ä½¿å¿«é€Ÿåˆ›å»ºå¼ºå¤§çš„åç«¯åº”ç”¨ç¨‹åºå’Œ API å˜å¾—éå¸¸å®¹æ˜“ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä¸ºä¸€ä¸ªæ´»åŠ¨ç›®å½•å’Œç¥¨åŠ¡å¹³å°(å¦‚ Eventbrite)åˆ›å»ºä¸€ä¸ª APIã€‚ä»»ä½•å‰ç«¯æˆ–åç«¯åº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ª APIï¼Œåœ¨æœ¬æ•™ç¨‹çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºäº ReactJS çš„ç®¡ç†ä»ªè¡¨æ¿ï¼Œä½¿ç”¨è¿™ä¸ª API æ¥æµè§ˆã€åˆ›å»ºã€ç¼–è¾‘å’Œåˆ é™¤å¸–å­ã€‚

è¿™ä¸ªé¡¹ç›®å°†åŸºäºä¸€ä¸ªå“ç‰Œæˆ‘çš„å·¥ä½œï¼Œ [SeshSource](http://seshsource.com) ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºå¤§éº»ä¸ºä¸­å¿ƒçš„æ´»åŠ¨ç¥¨åŠ¡å¹³å°ã€‚æˆ‘ä»¬å°†åœ¨æœ¬è´¨ä¸Šåˆ›å»º SeshSource å½“å‰æ¶æ„çš„é•œåƒï¼Œåªæ˜¯åœ¨ Laravel ä¸­ï¼Œè€Œä¸æ˜¯ Wordpress + pluginsã€‚

## [](#necessary-features-mvp)å¿…å¤‡åŠŸèƒ½(MVP)

æˆ‘é¦–å…ˆæ¦‚è¿°äº†æˆ‘ä»¬å¸Œæœ› MVP æˆ–æœ€ä½å¯è¡Œäº§å“å…·æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æµè§ˆæ´»åŠ¨å’Œè´­ä¹°é—¨ç¥¨:

### [](#directory)ç›®å½•

*   å¯æŒ‰æ—¥æœŸæœç´¢çš„äº‹ä»¶
*   æŒ‰ä½ç½®æˆ–ç±»åˆ«æ˜¾ç¤ºçš„äº‹ä»¶
*   æ´»åŠ¨ç»„ç»‡è€…çš„ç”¨æˆ·é…ç½®æ–‡ä»¶
*   å¸¦æœ‰äº‹ä»¶çš„æ—¥å†è§†å›¾
*   åˆ—è¡¨/å¡ç‰‡è§†å›¾
*   æ‰€æœ‰åŸå¸‚ï¼Œå·ç­‰+æ¡£æ¡ˆé¡µé¢åˆ—è¡¨

### [](#ecommerce)ç”µå­å•†åŠ¡

*   è´­ä¹°å…è´¹æˆ–ä»˜è´¹çš„ç¥¨
*   ç”Ÿæˆç¥¨æ®çš„ PDF
*   é€šè¿‡ç”µå­é‚®ä»¶å‘ç”¨æˆ·å‘é€ PDF
*   å…³äºæ–°é‡‡è´­çš„ç”µå­é‚®ä»¶ä¸šåŠ¡
*   åœ¨æ´»åŠ¨ä¸­æ‰«æé—¨ç¥¨çš„ç§»åŠ¨å‹å¥½å‹ç½‘ç»œåº”ç”¨ç¨‹åº

### [](#organizer-tools)ç»„ç»‡è€…å·¥å…·

*   ç”¨äºç®¡ç†äº‹ä»¶çš„ä»ªè¡¨æ¿
*   åˆ›å»ºäº‹ä»¶
*   ç¼–è¾‘äº‹ä»¶
*   åˆ é™¤äº‹ä»¶
*   ä¸ºç‰¹å®šæ´»åŠ¨åˆ›å»ºé—¨ç¥¨ç±»å‹(å…è´¹ã€VIP ç­‰)
*   æŸ¥çœ‹(+æ‰“å°)æ´»åŠ¨å‚ä¸è€…åˆ—è¡¨
*   æŸ¥çœ‹(+æ‰“å°)è®¢å•åˆ—è¡¨

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æˆ‘ä»¬æƒ³è¦ä» API ä¸­å¾—åˆ°ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹ç¼–ç å§ï¼

## [](#setup-a-laravel-project-with-docker)ç”¨ Docker è®¾ç½®ä¸€ä¸ª Laravel é¡¹ç›®

ä¸‹é¢æ˜¯æˆ‘å¦‚ä½•å¯åŠ¨ä¸€ä¸ªæ–°çš„ Laravel é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨ Docker è¿›è¡Œæœ¬åœ°å¼€å‘çš„æ–¹æ³•- *è€Œä¸ä¼šæŠŠæˆ‘çš„å¤´å‘éƒ½æ‹”æ‰*:

1.  `composer create-project --prefer-dist laravel/laravel seshsource-api`
2.  ç¡®ä¿ä½ æŠŠ Laradock *æ”¾åœ¨*ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹é‡Œ
3.  `cd laradock`
4.  å°†ç¤ºä¾‹ç¯å¢ƒæ–‡ä»¶å¤åˆ¶åˆ°çœŸå®ç¯å¢ƒæ–‡ä»¶:`cp env-example .env`
5.  å°† Laravel root ENV æ›´æ”¹ä¸ºä½¿ç”¨ Laradock ä½œä¸ºä¸»æœº( *Laravel ä½¿ç”¨ localhostï¼Œä½†æ˜¯ Laradock ä½¿ç”¨æœåŠ¡å*è®¿é—® Docker å®¹å™¨å†…çš„æ¯ä¸ªæœåŠ¡):

```
DB_HOST=mysql
DB_DATABASE=default
DB_USERNAME=default
REDIS_HOST=redis
QUEUE_HOST=beanstalkd 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  `docker-compose up -d nginx mysql phpmyadmin redis workspace`

æ‚¨åº”è¯¥åœ¨ Docker å¼€å‘æœåŠ¡å™¨ä¸Šæœ¬åœ°éƒ¨ç½²æ‚¨çš„ Laravel é¡¹ç›®ï¼å¾ˆç®€å•ï¼Œå¯¹å§ï¼ŸğŸ˜

## 4 æ­¥ä»¥å†…çš„ OAuth2.0 æœåŠ¡å™¨

è®©æˆ‘ä»¬ä¸º Laravel è®¾ç½®èº«ä»½éªŒè¯ï¼Œå¹¶ä½¿ç”¨ Passport åŒ…æ·»åŠ  OAuth2.0 æ”¯æŒ:

1.  `composer require laravel/passport`é¡¹ç›®æ ¹å†…
2.  `docker-compose exec workspace php artisan migrate`åœ¨ laradock æ–‡ä»¶å¤¹å†…(`cd laradock`)
3.  `docker-compose exec workspace php artisan passport:install`
4.  éµå¾ª Laravel æ–‡æ¡£ä¸­çš„æŒ‡å—å‘ç”¨æˆ·ç±»æ·»åŠ ç‰¹å¾
5.  `docker-compose exec workspace php artisan make:auth`
6.  è¿™é‡Œæ˜¯ä½ è®¾ç½®åº”ç”¨ç¨‹åºåç§°çš„åœ°æ–¹ã€‚å®ƒå°†åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„â€œåç§°ç©ºé—´â€ä¸­ä½¿ç”¨ï¼Œå› æ­¤å¼•ç”¨æ¨¡å‹å°†çœ‹èµ·æ¥åƒ:`use SeshSource\Events`ã€‚

## uuid

æˆ‘å–œæ¬¢ä½¿ç”¨ UUIDsï¼Œè€Œä¸æ˜¯ç›´æ¥ idã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Laravel 5.6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¯·å®‰è£…è¿™ä¸ªåº“ã€‚å¦åˆ™ï¼ŒLaravel 5.6 åŠæ›´é«˜ç‰ˆæœ¬ä¼šé¢„è£…ä¸€ä¸ª`uuid()` [åŠ©æ‰‹æ–¹æ³•](https://laravel.com/docs/5.6/helpers#method-str-uuid)ã€‚ä½ ä»ç„¶éœ€è¦åˆ›å»ºä¸€ä¸ªç‰¹å¾ï¼Œä½†æ˜¯ä½ ä¸éœ€è¦ä¾èµ–ã€‚

1.  `composer require webpatser/laravel-uuid`
2.  å°†å®ƒæ·»åŠ åˆ°åˆ«åæ•°ç»„æ‰€åœ¨çš„ config/app.php æ–‡ä»¶:`'Uuid' => Webpatser\Uuid\Uuid::class,`

ç°åœ¨æˆ‘ä»¬åªæ˜¯åœ¨è¿ç§»ä¸­ä½¿ç”¨`$table->uuid('id'); $table->primary('id');`è€Œä¸æ˜¯`$table->increments('id');`ã€‚

ç¡®ä¿ä»ä»»ä½•ä½¿ç”¨ UUIDs çš„æ¨¡å‹ä¸­åˆ é™¤è‡ªåŠ¨å¢é‡:

```
/**
 * Indicates if the IDs are auto-incrementing.
 *
 * @var bool
 */
public $incrementing = false; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æˆ‘ä»¬éœ€è¦åˆ›å»ºæ–°å¸–å­æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç‰¹å¾æ¥å¤„ç† UUID çš„ç”Ÿæˆ(app/Traits/Uuid.php):

### [](#dependency-version)ä¾èµ–ç‰ˆæœ¬

```
<?php

namespace SeshSource;

use Webpatser\Uuid\Uuid;
trait Uuids
{

    /**
     * Boot function from laravel.
     */
    protected static function boot()
    {
        parent::boot();

        static::creating(function ($model) {
            $model->{$model->getKeyName()} = Uuid::generate()->string;
        });
    }
}
?> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#laravel-56-uuid)æ‹‰å‹’ç»´å°” 5.6 UUID

```
<?php

namespace SeshSource\Traits;

use Illuminate\Support\Str;

trait Uuids
{

    /**
     * Boot function from laravel.
     */
    protected static function boot()
    {
        parent::boot();

        static::creating(function ($model) {
            $model->{$model->getKeyName()} = (string) Str::uuid();
        });
    }
}
?> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ‰€æœ‰çš„ UUID æ¨¡å‹ä¸­åŠ å…¥ç‰¹å¾:

```
use SeshSource\Traits\Uuids;

...

class User extends Authenticatable
{
use Uuids; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#migrations-and-models)è¿ç§»å’Œæ¨¡å‹

Laravel ç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤åˆ›å»º**æ¨¡å‹**ï¼Œå¸®åŠ©æˆ‘ä»¬ä¸æ•°æ®äº¤äº’ï¼Œä»¥åŠ**è¿ç§»** - PHP è¯­å¥ä¸ºæˆ‘ä»¬åˆ›å»ºæ•°æ®åº“è¡¨(ä¸éœ€è¦ SQLï¼).æˆ‘ä»¬å°†åˆ›å»º 10 ä¸ªæ¨¡å‹å’Œæ•°æ®åº“è¡¨æ¥å­˜å‚¨æˆ‘ä»¬ç½‘ç«™çš„æ‰€æœ‰æ•°æ®ã€‚

å…³äºç»“æ„çš„å†³ç­–ï¼Œæˆ‘ä¸ä¼šè¯´å¤ªå¤šç»†èŠ‚ï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯åŸºäº Wordpress çš„æ•°æ®åº“ç»“æ„â€”â€”ç»“åˆäº† WooCommerce å’Œ Tickera æ’ä»¶çš„æ•°æ®åº“ç»“æ„ã€‚äº‹ä»¶å­˜å‚¨åœ¨è¡¨ä¸­ï¼Œä»»ä½•é¢å¤–çš„â€œå…ƒæ•°æ®â€å­˜å‚¨åœ¨æ•°æ®é€è§†è¡¨ä¸­ã€‚è¿™ä¸è´­ç‰©è½¦çš„â€œè®¢å•â€ç±»ä¼¼ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸“ç”¨äºè®¢å•çš„è¡¨ï¼Œä»¥åŠä¸€ä¸ªç”¨äºæ¯ä¸ªå•ç‹¬è¡Œé¡¹ç›®çš„æ•°æ®é€è§†è¡¨(åŒ…å«ä»·æ ¼å’Œæ•°é‡)ã€‚æˆ‘ä»¬ä½¿ç”¨æ•°æ®é€è§†è¡¨ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªè´­ç‰©è½¦å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—ä¸­(ç”¨ JSON åºåˆ—åŒ–ï¼Œç”¨é€—å·åˆ†éš”çš„ idï¼Œç­‰ç­‰)â€”â€”è¿™å…è®¸æˆ‘ä»¬åˆ©ç”¨ Laravel çš„å…³ç³»æœ‰æ•ˆåœ°åŠ è½½ä»»ä½•ç›¸å…³æ•°æ®ã€‚

åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œè¿™äº›å‘½ä»¤æ¥åˆ›å»ºæ¨¡å‹å’Œè¿ç§»:

```
php artisan make:model Events -m
php artisan make:model EventMeta -m
php artisan make:model TicketTypes -m
php artisan make:model TicketTemplates -m
php artisan make:model Tickets -m
php artisan make:model UserMeta -m
php artisan make:model Orders -m
php artisan make:model OrderItems -m
php artisan make:model CheckIns -m
php artisan make:model Reviews -m 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°† UUIDs æ·»åŠ åˆ°æ‰€æœ‰æ¨¡å‹å’Œè¿ç§»ä¸­ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨å…ƒè¡¨ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨ç›®çš„ï¼Œåƒè®¢å•å’Œäº‹ä»¶è¿™æ ·çš„ä¸œè¥¿åº”è¯¥æœ‰ UUIDsã€‚

**ç¤ºä¾‹å‹å·:**

```
<?php

namespace SeshSource;

use SeshSource\Traits\Uuids;
use Illuminate\Database\Eloquent\Model;

class EventMeta extends Model
{
    use Uuids;

    /**
     * Indicates if the IDs are auto-incrementing.
     *
     * @var bool
     */
    public $incrementing = false;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ç¤ºä¾‹è¿ç§»:**

```
class CreateEventMetaTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('event_meta', function (Blueprint $table) {
            $table->uuid('id'); 
            $table->primary('id');
            $table->timestamps();
        });
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‡ç½®æ•°æ®åº“å¹¶è¿ç§»æ–°ç»“æ„:

`docker-compose exec workspace php artisan migrate:fresh`

> å¦‚æœæ‚¨å¯¹â€œå¤–æ¥ idâ€æœ‰ä»»ä½•é—®é¢˜ï¼Œè¿™å¯èƒ½æ„å‘³ç€åœ¨åˆ›å»ºç›¸å…³è¡¨ä¹‹å‰å·²ç»è¿è¡Œäº†å¸¦æœ‰å…³ç³»çš„è¿ç§»ã€‚é‡å‘½åè¿ç§»ï¼Œä»¥ç¡®ä¿åœ¨åˆ›å»ºä»»ä½•æ•°æ®é€è§†è¡¨ä¹‹å‰åˆ›å»ºä»»ä½•ç›¸å…³çš„è¡¨ã€‚

## [](#authentication-using-the-user-model)è®¤è¯ä½¿ç”¨ç”¨æˆ·æ¨¡å¼

å¦‚æœæ‚¨æ³¨æ„åˆ°åœ¨è¿ç§»ä¸­æˆ‘ä»¬å‘ç”¨æˆ·è¡¨(`database/migrations/2014_10_12_000000_create_users_table.php`)æ·»åŠ äº†ä¸€ä¸ªâ€œç±»å‹â€ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­ç™»å½•çš„ç”¨æˆ·æ˜¯å®¢æˆ·ã€æ´»åŠ¨ç»„ç»‡è€…è¿˜æ˜¯ç®¡ç†å‘˜ã€‚ä¸ºäº†æ›´å®¹æ˜“åœ°ç¡®å®šç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ç®¡ç†å‘˜æˆ–ç»„ç»‡è€…çº§åˆ«çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·æ¨¡å‹ä¸­æ·»åŠ äº†ä¸€ä¸ªå¤é€‰æ¡†:

```
 /**
     * Determines if user is admin or not (true or false)
     *
     * @return boolean
     */
    public function isAdmin() 
    {
        if($this->type == 'admin')
        {
            return true;
        } else {
            return false;
        }
    }

    /**
     * Determines if user is organizer or not (true or false)
     *
     * @return boolean
     */
    public function isOrganizer() 
    {
        if($this->type == 'organizer')
        {
            return true;
        } else {
            return false;
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#creating-api-controllers)åˆ›å»º API æ§åˆ¶å™¨

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†åº”ç”¨ç¨‹åºçš„æ§åˆ¶å™¨éƒ¨åˆ†äº†ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ 5 ä¸ªæ§åˆ¶å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Laravel çš„ artisan CLI æ¥åˆ¶ä½œ [API èµ„æºæ§åˆ¶å™¨](https://laravel.com/docs/5.6/controllers#resource-controllers)ã€‚è¿™ä¸ºæˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæä¾›äº†æ ‡å‡† API æ‰€éœ€çš„æ‰€æœ‰å¿…è¦æ–¹æ³•(ç´¢å¼•ã€å­˜å‚¨ã€æ›´æ–°ã€åˆ é™¤)ã€‚

```
php artisan make:controller 'Api/EventsController' --api
php artisan make:controller 'Api/UsersController' --api
php artisan make:controller 'Api/ReviewsController' --api
php artisan make:controller 'Api/OrdersController' --api
php artisan make:controller 'Api/CheckInsController' --api 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºç´¢å¼•æ–¹æ³•ï¼Œæˆ‘ä»¬åªä½¿ç”¨é€‚å½“çš„æ¨¡å‹å’Œåˆ†é¡µæ–¹æ³•(`Events::paginate(10)`)ã€‚ç¨åæˆ‘ä»¬å°†ä½¿ç”¨æŸ¥è¯¢å‚æ•°æ·»åŠ è¿‡æ»¤(æ”¹å˜é¡ºåºã€æŒ‡å®šç±»åˆ«ç­‰)ã€‚

å¯¹äº show æ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨åˆé€‚çš„æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨`findOrFail()`æ–¹æ³•æ¥æŠ“å–`$id` : `$event = Events::findOrFail($id);`ã€‚

> è¦è®©[ä½¿ç”¨ Laravel](https://laravel.com/docs/5.6/responses#json-responses) è¿”å›ä¸€ä¸ª JSON å“åº”ï¼Œåªéœ€å¯¹`response()`å¯¹è±¡:`return response()->json($events);`ä½¿ç”¨`json()`æ–¹æ³•

å¯¹äº`store()`æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªéªŒè¯å™¨(`php artisan make:request StoreEvents`)ã€‚éªŒè¯å™¨æ£€æŸ¥ POST è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·æ¨¡å‹ä¸Šçš„`isAdmin()`æ–¹æ³•éªŒè¯`authorize()`æ–¹æ³•ä¸­çš„ç”¨æˆ·ã€‚

```
<?php

namespace SeshSource\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreEvents extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */
    public function authorize()
    {
        return $this->user()->isAdmin();
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */
    public function rules()
    {
        return [
            'title' => 'required|unique:events|max:255',
            'start_date' => 'required|date',
            'end_date' => 'required|date',
            'street_address' => 'required',
            'city' => 'required',
            'state' => 'required',
            'email' => 'email',
            'event_logo' => 'image',
            'featured_img' => 'image'
        ];
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#passport-doesnt-support-uuid-user-ids)Passport ä¸æ”¯æŒ UUID ç”¨æˆ· ID

å¦‚æœæ‚¨åœ¨ä½¿ç”¨ Passport ä¸º OAuth2.0 è®¤è¯åº”ç”¨ç¨‹åºåˆ›å»ºå®¢æˆ·ç«¯ id æ—¶é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿè§£å†³æ–¹æ¡ˆã€‚

å› ä¸ºæˆ‘ä»¬æŠŠç”¨æˆ· ID æ¢æˆäº† UUIDï¼Œè€Œä¸æ˜¯é€’å¢çš„æ•´æ•°ï¼Œæ‰€ä»¥ Passport åˆ›å»ºäº†ä¸€ä¸ªåä¸º`oauth_access_tokens`çš„è¡¨ï¼Œå®ƒå¼•ç”¨äº†é€’å¢çš„ IDï¼Œè€Œä¸æ˜¯ UUIDã€‚ä¸ºäº†è®©å®ƒå·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»ï¼Œåˆ é™¤è¯¥åˆ—å¹¶åˆ›å»ºä¸€ä¸ªæ–°åˆ—ã€‚

> é€šå¸¸æˆ‘ä»¬åªæ˜¯æ›´æ–°è¿™ä¸ªåˆ—ï¼Œä½†æ˜¯ Laravel ä½¿ç”¨çš„`doctrine\dbal`åº“ä¸æ”¯æŒ UUIDsã€‚

1.  åˆ é™¤ç”¨æˆ· id åˆ—(å› ä¸º Laravel çš„ dbal ä¾èµ–é¡¹ä¸æ”¯æŒå°†åˆ—æ›´æ”¹ä¸º uuid) `php artisan make:migration drop_user_id_on_oauth_access_tokens`:

```
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class DropUserIdOnOauthAccessTokens extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::table('oauth_access_tokens', function (Blueprint $table) {
            $table->dropColumn('user_id');
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::table('oauth_access_tokens', function (Blueprint $table) {
            $table->dropColumn('user_id');
        });
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  æ·»åŠ è¿ç§»ä»¥å°†ç”¨æˆ· ID åˆ—æ’å…¥ä¸º UUID `php artisan make:migration update_oauth_access_tokens_with_uuids`:

```
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class UpdateOauthAccessTokensWithUuids extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::table('oauth_access_tokens', function (Blueprint $table) {
            $table->uuid('user_id')->change();
            $table->primary('user_id')->change();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::table('oauth_access_tokens', function (Blueprint $table) {
            $table->integer('user_id')->change();
        });
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‡ç½®æ•°æ®åº“(å†æ¬¡)å¹¶è¿ç§»æ–°ç»“æ„:

`docker-compose exec workspace php artisan migrate:fresh`

## [](#enable-cors)[å¯ç”¨ CORS](https://github.com/barryvdh/laravel-cors)

å®‰è£… CORS ä¾èµ–é¡¹å¹¶æ·»åŠ åˆ° Kernel.phpã€‚è¿™å°†å…è®¸æ‚¨åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å¯ç”¨ä¸ API çš„é€šä¿¡ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ª API æ—¶ï¼Œå®ƒå°†è¢«éƒ¨ç½²åˆ°`http://localhost/`ã€‚å½“æˆ‘ä»¬ä¸ºå‰ç«¯åˆ›å»ºä¸€ä¸ª React åº”ç”¨ç¨‹åº(æ˜¾ç¤ºæ•°æ®)æ—¶ï¼Œå®ƒå°†éƒ¨ç½²åˆ°`http://localhost:3000`ã€‚å› ä¸ºå®ƒåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯ä¸åŒçš„ç«¯å£ï¼Œä½ ä¼šæ”¶åˆ°ä¸€ä¸ªè·¨åŸŸå¼•ç”¨é”™è¯¯ã€‚

> åœ¨ API ç«¯ç‚¹ä¸Šå¯ç”¨ CORS å…è®¸æˆ‘ä»¬ä»»ä½•äººè®¿é—®ä»»ä½•æœåŠ¡å™¨ä¸Šçš„ APIã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æ‰“ç®—éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ç¡®ä¿å°†ä¸»æœºé™åˆ¶åœ¨æ‚¨ä¿¡ä»»çš„æœåŠ¡å™¨ä¸Š(é™¤éæ‚¨çš„ API æ˜¯å…¬å…±çš„)ã€‚

## [](#api-in-a-day)ä¸€å¤©ä¸­çš„ API

å°±è¿™æ ·ï¼Œæ‚¨çš„ API å°±å¯ä»¥ä¾›å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†ï¼

åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•ä½¿ç”¨ NextJS åˆ›å»ºæœåŠ¡å™¨ç«¯å‘ˆç°çš„ ReactJS ç®¡ç†ä»ªè¡¨æ¿ï¼Œä½¿ç”¨ Material UI è¿›è¡Œæ ·å¼åŒ–ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„ OAuth2 API è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸€å¥è¯é‡Œæœ‰å¾ˆå¤šå•è¯å’ŒæŠ€æœ¯ï¼Œæ–‡ç« æœ¬èº«ä¹Ÿå¾ˆéš¾ä¸‹å’½ï¼Œä½†æˆ‘ä¼šå°½å¯èƒ½è®©å®ƒç®€å•ã€‚ğŸ‘

æ•¬è¯·æœŸå¾…ï¼ğŸ™ˆ
è‰¯

* * *

**å‚è€ƒæ–‡çŒ®**:

*   [æ‹‰éŸ¦å°”å®‰è£…](https://laravel.com/docs/5.6/installation)
*   [http://laradock.io/documentation/](http://laradock.io/documentation/)
*   [https://medium . com/@ Steve azz/setting-up-uuids-in-laravel-5-552412 db 2088](https://medium.com/@steveazz/setting-up-uuids-in-laravel-5-552412db2088)
*   [https://github.com/webpatser/laravel-uuid](https://github.com/webpatser/laravel-uuid)
*   [å‘½åæ‚¨çš„ Laravel åº”ç”¨ç¨‹åº](https://laravel.com/docs/5.0/configuration#after-installation)
*   [ä½¿ç”¨ Laravel Passport å¿«é€Ÿåˆ›å»º JWT ä»£å¸](https://stackoverflow.com/questions/41376928/laravel-5-3-passport-jwt-authentication)
*   [æ•™ä¹‰ä¸æ”¯æŒå°† MySQL ä¸“æ æ”¹ä¸º UUID](https://laracasts.com/discuss/channels/eloquent/uuid-type-change-to-nullable-through-migrations-not-working)
*   [å¯ç”¨ CORS](https://github.com/barryvdh/laravel-cors)
*   [ä½¿ç”¨å—ä¿æŠ¤è·¯ç”±çš„ NextJS ç™»å½•ç¤ºä¾‹](https://github.com/zeit/next.js/issues/153#issuecomment-257924301)