# æ¸²æŸ“é“å…·å’Œé«˜é˜¶ç»„ä»¶

> åŸæ–‡:[https://dev . to/kayis/render-props-and-higher-order-components-5628](https://dev.to/kayis/render-props-and-higher-oder-components-5628)

*[å°é¢å›¾ç‰‡ç”±æ¶‚é¸¦æ‹ç…§è€…æ‹æ‘„ï¼Œåœ¨ Flickr ä¸Š](https://www.flickr.com/photos/graffiti-picture-taker/)*

ä¸Šå‘¨ï¼Œæˆ‘å‚åŠ äº†æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡å¼€å‘ç«èµ›ï¼Œå¹¶æäº¤äº†ä¸€ä¸ªæ— æœåŠ¡å™¨çš„å¤šäººç‚¹å‡»å™¨æ¸¸æˆã€‚

### [è¦æ˜¯èƒ½æ‹¿åˆ°ä½ çš„â¤ï¸å°±å¤ªæ£’äº†&ğŸ¦„åœ¨æˆ‘çš„å…¥é—¨å¸–ä¸Š](https://dev.to/kayis/startup-clix-serverless-pusher-contest-entry-written-in-javascript-1jai)

ä½œä¸ºå›æŠ¥ï¼Œæˆ‘ä¹Ÿæƒ³ç»™ä½ ä¸€äº›è¯€çªã€‚

* * *

å¦‚æœä½ æ˜¯ä¸€å React å¼€å‘äººå‘˜ï¼Œå¹¶ä¸”è·Ÿè¸ªäº†è¿™ä¸ªç”Ÿæ€ç³»ç»Ÿå‡ å¹´ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æœ€è¿‘å‡ºç°äº†*æ¸²æŸ“é“å…·* (RP)ï¼Œæˆ–è€…è¯´åƒå­©å­ä¸€æ ·çš„åŠŸèƒ½ã€‚

äººä»¬æ€»æ˜¯å‘Šè¯‰ä½ é«˜é˜¶å…ƒä»¶(HoC ),ç°åœ¨åˆæ˜¯è¿™ä¸ªï¼Ÿ

æˆ‘ä¹Ÿå¾ˆå›°æƒ‘ï¼Œä½†æ˜¯å¦‚æœä½ è€ƒè™‘ React ç¼–ç¨‹å®è·µï¼Œä½ ä¼šå‘ç° RPs å®Œå…¨æœ‰é“ç†ã€‚

## ä»€ä¹ˆ

æ¸²æŸ“é“å…·ä»…ä»…æ˜¯å°†åœ¨æ¸²æŸ“è°ƒç”¨ä¸­ä»¥æŸç§æ–¹å¼ä½¿ç”¨çš„é“å…·ã€‚å®ƒä»¬æ¥å—ä¸€ä¸ªéœ€è¦è¿”å›å…ƒç´ çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°è¿˜é€šè¿‡å®ƒçš„å‚æ•°è·å¾—ä¸€äº›åŠ¨æ€æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥è¢«è¿”å›çš„å…ƒç´ ä½¿ç”¨ã€‚

å®ƒä»¬æ˜¯ HoC çš„ä¾èµ–æ³¨å…¥æ›¿ä»£æ–¹æ¡ˆã€‚

## ä¸ºä»€ä¹ˆ

æ¯æ¬¡ä»åŸºäº RP çš„ç»„ä»¶åˆ›å»ºå…ƒç´ æ—¶ï¼Œéƒ½å¯ä»¥å°†ä¸åŒçš„å…ƒç´ ä¼ é€’åˆ°å®ƒçš„ RP ä¸­ã€‚HoC å°†åœ¨å®šä¹‰æ—¶è€Œä¸æ˜¯æ¸²æŸ“æ—¶åŒ…è£…ä½ çš„ç»„ä»¶ã€‚

æœ€è¿‘å‡ å¹´ï¼Œåœ¨ React ç¼–ç å®è·µä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥åˆ›å»ºåµŒå¥—å…ƒç´ å˜å¾—å¾ˆæ™®éï¼ŒRPs æ˜¯è¿™ä¸€åŸåˆ™çš„è‡ªç„¶å»¶ä¼¸ã€‚

ä¾‹å¦‚ï¼Œä½ *ä¸ä¼š*è¿™æ ·å®šä¹‰ä¸€ä¸ª`List`ç»„ä»¶:

```
const List = props => <ul>{props.data.map(i => <ListItem text={i}/>)}</ul>;
const ListItem = props  => <li>{props.text}</li>; 
// usage
<List data={["hello", "world"]}/> 
```

Enter fullscreen mode Exit fullscreen mode

å› ä¸ºç°åœ¨ä½ çš„`List`éœ€è¦çŸ¥é“`data`å’Œå“ªä¸ª`ListItem`éœ€è¦æ¸²æŸ“ã€‚

ç›¸åï¼Œä½ åº”è¯¥è¿™æ ·å®šä¹‰å®ƒ:

```
const List = props => <ul>{props.children}</ul>; const ListItem = props  => <li>{props.text}</li>; 
// usage
<List>
  {data.map(i => <ListItem text={i}/>)} </List> 
```

Enter fullscreen mode Exit fullscreen mode

å› ä¸ºç°åœ¨ä½ å¯ä»¥*å°†`data`å’Œå­ç»„ä»¶*æ³¨å…¥åˆ°`List`ä¸­ï¼Œå®ƒåªéœ€è¦æ¸²æŸ“å®ƒã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å†åŠ ä¸€ä¸ª`List`ä¸éœ€è¦çŸ¥é“çš„`ActiveListItem`ã€‚

å¸¦æœ‰ RPs çš„ç»„ä»¶å¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨çš„`List`å°†ç®€å•åœ°å‘ˆç°æ‰€æœ‰çš„`children`,å¹¶å°†æ”¶é›†çš„ä¸€äº›æ•°æ®ä¼ é€’ç»™å®ƒä»¬ã€‚

## é«˜é˜¶å–æŒ‡

HoC æ˜¯å®ç°è¿™ä¸€ç‚¹çš„å¦ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯ä»–ä»¬èƒŒåçš„æƒ³æ³•æ˜¯åˆ›å»ºä¸€ä¸ªä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨çš„`wrapped`ç»„ä»¶ï¼Œå®ƒæœ‰ä¸€äº›é¢å¤–çš„ç‰¹æ€§ã€‚

ä¸´æ—¶æå–å¯èƒ½å¦‚ä¸‹æ‰€ç¤º

```
const wrapWithFetch = Wrapped => class Fetch extends React.Component {
  state = { result: null };

  componentDidMount() {
    fetch(this.props.url)
    .then(r => r.json())
    .then(result => this.setState({result}))
  }

  render() {
    const {result} = this.state;
    return result? <Wrapped data={result}/> : null;
  }
}

// Stateless component that displays text
const Text = ({data})=> <p>{data.name}</p>; 
// Wrappted text that gets data
const FetchText = wrapWithFetch(Text);

// Usage
<FetchText url="/user/123"/> 
```

Enter fullscreen mode Exit fullscreen mode

## æ¸²æŸ“é“å…·æå–

RP ç‰ˆæœ¬å¯èƒ½æ˜¯è¿™æ ·çš„:

```
class Fetch extends React.Component {
  state = { result: null };

  componentDidMount() {
    fetch(this.props.url)
    .then(r => r.json())
    .then(result => this.setState({result}))
  }

  render() {
    const {result} = this.state;
    return result? this.props.render(result) : null;
  }
}

// usage
<Fetch url="/user/123" render={user => <p>{user.name}</p>}/> 
```

Enter fullscreen mode Exit fullscreen mode

å½“å®ƒè¢«æŒ‚è½½æ—¶ï¼Œå®ƒå°†è·å–ä¸€äº›æ•°æ®å¹¶å°†å…¶ä¼ é€’ç»™ RPã€‚

å› ä¸º`children`æ˜¯é“å…·ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨å®ƒä»¬æ¥ä»£æ›¿å®šåˆ¶é“å…·ã€‚

```
<Fetch url="/user/123">{user =>
  <p>{user.name}</p> }</Fetch> 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å°†å¯¼è‡´ä¸€ä¸ªç±»ä¼¼äº
çš„`Fetch`ç»„ä»¶

```
class Fetch extends React.Component {
  state = { result: null };

  componentDidMount() {
    fetch(this.props.url)
    .then(r => r.json())
    .then(result => this.setState({result}))
  }

  render() {
    const {result} = this.state;
    return result? this.props.children(result) : null;
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

æ­£å¦‚æ‚¨æ‰€æƒ³è±¡çš„ï¼Œç°åœ¨æ‚¨å¯ä»¥ç®€å•åœ°å°†ä»»ä½•å­èŠ‚ç‚¹å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°å°†ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®ï¼Œå¹¶ä¸”åªåœ¨æ•°æ®å¯ç”¨æ—¶æ‰è¢«å‘ˆç°ã€‚

## ç»“è®º

æ¸²æŸ“é“å…·å¯ä»¥ç”¨æ¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ›´å¤šçš„ä¾èµ–æ³¨å…¥ï¼Œä½¿å®ƒå˜å¾—æ›´åŠ çµæ´»ã€‚

æ‚¨å¯ä»¥åœ¨ RP ä¸­æ·»åŠ æ–°çš„å…ƒç´ æ¥ç®€å•åœ°æ”¹å˜æ˜¾ç¤ºçš„å†…å®¹ï¼Œä¾‹å¦‚å°†è¡¨æ ¼æ”¹ä¸ºå›¾è¡¨ç­‰ã€‚

ä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥æ›´æ”¹åŒ…è£… RP ç»„ä»¶ï¼Œè¿™æ ·å­ç»„ä»¶ç°åœ¨å°†ä»ä¸åŒçš„æºæ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯æ‚¨ä¸å¿…æ›´æ”¹å­ç»„ä»¶ï¼Œå› ä¸ºæ‚¨å¯ä»¥åŠ¨æ€åœ°å°† RP å‚æ•°ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ­£ç¡®çš„å­å±æ€§ã€‚

## ç«èµ›

å¦å¤–ï¼Œå¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« :

### [æˆ‘å¾ˆæ¬£èµä½ çš„â¤ï¸ &ğŸ¦„åœ¨æˆ‘çš„å…¥é—¨å¸–ä¸Š](https://dev.to/kayis/startup-clix-serverless-pusher-contest-entry-written-in-javascript-1jai)