# ä½¿ç”¨ BotMan æ„å»ºé¢„è®¢èŠå¤©æœºå™¨äºº

> åŸæ–‡:[https://dev . to/dev kiran/building-a-salon-booking-chatbot-with-laravel-and-botman-1250](https://dev.to/devkiran/building-a-salon-booking-chatbot-with-laravel-and-botman-1250)

BotMan æ˜¯ PHP æœ€æµè¡Œçš„èŠå¤©æœºå™¨äººå¼€å‘æ¡†æ¶ã€‚æ‚¨å¯ä»¥åœ¨ç°æœ‰çš„ä»£ç åº“ä¸­æˆ–ä»»ä½• PHP æ¡†æ¶ä¸­ä½¿ç”¨ BotManã€‚

æœ‰ä¸åŒçš„ chatbot å¼€å‘æ¡†æ¶å¯ç”¨äº Node Jsã€Pythonã€‚BotMan æ˜¯å”¯ä¸€ä¸€ä¸ªçœŸæ­£å¸®åŠ©å¼€å‘è€…ä½¿ç”¨ PHP å¼€å‘èŠå¤©æœºå™¨äººçš„ PHP æ¡†æ¶ã€‚

å¦‚æœä½ æ˜¯ä¸€ä¸ª Laravel å¼€å‘è€…ï¼ŒBotMan Studio æ˜¯ä½ æ­£åœ¨å¯»æ‰¾çš„ä¸œè¥¿ã€‚BotMan Studio æ˜¯ BotMan å’Œ Laravel çš„æ†ç»‘ç‰ˆæœ¬ã€‚

å¦‚ä½•ä½¿ç”¨æœºå™¨äººåˆ›å»ºèŠå¤©æœºå™¨äººï¼Ÿ

æˆ‘ä»¬æ¥çœ‹çœ‹ BotMan Studioï¼Œä¸ºç½‘ç«™æ­å»ºä¸€ä¸ªç®€å•çš„æ²™é¾™é¢„çº¦ chatbotã€‚

# å®‰è£…å¹¶è®¾ç½® BotMan Studio

é¦–å…ˆï¼Œç¡®ä¿æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£…äº† composerã€‚ç°åœ¨ä½¿ç”¨ Composer ä¸‹è½½ BotMan å®‰è£…ç¨‹åºã€‚

```
composer global require "botman/installer" 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å°†åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£… BotMan Studioã€‚

ç¡®ä¿æ”¾ç½®$HOME/ã€‚$PATH ä¸­çš„ composer/vendor/bin ç›®å½•(æˆ–æ‚¨çš„æ“ä½œç³»ç»Ÿçš„ç­‰æ•ˆç›®å½•),ä»¥ä¾¿æ‚¨çš„ç³»ç»Ÿå¯ä»¥æ‰¾åˆ° botman å¯æ‰§è¡Œæ–‡ä»¶ã€‚

åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥â€œbotman â€,æŸ¥çœ‹å®‰è£…æ˜¯å¦æ­£å¸¸ã€‚å¦‚æœä½ èƒ½çœ‹åˆ°ç±»ä¼¼ä¸‹å›¾çš„è¾“å‡ºï¼Œé‚£ä¹ˆ BotMan Studio å®‰è£…æ˜¯æˆåŠŸçš„ã€‚

# åˆ›å»ºæ–°çš„èŠå¤©æœºå™¨äººé¡¹ç›®

ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ BotMan Studio æ¥åˆ›å»ºæ–°çš„èŠå¤©æœºå™¨äººã€‚æ‚¨å¯ä»¥ä½¿ç”¨â€œbotman newâ€å‘½ä»¤åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ BotMan Studio å®‰è£…ã€‚

```
botman new salon 
```

Enter fullscreen mode Exit fullscreen mode

ä¸Šé¢çš„å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸ºâ€œsalonâ€çš„æ–°ç›®å½•ï¼Œå…¶ä¸­å®‰è£…äº† BotMan Studioï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº† BotMan çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚

# æµ‹è¯•å®‰è£…å·¥ç¨‹

ç°åœ¨ä½¿ç”¨
å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```
cd salon
php artisan serve 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å°†åœ¨ [http://127.0.0.1:8000](http://127.0.0.1:8000) å¯åŠ¨å¼€å‘æœåŠ¡å™¨

å¦‚æœå®‰è£…æ²¡é—®é¢˜ï¼Œæ‚¨å¯ä»¥çœ‹åˆ° Botman çš„æ¬¢è¿é¡µé¢ã€‚

ç‚¹å‡»é“¾æ¥â€œTinkerâ€ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥å°è¯•ä¸€ä¸ªéå¸¸ç®€å•çš„èŠå¤©æœºå™¨äººã€‚å¯¹æœºå™¨äººè¯´â€œå—¨â€ï¼Œæœºå™¨äººä¼šå›å¤â€œä½ å¥½ï¼â€ã€‚

[![BotMan chatbot development](../Images/fefb8e56d40cb96925388d47c15f9d87.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--IRnZtgvY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://preview.ibb.co/gq6g0U/qmrwa0sunw73g6upzx3s.png)

å¹²å¾—å¥½ã€‚ç°åœ¨ï¼Œæ‚¨å·²ç»ä¸ºæ„å»ºç¬¬ä¸€ä¸ªèŠå¤©æœºå™¨äººåšå¥½äº†ä¸€åˆ‡å‡†å¤‡ã€‚

# å®‰è£… web é©±åŠ¨ç¨‹åº

BotMan ä¸ºå¼€å‘è€…æä¾›äº†è®¸å¤šé©±åŠ¨ç¨‹åºã€‚é©±åŠ¨ç¨‹åºå¸®åŠ©æˆ‘ä»¬å°†æœºå™¨äººä¸ Facebook Messengerã€Slackã€Telegramã€Twilioã€Web ç­‰æ¶ˆæ¯æ¸ é“è¿æ¥èµ·æ¥ã€‚

å› ä¸ºæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªåŸºäº web çš„èŠå¤©æœºå™¨äººï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®‰è£… web é©±åŠ¨ç¨‹åºã€‚

```
php artisan botman:install-driver web 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ WebDriver å°†èŠå¤©æœºå™¨äººæ·»åŠ åˆ°æˆ‘ä»¬çš„ç½‘ç«™ï¼Œæˆ–è€…ä½¿ç”¨ APIã€‚Web é©±åŠ¨ç¨‹åºé™„å¸¦äº†ç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ APIã€‚è¿™æœ‰åŠ©äºæˆ‘ä»¬åˆ©ç”¨ WebDriver APIs æ„å»ºè‡ªå·±çš„èŠå¤©ç•Œé¢ã€‚

BotMan é™„å¸¦äº†ä¸€ä¸ªå¯ä»¥å¼€ç®±å³ç”¨çš„ web å°éƒ¨ä»¶ã€‚æˆ‘ä»¬å¯ä»¥å°† Javascript ç‰‡æ®µåŒ…å«åˆ°æˆ‘ä»¬çš„æ¬¢è¿è§†å›¾ä¸­(welcome.blade.php)

```
<script src='https://cdn.jsdelivr.net/npm/botman-web-widget@0/build/js/widget.js'></script> 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨ï¼Œåˆ·æ–°æ‚¨çš„é¡µé¢ï¼Œæ‚¨å¯ä»¥åœ¨é¡µé¢çš„å³ä¸‹è§’çœ‹åˆ°èŠå¤©å°éƒ¨ä»¶ã€‚å¯¹æœºå™¨äººè¯´â€œå—¨â€ï¼Œæœºå™¨äººä¼šå›å¤â€œä½ å¥½ï¼â€ã€‚å°±æ˜¯è¿™æ ·ã€‚

[![BotMan chat widget](../Images/d534eb703b2dce5e40fba5b0ca318cf1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--G8HVLosI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://preview.ibb.co/gOGQS9/yafe5vs55wpe1kzvbzts.png)

åœ¨å¼€å§‹ä½¿ç”¨ BotMan Studio æ„å»ºèŠå¤©æœºå™¨äººä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ ¸å¿ƒæ¦‚å¿µéœ€è¦å­¦ä¹ â€”â€”å¬åˆ°æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯ã€‚

åƒä»»ä½•å…¶ä»– web åº”ç”¨ç¨‹åºä¸€æ ·ï¼Œchatbot æ¥æ”¶ä¸€äº›è¯·æ±‚ï¼Œå¤„ç†å®ƒå¹¶å°†å“åº”å‘é€å›é€šé“(Webã€Messengerã€Slack ç­‰)ã€‚

# å¬åˆ°æ¶ˆæ¯

```
$botman = resolve('botman');

$botman->hears('Hi', function ($bot) {
    $bot->reply('Hello!');
}); 
```

Enter fullscreen mode Exit fullscreen mode

ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒä¼šåœ¨ä¼ å…¥æ¶ˆæ¯çš„ä»»ä½•åœ°æ–¹ç›‘å¬â€œHiâ€æˆ–â€œHelloâ€ã€‚

```
$botman = resolve('botman');

$botman->hears('._(Hi|Hello)._', function ($bot) {
    $bot->reply('Hello!');
}); 
```

Enter fullscreen mode Exit fullscreen mode

ä»£æ›¿é—­åŒ…ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªç±»å’Œæ–¹æ³•ï¼Œå¦‚æœå…³é”®å­—åŒ¹é…ï¼Œå®ƒä»¬å°†è¢«è°ƒç”¨ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœç”¨æˆ·è¯´â€œå—¨â€ï¼Œå°†è°ƒç”¨ startConversation æ–¹æ³•ã€‚

```
$botman = resolve('botman');

$botman->hears('._(Hi|Hello)._', BotManController::class.'@startConversation'); 
```

Enter fullscreen mode Exit fullscreen mode

# å‘é€æ¶ˆæ¯

æ‚¨å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ BotMan å‘é€æ¶ˆæ¯ã€‚æœºå™¨äººå¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼å‘é€ä¿¡æ¯â€”â€”æ–‡æœ¬ã€æŒ‰é’®ã€é™„ä»¶ã€é€šç”¨æ¨¡æ¿ç­‰ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç”¨ä¸¤ä¸ªæŒ‰é’®å‘é€çŸ­ä¿¡ã€‚

```
$botman = resolve('botman');

$question = Question::create('Do you agree with me?')
    ->callbackId('agree')
    ->addButtons([
        Button::create('Yes')->value('yes'),
        Button::create('No')->value('no'),
    ]);

$botman->ask($question, function(Answer $answer) {

}); 
```

Enter fullscreen mode Exit fullscreen mode

# èŠå¤©æœºå™¨äººå¯¹è¯æµç¨‹

æˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªç®€å•çš„æ²™é¾™é¢„è®¢èŠå¤©æœºå™¨äººï¼Œå¸®åŠ©ç½‘ç«™è®¿é—®è€…é€šè¿‡èŠå¤©æœºå™¨äººä»ä»–ä»¬çš„ç½‘ç«™é¢„è®¢æ²™é¾™æœåŠ¡ã€‚

æ¯ä¸ªèŠå¤©æœºå™¨äººå¿…é¡»æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è¯æµã€‚è¿™æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºçš„èŠå¤©æœºå™¨äººçš„é¢„æœŸå¯¹è¯æµã€‚

*   æ¬¢è¿æ¥è®¿è€…
*   è¯¢é—®å§“åã€ç”µå­é‚®ä»¶å’Œæ‰‹æœºå·ç 
*   æç¤ºè®¿é—®è€…é€‰æ‹©ä¸€é¡¹æœåŠ¡
*   æç¤ºè®¿é—®è€…é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´æ®µ
*   æ˜¾ç¤ºé¢„è®¢ä¿¡æ¯

# å»ºç«‹èŠå¤©æœºå™¨äººå¯¹è¯æ¡†

ç°åœ¨æ‰“å¼€ routes/botman.php å¹¶æ›´æ”¹å®ƒï¼Œä»¥ä¾¿å½“æœ‰äººè¯´â€œå—¨â€æˆ–â€œä½ å¥½â€æ—¶ï¼ŒBotManController ä¸­çš„ startConversation æ–¹æ³•å°†è¢«è°ƒç”¨ã€‚

```
<?php

use App\Http\Controllers\BotManController;

$botman = resolve('botman');

$botman->hears('._(Hi|Hello)._', BotManController::class.'@startConversation'); 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ boardingConversation ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è¯ç±»

```
php artisan botman:make:conversation OnboardingConversation 
```

Enter fullscreen mode Exit fullscreen mode

ä¸Šé¢çš„å‘½ä»¤å°†åœ¨ app/Http/Conversations/
åˆ›å»º OnboardingConversation ç±»

```
<?php

namespace App\Http\Conversations;

use BotMan\BotMan\Messages\Conversations\Conversation;

class OnboardingConversation extends Conversation
{
    public function run()
    {
        //
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

è®©æˆ‘ä»¬çœ‹çœ‹ä½äº app/Http/Controllers/çš„ BotManController ç±»ï¼Œå¹¶æ›´æ–°ä»£ç ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä½¿ç”¨æˆ‘ä»¬æ–°çš„ OnboardingConversation ç±»ã€‚

```
<?php

namespace App\Http\Controllers;

use BotMan\BotMan\BotMan;
use Illuminate\Http\Request;
use App\Http\Conversations\OnboardingConversation;

class BotManController extends Controller
{
    public function handle()
    {
        $botman = app('botman');

        $botman->listen();
    }

    public function tinker()
    {
        return view('tinker');
    }

    public function startConversation(BotMan $bot)
    {
        $bot->startConversation(new OnboardingConversation());
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æ‰“å¼€ conversation ç±» OnboardingConversationã€‚å®ƒæ‰©å±•äº†æŠ½è±¡ç±»å¯¹è¯ã€‚run æ–¹æ³•æ˜¯å¯¹è¯çš„èµ·ç‚¹ï¼Œget ä¼šç«‹å³æ‰§è¡Œã€‚

```
<?php

namespace App\Http\Conversations;

use BotMan\BotMan\Messages\Conversations\Conversation;

class OnboardingConversation extends Conversation
{
    public function run()
    {
        //
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

## è¯¢é—®å§“åã€é‚®ç®±å’Œæ‰‹æœº

è®©æˆ‘ä»¬è¯·æ¥è®¿è€…è¾“å…¥ä»–/å¥¹çš„åå­—ã€‚è¿™æ˜¯ä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ã€‚

```
<?php

namespace App\Http\Conversations;

use BotMan\BotMan\Messages\Incoming\Answer;
use BotMan\BotMan\Messages\Conversations\Conversation;

class OnboardingConversation extends Conversation
{
    public function askName()
    {
        $this->ask('What is your name?', function(Answer $answer) {
            $this->say('Nice to meet you '. $answer->getText());
        });
    }

    public function run()
    {
        $this->askName();
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å½“å¯¹è¯å¼€å§‹æ—¶ï¼Œrun æ–¹æ³•å°†è°ƒç”¨ askName æ–¹æ³•ã€‚åœ¨ askName ä¸­ï¼Œå®ƒä½¿ç”¨â€œaskâ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†åœ¨èŠå¤©æœºå™¨äººä¸­è¾“å‡ºä¸€ä¸ªé—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨$answer->getText()è·å–ç”¨æˆ·å“åº”ã€‚

ç°åœ¨æœºå™¨äººæƒ³é—®ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæ–¹æ³•â€”â€”ask email()å’Œ askMobile()ã€‚

```
public function askEmail()
{
    $this->ask('What is your email?', function(Answer $answer) {

        $validator = Validator::make(['email' => $answer->getText()], [
            'email' => 'email',
        ]);

        if ($validator->fails()) {
            return $this->repeat('That doesn\'t look like a valid email. Please enter a valid email.');
        }

        $this->bot->userStorage()->save([
            'email' => $answer->getText(),
        ]);

        $this->askMobile();
    });
} 
```

Enter fullscreen mode Exit fullscreen mode

æœ‰ä¸€äº›æœ‰è¶£çš„äº‹æƒ…éœ€è¦æ³¨æ„ã€‚

é¦–å…ˆï¼Œæˆ‘ä½¿ç”¨ Laravel éªŒè¯æ¥éªŒè¯ç”µå­é‚®ä»¶ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼ŒèŠå¤©æœºå™¨äººä¼šæç¤ºç”¨æˆ·è¾“å…¥æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ã€‚â€œé‡å¤â€æ–¹æ³•å°†å†æ¬¡è¯¢é—®æœ€åä¸€ä¸ªé—®é¢˜ã€‚

```
$this->repeat('That doesn\'t look like a valid email. Please enter a valid email.'); 
```

Enter fullscreen mode Exit fullscreen mode

userStorage æ–¹æ³•é¡¾åæ€ä¹‰å°±æ˜¯ä¿å­˜å½“å‰èŠå¤©æœºå™¨äººçš„ç”¨æˆ·ä¿¡æ¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ userStorage æ–¹æ³•æ¥å­˜å‚¨é¢„è®¢ä¿¡æ¯ã€‚

```
$this->bot->userStorage()->save([
    'name' => 'Your name here',
]); 
```

Enter fullscreen mode Exit fullscreen mode

æœºå™¨äººä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°é—®é—®é¢˜ã€‚è¿™æ˜¯å®Œæ•´çš„ä»£ç ã€‚

```
<?php

namespace App\Http\Conversations;

use Validator;
use BotMan\BotMan\Messages\Incoming\Answer;
use BotMan\BotMan\Messages\Outgoing\Question;
use BotMan\BotMan\Messages\Outgoing\Actions\Button;
use BotMan\BotMan\Messages\Conversations\Conversation;

class OnboardingConversation extends Conversation
{
    public function askName()
    {
        $this->ask('What is your name?', function(Answer $answer) {
            $this->bot->userStorage()->save([
                'name' => $answer->getText(),
            ]);

            $this->say('Nice to meet you '. $answer->getText());
            $this->askEmail();
        });
    }

    public function askEmail()
    {
        $this->ask('What is your email?', function(Answer $answer) {

            $validator = Validator::make(['email' => $answer->getText()], [
                'email' => 'email',
            ]);

            if ($validator->fails()) {
                return $this->repeat('That doesn\'t look like a valid email. Please enter a valid email.');
            }

            $this->bot->userStorage()->save([
                'email' => $answer->getText(),
            ]);

            $this->askMobile();
        });
    }

    public function askMobile()
    {
        $this->ask('Great. What is your mobile?', function(Answer $answer) {
            $this->bot->userStorage()->save([
                'mobile' => $answer->getText(),
            ]);

            $this->say('Great!');
        });
    }

    public function run()
    {
        $this->askName();
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

è®©æˆ‘ä»¬è¯•è¯•æˆ‘ä»¬çš„èŠå¤©æœºå™¨äººï¼Œçœ‹çœ‹æ˜¯å¦å¯è¡Œã€‚è¿›å…¥ [http://127.0.0.1:8000](http://127.0.0.1:8000) ï¼Œåˆ·æ–°é¡µé¢ï¼Œå‘é€â€˜Helloâ€™å¼€å§‹å¯¹è¯ã€‚

[![Botman Booking Chatbot](../Images/c85fc1375c3bbdf010d0ffc434e0de3c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Pze0-6qq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://image.ibb.co/j0zC79/jhxwnrhxl8lqdsbhypue.png)

## æç¤ºè®¿å®¢é€‰æ‹©å…¶ä¸­ä¸€é¡¹æœåŠ¡

ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸€æ¬¡èŠå¤©æœºå™¨äººå°†è¦æ±‚ç”¨æˆ·é€‰æ‹©ä¸€é¡¹æœåŠ¡ã€‚å‡è®¾æ²™é¾™æä¾› 3 é¡¹æœåŠ¡â€”â€”ç¾å‘ã€æ°´ç–—ã€ç¾å®¹ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ç±» SelectServiceConversation

```
php artisan botman:make:conversation SelectServiceConversation 
```

Enter fullscreen mode Exit fullscreen mode

å½“æˆ‘ä»¬å»ºç«‹è¶Šæ¥è¶Šå¤šçš„å¯¹è¯æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å¯¹è¯å½¼æ­¤è”ç³»èµ·æ¥ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½• Conversation ç±»ä¸­ä½¿ç”¨$ this-> bot-> start conversation(new another conversation())æ–¹æ³•å°†å…¶ä¸å¦ä¸€ä¸ªä¼šè¯è¿æ¥èµ·æ¥ã€‚

æ‰“å¼€ OnboardingConversation å¯¹è¯ç±»ï¼Œå¹¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹ã€‚

```
public function askMobile()
{
    $this->ask('Great. What is your mobile?', function(Answer $answer) {
        $this->bot->userStorage()->save([
            'mobile' => $answer->getText(),
        ]);

        $this->say('Great!');

        $this->bot->startConversation(new SelectServiceConversation()); // Trigger the next conversation
    });
} 
```

Enter fullscreen mode Exit fullscreen mode

BotMan æä¾›äº†å¾ˆé…·çš„æ–¹æ³•æ¥è¯¢é—®å¤šé¡¹é€‰æ‹©é—®é¢˜â€”â€”é—®é¢˜å’ŒæŒ‰é’®ç±»ã€‚

```
<?php

namespace App\Http\Conversations;

use BotMan\BotMan\Messages\Incoming\Answer;
use BotMan\BotMan\Messages\Outgoing\Question;
use BotMan\BotMan\Messages\Outgoing\Actions\Button;
use BotMan\BotMan\Messages\Conversations\Conversation;

class SelectServiceConversation extends Conversation
{
    public function askService()
    {
        $question = Question::create('What kind of Service you are looking for?')
            ->callbackId('select_service')
            ->addButtons([
                Button::create('Hair')->value('Hair'),
                Button::create('Spa')->value('Spa'),
                Button::create('Beauty')->value('Beauty'),
            ]);

        $this->ask($question, function(Answer $answer) {
            if ($answer->isInteractiveMessageReply()) {
                $this->bot->userStorage()->save([
                    'service' => $answer->getValue(),
                ]);
            }
        });
    }

    public function run()
    {
        $this->askService();
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

isInteractiveMessageReply æ–¹æ³•æ£€æµ‹ç”¨æˆ·æ˜¯å¦ä¸æ¶ˆæ¯è¿›è¡Œäº†äº¤äº’å¹¶å•å‡»äº†æŒ‰é’®æˆ–åªæ˜¯è¾“å…¥äº†æ–‡æœ¬ã€‚

è®©æˆ‘ä»¬è¯•è¯•æˆ‘ä»¬çš„èŠå¤©æœºå™¨äººï¼Œçœ‹çœ‹æ˜¯å¦å¯è¡Œã€‚è¿›å…¥ [http://127.0.0.1:8000](http://127.0.0.1:8000) ï¼Œåˆ·æ–°é¡µé¢ï¼Œå‘é€â€˜Helloâ€™å¼€å§‹å¯¹è¯ã€‚

[![](../Images/8730d95266650e12f329aa4aef8421b4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3_O448VN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://image.ibb.co/mauen9/dfuktquf760gkx2phnhx.png)

## æç¤ºè®¿å®¢é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´æ®µ

å¤ªå¥½äº†ï¼ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„ï¼Œè®©æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªå¯¹è¯ç±»ï¼Œè¦æ±‚ç”¨æˆ·é€‰æ‹©é¢„è®¢çš„æ—¥æœŸå’Œæ—¶é—´æ®µã€‚

```
php artisan botman:make:conversation DateTimeConversation 
```

Enter fullscreen mode Exit fullscreen mode

ä¸‹é¢çš„å¯¹è¯ç±»å°†é¦–å…ˆæç¤ºç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ—¥æœŸï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæ—¶é—´æ®µï¼Œå¹¶å°†å“åº”ä¿å­˜åœ¨å½“å‰èŠå¤©æœºå™¨äººç”¨æˆ·å­˜å‚¨ä¸­ã€‚

è¿™æ˜¯å®Œæ•´çš„ä»£ç ã€‚

```
<?php

namespace App\Http\Conversations;

use Carbon\Carbon;
use BotMan\BotMan\Messages\Incoming\Answer;
use BotMan\BotMan\Messages\Outgoing\Question;
use BotMan\BotMan\Messages\Outgoing\Actions\Button;
use BotMan\BotMan\Messages\Conversations\Conversation;

class DateTimeConversation extends Conversation
{
    public function askDate()
    {
        $availableDates = [
            Carbon::today()->addDays(1),
            Carbon::today()->addDays(2),
            Carbon::today()->addDays(3)         ];

        $question = Question::create('Select the date')
            ->callbackId('select_date')
            ->addButtons([
                Button::create($availableDates[0]->format('M d'))->value($availableDates[0]->format('Y-m-d')),
                Button::create($availableDates[1]->format('M d'))->value($availableDates[1]->format('Y-m-d')),
                Button::create($availableDates[2]->format('M d'))->value($availableDates[2]->format('Y-m-d')),
            ]);

        $this->ask($question, function(Answer $answer) {
            if ($answer->isInteractiveMessageReply()) {
                $this->bot->userStorage()->save([
                    'date' => $answer->getValue(),
                ]);

                $this->askTime();
            }
        });
    }

    public function askTime()
    {
        $question = Question::create('Select a time slot')
            ->callbackId('select_time')
            ->addButtons([
                Button::create('9 AM')->value('9 AM'),
                Button::create('1 PM')->value('1 PM'),
                Button::create('3 PM')->value('3 PM'),
            ]);

        $this->ask($question, function(Answer $answer) {
            if ($answer->isInteractiveMessageReply()) {
                $this->bot->userStorage()->save([
                    'timeSlot' => $answer->getValue(),
                ]);
            }
        });
    }

    public function run()
    {
        $this->askDate();
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

ä¸è¦å¿˜è®°åœ¨ askService æ–¹æ³•ä¸­ç”¨ SelectServiceConversation è¿æ¥ DateTimeConversation ä¼šè¯ã€‚

```
$this->bot->startConversation(new DateTimeConversation()); 
```

Enter fullscreen mode Exit fullscreen mode

æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–°çš„å¯¹è¯ç±» BookingConversation å‘ç”¨æˆ·æ˜¾ç¤ºé¢„è®¢çš„è¯¦ç»†ä¿¡æ¯ã€‚

```
php artisan botman:make:conversation BookingConversation 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæ˜¯ BookingConversation ç±»

```
<?php

namespace App\Http\Conversations;

use BotMan\BotMan\Messages\Incoming\Answer;
use BotMan\BotMan\Messages\Outgoing\Question;
use BotMan\BotMan\Messages\Outgoing\Actions\Button;
use BotMan\BotMan\Messages\Conversations\Conversation;

class BookingConversation extends Conversation
{
    public function confirmBooking()
    {
        $user = $this->bot->userStorage()->find();

        $message = '-------------------------------------- <br>';
        $message .= 'Name : ' . $user->get('name') . '<br>';
        $message .= 'Email : ' . $user->get('email') . '<br>';
        $message .= 'Mobile : ' . $user->get('mobile') . '<br>';
        $message .= 'Service : ' . $user->get('service') . '<br>';
        $message .= 'Date : ' . $user->get('date') . '<br>';
        $message .= 'Time : ' . $user->get('timeSlot') . '<br>';
        $message .= '---------------------------------------';

        $this->say('Great. Your booking has been confirmed. Here is your booking details. <br><br>' . $message);
    }

    public function run()
    {
        $this->confirmBooking();
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

[![](../Images/9e3d49ca13369cbc315655545b69cf49.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jlXCJ-M---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://image.ibb.co/nM6TEp/Bot_Man_Studio.png)

# ç»“è®º

æœ¬æ•™ç¨‹çš„æºä»£ç å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°ã€‚

æˆ‘å¸Œæœ›ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰è§åœ°ã€‚

**æˆ‘ä»¬æ¥è¿çº¿**ğŸŒ

*   æˆ‘çš„åšå®¢[kirandev.com](https://www.kirandev.com/)
*   åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘
*   åœ¨ [Github](https://github.com/devkiran) ä¸Šæ‰¾åˆ°æˆ‘