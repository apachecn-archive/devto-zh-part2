# ä¸è¦æ§åˆ¶ä¸€åˆ‡ï¼ååº”å½¢å¼

> åŸæ–‡:[https://dev . to/Aral roca/don t-control-everything-react-forms-4d 9](https://dev.to/aralroca/dont-control-everything-react-forms-4d9)

åŸå¸–:[https://Aral roca . com/blog/don t-control-everything-react-forms](https://aralroca.com/blog/dont-control-everything-react-forms)

* * *

è¡¨å•å‡ ä¹æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å…¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å¿…éœ€çš„:â€œç™»å½•â€é¡µé¢ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Š React ä¸­ä¸å—æ§åˆ¶çš„è¡¨å•çš„å¥½å¤„ï¼Œä»¥åŠå¦‚ä½•å°½å¯èƒ½ç®€å•åœ°åœ¨æ¯ä¸ªè¡¨å•ä¸­é‡ç”¨å®ƒã€‚æˆ‘ä»¬å°†ä»¥ç»å…¸çš„â€œç™»å½•â€é¡µé¢ä¸ºä¾‹ã€‚

[![signIn](../Images/ba79d0f864cdb0b90f3fda0d71b4fd26.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--GRiCmtoK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://aralroca.files.wordpress.com/2018/11/signin.png%3Fw%3D960)

### å—æ§ä¸éå—æ§çš„åŒºåˆ«

è¦ç†è§£â€œä¸å—æ§â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹â€œå—æ§â€çš„å«ä¹‰ã€‚

React ä¸­çš„ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯è¯•å›¾ä½¿ç”¨ state å’Œ onChange æ–¹æ³•æ¥æ§åˆ¶è¡¨å•çš„æ¯ä¸ªå­—æ®µã€‚é€šå¸¸é€‰æ‹©è¿™ç§æ–¹å¼æ¥å…è®¸åœ¨ onSubmit æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§çŠ¶æ€ï¼Œå°½ç®¡è¿™ä¸æ˜¯è·å–å­—æ®µçš„å”¯ä¸€å’Œæœ€å¥½çš„æ–¹å¼ã€‚

**å—æ§å­—æ®µ**

```
<form onSubmit={onSignIn}>

      <div>
        <input
          required
          value={this.state.username}
          onChange={e => this.setState({ username: e.target.value )}
          name="username"
          type="text"
          placeholder={userNamePlaceholder}
        />
      </div>

      <div>
        <input
          value={this.state.password}
          onChange={e => this.setState({ password: e.target.value )}
          name="password"
          type="password"
          placeholder={passwordPlaceholder}
        />
      </div>

      <button type="submit">
         Sign In
      </button>
  </form> 
```

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ onSignIn æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨çŠ¶æ€ã€‚

```
onSignIn = () => {
  const { username, password } = this.state;
  // ...
} 
```

è¿™äº›å­—æ®µæ˜¯å—æ§çš„ï¼Œå› ä¸ºæ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œè¾“å…¥ä¸­å‘ˆç°çš„æ–‡æœ¬ä¹Ÿä¼šæ”¹å˜ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡ç”¨æˆ·é”®å…¥æ—¶ï¼ŒonChange äº‹ä»¶éƒ½ä¼šè¢«è§¦å‘ä»¥ä¿å­˜æ–°çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬é”®å…¥ 15 ä¸ªå­—ç¬¦çš„ç”¨æˆ·åå’Œ 8 ä¸ªå­—ç¬¦çš„å¯†ç ï¼›24 ä¸ª react æ¸²æŸ“å°†åœ¨å¼•æ“ç›–ä¸‹å‘ç”Ÿ(æ¯ä¸ªè§’è‰²ä¸€ä¸ª+ç¬¬ä¸€ä¸ªæ¸²æŸ“ä¸€ä¸ª)ã€‚

å¦‚æœåœ¨æäº¤è¡¨å•ä¹‹å‰ä½¿ç”¨çŠ¶æ€ï¼Œè¿™ç§å—æ§è¡Œä¸ºæ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼ŒåŠ¨æ€éªŒè¯å­—æ®µã€‚å¦åˆ™ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æäº¤è¡¨å•åä½¿ç”¨æ‰€æœ‰å­—æ®µï¼Œé‚£ä¹ˆä¸åŠ æ§åˆ¶ä¼šæ›´æœ‰ç”¨ã€‚

ä¸å—æ§åˆ¶çš„å­—æ®µæ˜¯åœ¨æ²¡æœ‰ååº”çŠ¶æ€çš„æƒ…å†µä¸‹ç¼–å†™çš„è‡ªç„¶æ–¹å¼:

**ä¸å—æ§åˆ¶çš„è¾“å…¥**

```
<form onSubmit={onSignIn}>

      <div>
        <input
          required
          name="username"
          type="text"
          placeholder={userNamePlaceholder}
        />
      </div>

      <div>
        <input
          name="password"
          type="password"
          placeholder={passwordPlaceholder}
        />
      </div>

      <button type="submit">
         Sign In
      </button>
  </form> 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›½å®¶æ˜¯ä¸å¿…è¦çš„ã€‚æˆ‘ä»¬éœ€è¦åœ¨äº‹ä»¶ onSubmit ä¸Šä½¿ç”¨è¿™äº›å­—æ®µï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦åœ¨æ¯æ¬¡æ”¹å˜ React çŠ¶æ€æ—¶éƒ½å­˜å‚¨è¿™äº›å­—æ®µï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨äº‹ä»¶ä¸­æ‹¥æœ‰äº†è¿™äº›å­—æ®µã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªä¸ºè¿™ä¸ªç»„ä»¶åšä¸€æ¬¡ç®€å•çš„æ¸²æŸ“:ç¬¬ä¸€æ¬¡æ¸²æŸ“ã€‚

åœ¨ onSignIn å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ event.target.
ä¸­æ‰¾åˆ°ç”¨æˆ·åå’Œå¯†ç å­—æ®µ

```
onSignIn = (event) => {
      const [username, password] = Array.prototype
          .slice.call(event.target)
          .map(field => field.value)

  // ...
} 
```

ç„¶è€Œï¼Œå°½ç®¡æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œäº†ä¸€äº›ç®€åŒ–ï¼Œä½†åœ¨æ¯ä¸ªè¡¨å• submit ä¸­é‡å¤è¿™ä¸ª Array.prototype.slice.call ä»ç„¶å¾ˆéš¾çœ‹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ”¹è¿›ã€‚

### æ”¹å–„ä¸å—æ§åˆ¶çš„æ–¹å¼

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç®€åŒ–æ¯ä¸ªâ€œæäº¤â€äº‹ä»¶çš„é€»è¾‘ï¼Œä»¥é¿å…è¿ç»­æŸ¥æ‰¾ event.target ä¸­çš„å­—æ®µçš„éœ€è¦

```
onSignIn = ({ username, password }) => {
 // ...
} 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç›´æ¥æä¾›å­—æ®µä½œä¸ºå‚æ•°ã€‚å½“å…³é”®å­—æ˜¯ name å±æ€§æ—¶ï¼Œæ­¤å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰è¡¨å•å­—æ®µçš„å¯¹è±¡ã€‚

ä¸ºäº†å®ç°æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¡¨å•æ ‡è®°æ›¿æ¢ä¸ºæˆ‘ä»¬çš„ä¸ªäººç»„ä»¶:

[![form](../Images/fb02679d4fd0446c5e4edd74f569793a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_bhvHyN---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://aralroca.files.wordpress.com/2018/11/form.png%3Fw%3D960)

æˆ‘ä»¬çš„å¯é‡ç”¨ä¸ªäººè¡¨å•ç»„ä»¶å¯ä»¥æ˜¯:

```
function Form({ children, onSubmit, ...restOfProps }) {
  const onSubmitAllFields = useCallback(event => {
    event.preventDefault()
    event.stopPropagation()

    const fields = Array.prototype.slice.call(event.target)
      .filter(field => field.name)
      .reduce((form, { name, value }) => ({
        ...form,
        [name]: typeof value === 'string'
          ? value.trim()
          : value,
      }), {})

    onSubmit(fields)
  }, [onSubmit])

  return (
    <form {...restOfProps} onSubmit={onSubmitAllFields}>
      {children}
    </form>
  )
}

export default memo(Form) 
```

å› æ­¤ï¼Œæˆ‘ä»¬æ­£åœ¨ç§»åŠ¨æˆ‘ä»¬åœ¨è¡¨å•ä¸­ç»å¸¸ä½¿ç”¨çš„é‡å¤ä»£ç : **preventDefault** ï¼Œ **stopPropagation** ï¼Œ **extract å­—æ®µ** + **trim å­—ç¬¦ä¸²å­—æ®µ**ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§æ–°æ–¹æ³•ï¼Œåªéœ€æ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼Œä»â€œå½¢å¼â€åˆ°â€œå½¢å¼â€ã€‚

> **æ³¨æ„**:æˆ‘æ­£åœ¨ä½¿ç”¨æ–°çš„ hooks API(æè®®)ï¼Œå°½ç®¡å®ƒä¹Ÿå¯ä»¥è¢«å†™æˆä¸€ä¸ªç±»ç»„ä»¶ã€‚

### ç»“è®º

ä¸¤ç§æ–¹æ³•ï¼›å—æ§å½¢å¼å’Œéå—æ§å½¢å¼å› ä¸ºä¸åŒçš„åŸå› è€Œå¾ˆæ£’ã€‚æˆ‘ä»¬å¿…é¡»çŸ¥é“åŒºåˆ«ï¼Œä»¥ä¾¿ä¸ºä»»ä½•åœºåˆé€‰æ‹©æœ€å¥½çš„ã€‚æˆ‘çš„å»ºè®®æ˜¯:é€šå¸¸ä½¿ç”¨æ— æ§åˆ¶ï¼Œé™¤éä½ çœŸçš„éœ€è¦çŠ¶æ€æ¥åšåŠ¨æ€æ£€æŸ¥æˆ–è€…åŠ¨æ€æ”¹å˜æ¯ä¸ªè¾“å…¥çš„æ–‡æœ¬ã€‚

> è¿™æ˜¯æˆ‘å¤„ç†è¡¨æ ¼çš„é¦–é€‰æ–¹å¼ã€‚å¦‚æœæˆ‘ä¸éœ€è¦å€¼è¢«æ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸æ§åˆ¶å®ƒ[![ğŸ‘](../Images/60ca6372ec746e8f077d7739b4c3aed7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ZZkWC9qn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s0.wp.com/wp-content/mu-plugins/wpcom-smileys/twemoji/2/72x72/1f44d.png)[https://t.co/0TGb3Lrs9Y](https://t.co/0TGb3Lrs9Y)
> 
> â€”è‚¯ç‰¹Â·cÂ·å¤šå…¹([@è‚¯ç‰¹Â·å¤šå…¹](https://dev.to/kentcdodds) ) [8 de julio de 2018](https://twitter.com/kentcdodds/status/1015954912075644930?ref_src=twsrc%5Etfw)

å¦‚æœæ‚¨æƒ³å°è¯•è¡¨å•ç»„ä»¶ï¼Œæˆ‘åœ¨ npm ä¸­æ·»åŠ äº†:

```
npm install react-form-uncontrolled --save 
```

å›è´­:[https://github.com/SylcatOfficial/react-form-uncontrolled](https://github.com/SylcatOfficial/react-form-uncontrolled)