# 做出架构决策:一个活生生的例子

> 原文：<https://dev.to/hudsonburgess7/making-an-architectural-decision-a-live-example-1o03>

我写这篇文章是为了理清我的思路，所以我想和大家分享一下。

框架:Angular + ngrx

场景:您的应用程序能够生成特定类型的报告。任何用户都可以运行并查看该报告的摘要，但他们需要支付 *x* 的金额才能看到全部内容。

这里需要做两件事:

1.  用户必须付费才能解锁特定的报告。
2.  如果该事务成功完成，则需要将报告标记为“解锁”

我们可以按顺序做这些。进行支付 API 调用，然后进行解锁调用。但是这可能涉及到复制一些现有的逻辑，并且可能迫使我创建一些笨拙的“支付+报告”对象。

我们也可以让其中一个动作产生副作用。但是哪一个呢？

*   付费是解锁报告的“前”副作用吗？
*   还是解锁举报是付费举报的“后”副作用？

前者似乎更有意义。最终目标是解锁一个报表，而不是花钱，所以我们假设解锁报表是这里的“主要”控制流。

但是付款*必须*成功，报告才能解锁。那么真的是副作用吗？*副作用不应该独立于引发它们的事物吗？*也许副作用的想法并没有那么好。

<pause and="" think="" for="" a="" few="" minutes...=""></pause>

嗯，我有`@ngrx/effects`。尽管我讨厌把它用作 API 包装器(请[停止使用 ngrx/effects 作为包装器)，但这是一种从不同服务组合 API 调用的有用方式。仅仅因为这个库的名字中有“效果”并不意味着*有*被严格用于副作用。我们现在当然不会把它限制在那种用途上。(也许将来我应该用一个不同的名字作为`@ngrx/effects`的别名，这样我们的特殊用法会更有意义？)](https://medium.com/@m3po22/stop-using-ngrx-effects-for-that-a6ccfe186399)

我想我会那样做的。使用现有的支付逻辑，编写一个`unlock()`服务方法，然后使用`@ngrx/effects`将它们链接在一起。

* * *

*受 DHH[《关于写好软件》](https://www.youtube.com/playlist?list=PL9wALaIpe0Py6E_oHCgTrD6FvFETwJLlx)视频系列*的启发