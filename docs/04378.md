# node å’Œ vue æ­å»ºçš„ç½‘ç«™ï¼Œæ¨¡ä»¿ Twitter çš„ UI å’ŒåŠŸèƒ½

> åŸæ–‡:[https://dev.to/jayzang/twitter-web-like-1i5m](https://dev.to/jayzang/twitter-web-like-1i5m)

> [é¡¹ç›®é“¾æ¥](https://github.com/JayZang/Twitter-Web-Like)
> è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨[èŠ‚ç‚¹](https://nodejs.org/en/)å’Œ [Vue](https://vuejs.org/) æ­å»ºçš„ã€‚ç›®æ ‡æ˜¯å­¦ä¹  Vue æ¡†æ¶å’Œåç«¯æŠ€æœ¯æ¥å®ç°ä¸€ä¸ªæ°´ç–—ç½‘ç«™ã€‚
> 
> å›¾ç‰‡åŠç½²åçš„æ‰€æœ‰æƒåˆ©ä¿ç•™ç»™[æ¨ç‰¹](https://twitter.com/)ã€‚
> 
> æœ¬é¡¹ç›®ä½¿ç”¨çš„æŠ€æœ¯ã€å·¥å…·å’Œè½¯ä»¶åŒ…å¹¶æœªè¢« [Twitter](https://twitter.com/) å®é™…ä½¿ç”¨ã€‚
> 
> æ¬¢è¿æŠ€æœ¯äº¤æµï¼Œå¦‚æœæœ¬é¡¹ç›®æœ‰é”™è¯¯çš„ä»£ç æˆ–ç¼–ç¨‹æ¦‚å¿µï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ğŸ‘

[![Demo](../Images/0d8703f2c968a2d208e07696e5952d0c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ehm1KQp6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://github.com/JayZang/Twitter-Web-Like/blob/master/Demo.gif%3Fraw%3Dtrue)

## ä¸»ç”¨åŒ…

*   [å¿«é€’](#express)
*   [çŒ«é¼¬](#mongoose)
*   [jsonwebtoken](#jsonwebtoken)
*   è§†å›¾
*   æ­¦å¥‘ç‰¹
*   è§†å›¾-è·¯ç”±å™¨
*   é˜¿å…‹æ–¯

## æ„å»ºè®¾ç½®

å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…:(å‡è®¾å·²ç»å®‰è£…äº†[èŠ‚ç‚¹](https://nodejs.org/en/)å’Œã€NPMã€‘

```
npm install 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ [localhost:8080](http://localhost:8080/) :

çƒ­é‡è£…æœåŠ¡ï¼Œè¿™ä¸ªæ­¥éª¤åªèƒ½æ˜¾ç¤ºå‰ç«¯ï¼Œåç«¯æœåŠ¡å™¨è¿˜æ²¡æœ‰å¯åŠ¨ã€‚

```
npm run dev 
```

Enter fullscreen mode Exit fullscreen mode

è¿è¡Œ [MongoDB](https://www.mongodb.com/) çš„æœåŠ¡å™¨:(å‡è®¾å·²ç»å®‰è£…)

```
mongod --dbpath=YOUR_PATH_TO_STORE_DATA 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨**å¼€å‘**ç¯å¢ƒä¸­è¿è¡Œåç«¯æœåŠ¡å™¨ç›‘å¬ 3001 ç«¯å£æ¥å¤„ç† API è¯·æ±‚:

```
npm run start:dev 
```

Enter fullscreen mode Exit fullscreen mode

æœåŠ¡å™¨ API çš„ Uint æµ‹è¯•:

```
npm run unit 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæ‰€æœ‰çš„å•å…ƒæµ‹è¯•éƒ½é€šè¿‡äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿æ¥åˆ° [localhost:8080](http://localhost:8080/) å¹¶å¼€å§‹å·¥ä½œ(æ³¨å†Œã€ç™»å½•ç­‰)...)æˆåŠŸã€‚

ä»¥ä¸Šæ„å»ºåº”ç”¨çš„æ­¥éª¤è¶³å¤Ÿæˆ‘ä»¬å­¦ä¹ `Vue`å’Œ`Node`ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„é¡¹ç›®éƒ¨ç½²åˆ°äº‘ä¸­ï¼Œä¸‹é¢çš„æ­¥éª¤
æ˜¯å¿…éœ€çš„ã€‚

### æ†ç»‘éƒ¨ç½²

æ†ç»‘å‰ç«¯(Vue)ä»£ç :

```
npm run build 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ [localhost:3001](http://localhost:3001/) :

è¡¨ç¤ºå¦‚æœ http è¯·æ±‚ URL ä¸æ˜¯é’ˆå¯¹ API è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†å“åº”æ†ç»‘çš„å‰ç«¯é¡µé¢ã€‚

```
npm run start:dev 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨**ç”Ÿäº§**ç¯å¢ƒä¸Šè¿è¡ŒæœåŠ¡å™¨:

éƒ¨ç½²åˆ°äº‘ç«¯æ—¶ï¼Œæˆ‘ä»¬ä»¥ [Heroku](https://devcenter.heroku.com/) ä¸ºä¾‹ï¼Œ [Heroku](https://devcenter.heroku.com/) é»˜è®¤ä¼šè‡ªåŠ¨è¿è¡Œ`npm start`
ã€‚æˆ‘ä»¬åªæ˜¯è‡ªåŠ¨è·å– [Heroku](https://devcenter.heroku.com/) ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡(ä¾‹å¦‚:PORT)æ¥è®¾ç½®æˆ‘ä»¬çš„æœåŠ¡å™¨å·¥ä½œ(è¦è¿æ¥çš„
MongoDB çš„æœåŠ¡å™¨éœ€è¦è‡ªå·±é…ç½®)

```
npm start           #same as 'npm run start:prod' 
```

Enter fullscreen mode Exit fullscreen mode

å¯ä»¥åœ¨/server/config/config.json ä¸­è®¾ç½®è‡ªå®šä¹‰é…ç½®

## ç®€å•ä»‹ç»

### å¿«é€’

[å…¬æ–‡](https://expressjs.com/zh-tw/guide/routing.html)

ä½¿ç”¨ RESTful è·¯ç”±å¤„ç† http è¯·æ±‚ã€‚

```
const app = require('expess')

app.get('/', (req, res, next) => {
  res.json({
    res: 'This is GET method'
  })
})
app.post('/', (req, res, next) => {
    res.json({
      res: 'This is POST method'
    })
})
app.delete('/', (req, res, next) => {
  res.json({
    res: 'This is DELETE method'
  })
})
app.update('/', (req, res, next) => {
  res.json({
    res: 'This is UPDATE method'
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

### ç´

ä½¿ç”¨å…³ç³»æ•°æ®åº“ã€‚

æœ¬é¡¹ç›®æœ‰ä¸‰ç§å‹å·:

*   ç”¨æˆ·
*   é‚®ä»¶
*   è¯„è®º

æ¨¡å¼è®¾ç½®:

```
const userSchema = mongoose.Schema({
  posts: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Posts'
  }],
  //...
})
const postSchema = mongoose.Schema({
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Users'
  },
  comments: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Comments'
  }],
  //...
})
const commentSchema = mongoose.Schema({
  user: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Users'
  },
  target: {
    model: String,
    id: mongoose.Schema.Types.ObjectId()
  },
  //...
})

const userModel = mongoose.Model('Users', userSchema)
const postModel = mongoose.Model('Posts', postSchema)
const commentModel = mongoose.Model('Comments', commentSchema) 
```

Enter fullscreen mode Exit fullscreen mode

è·å–å¡«å……æ•°æ®:

```
userModel.findById(USER_ID)
  .then(user => {
    if (!user) {
      //...
    }

    let opt = {
      path: 'posts',
      populate: {
        path: 'comments'
      }
    }

    user.populate(opt).execPopulate()
      .then(populatedUser => {
        // Do what tou want to do
      }).
      catch(e => {
        //...
      })
  })
  .catch(e => {
    //...
  }) 
```

Enter fullscreen mode Exit fullscreen mode

### Jsonwebtoken

[å…¬æ–‡](https://github.com/auth0/node-jsonwebtoken)

åˆ›å»ºä»¤ç‰Œï¼Œ1 å°æ—¶åä½œåºŸã€‚

ä½ å¯ä»¥åœ¨ä»¤ç‰Œä¸­æ”¾å…¥ä¸€äº›æ•°æ®ï¼Œè®©æœåŠ¡å™¨çŸ¥é“è¿™ä¸ªä»¤ç‰Œçš„æ‰€æœ‰è€…å’Œä¿¡æ¯ã€‚

```
const jwt = require('jsonwebtoken')

const token = jwt.sign({
  id: USER_ID,
  access: 'auth',
  exp: Math.floor(Date.now() / 1000) + (60 * 60 * 1)
}, 'YOUR_SECRET_KEY') 
```

Enter fullscreen mode Exit fullscreen mode

ä»¤ç‰ŒéªŒè¯:

```
try {
  let data = jwt.verify(RECEIVED_TOKEN, 'YOUR_SECRET_KEY')
} catch (e) {
  // Verify fail
} 
```

Enter fullscreen mode Exit fullscreen mode

### è§†å›¾

[å…¬æ–‡](https://cn.vuejs.org/v2/guide/index.html)

ä¸‹å›¾æ˜¯ä¸€ä¸ªå®ä¾‹ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚

æˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯äº†è§£æ¯ä¸ªäº‹ä»¶ä»€ä¹ˆæ—¶å€™ä¼šè¢«è°ƒç”¨ã€‚

[![Vue component's life cycle](../Images/0b9a239f0f1503e9f977327c89e2c6f5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6M-lBymO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cn.vuejs.org/images/lifecycle.png)

å¦‚æœæˆ‘ä»¬æœ‰ç»„ä»¶éœ€è¦' userID 'çš„å±æ€§æ¥å¼‚æ­¥è·å–ç”¨æˆ·çš„ä¿¡æ¯ã€‚

å½“ç»„ä»¶è¢«å®ä¾‹åŒ–æ—¶ï¼Œå°†è°ƒç”¨`created`çš„å‡½æ•°ï¼Œé€šè¿‡å½“å‰çš„â€œç”¨æˆ·æ ‡è¯†â€è·å–ç”¨æˆ·ä¿¡æ¯ã€‚
ä½†æ˜¯å¦‚æœä¸‹ä¸€ä¸ªè·¯ç”±ä¹Ÿæœ‰è¿™ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”æœ‰ä¸åŒçš„â€œuserIDâ€å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶è¢«é‡ç”¨ï¼Œè€Œä¸æ˜¯
å†æ¬¡å®ä¾‹åŒ–ä¸€ä¸ªæ–°ç»„ä»¶ã€‚æ­¤æ—¶`created`å‡½æ•°æœªè¢«è°ƒç”¨ï¼Œæ‰€ä»¥å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`watch`
å±æ€§æ¥ç›‘æ§â€˜userIDâ€™å±æ€§æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæŒ‡ç¤ºçš„ç›®æ ‡æ”¹å˜ï¼Œæ‚¨è®¾ç½®çš„å‡½æ•°å°†è¢«è°ƒç”¨ã€‚

```
Vue.component('your-component', {
  props:['userID'],
  data: function () {
    return {
      user: null
    }
  },
  created() {
    this.getUserInfo()
  },
  watch: {
    // here is important
    'userID': 'getUserInfo'
  },
  method: {
    getUserInfo() {
      // Some http Request to get user information from server
    }
  },
  template: '<div v-if="user">{{ user.name }}</div>'
}) 
```

Enter fullscreen mode Exit fullscreen mode