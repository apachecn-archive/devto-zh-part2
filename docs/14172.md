# 改进常数的使用

> 原文:[https://dev . to/3zsforinsomnia/improving-the-use-of-constants-38cj](https://dev.to/3zsforinsomnia/improving-the-use-of-constants--38cj)

在软件中，常量一直是一个很好的模式。我一直对常数有一种“爱它然后恨它然后爱它然后…”的关系。他们觉得很有帮助，但我觉得他们做得没有我想要的多，或者说不完全是我想要的。确实有更好的办法！直到我开始重读麻省理工出版社的[《计算机程序的结构与解释》](https://mitpress.mit.edu/sites/default/files/6515.pdf)(一本很棒的读物)，我才意识到这一点。这种方式不仅可以从文件中导出常量值，还可以用一种方法对其进行检查，这种方法通常由同一个文件提供。

在详细介绍图案的区别之前，我们先来介绍一下问题。

## 为什么是常数？

我们将讨论两个我见过的用常数解决的常见问题。也就是说，实现一种伪类型，并替换字符串或数字之类的有魔力的值。在这篇文章中，我们将集中在魔术字符串，因为我发现他们特别普遍和恼人的。魔术字符串是许多人所说的代码中使用的显式字符串值的用法，如 state.view === 'some-view '(同样适用于所有情况，如 props.view，$scope.view 等)。

虽然这很明显，但实际上并不可重用。如果 state 上的属性更改了 name，则进行检查的每个实例都必须更改。同样，如果我们认为“某视图”不是一个好名字，每张支票都必须更改。

这就是为什么我们在这些情况下使用常量。如果我们有一个名为“views”的对象，并赋予它每个值的属性，那么每个属性的字符串值都可以更改，而不需要更改实际的检查。我个人发现这对于定义我的许多视图配置和状态的常量非常有用，比如 if ( view === editing ) {}，或者 if ( user.type === teacher ) {}(与 user.type === student 相对)。

## 为什么这还不够

这并不太好，就好像我们根据常量检查其值的属性名发生了变化，或者常量变量名发生了变化，我们仍然需要改变出现这种情况的每个地方。然而，我们*已经*降低了我们必须做出改变的速率，因为常数本身现在是我们可以参考的变量。也就是说，如果“老师”变成了“教育者”，我们就再也不用换每一张支票了。

这真好！通过对价值本身进行抽象，我们已经消除了两个问题来源中的一个。我们也这样做了，允许我们定义一个单一的位置，所有这种类型的常数都存在。这使得找出哪些选项已经存在，哪些是开发人员想要存在的变得更加容易。

## 我们怎样才能极大地提高常数

我们可以通过添加为我们做检查的方法来添加另一个抽象层，并在这个过程中使我们的代码更干净、更容易操作和查看，同时增加很少的开销。这对许多人来说似乎是显而易见的，但我很长时间都没有想到这样做，所以希望这能提醒一些人并教会其他人这个简单的技术。

尽可能简单地说，使用常量，但不要公开。您应该显式地定义常量(最好是作为一个“enum”对象的属性，[，就像 TypeScript 提供的](https://www.typescriptlang.org/docs/handbook/enums.html))，但是也要编写为您进行实际检查的方法。

这些方法除了确定给定的值是否等同于特定常量的值之外，不应该做任何事情。除了检查所必需的，它不应该知道或考虑给定对象的任何其他属性。这使得该方法简单，并且能够在任何情况下使用该常数，而不管被比较的对象是什么。这也意味着我们可以从一个文件中导出这个方法作为一个普通的 ES6 方法。这优于“打开”(在代码中，常量是可见地使用的)，因为我们从来不需要知道是否有常量，也不需要知道我们检查常量所针对的特定参数。

要查看不带常量、带开放常量和带抽象常量的简单示例，请查看此要点的[内容。](https://gist.github.com/3ZsForInsomnia/20b8466ea64125e8b541cbd2ddeb2e37)

使用这种方法，我们可以分别更改正在检查的属性的名称、常量的名称或常量的值，而无需更改任何其他内容。

这将适用于任何级别的检查，因为我们没有理由不能扩展它的复杂性，以涉及针对一个对象的多个属性检查，而不是一个原始的字符串值。这里重要的是所使用的抽象。

快乐抽象！