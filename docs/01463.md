# æˆ‘çš„ Ruby ä¹‹æ—…:è¿æ¥äº‹ç‰©

> åŸæ–‡:[https://dev.to/edisonywh/my-ruby-journey-hooking-things-up è”é‚¦æ”¿åºœ](https://dev.to/edisonywh/my-ruby-journey-hooking-things-up--feg)

# [](#my-ruby-journey-hooking-things-up)æˆ‘çš„ Ruby ä¹‹æ—…:å‹¾ä¸œè¥¿

æˆ‘æœ€è¿‘æ‰åˆšåˆšå¼€å§‹æˆ‘çš„ Ruby/Rails ä¹‹æ—…(å·¥ä½œä¸åˆ°ä¸€å¹´)ï¼Œæœ‰ä¸€å¤©æˆ‘é‡åˆ°äº†ç±»ä¼¼è¿™æ ·çš„äº‹æƒ…ã€‚

```
class Product
  acts_as_paranoid
  acts_as_taggable
  has_paper_trail
  monetize :price_cents
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘çŸ¥é“å®ƒä»¬æ¥è‡ª gemsï¼Œä½†æˆ‘è®¤ä¸ºå®ƒçœ‹èµ·æ¥è¶…çº§é…·ï¼Œå¹¶ä¸”çœŸçš„å¾ˆå¥½å¥‡å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘åé€€ä¸€æ­¥ï¼Œåˆ†è§£è¿™ä¸ªé—®é¢˜å¹¶é€ä¸€è§£å†³å®ƒã€‚

## [](#stop-1-initial-findings)åœæ­¢ 1:åˆæ­¥å‘ç°

æˆ‘åœ¨è¿™é‡Œå‘ç°äº†ä¸€äº›äº‹æƒ…:

*   å®ƒä»¬åªæ˜¯æ™®é€šçš„ç±»æ–¹æ³•
*   å½“æ‚¨å°†ä¸€ä¸ªæ–¹æ³•åæ”¾å…¥ç±»ä¸­æ—¶ï¼Œæ¯æ¬¡æ‚¨åˆ›å»ºå®ƒçš„æ–°å®ä¾‹æ—¶ï¼Œè¯¥æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ã€‚

ä¾‹å¦‚:

```
class Example
  puts "This gets called whenever you initiate an instance of #{self}"
end

Example.new #=> "This gets called whenever you initiate an instance of Example 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ï¼Œç°åœ¨æˆ‘çŸ¥é“å®ƒä»¬åªæ˜¯ç±»æ–¹æ³•ï¼Œæˆ‘å†³å®šä¸‹ä¸€æ­¥åº”è¯¥å†™ä¸€äº›ç±»ä¼¼çš„ä¸œè¥¿ï¼›å¯é‡ç”¨çš„ç±»æ–¹æ³•ï¼(æˆ‘è¿˜ä¸æƒ³è®¨è®º Rails å¦‚ä½•è‡ªåŠ¨åŠ è½½å®ƒ)

æˆ‘å°±è¿™æ ·å¼€å§‹äº†æˆ‘çš„æ—…ç¨‹ï¼Œç„¶åç§ï¼Œä¸‹ä¸€ä¸ªéšœç¢å‡ºç°äº†ï¼

## [](#stop-2-i-cant-share-class-methods-with-modules)Stop 2:ä¸èƒ½å’Œæ¨¡å—å…±äº«ç±»æ–¹æ³•ï¼Ÿ

*(å‰§é€:æ˜¯çš„ä½ å¯ä»¥ï¼Œæˆ‘åªæ˜¯ä¸€å¼€å§‹ä¸çŸ¥é“ï¼*)ğŸ˜›

èµ·åˆï¼Œæˆ‘è®¤ä¸ºè¿™å°†æ˜¯ä¸€ä¸ªç®€å•çš„`include Module`,å› ä¸ºæˆ‘è¢«å‘ŠçŸ¥å¯é‡ç”¨æ–¹æ³•å°±æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œï¼Œå¤©çœŸåœ°è¯•å›¾åœ¨æ¨¡å—ä¸Šå®šä¹‰ä¸€ä¸ªç±»æ–¹æ³•ï¼Œç„¶åå°†å®ƒåŒ…å«åœ¨ç±»ä¸­â€”â€”ä½†æ˜¯å®ƒä¸èµ·ä½œç”¨ï¼

ä¾‹å¦‚:

```
module Reusable
  def self.awesome?
    puts "awesome!"
  end
end

class AwesomeObject
  include Reusable
end

AwesomeObject.awesome? #=> undefined method `awesome?' for AwesomeObject:Class (NoMethodError) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º Ruby çš„`include`ä¸åŒ…æ‹¬`class methods`ã€‚

é€šè¿‡`extend`ã€`include`çš„ä¸å¤ªçŸ¥åçš„å…„å¼Ÿå§å¦¹(å¦ä¸€ä¸ªæ˜¯`prepend`)æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚

å®Œæ•´çš„è§£é‡Šæœ‰ç‚¹è¶…å‡ºäº†è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™é‡Œæ·±å…¥è®¨è®ºï¼Œä½†æ˜¯å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¿™æ˜¯ç”±äº Ruby ä¸­ä¸€ä¸ªå«åš`Singleton Class`çš„ä¸œè¥¿ã€‚è¿™ä¹Ÿå°†æ˜¯æˆ‘ä¸‹ä¸€ç¯‡åšæ–‡çš„ä¸»é¢˜ï¼Œæ•¬è¯·å…³æ³¨ï¼

## [](#stop-3-but-i-want-everyone-to-feel-raw-included-endraw-and-hooked)åœ 3:ä½†æ˜¯æˆ‘æƒ³è®©å¤§å®¶éƒ½æ„Ÿå—åˆ°`included`å¹¶ä¸”ä¸Šç˜¾ï¼

ç”±äº`include`æ˜¯`extend`å’Œ`prepend`æ›´å—æ¬¢è¿çš„å…„å¼Ÿï¼Œæˆ‘ä¸‹å®šå†³å¿ƒè¦ç¡®ä¿æœ€ç»ˆç”¨æˆ·åªéœ€è¦è®°ä½`include`ä¸€ä¸ªæ¨¡å—ï¼Œè€Œä¸éœ€è¦è€ƒè™‘-

â€œæˆ‘æ˜¯è¿™ä¸ªï¼Œ`include`è¿™ä¸ªè¿˜æ˜¯`prepend`è¿™ä¸ªï¼Œâ€

ä¹Ÿå¸Œæœ›é¿å…è¿™æ ·çš„æƒ…å†µ:ä½ åŒ…å«äº†ä¸€ä¸ªæ¨¡å—ï¼Œç„¶åèŠ±äº†ä¸€æ•´å¤©å»å¼„æ¸…æ¥šä¸ºä»€ä¹ˆç±»æ–¹æ³•ä¸èµ·ä½œç”¨ã€‚

*å®é™…ä¸Šï¼Œäº‹åæ¥çœ‹ï¼Œå‘Šè¯‰å¼€å‘äººå‘˜åªæ˜¯ç›²ç›®åœ°`extend`ä¸€ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ä½†æ˜¯è¯è¯´å›æ¥ï¼Œå¦‚æœæˆ‘æ”¾å¼ƒäº†ï¼Œå°±ä¸ä¼šæœ‰ç°åœ¨çš„åšå®¢*ğŸ˜‰

## [](#stop-4-wish-granted)åœ 4:æ„¿æœ›è¾¾æˆï¼

ç»è¿‡å¤§é‡ç ”ç©¶ï¼Œæˆ‘å‘ç° Ruby æœ‰ä¸€ä¸ª`included`ã€`extended`å’Œ`prepended`é’©å­å¯ä¾›æˆ‘ä»¬(ä½ çŒœå¯¹äº†)*é’©ä½*ã€‚

> æ¥æº:https://ruby-doc.org/core-2.2.0/Module.html

è¿™äº›é’©å­å…è®¸æˆ‘ä»¬åœ¨æ¨¡å—å¤„äº`included`ã€`extended`æˆ–`prepended`çŠ¶æ€æ—¶æ‰§è¡Œä»£ç ï¼ŒçŒœçŒœæˆ‘ä»¬è¦åšä»€ä¹ˆï¼Ÿ

å½“ä¸€ä¸ªæ¨¡å—æ­£åœ¨è¿›è¡Œ`included`æ—¶ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œ`extend`(èµ·åˆæˆ‘è§‰å¾—è¿™å¬èµ·æ¥å¾ˆæœ‰è¶£)

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…³äºé’©å­å¦‚ä½•å·¥ä½œçš„å°ä¾‹å­:

ä¾‹å¦‚:

```
module HookedModule
  def self.included(base)
    puts "#{self} is being included in #{base}"
  end
end

class BaseObject
  include HookedModule
end

BaseObject.new #=> HookedModule is being included in BaseObject 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…:

*   `included`éœ€è¦æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯`Module`ç±»ä¸Šçš„æ–¹æ³•ã€‚å¦‚æœä½ ä¸å£°æ˜å®ƒæ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œé’©å­å°±ä¸èµ·ä½œç”¨ã€‚
*   ä¼ é€’ç»™`included`çš„`base`å‚æ•°æ˜¯åŒ…å«æ¨¡å—çš„ç±»ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ BaseObjectã€‚

## [](#final-stop-extend-include-why-not-both)ç»ˆç‚¹ç«™:å»¶é•¿ï¼ŸåŒ…æ‹¬ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸¤è€…éƒ½è¦ï¼Ÿ

ç°åœ¨æˆ‘å¯¹é’©å­çš„å·¥ä½œåŸç†æœ‰äº†æ›´å¥½çš„ç†è§£ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆ:

> `Extend`ä¸€ä¸ªæ¨¡å—å½“å®ƒè¢«`included`

å‰å®³ï¼è®©æˆ‘ä»¬è¯•ç€åœ¨é‚£é‡Œæ‰©å±•ç±»æ–¹æ³•ï¼(å½“éœ€æ±‚ç¡®åˆ‡åœ°å‘Šè¯‰ä½ éœ€è¦åšä»€ä¹ˆæ—¶ï¼Œä½ éš¾é“ä¸å–œæ¬¢å—ï¼Ÿ)

```
module HookedModule
  def self.included(base)
    base.extend ClassMethods
  end

  module ClassMethods
    def awesome?
      puts "Yes, #{self} is awesome, stop asking."
    end
  end
end

class BaseObject
  include HookedModule
end

BaseObject.awesome? #=> "Yes, BaseObject is awesome, stop asking. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æŒ‚é’©åˆ°`included`æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡`base`è·å¾—äº†å¯¹ BaseObject çš„è®¿é—®æƒã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„`BaseObject`ç±»ä¸Šè°ƒç”¨`extend`(ä¸€ä¸ªç±»æ–¹æ³•)ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å’Œæˆ‘ä»¬åˆšæ‰åšçš„ä¸€æ ·:

```
class BaseObject
  extend HookedModule
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

èµ·åˆï¼Œè¿™çœ‹èµ·æ¥åƒæ˜¯å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯å¦‚æœä½ æƒ³é‡ç”¨å®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³•ï¼ŒåŒ…å«å’Œæ‰©å±•ä½ çš„æ¨¡å—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

## [](#recap)é‡è¿°

å› æ­¤ï¼Œæˆ‘ä»è¿™ç¯‡æ–‡ç« å¼€å§‹ï¼Œè¯•å›¾å¼„æ¸…æ¥šè¿™äº› gem æ˜¯å¦‚ä½•æä¾›ç¥å¥‡çš„æ–¹æ³•çš„â€”â€”æˆ‘ä»ç„¶ä¸å®Œå…¨ç†è§£åœ¨æ²¡æœ‰æ˜ç¡®åŒ…å«æˆ–æ’é™¤æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•æ˜¯å¦‚ä½•è¢«åŠ è½½çš„(è¿™å¯èƒ½æ˜¯å¦ä¸€ç¯‡åšæ–‡çš„ä¸»é¢˜ï¼)ï¼Œä½†æˆ‘å‘ç°å®ƒä»¬éƒ½åªæ˜¯æ™®é€šçš„ç±»æ–¹æ³•ï¼Œæˆ‘å¯ä»¥å°†å®ƒä¸ Module ä¸€èµ·ä½¿ç”¨ï¼Œä½¿æˆ‘çš„ç±»æ–¹æ³•å¯é‡ç”¨ã€‚

## [](#my-learnings)æˆ‘çš„å¿ƒå¾—:

*   æ‚¨å¯ä»¥åœ¨åˆå§‹åŒ–ç±»æ—¶è¿è¡Œæ–¹æ³•ã€‚
    åŒ…å«ä¸€ä¸ªæ¨¡å—ä¸åŒ…å«ç±»æ–¹æ³•ã€‚

*   æ¨¡å—æœ‰é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é’©å­æ¥ç®€åŒ–æˆ‘ä»¬çš„ APIã€‚

## [](#authors-note)ä½œè€…æ³¨

è¿™æ˜¯æˆ‘å†™çš„ç¬¬ä¸€ç¯‡åšæ–‡ï¼å¯èƒ½ä¸æ˜¯æœ€å…ˆè¿›çš„ï¼Œä¹Ÿä¸æ˜¯å†™å¾—æœ€å¥½çš„å¸–å­ï¼Œä½†æˆ‘ä»ç„¶åœ¨å­¦ä¹ ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä»»ä½•åé¦ˆï¼Œè¯·ç•™ä¸‹è¯„è®ºï¼Œæˆ‘çœŸçš„å¾ˆæ„Ÿè°¢ä»–ä»¬ï¼

æˆ‘ä¹ŸæŠŠæˆ‘çš„æ–‡ç« è´´åœ¨ Medium ä¸Šäº†ï¼æŸ¥çœ‹è¿™é‡Œ:[https://medium . com/@ Edison ywh/my-ruby-journey-hooking-things-up-91d 757 E1 c 59 c](https://medium.com/@edisonywh/my-ruby-journey-hooking-things-up-91d757e1c59c)

åŸæ¥å¦‚æ­¤ï¼æˆ‘çš„ç¬¬ä¸€æ¬¡çº¢å®çŸ³ä¹‹æ—…å³å°†ç»“æŸã€‚æˆ‘å–œæ¬¢åˆ°å¤„æ¢ç´¢ Ruby çš„å°é­”æ³•ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›ä»¥åèƒ½å¤šå†™å‡ ç¯‡åšæ–‡ã€‚åœ¨é‚£ä¹‹å‰ï¼Œç¥ä½ åœ¨è‡ªå·±çš„çº¢å®çŸ³ä¹‹åœ°ä¸€è·¯å¹³å®‰ï¼