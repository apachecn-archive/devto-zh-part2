# æˆ‘çš„ Bash é¢œè‰²è®¾ç½®å¦‚ä½•ç ´å edeliver

> åŸæ–‡:[https://dev . to/ktravers/how-my-bash-color-settings-broke-edeliver-4p 13](https://dev.to/ktravers/how-my-bash-color-settings-broke-edeliver-4p13)

æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ã€‚æˆ‘çš„ bash é¢œè‰²è®¾ç½®ç ´åäº†æˆ‘çš„å›¢é˜Ÿç”¨æ¥éƒ¨ç½²æˆ‘ä»¬çš„[è¯å‰‚](https://elixir-lang.org/)åº”ç”¨çš„å·¥å…· [edeliver](https://github.com/edeliver/edeliver) ã€‚

ç°åœ¨ï¼Œä»»ä½•ä¿®è¡¥è¿‡ä»–ä»¬çš„`.bash_profile` çš„äººéƒ½çŸ¥é“æœ‰æ— æ•°ç§æ–¹æ³•å¯ä»¥å®Œå…¨ç ´è§£ä½ çš„ç³»ç»Ÿã€‚ä½†æ˜¯è¿™ä¸ª bug è¢«ä¼ªè£…å¾—å¾ˆå¥½ï¼Œéšè—åœ¨ä¸€ä¸ªå¸¸è§çš„ã€çœ‹ä¼¼è‰¯æ€§çš„ bash è®¾ç½®ä¸­ï¼Œæˆ‘å·²ç»å®‰è£…äº†ä¸¤å¹´åŠï¼Œæ²¡æœ‰å‡ºç°ä»»ä½•é—®é¢˜â€”â€”ä¸€ä¸ª bash è®¾ç½®ï¼Œä½ ç°åœ¨å¯èƒ½ä¹Ÿå·²ç»å®‰è£…åœ¨ä½ çš„æœºå™¨ä¸Šäº†ğŸ˜±

ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œæˆ‘è¿½è¸ªåˆ°äº†è¿™ä¸ªå°å®¶ä¼™ï¼Œæ‰€ä»¥ç»§ç»­è¯»ä¸‹å»ï¼Œçœå¾—ä½ å’Œæˆ‘ä¸€æ ·éº»çƒ¦ã€‚å¯¹äºé‚£äº›èµ¶æ—¶é—´çš„äººæ¥è¯´ï¼Œè¿™é‡Œæ˜¯ TLï¼›åšå£«ã€‚

*   [é—®é¢˜](#the-problem)
*   [è°ƒè¯•æ­¥éª¤](#debugging-steps)
*   [è½¬æŠ˜ç‚¹](#the-turning-point)
*   [è§£é‡Š](#the-explanation)
*   [è§£å†³æ–¹æ¡ˆ](#the-solution)
*   [å­¦ä¹ ](#learnings)

## é—®é¢˜æ˜¯

æˆ‘åˆšåˆšå¼€å§‹ç€æ‰‹æˆ‘ä»¬çš„ä¸€ä¸ª Elixir é¡¹ç›®ï¼Œå°½æˆ‘æœ€å¤§çš„åŠªåŠ›åŒæ—¶å­¦ä¹ ä¸€ä¸ªæ–°çš„ä»£ç åº“å’Œä¸€é—¨æ–°çš„è¯­è¨€ã€‚åœ¨éƒ¨ç½²å˜æ›´ä¹‹å‰ï¼Œä¸€åˆ‡éƒ½è¿›è¡Œå¾—å¾ˆé¡ºåˆ©ã€‚æˆ‘å¯ä»¥[å‘å¸ƒ](https://github.com/edeliver/edeliver#build-commands)ï¼Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä¸èƒ½[éƒ¨ç½²](https://github.com/edeliver/edeliver#deploy-commands)ï¼›è¯¥å‘½ä»¤æ¯æ¬¡éƒ½ä¼šå¤±è´¥ï¼Œè¾“å‡ºå¦‚ä¸‹:

```
$ mix edeliver deploy release to production --version=X.X.X-XXX-XXXXXXX --verbose

DEPLOYING RELEASE OF MY_APP APP TO PRODUCTION HOSTS

-----> Authorizing hosts
-----> Authorizing release store host
-----> Authorizing deploy hosts on release store
-----> Uploading archive of release X.X.X-XXX-XXXXXXX from remote release store
Uploading release file failed
  source: /home/deployer/my_app/builds/complete/my_app_X.X.X-XXX-XXXXXXX.release.tar.gz on deployer@host
  destination: /home/deployer/my_app/my_app_X.X.X-XXX-XXXXXXX.tar.gz on deploy hosts 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘çš„é˜Ÿå‹*å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤*è¿›è¡Œéƒ¨ç½²ï¼›æˆ‘æ˜¯å”¯ä¸€ä¸€ä¸ªå¾—åˆ°è¿™ä¸ªé”™è¯¯çš„äººã€‚æˆ‘è¯•ç€ä»æˆ‘çš„å·¥ä½œå’Œä¸ªäººç”µè„‘ä¸Šè¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œå®ƒåœ¨ä¸¤å°æœºå™¨ä¸Šéƒ½ä»¥ç›¸åŒçš„æ–¹å¼å‡ºé”™(æˆ‘ä½¿ç”¨å…±äº«çš„[ç‚¹æ–‡ä»¶](https://github.com/ktravers/dotfiles)ï¼Œæ‰€ä»¥è¿™å¹¶ä¸å¥‡æ€ª)ã€‚

## è°ƒè¯•æ­¥éª¤

*   [ç¡¬å¤ä½](#hard-reset)
*   [è·å–è¯¦ç»†ä¿¡æ¯](#get-verbose)
*   [æ‰‹åŠ¨è§£å†³æ–¹æ³•](#manual-workaround)
*   [SSH å¥å…¨æ€§æ£€æŸ¥](#ssh-sanity-check)

### 1.ç¡¬é‡ç½®

æ¯å½“æˆ‘é‡åˆ°å¥‡æ€ªçš„é”™è¯¯æ—¶ï¼Œæˆ‘ç¬¬ä¸€ä¸ªæ±‚åŠ©çš„æ–¹æ³•å°±æ˜¯:é‡æ–°å¼€å§‹ã€‚æˆ‘ä»æˆ‘çš„æœºå™¨ä¸Šåˆ é™¤äº†é¡¹ç›®ç›®å½•ï¼Œé‡æ–°å…‹éš†äº†å®ƒï¼Œå¹¶å°è¯•éƒ¨ç½²ä¸»åˆ†æ”¯(å®ƒå·²ç»åœ¨ç”Ÿäº§ä¸­è¿è¡Œäº†)ã€‚æ²¡æœ‰éª°å­ã€‚

**ç»“æœ:**

âœ…ç¡®è®¤é—®é¢˜ä¸æˆ‘åœ¨ä»£ç åº“ä¸­æ›´æ”¹çš„å†…å®¹æ— å…³

âŒæ²¡æœ‰å·¥ä½œã€‚éƒ¨ç½²ä»ç„¶å¤±è´¥ã€‚

### 2.å˜å¾—å†—é•¿

æˆ‘è¿è¡Œå¸¦æœ‰`--verbose`æ ‡å¿—çš„ deploy å‘½ä»¤ï¼Œä½†æ˜¯ edeliver é”™è¯¯æ¶ˆæ¯æ²¡æœ‰å‘Šè¯‰æˆ‘å…³äº*å‘½ä»¤å¤±è´¥çš„åŸå› *(ç¨åå…³äº[çš„æ›´å¤šä¿¡æ¯](#learnings))ã€‚æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

åœ¨æˆ‘çš„é˜Ÿå‹[å²è’‚æ–‡](http://hostiledeveloper.com/)çš„å‡ºè‰²å»ºè®®ä¸‹ï¼Œæˆ‘æ‰“å¼€äº†`my_app/deps/edeliver`ï¼Œé€šè¿‡æœç´¢é”™è¯¯æ¶ˆæ¯(â€œä¸Šä¼ å‘å¸ƒæ–‡ä»¶å¤±è´¥â€)æ‰¾åˆ°äº†å¤±è´¥çš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡æ·»åŠ `-vvvvv`é€‰é¡¹(æ›´`v`= =æ›´è¯¦ç»†):
å°†å…¶åˆ‡æ¢åˆ°è¯¦ç»†è°ƒè¯•æ¨¡å¼

```
# https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L685-L759

# copies the release archive to the production hosts to the given path.
upload_release_archive() {
  # lotsa code, omitted here for brevity
  ssh -A -vvvvv -o ConnectTimeout="$SSH_TIMEOUT" "$_release_store_host" "$_remote_job  $SILENCE" || \
    error "Uploading release file failed\n source: ${_release_store_path%%/}/${_release_file} on $_release_store_host\n destination: $_dest_file_name on deploy hosts"
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™è®©æˆ‘å¯¹è¿™ä¸ªè„šæœ¬è¯•å›¾(å’Œå¤±è´¥)åšä»€ä¹ˆæœ‰äº†æ›´å¤šçš„äº†è§£ã€‚è€å®è¯´ï¼Œå¯èƒ½å¤ªå¤šçš„æ´å¯ŸåŠ›ã€‚åœ¨è¯¦ç»†è°ƒè¯•æ¨¡å¼ä¸‹é‡æ–°è¿è¡Œ deploy å‘½ä»¤å¾—åˆ°äº†å¤§çº¦ 200 è¡Œè¾“å‡º:

```
$ mix edeliver deploy release to production --version=X.X.X-XXX-XXXXXXX --verbose

DEPLOYING RELEASE OF MY_APP APP TO PRODUCTION HOSTS

-----> Authorizing hosts
-----> Authorizing release store host
-----> Authorizing deploy hosts on release store
-----> Uploading archive of release X.X.X-XXX-XXXXXXX from remote release store
OpenSSH_7.4p1, LibreSSL 2.5.0
debug1: Reading configuration data /Users/kate/.ssh/config
debug1: /Users/kate/.ssh/config line 1: Applying options for *
debug1: Reading configuration data /etc/ssh/ssh_config
debug2: resolving "xxx.xxx.xx.xxx" port XXX
debug2: ssh_connect_direct: needpriv 0
debug1: Connecting to xxx.xxx.xx.xxx [xxx.xxx.xx.xxx] port XXX.
debug2: fd 3 setting O_NONBLOCK
debug1: fd 3 clearing O_NONBLOCK
debug1: Connection established.
debug3: timeout: 99999969 ms remain after connect
debug1: identity file /Users/kate/.ssh/id_rsa type 1

### approx 180 more lines...

debug3: send packet: type 1
debug1: fd 0 clearing O_NONBLOCK
debug1: fd 1 clearing O_NONBLOCK
debug3: fd 2 is not O_NONBLOCK
Transferred: sent 4624, received 2996 bytes, in 0.2 seconds
Bytes per second: sent 20610.0, received 13353.7
debug1: Exit status 1
Uploading release file failed
  source: /home/deployer/my_app/builds/complete/my_app_X.X.X-XXX-XXXXXXX.release.tar.gz on deployer@host
  destination: /home/deployer/my_app/my_app_X.X.X-XXX-XXXXXXX.tar.gz on deploy hosts 
```

Enter fullscreen mode Exit fullscreen mode

Steven åœ¨ä»–çš„æœºå™¨ä¸Šåšäº†åŒæ ·çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä»–çš„æˆåŠŸè°ƒè¯•æ—¥å¿—ä½œä¸ºæ¯”è¾ƒã€‚

ä»–çš„è¾“å‡ºä¹Ÿç»™äº†æˆ‘ä»¬å¦ä¸€æ¡æœ‰ä»·å€¼çš„ä¿¡æ¯:ç”± [`upload_release_archive`å‡½æ•°](https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L689)æ„å»ºçš„å®é™… bash å‘½ä»¤ [`$_remote_job`](https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L754-L755) ï¼Œä¹Ÿå°±æ˜¯å°†å‘å¸ƒä»æˆ‘ä»¬çš„æ„å»ºæœåŠ¡å™¨å¤åˆ¶åˆ°æˆ‘ä»¬çš„ç”Ÿäº§æœåŠ¡å™¨çš„é‚£ä¸ªï¼Œä¹Ÿå°±æ˜¯æŠ›å‡ºé”™è¯¯çš„é‚£ä¸ªã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬ä¼šè¿½è¸ªè¿™æ¡çº¿ç´¢ã€‚

**ç»“æœ:**

âœ…ä»¥å†—é•¿è°ƒè¯•æ¨¡å¼æ›´å¥½åœ°è¾“å‡º

âœ…ç¡®è®¤äº†ç¡®åˆ‡çš„æ•…éšœç‚¹

âœ…å­¦ä¼šäº†ä¸€ç§æ–°çš„è°ƒè¯•æŠ€æœ¯(æ„Ÿè°¢å²è’‚æ–‡ï¼)

âŒå¾ˆéš¾ä»å™ªéŸ³ä¸­åˆ†ç¦»å‡ºä¿¡å·

### 3.æ‰‹åŠ¨è§£å†³æ–¹æ³•

æˆ‘ä»¬å·²ç»æŸ¥æ˜äº†åœ¨æœ¬åœ°å¤±è´¥çš„å‘½ä»¤ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°è¯•ç›´æ¥ä»æ„å»ºæœåŠ¡å™¨è¿è¡Œå®ƒå‘¢ï¼Ÿ

æˆ‘é€šè¿‡ ssh è¿›å…¥æˆ‘ä»¬çš„æ„å»ºæœåŠ¡å™¨ï¼Œåˆ‡æ¢åˆ°æˆ‘ä»¬çš„éƒ¨ç½²è€…ç”¨æˆ·ï¼Œè¿è¡Œä¸Šé¢çš„ [`$_remote_job`å‘½ä»¤](https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L754-L755)ã€‚ä½ çŸ¥é“å—ï¼ŒæˆåŠŸäº†ï¼æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œå‘å¸ƒæ–‡æ¡£ä»æ„å»ºæœåŠ¡å™¨å¤åˆ¶åˆ°äº†æˆ‘ä»¬çš„ç”Ÿäº§æœåŠ¡å™¨ã€‚

æˆ‘å›åˆ°æˆ‘çš„æœ¬åœ°æœºå™¨ï¼Œæ³¨é‡Šæ‰ edeliver è„šæœ¬ä¸­çš„ [`upload_release_archive`å‡½æ•°](https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L689)(å› ä¸ºå½’æ¡£æ–‡ä»¶å·²ç»è¢«å¤åˆ¶äº†)ï¼Œç„¶åè¿è¡Œ deploy å‘½ä»¤ã€‚æˆåŠŸï¼

æ‰€ä»¥ç°åœ¨äº‹æƒ…å˜å¾—æœ‰è¶£äº†ã€‚å½“æˆ‘ä½œä¸ºæˆ‘çš„`kate`ç”¨æˆ·ä»æœ¬åœ°è¿è¡Œè¿™ä¸ªå‘½ä»¤æ—¶ï¼Œå®ƒå¤±è´¥äº†ã€‚å½“æˆ‘ä½œä¸º`deployer`ä»æˆ‘ä»¬çš„æ„å»ºæœåŠ¡å™¨è¿è¡Œå®ƒæ—¶ï¼Œå®ƒæˆåŠŸäº†ã€‚ç»“è®º:æˆ‘çš„ç”¨æˆ·æœ‰é—®é¢˜ã€‚

**ç»“æœ:**

âœ…æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªå¯ç”¨çš„(å°½ç®¡æ˜¯è¶…æ‰‹åŠ¨çš„)è§£å†³æ–¹æ³•

âœ…ç¡®è®¤é—®é¢˜ä¸åœ¨æˆ‘ä»¬é¡¹ç›®çš„ edeliver é…ç½®ä¸­

âŒä»ç„¶ä¸èƒ½ä»æˆ‘çš„æœ¬åœ°éƒ¨ç½²

### 4.å¥å…¨æ€§æ£€æŸ¥

æˆ‘ä»¬å·²ç»å°†é—®é¢˜ç¼©å°åˆ°æˆ‘çš„ç”¨æˆ·ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥æ˜¯æ£€æŸ¥æˆ‘çš„ ssh é…ç½®ã€‚æˆ‘ä»¥æˆ‘çš„ç”¨æˆ·èº«ä»½ç™»å½•ï¼Œç¡®è®¤æˆ‘çš„å¯†é’¥åœ¨æ‰€éœ€çš„æœåŠ¡å™¨ä¸Š...é‚£é‡Œæ²¡é—®é¢˜ã€‚ç„¶åæˆ‘å°†æˆ‘çš„`.ssh/config`æ–‡ä»¶ä¸æˆ‘é˜Ÿå‹çš„é…ç½®è¿›è¡Œäº†æ¯”è¾ƒ...ä¹Ÿæ²¡ä»€ä¹ˆå¥‡æ€ªçš„ã€‚

æˆ‘è¿˜å°è¯•äº†åœ¨åˆ é™¤ä»¥ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹åè¿›è¡Œéƒ¨ç½²(é€ä¸ªéš”ç¦»æµ‹è¯•)ï¼Œä½†ä»ç„¶æ²¡æœ‰æˆåŠŸ:

*   `~/.ssh/known_hosts`
*   `~/.bashrc`
*   `~/.profile`

**ç»“å±€:**

âœ…ç¡®è®¤é—®é¢˜ä¸æ˜¯å‡ºåœ¨æˆ‘çš„ ssh config ä¸Š

âŒå‡ºä¸»æ„äº†

## è½¬æŠ˜ç‚¹

æ­¤æ—¶ï¼Œç»æœ›å¼€å§‹è¢­æ¥ã€‚æˆ‘å’Œæˆ‘çš„é˜Ÿå‹éƒ½è¢«éš¾ä½äº†ï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰ä¸œè¥¿å¯ä»¥å°è¯•äº†ã€‚

è¿›å…¥å®‰å¾·çƒˆæ–¯ä» [OzoneOps](https://ozoneops.com/) ï¼Œæˆ‘ä»¬çš„ devops æ‰¿åŒ…å•†ã€‚æˆ‘æŠŠ Steven å’Œæˆ‘çš„è¾“å‡ºæ—¥å¿—å‘ç»™äº†ä»–ï¼Œä»–ç¬¬ä¸€ä¸ªæ³¨æ„åˆ°äº†ä¸€ä¸ªéå¸¸é‡è¦çš„åŒºåˆ«:åœ¨æˆ‘çš„è¾“å‡ºä¸­ï¼Œå­˜æ¡£æ–‡ä»¶åä¸­æœ‰ä¸€å †å¥‡æ€ªçš„å­—ç¬¦ã€‚

```
# Filename from Steven's output
my_app_X.X.X-XXX-XXXXXXX.release.tar.gz

# Filename from Kate's output
my_app_\033[4;38m\033[KX.X.X-XXX-XXXXXXX\033[m\033[K.release.tar.gz 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿè¿™äº›é¢å¤–çš„å­—ç¬¦æ¥è‡ªå“ªé‡Œï¼Ÿ

è°·æ­Œå¿«é€Ÿæœç´¢å‘ç°ï¼Œè¿™äº›æ˜¯ç»ˆç«¯è½¬ä¹‰åºåˆ—ï¼Œæˆ– [ANSI è½¬ä¹‰ç ](https://en.wikipedia.org/wiki/ANSI_escape_code)ã€‚ç»ˆç«¯é€šå¸¸å°†è¿™äº›åºåˆ—è§£é‡Šä¸ºå‡½æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ ¼å¼åŒ–è¾“å‡ºï¼Œæ¯”å¦‚ç»™`grep`æˆ–`ls`å‘½ä»¤çš„è¾“å‡ºæ·»åŠ é¢œè‰²ã€‚

æˆ‘å–œæ¬¢åœ¨æˆ‘çš„ç»ˆç«¯è¾“å‡ºä¸­ä½¿ç”¨ä¸€äº›é¢œè‰²ï¼Œæ‰€ä»¥æ—©åœ¨ä¸€å¤©å‰(æ¯”å¦‚ï¼Œä¸¤å¹´åŠå‰)ï¼Œæˆ‘å°±åœ¨æˆ‘çš„`.bash_profile`ä¸­æ·»åŠ äº†è®¾ç½®æ¥ç»™æˆ‘çš„`ls`å’Œ`grep`è¾“å‡ºç€è‰²ã€‚

```
export LSCOLORS=gxxxxxxxcxxxxxcxcxgxgx
export GREP_OPTIONS='--color=always'
export GREP_COLOR='4;38' 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»æ¥æ²¡æœ‰æƒ³è¿‡è¿™äº›åœºæ™¯...ç›´åˆ°ç°åœ¨ã€‚åŸæ¥ä»–ä»¬ä¸€ç›´æ˜¯ä¸€ä¸ªå®šæ—¶ç‚¸å¼¹ï¼Œåªæ˜¯åœ¨ç­‰å¾…è¿™ä¸ªç‰¹å®šçš„åœºæ™¯ã€‚

## è§£é‡Š

ä¸Šé¢çš„è®¾ç½®é€šè¿‡åœ¨`ls`å’Œ`grep`å‘½ä»¤çš„è¾“å‡ºä¸­æ·»åŠ  ANSI è½¬ä¹‰ç æ¥å‘æŒ¥å…¶ç€è‰²çš„é­”åŠ›ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬åœ¨ä¸‹é¢çš„`example.txt`ä¸Šè¿è¡Œ`grep`ã€‚

```
$ cat example.txt
abcdef 
```

Enter fullscreen mode Exit fullscreen mode

```
$ grep abc example.txt
abcdef

$ grep --color=always abc example.txt
abcdef 
```

Enter fullscreen mode Exit fullscreen mode

ä¼¼ä¹æ— å®³ï¼Œå¯¹å—ï¼Ÿè½¬ä¹‰ç è¢«æ­£ç¡®åœ°â€œè½¬ä¹‰â€ï¼Œè¢«è§£é‡Šä¸ºå‡½æ•°è€Œä¸æ˜¯å­—ç¬¦...é™¤éä½ çš„ç»ˆç«¯ä¸çŸ¥é“å¦‚ä½•è§£é‡Šè¿™ä¸ªåºåˆ—ã€‚ä¾‹å¦‚ï¼Œçœ‹çœ‹å½“æ‚¨å°†å½©è‰²çš„`grep`è¾“å‡ºé€šè¿‡ç®¡é“ä¼ è¾“åˆ°`less` :
æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ

```
$ grep --color=always abc example.txt | less
ESC[01;31mabcESC[00mdef
(END) 
```

Enter fullscreen mode Exit fullscreen mode

é—®é¢˜æ¥äº†ã€‚å¦‚æœæ‚¨å°†å½©è‰²è¾“å‡ºé€šè¿‡ç®¡é“ä¼ è¾“åˆ°åƒ`less`è¿™æ ·ä¸çŸ¥é“å¦‚ä½•è§£é‡Šå®ƒçš„å‡½æ•°ä¸­ï¼Œè½¬ä¹‰ç å°†è¢«è§†ä¸ºæ™®é€šçš„ ol å­—ç¬¦ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªä¸æ”¯æŒä½ é€šè¿‡`LSCOLORS`æˆ–`GREP_COLOR`å˜é‡è®¾ç½®çš„ä»»ä½•è½¬ä¹‰ç çš„ç»ˆç«¯ä¸­ç»™`ls`æˆ–`grep`ç€è‰²ï¼Œä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„äº‹æƒ…ã€‚

è¿™å°±æ˜¯æˆ‘åœ¨ [edeliver](https://github.com/edeliver/edeliver) deploy è„šæœ¬ä¸­é‡åˆ°çš„æƒ…å†µã€‚

å›å¤´çœ‹çœ‹ [edeliver æºä»£ç ](https://github.com/edeliver/edeliver/blob/master/libexec/erlang#L662)ï¼Œå½’æ¡£çš„å‘å¸ƒæ–‡ä»¶åæ˜¯ä»`ls`å’Œ`grep`å‘½ä»¤çš„è¾“å‡ºæ„å»ºçš„ã€‚å› ä¸ºæˆ‘åœ¨æˆ‘çš„`.bash_profile`ä¸­è®¾ç½®äº†è¿™äº›ç€è‰²å˜é‡ï¼Œæ‰€ä»¥æˆ‘çš„æœºå™¨åœ¨è¾“å‡ºä¸­æ·»åŠ äº†é¢œè‰²è½¬ä¹‰ç ï¼Œè¿™äº›ä»£ç è¢«â€œè¯¯è§£â€ä¸ºå‘å¸ƒå½’æ¡£æ–‡ä»¶åä¸­çš„é¢å¤–å­—ç¬¦ï¼Œç ´åäº†éƒ¨ç½²ã€‚

âœ‹

ã€‚

ã€‚

ã€‚

ğŸ¤*éº¦å…‹ä¸‹é™:

## è§£å†³æ–¹æ¡ˆ

ä»æ‚¨çš„`.bash_profile` :
ä¸­åˆ é™¤ä»»ä½•`ls`æˆ–`grep`é¢œè‰²è®¾ç½®

```
# â˜ ï¸â˜ ï¸â˜ ï¸ incompatible with edeliver deploy script â˜ ï¸â˜ ï¸â˜ ï¸
export LSCOLORS=gxxxxxxxcxxxxxcxcxgxgx
export GREP_OPTIONS='--color=always'
export GREP_COLOR='4;38' 
```

Enter fullscreen mode Exit fullscreen mode

ã€æ›´æ–°ã€‘åŸºäº[çš„è¿™ä¸ª](https://dev.to/carlfish/comment/35l8)æ¥è‡ª[æŸ¥å°”æ–¯Â·ç±³å‹’](https://dev.to/carlfish)çš„æœ‰ç”¨è¯„è®ºï¼Œæ›´ç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯æŠŠ`export GREP_OPTIONS='--color=always'`æ”¹æˆ`export GREP_OPTIONS='--color=auto'`ã€‚

## å­¦ä¹ 

è°ƒè¯•æ˜¯å›°éš¾çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨ä¸€ä¸ªæ–°çš„ä»£ç åº“å’Œ/æˆ–æ–°çš„è¯­è¨€ä¸­å·¥ä½œçš„æ—¶å€™ã€‚æœ‰ä¸€ä»¶äº‹çœŸçš„å¯ä»¥æ‹¯æ•‘ä½ ï¼Œé‚£å°±æ˜¯å¥½çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¿™æ˜¯ Elixir æ“…é•¿åšçš„ï¼Œedeliver å¯ä»¥åšå¾—æ›´å¥½ã€‚

æ¥ä¸‹æ¥çš„æ­¥éª¤å°†æ˜¯ä¸º [edeliver](https://github.com/edeliver/edeliver) æå‡ºè¿™ä¸ªé—®é¢˜ï¼Œå¹¶å°è¯•æ”¹è¿›ä¸€äº›é”™è¯¯æ¶ˆæ¯(ä¹Ÿè®¸æ˜¯ä¿®å¤è¿™ä¸ªæ— æ„ä¹‰çš„è½¬ä¹‰åºåˆ—...æˆ‘è®¤ä¸ºæˆ‘ä»¬åªéœ€è¦åœ¨è¿è¡Œ deploy å‘½ä»¤ä¹‹å‰ç¦ç”¨é¢œè‰²è®¾ç½®)ã€‚

## èµ„æº

*   [å®˜æ–¹ edeliver è°ƒè¯•æç¤º](https://github.com/edeliver/edeliver#help)
*   [å…³äº ANSI è½¬ä¹‰ç çš„æ›´å¤šä¿¡æ¯](https://en.wikipedia.org/wiki/ANSI_escape_code)
*   [æ›´å¤šå…³äº GNU `grep`ç¯å¢ƒå˜é‡](https://www.gnu.org/software/grep/manual/html_node/Environment-Variables.html)
*   [edeliver ä¸ŠæŠ¥å‘Šäº†ç±»ä¼¼é—®é¢˜](https://github.com/edeliver/edeliver/issues/14)
*   [å…³äº edeliver é”™è¯¯æ¶ˆæ¯çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯](https://github.com/edeliver/edeliver/issues/80)