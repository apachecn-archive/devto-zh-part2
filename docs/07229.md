# GraphQL ä½œä¸ºæ‚¨çš„æœåŠ¡å±‚

> åŸæ–‡:[https://dev . to/emasuriano/graph QL-as-your-service-layer-4n 99](https://dev.to/emasuriano/graphql-as-your-service-layer-4n99)

å¦‚ä»Šï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¿æ¥åˆ°æœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„åè®®( *HTTP* ã€ *FTP* ã€ *HTTPS* )å’Œè®¾è®¡( *SOAP* ã€ *REST* ï¼Œç±»ä¼¼ REST çš„ä¸œè¥¿)å‘é€æ•°æ®ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¿…é¡»å¤„ç†è¿™äº›ï¼Œå› æ­¤æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›åœ¨æˆ‘ä»¬çš„æ¶æ„ä¸­æœ‰ä¸€ä¸ªæœåŠ¡å±‚ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœåŠ¡å±‚çš„å¸¸è§å®ç°:

```
const myService = await params =\> {
 const requestParams = adaptParamsForRequest(params);
 const response = fetch(MY\_SERVICE\_URL, {
 headers: SERVICE\_HEADERS,
 method: SERVICE\_METHOD,
 body: requestParams,
 ...more
 });

return parseResponse(response); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç§æœåŠ¡å±‚æœ‰ä¸€äº›ç¼ºç‚¹:

*   ç”±äºä¿®æ”¹å’Œè§£ææ•°æ®è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚
*   web åº”ç”¨ç¨‹åºå¿…é¡»çŸ¥é“ API ä½¿ç”¨çš„åè®®å’Œè®¾è®¡(HTTPã€FTP ç­‰ã€‚).
*   ä¸ºäº†è·å¾—æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‰§è¡Œå¦ä¸€ä¸ªè¯·æ±‚ï¼Œæˆ–è€…å¯èƒ½ä¸æ­¢ä¸€ä¸ªè¯·æ±‚ã€‚
*   å¯èƒ½ä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦å“åº”ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè§£æå™¨ä¼šå®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†æ¥ä¸ä¼šä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å°±ä¸åº”è¯¥é¦–å…ˆè¦æ±‚å®ƒã€‚

GraphQL åœ¨æ‰€æœ‰è¿™äº›æ–¹é¢éƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼ä½†é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å®ƒæ˜¯ä»€ä¹ˆ..

### [](#graphq-what)GraphQ ä»€ä¹ˆï¼ï¼ŸğŸ¤”

å¦‚æœæˆ‘ä»¬æ£€æŸ¥å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

> GraphQL æ˜¯ä¸€ç§ API æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§ç”¨ç°æœ‰æ•°æ®å®Œæˆè¿™äº›æŸ¥è¯¢çš„è¿è¡Œæ—¶è¯­è¨€ã€‚GraphQL ä¸º API ä¸­çš„æ•°æ®æä¾›äº†å®Œæ•´ä¸”æ˜“äºç†è§£çš„æè¿°ï¼Œä½¿å®¢æˆ·èƒ½å¤Ÿå‡†ç¡®åœ°è¦æ±‚ä»–ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä½¿ API æ›´å®¹æ˜“éšæ—¶é—´å‘å±•ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„å¼€å‘å·¥å…·ã€‚

[![](../Images/f8abcd3dae79962b02124a0fcca2ff37.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BiqgcoM9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/480/1%2AHHEU3G2ojo6uFtYjwE21Ig.gif)

å“‡ï¼Œä¿¡æ¯é‡çœŸå¤§ï¼è®©æˆ‘ä»¬å†·é™ä¸‹æ¥ï¼Œçœ‹çœ‹ä»–ä»¬åœ¨è°ˆè®ºä»€ä¹ˆğŸ™

#### [](#graphql-is-a-query-language-for-apis)GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€

å…ˆä»ç»´åŸºç™¾ç§‘çš„å®šä¹‰è¯´èµ·ã€‚

> *æŸ¥è¯¢è¯­è¨€æ˜¯æŒ‡é€šè¿‡å‘é€æŸ¥è¯¢ä»æ•°æ®åº“å’Œä¿¡æ¯ç³»ç»Ÿä¸­è¯·æ±‚å’Œæ£€ç´¢æ•°æ®çš„ä»»ä½•è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ã€‚*

æ€»è€Œè¨€ä¹‹ï¼ŒGraphQL æ˜¯ä¸€ç§å…è®¸æˆ‘ä»¬å‘æ•°æ®åº“æˆ–å…¶ä»–ä¸œè¥¿å‘é€æ•°æ®è¯­è¨€(æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­çœ‹åˆ°â€œæŸäº›ä¸œè¥¿â€æ˜¯ä»€ä¹ˆæ„æ€)ã€‚æ¯ç§è¯­è¨€éƒ½æœ‰ä¸€å¥—å®šä¹‰å®ƒçš„è§„åˆ™ï¼Œåœ¨ GraphQL ä¸­è¿™è¢«ç§°ä¸º Schemaã€‚

#### [](#schema)å›¾å¼ğŸ§ 

æ¨¡å¼æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´çš„å¥‘çº¦ï¼Œå®ƒæŒ‡å®š API çš„åŠŸèƒ½ï¼Œå¹¶å®šä¹‰å®¢æˆ·æœºå¦‚ä½•ä¸æ•°æ®äº¤äº’ã€‚ç¼–å†™æ¨¡å¼çš„è¯­æ³•ç§°ä¸º[æ¨¡å¼å®šä¹‰è¯­è¨€(SDL)](https://blog.graph.cool/graphql-sdl-schema-definition-language-6755bcb9ce51) ã€‚

åŸºæœ¬ä¸Šï¼ŒSDL æœ‰ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†:

*   ç±»å‹:æœ‰ä¸€ä¸ªåç§°ï¼Œå¯ä»¥æ‰©å±•ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚

```
type Post implements Item {
 # ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   å­—æ®µ:æœ‰åç§°å’Œç±»å‹ã€‚

```
age: Int 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬åˆå¹¶è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª ObjectTypeï¼

```
type Car {
 patent: String!
 color: String!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ±½è½¦ç±»å‹åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ [ScalarTypes](https://graphql.org/learn/schema/#scalar-types) å®šä¹‰äº†æ±½è½¦æ¨¡å‹çš„ç»“æ„ï¼Œå®ƒåº”è¯¥æœ‰ä¸€ä¸ªä¸“åˆ©ï¼Œé¢œè‰²å±æ€§å¿…é¡»æ˜¯ string å’Œ mandatoryã€‚

éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒObjectType æˆ– ScalarTypes ä¸å‘å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå…¬å¼€ä»»ä½•åŠŸèƒ½ï¼Œä¸ºæ­¤æˆ‘ä»¬åº”è¯¥ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨å®šä¹‰æˆ‘ä»¬çš„*å…¥å£ç‚¹*ã€‚

#### [](#query-type)æŸ¥è¯¢ç±»å‹ğŸ”

å®¢æˆ·ç«¯ä½¿ç”¨æŸ¥è¯¢å‘æœåŠ¡å™¨è¯·æ±‚æ‰€éœ€çš„æ•°æ®ã€‚ä¸ REST APIss ä¸åŒï¼Œåœ¨ REST API ä¸­ï¼Œä»æ¯ä¸ªç«¯ç‚¹è¿”å›çš„ä¿¡æ¯éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„ç»“æ„ï¼ŒGraphQL æ€»æ˜¯åªå…¬å¼€ä¸€ä¸ªç«¯ç‚¹ï¼Œå…è®¸å®¢æˆ·ç«¯å†³å®šå®ƒçœŸæ­£éœ€è¦ä»€ä¹ˆæ•°æ®ï¼

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŸ¥è¯¢ï¼Œå®ƒè¿”å›æ‰€æœ‰çš„æ±½è½¦åŠå…¶å„è‡ªçš„ä¿¡æ¯ï¼Œä½†æ˜¯å®¢æˆ·åªå¸Œæœ›æ£€ç´¢å®ƒä»¬çš„ä¸“åˆ©ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½ä¸æƒ³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢:

```
{
 allCars {
 patent
 }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†è¿”å›å½“å‰å­˜å‚¨åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰æ±½è½¦çš„åˆ—è¡¨ï¼Œå…¶å½¢çŠ¶å¦‚ä¸‹:

```
{
 "data": {
 "allCars": [
 {
 "patent": "ABC 123"
 },
 {
 "patent": "BQK 893"
 },
 {
 "patent": "POI 098"
 }
 ]
 }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#mutation-type-%E2%9B%93)çªå˜å‹â›“

çªå˜å…è®¸å®¢æˆ·ç«¯å¯¹å­˜å‚¨åœ¨æœåŠ¡å™¨å†…éƒ¨çš„æ•°æ®è¿›è¡Œæ›´æ”¹ã€‚è¿™äº›å˜åŒ–å¯èƒ½æ˜¯:

*   åˆ›å»ºæ–°æ•°æ®
*   æ›´æ–°ç°æœ‰æ•°æ®
*   åˆ é™¤ç°æœ‰æ•°æ®

çªå˜çš„è¯­æ³•çœ‹èµ·æ¥å‡ ä¹å’ŒæŸ¥è¯¢ä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬å¿…é¡»ä»¥çªå˜å…³é”®å­—å¼€å§‹ã€‚

```
mutation {
 createCar(patent: â€œQWE 112â€, color: â€œredâ€) {
 patent
 color
 }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#subscription-type)è®¢é˜…ç±»å‹ğŸ“©

è®¢é˜…ä¸ºå®¢æˆ·ç«¯æä¾›äº†ä¸æœåŠ¡å™¨å»ºç«‹å®æ—¶è¿æ¥çš„å¯èƒ½æ€§ï¼Œä»¥ä¾¿åœ¨é‡è¦äº‹ä»¶å‘ç”Ÿåè·å¾—é€šçŸ¥ã€‚æ¯å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨å°†ç›¸åº”çš„æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚

å®ƒä»¬ä½¿ç”¨ä¸æŸ¥è¯¢ç›¸åŒçš„è¯­æ³•ç¼–å†™ï¼Œä½†ä»¥ subscription å…³é”®å­—å¼€å¤´ã€‚

```
subscription {
 createCar {
 patent
 }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### GraphQL æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ï¼Œç”¨äºä½¿ç”¨ç°æœ‰æ•°æ®å®Œæˆè¿™äº›æŸ¥è¯¢

GraphQL æœ¬èº«ä¸æä¾›ä»»ä½•ä¿¡æ¯æˆ–æ•°æ®ï¼Œå®ƒå°†æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢æˆ–å˜å¼‚ï¼Œå¹¶é€šè¿‡ä¸å…¶å®ä½“çš„é€šä¿¡æ¥è§£å†³å®ƒã€‚å®ƒèƒ½å¤Ÿä¸è®¸å¤šä¸åŒç±»å‹çš„å®ä½“è¿›è¡Œé€šä¿¡ï¼Œè¿™äº›å®ä½“å¯ä»¥æ˜¯ SQL æˆ– NoSQL æ•°æ®åº“ã€REST APIsã€ç¬¬ä¸‰æ–¹ APIã€é—ç•™ç³»ç»Ÿç”šè‡³å…¶ä»– GraphQL APIsã€‚

å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªæœ¬åœ°æ•°æ®åº“ä¸ä¸¤ä¸ªå¤–éƒ¨æœåŠ¡ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°ä¸‹é¢çš„æ¶æ„ã€‚

<figure>[![](../Images/db79d78e5bc5c98ce13976a3cd8d6a8b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_7rxPVhE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/742/1%2AMwvNPnnT92MqL2WmY9jUnQ.jpeg) 

<figcaption>GraphQL æ¶æ„</figcaption>

</figure>

ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰çš„æœåŠ¡éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¦‚ä½•ä»è¿™äº›æœåŠ¡ä¸­æ£€ç´¢ä¿¡æ¯å‘¢ï¼Ÿåœ¨ä¸Šé¢çš„å¥å­ä¸­ä½¿ç”¨ resolve è¿™ä¸ªè¯å¹¶ä¸æ˜¯å¶ç„¶çš„ã€‚æˆ‘æ¥ä»‹ç»ä¸€ä¸‹è§£æå™¨ï¼

#### [](#resolvers)è§£æå™¨ğŸ“¡

ä¼—æ‰€å‘¨çŸ¥ï¼ŒæŸ¥è¯¢/å˜å¼‚/è®¢é˜…ç”±ä¸€ç»„å­—æ®µç»„æˆã€‚åœ¨ GraphQL æœåŠ¡å™¨å®ç°ä¸­ï¼Œè¿™äº›å­—æ®µä¸­çš„æ¯ä¸€ä¸ªå®é™…ä¸Šéƒ½å¯¹åº”äºä¸€ä¸ªç§°ä¸ºè§£æå™¨çš„å‡½æ•°ã€‚

è§£æå‡½æ•°çš„å”¯ä¸€ç›®çš„æ˜¯è·å–å…¶å­—æ®µçš„æ•°æ®ã€‚ç”±äºæ¯ä¸ªé¢†åŸŸéƒ½æœ‰å®ƒè‡ªå·±çš„ reducerï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»„åˆä¸åŒæœåŠ¡çš„å“åº”ã€‚

```
const CarResolver = {
 patent: async ({ id }) =\> {
 const patent = await getPatentFromDb(id);
 return patent;
 },
 owner: async ({ id }) =\> {
 const owner = await fetch(getOwnerInformatioById(id));
 return owner;
 }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æ‰€æœ‰è§£æå™¨è¿”å›ï¼ŒæœåŠ¡å™¨å°†ä»¥æŸ¥è¯¢æè¿°çš„æ ¼å¼æ”¶é›†æ‰€æœ‰æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€å›å®¢æˆ·ç«¯ã€‚

### [](#graphql-tools)GraphQL å·¥å…·ğŸ”§

GraphQL äº 2015 å¹´å‘å¸ƒï¼Œæœ‰è®¸å¤šå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨æ„å»ºè‡ªå·±çš„æœåŠ¡å™¨ï¼Œä½†åªæœ‰ä¸€ä¸ªå·¥å…·æ˜¯æ‚¨å¿…é¡»æ‹¥æœ‰çš„ã€‚å®ƒçš„åå­—å« [GraphiQL](https://github.com/graphql/graphiql) ã€‚

GraphQL é€šè¿‡æä¾›ä¸€ä¸ªä¾¿äºæ‰§è¡ŒæŸ¥è¯¢å’Œå˜å¼‚çš„å›¾å½¢ç•Œé¢ï¼Œå…è®¸å…¶ç”¨æˆ·æµ‹è¯•å’Œå‘ˆç° GraphQL APIsã€‚å®ƒä½¿ç”¨æ¨¡å¼æ¥æä¾›å…³äºæ•°æ®ç»“æ„å’Œç±»å‹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å®ƒè¿˜æ”¯æŒè‡ªåŠ¨å®Œæˆã€‚

æˆ‘å–œæ¬¢æŠŠå®ƒçœ‹ä½œæ˜¯é‚®é€’å‘˜å’Œå¤§æ‘‡å¤§æ‘†ä¹‹é—´çš„èåˆğŸ˜‚

<figure>[![](../Images/0e4882fd89e96d7f8edc1f3ff7b5079c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--JGB4aVgi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/600/1%2AIL7DumVFy5hJdvRdL1OdjA.gif) 

<figcaption>åŠ¨ä½œä¸­çš„ GraphiQl</figcaption>

</figure>

### [](#graphql-is-not-a-framework)GraphQL ä¸æ˜¯æ¡†æ¶â›”

æˆ‘å·²ç»è§£é‡Šäº† GraphQL æ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘æ²¡æœ‰æåˆ°ä»»ä½•å…³äºæ¡†æ¶æˆ–åº“çš„å†…å®¹ã€‚æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç° GraphQLï¼

æ ¹æ®æ‚¨å¸Œæœ›è¿è¡Œ GraphQL çš„æœåŠ¡å™¨ï¼Œæ‚¨å¿…é¡»ä¸ºæ‚¨çš„ç‰¹å®šæŠ€æœ¯å®‰è£…ä¸€ä¸ªä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿è¡Œçš„æ˜¯ express åç«¯ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»å®‰è£… express-graphqlã€‚happyã€koa ç­‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

æˆ‘çœŸçš„æƒ³æä¸€ä¸‹ï¼Œæœ‰ä¸€å®¶åä¸º Apollo çš„å¤§å…¬å¸åœ¨ GraphQL ä¸Šä¸‹äº†å¾ˆå¤§çš„èµŒæ³¨ã€‚ä»–ä»¬å·²ç»æ„å»ºäº†å¤§é‡æœ‰ç”¨çš„åº“æ¥å¯åŠ¨å’Œè¿è¡Œæ‚¨è‡ªå·±çš„ GraphQL æœåŠ¡å™¨ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°æ‚¨çš„å®¢æˆ·ç«¯ã€‚è¯·[æŸ¥çœ‹å®ƒä»¬](https://www.apollographql.com/)ï¼

### [](#use-cases)ç”¨ä¾‹ğŸ’ª

è¿™å¤ªæ£’äº†ï¼Œè¿™å¬èµ·æ¥åƒæ˜¯ä¸€é¡¹ä¼˜ç§€çš„æŠ€æœ¯ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æ˜¯æ¯ä¸ªäººéƒ½åœ¨æ„å»º GraphQL æœåŠ¡å™¨å‘¢ï¼ŸğŸ¤”

ç®€å•çš„å›ç­”æ˜¯å› ä¸ºä¹Ÿè®¸å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒï¼Œä¹Ÿè®¸æ„å»ºä¸€ä¸ª REST æœåŠ¡å™¨å°±è¶³ä»¥æ„å»ºä¸€ä¸ªè´¨é‡å¾ˆå¥½çš„è½¯ä»¶ã€‚æˆ‘è®¤ä¸º GraphQL åœ¨è¿™äº›æƒ…å†µä¸‹æ˜¯å¿…ä¸å¯å°‘çš„:

*   **ä¸å¤šä¸ªæœåŠ¡çš„è¿æ¥:**å®ƒå°†æ¯«æ— é—®é¢˜åœ°ä¸ä¸åŒçš„æœåŠ¡åä½œï¼Œç±»ä¼¼äºä¸€ä¸ªé—¨é¢ã€‚
*   **åŒ…è£…æ¥è‡ªæœåŠ¡å™¨çš„å“åº”:**å¯èƒ½ä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µ:æ‚¨å¿…é¡»ä¸ä¸€ä¸ªç«¯ç‚¹é€šä¿¡ï¼Œè€Œå®ƒçš„å“åº”æ ¼å¼ä¸æ­£ç¡®ã€‚
*   **ä¸åŒçš„å®¢æˆ·ç«¯å¹³å°:**å½“ä½ åœ¨å‡ ä¸ªå¹³å°ä¸Šå·¥ä½œæ—¶ï¼Œæ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ‰€ä»¥åªè¦åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šå®ƒä»¬å°±è¶³å¤Ÿäº†(è¿™æ˜¯ SDL è®©æˆ‘é«˜å…´çš„åœ°æ–¹)ã€‚

æˆ‘ç¡®ä¿¡è¿˜ä¼šæœ‰æ›´å¤šçš„æ¡ˆä¾‹ï¼Œä½†æ˜¯åœ¨æˆ‘çœ‹æ¥è¿™äº›æ˜¯æœ€é‡è¦çš„ï¼Œæ‰€ä»¥ä¸ºäº†ç¼©çŸ­åˆ—è¡¨ï¼Œæˆ‘åªé€‰æ‹©äº†è¿™ä¸‰ä¸ªã€‚

### [](#my-experience)æˆ‘çš„ç»å†ğŸ’¡

å¦‚æœæˆ‘æ²¡æœ‰å†™ä¸‹æˆ‘ä½¿ç”¨å®ƒçš„ç»éªŒï¼Œè¿™å°±ä¸æ˜¯ä¸€ç¯‡å®Œæ•´çš„æ–‡ç« ï¼è€ƒè™‘åˆ°ä¸Šé¢æè¿°çš„ç”¨ä¾‹ï¼Œæˆ‘åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹:æˆ‘éœ€è¦å»ºç«‹ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥è·å–ä¾å„’ï¼Œåœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºä»–ä»¬ï¼Œå½“ç‚¹å‡»æ—¶æŸ¥çœ‹å…¶ä¸­ä¸€ä¸ªçš„ä¿¡æ¯ã€‚

æˆ‘å°†è¿™ä¸ªé¡¹ç›®å‘½åä¸º [brastlewark-finder](https://github.com/EmaSuriano/brastlewark-finder) ã€‚æˆ‘å°†ä»å¤´å¼€å§‹è§£é‡Šå°† GraphQL æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚

<figure>[![](../Images/010eed296aa67b55d3051f1a357f1091.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--0jvs28lr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1020/1%2Aep3nRcvC3JnSNNv1u2e-Xg.gif)

<figcaption>brastle wark-finder ç¤ºä¾‹</figcaption>

</figure>

### [](#context)ä¸Šä¸‹æ–‡

è®©æˆ‘ä»¬çœ‹çœ‹ä»–ä»¬ç»™æˆ‘çš„ç«¯ç‚¹ã€‚å®ƒè¿”å›åŒ…å« 1336 é¡¹çš„åˆ—è¡¨ï¼Œç»“æ„å¦‚ä¸‹ã€‚

```
{
 "Brastlewark": [
 {
 "id": 0,
 "name": "Tobus Quickwhistle",
 "thumbnail":
 "[http://www.publicdomainpictures.net/pictures/10000/nahled/thinking-monkey-11282237747K8xB.jpg](http://www.publicdomainpictures.net/pictures/10000/nahled/thinking-monkey-11282237747K8xB.jpg)",
 "age": 306,
 "weight": 39.065952,
 "height": 107.75835,
 "hair\_color": "Pink",
 "professions": [
 "Metalworker",
 "Woodcarver",
 "Stonecarver",
 " Tinker",
 "Tailor",
 "Potter"
 ],
 "friends": ["Cogwitz Chillwidget", "Tinadette Chillbuster"]
 },
 {
 "id": 1
 }
 ]
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘æ³¨æ„åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œå¦‚æœä¸æŒ‰åç§°ä»å“åº”ä¸­è¿‡æ»¤æ•´ä¸ªæ•°ç»„ï¼Œæˆ‘å°±æ— æ³•è·å¾—æœ‹å‹çš„ä¿¡æ¯ã€‚ä½¿ç”¨æ—§é£æ ¼æå–çš„å¯èƒ½å®ç°å¯ä»¥æ˜¯:

```
const getGnomes = () =\> fetch('gnomeURL'); //will return the whole list of gnomes

const getGnomeById = (id, loadFriends = true) =\> {
 const gnome = getGnomes().then(gnomes =\> {
 const result = gnomes.filter(gnome =\> gnome.id === id);
 if (loadFriends) {
 const friendsId = gnomes
 .filter(({ name }) =\> result.friends.includes(name))
 .map(gnome =\> gnome.id);
 result.friends = Promise.all(
 friendsId.map(id =\> getGnomeById(id, false))
 );
 }
 return result;
 });
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œè¿™å°†å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜å’Œéå¸¸ç³Ÿç³•çš„ UXã€‚å¯èƒ½è¿˜æœ‰ä¸€äº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†æˆ‘çœ‹åˆ°è¿™æ˜¯ GraphQL çš„å®Œç¾åŒ¹é…ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç›¸åŒçš„ç»“æœï¼Œä½†æ˜¯åœ¨æœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨æ¥è‡ª GraphQL çš„æŸ¥è¯¢ï¼

```
export const GET\_GNOME\_BY\_ID = gql`
 query getGnomeById($id: ID!) {
 gnome(id: $id) {
 name
 thumbnail
 age
 weight
 height
 hair\_color
 professions
 friends {
 id
 name
 thumbnail
 professions
 }
 }
 }
`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figure>[![](../Images/d296402d73b815365bdaa15eee3ba884.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iGRSY1CX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/275/1%2AljTFIMmjzU5_IxkLssllAA.gif)

<figcaption>magic CCC</figcaption>

</figure>

### [](#implementation)å®ç°ğŸ‘·

å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œæ‚¨å¿…é¡»å†³å®šä½¿ç”¨å“ªç§å®ç°æ¥å¯åŠ¨å’Œè¿è¡Œæ‚¨çš„æœåŠ¡å™¨ã€‚æˆ‘å†³å®šä½¿ç”¨ Zeit çš„ [Micro](https://github.com/zeit/micro) å’Œ [Apollo server](https://github.com/apollographql/apollo-server) ï¼Œå› ä¸ºä»–ä»¬æœ‰éå¸¸å¥½çš„è§£é‡Šä¾‹å­ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œé€šè¿‡ GraphiQL [è¯•ç”¨ GraphiQL æœåŠ¡å™¨çš„æœ€ç»ˆç‰ˆæœ¬ï¼](https://brastlewark-finder-sotqubsuzd.now.sh/graphiql)

#### [](#server-definition)æœåŠ¡å™¨å®šä¹‰

æˆ‘ä»¬æœåŠ¡å™¨çš„å…¥å£æ˜¯ Micro çš„å®ä¾‹åŒ–ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„ GraphQL æœåŠ¡å™¨æ·»åŠ è·¯ç”±ã€‚è¿™ä¸»è¦æ˜¯ä½ ä¼šåœ¨é˜¿æ³¢ç½—çš„ä¾‹å­ä¸­å‘ç°çš„ã€‚

```
import { microGraphiql, microGraphql } from 'apollo-server-micro';
import cors from 'micro-cors';
import micro, { send } from 'micro';
import { get, post, router } from 'microrouter';
import schema from './schema';

const graphqlHandler = microGraphql({ schema });
const graphiqlHandler = microGraphiql({ endpointURL: '/graphql' });

const corsUpdater = cors();

const server = micro(
 corsUpdater(
 router(
 get('/graphql', graphqlHandler),
 post('/graphql', graphqlHandler),
 get('/graphiql', graphiqlHandler),
 (req, res) =\> send(res, 404, 'not found')
 )
 )
);

server.listen(3001, () =\> {
 console.log(`Go to [http://localhost](http://localhost/):${3001}/graphiql to run queries!`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#graphql-schema)GraphQL æ¨¡å¼

æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œæ¨¡å¼æ˜¯æˆ‘ä»¬ä¸º GraphQL æœåŠ¡å™¨å®šä¹‰ç»“æ„çš„åœ°æ–¹ã€‚å½“æˆ‘ä»¬è°ƒç”¨ makeExecutableSchema æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å‘é€æ‰€æœ‰çš„ç±»å‹å®šä¹‰(QueryTypeã€ObjectTypeã€MutationType ç­‰ã€‚)ä»¥åŠå®ƒä»¬å„è‡ªçš„è§£æå™¨ã€‚

åœ¨æˆ‘å®šä¹‰çš„ typeDefs ä¸­:

*   gnome:è¿™æ˜¯ä»£è¡¨æœåŠ¡å™¨å†…éƒ¨ Gnome å®ä½“çš„ ObjectTypeï¼Œå®ƒå­˜å‚¨äº†ä¸€ä¸ª Gnome çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå¹¶å°†ä½œä¸ºå¯¹è±¡å‘é€åˆ°å®¢æˆ·ç«¯ã€‚
*   æŸ¥è¯¢:
*   allgnomes:æ¥æ”¶è¿‡æ»¤ Gnomes çš„æ ‡å‡†(åå­—å’Œä¸€ç»„èŒä¸š)å¹¶è¿”å›ä¸€ç»„ Gnomesã€‚
*   gnome:æ¥æ”¶ä¸€ä¸ª id(å¼ºåˆ¶å­—æ®µ)å¹¶è¿”å›å¸¦æœ‰è¯¥ Id çš„ Gnomeã€‚

å½“æœåŠ¡è¿”å›çš„å¯¹è±¡çš„å…³é”®å­—åŒ¹é…æ—¶ï¼ŒGnome ObjectType ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½ä¼šè¢«è‡ªåŠ¨è§£æï¼Œé™¤äº†æœ‹å‹ï¼å¦‚æœä½ çœ‹ä¸€ä¸‹è§£æå™¨çš„å†…éƒ¨ï¼Œä½ ä¼šå‘ç° Gnome é‡æ–°å®šä¹‰äº†è·å– Gnome å¥½å‹çš„åŠŸèƒ½ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§éå¸¸ç®€å•çš„æ–¹å¼ä¿®æ”¹æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ğŸ˜ƒ

```
import { makeExecutableSchema } from 'graphql-tools';
import { getGnomes, getGnomeById } from './query';

const typeDefs = `
 type Query { allGnomes(name: String, professions: [String]): [Gnome], gnome(id: ID!): Gnome }
 type Gnome {
 id: ID!,
 name: String,
 thumbnail: String,
 age: Int,
 weight: Float,
 height: Float,
 hair\_color: String,
 professions: [String],
 friends: [Gnome],
 createdAt: Int,
 }
`;

const resolvers = {
 Query: { allGnomes: getGnomes, gnome: getGnomeById },
 Gnome: {
 friends: async ({ friends }) =\> {
 const gnomes = await getGnomes();
 return gnomes.filter(({ name }) =\> friends.includes(name));
 }
 }
};

export default makeExecutableSchema({
 typeDefs,
 resolvers
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#query)æŸ¥è¯¢

è¿™æ˜¯æˆ‘ä»¬ä» API non-REST è·å–æ•°æ®çš„åœ°æ–¹ï¼Œä¹Ÿåº”ç”¨äº†æŒ‰å§“åå’Œ/æˆ–èŒä¸šè¿‡æ»¤çš„é€»è¾‘ã€‚æˆ‘ä½¿ç”¨ memoize åªæ˜¯ä¸ºäº†é¿å…å¤šæ¬¡è·å–ç›¸åŒçš„èµ„æºï¼Œå› ä¸ºå®ƒå°†æ€»æ˜¯è¿”å›ç›¸åŒçš„æ•°æ®â€¦

```
import fetch from 'node-fetch';
import memoize from 'fast-memoize';
import BASE\_URL from './constants';

const fetchGnomes = memoize(async () =\> {
 const rawData = await fetch(BASE\_URL);
 const jsonData = await rawData.json();
 return jsonData.Brastlewark;
});

const getGnomes = async (\_, args) =\> {
 const gnomes = await fetchGnomes();
 if (!args) return gnomes;

const { name = '', professions = [] } = args;
 return gnomes.filter(
 gnome =\>
 (!name || new RegExp(name, 'i').test(gnome.name)) &&
 (!professions.length ||
 professions.every(prof =\> gnome.professions.includes(prof)))
 );
};

const getGnomeById = async (\_, { id }) =\> {
 const gnomes = await fetchGnomes();
 return gnomes.find(gnome =\> gnome.id == id);
};

export { getGnomes, getGnomeById }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘çœŸçš„å¾ˆå–œæ¬¢ä½¿ç”¨ GraphQL å’Œä½¿ç”¨ Apollo å®ç°ï¼Œå½“ä½ åˆ°äº†æ‰€æœ‰ä¸œè¥¿éƒ½è¿æ¥èµ·æ¥çš„æ—¶å€™ï¼Œå¼€å‘å°±æ£’æäº†ï¼ğŸ¤©

### [](#related-links)ç›¸å…³é“¾æ¥

*   [graph QL ç®€ä»‹](http://graphql.org/learn/)
*   [graph QL çš„å…¨æ ˆæ•™ç¨‹](https://www.howtographql.com/)
*   [å¯è§†åŒ–çš„ GraphQL æ¦‚å¿µ](https://dev-blog.apollodata.com/the-concepts-of-graphql-bc68bd819be3)
*   [GraphQL Server Basics](https://blog.graph.cool/graphql-server-basics-the-schema-ac5e2950214e)
*   [å¦‚ä½•ç”¨ GraphQL åŒ…è£… REST API](https://blog.graph.cool/how-to-wrap-a-rest-api-with-graphql-8bf3fb17547d)
*   [ä½¿ç”¨ GraphQL çš„äº”å¤§ç†ç”±](https://blog.graph.cool/top-5-reasons-to-use-graphql-b60cfa683511)