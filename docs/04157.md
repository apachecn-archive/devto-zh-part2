# 网络基础:路由器设计

> 原文:[https://dev.to/swyx/networking-essentials-router-design-ahc](https://dev.to/swyx/networking-essentials-router-design-ahc)

*这是我参加[免费的 Udacity 计算机网络基础课程](https://www.udacity.com/course/computer-networking--ud436)的一系列课堂笔记中的第五篇。*

我们来做一个路由器吧！

## [](#basic-router-architecture)基本路由器架构

路由器的基本工作如下:

1.  接收数据包
2.  查看标题以确定目的地
3.  **查找**转发表，确定输出接口
4.  修改报头(例如，减少 TTL -生存时间字段并更新报头校验和)
5.  将数据包发送到输出接口

所有这些都是通过一个单独的**线路卡**来完成的，每个线路卡都有:一个**查找表**，修改报头的能力，以及一个用于进出卡的数据包的缓冲区。路由器通过**互连结构**连接一堆**线卡**。

值得注意的两件事:

*   **为什么一卡一桌？**每张卡都有自己的查找表副本。我们曾经做过替代方案，即整个路由器的中央表，但这是一个瓶颈，因为每个卡都必须通过共享总线与中央表通信。
*   **在互连结构上**:我们使用一个纵横制交换机(又名交换背板)让不冲突的输入输出对同时发送数据，而不是共享总线(一次仅限一个输入/输出)。每个输入端口都有到每个输出端口的连接，这实现了并行性，但需要某种调度算法来确保公平使用。

## [](#maximal-matching-in-crossbar-switching-algorithm)纵横制交换算法中的最大匹配

N 个输入和 N 个输出之间的最大匹配意味着:

*   尽可能分配一对一的输入到输出
*   剩余的需求被放入队列中
*   许多交叉开关都有“加速”功能，即互连速度是线路卡的 2 倍，以实现 2 倍的匹配速度。这是一种常见的做法，但是队列头阻塞仍然不能通过加速来解决。

**线头阻塞**是指在应该发送到不同输出端的另一个数据包之前，有许多目的地相同的数据包(因此不应该等待其他数据包清除)。解决方案是**虚拟输出队列**，我们为每个输出端口建立一个队列。

## [](#scheduling-and-fairness)调度和公平性

纵横制交换涉及**调度**——这里的两个目标是:

*   **效率**:如果有从输入到输出发送流量的可用容量，则应该用完。
*   **公平**:每个输入处的每个队列都应该被“公平”地调度——通常是一种被称为**最大最小公平**的想法，这就像帕累托最优，你不能在不使其他事情变得更糟的情况下使一些事情变得更好。

最大-最小公平性可以通过以下方式实现:

*   循环调度(尽管数据包可能有不同的大小，因此是不公平的)
*   逐位调度(这可能是不切实际的，你如何将数据包分成位)
*   “公平排队”(计算每个数据包的“虚拟完成时间”，并为完成时间最短的数据包提供服务)

## [](#next-in-our-series)我们系列的下一个

希望这是对路由协议和 BGP 的一个很好的高层次概述。我正在计划更多的初级读本，希望您能就以下方面提供反馈和问题:

*   [架构和原理](https://dev.to/swyx/networking-essentials-architecture-and-principles-2g5e)
*   [切换](https://dev.to/swyx/networking-essentials-switching-3eba)
*   [路由](https://dev.to/swyx/networking-essentials-routing-5gb7/)
*   [命名/寻址/转发](https://dev.to/swyx/networking-essentials-naming-addressing-and-forwarding-13kk)
*   路由器设计
*   域名服务器(Domain Name Server)
*   拥塞控制和流式传输
*   速率限制和流量整形
*   内容分发
*   软件定义网络
*   交通工程
*   网络安全性