# React é’©å­:å¦‚ä½•åˆ›å»ºå’Œæ›´æ–°ä¸Šä¸‹æ–‡ï¼Ÿä¾›åº”è€…

> åŸæ–‡:[https://dev . to/oieduardorabelo/react-hooks-how-to-create-and-update-context provider-1f 68](https://dev.to/oieduardorabelo/react-hooks-how-to-create-and-update-contextprovider-1f68)

å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å¬è¯´â€œReact Hooks â€,ä½ å¯ä»¥[è§‚çœ‹ React Conf ä»‹ç»æ¼”è®²](https://www.youtube.com/watch?v=dpw9EHDh2bM)ã€‚å€¼å¾—ï¼

æˆ‘ä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´è§£é‡Šæ–°çš„ APIï¼Œä¸ºæ­¤ï¼Œ[ä½ å¯ä»¥å»ä»–ä»¬çš„æ–‡æ¡£](https://reactjs.org/docs/hooks-intro.html)ã€‚React å›¢é˜Ÿåšå‡ºäº†æƒŠäººçš„å·¥ä½œï¼Œè§£é‡Šäº†æ‰€æœ‰çš„åŸå› ä»¥åŠä»–ä»¬æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚

# [](#getting-started)å…¥é—¨

æœ‰äº†å®é™…æ“ä½œçš„ä¾‹å­ï¼Œä¸€åˆ‡éƒ½ä¼šå˜å¾—æ›´å¥½ï¼Œè®©æˆ‘ä»¬ä»ä»¥ä¸‹å†…å®¹å¼€å§‹:

```
$ mkdir react-hooks-contex-provider
$ cd react-hooks-contex-provider
$ yarn init -y
$ yarn add react@^16.7.0-alpha.0 react-dom@^16.7.0-alpha.0
$ yarn add parcel-bundler 
```

æœ‰äº†è¿™ä¸ªæ ·æ¿ï¼Œæˆ‘ä»¬å·²ç»:

*   åœ¨ alpha ç‰ˆæœ¬ä¸­ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„é’©å­`use*`è¿›è¡Œååº”
*   package Bundler è¿è¡Œæˆ‘ä»¬çš„æœ¬åœ°ç¤ºä¾‹

è®©æˆ‘ä»¬æ·»åŠ æˆ‘ä»¬çš„ HTML æ–‡ä»¶:

```
$ touch index.html 
```

æ·»åŠ ä¸€äº› HTML:

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>React Parcel</title>
</head>
<body>
  <div id="root"></div>
  <script src="./src/index.js"></script>
</body>
</html> 
```

æ­£å¦‚æˆ‘ä»¬åœ¨ HTML ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`./src/index.js`æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå®ƒ:

```
$ mkdir src
$ touch src/index.js 
```

æ·»åŠ ä¸€äº› JavaScript:

```
import * as React from "react";
import * as ReactDOM from "react-dom";

import { ContextOneProvider } from "./ContextOne";
import { App } from "./App";

function main(target, container) {
  ReactDOM.render(target, container);
}

main(
  <ContextOneProvider>
    <App />
  </ContextOneProvider>,
  document.getElementById("root")
); 
```

è¿™é‡Œæ²¡ä»€ä¹ˆä¸åŒã€‚æˆ‘ä»¬ç†Ÿæ‚‰çš„`ReactDOM.render`å‘ˆç°äº†ä¸€ä¸ªåä¸º`App`çš„ç»„ä»¶ï¼Œå®ƒè¢«åŒ…è£…åœ¨ä¸€ä¸ªåä¸º`ContextOneProvider`çš„ä¸Šä¸‹æ–‡ä¸­ã€‚

# [](#creating-our-contextone-file)åˆ›å»ºæˆ‘ä»¬çš„ä¸Šä¸‹æ–‡æ–‡ä»¶

æ¥è‡ªæˆ‘ä»¬çš„`./src/index.js`çš„è·Ÿè¿›å¯ä»¥æ˜¯æˆ‘ä»¬çš„`./src/ContextOne.js`ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå®ƒ:

```
$ touch src/ContextOne.js 
```

å¹¶ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:

```
import * as React from "react";

let ContextOne = React.createContext();

let initialState = {
  count: 10,
  currentColor: "#bada55"
};

let reducer = (state, action) => {
  switch (action.type) {
    case "reset":
      return initialState;
    case "increment":
      return { ...state, count: state.count + 1 };
    case "decrement":
      return { ...state, count: state.count - 1 };
    case "set-color":
      return { ...state, currentColor: action.payload };
  }
};

function ContextOneProvider(props) {
  // [A]
  let [state, dispatch] = React.useReducer(reducer, initialState);
  let value = { state, dispatch };

  // [B]
  return (
    <ContextOne.Provider value={value}>{props.children}</ContextOne.Provider>
  );
}

let ContextOneConsumer = ContextOne.Consumer;

// [C]
export { ContextOne, ContextOneProvider, ContextOneConsumer }; 
```

æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€äº›æ–°é¢å­”ï¼Œå—¯ï¼Ÿ90%çš„ä»£ç éƒ½æŒºç†Ÿæ‚‰çš„ï¼Œæˆ‘ä»¬æ¥è€ƒå¯Ÿä¸€ä¸‹**ã€Aã€‘****ã€Bã€‘****ã€Cã€‘**é¡¹ã€‚

*   **ã€Aã€‘**:æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†æ–°çš„ [React Hooks APIï¼Œåä¸º`useReducer`](https://reactjs.org/docs/hooks-reference.html#usereducer) ã€‚å¦‚æœä½ ç†Ÿæ‚‰ Reduxï¼Œä½ å·²ç»çŸ¥é“è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å®ƒå°†è¿”å›`state`å¯¹è±¡å’Œä¸€ä¸ª`dispatch`å‡½æ•°æ¥å‘é€å¯¹å­˜å‚¨çŠ¶æ€çš„æ›´æ–°ã€‚æˆ‘ä»¬æ­£åœ¨ç”¨è¿™ä¸¤è€…åˆ›å»ºä¸€ä¸ª`value`å¯¹è±¡ï¼Œå¹¶å°†å®ƒå‘é€ç»™æˆ‘ä»¬çš„ item**ã€Bã€‘**ã€‚
*   **ã€Bã€‘**:åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡æä¾›è€…æ³¨å…¥`value`å¯¹è±¡ï¼Œä½¿å…¶å¯¹æ‰€æœ‰æ¶ˆè´¹è€…å¯ç”¨ã€‚ä¹‹å‰æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå°†æˆ‘ä»¬çš„`<App />`åŒ…è£…åœ¨`./src/index.js`ä¸­ï¼Œè¿™æ„å‘³ç€æ¥è‡ª`<App />`çš„æ‰€æœ‰å­ç»„ä»¶å°†èƒ½å¤Ÿæ‹‰å‡ºè¿™ä¸ªä¸Šä¸‹æ–‡æ¥ä½¿ç”¨ã€‚
*   **ã€Cã€‘**:ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªå‡ºå£å¾ˆå¥‡æ€ªã€‚æˆ‘ä»¬æ­£åœ¨å¯¼å‡ºç”± Reactã€`ContextOne`ã€æˆ‘ä»¬çš„å®šåˆ¶æä¾›è€…ã€`ContextOneProvider`åˆ›å»ºçš„é»˜è®¤ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä»¥åŠæ¶ˆè´¹è€…é”®çš„åˆ«åã€`ContextOneConsumer`ã€‚è¦ä¸ºä¸Šä¸‹æ–‡ä½¿ç”¨æ–°çš„ [Reactk Hooks APIï¼Œç§°ä¸º useContext](https://reactjs.org/docs/hooks-reference.html#usecontext) ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’ React åˆ›å»ºçš„é»˜è®¤å¯¹è±¡ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå¯¼å‡ºã€‚ç¬¬äºŒä¸ªå¯¼å‡ºï¼Œ`ContextOneProvider`ï¼Œæ˜¯æˆ‘ä»¬çš„è‡ªå®šä¹‰æä¾›è€…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ³¨å…¥æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚æœ€åä¸€ä¸ªå¯¼å‡ºï¼Œ`ContextOneConsumer`ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿è®¢é˜…ä¸Šä¸‹æ–‡å˜åŒ–ï¼Œ[è¿™æ˜¯ React](https://reactjs.org/docs/context.html#contextconsumer) çš„ä¸€ä¸ªç¨³å®šç‰¹æ€§ã€‚

# [](#creating-our-app-file)åˆ›å»ºæˆ‘ä»¬çš„åº”ç”¨æ–‡ä»¶

æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œè®©æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹æˆ‘ä»¬çš„`./src/App.js`æ–‡ä»¶:

```
$ touch src/App.js 
```

ç²˜è´´ä¸€äº› JavaScript ä»£ç :

```
import * as React from "react";

import { ContextOne } from "./ContextOne";

export function App() {
  // [A]
  let { state, dispatch } = React.useContext(ContextOne);

  // [B]
  React.useEffect(
    () => {
      document.body.style.backgroundColor = state.currentColor;
    },
    [state.currentColor]
  );

  // [C]
  let inc = () => dispatch({ type: "increment" });
  let dec = () => dispatch({ type: "decrement" });
  let reset = () => dispatch({ type: "reset" });
  let setColor = color => () => dispatch({ type: "set-color", payload: color });

  return (
    <React.Fragment>
      <div style={{ textAlign: "center" }}>
        <p>
          Current color is: <b>{state.currentColor}</b>
        </p>
        <p>
          Current count: <b>{state.count}</b>
        </p>
      </div>
      <div style={{ paddingTop: 40 }}>
        <p>Count controls:</p>
        <button onClick={inc}>Increment!</button>
        <button onClick={dec}>Decrement!</button>
      </div>
      <div>
        <p>Color controls:</p>
        <button onClick={setColor("green")}>Change to green!</button>
        <button onClick={setColor("papayawhip")}>Change to papayawhip!</button>
      </div>
      <div>
        <p>Reset changes:</p>
        <button onClick={reset}>Reset!</button>
      </div>
    </React.Fragment>
  );
} 
```

Wowwï¼Œç°åœ¨å‘¢ï¼ŸåŒæ ·ï¼Œ90%çš„ä»£ç æ˜¯ç†Ÿæ‚‰çš„ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥å¦å¤– 10%çš„ä»£ç :

*   **ã€Aã€‘**:æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨[åä¸º useContext](https://reactjs.org/docs/hooks-reference.html#usecontext) çš„æ–° React Hooks API æ¥æ¶ˆè´¹æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡(æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å¯¼å…¥ React åˆ›å»ºçš„`ContextOne`å¯¹è±¡)ã€‚å½“æä¾›è€…æ›´æ–°æ—¶ï¼Œè¿™ä¸ªé’©å­å°†è§¦å‘ä¸€ä¸ªå¸¦æœ‰æœ€æ–°ä¸Šä¸‹æ–‡å€¼çš„é‡æ–°å‘ˆç°å™¨ã€‚
*   **ã€Bã€‘**:å¦ä¸€ä¸ªæ–°çš„ [React Hooks API å«åš useEffect](https://reactjs.org/docs/hooks-reference.html#useeffect) ã€‚å°†æ•ˆæœè§†ä¸ºä» React çš„çº¯åŠŸèƒ½ä¸–ç•Œè¿›å…¥å‘½ä»¤ä¸–ç•Œçš„å‡ºå£ã€‚ä»»ä½•å˜å¼‚ï¼Œè®¢é˜…ï¼Œå®šæ—¶å™¨å’Œå…¶ä»–å‰¯ä½œç”¨ä½ éƒ½å¯ä»¥ç”¨è¿™ä¸ªé’©å­æ¥åšã€‚ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œæ”¹å˜ç‰©ä½“çš„èƒŒæ™¯é¢œè‰²ã€‚ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å‘Šè¯‰ reactâ€œå˜¿ï¼Œå½“è¿™äº›å±æ€§/å€¼æ”¹å˜æ—¶è¿è¡Œæˆ‘çš„æ•ˆæœâ€ã€‚
*   **ã€Cã€‘**:æ™®é€šçš„ JavaScript ç®­å¤´å‡½æ•°ï¼Œä½†æ˜¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„`dispatch`å‡½æ•°æ¥æ›´æ–°æˆ‘ä»¬çš„æä¾›è€…ã€‚

# [](#running-our-example)è¿è¡Œæˆ‘ä»¬çš„ä¾‹å­

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è¾¾æˆäº†çœŸæ­£çš„äº¤æ˜“ï¼Œè®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„ç¤ºä¾‹:

```
$ yarn parcel index.html 
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

[![](../Images/d322ecb6611d3e82306c3406395e7eeb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2qoN1lnX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3vs2egyliuthdj4b4xno.png)

æ‰“å¼€ä½ çš„`localhost:1234`:

[![](../Images/26a821ae7acf5eedf2e4780656c1e26c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iUAZE_eS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/dwhzpcexgwll0uxqtziy.png)

# [](#conclusion)ç»“è®º

[React Hooks API](https://reactjs.org/docs/hooks-reference.html) æå…¶å¼ºå¤§ã€‚Twitter ä¸Šçš„[ç¤¾åŒº](https://twitter.com/search?f=tweets&q=%23react%20%23hooks&src=typd)å¼€å¯äº†ğŸ”¥ã€‚æˆ‘ä»¬å·²ç»åœ¨ GitHub ä¸Šæœ‰äº†[çš„å¥½ä¾‹å­ã€‚](https://github.com/topics/react-hooks)

ä½ æ€ä¹ˆæƒ³å‘¢?ä½ ä¸Šé’©äº†å—ï¼Ÿ:P