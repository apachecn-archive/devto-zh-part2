# åœ¨ Dart 2 ä¸­æ„å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åº(ç¬¬ 2 éƒ¨åˆ†)

> åŸæ–‡:[https://dev . to/graphicbeacon/build-a-chat-application-in-dart-2-part-2-48df](https://dev.to/graphicbeacon/build-a-chat-application-in-dart-2-part-2-48df)

åœ¨[ç¬¬ 1 éƒ¨åˆ†](https://dev.to/graphicbeacon/build-a-basic-chat-application-in-dart-2-part-1-4ekj)ä¸­ï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„èŠå¤©ç™»å½•å±å¹•æ„å»ºäº† UIï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªåŸºæœ¬æµç¨‹ï¼Œä¸€æ—¦ç”¨æˆ·åæˆåŠŸéªŒè¯ï¼Œå°±è½¬æ¢åˆ°èŠå¤©å®¤ UIã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†é‡æ„æˆ‘ä»¬çš„å·¥ä½œè§£å†³æ–¹æ¡ˆï¼Œå¹¶å®ç°ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±å™¨æ¥å¤„ç†è§†å›¾ä¹‹é—´çš„è½¬æ¢ã€‚è¿™æ˜¯èŠå¤©æµç¨‹çš„ç¤ºæ„å›¾:

[![Diagram of chat flow](../Images/cf822f44196a79f3dcab32ed3be1e671.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PYzJqyQh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/l1s6n4fkcpur4hy7xwe2.png)

æˆ‘ä»¬è¿˜æœ‰ä¸€ç‚¹è¦è®²ï¼Œæ‰€ä»¥ä¸å†å¤šè¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼

* * *

## [](#1-encapsulate-logic-for-sign-in-ui)1ã€‚å°è£…ç™»å½• UI çš„é€»è¾‘

ç›®å‰æˆ‘ä»¬åœ¨`web/main.dart`ä¸­æœ‰æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œå¦‚æœæˆ‘ä»¬ç»§ç»­åœ¨é‚£ä¸ªé€»è¾‘ä¸Šæ„å»ºï¼Œå®ƒå°†æ˜¯ä¸€ä¸ªç»´æŠ¤å¤œä»¶ï¼æ‰€ä»¥æˆ‘ä»¬å°†åœ¨ä¸€ä¸ª`View`ç±»ä¸­ç®¡ç†æ¯ä¸ªå±å¹•çš„é€»è¾‘ã€‚

åœ¨ä¸‹é¢çš„`web`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºåŒ…å«ä¸‹åˆ—æ–‡ä»¶çš„ç›®å½•:

```
views/
  chat_room.dart
  chat_signin.dart
  view.dart 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨åœ¨`view.dart`ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå®ƒå°†è¢«ç”¨ä½œæˆ‘ä»¬è§†å›¾ç±»çš„è“å›¾:

```
abstract class View {
  void onEnter(); // Run this when the view is loaded in
  void onExit();  // Run this when we exit the view
  void prepare(); // Prepare the view template, register event handlers etc... before mounting on the page
  void render();  // Render the view on the screen
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ ä»¬ä¸­çš„ä¸€äº›äººå¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨`abstract class`è€Œä¸æ˜¯`interface`å…³é”®å­—ï¼Ÿ**å›ç­”:**é£é•–é˜Ÿåšåˆ°äº†ï¼åŸºæœ¬åŸç†æ˜¯ç±»æ˜¯éšå¼æ¥å£ï¼Œæ‰€ä»¥ä¸ºäº†ç®€åŒ–ï¼Œä»–ä»¬åšæŒä½¿ç”¨æŠ½è±¡ç±»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥**æ‰©å±•**æˆ–è€…**å®ç°**ä¸€ä¸ªæŠ½è±¡ç±»ã€‚*

è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ¥å£æ¥å®ç°æˆ‘ä»¬åœ¨`chat_signin.dart` :
ä¸­çš„è§†å›¾

```
// Absolute imports
import 'dart:html';

// Relative imports
import './view.dart';

class ChatSigninView implements View {
  ChatSigninView() : _contents = DocumentFragment() {
    onEnter();
  }

  /// Properties
  DocumentFragment _contents;
  DivElement chatSigninBox;
  ParagraphElement validationBox;
  InputElement nameField;
  ButtonElement submitBtn;
  HttpRequest _response;

  @override
  void onEnter() {
    prepare();
    render();
  }

  @override
  void onExit() {}

  @override
  void prepare() {}

  @override
  void render() {}
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿è¡Œæ„é€ å‡½æ•°ä½“ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„`DocumentFragment`åˆå§‹åŒ–`_contents`ã€‚æˆ‘ä»¬å°†ç”¨æˆ‘ä»¬çš„æ¨¡æ¿å¡«å……å®ƒï¼Œå¹¶åœ¨æ’å…¥é¡µé¢ä¹‹å‰å®šä¹‰æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚

è®©æˆ‘ä»¬å®ç°ä½¿ç”¨`_contents` :
çš„`prepare()`æ–¹æ³•

```
@override
void prepare() {
  _contents.innerHtml = '''
  <div id="ChatSignin">
      <h1 class="title">Chatter ğŸ¯</h1>
      <div class="columns">
        <div class="column is-6">
          <div class="field">
            <label class="label">Please enter your name</label>
            <div class="control is-expanded has-icons-left">
              <input class="input is-medium" type="text" placeholder="Enter your name and hit ENTER" />
              <span class="icon is-medium is-left">
                <i class="fas fa-user"></i>
              </span>
            </div>
            <p class="help is-danger"></p>
          </div>
          <div class="field">
            <div class="control">
              <button class="button is-medium is-primary">
                Join chat
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    ''';

  chatSigninBox = _contents.querySelector('#ChatSignin');
  validationBox = chatSigninBox.querySelector('p.help');
  nameField = chatSigninBox.querySelector('input[type="text"]');
  submitBtn = chatSigninBox.querySelector('button');

  _addEventListeners(); // TODO: Implement this method
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æ¥å®ç°`_addEventListeners()`åŠå…¶ç›¸å…³æ–¹æ³•:

```
class ChatSigninView implements View {
  ...
  ...
  void _addEventListeners() {
    // Event listeners on form controls
    nameField.addEventListener('input', _inputHandler);
    submitBtn.addEventListener('click', _clickHandler);
  }

  void _inputHandler(evt) {
    if (nameField.value.trim().isNotEmpty) {
      nameField.classes
        ..removeWhere((className) => className == 'is-danger')
        ..add('is-success');
      validationBox.text = '';
    } else {
      nameField.classes
        ..removeWhere((className) => className == 'is-success')
        ..add('is-danger');
    }
  }

  void _clickHandler(evt) async {
    // Validate name field
    if (nameField.value.trim().isEmpty) {
      nameField.classes.add('is-danger');
      validationBox.text = 'Please enter your name';
      return;
    }

    submitBtn.disabled = true;

    // Submit name to backend via POST
    try {
      _response = await HttpRequest.postFormData(
        'http://localhost:9780/signin',
        {
          'username': nameField.value,
        },
      );

      // Handle success response and switch view
      onExit();
    } catch (e) {
      // Handle failure response
      submitBtn
        ..disabled = false
        ..text = 'Failed to join chat. Try again?';
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„å¤§éƒ¨åˆ†é€»è¾‘éƒ½æ˜¯ä»æœ¬ç³»åˆ—ç¬¬ 1 éƒ¨åˆ†çš„`web/main.dart`ç§»è¿‡æ¥çš„ã€‚

`_inputHandler()`ç§æœ‰æ–¹æ³•è´Ÿè´£éªŒè¯è¾“å…¥æ–‡æœ¬å­—æ®µå¹¶æ·»åŠ é€‚å½“çš„ç±»ã€‚`_clickHandler()`ç§æœ‰æ–¹æ³•å°†éªŒè¯å¹¶æäº¤è¡¨å•ï¼Œæäº¤åˆ°ä½äº`http://localhost:9780/signin`çš„ç«¯ç‚¹ã€‚ç»“æœè¢«åˆ†é…ç»™`_response`å®ä¾‹å˜é‡ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨`onExit()`æ–¹æ³•ï¼Œå®ƒå°†æŠŠå“åº”æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè§†å›¾ã€‚

è®©æˆ‘ä»¬å°†å‡†å¤‡å¥½çš„æ–‡æ¡£ç‰‡æ®µå‘ˆç°åˆ°å±å¹•ä¸Š:

```
@override
void render() {
  querySelector('#app')
    ..innerHtml = ''
    ..append(_contents);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶ç¡®å®šæˆ‘ä»¬çš„é€€å‡ºç­–ç•¥:

```
@override
void onExit() {
  nameField.removeEventListener('input', _inputHandler);
  submitBtn.removeEventListener('click', _clickHandler);

  // Swap view to chat room
  // TODO: Transition to Chat room screen
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¦åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹è¯¥è§†å›¾ï¼Œè¯·æ›´æ–°`web/main.dart` :

```
import './views/chat_signin.dart';

void main() {
  ChatSigninView();
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`web/index.html`çš„`<body>`æ ‡è®°æ›´æ”¹å¦‚ä¸‹:

```
<section class="section">
  <div class="container" id="app">
    <!-- Views will be rendered here -->
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œ`webdev`æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨
ä¸­è®¿é—®`http://localhost:8080`

```
webdev serve --live-reload 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![Chat signin view](../Images/484e742cb7f301ec471a18552d9e3959.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--XvIGz480--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vgzc4i81sv7hkibzgk8c.png)

## [](#2-encapsulate-logic-for-chat-room-ui)2ã€‚èŠå¤©å®¤ UI çš„å°è£…é€»è¾‘

åœ¨`web/views/chat_room.dart` :
ä¸­å®šä¹‰ä¸€ä¸ª`ChatRoomView`ç±»

```
// Absolute imports
import 'dart:html';

// Relative imports
import './view.dart';

class ChatRoomView implements View {
  ChatRoomView(this.params)
      : _contents = DocumentFragment() {
    onEnter();
  }

  /// Properties
  Map params;
  DocumentFragment _contents;
  DivElement chatRoomBox;
  DivElement chatRoomLog;
  InputElement messageField;
  ButtonElement sendBtn;

  @override
  void onEnter() {
    prepare();
    render();
  }

  @override
  void onExit() {
    _removeEventListeners(); // TODO: Implement this method

    // TODO: Transition to chat sign in screen
  }

  @override
  void prepare() {
  _contents.innerHtml = '''
    <div id="ChatRoom">
        <h1 class="title">Chatroom</h1>
        <div class="tile is-ancestor">
          <div class="tile is-8 is-vertical is-parent">
            <div class="tile is-child box">
              <div id="ChatRoomLog"></div>
            </div>
            <div class="tile is-child">
              <div class="field has-addons">
                <div class="control is-expanded has-icons-left">
                  <input id="ChatRoomMessageInput" class="input is-medium" type="text" placeholder="Enter message" />
                  <span class="icon is-medium is-left">
                    <i class="fas fa-keyboard"></i>
                  </span>
                </div>
                <div class="control">
                  <button id="ChatRoomSendBtn" class="button is-medium is-primary">
                    Send&nbsp;&nbsp;
                    <span class="icon is-medium">
                      <i class="fas fa-paper-plane"></i>
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      ''';

    chatRoomBox = _contents.querySelector('#ChatRoom');
    chatRoomLog = chatRoomBox.querySelector('#ChatRoomLog');
    messageField = chatRoomBox.querySelector('#ChatRoomMessageInput');
    sendBtn = chatRoomBox.querySelector('#ChatRoomSendBtn');

    _addEventListeners(); // TODO: Implement this method next
  }

  @override
  void render() {
    querySelector('#app')
      ..innerHtml = ''
      ..append(_contents);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æ¥å®ç°`_addEventListeners()`å’Œ`_removeEventListeners()` :

```
void _addEventListeners() {
  sendBtn.disabled = true;

  /// Event listeners
  messageField.addEventListener('input', _messageFieldInputHandler);
  sendBtn.addEventListener('click', _sendBtnClickHandler);
}

void _removeEventListeners() {
  messageField.removeEventListener('input', _messageFieldInputHandler);
  sendBtn.removeEventListener('click', _sendBtnClickHandler);
}

void _messageFieldInputHandler(e) {
  // Disable the send button if message input is empty
  sendBtn.disabled = messageField.value.isEmpty;
}

void _sendBtnClickHandler(e) {
  // TODO: Broadcast message to other chat users
  messageField.value = '';
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ—¢ç„¶å°è£…äº†ä¸¤ä¸ªè§†å›¾çš„é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨ä¸¤è€…ä¹‹é—´è½¬æ¢ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œç”¨å®ä¾‹åŒ–æ‚¨æƒ³è¦å¯åŠ¨çš„è§†å›¾çš„ç±»æ¥æ›¿æ¢`TODO: Transition to * screen`ï¼Œå› æ­¤ä½¿ç”¨`ChatRoomView()`æˆ–`ChatSigninView()`ã€‚

æˆ‘ä¸å¤ªå–œæ¬¢è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºè¿™æ„å‘³ç€å°†ä¸€ä¸ªç±»å¯¼å…¥å¦ä¸€ä¸ªç±»ï¼Œåä¹‹äº¦ç„¶ã€‚æˆ‘å®æ„¿å°†æ­¤å§”æ‰˜ç»™ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

è¿™å°†æˆ‘ä»¬å¸¦åˆ°ä¸‹é¢çš„ç¬¬ 3 æ­¥...

## [](#3-implement-a-raw-router-endraw-class-for-handling-view-transition)3ã€‚å®ç°ä¸€ä¸ª`Router`ç±»æ¥å¤„ç†è§†å›¾è½¬æ¢

åœ¨`web/router.dart`ä¸­å®šä¹‰ä¸€ä¸ª`Router`ç±»:

```
import './views/view.dart';

// Type definition to label a Function that returns a `View` type
typedef ViewInstantiateFn = View Function(Map data);

class Router {
  Router() : _routes = [];

  List<Map<String, ViewInstantiateFn>> _routes;

  register(String path, ViewInstantiateFn viewInstance) {
    // The key `path` is a computed property
    // It could also be written as {'$path': viewInstance}
    _routes.add({path: viewInstance});
  }

  go(String path, {Map params = null}) {
    // Find the matching `Map` object in _routes
    // and invoke it's `View` object instance
    _routes.firstWhere(
      (Map<String, ViewInstantiateFn> route) => route.containsKey(path),
      orElse: () => null,
    )[path](params ?? {});
  }
}

Router router = Router(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`Router`ç±»åœ¨`_routes`å®ä¾‹å˜é‡ä¸‹åŒ…å«ä¸€ä¸ªè·¯ç”±åˆ—è¡¨ã€‚æ¯ä¸ªè·¯ç”±éƒ½æ˜¯ä¸€ä¸ª`Map`,åŒ…å«ä¸€ä¸ªä½œä¸ºè·¯å¾„çš„å…³é”®å­—åç§°ï¼Œè¯¥å…³é”®å­—çš„å€¼æ˜¯ä¸€ä¸ªè¿”å›`View`å¯¹è±¡çš„å‡½æ•°ã€‚æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º`ViewInstantiateFn`çš„ç±»å‹å®šä¹‰æ¥è¡¨ç¤ºè¿™ä¸ªå‡½æ•°çš„ç»“æ„ã€‚

è¦æ·»åŠ è·¯ç”±ï¼Œæˆ‘ä»¬å°†è°ƒç”¨`register()`æ–¹æ³•ï¼Œå‘å…¶ä¼ é€’ä¸€ä¸ªè·¯å¾„å’Œä¸€ä¸ªå‡½æ•°æ¥å®ä¾‹åŒ–æˆ‘ä»¬çš„`View`ã€‚ä¸ºäº†è½¬æ¢åˆ°è§†å›¾ï¼Œæˆ‘ä»¬å°†è°ƒç”¨`go()`æ–¹æ³•ï¼Œä¼ é€’ç»™å®ƒä¸€ä¸ªè·¯å¾„å’Œä¸€ä¸ªç”±`View`ä½¿ç”¨çš„å‚æ•°æ˜ å°„ã€‚

æ–‡ä»¶çš„æœ€åä¸€è¡Œå¯¼å‡ºäº†ä¸€ä¸ª`Router`å®ä¾‹ã€‚

è®©æˆ‘ä»¬åœ¨`web/main.dart` :
ä¸­ä½¿ç”¨è¿™ä¸ªç±»

```
import './router.dart';
import './views/chat_room.dart';
import './views/chat_signin.dart';

void main() {
  router
    ..register('/', (_) => ChatSigninView())
    ..register('/chat-room', (params) => ChatRoomView(params))
    ..go('/');
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬åˆ°`web/views/chat_signin.dart`ï¼Œç”¨å¯¹`router.go()` :
çš„è°ƒç”¨æ›¿æ¢`// TODO: Transition to Chat room screen`

```
import '../router.dart'; // <-- Remember to import this
..
..

  @override
  void onExit() {
    nameField.removeEventListener('input', _inputHandler);
    submitBtn.removeEventListener('click', _clickHandler);

    // Swap view to chat room
    router.go('/chat-room', params: {'username': _response.responseText}); // <-- Added this line
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬åˆ°`web/views/chat_room.dart`ï¼Œæ›¿æ¢`onExit()`æ–¹æ³•ä¸­çš„`// TODO: Transition to chat sign in screen`:

```
import '../router.dart'; // <-- Remember to import this
..
..

  @override
  void onExit() {
    _removeEventListeners();

    router.go('/'); // <-- Added this line
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨åœ¨å•ç‹¬çš„ç»ˆç«¯ä¸­è¿è¡Œåç«¯æœåŠ¡å™¨:

```
dart bin/server.dart 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç°åœ¨åº”è¯¥æ‹¥æœ‰çš„:

[![Working solution](../Images/496aa7268996864aab5cb2dd3690cfe9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--StJPwMDw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/89vqkr7i0647hc5rmyer.gif)

å°†`web/styles.css`ä¸­çš„ css è§„åˆ™æ·»åŠ åˆ°èŠå¤©å®¤æ¶ˆæ¯æ—¥å¿—æ›´å¤§:

```
#ChatRoomLog {
  height: 300px;
  overflow-y: scroll;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#conclusion)ç»“è®º

æœ¬ç³»åˆ—çš„ç¬¬ 2 éƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚åœ¨ç¬¬ 3 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°èŠå¤©å¯¹è¯é€»è¾‘å¹¶å®Œæˆè¿™ä¸ªç³»åˆ—ã€‚

ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘å¸Œæœ›è¿™æ˜¯æœ‰è§åœ°çš„ï¼Œä½ ä»Šå¤©å­¦åˆ°äº†ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚è€Œå·¥ä½œæ–¹æ¡ˆå°±æ˜¯è¿™é‡Œçš„[è¿™é‡Œçš„](https://github.com/graphicbeacon/dart-bulma-chat-app)ã€‚

**å–œæ¬¢ï¼Œåˆ†äº«ï¼Œå…³æ³¨æˆ‘**ğŸ˜æœ‰å…³ Dart çš„æ›´å¤šå†…å®¹ã€‚

## [](#further-reading)è¿›ä¸€æ­¥é˜…è¯»

1.  [dart:html åº“](https://api.dartlang.org/stable/2.0.0/dart-html/dart-html-library.html)
2.  [å¦‚ä½•åœ¨æ‚¨çš„ Dart åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ JavaScript åº“](https://dev.to/graphicbeacon/how-to-use-javascript-libraries-in-your-dart-applications--4mc6)
3.  [**ç”¨ Dart è¿›è¡Œå…¨æ ˆ Web å¼€å‘**](http://bit.ly/2P2N1jC)