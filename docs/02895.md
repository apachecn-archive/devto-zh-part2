# è®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªå¼€å‘å·¥å…·...ä¸€èµ·

> åŸæ–‡:[https://dev.to/joelnet/lets-make-a-devto-cli-together-4eh1](https://dev.to/joelnet/lets-make-a-devto-cli-together-4eh1)

ä¸ºäº† hacktoberfest æˆ‘è¦ä¸º DEV.to åšä¸€ä¸ª CLI...è®©æˆ‘ä»¬ä¸€èµ·åŠªåŠ›å§ï¼

[![devto CLI demo](../Images/a9149e5e001897bf496f364868d9ebe0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aorzlKIi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/freiusj8pih8h136g1u9.gif)

è¿™æ˜¯ä¸€ä¸ªåç»­ç±»å‹çš„æ•™ç¨‹...æ‰€ä»¥è·Ÿç€èµ°ã€‚ä½†æ˜¯å¦‚æœä½ è§‰å¾—è‡ªå·±å¤ªä¼˜ç§€äº†ï¼Œå­¦ä¸åˆ°å¾ˆé…·çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥ç›´æ¥è·³åˆ°æœ€åã€‚

å¦‚æœæˆ‘è·³è¿‡çš„å¤ªå¿«äº†ï¼Œä½ æƒ³è¦æ›´å¤šçš„è§£é‡Šï¼Œå¯ä»¥åœ¨è¯„è®ºé‡Œé—®æˆ‘ï¼

# è®¾ç½®

å› ä¸ºæˆ‘æ˜¯å¼€è½¦çš„äººï¼Œæ‰€ä»¥æˆ‘æœ‰æƒé€‰æ‹©è¯­è¨€ã€‚æˆ‘å°†ä½¿ç”¨ [MojiScript](https://github.com/joelnet/MojiScript) (å½“ç„¶)ã€‚

> ![Programming Wisdom profile image](../Images/c0e04370043baff7812aa9d1c701cd8f.png)ç¼–ç¨‹æ™ºæ…§[@ code Wisdom](https://dev.to/codewisdom)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)â€œå­¦ä¹ ä¸€é—¨æ–°ç¼–ç¨‹è¯­è¨€çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ç”¨å®ƒç¼–å†™ç¨‹åºã€‚â€â€”â€”ä¸¹å°¼æ–¯é‡Œå¥‡2018 å¹´ 10 æœˆ 11 æ—¥ä¸‹åˆ 12:37[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1050364645050122241)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1050364645050122241)307[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1050364645050122241)1034

```
git clone https://github.com/joelnet/mojiscript-starter-app.git devto-cli
cd devto-cli
npm ci 
```

DEV.to æ²¡æœ‰ APIï¼Œé‚£ä¹ˆæ‰€æœ‰æ²¡æœ‰ API çš„ç½‘ç«™ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä»–ä»¬è¢«åˆ®ä¼¤äº†ï¼

```
# install axios
npm install --save-prod axios 
```

å°† axios ä¾èµ–é¡¹æ·»åŠ åˆ°`index.mjs`

```
import log from 'mojiscript/console/log'
import run from 'mojiscript/core/run'
import axios from 'mojiscript/net/axios'
import main from './main'

const dependencies = {
  axios,
  log
}

run ({ dependencies, main }) 
```

# åˆ›å»º src/api.mjs

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`src/api.mjs`æ¥åŒ…å«æˆ‘ä»¬çš„æŠ“å– APIã€‚æˆ‘ä»¬ç”¨çš„æ˜¯`mojiscript/net/axios`ï¼Œå®ƒæ˜¯`axios`çš„å’–å–±ç‰ˆã€‚

```
import pipe from 'mojiscript/core/pipe'

const getData = response => response.data

export const getUrl = axios => pipe ([
  url => axios.get (url) ({}),
  getData
])

export const getDevToHtml = axios => pipe ([
  () => getUrl (axios) ('https://dev.to')
]) 
```

å°†`getDevToHtml`å¯¼å…¥`main.mjs`

```
import pipe from 'mojiscript/core/pipe'
import { getDevToHtml } from './api'

const main = ({ axios, log }) => pipe ([
  getDevToHtml (axios),
  log
])

export default main 
```

ç°åœ¨è¿è¡Œä»£ç :

```
npm start 
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€å † HTML å……æ–¥ç€æ§åˆ¶å°ã€‚

# JavaScript äº’æ“ä½œ

ç°åœ¨ï¼Œæˆ‘ä¸æƒ³æ¯æ¬¡è°ƒè¯•ä»£ç æ—¶éƒ½ç”¨ HTTP è°ƒç”¨æ¥æ”»å‡» DEV.toï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†è¾“å‡ºç¼“å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

```
# this will get you the same version in this tutorial
curl -Lo devto.html https://raw.githubusercontent.com/joelnet/devto-cli/master/devto.html 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶`interop/fs.mjs`ï¼Œè¿™å°±æ˜¯`fs.readFile`æ‰€åœ¨çš„ä½ç½®ã€‚æˆ‘å°†å®ƒæ”¾åœ¨ä¸€ä¸ª`interop`æ–‡ä»¶å¤¹ä¸­ï¼Œå› ä¸º MojiScript éœ€è¦å°† JavaScript äº’æ“ä½œæ–‡ä»¶æ”¾åœ¨è¿™é‡Œã€‚JavaScript çš„ç¼–å†™æ–¹å¼ä¸åŒäº MojiScriptï¼Œæœ‰æ—¶æ˜¯ä¸å…¼å®¹çš„(é™¤éåœ¨ interop ç›®å½•ä¸­)ã€‚

ä¸ºäº†ä½¿`fs.readFile`ä¸ MojiScript å…¼å®¹ï¼Œæˆ‘éœ€è¦é¦–å…ˆå¯¹å®ƒè¿›è¡Œ`promisify`ã€‚

```
promisify (fs.readFile) 
```

æ—¢ç„¶æ‰¿è¯ºäº†ï¼Œæˆ‘ä¹Ÿè¦è®¨å¥½ä¸€ä¸‹ã€‚

```
export const readFile = curry (2) (promisify (fs.readFile)) 
```

æˆ‘ä¹Ÿåœ¨å¤„ç† UTF8ï¼Œé‚£å°±åŠ ä¸€ä¸ªåŠ©æ‰‹å§ï¼Œæ–¹ä¾¿ä¸€ä¸‹ã€‚

```
export const readUtf8File = file => readFile (file) ('utf8') 
```

è¿˜æœ‰å®Œæ•´çš„`interop/fs.mjs` :

```
import fs from 'fs'
import curry from 'mojiscript/function/curry'
import { promisify } from 'util'

export const readFile = curry (2) (promisify (fs.readFile))

export const readUtf8File = file => readFile (file) ('utf8') 
```

# è¯»å–ç¼“å­˜

åœ¨`src/mocks/axios.mock.mjs`å†…éƒ¨ï¼Œæˆ‘è¦åˆ›å»º`mockAxios`ã€‚è¿™å°†åœ¨è°ƒç”¨`get`æ—¶è¿”å›æˆ‘ä»¬æ–‡ä»¶çš„å†…å®¹ã€‚

```
import pipe from 'mojiscript/core/pipe'
import { readUtf8File } from '../interop/fs'

const mockAxios = {
  get: () => pipe ([
    () => readUtf8File ('devto.html'),
    data => ({ data })
  ])
}

export default mockAxios 
```

ä½¿ç”¨æ¨¡æ‹Ÿå¾ˆå®¹æ˜“ã€‚æˆ‘æ‰€è¦åšçš„å°±æ˜¯æ”¹å˜`dependencies`ã€‚`main.mjs`æ²¡æœ‰ä»€ä¹ˆéœ€è¦æ”¹å˜çš„ï¼

```
// don't forget to add the import!
import mockAxios from './mocks/axios.mock'

const dependencies = {
  axios: mockAxios,
  log
} 
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œ`npm start`æ—¶ï¼Œæ²¡æœ‰å‘å‡º HTTP è¯·æ±‚ã€‚è¿™å¾ˆå¥½ï¼Œå› ä¸ºåœ¨æˆ‘å®Œæˆè¿™ä»¶äº‹ä¹‹å‰ï¼Œæˆ‘å¯èƒ½è¦è·‘ä¸€å¤§å †ã€‚

# è§£æ HTML

æˆ‘å–œæ¬¢`cheerio`è§£æã€‚æˆ‘å¾ˆç¡®å®šè¿™æ˜¯é…·å°å­©ç”¨çš„ã€‚

```
npm install --save-prod cheerio 
```

åˆ›å»ºå¦ä¸€ä¸ªäº’æ“ä½œ`interop/cheerio.mjs`ã€‚

```
import cheerio from 'cheerio';
import pipe from 'mojiscript/core/pipe';
import map from 'mojiscript/list/map';

export const getElements = selector => pipe ([
  cheerio.load,
  $ => $ (selector),
  $articles => $articles.toArray (),
  map (cheerio)
]) 
```

æ³¨æ„:å½“ cheerio çš„`toArray`è¢«è°ƒç”¨æ—¶ï¼Œå…ƒç´ ä¼šä¸¢å¤±æ‰€æœ‰è¿™äº›å¥½çš„ cheerio æ–¹æ³•ã€‚åªå¥½å°†`map` `cheerio`é‡æ–°æ¬ä¸Šæ‰€æœ‰çš„å…ƒç´ ã€‚

æ¥ä¸‹æ¥å°†`getElements`æ·»åŠ åˆ°`main`ä¸­ã€‚

```
import { getElements } from './interop/cheerio'

const main = ({ axios, log }) => pipe ([
  getDevToHtml (axios),
  getElements ('.single-article:not(.feed-cta)'),
  log
]) 
```

å†æ¬¡è¿è¡Œ`npm start`æŸ¥çœ‹å…ƒç´ æ•°ç»„ã€‚

```
npm install --save-prod reselect nothis 
```

åˆ›å»º`interop/parser.mjs`ã€‚æˆ‘å°†ä½¿ç”¨`reselect`ä» HTML ä¸­é€‰æ‹©æˆ‘éœ€è¦çš„å±æ€§ã€‚æˆ‘ä¸æ‰“ç®—è¯¦ç»†è®¨è®ºè¿™ä¸ªã€‚åŸºæœ¬ä¸Šå°±æ˜¯ä»ä¸€ä¸ªå…ƒç´ ä¸­è·å–ä¸€å¤§å †ä¸œè¥¿ã€‚ä»£ç å¾ˆå¥½è¯»ï¼Œä½ ä¹Ÿå¯ä»¥è·³è¿‡ï¼Œä¸é‡è¦ã€‚

```
import reselect from 'reselect'
import nothis from 'nothis'

const { createSelector } = reselect
const isTextNode = nothis(({ nodeType }) => nodeType === 3)

const parseUrl = element => `http://dev.to${element.find('a.index-article-link').attr('href')}`
const parseTitle = element => element.find('h3').contents().filter(isTextNode).text().trim()
const parseUserName = element => element.find('.featured-user-name,h4').text().trim().split('ãƒ»')[0]
const parseTags = element => element.find('.featured-tags a,.tags a').text().substr(1).split('#')
const parseComments = element => element.find('.comments-count .engagement-count-number').text().trim() || '0'
const parseReactions = element => element.find('.reactions-count .engagement-count-number').text().trim() || '0'

export const parseElement = createSelector(
  parseUrl,
  parseTitle,
  parseUserName,
  parseTags,
  parseComments,
  parseReactions,
  (url, title, username, tags, comments, reactions) => ({
    url,
    title,
    username,
    tags,
    comments,
    reactions
  })
) 
```

å°†`parseElement`åŠ åˆ°`main`ä¸Šã€‚

```
import map from 'mojiscript/list/map'
import { parseElement } from './interop/parser'

const main = ({ axios, log }) => pipe ([
  getDevToHtml (axios),
  getElements ('.single-article:not(.feed-cta)'),
  map (parseElement),
  log,
]) 
```

ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œ`npm start`æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

```
[
  { url:
     'http://dev.to/ccleary00/how-to-find-the-best-open-source-nodejs-projects-to-study-for-leveling-up-your-skills-1c28',
    title:
     'How to find the best open source Node.js projects to study for leveling up your skills',
    username: 'Corey Cleary',
    tags: [ 'node', 'javascript', 'hacktoberfest' ],
    comments: '0',
    reactions: '33' } ] 
```

# æ ¼å¼åŒ–æ•°æ®

å¢åŠ `import`ã€`formatPost`å¹¶å°†`formatPost`å¢åŠ åˆ°`main`å¹¶å°†`log`æ”¹ä¸º`map (log)`ã€‚

```
import $ from 'mojiscript/string/template'

const formatPost = $`${'title'}  ${'url'}\n#${'tags'}  ${'username'} ãƒ» ğŸ’– ${'comments'} ğŸ’¬ ${'reactions'} `

const main = ({ axios, log }) => pipe ([
  getDevToHtml (axios),
  getElements ('.single-article:not(.feed-cta)'),
  map (parseElement),
  map (formatPost),
  map (log)
]) 
```

å†æ¬¡è¿è¡Œ`npm start`ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
The Introvert's Guide to Professional Development
http://dev.to/geekgalgroks/the-introverts-guide-to-professional-development-3408
#introvert,tips,development,professional
Jenn ãƒ» ğŸ’–  1 ğŸ’¬  50 
```

ç»ˆäºï¼Œè¿™å¼€å§‹æœ‰ç‚¹çœ‰ç›®äº†ï¼

æˆ‘è¿˜å°†åœ¨`main.mjs`ä¸­æ·»åŠ ä¸€ä¸ªæ¡ä»¶ï¼Œåªæœ‰åœ¨`NODE_ENV`ä¸­è®¾ç½®äº†`production`æ—¶æ‰ä½¿ç”¨`axios`ã€‚

```
import ifElse from 'mojiscript/logic/ifElse'

const isProd = env => env === 'production'
const getAxios = () => axios
const getMockAxios = () => mockAxios

const dependencies = {
  axios: ifElse (isProd) (getAxios) (getMockAxios) (process.env.NODE_ENV),
  log
} 
```

åœ¨æœ‰å’Œæ²¡æœ‰`production`çš„æƒ…å†µä¸‹è¿è¡Œå®ƒï¼Œä»¥ç¡®ä¿ä¸¤è€…éƒ½åœ¨å·¥ä½œã€‚

```
# dev mode
npm start

# production mode
NODE_ENV=production npm start 
```

# æŸ¥çœ‹æ–‡ç« 

è¿™ä¸ªåˆ—è¡¨å¾ˆå¥½ï¼Œæˆ‘æ­£æ‰“ç®—åœ¨è¿™é‡Œåœä¸‹æ¥ï¼Œä½†å¦‚æœæˆ‘ä¹Ÿèƒ½è¯»è¿™ç¯‡æ–‡ç« ï¼Œé‚£å°±å¤ªé…·äº†ã€‚

æˆ‘å¸Œæœ›èƒ½å¤Ÿåƒè¿™æ ·è¾“å…¥:

```
devto read 3408 
```

æˆ‘æ³¨æ„åˆ° url çš„æœ«å°¾æœ‰ä¸€ä¸ªæˆ‘å¯ä»¥ä½¿ç”¨çš„ ID:`http://dev.to/geekgalgroks/the-introverts-guide-to-professional-development-3408`<-å°±åœ¨é‚£é‡Œã€‚

æ‰€ä»¥æˆ‘å°†ä¿®æ”¹`parser.mjs`æ¥åŒ…å«ä¸€ä¸ªæ–°çš„è§£æå™¨æ¥è·å– idã€‚

```
const parseId = createSelector(
  parseUrl,
  url => url.match(/-(\w+)$/, 'i')[1]
) 
```

ç„¶ååªè¦æŒ‰ç…§æ¨¡å¼æŠŠ`parseId`å˜æˆ`parseElement`å°±å¯ä»¥äº†ã€‚

ç°åœ¨ CLI å°†æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªæ˜¾ç¤ºæè¦ï¼Œå¦ä¸€ä¸ªæ˜¾ç¤ºæ–‡ç« ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†æè¦é€»è¾‘ä»`main.mjs`åˆ†è§£åˆ°`src/showFeed.mjs`ã€‚

```
import pipe from 'mojiscript/core/pipe'
import map from 'mojiscript/list/map'
import $ from 'mojiscript/string/template'
import { getDevToHtml } from './api'
import { getElements } from './interop/cheerio'
import { parseElement } from './interop/parser'

const formatPost = $`${'title'}  ${'url'}\n#${'tags'}  ${'username'} ãƒ» ğŸ’– ${'comments'} ğŸ’¬ ${'reactions'} `

export const shouldShowFeed = args => args.length < 1

export const showFeed = ({ axios, log }) => pipe ([
  getDevToHtml (axios),
  getElements ('.single-article:not(.feed-cta)'),
  map (parseElement),
  map (formatPost),
  map (log)
]) 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘è¦æŠŠ`cond`åŒ…åœ¨`showFeed`ä¸Šã€‚æœ‰å¯èƒ½æˆ‘ä»¬ä¼šæœ‰æ›´å¤šçš„åˆ†æ”¯æœºæ„(ä¹Ÿè®¸å¸®åŠ©ï¼Ÿ)ä¸­ï¼Œä½†ç›®å‰æˆ‘ä»¬åªæœ‰ 1 æ¡è·¯å¾„ã€‚

è¿™å°±æ˜¯`main.mjs`ç°åœ¨åº”è¯¥çš„æ ·å­ã€‚

```
import pipe from 'mojiscript/core/pipe'
import cond from 'mojiscript/logic/cond'
import { showFeed } from './showFeed'

const main = dependencies => pipe ([
  cond ([
    [ () => true, showFeed (dependencies) ]
  ])
])

export default main 
```

æˆ‘ä»¬éœ€è¦è®¿é—®èŠ‚ç‚¹çš„å‚æ•°ã€‚æ‰€ä»¥åšå‡ºè¿™äº›æ”¹å˜ã€‚æˆ‘å¯¹å®ƒä»¬åšäº†ä¸€ä¸ª`slice`,å› ä¸ºå‰ä¸¤ä¸ªå‚æ•°æ˜¯åƒåœ¾å‚æ•°ï¼Œæˆ‘ä¸éœ€è¦å®ƒä»¬ã€‚

```
// add this line
const state = process.argv.slice (2)

// add state to run
run ({ dependencies, state, main }) 
```

å¥½äº†ï¼Œåœ¨æˆ‘ä»¬çœŸæ­£çœ‹åˆ°è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚æ‰€ä»¥è®©æˆ‘ä»¬æ·»åŠ å¸®åŠ©ã€‚è¿™å¾ˆç®€å•ã€‚

# æŸ¥çœ‹å¸®åŠ©

åˆ›å»º`src/showHelp.mjs`ã€‚

```
import pipe from 'mojiscript/core/pipe'

const helpText = `usage: devto [<command>] [<args>]

  <default>
    Show article feed
  read <id>    Read an article
`

export const showHelp = ({ log }) => pipe ([
  () => log (helpText)
]) 
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ç®€åŒ–`main.mjs`å¹¶å°†æ–°æ¡ˆä¾‹æ·»åŠ åˆ°`cond`ä¸­ã€‚

```
import pipe from 'mojiscript/core/pipe'
import cond from 'mojiscript/logic/cond'
import { shouldShowFeed, showFeed } from './showFeed'
import { showHelp } from './showHelp'

const main = dependencies => pipe ([
  cond ([
    [ shouldShowFeed, showFeed (dependencies) ],
    [ () => true, showHelp (dependencies) ]
  ])
])

export default main 
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ`npm start -- help`ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°æˆ‘ä»¬çš„å¸®åŠ©:

```
usage: devto [<command>] [<args>]

  <default>    Show article feed
  read <id>    Read an article 
```

å¦‚æœæˆ‘ä»¬è¿è¡Œ`npm start`æˆ‘ä»¬ä»ç„¶åº”è¯¥çœ‹åˆ°æˆ‘ä»¬çš„é¥²æ–™ï¼

# æ–‡ç« æ¥è‡ªç¼“å­˜

å°±åƒæˆ‘ä»ç¼“å­˜ä¸­è¯»å–ä¸»æè¦ä¸€æ ·ï¼Œæˆ‘ä¹Ÿæƒ³ä»ç¼“å­˜ä¸­è¯»å–æ–‡ç« ã€‚

```
curl -Lo article.html https://raw.githubusercontent.com/joelnet/devto-cli/master/article.html 
```

ä¿®æ”¹`axios.mock.mjs`ä¹Ÿé˜…è¯»æ–‡ç« ã€‚

```
import pipe from 'mojiscript/core/pipe'
import ifElse from 'mojiscript/logic/ifElse'
import { readUtf8File } from '../interop/fs'

const feedOrArticle = ifElse (url => url === 'https://dev.to') (() => 'devto.html') (() => 'article.html')

const mockAxios = {
  get: url => pipe ([
    () => feedOrArticle (url),
    readUtf8File,
    data => ({ data })
  ])
}

export default mockAxios 
```

# è§£ææ–‡ç« 

è§£ææ–‡ç«  HTML è¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºæˆ‘æ‰“ç®—å°†æ•´ä¸ª`article-body`å—æ ¼å¼åŒ–ä¸ºæ–‡æœ¬ã€‚æ‰€ä»¥æˆ‘åªéœ€è¦æ ‡é¢˜å’Œæ­£æ–‡ã€‚

åˆ›å»º`interop/articleParser.mjs`ã€‚

```
import reselect from 'reselect'

const { createSelector } = reselect

const parseTitle = $ => $('h1').first().text().trim()
const parseBody = $ => $('#article-body').html()

export const parseArticle = createSelector(
  parseTitle,
  parseBody,
  (title, body) => ({
    title,
    body
  })
) 
```

# é˜…è¯»æ–‡ç« 

å› ä¸ºæ²¡æœ‰çŠ¶æ€ï¼Œæ‰€ä»¥å½“æˆ‘å‘å‡º`read`å‘½ä»¤æ—¶ï¼ŒCLI ä¸ä¼šçŸ¥é“è¦æ‹‰ä»€ä¹ˆ URLã€‚å› ä¸ºæˆ‘å¾ˆæ‡’ï¼Œæ‰€ä»¥æˆ‘å°†å†æ¬¡æŸ¥è¯¢æè¦ã€‚å¹¶ä»æè¦ä¸­æå– URLã€‚

æ‰€ä»¥æˆ‘å°†è·³å›`showFeed.mjs`å¹¶å±•ç¤ºè¿™ä¸ªåŠŸèƒ½ã€‚

æˆ‘åªæ˜¯ä»`showFeed`ä¸­æå–å‡½æ•°ï¼Œå¹¶å°†å®ƒä»¬æ”¾å…¥`getArticles`ã€‚æˆ‘æ²¡æœ‰åœ¨è¿™é‡Œæ·»åŠ ä»»ä½•æ–°ä»£ç ã€‚

```
export const getArticles = axios => pipe ([
  getDevToHtml (axios),
  getElements ('.single-article:not(.feed-cta)'),
  map (parseElement)
])

export const showFeed = ({ axios, log }) => pipe ([
  getArticles (axios),
  map (formatPost),
  map (log)
]) 
```

# å±•ç¤ºæ–‡ç« 

ç°åœ¨æˆ‘æƒ³å†™ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯`id`æ²¡æœ‰å®šä¹‰ã€‚`id`æ˜¯`pipe`çš„å‚æ•°ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæ— æ³•è®¿é—®ã€‚`filter`çš„è¾“å…¥æ˜¯æ–‡ç« æ•°ç»„ï¼Œè€Œä¸æ˜¯`id`ã€‚

```
const getArticle = ({ axios }) => pipe ([
  getArticles (axios),
  filter (article => article.id === id), // 'id' is not defined
  articles => articles[0]
]) 
```

ä½†æ˜¯æœ‰ä¸€ä¸ªæŠ€å·§ã€‚ä½¿ç”¨ **W ç»„åˆå­**æˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œè¿™æ ·`id`å°±è¢«æš´éœ²äº†ã€‚

```
const getArticle = ({ axios }) => W (id => pipe ([
  getArticles (axios),
  filter (article => article.id === id),
  articles => articles[0]
])) 
```

å°†è¯¥å—ä¸å…¶ä¸Šæ–¹çš„å—è¿›è¡Œæ¯”è¾ƒï¼Œå·®åˆ«ä¸å¤§ï¼Œåªæ˜¯å¢åŠ äº†`W (id =>`å’Œä¸€ä¸ªç»“æŸ`)`ã€‚W Combinator æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„å·¥å…·ã€‚å…³äºå‡½æ•°ç»„åˆå­çš„æ›´å¤šå†…å®¹å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­è®¨è®º:)ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­ã€‚

æ‰€æœ‰çš„åŠ åœ¨ä¸€èµ·`src/showArticle.mjs`åº”è¯¥æ˜¯è¿™æ ·çš„:

```
import W from 'mojiscript/combinators/W'
import pipe from 'mojiscript/core/pipe'
import filter from 'mojiscript/list/filter'
import { getArticles } from './showFeed'

export const shouldShowArticle = args => args.length === 2 && args[0] === 'read'

const getArticle = ({ axios }) => W (id => pipe ([
  getArticles (axios),
  filter (article => article.id === id),
  articles => articles[0]
]))

export const showArticle = ({ axios, log }) => pipe ([
  getArticle ({ axios }),
  log
]) 
```

ä¿®æ”¹`main.mjs`çš„`cond`ä»¥åŒ…å«æ–°åŠŸèƒ½:

```
import { shouldShowArticle, showArticle } from './showArticle'

const main = dependencies => pipe ([
  cond ([
    [ shouldShowArticle, args => showArticle (dependencies) (args[1]) ],
    [ shouldShowFeed, showFeed (dependencies) ],
    [ () => true, showHelp (dependencies) ]
  ])
]) 
```

è¿è¡Œ`npm run start -- 1i0a`(æ›¿æ¢ id)ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

```
{ id: '1i0a',
  url:
   'http://dev.to/ppshobi/-email-sending-in-django-2-part--1--1i0a',
  title: 'Email Sending in Django 2, Part -1',
  username: 'Shobi',
  tags: [ 'django', 'emails', 'consoleemailbackend' ],
  comments: '0',
  reactions: '13' } 
```

# HTML è½¬æ–‡æœ¬

æˆ‘å‘ç°äº†ä¸€ä¸ªå¾ˆæ£’çš„ npm åŒ…ï¼Œçœ‹èµ·æ¥å®ƒå¯ä»¥å¸®æˆ‘è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
npm install --save-prod html-to-text 
```

æˆ‘ä»¬å·²ç»å¥ å®šäº†å¤§éƒ¨åˆ†åŸºç¡€ï¼Œæ‰€ä»¥è¦å‘å‡º HTTP è¯·æ±‚ï¼Œè§£æ HTML å¹¶å°†å…¶æ ¼å¼åŒ–ä¸ºæ–‡æœ¬ï¼Œå°±åƒè¿™æ ·ç®€å•ã€‚æ‰“å¼€`showArticle.mjs`ã€‚

```
const getArticleTextFromUrl = axios => pipe ([
  ({ url }) => getUrl (axios) (url),
  cheerio.load,
  parseArticle,
  article => `${article.title}\n\n${htmlToText.fromString (article.body)}`
]) 
```

æˆ‘è¿˜æƒ³åœ¨æ²¡æœ‰æ‰¾åˆ°`id`æ—¶åˆ›å»ºä¸€ä¸ªè§†å›¾ã€‚

```
const showArticleNotFound = $`Article ${0} not found.\n` 
```

æˆ‘è¿˜å°†åˆ›å»ºä¸€ä¸ª`isArticleFound`æ¡ä»¶ï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§ã€‚

```
const isArticleFound = article => article != null 
```

æˆ‘å°†ä½¿ç”¨ç›¸åŒçš„ W Combinator æŠ€æœ¯åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å…¬å¼€`id`å’Œä¿®æ”¹`showArticle`ã€‚

```
export const showArticle = ({ axios, log }) => W (id => pipe ([
  getArticle ({ axios }),
  ifElse (isArticleFound) (getArticleTextFromUrl (axios)) (() => showArticleNotFound (id)),
  log
])) 
```

åˆåœ¨ä¸€èµ·`showArticle.mjs`çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
import cheerio from 'cheerio'
import htmlToText from 'html-to-text'
import W from 'mojiscript/combinators/W'
import pipe from 'mojiscript/core/pipe'
import filter from 'mojiscript/list/filter'
import ifElse from 'mojiscript/logic/ifElse'
import $ from 'mojiscript/string/template'
import { getUrl } from './api'
import { parseArticle } from './interop/articleParser'
import { getArticles } from './showFeed'

const isArticleFound = article => article != null
const showArticleNotFound = $`Article ${0} not found.\n`
const getArticleTextFromUrl = axios => pipe ([
  ({ url }) => getUrl (axios) (url),
  cheerio.load,
  parseArticle,
  article => `${article.title}\n\n${htmlToText.fromString (article.body)}`
])

export const shouldShowArticle = args => args.length === 2 && args[0] === 'read'

const getArticle = ({ axios }) => W (id => pipe ([
  getArticles (axios),
  filter (article => article.id === id),
  articles => articles[0]
]))

export const showArticle = ({ axios, log }) => W (id => pipe ([
  getArticle ({ axios }),
  ifElse (isArticleFound) (getArticleTextFromUrl (axios)) (() => showArticleNotFound (id)),
  log
])) 
```

å†æ¬¡è¿è¡Œ`npm start -- read 1i0a`ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ–‡ç« ï¼

[![Minions are cheering](../Images/60c7956093e54233c76a2e004541e5f1.png)T2ã€‘](https://i.giphy.com/media/hEIuLmpW9DmGA/giphy.gif)

# ç‚¹ç›ä¹‹ç¬”

æˆ‘æƒ³è®©æè¦ä¸­çš„`id`æ›´æ¸…æ™°ã€‚

```
const formatPost = $`${'id'}ãƒ»${'title'}  ${'url'}\n#${'tags'}  ${'username'} ãƒ» ğŸ’– ${'comments'} ğŸ’¬ ${'reactions'} ` 
```

å°†è¿™ä¸ªæ·»åŠ åˆ°`package.json`ä¸­ï¼Œæˆ‘å°†æŠŠè¿™ä¸ªå‘½ä»¤å‘½åä¸º`devto`ã€‚

```
 "bin": {
    "devto": "./src/index.mjs"
  } 
```

åœ¨`src/index.mjs`ä¸­ï¼Œåœ¨é¡¶éƒ¨åŠ ä¸Šè¿™ä¸ªç¥ç§˜çš„é­”æ³•:

```
#!/bin/sh ':' //# comment; exec /usr/bin/env NODE_ENV=production node --experimental-modules --no-warnings "$0" "$@" 
```

è¿è¡Œæ­¤å‘½ä»¤åˆ›å»ºæŒ‡å‘è¯¥å‘½ä»¤çš„å…¨å±€é“¾æ¥ã€‚

```
npm link 
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨ç°åœ¨åº”è¯¥èƒ½å¤Ÿè¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
# get the feed
devto

# read the article
devto read <id> 
```

# æ‰€ä»¥ä½ å†³å®šè·³åˆ°æœ€åï¼Ÿ

ä½ å¯ä»¥æŠŠé©¬ç‰µåˆ°æ°´è¾¹...æˆ–è€…ä»€ä¹ˆçš„ã€‚

è¦èµ¶ä¸Šæˆ‘ä»¬å…¶ä»–äººï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤

```
# clone the repo
git clone https://github.com/joelnet/devto-cli
cd devto-cli

# install
npm ci
npm run build
npm link

# run
devto 
```

# å…³äº CLI çš„è­¦å‘Š

æŠ“å–ç½‘ç«™ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚å½“ç½‘ç«™å‘ç”Ÿå˜åŒ–æ—¶(è¿™ç§æƒ…å†µè‚¯å®šä¼šå‘ç”Ÿ)ï¼Œæ‚¨çš„ä»£ç å°±ä¼šå‡ºé”™ã€‚

è¿™åªæ˜¯ä¸ºäº†ç»™ [#hacktoberfest](https://dev.to/t/hacktoberfest) åšä¸€ä¸ªæœ‰è¶£çš„æ¼”ç¤ºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯ç»´æŠ¤çš„é¡¹ç›®ã€‚å¦‚æœæ‚¨å‘ç°ä¸€ä¸ª bugï¼Œè¯·æäº¤ä¸€ä¸ª pull è¯·æ±‚æ¥ä¿®å¤å®ƒï¼Œå¹¶é™„ä¸Š bug æŠ¥å‘Šã€‚æˆ‘ä¸ä¼šç»´æŒè¿™ä¸ªé¡¹ç›®ã€‚

å¦‚æœè¿™æ˜¯ä¸€ä¸ªçœŸå®çš„é¡¹ç›®ï¼Œæœ‰äº›äº‹æƒ…ä¼šå¾ˆé…·:

*   ç™»å½•ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é˜…è¯»*ä½ çš„*æè¦ã€‚
*   æ›´å¤šçš„äº’åŠ¨ï¼Œè¯„è®ºï¼Œå–œæ¬¢ï¼Œæ ‡ç­¾ã€‚ä¹Ÿè®¸è´´ä¸€ç¯‡æ–‡ç« ï¼Ÿ

# Hacktoberfest å¿«ä¹ï¼

å¯¹äºé‚£äº›é€šè¯»äº†æ•´æœ¬ä¹¦çš„äººï¼Œè°¢è°¢ä½ çš„æ—¶é—´ã€‚æˆ‘çŸ¥é“è¿™å¾ˆä¹…äº†ã€‚æˆ‘å¸Œæœ›å®ƒæ˜¯æœ‰è¶£çš„ï¼Œæˆ‘å¸Œæœ›ä½ å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘å¸Œæœ›ä½ ç©å¾—å¼€å¿ƒã€‚

å¯¹äºé‚£äº›å®é™…ä¸Šä¸€æ­¥ä¸€æ­¥åœ°è·Ÿéšå¹¶ä¸”è‡ªå·±åˆ›å»ºäº† CLI çš„äººæ¥è¯´:ä½ ä½¿æˆ‘å®Œæ•´äº†ğŸ’–ã€‚

è¯·åœ¨è¯„è®ºæˆ– twitter ä¸­å‘Šè¯‰æˆ‘ä½ å­¦åˆ°äº†ä»€ä¹ˆï¼Œä½ å‘ç°äº†ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿æˆ–ä»»ä½•å…¶ä»–è¯„è®ºï¼Œæˆ–ä½ å¯èƒ½æœ‰çš„æ‰¹è¯„ã€‚

æˆ‘çš„æ–‡ç« æ˜¯éå¸¸å®ç”¨çš„ JavaScriptï¼Œå¦‚æœä½ éœ€è¦æ›´å¤šï¼Œè¯·åœ¨è¿™é‡Œå…³æ³¨æˆ‘ï¼Œæˆ–è€…åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ï¼

**æ›´å¤šæ–‡ç« **

[é—®æˆ‘å…³äºå‡½æ•°å¼ç¼–ç¨‹çš„æ„šè ¢é—®é¢˜](https://dev.to/joelnet/ask-me-dumb-questions-about-functional-programming-bho)
[è®©æˆ‘ä»¬æ¥è°ˆè°ˆ JavaScript çš„è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£å·¥å…·](https://dev.to/joelnet/lets-talk-about-auto-generated-documentation-tools-for-javascript-49ol)

[![Cheers!](../Images/661c03d25961a6e3b1ecbe00d148b35a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PqqJmrxK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6jsy3a866frzp3u5oda0.jpg)