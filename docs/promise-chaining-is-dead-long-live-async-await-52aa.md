# æ‰¿è¯ºé“¾å·²ç»æ­»äº†ã€‚å¼‚æ­¥/ç­‰å¾…ä¸‡å²

> åŸæ–‡ï¼š<https://dev.to/bnevilleoneill/promise-chaining-is-dead-long-live-async-await-52aa>

[![](img/1a76e97aa006774aac77ee603863d9a3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5UeESUs3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2Ag4lmTSnkQrovZDS0JfrsbA.png)

è™½ç„¶å¼‚æ­¥å‡½æ•°ä¸€ç›´å­˜åœ¨ï¼Œä½†å®ƒä»¬ç»å¸¸è¢«æç½®ä¸ç”¨ã€‚Async/await å¯èƒ½è¢«ä¸€äº›äººè®¤ä¸ºæ˜¯ä¸€ä¸ªå¼ƒå„¿ã€‚

ä¸ºä»€ä¹ˆï¼Ÿ

ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ async/await å’Œ promises æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚

å‰§é€ä¸€ä¸‹ï¼Œä»–ä»¬ä¸æ˜¯ï¼Async/await åŸºäºæ‰¿è¯ºã€‚

ä»…ä»…å› ä¸ºä½ ä½¿ç”¨æ‰¿è¯ºå¹¶ä¸æ„å‘³ç€ä½ è¢«æŸç¼šåœ¨æ‰¿è¯ºé“¾çš„é‡è›®ä¸­ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ async/await å¦‚ä½•çœŸæ­£è®©å¼€å‘äººå‘˜çš„ç”Ÿæ´»å˜å¾—æ›´åŠ è½»æ¾ï¼Œä»¥åŠä¸ºä»€ä¹ˆæ‚¨åº”è¯¥åœæ­¢ä½¿ç”¨æ‰¿è¯ºé“¾ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹æ‰¿è¯ºé“¾:

```
// Using promise chaining
getIssue()
  .then(issue => getOwner(issue.ownerId))
  .then(owner => sendEmail(owner.email, 'Some text')) 
```

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ç”¨ async/await å®ç°çš„ç›¸åŒä»£ç :

```
// Using async functions
const issue = await getIssue()
const owner = await getOwner(issue.ownerId)
await sendEmail(owner.email, 'Some text') 
```

å—¯ï¼Œå®ƒçœ‹èµ·æ¥åƒç®€å•çš„è¯­æ³•ç³–ï¼Œå¯¹ä¸å¯¹ï¼Ÿ

åƒå¤§å¤šæ•°äººä¸€æ ·ï¼Œæˆ‘ç»å¸¸å‘ç°æˆ‘çš„ä»£ç çœ‹èµ·æ¥ç®€å•ã€å¹²å‡€ã€æ˜“è¯»ã€‚å…¶ä»–äººä¼¼ä¹ä¹ŸåŒæ„ã€‚ä½†æ˜¯åˆ°äº†è¦åšå‡ºæ”¹å˜çš„æ—¶å€™ï¼Œä¿®æ”¹æ¯”é¢„æƒ³çš„è¦éš¾ã€‚è¿™å¹¶ä¸å¥‡æ€ªã€‚

è¿™æ­£æ˜¯æ‰¿è¯ºé“¾æ‰€å‘ç”Ÿçš„äº‹æƒ…ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆã€‚

[![](img/2063f22e152ef36aa267c13ae9842601.png)T2ã€‘](https://logrocket.com/signup/)

### æ˜“äºé˜…è¯»ï¼Œæ˜“äºç»´æŠ¤

å‡è®¾æˆ‘ä»¬éœ€è¦åœ¨ä¹‹å‰çš„ä»£ç ä¸­å®ç°ä¸€ä¸ªéå¸¸å°çš„å˜åŒ–(ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”µå­é‚®ä»¶å†…å®¹ä¸­æåˆ°é—®é¢˜ç¼–å·â€”â€”ç±»ä¼¼äºæ–‡æœ¬#issue-number)ã€‚

æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿå¯¹äºå¼‚æ­¥/ç­‰å¾…ç‰ˆæœ¬ï¼Œè¿™æ˜¯å¾®ä¸è¶³é“çš„:

```
const issue = await getIssue()
const owner = await getOwner(issue.ownerId)
await sendEmail(owner.email, `Some text #${issue.number}`) // tiny change here 
```

å‰ä¸¤è¡Œä¸å—å½±å“ï¼Œç¬¬ä¸‰è¡Œåªéœ€è¦åšå¾ˆå°çš„æ”¹åŠ¨ã€‚

æ‰¿è¯ºé“¾ç‰ˆæœ¬å‘¢ï¼Ÿè®©æˆ‘æƒ³æƒ³ã€‚

åœ¨æœ€åã€‚ç„¶å()æˆ‘ä»¬å¯ä»¥è®¿é—®æ‰€æœ‰è€…ï¼Œä½†ä¸èƒ½è®¿é—®é—®é¢˜å¼•ç”¨ã€‚è¿™å°±æ˜¯æ‰¿è¯ºé“¾å¼€å§‹å˜å¾—æ··ä¹±çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨è¿™æ ·çš„ä¸œè¥¿æ¥æ¸…ç†å®ƒ:

```
getIssue()
  .then(issue => {
    return getOwner(issue.ownerId)
      .then(owner => sendEmail(owner.email, `Some text #${issue.number}`))
  }) 
```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä¸€ä¸ªå°çš„è°ƒæ•´éœ€è¦æ›´æ”¹å‡ è¡ŒåŸæœ¬å¾ˆæ¼‚äº®çš„ä»£ç (æ¯”å¦‚ getOwner(issue.ownerId))ã€‚

### ä»£ç æ˜¯ä¸æ–­å˜åŒ–çš„

å½“å®ç°éå¸¸æ–°çš„ä¸œè¥¿æ—¶å°¤å…¶å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç”µå­é‚®ä»¶å†…å®¹ä¸­åŒ…å«æ¥è‡ªå¯¹åä¸º getSettings()çš„å‡½æ•°çš„å¼‚æ­¥è°ƒç”¨çš„é™„åŠ ä¿¡æ¯ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

å®ƒå¯èƒ½ç±»ä¼¼äº:

```
const settings = await getSettings() // we added this
const issue = await getIssue()
const owner = await getOwner(issue.ownerId)
await sendEmail(owner.email,
  `Some text #${issue.number}. ${settings.emailFooter}`) // minor change here 
```

ä½ å¦‚ä½•ä½¿ç”¨æ‰¿è¯ºé“¾æ¥å®ç°å®ƒï¼Ÿæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

```
Promise.all([getIssue(), getSettings()])
  .then(([issue, settings]) => {
    return getOwner(issue.ownerId)
      .then(owner => sendEmail(owner.email,
        `Some text #${issue.number}. ${settings.emailFooter}`))
  }) 
```

ä½†æ˜¯ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™å¯¼è‡´äº†è‰ç‡çš„ä»£ç ã€‚æ¯å½“æˆ‘ä»¬éœ€è¦å¯¹éœ€æ±‚è¿›è¡Œæ›´æ”¹æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹ä»£ç è¿›è¡Œå¤ªå¤šçš„æ›´æ”¹ã€‚æ¶å¿ƒã€‚

å› ä¸ºæˆ‘ä¸æƒ³åµŒå¥—æ›´å¤šçš„ then()è°ƒç”¨ï¼Œè€Œä¸”æˆ‘å¯ä»¥å¹¶è¡Œåœ°ä½¿ç”¨ getIssue()å’Œ getSettings()ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†ä½¿ç”¨ Promise.all()ï¼Œç„¶åè¿›è¡Œä¸€äº›è§£æ„ã€‚çš„ç¡®ï¼Œä¸ await ç‰ˆæœ¬ç›¸æ¯”ï¼Œè¿™ä¸ªç‰ˆæœ¬æ˜¯æœ€ä½³çš„ï¼Œå› ä¸ºå®ƒæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œä½†ä»ç„¶å¾ˆéš¾é˜…è¯»ã€‚

æˆ‘ä»¬èƒ½å¦ä¼˜åŒ– await ç‰ˆæœ¬ï¼Œä½¿äº‹æƒ…å¹¶è¡Œè¿è¡Œï¼Œè€Œä¸ç‰ºç‰²ä»£ç çš„å¯è¯»æ€§ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹:

```
const settings = getSettings() // we don't await here
const issue = await getIssue()
const owner = await getOwner(issue.ownerId)
await sendEmail(owner.email,
  `Some text #${issue.number}. ${(await settings).emailFooter}`) // we do it here 
```

æˆ‘å·²ç»ç§»é™¤äº† settings èµ‹å€¼å³ä¾§çš„ awaitï¼Œå¹¶å°†å®ƒç§»åŠ¨åˆ° sendEmail()è°ƒç”¨ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘åˆ›é€ äº†ä¸€ä¸ªæ‰¿è¯ºï¼Œä½†ä¸æ˜¯ç­‰åˆ°æˆ‘éœ€è¦å®ƒçš„ä»·å€¼çš„æ—¶å€™ã€‚ä¸æ­¤åŒæ—¶ï¼Œå…¶ä»–ä»£ç å¯ä»¥å¹¶è¡Œè¿è¡Œã€‚å°±è¿™ä¹ˆç®€å•ï¼

### ä½ ä¸éœ€è¦ Promise.all()å› ä¸ºå®ƒæ­»äº†

æˆ‘å·²ç»æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸ä½¿ç”¨ Promise.all()çš„æƒ…å†µä¸‹è½»æ¾æœ‰æ•ˆåœ°å¹¶è¡Œè¿è¡Œ promisesã€‚æ‰€ä»¥è¿™æ„å‘³ç€å®ƒå®Œå…¨æ­»äº†ï¼Œå¯¹å—ï¼Ÿ

å—¯ï¼Œæœ‰äº›äººå¯èƒ½ä¼šè¯´ï¼Œä¸€ä¸ªå®Œç¾çš„ç”¨ä¾‹æ˜¯å½“ä½ æœ‰ä¸€ä¸ªå€¼æ•°ç»„ï¼Œä½ éœ€è¦æŠŠå®ƒæ˜ å°„()åˆ°ä¸€ä¸ªæ‰¿è¯ºæ•°ç»„ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä¸€ä¸ªè¦è¯»å–çš„æ–‡ä»¶åæ•°ç»„ï¼Œæˆ–è€…ä¸€ä¸ªè¦ä¸‹è½½çš„ URL æ•°ç»„ï¼Œç­‰ç­‰ã€‚

æˆ‘è®¤ä¸ºé‚£äº›äººé”™äº†ã€‚ç›¸åï¼Œæˆ‘å»ºè®®ä½¿ç”¨å¤–éƒ¨åº“æ¥å¤„ç†å¹¶å‘æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘å°†ä½¿ç”¨è“é¸Ÿçš„ Promise.map()ï¼Œåœ¨é‚£é‡Œæˆ‘å¯ä»¥è®¾ç½®ä¸€ä¸ª[å¹¶å‘é™åˆ¶](http://bluebirdjs.com/docs/api/promise.map.html#map-option-concurrency)ã€‚å¦‚æœæˆ‘å¿…é¡»ä¸‹è½½ N ä¸ªæ–‡ä»¶ï¼Œç”¨è¿™ä¸ªå·¥å…·æˆ‘å¯ä»¥æŒ‡å®šä¸è¶…è¿‡ M ä¸ªæ–‡ä»¶åŒæ—¶ä¸‹è½½ã€‚

### ä½ å‡ ä¹å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ await

å½“ä½ è¯•å›¾ç®€åŒ–äº‹æƒ…æ—¶ï¼ŒAsync/await å¤§æ”¾å¼‚å½©ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½¿ç”¨æ‰¿è¯ºé“¾ï¼Œè¿™äº›è¡¨è¾¾å¼ä¼šæœ‰å¤šå¤æ‚ã€‚ä½†æ˜¯æœ‰äº† async/awaitï¼Œå®ƒä»¬å°±ç®€å•æ˜äº†äº†ã€‚

```
const value = await foo() || await bar()

const value = calculateSomething(await foo(), await bar()) 
```

### è¿˜ä¸æœæ°”ï¼Ÿ

å‡è®¾ä½ å¯¹æˆ‘å–œæ¬¢æ¼‚äº®çš„ä»£ç å’Œæ˜“äºç»´æŠ¤ä¸æ„Ÿå…´è¶£ã€‚ç›¸åï¼Œä½ éœ€è¦ç¡®å‡¿çš„äº‹å®ã€‚å®ƒä»¬å­˜åœ¨å—ï¼Ÿ

æ²¡é”™ã€‚

å½“å°† promise chaining åˆå¹¶åˆ°ä»–ä»¬çš„ä»£ç ä¸­æ—¶ï¼Œå¼€å‘äººå‘˜ä¼šåœ¨æ¯æ¬¡æœ‰ then()è°ƒç”¨æ—¶åˆ›å»ºæ–°çš„å‡½æ•°ã€‚è¿™æœ¬èº«ä¼šå ç”¨æ›´å¤šçš„å†…å­˜ï¼Œä½†æ˜¯è¿™äº›å‡½æ•°æ€»æ˜¯åœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚å› æ­¤ï¼Œè¿™äº›å‡½æ•°å˜æˆäº†é—­åŒ…ï¼Œè¿™ä½¿å¾—åƒåœ¾æ”¶é›†å˜å¾—æ›´åŠ å›°éš¾ã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°é€šå¸¸æ˜¯åŒ¿åå‡½æ•°ï¼Œä¼šæ±¡æŸ“å †æ ˆè·Ÿè¸ªã€‚

æ—¢ç„¶æˆ‘ä»¬æ­£åœ¨è®¨è®ºå †æ ˆè·Ÿè¸ª:æˆ‘åº”è¯¥æåˆ°æœ‰ä¸€ä¸ªå¯é çš„[æè®®](https://docs.google.com/document/d/13Sy_kBIJGP0XT34V1CV3nkWya4TwYx9L3Yv45LdGB6Q/edit)æ¥ä¸ºå¼‚æ­¥å‡½æ•°å®ç°**æ›´å¥½çš„å †æ ˆè·Ÿè¸ª**ã€‚è¿™å¤ªæ£’äº†ï¼Œæœ‰è¶£çš„æ˜¯â€¦

*åªè¦å¼€å‘è€…åšæŒåªä½¿ç”¨å¼‚æ­¥å‡½æ•°å’Œå¼‚æ­¥ç”Ÿæˆå™¨ï¼Œè€Œä¸æ˜¯æ‰‹å·¥ç¼–å†™ Promise ä»£ç *

â€¦å¦‚æœä½¿ç”¨æ‰¿è¯ºé“¾ï¼Œå°†ä¸èµ·ä½œç”¨ã€‚æ‰€ä»¥è¿™åˆæ˜¯ä¸€ä¸ªæ€»æ˜¯ä½¿ç”¨å¼‚æ­¥/ç­‰å¾…çš„ç†ç”±ï¼

### å¦‚ä½•è¿ç§»

é¦–å…ˆ(ç°åœ¨åº”è¯¥å¾ˆæ˜æ˜¾äº†):å¼€å§‹ä½¿ç”¨å¼‚æ­¥å‡½æ•°ï¼Œåœæ­¢ä½¿ç”¨æ‰¿è¯ºé“¾ã€‚

å…¶æ¬¡ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç° Visual Studio ä»£ç å¯¹æ­¤éå¸¸æ–¹ä¾¿:

> ![unknown tweet media content](img/567e4d427cc2b86c3bb5fef54dc868c0.png)![Play butt](img/980e9fb12d58fa9423fc94c33003fc4f.png)<video loop="" controls=""><source src="https://video.twimg.com/tweet_video/DoLowPkW0AA8Wfi.mp4" type="video/mp4"></video>![Umar Hansa profile image](img/c70c238abc29162c08f83058f730a5c7.png)Umar Hansa[@ umaar](https://dev.to/umaar)![twitter logo](img/ad0c7b03deabfe1a161345efb2d537eb.png)Visual Studio ä»£ç ç°åœ¨å¯ä»¥å°†æ‚¨çš„ Promise.then()çš„é•¿é“¾è½¬æ¢ä¸º async/awaitï¼ğŸŠåœ¨ JavaScript å’Œ TypeScript æ–‡ä»¶ä¸­éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚ã€‚catch()ä¹Ÿæ­£ç¡®è½¬æ¢ä¸º try/catchâœ…2018 å¹´ 9 æœˆ 28 æ—¥ä¸‹åˆ 12:42[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1045655069478334464)[![Twitter retweet action](img/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1045655069478334464)1775[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1045655069478334464)4673

### ç»“è®º

*   Async/await å·²ç»å¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒã€‚é™¤éä½ éœ€è¦æ”¯æŒ IE ä½ å¾ˆå¥½ã€‚
*   Async/await å¯è¯»æ€§æ›´å¼ºï¼Œæ˜“äºç»´æŠ¤ã€‚
*   åªä½¿ç”¨ async/await ä¹Ÿæœ‰æŠ€æœ¯ä¸Šçš„åŸå› ã€‚
*   æœ‰äº† Visual Studio ä»£ç å’Œå…¶ä»– ideï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç§»æ¤ç°æœ‰çš„ promise chained ä»£ç ï¼* * * ### Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![](img/d56be9e9e36d8fa98c6959f7097b7787.png)](https://logrocket.com/signup/)

<figcaption>[https://logrocket.com/signup/](https://logrocket.com/signup/)</figcaption>

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

å…è´¹è¯•ç”¨ã€‚

* * *

å¸–å­[æ‰¿è¯ºé“¾å·²æ­»ã€‚å¼‚æ­¥/ç­‰å¾…ä¸‡å²](https://blog.logrocket.com/promise-chaining-is-dead-long-live-async-await-445897870abc/)é¦–å…ˆå‡ºç°åœ¨[æ—¥å¿—åšå®¢](https://blog.logrocket.com)ä¸Šã€‚