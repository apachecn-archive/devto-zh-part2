# å¦‚ä½•ç”¨ Vue.js å’Œ GraphQL æ„å»ºä¸€ä¸ª load more æŒ‰é’®

> åŸæ–‡:[https://dev . to/aperture less/how-to-build-a-load-more-button-with-vue js-and graph QL-302 f](https://dev.to/apertureless/how-to-build-a-load-more-button-with-vuejs-andgraphql-302f)

å½“æˆ‘åœ¨ç ”ç©¶ğŸ¨æˆ‘ä¸å¾—ä¸åœ¨æŸä¸ªæ—¶å€™å®ç°åˆ†é¡µã€‚æ²¡æœ‰äººæƒ³ä¸€æ¬¡åŠ è½½ä¸€å¤§å †è°ƒè‰²æ¿ã€‚ç„¶è€Œï¼Œæˆ‘çœŸçš„å¾ˆå–œæ¬¢æƒ°æ€§åŠ è½½æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç»å…¸çš„åˆ†é¡µã€‚

## [](#preparation)ğŸ’ªå‡†å¤‡

[Colour Hunt](https://www.colourhunt.com/?ref=devto) æ˜¯ç”¨ Nuxt.jsã€Graph.cool å’Œ [vue-apollo](https://github.com/Akryum/vue-apollo) æ„å»ºçš„ã€‚æ ˆæ˜¯å¿«é€Ÿå¼€å‘çš„æ¢¦æƒ³ï¼Œå› ä¸ºä½ ä¸éœ€è¦æ‘†å¼„åç«¯ã€‚Colour Hunt èƒŒåçš„æƒ³æ³•æ˜¯ï¼Œäººä»¬å¯ä»¥åˆ›å»ºå’Œå…±äº«è°ƒè‰²æ¿ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥å°†è¿™ç§æŠ€æœ¯ç”¨äºæ‰€æœ‰ç±»å‹çš„ graphql èŠ‚ç‚¹ã€‚å¤§å¤šæ•°ä¾‹å­éƒ½æ˜¯ä½¿ç”¨æ—§çš„åšå®¢ä¾‹å­å’Œå¸–å­ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬çš„ GraphQL æŸ¥è¯¢:

[![](../Images/6c880d8c8454d5f1e824db834b36ddd1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fC52-Qef--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/LNstiWS.png)

å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ã€‚åªéœ€æŸ¥è¯¢æ‰€æœ‰å¯ç”¨çš„è°ƒè‰²æ¿ï¼Œå¹¶é€šè¿‡å˜é‡å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚æˆ‘ä»¬çš„ vue ç»„ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:

[![](../Images/21d82094ee97ecc93dc77f4d6d4db154.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_e0S52Dz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/KQa2FFB.png)

æˆ‘ä»¬åªéœ€åŠ è½½æˆ‘ä»¬çš„æŸ¥è¯¢ï¼Œvue-apollo åœ¨å¹•åå®Œæˆæ‰€æœ‰çš„é­”æœ¯ã€‚æˆ‘ä»¬åªæ˜¯è¿­ä»£æˆ‘ä»¬çš„æŸ¥è¯¢ç»“æœã€‚å¹¶å‘ˆç°è°ƒè‰²æ¿ç»„ä»¶ã€‚

## [](#pagination)ğŸ“é¡µç 

æˆ‘ä»¬ç°åœ¨éœ€è¦å‘æŸ¥è¯¢ä¸­æ·»åŠ ä¸¤ä¸ªå‚æ•°ã€‚å®šä¹‰æŸ¥è¯¢å¼€å§‹å¤„çš„*åç§»é‡*çš„`skip`å‚æ•°å’Œå®šä¹‰*é™åˆ¶*æˆ–æ‚¨æƒ³è¦æŸ¥è¯¢å¤šå°‘ä¸ªå…ƒç´ çš„`first`å‚æ•°ã€‚æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“æœ‰å¤šå°‘å…ƒç´ ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ _meta æŸ¥è¯¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ–°æŸ¥è¯¢å°†å¦‚ä¸‹æ‰€ç¤º:

[![](../Images/db4c22e58245a1c67b6f1a6aac83d558.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--PihNTaNg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/onGUydf.png)

ç°åœ¨æˆ‘ä»¬çš„ GraphQL æŸ¥è¯¢å·²ç»å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬éœ€è¦æ›´æ–° Vue ç»„ä»¶ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„æ•°æ®ã€‚å› ä¸ºæˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­æ·»åŠ äº†`totalCount`ã€‚

`totalCount`éå¸¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒæ¥æ£€æŸ¥æ˜¯å¦æœ‰æ›´å¤šçš„è°ƒè‰²æ¿è¦åŠ è½½ã€‚å¦‚æœæˆ‘ä»¬åŠ è½½äº†æ‰€æœ‰çš„è°ƒè‰²æ¿ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†æ¬¡è·å–ã€‚æˆ‘ä»¬åªéœ€æ·»åŠ ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œå®ƒä¼šå‘Šè¯‰æˆ‘ä»¬æ˜¯å¦å¯ä»¥è·å–æ›´å¤šã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥ç”¨å®ƒï¼Œä½œä¸ºæˆ‘ä»¬*è£…è½½æ›´å¤š*æŒ‰é’®çš„æ¡ä»¶ã€‚

[![](../Images/da391734406aabc9856dd8fb1d0621a2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--70bHLJyv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/LROmQe4.png)

ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„ vue-apollo æŸ¥è¯¢å¹¶æ·»åŠ ç¼ºå¤±çš„å˜é‡ã€‚æˆ‘ä»¬åº”è¯¥é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡æ¥ä¿å­˜æˆ‘ä»¬æƒ³è¦è·å–çš„é¡¹ç›®æ•°é‡ã€‚ä¾‹å¦‚`PALETTES_PER_PAGE`ï¼Œæˆ‘æŠŠå®ƒåˆ›å»ºä¸ºä¸€ä¸ªå±€éƒ¨å¸¸é‡å˜é‡ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ constants.js æ¥ä¿å­˜æ‰€æœ‰è¿™ç±»å¸¸é‡ã€‚æ‰€ä»¥å¯ä»¥æ¢ä¸€ä¸ªåœ°æ–¹ã€‚

ç°åœ¨äº‹æƒ…å˜å¾—æœ‰ç‚¹æ£˜æ‰‹äº†ã€‚å› ä¸º vue-apollo ä¼šè‡ªåŠ¨å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°æœ¬åœ°æ•°æ®æ¨¡å‹ã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿”å›çš„å¯¹è±¡ã€‚ç¬¬ä¸€ä¸ª`allPalettes`å’Œç¬¬äºŒä¸ªæ€»æ•°ã€‚æˆ‘æƒ³ä½ ä¹Ÿå¯ä»¥æ‰§è¡ŒæŸ¥è¯¢ä¸¤æ¬¡ï¼Œä½†è¿™åœ¨æˆ‘çœ‹æ¥åƒæ˜¯ä»£ç å‘³é“ã€‚

ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vue-apollo é™„å¸¦çš„`result()`æ–¹æ³•ã€‚æˆ‘ä»¬ç®€å•åœ°æŠ“å–`totalCount`å¹¶å°†å®ƒåˆ†é…ç»™æˆ‘ä»¬çš„æœ¬åœ°`this.totalCount`ã€‚

[![](../Images/0c83646493088909ce278ced94ceaecb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--biXQdq4I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/pyKWNrR.png)

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„æŒ‰é’®ï¼Œå®ƒå°†è·å–æ›´å¤šçš„æ¡ç›®ã€‚å¦‚æ­¤ç®€å•ï¼Œæˆ‘ä»¬åªéœ€æ·»åŠ ä¸€ä¸ªå‘ˆç°æ¡ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬è®¡ç®—çš„å±æ€§ã€‚ç”±äºæˆ‘ä»¬æœ‰äº†åŠ è½½çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®ƒæ˜¯å¦åŠ è½½æ¥æ”¹å˜æŒ‰é’®æ–‡æœ¬ã€‚

ç‚¹å‡»åï¼Œæˆ‘ä»¬è°ƒç”¨æˆ‘ä»¬çš„`loadMore()`æ–¹æ³•ï¼Œæˆ‘ä»¬é©¬ä¸Šå°±ä¼šåˆ›å»ºå®ƒã€‚

[![](../Images/7844c532d205341d9d7c6f9ffd47679f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2iFdM2p---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/Xe03ukV.png)

## [](#%EF%B8%8F-updating-the%C2%A0query)âš¡ï¸æ›´æ–°æŸ¥è¯¢

ç°åœ¨æœ‰è¶£çš„éƒ¨åˆ†æ¥äº†ã€‚æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„æŸ¥è¯¢å¹¶è·å–æ›´å¤šä¿¡æ¯ã€‚Vue-apollo ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªå†…ç½®æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬çš„`loadMore()`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨

```
this.$apollo.queries.allPalettes.fetchMore({
  variables: {
    skip: this.allPalettes.length
  }
}) 
```

ä½ è¿˜è®°å¾—`skip`è®ºç‚¹åœ¨åšä»€ä¹ˆå—ï¼Ÿå¯¹ï¼Œå®ƒæ­£åœ¨è®¾ç½®ä¸€ä¸ª*åç§»é‡*ã€‚åœ¨æˆ‘ä»¬æœ€åˆçš„æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬å°†`skip: 0`å’Œ`first`è®¾ç½®ä¸º`PALETTES_PER_PAGE`ï¼Œç­‰äº 10ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ²¡æœ‰è·³è¿‡ä»»ä½•ä¸œè¥¿ï¼ŒåŠ è½½å‰ 10 ä¸ªè°ƒè‰²æ¿ã€‚ç°åœ¨æˆ‘ä»¬`fetchMore`ï¼Œè·³è¿‡å‰ 10 ä¸ªè°ƒè‰²æ¿ã€‚å› ä¸º`this.allPalettes.length`ç°åœ¨æ˜¯ 10ã€‚

ç„¶è€Œï¼Œè¿™è¿˜ä¸å¤Ÿã€‚æˆ‘ä»¬è¿˜å¿…é¡»æ›´æ–°ç¼“å­˜ä¸­çš„æŸ¥è¯¢ã€‚è¿™å¾ˆç®€å•:æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰`fetchMoreResults`ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬è¿”å›`previousResults`ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ç”¨`Object.assign()`å’Œæ‰©å±•æ“ä½œç¬¦å°†æ–°çš„è°ƒè‰²æ¿ç»“æœé™„åŠ åˆ°æ—§çš„è°ƒè‰²æ¿ç»“æœä¸Šã€‚å¦‚æœä½ è·Ÿä¸ä¸Šï¼Œç”¨[é˜¿æ³¢ç½— chrome æ’ä»¶](https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm)æ£€æŸ¥ä¸€ä¸‹é˜¿æ³¢ç½—ç¼“å­˜çš„ç»“æ„æ€»æ˜¯å¾ˆæœ‰å¸®åŠ©çš„

[![](../Images/1a6672ff93e7f3b38f65ed6d99087b1f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hViKrPQu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/NJKD4ot.png)

## [](#final%C2%A0result)ğŸ‰å†³èµ›æˆç»©

äº‹å®ä¸Šå°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬åªç”¨å‡ è¡Œä»£ç å°±å®ç°äº†è°ƒè‰²æ¿çš„æƒ°æ€§åŠ è½½ã€‚è¿™æ˜¯æœ€ç»ˆçš„ç»“æœ:

[é—ªäº® Gif](https://imgur.com/NrugRHv)

* * *

æˆ‘æ­£åœ¨å…¬å¼€å»ºé€ [å¯»è‰²](https://www.colourhunt.com/?ref=devto)ï¼Œä½ å¯ä»¥åœ¨ [WIP](https://wip.chat/products/880) ä¸Šè·Ÿè¸ªè¿›åº¦ã€‚æˆ‘ä¹Ÿä¸æ—¶åœ°ç›´æ’­å‘å±•ã€‚