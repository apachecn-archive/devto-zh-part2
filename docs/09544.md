# å®‰å…¨å¯é çš„æµè§ˆå™¨å—…æ¢

> åŸæ–‡:[https://dev . to/mahmoudelmahdi/safe-reliable-browser-snugging-39bp](https://dev.to/mahmoudelmahdi/safe-reliable-browser-sniffing-39bp)

æˆ‘ä»¬æœ€è¿‘ä¸ºæˆ‘ä»¬çš„ Web åº”ç”¨ç¨‹åºæ„å»ºäº†ä¸€ä¸ª WebExtensionï¼Œä½œä¸ºè¦é”€å”®çš„é™„åŠ å’Œé¢å¤–åŠŸèƒ½ğŸ’°ğŸ’¸(b/c ä¸ºä»€ä¹ˆä¸å¯ä»¥)ã€‚æˆ‘ä»¬å†³å®šæä¾› 4 ç§ä¸åŒçš„æµè§ˆå™¨ç±»å‹: **Chrome** ã€ **Safari** ã€ **Opera** å’Œ **Firefox** ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å¼„æ¸…æ¥šå“ªä¸ªæµè§ˆå™¨æ­£åœ¨å‘ˆç°æˆ‘ä»¬çš„é¡µé¢ï¼Œä»¥ä¾¿å‘ç”¨æˆ·æ˜¾ç¤ºç‰¹å®šäºæµè§ˆå™¨çš„æŒ‡ä»¤ã€‚

* * *

## ä½ åœ¨éª—æˆ‘ã€‚ä½ ä¸æ˜¯å—ï¼Ÿ

**ä½¿ç”¨ç”¨æˆ·ä»£ç†çš„æµè§ˆå™¨æ£€æµ‹**ç®€ç›´å¤ªçƒ‚äº†ï¼ï¼å› ä¸ºæ¶æè¿™ä¸ª**å€¼**æ˜¯å°äº‹ä¸€æ¡©ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç‰‡æ®µ:

```
navigator.userAgent.indexOf('Chrome') !== -1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸º**è°·æ­Œ Chrome** å’Œ **Opera** ( *å› ä¸º Opera ç”¨ Chrome*ä½¿ç”¨çš„ Blink + V8 æ›¿æ¢äº†å®ƒçš„å¼•æ“)è¿”å›`true`ï¼Œå› ä¸ºå®ƒçš„ UA å­—ç¬¦ä¸²çœ‹èµ·æ¥åƒ Chromeã€‚é‚£ä¸æ˜¯æˆ‘è¦æ‰¾çš„ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾æ£€æµ‹ä¸€ä¸ªç‰¹å®šçš„æµè§ˆå™¨ï¼Œé‚£ä¹ˆåŠŸèƒ½æ£€æŸ¥å°±å¤±å»äº†æ„ä¹‰ã€‚

> æŸ¥çœ‹ [MDN web docs:ä½¿ç”¨ç”¨æˆ·ä»£ç†](https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent)è¿›è¡Œæµè§ˆå™¨æ£€æµ‹ï¼Œäº†è§£æ›´å¤šè¯¦æƒ…ã€‚

## [](#toplevel-object-fwt)é¡¶çº§å¯¹è±¡ FWT

`window`æ˜¯**æµè§ˆå™¨å¯¹è±¡æ¨¡å‹** ( **BOM** )å±‚æ¬¡ä¸­çš„é¡¶å±‚å¯¹è±¡ã€‚æ¯ä¸€ä¸ªæµè§ˆå™¨éƒ½æœ‰è‡ªå·±çš„å±æ€§ï¼Œæ¯”å¦‚ Safari ä¸­çš„ *ApplePayError* ï¼Œæ­¤å¤–è¿˜æœ‰æ ‡å‡†å±æ€§(æ¯”å¦‚`window.location`ã€`window.console`ï¼Œ...ç­‰ç­‰)ã€‚

## [](#solution)è§£

```
/*
 * Browser detection
 * @return {String} 
 */
const browserDetection = () => {
  const browsers = {
    firefox: !!window.InstallTrigger,
    safari: !!window.ApplePaySession,
    opera: window.opr && !!window.opr.addons,
    chrome: window.chrome && !!window.chrome.webstore
  };

  return Object.keys(browsers).find(key => browsers[key] === true);
};

console.log(browserDetection()) // browser name expected 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   **Firefox**:`InstallTrigger`ç•Œé¢æ˜¯åº”ç”¨ç¨‹åº API ä¸­ä¸€ä¸ªæœ‰è¶£çš„å¼‚å¸¸ç‚¹ã€‚
*   **Safari** : `ApplePaySession`å±äº Apple Pay JS APIã€‚ç”¨äºç®¡ç†ç½‘ä¸Šæ”¯ä»˜è¿‡ç¨‹çš„ä¼šè¯å¯¹è±¡ã€‚
*   **æˆæ›²** : `opr`è‡ªæ˜ã€‚`.opr.addons`è¡¨ç¤ºé™„åŠ ç»„ä»¶ API ä¸­çš„æ¥å£
*   **Chrome** : ~~`chrome.webstore` API ä»ç½‘é¡µ~~ä¸­â€œå†…è”â€å¯åŠ¨åº”ç”¨å’Œæ‰©å±•å®‰è£…ã€‚æ³¨æ„:ç”±äº[éº¦è¿ªé€ŠÂ·è¿ªå…‹æ£®](https://dev.to/mix3d)ï¼Œè¿™å°†[å¼ƒç”¨](https://dev.to/_elmahdim/safe-reliable-browser-sniffing-39bp#comment-node-118287)ã€‚æ¬¢è¿ä»»ä½•æ¨èï¼

## [](#tested-in-the-following-desktop-browsers)åœ¨ä»¥ä¸‹â€œæ¡Œé¢æµè§ˆå™¨â€ä¸­æµ‹è¯•:

Firefox Quantum ç‰ˆæœ¬ 60

è°·æ­Œæµè§ˆå™¨ç¬¬ 67 ç‰ˆ

æ­Œå‰§ç‰ˆæœ¬~53

Safari ç‰ˆæœ¬~11

**è¯·è®°ä½**ï¼Œé‚£ä¸ªè§£å†³æ–¹æ¡ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹åˆšåˆšå¥½ï¼Œè€Œ<u>å¯èƒ½ä¸é€‚åˆä½ çš„</u>ã€‚

## [](#demo-on-codepen)[åœ¨ Codepen ä¸Šæ¼”ç¤º](https://codepen.io/elmahdim/full/bKjmbb/)

* * *

**æ¬¢è¿åé¦ˆ**ã€‚å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®æˆ–æ›´æ­£ï¼Œè¯·ä¸è¦çŠ¹è±«ç»™æˆ‘ç•™è¨€/è¯„è®ºã€‚