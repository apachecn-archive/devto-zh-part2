# 选择度量标准(第 3 部分)

> 原文：<https://dev.to/joshua/choosing-a-metric-part-3-2c6c>

性能是个问题，而且没有好转。移动页面加载时间的中位数是 15.6 秒，这是不可接受的。

我们需要有意义的测量，来捕捉用户页面加载的真实体验。

衡量这一点有好的和坏的标准。一个好的衡量标准能够准确反映用户体验，而一个差的衡量标准则不能。

# 坏指标

我们可以从一个不良指标的例子开始。考虑下面的页面加载:

[https://www.youtube.com/embed/qWKzErmqkZA](https://www.youtube.com/embed/qWKzErmqkZA)

衡量页面加载速度的一种常见方法是使用“load”事件。然而，当“load”事件被触发时，页面看起来像这样:

[![site loaded screenshot](../Images/76af0b3e0bcf6f37a4592199a8948d41.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--5kBvdZNl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/k2o6b8t8pqdkzauv5aed.png)

这显然不是页面加载的时间点。依赖这个指标是危险的。你会关注错误的事情，改变无意义的数字。同时，你会忽略真正的问题——你的用户会默默忍受。

# 好的指标

所以，这是一个糟糕的指标。但是什么是好的度量标准呢？

## 真实用户体验

我们会说，如果一个指标*反映了真实的用户体验*，那么它就是好的。有许多指标属性可以证明这一点:

*   在真实设备上测量
*   在真实用户的网络上测量
*   通过了一个基本的测试——对于我的网站来说，这个标准什么时候考虑体验是好是坏？这符合你的想法吗？

## 是一个“连续”函数

在数学意义上，连续函数意味着类似的东西，但我们会说一个度量是“连续的”,如果:

> 指标的小幅改善与 UX 的小幅改善相关，指标的大幅改善与 UX 的大幅改善相关。

以这种方式不“连续”的度量的一个例子可能是页面权重。如果您积极地进行代码拆分和缓存，那么页面权重的提高可能与 UX 的无提高有关。

另一个指标是不好的，如果一个页面在<1s and a 0% score if it loads in > =1s 内加载，它给出 100%的分数——将加载时间从 3s 提高到 2s 是稍微好一点的 UX，但不会得到该指标的奖励。

这是度量中的一个有用属性，因为这意味着度量不能被欺骗。您不能快速渲染加载微调器，并提高度量。我喜欢将开发人员视为贪婪的优化算法——他们将采取最短的路径来改进这一指标，并且在理想情况下，该路径也将是改进整体 UX 的最短路径。

## 是“可重复的”

[![A photo of agent smith from the matrix](../Images/58b710727bfd8bfa599a9cd31e54c216.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--CkIitkUF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/uvnamstr07nj1c9lb5br.png)

> 永远不要派人去做机器的工作——特工史密斯

一些指标可以通过监控以简单、自动的方式获得。有些更容易通过审计工具获得。但是，您必须花时间自动收集这些数据。这对于长期保存指标至关重要——对于像这样的常规任务，人类不如机器可靠，拥有大量数据点非常有用。在调试性能问题时，他们将是您的朋友，长期的历史数据积压非常宝贵。

# 公制选择

让我们看看我们拥有的一些不同的选择，并根据我们的标准对它们进行评估:

## 页面权重

从某些方面来说，页面权重是一个很好的衡量标准:它相对容易衡量，而且 [javascript 很贵](https://medium.com/@addyosmani/the-cost-of-javascript-in-2018-7d8950fbb5d4)。交付 javascript 总会有用户体验成本，因此测量页面权重是一件好事。

然而，页面权重是真实用户体验的代表——页面权重不一定意味着用户的页面加载体验不好。我们可能会积极地进行代码分割或缓存，这意味着这可能不符合上面列出的标准。

最终，页面权重作为一个指标将取决于您的用例，所以要仔细考虑页面权重实际上是如何影响用户体验的。

[Bundlesize](https://github.com/siddharthkp/bundlesize) 是一款自动测量页面重量的工具。

## 绘制时序

绘画时间是衡量性能的一个普遍选择。

[![Paint timing](../Images/d0eb96f35eb4362be9f966d0f72af96f.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--QVV1RhGE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ricahzwlv83dg9dvnwej.png)

上图中的三个绘画计时事件反映了绘画生命周期的不同部分。

第一次绘制:将任何内容绘制到页面上，例如:页面背景颜色从白色变为黑色
第一次内容丰富的绘制:将 DOM 元素呈现到页面上，例如:呈现加载微调器
第一次有意义的绘制:首先将有意义的数据呈现到页面上

第一次绘画和第一次有内容的绘画可以通过[绘画计时 API](https://css-tricks.com/paint-timing-api/) 来测量，但是，第一次有意义的绘画很难通过这种方式来测量。首先，有意义的绘画本质上是有意义的:用户认为对他们有用的东西被给了他们。这使得第一次有意义的绘制成为一个很好的度量，但是第一次绘制和第一次有内容的绘制可能只有根据您的用例才有意义。

### 随后意味深长的描绘

对于单页应用程序，除了“第一次”有意义的绘制之外，可能还有后续的页面加载。组件计时是一种使我们能够测量这些后续渲染时间的方法。 [react-component-timing](https://github.com/jpnelson/react-component-timing) 库试图创建一个 react 包装器来实现自动化——欢迎投稿！

## 速度指数

速度指数是一个很好的指标，但最初可能很难理解。一种想法是，我们“整合随时间加载的页面百分比”——这可能没有帮助澄清太多，所以让我们分解一下。

[![diagram of speed index](../Images/fac1afc9d984a44d6f1dd2386a56711e.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--CY2tFYP7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1nwb7mmz2nsq0vkgcnop.png)

我们跟踪在某个时间间隔内页面被加载的百分比。我们根据网页加载的百分比和速度给自己打分。举个例子，一个在 5 秒内加载所有内容的页面会比一个在 2.5 秒内加载一半页面，而在 5 秒内加载另一半页面的页面得分更低。

这是一个很好的指标，因为它自然地非常“连续”——它将“负载”的概念融入到一个单一的数字中。针对这个数字进行优化肯定会改善真实的用户体验。

这是一个很难在其他方面使用的指标:很难理解，这意味着它不能很好地传达用户的同理心。它没有单位，因此理解指标本身的要求。

它还需要一个像 webpagetest.org 这样的工具来测量它，因为我们需要知道在不同的时间间隔加载了多少百分比的页面。这意味着我们无法在**真实的**网络和设备上测量它，但我们可以模拟这些条件。

## ATF(折叠以上)渲染时间

折叠线以上渲染时间是指网页折叠线以上的所有内容加载完毕所需的时间。

这个指标相对容易理解和理解，但是它不能很好地处理初始负载后的问题。在真正的浏览器中很难衡量，事实上，你的用户[可能会滚动](http://abovethefold.fyi/)。

## 加载事件

在 DOMContentLoaded 和 javascript 下载之后触发 load 事件。

这是一个容易衡量和理解的指标，因此相当普遍。然而，还是有一些风险，就像例子中普遍存在的那样——它可能不会在真正有意义的时候被触发，特别是对于有意义数据的异步请求。

## 第一个字节

第一个字节很容易用[导航 API](https://developer.mozilla.org/en-US/docs/Web/API/Navigation_timing_API) 来测量，对于诊断网络和后端问题很有用。

然而，第一个字节可能并不代表对用户有实际意义的任何东西，因此不能单独依赖它。

## 到交互时间

交互时间测量页面准备好响应用户输入所用的时间。

到目前为止，我们讨论的度量标准只关注数据的交付，但是对于用户可能与之交互的任何应用程序(大多数应用程序！)我们需要一种方法来衡量这种响应，以了解用户是否真的认为这种体验是“高性能的”

交互时间有助于做到这一点，但是在初始页面加载之后意义就不大了。

为了测量它，有一个可用的[poly fill](https://github.com/GoogleChrome/tti-polyfill)通过测量 CPU 第一次空闲的时间来近似这种体验——这意味着页面准备好响应用户输入。

## 首次输入延时

第一次输入延迟衡量用户第一次与应用程序交互时，应用程序响应所需的时间。这可以是鼠标点击、触摸事件、键盘事件或用户发起的任何其他事件。

这个指标特别有趣，因为每个值都代表了真实的用户痛苦。如果你的第一次输入延迟是 1000 毫秒，那么在这个按钮做任何事情之前，必须等待整整一秒钟！

你需要注意的是，这个指标自然会有一些变化。第一次输入延迟将取决于用户——一个有耐心的用户可能会等很长时间才单击某个东西，但另一个用户可能会在一个按钮呈现后就单击。出于这个原因，建议测量第 90 个百分位数，这样你就可以优化减少那些真正痛苦的经历。

对于测量，有一个[多孔填料可用](https://github.com/GoogleChromeLabs/first-input-delay)

## DOMContentLoaded

DOMContentLoaded 测量解析 HTML 和下载/解析同步 javascript 所需的时间。

这基本上永远不是你想要的。如果您考虑使用 DOMContentLoaded 作为指标的检查点，请考虑使用“load”事件。

# 公制出发包

如果你刚刚开始，想开始测量一些东西，我会推荐:

*   互动时间到了
*   捆绑大小
*   首次输入延迟
*   第一次有意义的绘画(如果可以！)

我推荐这些产品，因为它们开箱即用，测量它们的方式也有所减少，而且在大多数情况下，它们代表了真正的用户痛苦。然而，值得为您的用例检查一下，哪一个是最好的。

# 工具

有许多很好的工具可以用来衡量上述指标:

1.  chrome 开发工具，包括 chrome 中的审计标签(“灯塔”)
2.  Lighthouse CI ，chrome 中审计标签的可重复版本
3.  [Webpagetest.org](//webpagetest.org)是一个测量上面列出的一些“难以测量”指标的神奇工具——它可以生成页面负载的视频，然后可以分析这些视频来计算速度指数等指标。
4.  [哨兵](//sentry.io)、[新遗迹](http://newrelic.com)和[谷歌分析](https://analytics.google.com)是实际跟踪真实用户指标的重要工具。记住在真实设备和真实网络上测量的重要性——这样的工具是必不可少的。

* * *

选择一个能够反映真实用户网络、设备和体验的良好指标非常重要。选择一个可以自动收集的指标也很重要。

既然我们已经选择了一个度量，我们需要考虑我们将如何达到这个目标，并保护它不受熵的控制！