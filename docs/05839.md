# ğŸš¥å¦‚ä½•ç”¨ PHP ç¼–å†™å¹²å‡€çš„ä»£ç ğŸ˜

> åŸæ–‡:[https://dev . to/biros/how-to-master-your-code-through-your-project-life cycle-12-4ke 3](https://dev.to/biros/how-to-master-your-code-through-your-project-lifecycle-12-4ke3)

è¿™æ˜¯å…³äºä»£ç è´¨é‡çš„ä¸¤ç¯‡æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚
è¿™ä¸ªä¸»è¦æ˜¯å…³äº **PHP** çš„ï¼Œä½†æ˜¯ç­‰ç­‰ï¼Œä¸è¦è·‘è·¯ï¼å¦‚æœä½ ç”¨æŸç§ä¸¥è‚ƒçš„è¯­è¨€ç¼–å†™ä»£ç ï¼Œä½ å¯èƒ½ä»ç„¶ä¼šæ„Ÿå…´è¶£ã€‚

* * *

[![good code vs bad code](../Images/b9b770fa0c42691c563126fb07ea72ce.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8N47COR1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u8djzx1ow0iuwsq8r3kx.png)

> æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å…³å¿ƒä»£ç è´¨é‡ï¼Ÿ

ä¸ºä»€ä¹ˆä¸ä½¿æˆ‘ä»¬çš„ä»£ç æŒ‰ç…§å®ƒåº”è¯¥çš„é‚£æ ·å·¥ä½œå‘¢ï¼Ÿå…¶å®è¿™å–å†³äºä½ çš„ app çš„ç”¨é€”ï¼Œå–å†³äºä½ çš„ç›®æ ‡ã€‚å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä¸€æ¬¡æ€§çš„åº”ç”¨ç¨‹åºï¼Œä¸ºäº†ä¸€ä¸ªæ¼”ç¤ºï¼Œæˆ–è€…ä»…ä»…æ˜¯ä¸ºäº†ä½ ï¼Œä½ æ˜¾ç„¶ä¸ä¼šæŠŠæ—¶é—´èŠ±åœ¨è´¨é‡ä¸Šã€‚ä½†å¦‚æœæ˜¯æ›´ä¸¥é‡çš„äº‹æƒ…ï¼Œå®ƒå°†æˆä¸ºå¼ºåˆ¶æ€§çš„ã€‚

å¯¹ä½ çš„ä»£ç çš„æ˜“è¯»æ€§ï¼Œå¯¹å¯ç»´æŠ¤æ€§ï¼Œå¯¹ä½ å’Œä½ çš„é˜Ÿå‹çš„å¥åº·éƒ½æ˜¯å¼ºåˆ¶æ€§çš„ã€‚

å¯¹äºä½ ä»¬ä¸­æœ€æ²¡æœ‰è€å¿ƒçš„äººï¼Œæˆ‘åœ¨ gitlab.com ä¸Šåˆ›å»ºäº†ä¸€ä¸ª[æ¨¡æ¿é¡¹ç›®](https://gitlab.com/mamyn0va/php-template),å…è®¸ä½ ä»¬ç”¨ç°æˆçš„è´¨é‡å·¥å…·å¿«é€Ÿå¯åŠ¨ä¸€ä¸ª PHP é¡¹ç›®ã€‚

* * *

> å“¦ç­‰ç­‰ï¼ä½ åœ¨è¯´è´¨é‡ï¼ŸçœŸçš„å—ï¼Ÿç”¨ PHPï¼Ÿ

PHP åå£°ä¸å¥½ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ç§è¢«æ²¡æœ‰ç»éªŒçš„å¼€å‘äººå‘˜ä½¿ç”¨çš„éå¸¸æ”¾çºµçš„è¯­è¨€ã€‚å®ƒçš„åŠ¨æ€ç±»å‹æœºåˆ¶ç»å¸¸è¢«è¯¯ç”¨ï¼Œåœ¨ç‰ˆæœ¬ 5 å’Œå¼•å…¥ OOP èŒƒä¾‹ä¹‹å‰ï¼Œå®ƒéå¸¸æ··ä¹±ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¤§å¤šæ•°ç”¨ PHP å¼€å‘çš„åº”ç”¨ç¨‹åºåªæ˜¯ç½‘ç«™ã€åšå®¢ã€è®ºå›æˆ–ä»»ä½•å…¶ä»– CMSï¼Œå¦‚ drupalã€wordpressã€joomlaã€prestashop...

ä»Šå¤©ï¼ŒPHP ç”Ÿæ€ç³»ç»Ÿä¸­çš„æƒ…å†µæœ‰äº†å¾ˆå¤§çš„ä¸åŒã€‚å®ƒçš„ä¾èµ–ç®¡ç†å™¨ [composer](https://getcomposer.org/) å·²ç»è¢«å¤§å¤šæ•°é¡¹ç›®ç»´æŠ¤äººå‘˜å¤§é‡é‡‡ç”¨ï¼Œå¹¶å¸®åŠ© PHP æˆä¸ºé‡è¦åç«¯åº”ç”¨ç¨‹åºçš„å¯é é€‰æ‹©ã€‚
æ­¤å¤–ï¼ŒPHP7 é€šè¿‡å¢å¼ºæ“ä½œç ç¼“å­˜å’Œ Zend å¼•æ“ï¼Œä¸º PHP çš„æ€§èƒ½å¸¦æ¥äº†çªç ´æ€§çš„å˜åŒ–ã€‚ç°åœ¨ï¼Œæœ‰äº†[ç±»å‹å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼](http://php.net/manual/en/migration70.new-features.php)çš„å¯èƒ½æ€§ã€‚ç»“åˆ[ä¸¥æ ¼ç±»å‹æ¨¡å¼](http://php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration.strict)ï¼Œç°åœ¨å¯ä»¥åœ¨ä½ çš„ IDE ä¸­æ£€æµ‹åˆ°å¾ˆå¤šéšè—çš„è¿è¡Œæ—¶é”™è¯¯ã€‚

* * *

æˆ‘ä¸ä¼šåœ¨è¿™é‡Œæ¶µç›–ä»£ç è´¨é‡çš„æ‰€æœ‰æ–¹é¢(æµ‹è¯•ï¼Œå®¡æŸ¥ï¼ŒTDDï¼Œ...)ä½†æ˜¯æˆ‘å°†æŠŠé‡ç‚¹æ”¾åœ¨æœ€åŸºç¡€çš„ä¸œè¥¿ä¸Š:ç¼–ç æ ‡å‡†/é£æ ¼&é™æ€åˆ†æã€‚

å½“ç„¶ï¼Œè¦æ¸…æ¥šçš„æ˜¯ï¼Œå·¥å…·æœ¬èº«ä»æ¥æ²¡æœ‰ä¿è¯è¿‡ä»»ä½•è½¯ä»¶çš„è´¨é‡ï¼Œä½†æ˜¯å®ƒä»¬æœ‰åŠ©äºä¿è¯è´¨é‡ã€‚å‡è®¾å®ƒä»¬è®©æˆ‘ä»¬æœ‰å¿ƒæƒ…ä¸æ–­åœ°å¯»æ±‚æ”¹è¿›æˆ‘ä»¬çš„ä»£ç ã€‚ä½†æ˜¯è¿™å¹¶ä¸å¦¨ç¢æˆ‘ä»¬è¿›è¡Œå•å…ƒæµ‹è¯•å’Œä»£ç å®¡æŸ¥ï¼

## [](#code-static-analysis-tools)âœ”ï¸ä»£ç é™æ€åˆ†æå·¥å…·

PHP-FIG è”ç›Ÿå‘å¸ƒäº†ä¸€å¥— T2 å»ºè®®ï¼Œæ—¨åœ¨è§„èŒƒ PHP çš„ä½¿ç”¨å¹¶ä¿ƒè¿›å…¶äº’æ“ä½œæ€§ã€‚å…¶ä¸­ä¸‰ä¸ªå…³æ³¨ç¼–ç é£æ ¼å’Œè‡ªåŠ¨åŠ è½½ã€ç¼–ç ç­‰å†…å®¹:

*   PSR1 : [åŸºæœ¬ç¼–ç æ ‡å‡†](https://www.php-fig.org/psr/psr-1/)
*   PSR2 : [ç¼–ç é£æ ¼æŒ‡å—](https://www.php-fig.org/psr/psr-2/)
*   PSR12(å®¡æŸ¥ä¸­):[æ‰©å±•ç¼–ç é£æ ¼æŒ‡å—](https://github.com/php-fig/fig-standards/blob/master/proposed/extended-coding-style-guide.md)

> ä¸‹é¢åˆ—å‡ºçš„å·¥å…·è¢« PHP ç¤¾åŒºå¹¿æ³›é‡‡ç”¨ï¼Œå¹¶å¾—åˆ°äº†ç§¯æçš„æ”¯æŒå’Œç»´æŠ¤ã€‚

### [](#phpcodesniffer-aka-phpcs)[PHP_CodeSniffer](https://github.com/squizlabs/PHP_CodeSniffer) (åˆå phpcs)

å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ PSR è§„èŒƒçš„æ‰€æœ‰ç»†èŠ‚(å³ä½¿å®ƒä¼šæ›´å¥½)ï¼Œå› ä¸ºä¸€äº›å·¥å…·å¯ä»¥ä¸ºæˆ‘ä»¬åš(ä¸€éƒ¨åˆ†)å·¥ä½œã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œç¾åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆ PSR å¹¶æ£€æµ‹è¿è§„ã€‚éšç€æ—¶é—´çš„æ¨ç§»å’Œç»éªŒçš„ç§¯ç´¯ï¼Œè¿™å¯¹ä½ æ¥è¯´ä¼šå˜å¾—å¾ˆè‡ªç„¶ã€‚

PHP_CodeSniffer æ£€æµ‹ PSR1/PSR2 è¿è§„ï¼ŒSquiz æ ‡å‡†æ£€æŸ¥äº† 130 æ¡è§„åˆ™(PS R1 7 æ¡ï¼ŒPSR 2 42 æ¡),ä¹Ÿé€‚ç”¨äº CSS å’Œ JSã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä» PSR2 æ ‡å‡†å¼€å§‹ï¼Œç„¶åä» PSR2 åˆ›å»ºæ‚¨è‡ªå·±çš„æ ‡å‡†(åˆå ruleset ),å¹¶ä½¿ç”¨æ‚¨éœ€è¦çš„ Squiz è§„åˆ™æ¥ä¸°å¯Œå®ƒï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŠ˜è¡·æ–¹æ¡ˆã€‚

#### [](#phpcs-installation)ğŸ’¡phpcs å®‰è£…

è¿™å°†æ·»åŠ  phpcs ä½œä¸ºé¡¹ç›®ä¾èµ–:

```
composer require "squizlabs/php_codesniffer" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¦åœ¨é¡¹ç›®ä¹‹å¤–ä½¿ç”¨å®ƒï¼Œä½ åº”è¯¥å…¨å±€å®‰è£…å®ƒå¹¶å°†`vendor/bin`æ·»åŠ åˆ°ä½ çš„`PATH` :

```
composer global require "squizlabs/php_codesniffer"
export PATH=$PATH:~/path/to/composer/vendor/bin 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#phpcs-usage)ğŸ†˜phpcs ä½¿ç”¨

ç°åœ¨ï¼Œè€ƒè™‘ä¸‹é¢åŒ…å«ä¸€äº›è¿è§„çš„ PHP ç¤ºä¾‹...

```
<?php
class MaClasse{
    var $monAttribut;

    public function MaClasse ($monAttribut){
        $this->setMonAttribut( $monAttribut );
    }

    function setMonAttribut($monAttribut){
        $this->monAttribut=$monAttribut;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...çœ‹çœ‹å¦‚æœæˆ‘ä»¬å°† phpcs ä¸ PSR2 æ ‡å‡†ä¸€èµ·ä½¿ç”¨ä¼šå‘ç”Ÿä»€ä¹ˆ:

[![phpcs psr2](../Images/5b601158e444e8993eeb1e120ee99bce.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--QRqZLUQd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ad5961j64i00uu8n6ooe.png)

è¯¥å·¥å…·æ£€æµ‹åˆ° 12 ä¸ªé”™è¯¯ï¼Œå…¶ä¸­ 6 ä¸ªå¯ä»¥è‡ªåŠ¨ä¿®å¤ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœç”¨ Squiz æ ‡å‡†é‡æ–°è¿è¡Œè¯¥å·¥å…·ä¼šå‘ç”Ÿä»€ä¹ˆ:

[![phpcs squiz](../Images/9f2b8e8865db6a2c758f6ebb93301a5b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--cV9I6kK5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ievvzmjqb59bs1jjnz7b.png)

è¯¥å·¥å…·æ£€æµ‹åˆ° 28 ä¸ªé”™è¯¯ï¼Œå…¶ä¸­ 18 ä¸ªå¯ä»¥è‡ªåŠ¨ä¿®å¤ã€‚æˆ‘å¯¹ Squiz æ ‡å‡†çš„çœ‹æ³•æ˜¯æœ‰ç‚¹å¤ªå•°å—¦äº†ã€‚å› æ­¤ï¼Œæˆ‘ç”¨æ‰€æœ‰ PSR2 è§„åˆ™åˆ›å»ºäº†è‡ªå·±çš„è§„åˆ™é›†ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›å¯¹æˆ‘æœ‰æ„ä¹‰çš„ Squiz è§„åˆ™ã€‚

ä¸ºäº†æ›´è¿›ä¸€æ­¥ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ [phpcs_psr2](https://gitlab.com/mamyn0va/php-template/blob/master/phpcs_psr2.xml.dist) å’Œ [phpcs_squiz](https://gitlab.com/mamyn0va/php-template/blob/master/phpcs_squiz.xml.dist) è§„åˆ™é›†ã€‚

### [](#php-code-beautifier-and-fixer-aka-phpcbf)PHP ä»£ç ç¾åŒ–å™¨å’Œä¿®å¤å™¨(åˆå phpcbf)

å—¯ï¼Œæ£€æµ‹è¿è§„æ˜¯ä¸é”™ï¼Œä½†å¦‚æœèƒ½è‡ªåŠ¨çº æ­£å°±æ›´å¥½äº†ï¼Œå¯¹å§ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œ **PHP_CodeSniffer** é™„å¸¦äº†å¦ä¸€ä¸ªä¿®å¤ä¸»è¦ PSR1 å’Œ PSR2 è¿è§„çš„å®ç”¨ç¨‹åº: **PHP ä»£ç ç¾åŒ–å™¨å’Œä¿®å¤å™¨**(åˆå phpcbf)ã€‚åªéœ€åœ¨ PHP æ–‡ä»¶æˆ–ä»£ç åº“ä¸Šè¿è¡Œå®ƒï¼Œå®ƒå°±ä¼šæ‰«ææ‰€æœ‰æ–‡ä»¶å¹¶å°è¯•è‡ªåŠ¨ä¿®å¤è¿è§„æƒ…å†µ:

[![phpcbf psr2](../Images/182ebbe41abe82050e8a338acb647959.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_a9Ilbqn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5ltf1nn9grveodqbgrk4.png)

å½“ä½¿ç”¨ PSR2 æ ‡å‡†åœ¨`MaClasse.php`ä¸Šä½¿ç”¨å®ƒæ—¶ï¼Œå®ƒä¿®å¤äº† 12 ä¸ªè¿è§„ä¸­çš„ 6 ä¸ª:

```
<?php

class MaClasse
{
    var $monAttribut;

    public function MaClasse($monAttribut)
    {
        $this->setMonAttribut($monAttribut);
    }

    function setMonAttribut($monAttribut)
    {
        $this->monAttribut=$monAttribut;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è¯¥è½®åˆ°ä½ ä½¿ç”¨å®ƒäº†ï¼Œåˆ›å»ºä½ è‡ªå·±çš„è§„åˆ™é›†æ¥æ»¡è¶³ä½ ã€ä½ çš„é˜Ÿå‹å’Œä½ çš„é¡¹ç›®çš„éœ€è¦ã€‚å½“ç„¶ï¼Œè¿™ä¸ª**å¿…é¡»**ä¸å…¶ä»–å¼€å‘äººå‘˜å…±äº«ï¼Œä»¥ä¾¿æœ‰ä¸€ä¸ªåŒè´¨çš„ä»£ç åº“ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚

### [](#php-mess-detector-aka-phpmd)[PHP åƒåœ¾æ£€æµ‹å™¨](https://phpmd.org/)(åˆå phpmd)

å’Œ Java åŠå…¶ [PMD](https://pmd.github.io/) ä¸€æ ·ï¼ŒPHP ä¹Ÿæœ‰è‡ªå·±çš„åƒåœ¾æ£€æµ‹å·¥å…·ã€‚é€šè¿‡ä¸€ä¸ªè§„åˆ™é›†æœºåˆ¶(æ¯”å¦‚ PHP_CodeSniffer)ï¼Œè¿™ä¸ªå·¥å…·å°†æ£€æµ‹è®¸å¤šè¿å*å¹²å‡€ä»£ç *åŸåˆ™çš„è¡Œä¸º:

*   å¯èƒ½çš„é”™è¯¯
*   æ¬¡ä¼˜ä»£ç 
*   è¿‡äºå¤æ‚çš„è¡¨è¾¾å¼
*   æœªä½¿ç”¨çš„å‚æ•°ã€æ–¹æ³•ã€å±æ€§
*   ...

#### [](#phpmd-installation)ğŸ’¡phpmd å®‰è£…

```
composer require phpmd/phpmd 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæ‚¨éœ€è¦ä¸º phpmd æä¾›ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶æŒ‡å®šä¸€ç§è¾“å‡ºæ ¼å¼(æ–‡æœ¬ã€XML æˆ– HTML)å’Œä¸€ä¸ªæˆ–å¤šä¸ªè§„åˆ™é›†ã€‚

#### [](#phpmd-usage)ğŸ†˜phpmd ç”¨æ³•

è®©æˆ‘ä»¬ä»¥ä¹‹å‰å›ºå®šçš„ phpcbf/PSR2 ä¸ºä¾‹ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ªæœªä½¿ç”¨çš„å˜é‡:

```
<?php
class MaClasse
{
    var $monAttribut;

    public function MaClasse($monAttribut)
    {
        $this->setMonAttribut($monAttribut);
    }

    function setMonAttribut($monAttribut)
    {
        $test;
        $this->monAttribut=$monAttribut;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œç”¨ phpmd å’Œæ‰€æœ‰å¯ç”¨çš„è§„åˆ™é›†æ£€æŸ¥å®ƒ:

```
phpmd MaClasse.php text cleancode,codesize,controversial,design,naming,unusedcode 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

phpmd çš„è¾“å‡º:

```
MaClasse.php:6    The method MaClasse is not named in camelCase.
MaClasse.php:6    Classes should not have a constructor method with the same name as the class
MaClasse.php:12    Avoid unused local variables such as '$test'. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œè¯¥å·¥å…·æ˜¯ PHP_CodeSniffer çš„è¡¥å……ï¼Œå› ä¸ºå®ƒå‘ç°äº†ä¸‰ä¸ªä»¥å‰æ²¡æœ‰æ£€æµ‹åˆ°çš„æœ‰è¶£çš„æ–°è¿è§„ã€‚å½“ç„¶ï¼Œå¦‚æœæ‚¨è¿è¡Œå®ƒé€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ä»£ç åº“ï¼Œå®ƒä¹Ÿå°†æå‡ºè®¸å¤šæˆ–å¤šæˆ–å°‘æœ‰ç”¨çš„è¿è§„ï¼Œå¯èƒ½æ˜¯å˜ˆæ‚çš„ï¼Œå¹¶é˜»æ­¢æ‚¨çœ‹åˆ°æœ‰æ„ä¹‰çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œæ­£å¦‚æˆ‘ä¹‹å‰å¯¹ PHP_CodeSniffer è¯´è¿‡çš„ï¼Œæˆ‘å»ºè®®ä½ åŸºäºç°æœ‰çš„åˆ›å»ºè‡ªå·±çš„è§„åˆ™é›†ã€‚æ‚¨éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`phpmd.xml.dist`çš„æ–‡ä»¶ï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨ç»ˆç«¯ã€ç¼–è¾‘å™¨/IDE å’Œç®¡é“ä¸­ä½¿ç”¨å®ƒã€‚

è¯·åœ¨æ­¤å¤„æ‰¾åˆ°[ä½¿ç”¨æ‰€æœ‰ç°æœ‰è§„åˆ™çš„è§„åˆ™é›†](https://gitlab.com/mamyn0va/php-template/blob/master/phpmd.xml.dist)ã€‚

ä½†æ˜¯å’Œ phpcs ä¸€æ ·ï¼Œæˆ‘å»ºè®®ä½ ä»æœ€å°è§„åˆ™é›†`unusedcode`å¼€å§‹è¿­ä»£è¿›è¡Œï¼Œå¹¶é€æ¸åŠ å…¥å¯¹ä½ å’Œä½ çš„é¡¹ç›®æœ‰æ„ä¹‰çš„æ–°è§„åˆ™ã€‚

è¯·åœ¨ä¸‹é¢æ‰¾åˆ°ä¸€ä¸ªè‡ªå®šä¹‰è§„åˆ™é›†ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥å¯åŠ¨ phpmd:

```
<?xml version="1.0"?>
<ruleset name="Custom rule set used in pre-commit git hook"
         xmlns="http://pmd.sf.net/ruleset/1.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sf.net/ruleset/1.0.0 http://pmd.sf.net/ruleset_xml_schema.xsd"
         xsi:noNamespaceSchemaLocation="http://pmd.sf.net/ruleset_xml_schema.xsd">
    <description>
        Custom rule set used in pre-commit git hooks
    </description>

    <!-- Import the entire unused code rule set -->
    <rule ref="rulesets/unusedcode.xml" />
    <!-- Import a part of design code rule set -->
    <rule ref="rulesets/design.xml">
        <exclude name="NumberOfChildren" />
        <exclude name="DepthOfInheritance" />
        <exclude name="CouplingBetweenObjects" />
    </rule>
</ruleset> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#php-coding-standards-fixer-aka-phpcsfixer)[PHP ç¼–ç æ ‡å‡†å›ºå®šå™¨](https://github.com/FriendsOfPhp/PHP-CS-Fixer)(åˆå php-cs-fixer)

> å¦‚æœæˆ‘ä»¬ä»¥å¦ä¸€ç§å·¥å…·ç»“æŸå‘¢ï¼Ÿå¦‚æœä½ åªèƒ½é€‰æ‹©ä¸€ä¸ªå·¥å…·ï¼Œé‚£å°±æ˜¯è¿™ä¸ªã€‚

å®ƒåšçš„äº‹æƒ…å’Œ phpcbf åšçš„å‡ ä¹ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹ PSR è§„åˆ™ï¼Œä½†æ˜¯å®ƒåšçš„æ›´å¥½æ›´æ·±å…¥ã€‚åƒ phpcbf ä¸€æ ·ï¼Œå®ƒä¹Ÿå…è®¸ä½ ä»ä¸€ç³»åˆ— [172 æ¡è§„åˆ™](https://github.com/FriendsOfPhp/PHP-CS-Fixer#usage)ä¸­æ·»åŠ ä¸€äº›å…¶ä»–è§„åˆ™ã€‚å¦ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…æ˜¯è§„åˆ™é›†æ–‡ä»¶çš„åˆ›å»ºï¼Œå®ƒæ˜¯ä¸€ä¸ª PHP æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å†—é•¿çš„ XMLã€‚

#### [](#phpcsfixer-installation)ğŸ’¡PHP-cs-å›ºå®šå™¨å®‰è£…

```
composer require friendsofphp/php-cs-fixer 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#phpcsfixer-usage)ğŸ†˜php-cs å›ºå®šç”¨æ³•

```
php-cs-fixer --verbose fix MaClasse.php
Loaded config default from "~/.php_cs.dist".
Using cache file ".php_cs.cache".
Paths from configuration file have been overridden by paths provided as command arguments.
F
Legend: ?-unknown, I-invalid file syntax, file ignored, S-Skipped, .-no changes, F-fixed, E-error
   1) MaClasse.php (class_attributes_separation, no_spaces_inside_parenthesis, declare_strict_types, blank_line_after_opening_tag, array_syntax, class_definition, 
function_declaration, visibility_required, declare_equal_normalize, binary_operator_spaces, braces)

Checked all files in 0.008 seconds, 8.000 MB memory used 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹é¢æ˜¯å¸¦æœ‰è‡ªå®šä¹‰è§„åˆ™é›†çš„ MaClasse.php çš„è¾“å‡º:

```
declare(strict_types = 1);
class MaClasse
{
    public $monAttribut = [];

    public function __construct($monAttribut)
    {
        $this->setMonAttribut($monAttribut);
    }

    public function setMonAttribut($monAttribut)
    {
        $this->monAttribut = $monAttribut;
        $test = 1;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘çš„è‡ªå®šä¹‰è§„åˆ™é›†(ã€‚php_cs.dist) :

```
$finder = PhpCsFixer\Finder::create()
    ->exclude('vendor')
    ->exclude('output')
    ->exclude('releases')
    ->in(__DIR__)
;

return PhpCsFixer\Config::create()
    ->setRiskyAllowed(true)
    ->setRules([
        '@PSR2' => true,
        'declare_strict_types' => true,
        'align_multiline_comment' => ['comment_type' => 'phpdocs_only'],
        'binary_operator_spaces' => true,
        'blank_line_after_opening_tag' => true,
        'cast_spaces' => true,
        'class_attributes_separation' => true,
        'compact_nullable_typehint' => true,
        'concat_space' => ['spacing' => 'one'],
        'declare_equal_normalize' => ['space' => 'single'],
        'function_typehint_space' => true,
        'no_blank_lines_after_class_opening' => true,
        'no_blank_lines_after_phpdoc' => true,
        'no_extra_consecutive_blank_lines' => true,
        'no_mixed_echo_print' => true,
        'no_php4_constructor' => true,
        'no_unused_imports' => true,
        'no_useless_else' => true,
        'no_useless_return' => true,
        'no_whitespace_before_comma_in_array' => true,
        'no_whitespace_in_blank_line' => true,
        'object_operator_without_whitespace' => true,
        'ordered_class_elements' => true,
        'ordered_imports' => true,
        'phpdoc_align' => true,
        'phpdoc_indent' => true,
        'yoda_style' => true,
        'protected_to_private' => true,
        'return_type_declaration' => true,
        'self_accessor' => true,
        'single_blank_line_before_namespace' => true,
        'single_quote' => true,
        'ternary_operator_spaces' => true,
        'ternary_to_null_coalescing' => true,
        'whitespace_after_comma_in_array' => true,
        'array_syntax' => ['syntax' => 'short'],
    ])
    ->setFinder($finder)
; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¶ä¸­ä¸€äº›è§„åˆ™è¢«ç§°ä¸º*é£é™©*ï¼Œå› ä¸ºå®ƒä»¬ä¼šå½±å“ PHP çš„è¿è¡Œæ—¶ï¼Œæ‰€ä»¥è¦å°å¿ƒä½¿ç”¨ï¼åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†å…¶ä¸­çš„ä¸¤ä¸ª:

*   `declare_strict_types`(æ‰“å­—æ¨¡å¼è®¾ç½®ä¸º`strict`è€Œä¸æ˜¯`weak`)
*   `no_php4_constructor`(å»ºé€ è€…**å¿…é¡»**å‘½åä¸º`__construct`)

æ‚¨å¯ä»¥ä½¿ç”¨è®¾ç½®å™¨`setRiskyAllowed(false)`ç¦ç”¨æ­¤åŠŸèƒ½ã€‚

`declare_strict_types`è§„åˆ™ç‰¹åˆ«æœ‰è¶£ï¼Œå› ä¸ºå®ƒåœ¨æ¯ä¸ª PHP æ–‡ä»¶çš„å¤´ä¸­æ·»åŠ äº†ä¸‹é¢ä¸€è¡Œ:`declare(strict_types = 1);`

è¿™ä¸ª PHP7 è¯­å¥å…è®¸å¯¹æ ‡é‡ç±»å‹(intï¼Œarrayï¼Œstringï¼Œboolï¼Œ...).è¿™æ„å‘³ç€å¦‚æœä½ ç”¨ä¸€ä¸ª`string`è€Œä¸æ˜¯ä¸€ä¸ªé¢„æœŸçš„`int`æ¥æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯è€Œä¸æ˜¯å°†`string`å¼ºåˆ¶è½¬æ¢ä¸º`int`(ä¾‹å¦‚â€œ7 æ¬¡â€= > 7)ã€‚

* * *

æœ€åï¼Œæ‚¨å¿…é¡»å°†å·¥å…·è§†ä¸ºåº”ç”¨ç¨‹åºä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ–¹é¢ï¼Œå®ƒä»¬åˆ—åœ¨é¡¹ç›®çš„ä¾èµ–é¡¹ä¸­ï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒä»¬çš„é…ç½®æ–‡ä»¶å’Œè§„åˆ™é›†ä¹Ÿæ˜¯æ‚¨çš„ä»£ç åº“çš„ä¸€éƒ¨åˆ†:

[![php_repo](../Images/8027c4cfb80fb9664616c2e38fc99d8e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wTT6cqfJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kxwp91bkwtg2mz2rxwf2.png)

è¿™å¯¹ PHP æ¥è¯´æ˜¯æ­£ç¡®çš„ï¼Œä½†å¯¹ä»»ä½•ä¸€ç§è¯­è¨€æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™æ˜¯åœ¨ä½ çš„å›¢é˜Ÿä¸­æ‹¥æœ‰*åŒè´¨ä»£ç åº“*çš„å”¯ä¸€æ–¹æ³•ã€‚

### [](#to-go-further)ğŸ› ï¸èµ°å¾—æ›´è¿œ

*   phan :å¼ºå¤§çš„ä»£ç é™æ€åˆ†æå™¨
*   [phpstan](https://github.com/phpstan/phpstan) : PHP é™æ€åˆ†æå·¥å…·
*   (åˆä¸€ä¸ª)PHP é™æ€åˆ†æå™¨ï¼Œè¾“å‡ºä¸€äº›ç”¨æˆ·å‹å¥½çš„æŠ¥å‘Š
*   PHP å¤åˆ¶/ç²˜è´´æ£€æµ‹å™¨(åˆå phpcpd):ä¸€ä¸ªé‡å¤ä»£ç æ£€æµ‹å™¨
*   sonar PHP:sonar cube å’Œ SonarLint çš„é™æ€ PHP ä»£ç åˆ†æå™¨
*   phploc :ä¸€ä¸ªç»™ä½  PHP é¡¹ç›®ç»Ÿè®¡æ•°æ®çš„å·¥å…·

* * *

ğŸŒŸå…³äºè¿™ä¸ªè¯é¢˜ï¼Œè¯·éšæ—¶é—®æˆ‘ä»»ä½•é—®é¢˜ï¼

â­ï¸:åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸä¸­é›†æˆè¿™äº›å·¥å…·(gitï¼Œeditor/IDEï¼ŒCI)ã€‚

* * *

æœ‰ç”¨çš„é“¾æ¥:

*   [PHP æ ‡å‡†å»ºè®®](https://www.php-fig.org/psr)
*   [PHP:æ­£ç¡®çš„æ–¹æ³•](https://www.phptherightway.com)