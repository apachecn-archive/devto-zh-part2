# 失效微服务的三个品质

> 原文:[https://dev . to/liquid _ chickens/three-qualities-of-failed-microservice-48ap](https://dev.to/liquid_chickens/three-qualities-of-failed-microservices-48ap)

微服务可以很牛逼。分割你的整体来独立扩展服务，加速变化，增加弹性可以获得巨大的回报。实施良好的微服务所提供的敏捷性是你回顾过去并思考“我们以前是如何做到这一点的？”

微服务也可以很可怕。如果执行得不好，它们可能会导致比解决的问题更多的问题，并造成无法控制的混乱。

这两种场景我都见过，但是失败的微服务项目比我遇到的成功的要多。随着围绕微服务的想法逐渐成熟，人们获得了更多实现它们的经验，情况会越来越好，但仍有很长的路要走。

失败是我们学习的地方。在思考我所见过的失败的微服务实施时(当然，这是从 seen 运营的角度来看。)，他们都有相似的特质。

## 1。他们分开得太早了

一个设计良好的微服务需要对您试图开拓的服务边界和环境有一个坚实的理解。如果你刚刚建立了你的 MVP，你*可能*没有这种理解。如果你试图**用微服务启动**你的应用，你*肯定*没有这种理解。

当人们没有很好地理解他们的应用程序的边界时，他们倾向于依靠的基本原理是通过数据模型而不是行为来划分事物。如果你把你的应用程序分成“用户”、“订单”和“物品”这样的东西，你会得到三个 CRUD 微服务，然后是一整套微服务(或一个单独的整体)，处理你创建的第一批服务之间的业务逻辑。在这种情况下，您基本上只是在抽象您的数据库。

相反，如果您做了类似“auth”、“order”和“stockcheck”的事情，其中每个服务都是由其行为而不是其数据来定义的，那么您最终会得到更少、更智能的服务、直观的逻辑流程，以及如何以及何时扩展每个部分的清晰想法。

尽可能长时间坚持使用单一应用程序。让应用程序和你对正在构建的业务流程的理解变得成熟。然后，在有意义的时间和地点，开始拆分微服务。

## 2。他们紧密结合在一起

一个业务流程可能依赖于多个微服务一起工作，但是这些服务中的每一个都不应该依赖于另一个来运行。否则你没有微服务。你有一个分布式的整体，包含了两个世界最糟糕的部分。

我见过的最糟糕的例子是一个应用程序有三个版本的微服务交付的 API。对你的 API 进行版本控制是合法的，这没有错。但是这些人所做的是让每个版本同步依赖于之前的版本。V3 引用 v2 和 v1，v2 引用 v1。

我见过相反的迁移策略，开发人员实现一个新版本的 API，保持 v1 不变，并改变 v1 的逻辑，将请求转发给 v2。感觉很合理。向后耦合依赖毫无意义。这意味着他们永远无法摆脱旧的 API，故障排除是一场噩梦。

在同一个堆栈中，几乎所有的服务都依赖于消息传递系统中的复杂逻辑(在本例中是 RabbitMQ)。这导致影响所有服务的频繁级联故障。

## 3。他们是精心策划的

有一个微服务(和 SOA)概念，即"[编排优于编排](https://specify.io/concepts/microservices#choreography)"，这意味着编排的服务可以独立运行，而编排的服务需要一个中央指挥。

我见过一个非常常见的场景，其中微服务被实现，然后由企业服务总线(ESB)驱动，如 JBoss Fuse。所有请求和核心业务逻辑都必须通过 ESB，这可能是整个应用程序中最难扩展的组件，通常是由于状态管理的许可和技术限制。因为所有这些逻辑都集中在 ESB 中，所以除非 ESB 告诉他们做什么，否则分支周围的微服务不知道该做什么。如果你试图建立一个有弹性的系统，这是很糟糕的。

再次，这将把你放回分布式独石领土。ESB 本质上是复杂的，并且经常是脆弱的。因此，一个复杂、脆弱、难以扩展的单点故障成为所有服务的瓶颈。这不会给你带来痛苦的可能性很小。这并不是说 ESB 没有他们的位置，只是他们没有很好地与微服务架构保持一致。

API 网关似乎正在成为 ESB 的一种新形式，因此关注类似的问题并使您的 API 网关尽可能的简单(基本上只是使用它们来合并请求或添加 auth)是很重要的。

## 耐心等待&深思熟虑

架构良好的微服务需要大量专注的思考和研究。这是一个你在读了关于这个话题的第一篇博文后不想涉足的领域。不得不重新界定服务边界和重新实现服务是我经历过的最痛苦的工程实践之一。我希望把你从痛苦中拯救出来。

幸运的是，有一些很好的资源可以提供帮助。我建议如下:

*   萨姆·纽曼打造微服务
*   Eric Evans 的领域驱动设计
*   Susan J. Fowler 的生产就绪微服务

不要追求微服务，因为网飞或谷歌或脸书使用它们。当它们对你的应用有意义的时候使用它们，不要介意它们可能对你毫无意义。

微服务并不比整体架构“更好”。它们只是解决了一系列不同的问题，这些问题大多与规模和特定业务的运营方式有关。成为优秀工程师的一部分就是使用正确的工具来解决正确的问题。在你进入微服务之前，暂停一下，确保你正在做的就是这个。