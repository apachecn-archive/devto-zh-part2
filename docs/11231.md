# ä½¿ç”¨æ­¤è„šæœ¬ç›‘æ§æ‚¨çš„ HTTPS è¯ä¹¦åˆ°æœŸæ—¶é—´

> åŸæ–‡:[https://dev . to/shobhitic/monitor-your-https-certificate-expiry-with this-script-1k 02](https://dev.to/shobhitic/monitor-your-https-certificate-expiry-with-this-script-1k02)

å»å¹´é™¤å¤•ï¼Œæˆ‘æ¥åˆ°å®¢æˆ·çš„ç”µè¯ã€‚ä»–ä»¬è¯´ä»–ä»¬çš„ç½‘ç«™è¢«ç—…æ¯’æ„ŸæŸ“äº†ï¼Œæ²¡æœ‰äººèƒ½è®¿é—®å®ƒã€‚

ç°åœ¨ï¼Œæˆ‘çš„å®¢æˆ·ç»è¥ç€ä¸€å®¶æœæ±åº—ï¼Œä»–ä¸çŸ¥é“ç½‘ç»œåœ¨æŠ€æœ¯ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘æ”¾å¼ƒäº†â€œç—…æ¯’â€é—®é¢˜ï¼Œä½†ä»–è¯´ç½‘ç«™æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥æˆ‘å¯åŠ¨äº†æ‰‹æœºä¸­çš„ Firefoxï¼Œçœ‹åˆ°äº†`Your connection is not secure`é¡µé¢ã€‚

è‡ªä» Let's Encrypt æ¨å‡ºæµ‹è¯•ç‰ˆä»¥æ¥ï¼Œæˆ‘ä¸€ç›´ç”¨å®ƒæ¥å°†æˆ‘å’Œæˆ‘å®¢æˆ·çš„æ‰€æœ‰ç½‘ç«™è½¬æ¢ä¸ºé€šè¿‡ HTTPS çš„å®‰å…¨è¿æ¥ã€‚æˆ‘å·²ç»æŒ‰ç…§ [certbot](https://certbot.eff.org/) çš„æŒ‡ç¤ºå»ºç«‹äº†ä¸€ä¸ª cron æ¥å®šæœŸæ›´æ–°è¯ä¹¦ï¼Œä½†æ˜¯å®ƒæ›¾ç»æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå¤±è´¥ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰æ›´æ–° python åŒ…ï¼Œæˆ–è€…ç±»ä¼¼çš„äº‹æƒ…ã€‚Let's Encrypt éå¸¸å‹å¥½ï¼Œå¯ä»¥åœ¨è¿‡æœŸå‰å‘é€é‚®ä»¶ï¼Œä½†åˆå§‹å®‰è£…æ˜¯ç”±ä¸€åå‘˜å·¥å®Œæˆçš„ã€‚

å› ä¸ºé‚£å¤©æ˜¯ 12 æœˆ 31 æ—¥ï¼Œæˆ‘åœ¨ä¸€ä¸ªèšä¼šä¸Šï¼Œæ²¡æœ‰é è¿‘æˆ‘çš„æœºå™¨çš„åœ°æ–¹ï¼Œæˆ‘å¯ä»¥ç”¨ ssh è¿›å…¥æœåŠ¡å™¨å¹¶æ€æ­»è¿™ä¸ªæ€ªç‰©ã€‚æˆ‘çš„æ‰‹æœºä¸Šæœ‰ JuiceSSHï¼Œæˆ‘ç”¨å®ƒç™»å½•åˆ°æœåŠ¡å™¨(æ„Ÿè°¢ä¸Šå¸æˆ‘å·²ç»æŒ‰ç…§æˆæƒæ·»åŠ äº†æˆ‘çš„å¯†é’¥)ï¼Œæ›´æ–°äº†åŒ…å¹¶æ›´æ–°äº†è¯ä¹¦ã€‚

ä¸æ­¤åŒæ—¶ï¼Œæˆ‘å‘¨å›´çš„äººä» 10 å¼€å§‹å€’æ•°ã€‚

## [](#not-taking-a-pledge)ä¸å–å½“å¤´

è¿™ç”šè‡³ä¸æ˜¯ç¬¬ä¸€æ¬¡å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ‰€ä»¥æˆ‘å½“æ—¶å°±å†³å®šï¼Œæˆ‘è¦è‡ªå·±è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å°å¿ƒç¿¼ç¿¼åœ°é€‰æ‹©ä¸æŠŠå®ƒä½œä¸ºæˆ‘çš„æ–°å¹´å†³å¿ƒï¼Œå¦åˆ™æ˜å¹´æˆ‘è¿˜ä¼šè®²åŒæ ·çš„æ•…äº‹ã€‚

å› æ­¤ï¼Œåœ¨ 1 æœˆ 1 æ—¥ï¼Œæˆ‘å†™äº†ä¸€ä¸ª Ruby è„šæœ¬(ä¸€åˆ†é’Ÿåä¼šæœ‰æ›´å¤šå†…å®¹)å¹¶ä¸æ–­æ”¹è¿›å®ƒï¼Œä»¥æ•æ‰ HTTPS å®‰è£…çš„å„ç§å±é™©ä¿¡å·ï¼ŒåŒ…æ‹¬è¯ä¹¦æ˜¯å¦è¢«åŠé”€ã€å—[èµ›é—¨é“å…‹æ··ä¹±](https://security.googleblog.com/2017/09/chromes-plan-to-distrust-symantec.html)çš„å½±å“ã€è‡ªç­¾åæˆ–è¶…è¿‡/æ¥è¿‘åˆ°æœŸæ—¥æœŸã€éªŒè¯ä¿¡ä»»é“¾ç­‰ã€‚è¿™ä¸ªè„šæœ¬æœ€ç»ˆè¢«è½¬æ¢æˆä¸€ä¸ªå«åš[ç›‘æ§è¯ä¹¦](https://monitorcertificates.com/)çš„ web åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬å›åˆ°è¿™ä¸ªè„šæœ¬ä¸Šæ¥ã€‚

## [](#getting-the-certificate)é¢†è¯

æ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»ä¸€ä¸ªåŸŸè·å–è¯ä¹¦ã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿™å¾ˆéš¾å®ç°ã€‚æˆ‘æ˜¯ç”¨ Ruby å‘å‡ºè¯·æ±‚çš„ [`HTTParty`](https://github.com/jnunemaker/httparty/) çš„å¿ å®ç²‰ä¸ï¼Œä½†ä¸å¹¸çš„æ˜¯æˆ‘æ‰¾ä¸åˆ°è®©å®ƒè¿”å›è¯ä¹¦çš„æ–¹æ³•ã€‚

æ‰€ä»¥æˆ‘å‘ä¸‹ä¸€å±‚æŠ½è±¡ï¼Œä½¿ç”¨äº†`Net::HTTP`ã€‚è¦è·å¾—è¯ä¹¦ï¼Œæ‚¨å¿…é¡»è¿è¡Œ

```
require 'net/http'
require 'openssl'

domain_name = "example.com"

uri = URI::HTTPS.build(host: domain_name)
response = Net::HTTP.start(uri.host, uri.port, :use_ssl => true)
cert = response.peer_cert 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™åœ¨`cert`å˜é‡ä¸­ç»™äº†ä½ ä¸€ä¸ªè¯ä¹¦å¯¹è±¡ã€‚è¯¥å˜é‡å±äº`OpenSSL::X509::Certificate`ç±»å‹ã€‚è¿™äº›è¢«ç§°ä¸º [X.509 è¯ä¹¦](https://en.wikipedia.org/wiki/X.509)ï¼Œå®ƒä»¬æ˜¯å…¬é’¥è¯ä¹¦çš„æ ‡å‡†ã€‚

X.509 è¯ä¹¦ä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šå…³äºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è°é¢å‘çš„ã€ä½•æ—¶é¢å‘çš„ã€ä½•æ—¶åˆ°æœŸã€å¦‚ä½•å‘ç°è¯ä¹¦æ˜¯å¦è¢«åŠé”€ï¼Œä»¥åŠå¤§é‡å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯ã€‚

## [](#finding-the-expiry-dates)æŸ¥æ‰¾æœ‰æ•ˆæœŸ

è¦æ‰¾åˆ°è¯ä¹¦å°†å¤±æ•ˆçš„æ—¥æœŸï¼Œåªéœ€è°ƒç”¨`cert.not_after`ã€‚è¿™å°†è¿”å›ä¸€ä¸ª Time å¯¹è±¡ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬è¯ä¹¦ä½•æ—¶åˆ°æœŸã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨è¯ä¹¦åˆ°æœŸå‰çš„ 2 å‘¨å†…æ¯å¤©éƒ½æ”¶åˆ°é€šçŸ¥ï¼Œæ‚¨çš„è„šæœ¬å°†ç±»ä¼¼äº-

```
require 'net/http'
require 'openssl'

domain_name = "example.com"

uri = URI::HTTPS.build(host: domain_name)
response = Net::HTTP.start(uri.host, uri.port, :use_ssl => true)
cert = response.peer_cert

two_weeks = 14 * 86400 # 14 * One Day

if Time.now + two_weeks > cert.not_after
  # send reminders
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#reminding-your-self)æé†’è‡ªå·±

ä½ å¯ä»¥ç”¨å¾ˆå¤šä¸œè¥¿æ¥å‘é€è¿™äº›æé†’ã€‚æˆ‘ç°åœ¨å·²ç»åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­å®ç°äº†çŸ­ä¿¡ã€ç”µå­é‚®ä»¶(å‘ç»™å¤šäºº)ã€Slack å’Œ Strideã€‚

æˆ‘æœ‰ä¸€äº›æœ‹å‹ç”¨è¿™ä¸ªè„šæœ¬ç»™è‡ªå·±æ¨é€æ‰‹æœºé€šçŸ¥(ä½¿ç”¨ Pusher)ï¼Œç½‘é¡µé€šçŸ¥ï¼Œgeckoboard æ›´æ–°ï¼Œæ·»åŠ åˆ°å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œæ·»åŠ åˆ° trello æ¿ï¼Œç­‰ç­‰ã€‚ä»»ä½•äº¤æµå¹³å°éƒ½æ˜¯å…¬å¹³çš„æ¸¸æˆã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ Mac ä¸Šï¼Œæœ‰ä¸€ä¸ª[ç®€æ´çš„å°å‘½ä»¤](https://apple.stackexchange.com/questions/57412/how-can-i-trigger-a-notification-center-notification-from-an-applescript-or-shel/115373#115373)å¯ä»¥ç”¨æ¥ç»™è‡ªå·±å‘é€é€šçŸ¥ã€‚

å› æ­¤ï¼Œæˆ‘å°†åœ¨è„šæœ¬ä¸­åŒ…å«è¯¥å‘½ä»¤ï¼Œä»¥ä¾¿å‘æˆ‘ä»¬å‘é€é€šçŸ¥ã€‚

```
require 'net/http'
require 'openssl'

domain_name = "example.com"

uri = URI::HTTPS.build(host: domain_name)
response = Net::HTTP.start(uri.host, uri.port, :use_ssl => true)
cert = response.peer_cert

two_weeks = 14 * 86400 # 14 * One Day

if Time.now + two_weeks > cert.not_after
  time_remaining = (cert.not_after - Time.now)
  days_remaining = time_remaining / 86400

  `osascript -e 'display notification "Certificate for #{domain_name} will expire in #{days_remaining.to_i} days. Please renew soon." with title "#{domain_name}"'`
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘åˆ é™¤äº†`if`æ¡ä»¶å¹¶è¿è¡Œè„šæœ¬ï¼Œä»Šå¤©çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º

[![dev.to certificate expiry reminder](../Images/819259c02977e3be9285a38302d43d76.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--em7Pde0M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/cu860TW.png)

ç°åœ¨ä½ éœ€è¦åšçš„å°±æ˜¯å°†å®ƒæ·»åŠ åˆ°ä½ çš„ crontab ä¸­ï¼Œå½“ä½ çš„è¯ä¹¦å³å°†æ›´æ–°æ—¶ï¼Œå®ƒä¼šä¸æ–­æé†’ä½ ã€‚

## [](#conclusion)ç»“è®º

æ˜¾ç„¶ï¼Œæˆ‘ç»™ä½ çœ‹çš„è¿™ä¸ªè„šæœ¬ä¸æ˜¯æœ€ä¼˜é›…çš„è½¯ä»¶ï¼Œä½†æ˜¯å®ƒå®Œæˆäº†ä»»åŠ¡ã€‚å¦‚æœæ‚¨æƒ³è¦ç›‘è§†å¤šä¸ªåŸŸï¼Œåªéœ€å°†è„šæœ¬è½¬æ¢æˆä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶å¯¹æ‚¨çš„æ•°ç»„`domain_names`çš„æ¯ä¸ªå…ƒç´ è¿è¡Œè¯¥æ–¹æ³•ã€‚

æˆ‘ä»¬åªæ˜¯è§¦åŠäº†è¡¨é¢ï¼Œä½†è¿™æ˜¯æ„å»ºæ‚¨çš„ç›‘æ§åŸºç¡€æ¶æ„å’Œæ›´å¤šåŠŸèƒ½çš„åšå®å¼€ç«¯ï¼Œä»¥ç¡®ä¿æ‚¨çš„è¯ä¹¦æ²¡æœ‰è¢«åŠé”€ï¼Œæˆ–è€…å¦‚æœæ˜¯ä»˜è´¹è¯ä¹¦ï¼Œè°æ˜¯å‘è¡Œè€…ã€‚

æˆ‘å·²ç»åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­æ·»åŠ äº†æ‰€æœ‰è¿™äº›å’Œæ›´å¤šå†…å®¹ï¼Œä»¥å¸®åŠ©æŒæ¡ HTTPS é—®é¢˜ã€‚

å¸Œæœ›è¿™èƒ½å¯¹åƒæˆ‘è¿™æ ·çš„äººæœ‰æ‰€å¸®åŠ©ï¼Œä»–ä»¬ä¸æ–­ç ´åä»–ä»¬çš„â€œè®©æˆ‘ä»¬åŠ å¯†â€è‡ªåŠ¨åŒ–ï¼Œæˆ–è€…å¿˜è®°äº†è¯ä¹¦éœ€è¦æ›´æ–°ï¼Œç®¡ç†äººå‘˜å¿˜è®°å‘Šè¯‰ä½ ä»–ä»¬æ­£åœ¨ä»ä¾›åº”å•†é‚£é‡Œæ”¶åˆ°é‚®ä»¶æ¥å‘å¸ƒæ–°çš„è¯ä¹¦ã€‚ğŸ˜

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä½ æƒ³è®©æˆ‘å‘ä½ å±•ç¤ºæµè§ˆå™¨å¦‚ä½•åˆ¤æ–­ä»–ä»¬æ”¶åˆ°çš„è¯ä¹¦æ˜¯å¦å·²ç»è¢«æ³„éœ²æˆ–åŠé”€å—ï¼Ÿ

ç¼–ç å¿«ä¹ï¼