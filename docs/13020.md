# Nginxï¼Œè®©æˆ‘ä»¬åŠ å¯†å¹¶å…³é—­æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ğŸ˜¢

> åŸæ–‡:[https://dev . to/ptasker/nginx-lets-encrypt-and-taking-my-own-server-down-34 a2](https://dev.to/ptasker/nginx-lets-encrypt-and-taking-my-own-server-down--34a2)

<small>*[ç…§ç‰‡ç”±è¥¿è’™Â·è²æ‰˜å°”åœ¨ Unsplash ä¸Šæ‹æ‘„](https://unsplash.com/photos/tvleqH3p1os?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)*</small>

å¦‚æœä½ å…³æ³¨[è°·æ­Œå’Œå®ƒçš„ç´¢å¼•è§„åˆ™](https://fourdots.com/blog/why-you-need-ssl-to-rank-better-in-2016-and-how-to-set-it-2169)ï¼Œä½ å¯èƒ½å¬è¯´è¿‡ä½ çš„ç½‘ç«™éœ€è¦ SSL è¯ä¹¦ã€‚æˆ‘çŸ¥é“è¿™ä¸€ç‚¹å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘åœ¨ petetasker.com çš„ä¸ªäººç½‘ç«™å¹¶ä¸æ˜¯ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„æƒ…å†µã€‚

å—¯ï¼Œæœ‰ä¸€å¤©æ™šä¸Šï¼Œæˆ‘è§‰å¾—æ— èŠï¼Œå†³å®šæ˜¯æ—¶å€™å¾—åˆ°ä¸€æ¡å…è´¹çš„èŠ±é‡Œèƒ¡å“¨çš„è£¤å­äº†[è®©æˆ‘ä»¬åŠ å¯†å®‰è£…åœ¨æˆ‘çš„æ—§ Linode æœåŠ¡å™¨ä¸Šçš„](https://letsencrypt.org/)è¯ä¹¦ã€‚

äº’è”ç½‘ä¸Šæœ‰å¤§é‡çš„èµ„æºæ¦‚è¿°äº†å¦‚ä½•åœ¨æ‚¨çš„ç«™ç‚¹ä¸Šå®‰è£… SSL è¯ä¹¦ï¼Œæ‰€ä»¥æˆ‘ä¸æ‰“ç®—è®¨è®ºè¿™ä¸€éƒ¨åˆ†ã€‚æˆ‘è¦è¯´çš„æ˜¯ç›²ç›®åœ°è·Ÿéšä»–ä»¬ä¼šå¦‚ä½•è®©ä½ çš„æœåŠ¡å™¨ç˜«ç—ªâ€¦

ä½ çœ‹ï¼Œå¤§éƒ¨åˆ†æ•™ç¨‹éƒ½å¸Œæœ›ä½ ç”¨ [Certbot](https://certbot.eff.org/) æ¥å®‰è£…ä½ çš„è¯ä¹¦ï¼Œé…ç½® Nginxã€‚

`certbot --nginx -d petetasker.com`

ä¼¼ä¹æ²¡ä»€ä¹ˆåå¤„ï¼Œä¸æ˜¯å—ï¼Ÿé‚£ä¸ªå°å°çš„`--nginx`æ ‡å¿—ï¼Œå¦‚æœä½ æ²¡æœ‰ä»”ç»†é˜…è¯»ï¼Œå°†ä¼šä¿®æ”¹ä½ çš„è™šæ‹Ÿä¸»æœºé…ç½®ã€‚æ˜¯å•Šã€‚åœ¨è®¾ç½®è¯ä¹¦æ—¶ï¼Œæœ‰ä¸€ä¸ªé€‰é¡¹å°†æ‰€æœ‰ HTTP æµé‡é‡å®šå‘åˆ° HTTPSï¼Œæ˜¾ç„¶æˆ‘è¯´äº†â€œå½“ç„¶â€ã€‚

å¹¶å°†é‡å®šå‘å¾ªç¯æ’é˜Ÿã€‚ç½‘ç«™ç›‘æ§é‚®ä»¶æ³›æ»¥ï¼Œæ¨ç‰¹â€œç½‘ç«™ç˜«ç—ªâ€DM çš„â€¦

[![](../Images/fc5e2e8e0e13171232b53e457c88abee.png)T2ã€‘](https://i1.wp.com/petetasker.com/wp-content/uploads/2018/04/Monosnap-2018-04-09-20-27-44.png?ssl=1)

ä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼

æˆ‘è®¾æ³•é€šè¿‡åˆ é™¤`/etc/nginx/sites-available/petetasker.com`è™šæ‹Ÿä¸»æœºå£°æ˜ä¸­çš„ä»¥ä¸‹ä»£ç å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜:

```
if ($host = petetasker.com) {
    return 301 https://$host$request_uri;
} # managed by Certbot 
```

Enter fullscreen mode Exit fullscreen mode

å¹¶æ·»åŠ ä¸€ä¸ªæ›´ç®€å•çš„é‡å®šå‘å—ï¼Œåªæ˜¯ä¸ºäº†*çœŸæ­£*æ¸…æ¥šï¼Œåœ¨æ–‡ä»¶çš„é¡¶éƒ¨:

```
server{
        listen 80;
        server_name petetasker.com;
        return 301 https://$server_name$request_uri;
} 
```

Enter fullscreen mode Exit fullscreen mode

å­©å­ä»¬ï¼Œè¿™é‡Œçš„æ•™è®­æ˜¯ä»€ä¹ˆï¼Ÿæ•™è®­æ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¼šâ€œè‡ªåŠ¨åœ°â€ä¸ºä½ åšä¸€äº›äº‹æƒ…ï¼Œå¹¶ä¸”å¬èµ·æ¥å¥½å¾—ä¸åƒæ˜¯çœŸçš„ï¼Œå®ƒå¾ˆå¯èƒ½æ˜¯çœŸçš„ã€‚

å¦‚æœæ‚¨æƒ³çŸ¥é“æœ€ç»ˆçš„è™šæ‹Ÿä¸»æœºå—æ˜¯ä»€ä¹ˆæ ·å­çš„:

```
server{
        listen 80;
        server_name petetasker.com;
        return 301 https://$server_name$request_uri;
}
server {

        listen 80 default_server;
        #listen [::]:80 default_server ipv6only=on;
        server_name petetasker.com www.petetasker.com;

        server_name petetasker.com www.petetasker.com;
        root /usr/share/nginx/sites/petetasker.com;
        index index.php index.html;

        location / {
                try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
                try_files $uri =404;
                fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                include fastcgi_params;
        }

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/petetasker.com-0001/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/petetasker.com-0001/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

} 
```

Enter fullscreen mode Exit fullscreen mode

Nginxï¼Œè®©æˆ‘ä»¬åŠ å¯†å¹¶å…³é—­æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ğŸ˜¢æœ€æ—©å‡ºç°åœ¨[ğŸ”¥æ•°æ®åº“å…³é”®ğŸ”¥](https://petetasker.com)ã€‚