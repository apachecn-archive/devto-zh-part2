# ç®€å•ï¼Œä½†ä¸å¤ªç®€å•:å¦‚ä½•ä½¿ç”¨ Zeit çš„â€œå¾®â€æ”¹è¿›æ‚¨çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/Hugo _ _ df/simple-ä½†ä¸å¤ªç®€å•-how-using-zeits-micro-improves-your-node-applications-1kah](https://dev.to/hugo__df/simple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications-1kah)

> ç¦»å¼€å¿«é€Ÿèˆ’é€‚åŒºï¼Œæ‰©å±•æ‚¨å¯¹èŠ‚ç‚¹åº”ç”¨ç¨‹åºæ¶æ„çš„çœ‹æ³•ã€‚

**TLï¼›åšå£«**

*   ä½¿ç”¨å‡½æ•°ç»„åˆæ¨¡å‹æ¥æ„å»º HTTP æœåŠ¡å™¨æ˜¯éå¸¸æ£’çš„
*   åŠŸèƒ½å³æœåŠ¡å¾ˆæ£’ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹
*   æœ‰ä¸€ä¸ªç±»ä¼¼äº FaaS çš„ç®€å• APIï¼Œä½†æ˜¯æ²¡æœ‰ç¼–è¯‘æ­¥éª¤

*   [ä½œä¸º JavaScript](#functions-as-a-composition-model-for-javascript) çš„ç»„åˆæ¨¡å‹

*   [èŒèƒ½ä½œä¸ºæœåŠ¡ç—›ç‚¹](#functions-as-a-service-pain-points)

*   [Beyond Express: `micro`ä½œä¸ºä¸€ä¸ªåº“æ¥ç¼–å†™ç®€å•çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åº](#beyond-express-micro-as-a-library-to-write-simple-node-applications)

*   [`micro`å¦‚ä½•å¸®åŠ©ä½ çš„æ¶æ„](#how-micro-helps-your-architecture)

*   [`micro`æ–‡æ¡£ã€ç”Ÿæ€ç³»ç»Ÿå’Œç¤ºä¾‹](#the-micro-docs-ecosystem-and-examples)

*   [æ›´å¤šä¿¡æ¯](#further-information)

æ¯”è¾ƒ`micro`å’Œ`express`çš„ä¾‹å­å¯ä»¥åœ¨ github.com/HugoDF/micro-vs-express-example çš„[æ‰¾åˆ°ã€‚](https://github.com/HugoDF/micro-vs-express-example)

## [](#functions-as-a-composition-model-for-javascript)ä½œä¸º JavaScript çš„åˆæˆæ¨¡å‹

ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸€äº›ä¸æœ¬æ–‡ç›¸å…³çš„åº”ç”¨ç¨‹åºå¼€å‘ç†å¿µ:

*   åŠŸèƒ½å¤ªæ£’äº†
*   æœ€ä½³è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œä½†ä¹Ÿä¸å¤ªç®€å•
*   JavaScript æœ€å¼ºå¤§çš„ç‰¹æ€§æ˜¯ä¸€æµçš„å‡½æ•°

ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ JavaScript ä¸­ï¼Œç»„åˆå‡½æ•°å¾€å¾€æ˜¯æ„å»ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆçš„å¥½æ–¹æ³•ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæ¨ç†èµ·æ¥å¾ˆç®€å•ï¼Œä½†å´æ˜¯ç”±æ ‡å‡†å—æ„å»ºçš„ã€‚

è¿™å°±æ˜¯â€œåŠŸèƒ½å³æœåŠ¡â€(FaaS)ï¼Œä¹Ÿç§°ä¸ºâ€œæ— æœåŠ¡å™¨â€å¹³å°å¯¹èŠ‚ç‚¹å¼€å‘è€…æœ‰å¸å¼•åŠ›çš„åŸå› ä¹‹ä¸€ã€‚ä½œä¸ºæ„å»º Post Frequenc çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åˆçš„æ–¹æ³•æ˜¯åœ¨ Netlify çš„ lambda å¹³å°ä¸Šç¼–å†™åç«¯ã€‚åœ¨åŸå‹é˜¶æ®µï¼Œå®ƒæ˜¯æœ‰æ•ˆçš„ï¼Œæœ‰ä¸¤ä¸ªäº‹åŠ¡ lambda å‡½æ•°:

*   ä¸€ä¸ªæ˜¯ä»ç«™ç‚¹ URL è·å–æè¦ URL
*   ä¸€ä¸ªç”¨äºè§£ææ¥è‡ª URL çš„ RSS/Atom æè¦ã€‚

Netlify Lambdas(å®é™…ä¸Šæœ€ç»ˆéƒ¨ç½²ä¸º AWS lambdas)æœ‰ä¸€ä¸ªç®€å•çš„ APIã€äº‹ä»¶è¾“å…¥ã€æ•°æ®è¾“å‡º(ä½¿ç”¨å›è°ƒæˆ–å¼‚æ­¥å‡½æ•°)ã€‚

æˆ‘æ„è¯†åˆ°å¤„ç†`input is a feed URL`å’Œ`input is a site URL`äºŒåˆ†æ³•çš„æœ€å¥½æ–¹æ³•æ˜¯åŒæ—¶å°è¯• fetchï¼Œçœ‹çœ‹ä»€ä¹ˆé”™è¯¯ï¼Œä»€ä¹ˆæ²¡æœ‰ã€‚å³ã€‚æˆ‘å»ºé€ äº†è¿™æ ·çš„ä¸œè¥¿:

```
const coerceErrorToObjectProperty = promise =>
  promise.catch(error => Promise.resolve({ error }));

function handler () {
  // deal with input
  const url = "some-url";
  Promise.all([
    coerceErrorToObjectProperty(parseFeed(url)),
    coerceErrorToObjectProperty(getFeedUrl(url))
  ])
    .then(([feedOutput, feedUrlOutput]) => {
      if (!feedOutput.error) {
        console.log('');
        return feedOutput;
      }
      if (!feedUrlOutput.error) {
        console.log('');
        return feedUrlOutput;
      }
      throw new Error(feedOutput.error || feedUrlOutput.error);
    })
    .then(() => {
      // deal with response
    })
    .catch(() => {
      // deal with error
    });
} 
```

## [](#functions-as-a-service-pain-points)åŠŸèƒ½ä½œä¸ºæœåŠ¡ç—›ç‚¹

æ­¤æ—¶ï¼Œæˆ‘é‡åˆ°äº†åœ¨ FaaS ä¸Šè¿è¡Œçš„ç¬¬ä¸€ä¸ªå¼€å‘äººå‘˜ä½“éªŒé—®é¢˜:

1.  æˆ‘çš„åç«¯ç°åœ¨éœ€è¦æ†ç»‘
2.  è°ƒè¯•ç¼©å°çš„ä»£ç ä»ç„¶ä¸å¤ªå¥½

è¿™è¶…å‡ºäº†é€šå¸¸ç”¨æ¥åå¯¹ FaaS è·¯çº¿çš„å†·å¯åŠ¨å’Œè¶…æ—¶é—®é¢˜ã€‚

éšç€å¯¹ Node 8+çš„å¹¿æ³›æ”¯æŒï¼Œè¶Šæ¥è¶Šæ²¡æœ‰ç†ç”±ä¼ è¾“ä½ çš„åç«¯ä»£ç (å³ä½¿ä½ æƒ³ä½¿ç”¨ es æ¨¡å—è¯­æ³•ï¼Œ[å‚è§ ES æ¨¡å—ï¼Œå‚è§åœ¨æ²¡æœ‰ Babel/Webpack çš„ Node ä¸­ä½¿ç”¨ ES æ¨¡å—](https://dev.to/hugo__df/use-es-modules-in-node-without-babelwebpack-using-esm-1obk))ã€‚

## [](#beyond-express-raw-micro-endraw-as-a-library-to-write-simple-node-applications)Beyond Express: `micro`ä½œä¸ºä¸€ä¸ªåº“ç¼–å†™ç®€å•çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åº

> å¸Œæœ›è¿™ä¸€éƒ¨åˆ†ä¸ä¼šæˆä¸ºå¤ªå¤šçš„â€œExpress vs .`micro`â€è¾©è®ºã€‚
> 
> æˆ‘å–œæ¬¢ Express çš„ç¨³å®šæ€§ã€æˆç†Ÿæ€§å’Œçµæ´»æ€§ï¼Œå®ƒè¿‡å»æ˜¯ï¼Œç°åœ¨ä»ç„¶æ˜¯ Node.js æœåŠ¡å™¨ç”Ÿæ€ç³»ç»Ÿçš„ä¸€åŒ¹çœŸæ­£çš„éªé©¬ã€‚
> 
> `micro`æ›´åŠ ä¸“æ³¨ï¼Œæ„å»ºæ—¶é™åˆ¶æ›´å°‘(ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥åˆ©ç”¨èŠ‚ç‚¹ä¸­çš„å¼‚æ­¥/ç­‰å¾…æ”¯æŒ)

å†™å®Œ lambdas ä¹‹åï¼Œæˆ‘ä¸€ç›´åœ¨å¯»æ‰¾ä¸€ä¸ªåç«¯æ¡†æ¶ï¼Œå®ƒæœ‰ä¸€ä¸ªåƒ lambda ä¸€æ ·è‡ªåŒ…å«çš„ APIã€‚é‚£ä¸ªå›¾ä¹¦é¦†æ˜¯`micro`ã€‚è¿™å¼•å‘äº†ä»¥ä¸‹æ€è€ƒ:

*   æˆ‘æœ‰ä½¿ç”¨ Express çš„ç»éªŒï¼Œä½†æˆ‘è§‰å¾—å®ƒå¯¹å°åº”ç”¨ç¨‹åºæ¥è¯´æœ‰å¤ªå¤šçš„æ‘©æ“¦ï¼Œè¿™æ˜¯åº”è¯¥çš„ã€‚æ­£å¦‚å¤§å¤šæ•°ä½¿ç”¨è¿‡ Express çš„äººæ‰€çŸ¥é“çš„ï¼Œä½ å¿…é¡»ä¸ºä¸­é—´ä»¶è¡Œä¸ºå®‰è£…é¢å¤–çš„åŒ…ï¼Œæ¯”å¦‚ä¸»ä½“è§£æï¼Œè¿™æ˜¯é€šè¿‡`micro`å®ç°çš„ã€‚
*   è¦åœ¨ Express ä¸­å‘é€å“åº”ï¼Œä»ç„¶ä½¿ç”¨å›è°ƒè¯­æ³•:`res.json(data)`æˆ–`res.send(data)`ã€‚
*   åŸºäºä¸­é—´ä»¶çš„æ‰©å±•ç³»ç»Ÿå¾ˆé…·ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ€»æ˜¯åƒä½ å¸Œæœ›çš„é‚£æ ·æ¸…æ™°ã€‚è¯·æ±‚/å“åº”å¤„ç†ç¨‹åºæœ‰æ—¶ä¾èµ–äºç”±ä¸­é—´ä»¶å †æ ˆä¸Šçš„ä»»æ„ä¸­é—´ä»¶è®¾ç½®çš„å±æ€§ã€‚

ä»¥ä¸Šå‡ ç‚¹å­—é¢ä¸Šæ˜¯`micro`çš„ä¸€äº›å–ç‚¹(è§[https://github . com/zeit/micro # features):](https://github.com/zeit/micro#features):)

*   **æ˜“**:é…åˆ`async`å’Œ`await` ( [æ›´](https://zeit.co/blog/async-and-await))ä½¿ç”¨è€Œè®¾è®¡
*   **ç®€å•**:é¢å‘å•ä¸€ç”¨é€”æ¨¡å—(åŠŸèƒ½)
*   **æ ‡å‡†**:å°± HTTPï¼
*   **æ˜¾å¼**:æ²¡æœ‰ä¸­é—´ä»¶æ¨¡å—å£°æ˜æ‰€æœ‰çš„[ä¾èµ–](https://github.com/amio/awesome-micro)

ä¸ Express ç›¸æ¯”ï¼Œå®ƒè¿˜æœ‰ä»¥ä¸‹é¢å¤–çš„ä¼˜åŠ¿(å†æ¬¡æ¥è‡ª[https://github . com/zeit/micro # features):](https://github.com/zeit/micro#features):)

*   **å¿«é€Ÿ**:è¶…é«˜æ€§èƒ½(ç”šè‡³ JSON è§£æä¹Ÿæ˜¯å¯é€‰çš„)
*   **å¾®**:æ•´ä¸ªé¡¹ç›®å¤§çº¦ 260 è¡Œä»£ç 
*   **æ•æ·**:è¶…çº§ç®€å•çš„éƒ¨ç½²å’Œå®¹å™¨åŒ–
*   è½»é‡çº§:åŒ…æ‹¬æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œè¿™ä¸ªåŒ…çš„é‡é‡ä¸åˆ° 1 å…†å­—èŠ‚

åœ¨æˆ‘çœ‹æ¥ï¼Œæœ‰ä»¥ä¸‹åå¯¹æ„è§:

*   å¿«é€’å°±æ˜¯â€œå¤Ÿå¿«â€
*   Expressâ€œè¶³å¤Ÿå°â€(å°½ç®¡æœ‰æ—¶åœ¨ Docker å†…éƒ¨çš„ Nodemon ä¸­è¿è¡Œ Express ä¼šå¯¼è‡´ 1s ä»¥ä¸Šçš„é‡æ–°åŠ è½½æ—¶é—´)
*   Expressâ€œæ˜“äºè£…ç®±/éƒ¨ç½²â€
*   Express æ˜¯â€œè¶³å¤Ÿè½»é‡çº§çš„â€(ä¸€ä¸ª Express åº”ç”¨+ä¾èµ–é¡¹å¾ˆå°‘è¶…è¿‡å‡ åå…†å­—èŠ‚ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒRails æˆ– Django åº”ç”¨å¾ˆå®¹æ˜“è¾¾åˆ° 50-100+å…†å­—èŠ‚)

å®ƒå†…ç½®äº†èº«ä½“è§£æåŠŸèƒ½ï¼Œä½†æ²¡æœ‰å…¶ä»–åŠŸèƒ½ã€‚è¿™æ˜¯ä»¶å¥½äº‹ï¼Œå®ƒåå‰¯å…¶å®ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ç­‰æ•ˆçš„åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬å¯¹å‘é€ä¸€ä¸ªæ•°å­—çš„å¸–å­åšå‡ºå“åº”ï¼Œå¹¶ä½¿å…¶å¢åŠ  1(ç®€å•ä¸”åŠæ— ç”¨ï¼Œä½†å˜¿):

*   åœ¨ä¸€ä¸ª`express-app.js`æ–‡ä»¶ä¸­è¡¨ç¤º:

```
const express = require('express');
    const bodyParser = require('body-parser');
    const app = express();
    app.use(bodyParser.json());
    app.post('/', (req, res) => {
      const { value = 0 } = req.body;
      return res.json({
        value: Number(value) + 1
      });
    });
    app.listen(process.env.PORT || 3000, () => {
      console.log('Server listening on PORT', process.env.PORT || 3000);
    }); 
```

*   `micro`åœ¨ä¸€ä¸ª`micro-app.js`æ–‡ä»¶ä¸­:

```
const { json, createError } = require('micro');
  module.exports = async (req) => {
    if (req.method !== 'POST') {
      throw createError(404, 'Not Found');
      // to have the same behaviour as the Express app
    }
    const { value = 0 } = await json(req);
    return {
      value: Number(value) + 1
    };
  }; 
```

`package.json`çœ‹èµ·æ¥å¦‚ä¸‹:

```
{  "main":  "micro-app.js",  "scripts":  {  "express":  "node express-app.js",  "micro":  "micro"  },  "dependencies":  {  "body-parser":  "^1.18.3",  "express":  "^4.16.4",  "micro":  "^9.3.3"  }  } 
```

ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°è¿™ä¸ªå·¥ä½œç¤ºä¾‹:[github.com/HugoDF/micro-vs-express-example](https://github.com/HugoDF/micro-vs-express-example)ã€‚

## `micro`å¦‚ä½•å¸®åŠ©ä½ çš„æ¶æ„

å°†æˆ‘çš„ lambdas æ˜ å°„åˆ°ä¸€ä¸ªå¾®å‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ç”¨`[fs-router](https://github.com/jesseditson/fs-router)`è®¾ç½®äº†ä¸¤æ¡è·¯çº¿ï¼Œä¸€æ¡å»`input is a site URL OR input is a feed URL`ï¼Œä¸€æ¡å»`input is a feed URL`ã€‚

æ·»åŠ `fs-router`æ—¶å‘ç”Ÿçš„äº‹æƒ…å¾ˆæœ‰æ„æ€ã€‚

åœ¨å¾®è§‚ä¸Šï¼Œä½ å¿…é¡»åŠªåŠ›å»æ‹¥æœ‰è·¯çº¿ã€‚è¿™é¡¹å·¥ä½œç±»ä¼¼äº Express ä¸­è¿›è¡Œä¸»ä½“è§£ææ‰€éœ€çš„å·¥ä½œã€‚è¿™è¯´æ˜äº†è¿™äº›å·¥å…·ä¸­çš„æ¯ä¸€ä¸ªè®¤ä¸ºå®ƒä»¬æ‰€è§£å†³çš„é—®é¢˜çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆï¼Œè€Œä¸æ˜¯å¯ä»¥å®Œæˆä½†ä¸æ˜¯æ ¸å¿ƒé—®é¢˜çš„äº‹æƒ…ã€‚

çš„é—®é¢˜æ˜¯å›´ç»•æ„å»ºç®€å•ã€æ˜ç¡®å’Œå¤§é‡çš„(å¾®)æœåŠ¡ã€‚è¿™å°±æ˜¯è·¯ç”±ä¸åœ¨æ ¸å¿ƒçš„åŸå› :æœ‰äº†å¾®æœåŠ¡ï¼Œæœ‰äº†æ­£ç¡®çš„æ¥å£ï¼Œä¸€å¤§å—æœåŠ¡å¯èƒ½ä¸éœ€è¦è·¯ç”±ã€‚

`express`æŒç›¸åçš„è§‚ç‚¹ï¼Œå®ƒè¢«è®¾è®¡æˆå¯¹ Node ä¸Šçš„ä»»ä½•æœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ½æ˜¯çµæ´»çš„ã€‚ä»æ„å»ºç®€å•çš„å•å‘åº”ç”¨ç¨‹åºåˆ° REST APIsï¼Œå†åˆ°ä½¿ç”¨æœåŠ¡å™¨å‘ˆç°çš„æ¨¡æ¿æ„å»ºåŠŸèƒ½å…¨é¢çš„å•éƒ¨ç½² web åº”ç”¨ç¨‹åºã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒç€æ‰‹è§£å†³ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜:è·¯ç”±å’Œæ ‡å‡†åŒ–æ’ä»¶ç³»ç»Ÿ(åŸºäºä¸­é—´ä»¶)ã€‚

å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œè¿™ç§æ‘©æ“¦è®©æˆ‘æ„è¯†åˆ°æ‹¥æœ‰ä¸¤ä¸ªå…·æœ‰é‡å¤åŠŸèƒ½çš„ç«¯ç‚¹æ˜¯ç–¯ç‹‚çš„:`input is a feed URL`å·²ç»è¢«`input is a site URL OR input is a feed URL`è¦†ç›–äº†ã€‚æ‰€ä»¥æˆ‘åˆ é™¤äº†ç¬¬äºŒæ¡è·¯çº¿ï¼Œå»æ‰äº†`fs-router`å¹¶è¿›è¡Œéƒ¨ç½²ğŸ‘ã€‚

æˆ‘æƒ³è¯´æ˜çš„å¦ä¸€ä¸ª micro ç‰¹æ€§æ˜¯:

```
const applyMiddlewares = handler =>
  health(
    log(
      cors(
        rateLimit(
          handler
        )
      )
    )
);
module.exports = applyMiddlewares((req, res) => 
  'Service with /health, logging, CORS and rate-limiting'
); 
```

â€œä¸­é—´ä»¶â€åªæ˜¯ä¸€ç»„åŠŸèƒ½ï¼Œå®ƒä»¬è¢«ç»„åˆå¹¶åº”ç”¨äºä¸€ä¸ªå¤„ç†ç¨‹åº(è€Œä¸æ˜¯æ›´ä¸é€æ˜çš„`app.use(() => {})`æˆ–`app.get(` `'` `/path` `'` `, middleware1, middleware2, handler)`)ã€‚å¤„ç†ç¨‹åºå®šä¹‰ä»€ä¹ˆæ˜¯æƒ³è¦/éœ€è¦çš„å¢å¼ºï¼Œè€Œä¸æ˜¯æœŸæœ›é¡¶çº§åº”ç”¨ç¨‹åºæä¾›å®ƒä»¬ã€‚

## `micro`æ–‡æ¡£ã€ç”Ÿæ€ç³»ç»Ÿå’Œå®ä¾‹

Micro çš„æ–‡æ¡£åæ˜ äº†å›¾ä¹¦é¦†çš„ç†å¿µ:å®ƒä»¬å¹²å‡€ç®€å•ï¼Œå±•ç¤ºäº†ä¸€äº›æ ¸å¿ƒç”¨ä¾‹åŠåŠ¨ä½œï¼Œä»¥ä¸‹ç±»ä¼¼äº[https://github.com/zeit/micro#usage:](https://github.com/zeit/micro#usage:)è¿™æ˜¯ hello worldï¼Œ`app.js`

```
module.exports = () => 'Hello world'; 
```

æ‚¨å¯ä»¥è®¾ç½®ä»¥ä¸‹`package.json` :

```
{  "main":  "app.js",  "scripts":  {  "start":  "micro"  },  "dependencies":  {  "micro":  "latest"  }  } 
```

ç„¶åå¯ä»¥ç”¨`npm start`è¿è¡Œã€‚

## [](#further-information)è¿›ä¸€æ­¥ä¿¡æ¯

æˆ‘å°†å†™ä¸‹ä¸€äº›æˆ‘å¦‚ä½•éƒ¨ç½²æˆ‘çš„`micro`æœåŠ¡å’Œ Express åº”ç”¨ç¨‹åºçš„ç»†èŠ‚ï¼Œå…³äºè¿™ä¸ªä¸»é¢˜å·²ç»æœ‰ä¸€ä¸ªé¢„å‘Šç‰‡:[éƒ¨ç½²é€‰é¡¹:æ•°å­—æµ·æ´‹ä¸Šçš„ Netlify+Dokku vs now . shï¼ŒGitHub Pagesï¼ŒHeroku å’Œ AWS](https://dev.to/hugo__df/deployment-options-netlify--dokku-on-digitalocean-vs-nowsh-github-pages-heroku-and-aws-4cab) ã€‚

éšæ—¶ç»™æˆ‘å‘å¾®åš [@hugo__df](https://twitter.com/@hugo__df) ã€‚

[å‡¯åˆ©èµ›å…‹](https://unsplash.com/@kellysikkema?utm_medium=referral&utm_campaign=photographer-credit&utm_content=creditBadge)