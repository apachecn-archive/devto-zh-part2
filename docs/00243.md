# React lazy å¤±è´¥æ—¶å¦‚ä½•é‡è¯•

> åŸæ–‡:[https://dev . to/goen ning/how-to-retry-when-react-lazy-fails-mb5](https://dev.to/goenning/how-to-retry-when-react-lazy-fails-mb5)

React 16.6 å·²ç»å‘å¸ƒï¼Œç°åœ¨é€šè¿‡ä½¿ç”¨ lazy å’Œæ‚¬å¿µåœ¨ React åº”ç”¨ç¨‹åºä¸­è¿›è¡Œä»£ç æ‹†åˆ†æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å®¹æ˜“ã€‚

å¦‚æœä½ ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆï¼Œä½ ç»å¯¹åº”è¯¥çœ‹çœ‹è¿™ç¯‡[https://reactjs.org/blog/2018/10/23/react-v-16-6.html](https://reactjs.org/blog/2018/10/23/react-v-16-6.html)

åœ¨å¯¹ä¸€ä¸ªä½¿ç”¨ lazy çš„ç”Ÿäº§åº”ç”¨ç¨‹åºè¿›è¡Œäº†å‡ å¤©çš„ç›‘æ§ä¹‹åï¼Œæˆ‘æ³¨æ„åˆ°äº†ä¸€äº›ç±»ä¼¼è¿™æ ·çš„å®¢æˆ·ç«¯é”™è¯¯:

```
Loading chunk 6 failed. (error: https://.../6.4e464a072cc0e5e27a07.js)
Loading CSS chunk 6 failed. (https://.../6.38a8cd5e9daba617fb66.css) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ä¸ºä»€ä¹ˆï¼Ÿï¼**

æˆ‘å…¶å®ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåªèƒ½å‡è®¾è¿™å’Œç”¨æˆ·ç½‘ç»œæœ‰å…³ã€‚ä¹Ÿè®¸ä»–ä»¬ç”¨çš„æ˜¯æ…¢é€Ÿ 3Gï¼Œç½‘ç»œå‡ºç°äº†æ•…éšœï¼Ÿè¿™å¹¶ä¸ç½•è§ï¼Œå¯¹å§ï¼Ÿ

å¥½å§ï¼Œå¦‚æœè¿™æ˜¯çœŸçš„ï¼Œæˆ‘ä»¬æ€ä¹ˆè§£å†³ï¼Ÿ

å½“ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšæ¯ä¸ªäººéƒ½ä¼šåšçš„äº‹æƒ…:é‡è¯•ï¼ğŸ˜„

**å¦‚ä½•ï¼Ÿ**

ä½ çŸ¥é“è¿›å£å—...)æˆ‘ä»¬åœ¨æ‡’äººä¸Šç”¨çš„å‡½æ•°åªæ˜¯ä¸€ä¸ªè¿”å›æ‰¿è¯ºçš„å‡½æ•°ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥åƒå¯¹å¾…å…¶ä»–æ‰¿è¯ºä¸€æ ·æŠŠå®ƒé”èµ·æ¥ã€‚

ä¸‹é¢ä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªé‡è¯•åŠŸèƒ½çš„åŸºæœ¬å®ç°ã€‚

```
function retry(fn, retriesLeft = 5, interval = 1000) {
  return new Promise((resolve, reject) => {
    fn()
      .then(resolve)
      .catch((error) => {
        setTimeout(() => {
          if (retriesLeft === 1) {
            // reject('maximum retries exceeded');
            reject(error);
            return;
          }

          // Passing on "reject" is the important part
          retry(fn, retriesLeft - 1, interval).then(resolve, reject);
        }, interval);
      });
  });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ¥æº:https://gist.github.com/briancavalier/842626

ç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†å®ƒåº”ç”¨åˆ°æˆ‘ä»¬çš„æƒ°æ€§å¯¼å…¥ä¸­ã€‚

```
// Code split without retry login
const ProductList = lazy(() => import("./path/to/productlist"));

// Code split with retry login
const ProductList = lazy(() => retry(() => import("./path/to/productlist"))); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæµè§ˆå™¨æ— æ³•ä¸‹è½½è¯¥æ¨¡å—ï¼Œå®ƒå°†é‡è¯• 5 æ¬¡ï¼Œæ¯æ¬¡å°è¯•ä¹‹é—´æœ‰ 1 ç§’é’Ÿçš„å»¶è¿Ÿã€‚å¦‚æœåœ¨ 5 æ¬¡å°è¯•ä¹‹åä»å¯¼å…¥å®ƒï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

ä»…æ­¤è€Œå·²ï¼ğŸ‰

è°¢è°¢ï¼