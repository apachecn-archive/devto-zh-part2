# dotenv-vault:æ— ä¾èµ–æ€§ã€‚ç¯å¢ƒåŠ å¯†å·¥å…·

> åŸæ–‡:[https://dev . to/acro 5 piano/dotenv-vault-no-dependency-env-encrypt-tool-3h5g](https://dev.to/acro5piano/dotenv-vault-no-dependency-env-encrypt-tool-3h5g)

# TLï¼›åšå£«ï¼›åŒ»ç”Ÿ

dotenv-vault æ˜¯ä¸€ä¸ªç®€å•çš„ dotenv ç®¡ç†å·¥å…·ï¼Œä¿æŒä»¤ç‰Œçš„ç§˜å¯†ã€‚

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png)/[è·³é©¬](https://github.com/acro5piano/dotenv-vault)

### å— yaml_vault å¯å‘çš„ç®€å• dotenv åŠ å¯†å’Œè§£å¯†å·¥å…·

<article class="markdown-body entry-content container-lg" itemprop="text">

# ä½¿ç”¨ git-crypt[https://github.com/AGWA/git-crypt](https://github.com/AGWA/git-crypt)

ä¸å†ç»´æŠ¤ã€‚ä½¿ç”¨å…¶ä»–å·¥å…·ã€‚

[![CircleCI](../Images/7289d37bf0f7a3b95981b914b72cdcdd.png)T2ã€‘](https://circleci.com/gh/acro5piano/dotenv-vault)

# dotenv-é‡‘åº“

[![](../Images/eaa14e9d32c78cd2c3f6f2ef09d2a064.png)T2ã€‘](https://github.com/acro5piano/dotenv-vault/blob/master/demo.gif)

å— yaml_vault å¯å‘çš„ç®€å• dotenv åŠ å¯†å·¥å…·

é»˜è®¤å¯†ç æ˜¯ aes-256-cbcã€‚é»˜è®¤çš„ç­¾åæ‘˜è¦æ˜¯ SHA256ã€‚

# å®‰è£…

å¯¹äº MacOS:

```
git clone https://github.com/acro5piano/dotenv-vault ~/.dotenv-vault
ln -sfnv ~/.dotenv-vault/bin/dotenv-vault /usr/local/bin/dotenv-vault 
```

å¯¹äº Linux:

```
git clone https://github.com/acro5piano/dotenv-vault ~/.dotenv-vault
sudo ln -sfnv ~/.dotenv-vault/bin/dotenv-vault /usr/bin/dotenv-vault 
```

## è¦æ±‚

dotenv-vault éœ€è¦ä»¥ä¸‹å†…å®¹:

*   Bash >= 2
*   Openssl >= 2
*   Perl >= 5

å‡ ä¹æ‰€æœ‰çš„æœºå™¨éƒ½ä¸éœ€è¦ä»»ä½•é¢å¤–çš„å®‰è£…è¿‡ç¨‹ã€‚

# ä½¿ç”¨

## åŠ å¯†

è¾“å…¥æ–‡ä»¶(ã€‚ç¯å¢ƒ):

```
NODE_ENV=development
API_KEY=123456789 
```

å‘½ä»¤:

```
$ dotenv-vault -e API_KEY -k foobarbaz encrypt .env 
```

å…¶ä¸­`-e`æŒ‡å®šæ‚¨åŠ å¯†çš„å¯†é’¥ã€‚

è¾“å‡º:

```
NODE_ENV=development
API_KEY=U2FsdGVkX186T6zdupR27pXHO0Hdnz9rqZfVdgqBEqk= 
```

## è§£é‡Š

è¾“å…¥æ–‡ä»¶(. env.encrypted):

```
NODE_ENV=development
API_KEY=U2FsdGVkX186T6zdupR27pXHO0Hdnz9rqZfVdgqBEqk= 
```

å‘½ä»¤:

```
$ dotenv-vault -e API_KEY -k foobarbaz decrypt .env 
```

è¾“å‡º:

```
NODE_ENV=development
API_KEY=123456789 
```

## åˆ›å»ºåŠ å¯†ç¯å¢ƒ

`dotenv-vault create`å‘½ä»¤æ–¹ä¾¿åˆ›å»ºæ–°æ¡ç›®:

```
$ bin/dotenv-vault -k foobarbaz create 'SOME_KEY=123456'
# => SOME_KEY=U2FsdGVkX18tEclKImEV30HSG0b7IOu3dyO3MpceCd4= 
```

æ‚¨å¯ä»¥ç²˜è´´æˆ–é‡å®šå‘ä»¥æ³¨å†Œæ–°æ¡ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
$ bin/dotenv-vault
```

â€¦</article>

[View on GitHub](https://github.com/acro5piano/dotenv-vault)

# ä¸ºä»€ä¹ˆ

æ‚¨å¦‚ä½•ç®¡ç†å­˜å‚¨åº“ä¸­çš„`.env`æ–‡ä»¶ï¼Ÿ

è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«ä¸€äº›ç§˜å¯†ä»¤ç‰Œã€‚åœ¨å¼€æ”¾æºç è½¯ä»¶ä¸­ï¼Œè¿™äº›ä¿¡æ¯ä¸å¾—å…¬å¼€ã€‚å³ä½¿åœ¨ç§æœ‰å­˜å‚¨åº“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸åº”è¯¥åœ¨ Git å­˜å‚¨åº“ä¸­åŒ…å«ç§˜å¯†ä¿¡æ¯ï¼Œå› ä¸ºå¾ˆå¤šåˆ©ç›Šç›¸å…³è€…ï¼ŒåŒ…æ‹¬å¤–åŒ…å¼€å‘è€…éƒ½ä¼šæäº¤ä»£ç ã€‚

ç„¶è€Œï¼Œåº”ç”¨ç¨‹åºä¸­éœ€è¦ç§˜å¯†ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†å®ƒä»¬åŒ…å«åˆ°å­˜å‚¨åº“ä¸­ã€‚

æ ¹æ®è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦é€‰æ‹©æ˜¯ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ KMSã€‚ä¸»è¦çš„äº‘æœåŠ¡å¦‚ AWS å’Œ GCP æä¾›è¯¥æœåŠ¡ã€‚

[https://www . Reddit . com/r/devo PS/comments/52pl5c/how _ do _ you _ manage _ env _ dotenv _ files/](https://www.reddit.com/r/devops/comments/52pl5c/how_do_you_manage_env_dotenv_files/)

ç„¶è€Œï¼Œæˆ‘æƒ³ç®¡ç†ä»–ä»¬æ›´ç®€å•çš„æ–¹å¼æ²¡æœ‰ä»»ä½•æ’ä»¶å’Œä¾èµ–ã€‚

# é€‰é¡¹

yaml_vault æ˜¯ä¸€ä¸ªè®© yaml æ–‡ä»¶ä¿å¯†çš„å¥½å·¥å…·ã€‚

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png)[joker 1007](https://github.com/joker1007)/[YAML _ vault](https://github.com/joker1007/yaml_vault)

### Yaml æ–‡ä»¶åŠ å¯†/è§£å¯†åŠ©æ‰‹ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

# YamlVault

[![Gem Version](../Images/8c7f1278e70de5da65d9bd0b57f7d515.png) ](https://badge.fury.io/rb/yaml_vault) [ ![Build Status](../Images/1558425fdfe2b4fba97f2da38e757be2.png)](https://travis-ci.org/joker1007/yaml_vault)

Yaml æ–‡ä»¶åŠ å¯†/è§£å¯†åŠ©æ‰‹ã€‚

## ä» 0.x åˆ° 1.0 çš„çªç ´æ€§å˜åŒ–

*   è¾“å‡º YAML æ–‡ä»¶ä¿æŒåˆ«å&é”šè¯­æ³•&æ ‡ç­¾ä¿¡æ¯ã€‚(ä½†ç©ºè¡Œè¢«ä¿®å‰ª)
*   `--key`æ ¼å¼æ”¹å˜ã€‚(é¦–å…ˆéœ€è¦`<article class="markdown-body entry-content container-lg" itemprop="text"ä½œä¸ºæ ¹æ–‡æ¡£)
*   `--key`æ”¯æŒæ–°æ ¼å¼ã€‚(æ ¹æ–‡æ¡£ã€é€šé…ç¬¦ã€æ­£åˆ™è¡¨è¾¾å¼ã€å¼•å·)

## ç¼–ç ç®—æ³•

yaml_vault ä½¿ç”¨ active support::message encryptorã€‚

é»˜è®¤å¯†ç æ˜¯`aes-256-cbc`é»˜è®¤ç­¾åæ‘˜è¦æ˜¯`SHA256`ã€‚

## è£…ç½®

å°†è¿™ä¸€è¡Œæ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ Gemfile ä¸­:

```
gem 'yaml_vault'
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åæ‰§è¡Œ:

```
$ bundle 
```

æˆ–è€…è‡ªå·±å®‰è£…ä¸º:

```
$ gem install yaml_vault 
```

## ä½¿ç”¨

### åŠ å¯†

```
# secrets.yml
default: &default
  hoge: fuga
  aaa: true
  bbb: 2
foo: bar
complicated:
  - 1
  - ["hoge", "fuga"]
  - [{key1: val1, key2: val2}, {key3: val3}]
  - a:
      b:
        c: d
        e: !ruby/range 1..10

test:
  <<: *default
  hoge:
    - 1
    - 2
    - 3

vault:
  secret_data: 
```

â€¦Enter fullscreen mode Exit fullscreen mode</article>

[View on GitHub](https://github.com/joker1007/yaml_vault)

å®ƒæ˜¯ç”¨çº¢å®çŸ³å†™çš„ã€‚Ruby on Rails ä½¿ç”¨ YAML æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚å› æ­¤è¯¥å·¥å…·åœ¨ Ruby on Rails åº”ç”¨ç¨‹åºä¸­å¾ˆå—æ¬¢è¿ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRails 5.2 å…·æœ‰ç±»ä¼¼çš„åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ–‡ä»¶å°†è¢«è§£å¯†ï¼Œæˆ‘ä»¬çš„ç¼–è¾‘å™¨å°†è¿è¡Œã€‚ç¼–è¾‘æ–‡ä»¶åï¼Œæ–‡ä»¶å†æ¬¡åŠ å¯†ã€‚

```
bin/rails credentials:edit 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶è€Œï¼Œæˆ‘çš„é¡¹ç›®æ—¢ä¸ä½¿ç”¨ Ruby on Rails ä¹Ÿä¸ä½¿ç”¨ YAMLã€‚åªæ˜¯`.env`å’Œ`.env.local`ï¼Œ`.env.production`æ–‡ä»¶å­˜åœ¨ã€‚

äºæ˜¯æˆ‘åˆ›é€ äº† [dotenv-vault](https://github.com/acro5piano/dotenv-vault) (æ˜¾ç„¶æ˜¯å—åˆ° yaml_vault çš„å¯å‘)ã€‚

# å“²å­¦

*   è¾ƒå°‘ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬åœ¨ CI ä¸­è¿è¡Œï¼Œè¿™å¾ˆæ–¹ä¾¿ã€‚
*   ç®€å•ã€‚è®¾ç½®ç®€å•ï¼Œæ²¡æœ‰ DSLï¼Œé›¶å­¦ä¹ æˆæœ¬ã€‚
*   å¯Œæœ‰æˆæ•ˆã€‚å°½å¯èƒ½è‡ªåŠ¨åŒ–ã€‚

æ›´å°‘çš„ä¾èµ–æ€§çœŸçš„å¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒã€ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œè€Œä¸”æˆæœ¬ä¸ºé›¶ã€‚ç›®å‰ï¼Œdotenv-vault ä¾èµ–äºä»¥ä¸‹ä¸‰é¡¹:

*   å°è¯•
*   Openssl
*   Perl è¯­è¨€

æˆ‘é€‰æ‹© Perl æ¥è§£æ dotenv æ–‡ä»¶ï¼Œå› ä¸º Perl ä¸æ”¹å˜æ“ä½œç³»ç»Ÿä¹‹é—´çš„å‘½ä»¤è¯­æ³•ã€‚`sed`BSD å’Œ GNU ä¸åŒã€‚
å„å¤§ OSï¼Œå¦‚ macOSã€Ubuntuï¼Œé»˜è®¤éƒ½æœ‰ Perlã€‚

# å¦‚ä½•ä½¿ç”¨

## æ‰‹åŠ¨

å®‰è£…å(æ£€æŸ¥å›è´­)ï¼Œåœ¨è¦åŠ å¯†çš„è¡Œçš„æœ«å°¾æ·»åŠ `# encrypt-me`æ³¨é‡Š:

```
# .env

APP_ENV=production
APP_KEY=super_secret_value # encrypt-me 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
$ dotenv-vault encrypt .env 
```

Enter fullscreen mode Exit fullscreen mode

æ‚¨å¯èƒ½ä¼šè¢«è¦æ±‚è¾“å…¥åŠ å¯†å¯†ç ï¼Œç„¶åæŒ‰å›è½¦é”®:

```
Please input password and press Return: 
```

Enter fullscreen mode Exit fullscreen mode

å®ƒä¼šå°†åŠ å¯†æ–‡ä»¶è¾“å‡ºä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
APP_ENV=production
APP_KEY=U2FsdGVkX19VF+rLm7ypGQFl76Sq7QUEaU5uM+AlQmRxcKMTTj63R81K4U0WYZzy # decrypt-me 
```

Enter fullscreen mode Exit fullscreen mode

å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶:

```
$ dotenv-vault encrypt .env > .env.production 
```

Enter fullscreen mode Exit fullscreen mode

è¦è§£å¯†æ–‡ä»¶ï¼Œè¯·è¿è¡Œ:

```
$ dotenv-vault decrypt .env.production 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åè¾“å…¥å¯†ç ï¼Œè§£å¯†åçš„è¾“å‡ºå°†ä¼šæ˜¾ç¤ºã€‚

## [è¯ä¸­çš„](#in-ci)

åœ¨ CI ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼Œæ‰€ä»¥åœ¨æ‚¨çš„ CI æœåŠ¡ä¸­è®¾ç½®`DOTENV_PASSWORD`ç¯å¢ƒå˜é‡ã€‚

```
$ env DOTENV_PASSWORD=foo dotenv-vault decrypt .env.production > .env 
```

Enter fullscreen mode Exit fullscreen mode

(å®é™…ä¸Šä¸éœ€è¦`env DOTENV_PASSWORD=foo`

## æ·»åŠ ä»¤ç‰Œ

å¦‚æœæˆ‘ä»¬æ¯æ¬¡æ·»åŠ æ–°ä»¤ç‰Œæ—¶éƒ½è¦è§£å¯†å’ŒåŠ å¯†ï¼Œè¿™æ˜¯ä¸æ–¹ä¾¿çš„ã€‚

`dotenv-vault generate`ç®€å•ç”ŸæˆåŠ å¯†ä»¤ç‰Œã€‚

```
$ dotenv-vault generate 'FIREBASE_TOKEN=new_secret_token' 
```

Enter fullscreen mode Exit fullscreen mode

å‘½ä»¤è¾“å‡ºå°†æ˜¯è¿™æ ·çš„:

```
FIREBASE_TOKEN=U2FsdGVkX19NWIIPCamKJOFdJktBSETdFNV6BIwBlkjBNhCRQ18z2zDtVRu3fO79 # decrypt-me 
```

Enter fullscreen mode Exit fullscreen mode

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡å®šå‘è¾“å‡ºæ¥æ·»åŠ æ–°çš„ä»¤ç‰Œã€‚

```
$ dotenv-vault generate 'FIREBASE_TOKEN=new_secret_token' >> .env.production 
```

Enter fullscreen mode Exit fullscreen mode

# æ„Ÿè°¢

æˆ‘ä½¿ç”¨ Bashtub æ¥è¿è¡Œ bash è„šæœ¬çš„å•å…ƒæµ‹è¯•ã€‚Bashtub ç¡®å®æ˜¯ä¸€ä¸ªç®€å•çš„å¥½å·¥å…·ã€‚

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png)[ã€ueokondeã€‘](https://github.com/ueokande)/[ã€Bashi tubã€‘](https://github.com/ueokande/bashtub)

### Bash çš„å¾®å‹å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

# Bashtub <g-emoji class="g-emoji" alias="bathtub" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f6c1.png">ğŸ›</g-emoji>-Bash çš„å•å…ƒæµ‹è¯•æ¡†æ¶

[![Build Status](../Images/7cc0c874601b84ab171bebf1f5f8bf77.png)T2ã€‘](https://travis-ci.org/ueokande/bashtub)

Bashtub æ˜¯ä¸€ä¸ªç”¨äº Bash çš„å°å‹å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œä½ å¯ä»¥æŒ‡å®šæµ‹è¯•ç”¨ä¾‹ï¼Œå› ä¸ºåŸºäºæ–­è¨€çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚ xUnit Bashtubï¼Œåœ¨æµ‹è¯•é€šè¿‡æ—¶ä¼šå½©è‰²è¾“å‡ºæµ‹è¯•ç»“æœ

[![success](../Images/e37110aa80023d3a813f9831e442a804.png)T2ã€‘](https://raw.githubusercontent.com/ueokande/bashtub/master/success.png)

å½“æµ‹è¯•å¤±è´¥æ—¶ï¼Œå®ƒè¾“å‡ºå¤±è´¥ä¿¡æ¯ï¼Œ

[![failure](../Images/9fa13a8f64b16b9474dfe890f14a0ffb.png)T2ã€‘](https://raw.githubusercontent.com/ueokande/bashtub/master/failure.png)

## è¦æ±‚

*   Bash 3.2+ç‰ˆ

## è£…ç½®

```
curl -o ~/bin/bashtub https://raw.githubusercontent.com/ueokande/bashtub/v0.2/bin/bashtub
chmod +x ~/bin/bashtub
```

Enter fullscreen mode Exit fullscreen mode

å…¶ä¸­è·¯å¾„`~/bin`å¿…é¡»åŒ…å«åœ¨`$PATH`ä¸­ã€‚ç„¶åæµ‹è¯•è¿è¡Œ bashtubã€‚

```
bashtub   # output 0 examples
```

Enter fullscreen mode Exit fullscreen mode

## å†™ä½œæµ‹è¯•

æµ‹è¯•ç”¨ä¾‹åœ¨ä»¥`testcase_`å¼€å§‹çš„å‡½æ•°ä¸­å£°æ˜ã€‚Bashtub è‡ªåŠ¨åœ¨åŠ è½½çš„æ–‡ä»¶ä¸­æ‰¾åˆ°æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•è¢«å†™æˆåŸºäºæ–­è¨€çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯”å¦‚ xUnitã€‚

### æœ€å°æµ‹è¯•

ç¬¬ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹:

```
# examples/first_test_case.sh
lorem_ipsum='lorem ipsum dolor sit amet'
testcase_first_word() {
  first_word=$(echo $lorem_ipsum | cut -f1
```

â€¦Enter fullscreen mode Exit fullscreen mode</article>

[View on GitHub](https://github.com/ueokande/bashtub)

# ç»“è®º

åœ¨æˆ‘çš„ç”¨ä¾‹ä¸­ï¼Œdotenv-vault æä¾›äº†æœ‰ç”¨çš„ç‰¹æ€§ã€‚å¦‚æœæœ‰ä»€ä¹ˆæ„è§ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼

è°¢äº†ã€‚