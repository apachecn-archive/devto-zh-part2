# æˆ‘çš„ååº”è·¯ç”±ç»“æ„

> åŸæ–‡:[https://dev.to/legobox/my-react-routing-structure-d8i](https://dev.to/legobox/my-react-routing-structure-d8i)

> è¿™ä»¶ä½œå“æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„åšå®¢ä¸Šï¼Œåœ°å€æ˜¯ [legobox](https://medium.com/legobox/my-react-routing-structure-20772c685810)

# [](#background)èƒŒæ™¯

æˆ‘ç»å¸¸æ„å»ºå‰ç«¯åº”ç”¨ç¨‹åºå’Œ APIï¼Œé€šå¸¸æˆ‘ä½¿ç”¨å„ç§å·¥å…·ï¼Œä½† react æ˜¯æˆ‘è§‰å¾—æœ‰è¶£çš„ä¸œè¥¿ï¼Œä½¿æˆ‘èƒ½å¤Ÿå¿«é€Ÿåœ°æ„å»ºï¼Œè™½ç„¶æˆ‘å¯ä»¥è¯´ vue é€å­—é€å¥åœ°åŒ¹é…å®ƒï¼Œä½†è¿™ä¸æ˜¯ä»Šå¤©çš„äº‰è®ºï¼Œreact ä¸ Vue çš„åºŸè¯å¤Ÿå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä¸¤è€…éƒ½åšã€‚å®ƒä»¬éƒ½å¾ˆæ£’ï¼Œæˆ‘å¾ˆé«˜å…´æœ‰å¯ä¾›é€‰æ‹©çš„æ¡†æ¶ã€‚åœ¨ä½¿ç”¨ react å¼€å‘å’Œåˆ›å»ºåº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸ºæˆ‘çš„åº”ç”¨ç¨‹åºæå‡ºäº†ä¸€ä¸ªé€šç”¨çš„ç»“æ„å’Œè·¯ç”±æ¨¡å¼ã€‚

æˆ‘è®¤ä¸ºè¿™æ˜¯æˆ‘æƒ³åˆ†äº«çš„ä¸œè¥¿ï¼Œå¹¶å¸Œæœ›é€šè¿‡ç¤¾åŒºçš„æŒ‡å¯¼æ¥æ”¹è¿›ã€‚

# [](#prerequisites)å…ˆå†³æ¡ä»¶

å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œåªæœ‰ä¸¤ä¸ªå…ˆå†³æ¡ä»¶ï¼Œ(ä¸Šæ¬¡æˆ‘å†™äº†ä¸€ä¸ªå…ˆå†³æ¡ä»¶ï¼Œå®ƒåƒé‡ç«ä¸€æ ·è”“å»¶ï¼Œå¸Œæœ›å®ƒä¸ä¼šè¦æ±‚å¤ªå¤šï¼Œè®©å®ƒå†æ¬¡å‘ç”ŸğŸ™ƒ)

*   ä½ çŸ¥é“ reactï¼Œæœ‰ä½¿ç”¨å®ƒçš„ç»éªŒã€‚
*   ä½ å¬è¯´è¿‡ redux å—
*   æ‚¨ç†Ÿæ‚‰ react è·¯ç”±å™¨ã€‚

å¦‚æœä½ è®°ä¸‹æ¥äº†ï¼Ÿï¼Œé‚£ä½ å°±ä¹–ä¹–åœ°æ»šå§ã€‚

# [](#the-problem)é—®é¢˜

è¿™ä¸ªé—®é¢˜éœ€è¦ä½¿ç”¨ react-router åº“åœ¨é¡µé¢ä¹‹é—´å¯¼èˆªï¼ŒåŒæ—¶è¿˜è¦è·Ÿè¸ªèº«ä»½éªŒè¯çŠ¶æ€ï¼Œå…³äºèº«ä»½éªŒè¯å’Œå¯¼èˆªï¼Œå¯¹è¿™ä¸ªé—®é¢˜å·²ç»æœ‰äº†ä¸€ä¸ªå…±åŒçš„ç†è§£ï¼Œé€šå¸¸å¤§å®¶éƒ½çŸ¥é“å¯ä»¥é€šè¿‡ react router å’Œ redux çš„ç®€å•è®¾ç½®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªè®¾ç½®æœ‰è®¸å¤šæ¨¡å¼ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šæˆ‘çš„æ¨¡å¼ã€‚

# [](#the-solution)è§£

ä¸ºäº†åœ¨åº”ç”¨ç¨‹åºä¸­æ­£ç¡®å¯¼èˆªï¼Œæˆ‘è®¾ç½®äº† react-router å¹¶å®ç°äº†ä¸€ä¸ª 3 ç»„ä»¶èº«ä»½éªŒè¯æ£€æŸ¥æµç¨‹ï¼Œä¸€ä¸ªç»„ä»¶æ£€æŸ¥ä»…è®¿é—®è€…é¡µé¢ï¼Œå¦ä¸€ä¸ªç»„ä»¶æ£€æŸ¥å—ä¿æŠ¤çš„è·¯çº¿ï¼Œç¬¬ä¸‰ä¸ªç»„ä»¶åŒ…å«æ‰€æœ‰å†…å®¹å¹¶å¯¹åº”ç”¨ç¨‹åºçš„èº«ä»½éªŒè¯çŠ¶æ€è¿›è¡Œä¸€èˆ¬æ£€æŸ¥ï¼Œæˆ‘çŸ¥é“ç°åœ¨å¬èµ·æ¥ä¸æ˜ç¡®ï¼Œä½†æˆ‘ä»¬å°†æŸ¥çœ‹ä»£ç ç»“æ„å¹¶äº†è§£äº‹æƒ…çš„æœ¬è´¨ã€‚

```
 // import scenes here and make routes of them
    import React from 'react';
    import {Route} from 'react-router-dom';
    // import scenes here
    import {Dashboard, Settings, Login} from './Scenes'

    // auth checkers for checking if the routes are authorized
    import AppCheck from './Modules/AppCheck.jsx';
    import EnsureLoggedInContainer from './Modules/EnsureLoggedInContainer.jsx';
    import EnsureVisitorOnlyContainer from './Modules/EnsureVisitorOnlyContainer.jsx';

    const routes = (
      <React.Fragment>
            <AppCheck>
                    <EnsureVisitorOnlyContainer>
                            <Route path="/login" component={Login} />
                    </EnsureVisitorOnlyContainer>
                    <EnsureLoggedInContainer>
                            <Route exact path="/home" component={Dashboard} />
                            <Route path="/settings" component={Settings} />
                    </EnsureLoggedInContainer>
            </AppCheck>
      </React.Fragment>
    );

    export default routes; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ç›´æ¥ä»ä»£ç åº“ä¸­æå–çš„ï¼Œæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªæƒ³æ³•è¢«æ¸…æ™°åœ°å‘ˆç°å‡ºæ¥ã€‚

è¿™ç§æƒ…å†µä¸‹çš„ä¸‰ä¸ªç»„ä»¶æ˜¯`AppCheck`ã€`EnsureVisitorOnlyContainer`ã€`EnsureLoggedInContainer`ã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ç»„ä»¶çš„å†…éƒ¨ç»“æ„ã€‚

**AppCheck ç»„ä»¶ã€‚**

```
 import React from "react";
    import { connect } from "react-redux";
    import { withRouter } from "react-router";

    class AppCheck extends React.Component {

      componentDidUpdate(prevProps) {

        const { dispatch, redirectUrl } = this.props;
        const isLoggingOut = prevProps.isLoggedIn && !this.props.isLoggedIn;
        const isLoggingIn = !prevProps.isLoggedIn && this.props.isLoggedIn;

        if (isLoggingIn) {
            // dispatch(navigateTo(redirectUrl))
        } else if (isLoggingOut) {
          // do any kind of cleanup or post-logout redirection here
        }
      }

      render() {
        return this.props.children;
      }

    }

    const mapStateToProps = state => {
      console.log(state);
      return {
        isLoggedIn: state.isAuthenticated,
        redirectUrl: state.redirectUrl
      };
    };
    export default withRouter(connect(mapStateToProps)(AppCheck)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªç»„ä»¶åœ¨æ›´æ–°æ—¶æ£€æŸ¥ prop å¹¶ç¡®è®¤ä»¥å‰çš„`isLoggedIn`çŠ¶æ€ï¼Œæ³¨æ„ç”¨æˆ·æ˜¯å¦ç™»å½•æˆ–æ³¨é”€ï¼Œæ ¹æ®è¿™ä¸€ç‚¹ï¼Œå®ƒé‡å®šå‘åˆ° redux è®¾ç½®ä¸­æŒ‡å®šçš„å¦ä¸€ä¸ª urlï¼Œæˆ–è€…å¦‚æœå®ƒè¯•å›¾æ³¨é”€ï¼Œå®ƒç»§ç»­æ³¨é”€ï¼Œå¦åˆ™å®ƒç»§ç»­å‘ˆç° props å­å¯¹è±¡ã€‚

**EnsureVisitorsOnlyContainer**

```
 import React from "react";
    import { connect } from "react-redux";
    import { withRouter } from "react-router";
    // import actions from "../Store/Actions";

    class EnsureVisitorOnlyContainer extends React.Component {

      componentDidMount() {

        const { currentURL } = this.props;
        var visitorRoutes = ["/", "", "terms", "conditions"];
        var check = visitorRoutes.indexOf(currentURL) > -1;

        if (this.props.isLoggedIn) {

          // set the current url/path for future redirection (we use a Redux action)
          // then redirect (we use a React Router method)
          //   dispatch(actions.setRedirectUrl(currentURL))
          if (check) {
            this.props.history.replace("/home");
          }
        }
      }

      render() {
        if (!this.props.isLoggedIn) {
          return this.props.children;
        } else {
          return null;
        }
      }
    }
    // Grab a reference to the current URL. If this is a web app and you are
    // using React Router, you can use `ownProps` to find the URL. Other
    // platforms (Native) or routing libraries have similar ways to find
    // the current position in the app.

    function mapStateToProps(state, ownProps) {
      console.log(ownProps);
      return {
        isLoggedIn: state.isAuthenticated,
        currentURL: ownProps.location.pathname
      };
    }
    export default withRouter(connect(mapStateToProps)(EnsureVisitorOnlyContainer)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥ç»„ä»¶é›†ç®€å•åœ°æ£€æŸ¥å½“å‰è·¯çº¿æ˜¯å¦åœ¨è®¿é—®è€…è·¯çº¿ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå®ƒæ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœåº”ç”¨ç¨‹åºç™»å½•ï¼Œå®ƒå°†ç”¨æˆ·é‡å®šå‘åˆ°`/home`è·¯çº¿ã€‚

å¦‚æœåœ¨è®¿é—®è€…åˆ—è¡¨ä¸­æ‰¾åˆ°äº†è·¯å¾„ï¼Œåˆ™æ­¤ç»„ä»¶é›†ä¸­åˆ—å‡ºçš„ä»»ä½•è·¯ç”±éƒ½å°†è¢«é‡å®šå‘åˆ°æœ¬åœ°è·¯ç”±ã€‚

**EnsureLoggedInContainer**

```
 import React from 'react'
    import {connect} from 'react-redux'
    import { withRouter } from 'react-router'
    import actions from '../Store/Actions'

    class EnsureLoggedInContainer extends React.Component {

      componentDidMount() {
        const { dispatch, currentURL } = this.props
        if (!this.props.isLoggedIn) {
          // set the current url/path for future redirection (we use a Redux action)
          // then redirect (we use a React Router method)
          dispatch(actions.setRedirectUrl(currentURL))
          this.props.history.replace("/")
        }
      }

      render() {
        if (this.props.isLoggedIn) {
          return this.props.children
        } else {
          return null
        }
      }
    }
    // Grab a reference to the current URL. If this is a web app and you are
    // using React Router, you can use `ownProps` to find the URL. Other
    // platforms (Native) or routing libraries have similar ways to find
    // the current position in the app.

    function mapStateToProps(state, ownProps) {
      console.log(ownProps)
      return {
        isLoggedIn: state.isAuthenticated,
        currentURL: ownProps.location.pathname
      }
    }

    export default withRouter(connect(mapStateToProps)(EnsureLoggedInContainer)) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªå®¹å™¨æ£€æŸ¥åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€æ˜¯å¦æ˜¯æœªç™»å½•ï¼Œå®ƒé‡å®šå‘åˆ°`/`è·¯å¾„ï¼Œå› æ­¤æ‰€æœ‰é¡µé¢éƒ½é€šè¿‡è¿™ä¸ªç»“æ„è¿›è¡Œç®¡ç†ã€‚

å½“ prevProp æ”¹å˜å…¶çŠ¶æ€æ—¶ï¼Œ **AppCheck** å¤„ç†æ³¨é”€è¿‡ç¨‹ï¼Œè€Œ**EnsureVisitorsOnlyContainer**å’Œ **EnsureLoggedInContainer** æ ¹æ®è·¯çº¿å’Œå®ƒåœ¨å“ªä¸ªå®¹å™¨ä¸­åˆ—å‡ºæ¥å¤„ç†ä¸åŒå®ä¾‹ä¸Šçš„é‡å®šå‘ã€‚

# [](#conclusion)ç»“è®º

æˆ‘ä¹äºæ¥å—å¦‚ä½•æ”¹è¿›çš„å»ºè®®ï¼Œå¹¶å¬å–æ‚¨å¦‚ä½•å®ç°æ‚¨çš„å»ºè®®ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘å¸Œæœ›åˆ†äº«æˆ‘åœ¨ react å’Œ vue å¼€å‘ä¸­ä½¿ç”¨çš„å…¶ä»–æŠ€å·§å’ŒæŠ€æœ¯ï¼Œå¹¶å¸®åŠ©å…¶ä»–äººäº†è§£å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›æ¡†æ¶æ¥æ›´å¿«åœ°æ„å»ºã€‚