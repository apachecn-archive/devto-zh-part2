# ä½¿ç”¨ AWS Lambda å’Œ AWS SES æ„å»ºæ— æœåŠ¡å™¨è”ç³»äººè¡¨å•

> åŸæ–‡:[https://dev . to/adnanrahic/building-a-server less-contact-form-with-AWS-lambda-and-AWS-ses-4jm 0](https://dev.to/adnanrahic/building-a-serverless-contact-form-with-aws-lambda-and-aws-ses-4jm0)

å¦‚æœæˆ‘å‘Šè¯‰ä½ å®ƒå¯ä»¥é›¶ä¾èµ–åœ°å®Œæˆå‘¢ï¼Ÿå¸Œæœ›ä½ èƒ½æ¥å—æŒ‘æˆ˜ï¼Œå› ä¸ºè¿™æ­£æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚

æœ¬æ•™ç¨‹å°†æ¶µç›–ä½¿ç”¨æ™®é€š JavaScript çš„å‰ç«¯è”ç³»è¡¨å•å’Œæ‰˜ç®¡åœ¨ [AWS Lambda](https://aws.amazon.com/lambda/) ä¸Šçš„æ— æœåŠ¡å™¨åç«¯çš„åŸºç¡€çŸ¥è¯†ã€‚ [AWS SES](https://aws.amazon.com/ses/) æ˜¯ä½ ç”¨æ¥å‘é€å®é™…ç”µå­é‚®ä»¶çš„æœåŠ¡ï¼Œç›¸ä¿¡æˆ‘ï¼Œå®ƒéå¸¸ç®€å•ï¼Œé…ç½®åªéœ€ 13 ç§’ã€‚æ˜¯çš„ï¼Œæˆ‘ç»™è‡ªå·±è®¡æ—¶ã€‚ğŸ˜

é‚£å¥½å§ã€‚è®©æˆ‘ä»¬è·³è¿›æ¥å§ï¼

### TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

ä¸ºäº†ç¡®ä¿ä½ å¯¹æˆ‘ä»¬ä»Šå¤©æ‰€åšçš„æœ‰ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„ TLï¼›åšå£«ä½ å¯ä»¥è·³åˆ°ä½ æ„Ÿå…´è¶£çš„éƒ¨åˆ†ï¼Œä¸¥é‡ä¼¤å®³æˆ‘çš„æ„Ÿæƒ…ï¼Œæˆ–è€…å°±ä»è¿™é‡Œç»§ç»­è¯»ä¸‹å»ã€‚ä½ æŒ‘å§...æˆ‘ä¸ä¼šé»˜é»˜çš„è¯„åˆ¤ä½ ã€‚ğŸ˜

*   æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼Ÿ
*   é…ç½® [AWS SES](https://aws.amazon.com/ses/)
*   ç”¨[æ— æœåŠ¡å™¨æ¡†æ¶](https://serverless.com/)æ„å»º API
*   å°† API éƒ¨ç½²åˆ° [AWS Lambda](https://aws.amazon.com/lambda/)
*   ç”¨ [Dashbird](https://dashbird.io/) æµ‹è¯• API
*   æ„å»ºè¡¨å•

***æ³¨**:æˆ‘æŠŠè¿™ä¸ª[ä»£ç ](https://github.com/adnanrahic/lambda-mailer)å˜æˆäº†ä¸€ä¸ª [npm æ¨¡å—](https://www.npmjs.com/package/lambda-mailer)ä»¥ä¾¿äºé‡ç”¨ï¼Œæ‰€ä»¥å½“ä½ éœ€è¦ä¸€ä¸ªå¿«é€Ÿè”ç³»è¡¨å•æ—¶ï¼Œä½ ä¸éœ€è¦è‡ªå·±å†™æ‰€æœ‰çš„ä»£ç ã€‚*

## [](#what-are-we-building)æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼Ÿ

æ€»ä½“æ€è·¯æ˜¯å»ºç«‹ä¸€ä¸ªå¯ä»¥æ·»åŠ åˆ°é™æ€ç½‘ç«™çš„è”ç³»è¡¨å•ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸ç®¡ç†ä»»ä½•æœåŠ¡å™¨çš„æƒ…å†µä¸‹æ·»åŠ å®ƒï¼Œå¹¶ä¸”æœ€å¥½ä¸è¦ä¸ºå®ƒçš„è¿è¡Œæ”¯ä»˜ä»»ä½•è´¹ç”¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª AWS Lambda çš„æƒŠäººç”¨ä¾‹ã€‚

æˆ‘ä»¬æƒ³è¦æ„å»ºçš„ç»“æ„éå¸¸ç®€å•ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è¡¨å•ï¼Œç”¨ä¸€å°æ®µ JavaScript æ¥è§£æ JSON çš„å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬å‘é€ç»™ API ç«¯ç‚¹ã€‚

ç«¯ç‚¹æ˜¯ä¸€ä¸ª [AWS API Gateway](https://aws.amazon.com/api-gateway/) äº‹ä»¶ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ª AWS Lambda å‡½æ•°ã€‚è¯¥åŠŸèƒ½å°†å‘Šè¯‰ AWS SES å‘æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€å‘é€ä¸€å°åŒ…å«ç›¸å…³å†…å®¹çš„ç”µå­é‚®ä»¶ã€‚ä»é‚£é‡Œï¼Œä½ å¯ä»¥ç»§ç»­ä¸å¡«å†™è¡¨æ ¼çš„äººäº¤æ¢ç”µå­é‚®ä»¶ã€‚ç®€å•å§ï¼Ÿ

[![overview](../Images/ee9c0443812358667a24d86c29f12f2f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--gKuuon3W--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/adnanrahic/cdn/master/lambda-mailer/lambda-mailer.png)

å¼€å§‹é»‘å§ï¼

## [](#configure-aws-ses)é…ç½® AWS SES

ä¸ºäº†ä½¿ç”¨ AWS æä¾›çš„ç®€å•ç”µå­é‚®ä»¶æœåŠ¡å‘é€ç”µå­é‚®ä»¶ï¼Œæ‚¨éœ€è¦éªŒè¯å°†ç”¨äºå‘é€ç”µå­é‚®ä»¶çš„ç”µå­é‚®ä»¶åœ°å€ã€‚å°±åƒå¯¼èˆªåˆ° AWS æ§åˆ¶å°å¹¶æœç´¢**ç®€å•ç”µå­é‚®ä»¶æœåŠ¡**ä¸€æ ·ç®€å•ã€‚

[![ses-1](../Images/3b3305c4f5ebcc6602c6b113685df8a1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zohP5aXm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/adnanrahic/cdn/master/building-a-serverless-contact-form/ses-2.png)

ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸Šçš„**ç”µå­é‚®ä»¶åœ°å€**é“¾æ¥ã€‚ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º**çš„è“è‰²å¤§æŒ‰é’®ï¼Œç”¨äºéªŒè¯æ–°çš„ç”µå­é‚®ä»¶åœ°å€**ã€‚æŒ‰ä¸‹å®ƒå¹¶æ·»åŠ æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€ã€‚

[![ses-2](../Images/08cb089d026f72720f78ddb9b596498f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--bnKRIC3q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/adnanrahic/cdn/master/building-a-serverless-contact-form/ses-1.png)

AWS ç°åœ¨å°†å‘æ‚¨å‘é€ä¸€å°éªŒè¯ç”µå­é‚®ä»¶åˆ°è¯¥åœ°å€ã€‚å»éªŒè¯ä¸€ä¸‹å§ã€‚å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚å‡†å¤‡å¥½å†™ä¸€äº›ä»£ç äº†å—ï¼Ÿ

## [](#build-the-api-with-the-serverless-framework)ç”¨æ— æœåŠ¡å™¨æ¡†æ¶æ„å»º API

æ„å»ºå®é™…çš„ API æœ‰å‡ ä¸ªä¸»è¦æ­¥éª¤ã€‚ç¬¬ä¸€ä»¶äº‹ï¼Œä¸€å¦‚æ—¢å¾€ï¼Œæ˜¯é…ç½®ã€‚

#### [](#1-install-the-serverless-framework)1ã€‚å®‰è£…æ— æœåŠ¡å™¨æ¡†æ¶

ä¸ºäº†è®©æ— æœåŠ¡å™¨å¼€å‘**ä¸**æˆä¸ºç»å¯¹çš„æŠ˜ç£¨ï¼Œç»§ç»­å®‰è£…[æ— æœåŠ¡å™¨æ¡†æ¶](https://serverless.com/)ã€‚

```
$ npm i -g serverless 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

***æ³¨æ„:**å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Linuxï¼Œä½ å¯èƒ½éœ€è¦ä»¥ sudo çš„èº«ä»½è¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚*

ä¸€æ—¦å…¨å±€å®‰è£…åˆ°æ‚¨çš„æœºå™¨ä¸Šï¼Œæ‚¨å°±å¯ä»¥åœ¨ç»ˆç«¯çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›å‘½ä»¤ã€‚ä½†æ˜¯ä¸ºäº†è®©å®ƒä¸æ‚¨çš„ AWS å¸æˆ·é€šä¿¡ï¼Œæ‚¨éœ€è¦é…ç½®ä¸€ä¸ª IAM ç”¨æˆ·ã€‚è·³è¿‡[è¿™é‡Œçš„è§£é‡Š](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html)ï¼Œç„¶åè¿”å›ï¼Œç”¨æä¾›çš„é”®è¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚

```
$ serverless config credentials \
    --provider aws \
    --key xxxxxxxxxxxxxx \
    --secret xxxxxxxxxxxxxx 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œä»»ä½•ç»ˆç«¯å‘½ä»¤æ—¶ï¼Œæ‚¨çš„æ— æœåŠ¡å™¨å®‰è£…çŸ¥é“è¦è¿æ¥åˆ°å“ªä¸ªå¸æˆ·ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

#### [](#2-create-a-service)2ã€‚åˆ›å»ºæœåŠ¡

åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•æ¥å­˜æ”¾æ‚¨çš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºæœåŠ¡ã€‚åœ¨é‚£é‡Œå¯åŠ¨ä¸€ä¸ªç»ˆç«¯ã€‚ç°åœ¨æ‚¨å·²ç»å‡†å¤‡å¥½åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡äº†ã€‚

ä½ é—®çš„æœåŠ¡æ˜¯ä»€ä¹ˆï¼ŸæŠŠå®ƒå½“æˆä¸€ä¸ªé¡¹ç›®ã€‚ä½†ä¹Ÿä¸å°½ç„¶ã€‚åœ¨è¿™é‡Œå®šä¹‰ AWS Lambda å‡½æ•°ã€è§¦å‘å®ƒä»¬çš„äº‹ä»¶ä»¥åŠå®ƒä»¬éœ€è¦çš„ä»»ä½• AWS åŸºç¡€è®¾æ–½èµ„æºï¼Œæ‰€æœ‰è¿™äº›éƒ½åœ¨ä¸€ä¸ªåä¸º **serverless.yml** çš„æ–‡ä»¶ä¸­ã€‚

å›åˆ°ä½ çš„ç»ˆç«¯ç±»å‹:

```
$ serverless create --template aws-nodejs --path contact-form-api 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

create å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªæ–°çš„**æœåŠ¡**ã€‚ä¿®å¡ï¼ä½†æœ‰è¶£çš„éƒ¨åˆ†æ¥äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸ºå‡½æ•°é€‰æ‹©ä¸€ä¸ªè¿è¡Œæ—¶ã€‚è¿™è¢«ç§°ä¸º**æ¨¡æ¿**ã€‚ä¼ å…¥`aws-nodejs`ä¼šå°†è¿è¡Œæ—¶è®¾ç½®ä¸º Node.js .è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è·¯å¾„å°†ä¸ºæœåŠ¡åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚

#### [](#3-explore-the-service-directory-with-a-code-editor)3ã€‚ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨æµè§ˆæœåŠ¡ç›®å½•

ç”¨ä½ æœ€å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨æ‰“å¼€ **contact-form-api** æ–‡ä»¶å¤¹ã€‚è¿™é‡Œåº”è¯¥æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬åªå…³æ³¨**çš„ serverless.yml** ã€‚å®ƒåŒ…å«æ­¤æœåŠ¡çš„æ‰€æœ‰é…ç½®è®¾ç½®ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®šå¸¸è§„é…ç½®è®¾ç½®å’Œæ¯ä¸ªåŠŸèƒ½çš„è®¾ç½®ã€‚ä½ çš„ **serverless.yml** å°†å……æ»¡æ ·æ¿ä»£ç å’Œæ³¨é‡Šã€‚è¯·éšæ„åˆ é™¤å®ƒï¼Œå¹¶ç²˜è´´è¿™ä¸ªã€‚

```
# serverless.yml

service: contact-form-api

custom:
  secrets: ${file(secrets.json)}

provider:
  name: aws
  runtime: nodejs8.10
  stage: ${self:custom.secrets.NODE_ENV}
  region: us-east-1
  environment: 
    NODE_ENV: ${self:custom.secrets.NODE_ENV}
    EMAIL: ${self:custom.secrets.EMAIL}
    DOMAIN: ${self:custom.secrets.DOMAIN}
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "ses:SendEmail"
      Resource: "*"

functions:
  send:
    handler: handler.send
    events:
      - http:
          path: email/send
          method: post
          cors: true 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å±æ€§åˆ—å‡ºäº†æœåŠ¡ä¸­çš„æ‰€æœ‰å‡½æ•°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªåŠŸèƒ½æ¥å¤„ç†ç”µå­é‚®ä»¶çš„å‘é€ã€‚**å¤„ç†ç¨‹åº**å¼•ç”¨å®ƒæ˜¯å“ªä¸ªå‡½æ•°ã€‚

çœ‹ä¸€çœ‹`iamRoleStatements`ï¼Œä»–ä»¬æŒ‡å®š Lambda æœ‰æƒé™è§¦å‘**ç®€å•é‚®ä»¶æœåŠ¡**ã€‚

æˆ‘ä»¬åœ¨é¡¶éƒ¨è¿˜æœ‰ä¸€ä¸ª`custom`éƒ¨åˆ†ã€‚è¿™æ˜¯ä¸€ç§å°†ç¯å¢ƒå˜é‡å®‰å…¨åŠ è½½åˆ°æœåŠ¡ä¸­çš„æ–¹æ³•ã€‚ç¨åé€šè¿‡ä½¿ç”¨`${self:custom.secrets.<environment_var>}`æ¥å¼•ç”¨å®ƒä»¬ï¼Œå®é™…å€¼ä¿å­˜åœ¨ä¸€ä¸ªåä¸º`secrets.json`çš„ç®€å•æ–‡ä»¶ä¸­ã€‚

å‰å®³ï¼

#### [](#4-add-the-secrets-file)4ã€‚æ·»åŠ æœºå¯†æ–‡ä»¶

æˆ‘ä»¬éƒ½çŸ¥é“æŠŠç§é’¥æ¨ç»™ GitHub ä¼šå®³æ­»å°ç‹—ã€‚è¯·ä¸è¦è¿™æ ·åšã€‚ç”¨æ— æœåŠ¡å™¨æ¡†æ¶å¤„ç†è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ã€‚æ·»åŠ ä¸€ä¸ª`secrets.json`æ–‡ä»¶å¹¶å°†è¿™äº›å€¼ç²˜è´´åˆ°ã€‚

```
{  "NODE_ENV":"dev",  "EMAIL":"john.doe@mail.com",  "DOMAIN":"*"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æµ‹è¯•æ—¶ï¼Œæ‚¨å¯ä»¥å°†åŸŸä¿æŒä¸º`'*'`ï¼Œä½†æ˜¯ï¼Œè¯·ç¡®ä¿åœ¨ç”Ÿäº§ä¸­å°†å…¶æ›´æ”¹ä¸ºæ‚¨çš„å®é™…åŸŸã€‚`EMAIL`å­—æ®µåº”è¯¥åŒ…å«æ‚¨é€šè¿‡ AWS SES éªŒè¯çš„ç”µå­é‚®ä»¶ã€‚

#### [](#5-write-business-logic)5ã€‚ç¼–å†™ä¸šåŠ¡é€»è¾‘

è‡³æ­¤ï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™å®é™…çš„ä»£ç ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä»£ç æœ¬èº«ç›¸å½“ç®€å•ã€‚æˆ‘ä»¬éœ€è¦ [SES](https://aws.amazon.com/ses/) æ¨¡å—ï¼Œåˆ›å»ºç”µå­é‚®ä»¶å‚æ•°å¹¶ç”¨`.sendMail()`æ–¹æ³•å‘é€å®ƒä»¬ã€‚åœ¨åº•éƒ¨ï¼Œæˆ‘ä»¬å¯¼å‡ºå‡½æ•°ï¼Œç¡®ä¿å®ƒåœ¨`serverless.yml`ä¸­å¯ç”¨ã€‚

```
// handler.js

const aws = require('aws-sdk')
const ses = new aws.SES()
const myEmail = process.env.EMAIL
const myDomain = process.env.DOMAIN

function generateResponse (code, payload) {
  return {
    statusCode: code,
    headers: {
      'Access-Control-Allow-Origin': myDomain,
      'Access-Control-Allow-Headers': 'x-requested-with',
      'Access-Control-Allow-Credentials': true
    },
    body: JSON.stringify(payload)
  }
}

function generateError (code, err) {
  console.log(err)
  return {
    statusCode: code,
    headers: {
      'Access-Control-Allow-Origin': myDomain,
      'Access-Control-Allow-Headers': 'x-requested-with',
      'Access-Control-Allow-Credentials': true
    },
    body: JSON.stringify(err.message)
  }
}

function generateEmailParams (body) {
  const { email, name, content } = JSON.parse(body)
  console.log(email, name, content)
  if (!(email && name && content)) {
    throw new Error('Missing parameters! Make sure to add parameters \'email\', \'name\', \'content\'.')
  }

  return {
    Source: myEmail,
    Destination: { ToAddresses: [myEmail] },
    ReplyToAddresses: [email],
    Message: {
      Body: {
        Text: {
          Charset: 'UTF-8',
          Data: `Message sent from email ${email} by ${name} \nContent: ${content}`
        }
      },
      Subject: {
        Charset: 'UTF-8',
        Data: `You received a message from ${myDomain}!`
      }
    }
  }
}

module.exports.send = async (event) => {
  try {
    const emailParams = generateEmailParams(event.body)
    const data = await ses.sendEmail(emailParams).promise()
    return generateResponse(200, data)
  } catch (err) {
    return generateError(500, err)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼Œå…¨éƒ¨ 60 è¡Œå·¦å³çš„ä»£ç ï¼Œç»å¯¹æ²¡æœ‰ä¾èµ–ã€‚å¤ªæ£’äº†ã€‚

## [](#deploy-the-api-to-aws-lambda)å°† API éƒ¨ç½²åˆ° AWS Lambda

ç®€å•çš„éƒ¨åˆ†æ¥äº†ã€‚éƒ¨ç½² API å°±åƒè¿è¡Œä¸€ä¸ªå‘½ä»¤ä¸€æ ·ç®€å•ã€‚

```
$ serverless deploy 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![deploy](../Images/79071764555a5fa81510903521642b5e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ApCvDzmq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/adnanrahic/cdn/master/building-a-serverless-contact-form/deploy.png)

æ‚¨å¯ä»¥çœ‹åˆ°ç«¯ç‚¹è¢«è®°å½•åˆ°æ§åˆ¶å°ã€‚è¿™æ˜¯æ‚¨å‘é€è¯·æ±‚çš„åœ°æ–¹ã€‚

## [](#test-the-api-with-dashbird)ç”¨ Dashbird æµ‹è¯• API

æµ‹è¯• API æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ CURLã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ CURL å‘½ä»¤ï¼Œå¹¶å‘ç«¯ç‚¹å‘é€ä¸€ä¸ª JSON æœ‰æ•ˆè´Ÿè½½ã€‚

```
$ curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"email":"john.doe@email.com","name":"John Doe","content":"Hey!"}' \
  https://{id}.execute-api.{region}.amazonaws.com/{stage}/email/send 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šå¾ˆå¿«æ”¶åˆ°ä¸€å°ç”µå­é‚®ä»¶ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆä½ å°±ä¸èµ°è¿äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘é»˜è®¤ä½¿ç”¨ [Dashbird](https://dashbird.io/register/) æ¥è°ƒè¯•æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚

[![dashbird-lambda-mailer-2](../Images/67a13a1188639abd66b5bb7bbcd1128c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--218ktGCL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://raw.githubusercontent.com/adnanrahic/cdn/master/building-a-serverless-contact-form/dashbird.lambda-mailer-2.gif)

æˆ‘è¿™è¾¹çš„æ—¥å¿—æ˜¾ç¤ºéƒ½æ˜¯ç»¿è‰²çš„ï¼Œæ‰€ä»¥å®ƒå·¥ä½œå¾—å¾ˆå¥½ï¼è¿™å°±æ˜¯å®Œæˆçš„ API éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬ç»§ç»­è”ç³»è¡¨å•æœ¬èº«ã€‚

## [](#build-the-contact-form)æ„å»ºè”ç³»äººè¡¨å•

å› ä¸ºæˆ‘ä¸æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„ CSS ä¸“å®¶ï¼Œæˆ‘å°†å®Œå…¨è·³è¿‡è¿™ä¸€éƒ¨åˆ†ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•è®©å®ƒå·¥ä½œã€‚ğŸ˜

è®©æˆ‘ä»¬ä» HTML æ ‡è®°å¼€å§‹ã€‚

```
<form id="contactForm">
  <label>Name</label>
  <input type="text" placeholder="Name" name="name" required>
  <label>Email Address</label>
  <input type="email" placeholder="Email Address" name="email" required>
  <label>Message</label>
  <textarea rows="5" placeholder="Message" name="content" required></textarea>
  <div id="toast"></div>
  <button type="submit" id="submit">Send</button>
</form> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è¡¨å•ï¼Œæœ‰ä¸‰ä¸ªå­—æ®µå’Œä¸€ä¸ªæŒ‰é’®ã€‚è®©æˆ‘ä»¬ç»§ç»­çœ‹ JavaScriptã€‚

```
const form = document.getElementById('contactForm')
const url = 'https://{id}.execute-api.{region}.amazonaws.com/{stage}/email/send'
const toast = document.getElementById('toast')
const submit = document.getElementById('submit')

function post(url, body, callback) {
  var req = new XMLHttpRequest();
  req.open("POST", url, true);
  req.setRequestHeader("Content-Type", "application/json");
  req.addEventListener("load", function () {
    if (req.status < 400) {
      callback(null, JSON.parse(req.responseText));
    } else {
      callback(new Error("Request failed: " + req.statusText));
    }
  });
  req.send(JSON.stringify(body));
}
function success () {
  toast.innerHTML = 'Thanks for sending me a message! I\'ll get in touch with you ASAP. :)'
  submit.disabled = false
  submit.blur()
  form.name.focus()
  form.name.value = ''
  form.email.value = ''
  form.content.value = ''
}
function error (err) {
  toast.innerHTML = 'There was an error with sending your message, hold up until I fix it. Thanks for waiting.'
  submit.disabled = false
  console.log(err)
}

form.addEventListener('submit', function (e) {
  e.preventDefault()
  toast.innerHTML = 'Sending'
  submit.disabled = true

  const payload = {
    name: form.name.value,
    email: form.email.value,
    content: form.content.value
  }
  post(url, payload, function (err, res) {
    if (err) { return error(err) }
    success()
  })
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†è¿‡ 50 è¡Œï¼Œå®¢æˆ·ç«¯é€»è¾‘å°±å®Œæˆäº†ã€‚è¯·éšæ„å°†å®ƒæ”¾åˆ°æ‚¨çš„ç½‘ç«™ä¸­ï¼Œå°†`url`å¸¸é‡æ›´æ”¹ä¸ºæ‚¨åœ¨ä¸Šé¢éƒ¨ç½²çš„ API ç«¯ç‚¹ã€‚å˜¿ï¼Œå¾ˆå¿«ï¼Œä½ çš„æ— æœåŠ¡å™¨è”ç³»è¡¨å•å°±å®Œæˆäº†ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§äº†ï¼

## [](#wrapping-up)åŒ…è£…å®Œæ¯•

ç°åœ¨ä½ æœ‰äº†ï¼Œä¸€ä¸ªå¿«é€Ÿç®€å•çš„æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªæ— æœåŠ¡å™¨çš„è”ç³»è¡¨å•åˆ°ä¸€ä¸ªç½‘ç«™ã€‚åƒè¿™æ ·å¯¹å¥‡æ€ªçš„ã€å­¤ç«‹çš„ç«¯ç‚¹ä½¿ç”¨æ— æœåŠ¡å™¨æ˜¯å¾ˆæ£’çš„ã€‚ç»å¯¹æ²¡æœ‰ä½ éœ€è¦æ‹…å¿ƒçš„æœåŠ¡å™¨ã€‚åªéœ€éƒ¨ç½²ä»£ç ï¼Œå¹¶ä¿è¯å®ƒä¼šå·¥ä½œã€‚å¦‚æœæœ‰ä»€ä¹ˆä¸œè¥¿åäº†ï¼Œä½ ä¼šæœ‰ä»ªè¡¨æ¿é¸Ÿåœ¨èƒŒåçœ‹ç€ä½ ï¼Œå¦‚æœæœ‰ä»€ä¹ˆä¸å¯¹åŠ²ï¼Œå®ƒä¼šæé†’ä½ ã€‚è¯¥æ­»ï¼Œæˆ‘å–œæ¬¢æ¾æ•£çš„é›†æˆã€‚

æ€»ä¹‹ï¼Œæˆ‘èŠ±äº†æ—¶é—´ä»ä¸Šé¢çš„ä»£ç ä¸­åˆ›å»ºäº†ä¸€ä¸ª [npm æ¨¡å—](https://www.npmjs.com/package/lambda-mailer)ï¼Œæ‰€ä»¥åœ¨æœªæ¥ï¼Œæ²¡æœ‰äººéœ€è¦å†™ä¸¤æ¬¡ã€‚åªéœ€å®‰è£…è½¯ä»¶åŒ…ï¼Œä¸åˆ°ä¸€åˆ†é’Ÿï¼Œæ‚¨çš„ contact form endpoint å°±ä¼šå¯åŠ¨å¹¶è¿è¡Œã€‚å¦‚æœä½ æƒ³çœ‹çš„è¯ï¼Œå¯ä»¥åœ¨ [GitHub repo](https://github.com/adnanrahic/lambda-mailer) ä¸­æ‰¾åˆ°è¯´æ˜ã€‚å¦‚æœä½ æƒ³è®©æ›´å¤šçš„äººåœ¨ GitHub ä¸Šçœ‹åˆ°å®ƒï¼Œç»™å®ƒä¸€é¢—æ˜Ÿå§ã€‚

## ![GitHub logo](../Images/75095a8afc1e0f207cda715962e75c8d.png) [é˜¿å¾·çº³å°¼å¥‡](https://github.com/adnanrahic) / [æ‹‰å§†è¾¾-æ¢…å‹’](https://github.com/adnanrahic/lambda-mailer)

### ä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œç”¨äºä»æ‚¨ç½‘ç«™ä¸Šçš„è”ç³»äººè¡¨å•æ¥æ”¶ç”µå­é‚®ä»¶ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

[![dependencies](../Images/b7c022726835b739c01c3896b4e6bfdf.png)](https://camo.githubusercontent.com/617833e613d2a20bec6f337f4a56041850d81547161c74d7e8d1f0f08b4cf045/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646570656e64656e636965732d302d627269676874677265656e2e737667)[![contributors](../Images/a325f8e3f1e4abad52683d0aaf0ac1fc.png)](https://camo.githubusercontent.com/a5bcf36669e36d98e99fbe2188c2969664b0c05443dc5aa94b2c4893b9fdf242/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f6e7472696275746f72732d312d626c75652e737667)[![License: MIT](../Images/1ebeb1b87ced0f5afda04a6122ee23ad.png)](https://opensource.org/licenses/MIT)[![license](../Images/955f3528819eda8770cca65909bdd341.png)T11ã€‘](https://camo.githubusercontent.com/d156644f8995e4482e77bef1d9461f742fbe53edbcd49f2b7cea3492db5ed771/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f65736c696e742d7374616e646172642d79656c6c6f77677265656e2e737667)

[![cover](../Images/ee9c0443812358667a24d86c29f12f2f.png)T2ã€‘](https://raw.githubusercontent.com/adnanrahic/cdn/master/lambda-mailer/lambda-mailer.png)

# æ‹‰å§†è¾¾Â·æ¢…å‹’

ä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œç”¨äºä»æ‚¨ç½‘ç«™ä¸Šçš„è”ç³»äººè¡¨å•æ¥æ”¶ç”µå­é‚®ä»¶ã€‚

# æ³¨æ„ï¼

**æ¨¡å—éœ€è¦ Node.js ç‰ˆæœ¬ 8 æˆ–ä»¥ä¸Šã€‚**

## ä½¿ç”¨

é…ç½®ç›¸å½“ç®€å•ã€‚

#### 1.åœ¨ AWS æ§åˆ¶å°->ç®€å•ç”µå­é‚®ä»¶æœåŠ¡ä¸­å¯ç”¨æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€

#### 2.å®‰è£…æ¨¡å—

```
$ npm i lambda-mailer
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### 3.`require()`å®ƒåœ¨ä½ çš„`handler.js`

```
// define the options for your email and domain
const options = {
  myEmail: process.env.EMAIL, // myEmail is the email address you enabled in AWS SES in the AWS Console
  myDomain: process.env.DOMAIN // add the domain of your website or '*' if you want to accept requests from any domain
}
// initialize the function
const { sendJSON, sendFormEncoded } = require('lambda-mailer')(options)

// Content-Type: application/json
// The event.body needs to be a JSON object with 3 properties
```

â€¦<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg></article>

[View on GitHub](https://github.com/adnanrahic/lambda-mailer)

å¦‚æœä½ æƒ³é˜…è¯»æˆ‘ä»¥å‰çš„ä¸€äº›æ— æœåŠ¡å™¨æ€è€ƒï¼Œè¯·å‰å¾€[æˆ‘çš„ç®€ä»‹](https://dev.to/adnanrahic)æˆ–[åŠ å…¥æˆ‘çš„æ—¶äº‹é€šè®¯ï¼](https://upscri.be/b6f3d5/)

æˆ–è€…ï¼Œé©¬ä¸Šçœ‹çœ‹æˆ‘çš„å‡ ç¯‡æ–‡ç« :

*   ã€Express å’Œ MongoDB çš„æ— æœåŠ¡å™¨ API é€Ÿæˆç­
*   [ä½¿ç”¨æ— æœåŠ¡å™¨å’Œ MongoDB è§£å†³ä¸å¯è§çš„æ‰©å±•é—®é¢˜](https://dev.to/adnanrahic/solving-invisible-scaling-issues-with-serverless-and-mongodb-4m55)
*   [å¦‚ä½•ä½¿ç”¨æ— æœåŠ¡å™¨å°† Node.js åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° AWS Lambda](https://dev.to/adnanrahic/how-to-deploy-a-nodejs-application-to-aws-lambda-using-serverless-2nc7)
*   [AWS Lambda å’Œ Node.js å…¥é—¨](https://dev.to/adnanrahic/getting-started-with-aws-lambda-and-nodejs-1kcf)
*   [ç”¨ JSON web ä»¤ç‰Œä¿æŠ¤æ— æœåŠ¡å™¨ API çš„é€Ÿæˆç­](https://dev.to/adnanrahic/a-crash-course-on-securing-serverless-apis-with-json-web-tokens-22fa)
*   [å°† Node.js REST API è¿ç§»åˆ°æ— æœåŠ¡å™¨](https://dev.to/adnanrahic/migrating-your-nodejs-rest-api-to-serverless-3gej)
*   [ç”¨ Node.js å’Œ MongoDB æ„å»ºæ— æœåŠ¡å™¨ REST API](https://dev.to/adnanrahic/building-a-serverless-rest-api-with-nodejs-and-mongodb-43db)
*   [node . js æ— æœåŠ¡å™¨é€Ÿæˆç­](https://dev.to/adnanrahic/a-crash-course-on-serverless-with-nodejs-5jp)

å¸Œæœ›ä½ ä»¬å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« ï¼Œå°±åƒæˆ‘å–œæ¬¢å†™è¿™ç¯‡æ–‡ç« ä¸€æ ·ã€‚å¦‚æœä½ å–œæ¬¢ï¼Œæ‹ä¸€ä¸‹é‚£ä¸ªå°å¿ƒè„ï¼Œè¿™æ · dev.to ä¸Šçš„æ›´å¤šäººä¼šçœ‹åˆ°è¿™ä¸ªæ•™ç¨‹ã€‚ä¸‹æ¬¡è§ï¼Œä¿æŒå¥½å¥‡ï¼Œç©å¾—å¼€å¿ƒã€‚

* * *

[![This months sponsor is Zeet.](../Images/a4da9440f5519d3156594813d3a02017.png)T2ã€‘](https://bit.ly/adnan-zeet)

å…è´£å£°æ˜: [Zeet](https://bit.ly/adnan-zeet) å°†åœ¨ä¸‹ä¸ªæœˆèµåŠ©è¿™ç¯‡åšå®¢ã€‚å‰å‡ å¤©æˆ‘è¯•è¿‡äº†ã€‚è¿™å°±åƒæ— æœåŠ¡å™¨ï¼Œä½†è¿è¡Œæ•´ä¸ªåç«¯ã€‚ä½ å¯ä»¥è‡ªåŠ¨æ‰˜ç®¡å’Œæ‰©å±•åº”ç”¨ã€‚ç›¸å½“æ•´æ´ã€‚

* * *