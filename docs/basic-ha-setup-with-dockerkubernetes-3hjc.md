# 使用(docker|kubernetes)进行基本高可用性设置

> 原文：<https://dev.to/ohffs/basic-ha-setup-with-dockerkubernetes-3hjc>

我们有大量的网络应用和服务在工作——它们中的大多数都不是面向互联网的，因为它们是内部“管理”型工具。目前，我们将它们作为相当“笨”的 KVM 虚拟机运行(笨是指没有自动故障转移和共享存储，因此每个虚拟机都是运行它的服务器上的磁盘映像)。

我一直致力于让应用程序在 docker 容器中运行——最初只是为了避免烦人的“这需要 PHP 5.3，这需要 PHP 7.2，这需要 python 2.7+…”问题。但我开始更多地考虑使用 Docker Swarm 或 Kubernetes 来提供一个更加“无缝”的部署过程，并允许应用程序的某种自动故障转移。

经过大量的阅读和实验——感觉 kubernetes 对于我们的需求来说是多余的。我们基本上有 10-20 个应用程序在运行——即使它们暂时离线，世界也不会毁灭。与 Docker Swarm 相比，kubernetes 的复杂性似乎相当高。另一方面——感觉 Swarm 并没有在容器世界中胜出。

总之，我目前的想法是采用以下设置:

*   运行 docker swarm 的 3x 服务器(我们在附近有两个物理站点)
*   由 keepalived 之类的东西管理的虚拟 IP 成为集群的主要“in-road”
*   [traefik](https://traefik.io/) 充当虫群入口
*   可能是作为存储层的 ceph

最终目标是，如果运行 App-X 的服务器关闭，那么在另一个服务器上启动 App-X，traefik 负责路由到新实例。如果主服务器宕机，keepalived 会在另一个机器上显示 IP 地址，那里的 traefik 实例会开始处理到应用程序的路由。

我找到的大多数教程和指南要么是“在 swarm 中运行 hello world！”或者“在 GKE 带一万个豆荚！”几乎没有“如果电源线被意外地从盒子里拔出来，我希望东西能正常工作”这样的东西；-)

我对任何人的想法都很感兴趣。我希望尝试记录这个过程，以填补我似乎正在陷入的“比 hello-world 大，比沃尔玛小”的空白；-)