# 在需要之前不要拆分代码库:这是我不应该忽视的最有用的提示

> 原文:[https://dev . to/nimmo/don-split-up-your-code base-before-you-need-to-the-most-useful-elm-tip-the-I-should-not-need-3m 96](https://dev.to/nimmo/dont-split-up-your-codebase-before-you-need-to-the-most-useful-elm-tip-that-i-shouldnt-have-ignored-3m96)

我的背景主要是 JavaScript，当构建 JavaScript 应用程序时，我喜欢将它们分开。这是因为我看到了太多的`utilities.js`文件，它们永远都在运行，并且具有完全不相关的功能，我通常发现这很难维护。这种强烈的分离是好的——它让生活变得容易多了。

这使得很难用不同的心态去学习另一种语言。我*知道*经验丰富的 Elm 开发人员建议不要过早地细分模型和分离模块，但是我想“不，我不能把所有的东西都放在一起，那太难管理了”。所以我努力确保我有一系列嵌套的状态机，每个状态机管理它们自己的状态，并且有一个父状态机映射来自应用程序的所有消息并正确调用它们的`update`函数，我非常高兴。我的视图不得不做比我所希望的更多的事情，因为它们不得不绘制`X.Msg`(和`Y.Msg`，和`Z.Msg`，等等...)回到父状态机的消息类型，不过感觉还行。

然后，我添加了一个从 REST 端点获取一些数据的命令。事情开始变得不那么“好”了，因为当应用程序被初始化时，我突然有了一个在父状态机的模块中被调用的命令，并把它的结果向下传递两层来调用子状态的`update`函数。这听起来很糟糕，但是，它起作用了:当应用程序启动时，数据被正确地获取、处理并传递给`update`。

然后，我开始尝试从实际使用它的状态机传递的消息中重新获取数据。从这里开始，事情变得非常混乱，我为了让我的生活更容易而组织代码的方式最终给我带来了严重的问题。我发现很难看到这个功能的合理发展方向，我甚至还没有真正写过那么多代码！

## [](#undoing-my-own-mess)解开自己的烂摊子

当我觉得我在与工具作斗争时，我决定询问一下 [Elm Slack workspace](https://elmlang.herokuapp.com) 上的社区，那里有人建议，如果我的消息类型都一致，我就不会有这个问题；当然，他们只是*不是*，因为我把它当作一个 JavaScript 应用程序来处理。

由于 Elm 带来的重构的便利性，我想我应该尝试一下(尽管老实说，这样做对我来说感觉很陌生)——我制作了一个新的模块来保存我所有的消息，并将我以前所有独立的`update`函数合并成一个，修正了我在这个过程中对应用程序模型所做的更改——因为我意识到模型的布局是为了方便我的文件结构——重新编译，并重新运行应用程序。

到目前为止一切都很好，一切都像以前一样工作。所以，现在我需要做出实际的改变，允许在用户请求时获取数据——而不仅仅是在应用程序加载时获取数据——我对自己说“好吧，在我的新结构中，我应该在哪里进行这种更新”...在立即意识到“哦，*一个可以进行更新的地方*”之前。

事实证明，这一点也不难以管理——事实上，现在对整个应用程序进行推理要容易得多，而且无论何时添加新功能，都比这更容易知道需要在哪里进行更改。也许很快我会认为“好吧`x`需要隔离管理”，但至少我只会在感觉有利的时候增加额外的复杂性*，而不是增加*，因为我认为我可能需要那样做*。如果我避免了这种早期的细分，我会为自己节省很多时间来尝试以一种可能*不应该*的方式工作，所以从我的错误中吸取教训:如果教程、文章和经验丰富的 Elm 开发人员告诉你把应用程序拆分到以后，听他们的！*