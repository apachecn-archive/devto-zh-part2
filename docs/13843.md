# Rust ä¸­çš„ Python ä¹ è¯­

> åŸæ–‡:[https://dev.to/benrcongdon/python-idioms-in-rust-4381](https://dev.to/benrcongdon/python-idioms-in-rust-4381)

åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ç»å†äº†ä¸€æ®µç¼–ç¨‹è¯­è¨€æ¼«æ¸¸ç™–ã€‚æœ€è¿‘ï¼Œæˆ‘å¯¹é“é”ˆå¾ˆæ„Ÿå…´è¶£ã€‚æˆ‘æ¥è‡ª Pythonï¼Œæˆ‘å‘ç° Rust çš„è®¸å¤šè¯­è¨€åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚

ä»Šå¹´æ—©äº›æ—¶å€™ï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº†å›´æ£‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘å–œæ¬¢å›´æ£‹:è¿™æ˜¯ä¸€ç§ç®€å•çš„è¯­è¨€ï¼Œå¯ä»¥åœ¨å‡ ä¸ªå°æ—¶å†…å­¦ä¼š(å­—é¢ä¸Š)ã€‚å®ƒçš„ç»“æ„ä¿ƒè¿›è‰¯å¥½çš„ç¼–ç¨‹å®è·µï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€ä¸ªå¥‡å¦™çš„ç”Ÿæ€ç³»ç»Ÿã€‚

ç„¶è€Œï¼Œåœ¨å›´æ£‹ä¸­ï¼Œæˆ‘æ„Ÿè§‰å—åˆ°äº†è¯­è¨€è¡¨ç°åŠ›çš„é™åˆ¶ã€‚å®ƒä»¤äººæ‰¼è…•å¹æ¯çš„ç¼ºä¹æ³›å‹å¹¶ä¸åƒäººä»¬é¢„æœŸçš„é‚£æ ·å…·æœ‰ç ´åæ€§ï¼Œä½†å´ä½¿å¾—èªæ˜çš„å‡½æ•°å¼ç¼–ç¨‹æŠ€å·§å˜å¾—å‡ ä¹ä¸å¯èƒ½ã€‚è¿™æ²¡ä»€ä¹ˆâ€”â€”è¿™ä¸æ˜¯ Go çš„è®¾è®¡åˆè¡·â€”â€”ä½†ç»“æœæ˜¯ï¼Œæˆ‘å‘ç°ä½¿ç”¨ Go æœ‰ç‚¹ä¸â€œæœ‰è¶£â€ã€‚

è™½ç„¶ Rust ç¡®å®æœ‰é¢å¤–çš„å¤æ‚æ€§ï¼Œæ¥è‡ªå®ƒçš„[è‡­åæ˜­è‘—çš„å€Ÿç”¨æ£€æŸ¥å™¨](https://m-decoster.github.io//2017/01/16/fighting-borrowchk/)å’Œæ³›å‹çš„å¤æ‚æ€§ï¼Œä½†æˆ‘å‘ç°ä½ åœ¨è¡¨è¾¾èƒ½åŠ›ä¸Šè·å¾—çš„ä¸œè¥¿æ˜¯å€¼å¾—æƒè¡¡çš„ã€‚

äº‹å®ä¸Šï¼Œæˆ‘å‘ç° Rust æ›´åƒæ˜¯ä¸€æ¡èŸ’è›‡ <sup id="fnref:1">[1](#fn:1)</sup> ã€‚âœ¨:å½“ç„¶ï¼Œä½ å¿…é¡»å°å¿ƒç±»å‹å’Œæ‰€æœ‰æƒï¼Œä½†æœ‰ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ä¾‹å­è¡¨æ˜ Rust åˆ†äº«äº† Python è¯­æ³•çš„è®¸å¤šä¼˜ç‚¹ã€‚

åœ¨ Rust ä¸­åšäº†ä¸€ç‚¹å·¥ä½œåï¼Œæˆ‘æ‰¾å‡ºäº† Rust å’Œ Python å…±æœ‰çš„ä¸€äº›ä¹ æƒ¯ç”¨æ³• <sup id="fnref:2">[2](#fn:2)</sup> ã€‚è¿™äº›å¸¸è§çš„ç‰¹æ€§éƒ½æ˜¯æˆ‘å–œæ¬¢åœ¨ Python ä¸­ä½¿ç”¨çš„ï¼Œæˆ‘å‘ç°åœ¨ç†Ÿæ‚‰ Rust æ—¶è¿™äº›ç‰¹æ€§å¾ˆæœ‰ç”¨ã€‚

## åˆ—ä¸¾

åœ¨ Python ä¸­è¿­ä»£åˆ—è¡¨æ—¶çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼æ˜¯ä½¿ç”¨`enumerate`è®©è·å–åˆ—è¡¨å…ƒç´ çš„ç´¢å¼•å’Œå€¼:

```
arr = ['a', 'b', 'c']
for idx, val in enumerate(arr):
    print("{}, {}".format(idx, val))
# 0, a
# 1, b
# 2, c 
```

Enter fullscreen mode Exit fullscreen mode

Rust è¿­ä»£å™¨ä¹Ÿæ”¯æŒ`enumerate`ï¼(æ‚¨ç”šè‡³ä¸å¿…ä¸ºç›¸åŒçš„åŠŸèƒ½å­¦ä¹ æ–°åç§°)

```
let arr = vec!['a', 'b', 'c'];
for (idx, val) in arr.iter().enumerate() {
    println!("{}, {}", idx, val);
} 
```

Enter fullscreen mode Exit fullscreen mode

## Zip

Python ä¸­å¦ä¸€ä¸ªå¸¸è§çš„è¿­ä»£å™¨å‡½æ•°æ˜¯`zip`ï¼Œå®ƒç»“åˆäº†ä¸¤ä¸ªå…ƒç´ è¿­ä»£å™¨ï¼Œç”¨æ¯ä¸ªåˆ—è¡¨çš„ä¸€ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªå…ƒç»„è¿­ä»£å™¨ã€‚

```
letters = ['a', 'b', 'c']
numbers = [1, 2, 3]
for l, n in zip(letters, numbers):
    print("{}, {}".format(l, n))
# a, 1
# b, 2
# c, 3 
```

Enter fullscreen mode Exit fullscreen mode

åŒæ ·ï¼ŒRust è¿­ä»£å™¨ä¹Ÿæ”¯æŒ`zip` :

```
let letters = vec!['a', 'b', 'c'];
let numbers = vec![1, 2, 3];
for zipped in numbers.iter().zip(letters) {
    println!("{:?}", zipped);
}
// (1, 'a')
// (2, 'b')
// (3, 'c') 
```

Enter fullscreen mode Exit fullscreen mode

å’Œ Python çš„`zip`ä¸€æ ·ï¼ŒRust çš„`zip`åœ¨ä»»ä½•ä¸€ä¸ªè¿­ä»£å™¨è€—å°½æ—¶éƒ½ä¼šæš‚åœã€‚è¿™å…è®¸ä½ ç”¨æ— é™è¿­ä»£å™¨åšä¸€äº›å¾ˆé…·çš„äº‹æƒ…:

```
let start_at_10 = 10..;
let letters = vec!['a', 'b', 'c'];
for zipped in start_at_10.zip(letters) {
    println!("{:?}", zipped);
}
// (10, 'a')
// (11, 'b')
// (12, 'c') 
```

Enter fullscreen mode Exit fullscreen mode

## å…ƒç»„

Rust æœ‰å…ƒç»„ï¼è¿™æ˜¯æˆ‘éå¸¸æ€€å¿µçš„ Go åŠŸèƒ½ã€‚æ˜¯çš„ï¼Œå…ƒç»„ä¹Ÿå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯å¯¹äºâ€œè„šæœ¬â€æˆ–åŸå‹å·¥ä½œæ¥è¯´ï¼Œå…ƒç»„æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¯­è¨€ç‰¹æ€§ã€‚

Python çš„å…ƒç»„ç³»ç»Ÿéå¸¸çµæ´»ã€‚ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼ŒPython å…ƒç»„çš„è¡Œä¸ºç±»ä¼¼äºä¸å¯å˜åˆ—è¡¨ã€‚å…ƒç»„å¯ä»¥é€šè¿‡è§£åŒ…è¢«åˆ«ååŒ–ä¸ºå•ç‹¬çš„å˜é‡ï¼Œå¹¶è¢«ç´¢å¼•åˆ°ç›¸ä¼¼çš„åˆ—è¡¨ä¸­ã€‚

```
foo = ('foo', 1, None)
a, b, c = foo
assert a == 'foo'
assert foo[0] == 'foo'

# Tuples are immutable in Python tup = (1, 2, 3)
tup[0] = 4
# TypeError: 'tuple' object does not support item assignment 
```

Enter fullscreen mode Exit fullscreen mode

Rust çš„[å…ƒç»„åŠŸèƒ½](https://rustbyexample.com/primitives/tuples.html)ä¹Ÿç›¸å½“å¼ºå¤§ã€‚ä¸ Python ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨è¯­æ³•ç³–å°†å…ƒç»„å€¼åˆ«ååŒ–ä¸ºå•ç‹¬çš„å˜é‡ï¼Œå°½ç®¡åœ¨ Rust ä¸­è¿™è¢«ç§°ä¸ºâ€œææ„â€è€Œä¸æ˜¯â€œè§£åŒ…â€ã€‚

```
let foo = ("foo", 1, None::<i32>);
let (a, b, c) = foo;
println!("{}", a); // "foo"
println!("{}", foo.0); // "foo" 
```

Enter fullscreen mode Exit fullscreen mode

å¦å¤–ï¼ŒRust å…ƒç»„ä¸æ˜¯ç”¨æ–¹æ‹¬å·(`foo[0]`)ç´¢å¼•çš„ï¼Œè€Œæ˜¯ç”¨ç‚¹è¿ç®—ç¬¦(`foo.0`)ç´¢å¼•çš„ã€‚è¿™æ˜¯ Rust å…ƒç»„åœ¨ç¼–è¯‘æ—¶è°ƒæ•´å¤§å°çš„å‰¯äº§å“ï¼Œä¸åƒ Python å…ƒç»„æ˜¯åŠ¨æ€çš„ã€‚

```
# Dynamically sized tuples in Python tup = tuple(['foo' for _ in range(randint(1, 10))]) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸ Python ä¸åŒï¼ŒRust å…ƒç»„æ˜¯å¯å˜çš„:

```
let mut tup = (1, 2, 3);
tup.0 = 4; 
```

Enter fullscreen mode Exit fullscreen mode

## åˆ—ä¸¾ç†è§£(ç§)

åˆ—è¡¨ç†è§£æ˜¯ Python è¯­æ³•ç³–çš„åŸºç¡€ã€‚è¿™æ˜¯ä¸€ç§ç”Ÿæˆ/è¿‡æ»¤åˆ—è¡¨çš„è¶…çº§è¡¨è¾¾æ–¹å¼ã€‚

```
evens_squared = [x**2 for x in range(10) if x % 2 == 0]
# [0, 4, 16, 36, 64] 
```

Enter fullscreen mode Exit fullscreen mode

Rust æ²¡æœ‰åˆ—è¡¨ç†è§£*æœ¬èº«*ï¼Œä½†æ˜¯ Rust è¿­ä»£å™¨*æœ‰`map`å’Œ`filter`ï¼Œè¿™å…è®¸ä½ æ‰§è¡Œç±»ä¼¼çš„å¯Œæœ‰è¡¨ç°åŠ›çš„â€œåˆ—è¡¨â€ç”Ÿæˆ:* 

```
let evens_squared = (0..10)
    .filter(|x| x % 2 == 0)
    .map(|x| x * x)
    .collect();

println!("{:?}", evens_squared);
// [0, 4, 16, 36, 64] 
```

Enter fullscreen mode Exit fullscreen mode

å°±ä¸ªäººè€Œè¨€ï¼Œæ¯”èµ· Python çš„å‡½æ•°ï¼Œæˆ‘æ›´å–œæ¬¢ Rust çš„æ‰©å±•è¿­ä»£å™¨å‡½æ•°*ã€‚æˆ‘å‘ç°åƒ [flat_map](https://doc.rust-lang.org/1.15.1/std/iter/trait.Iterator.html#method.flat_map) å’Œ [scan](https://doc.rust-lang.org/1.15.1/std/iter/struct.Scan.html) è¿™æ ·çš„åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚è¿™äº›è¿­ä»£å™¨å‡½æ•°å¸¦æ¥äº†å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›æ–¹é¢ï¼Œè¿™æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ã€‚*

## å•è¡Œ If

Python å’Œ Rust éƒ½æ²¡æœ‰[ä¸‰å…ƒè¿ç®—ç¬¦](https://en.wikipedia.org/wiki/Ternary_operation)(è¿™å¯èƒ½æ˜¯æœ€å¥½çš„)ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬éƒ½æ”¯æŒå•è¡Œæ¡ä»¶è¡¨è¾¾å¼ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ˜¯æœ‰ç”¨çš„ï¼Œä½†å®ƒå®é™…ä¸Šåªæ˜¯è¯­æ³•ä¸Šçš„ç³–ã€‚

```
result = expensive_function() if some_condition else None

let result = if some_condition { expensive_function() } else { 0 } 
```

Enter fullscreen mode Exit fullscreen mode

## Î»å‡½æ•°

Python çš„ä¸€ä¸ªç»å¸¸è¢«æŠ±æ€¨çš„è¯­è¨€ç‰¹æ€§æ˜¯å®ƒçš„`lambda`å‡½æ•°ã€‚å®ƒä»¬å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯è¯­æ³•ä¸å¤ªå¥½ã€‚å…¶ä»–è¯­è¨€å¦‚ Ruby å’Œ Javascript æœ‰æ›´ç®€æ´çš„è¯­æ³•æ¥æŒ‡å®šé—­åŒ…æˆ–å†…è”å‡½æ•°ã€‚

Python `lambda` s æ¥å—ä¸€ç»„å‚æ•°ï¼Œå¹¶è¿”å›è·Ÿéš`:`
çš„è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœ

```
arr = [3, 10, 15]
sorted(arr, key=lambda x: abs(10-x))
# [10, 15, 3] 
```

Enter fullscreen mode Exit fullscreen mode

Rust é—­åŒ…åŒæ ·å…·æœ‰è¡¨ç°åŠ›ã€‚å®ƒä»¬ä½¿ç”¨ç®¡é“(`|`)æ¥ä¿å­˜å‚æ•°ï¼Œåé¢çš„è¡¨è¾¾å¼ç”¨ä½œè¿”å›å€¼ã€‚

```
let mut arr: Vec<i32> = vec![10, 15, 3];
arr.sort_by_key(|a| (10 - a).abs()); 
```

Enter fullscreen mode Exit fullscreen mode

Rust é—­åŒ…ä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨æ‹¬å·çš„å¤šè¡Œå‡½æ•°ï¼Œè¿™éå¸¸æ–¹ä¾¿:

```
let mut arr = vec![10, 15, 3];
arr.sort_by_key(|a| {
    let intermediate_value = some_function(a);
    intermediate_value + 10
}); 
```

Enter fullscreen mode Exit fullscreen mode

Python `lambda`å’Œ Rust é—­åŒ…éƒ½æ‰§è¡Œå˜é‡æ•è·ï¼Œå› æ­¤æ‚¨å¯ä»¥è®¿é—®åˆ›å»º lambda/é—­åŒ…çš„èŒƒå›´å†…çš„å˜é‡:

```
a = 10
plus_a = lambda x: x + a
plus_a(5)
# 15 
```

Enter fullscreen mode Exit fullscreen mode

```
let a = 10;
let plus_a = |x| x + a;
plus_a(5); // 15 
```

Enter fullscreen mode Exit fullscreen mode

## ä¸€ç­‰åŠŸèƒ½

åœ¨ Python ä¸­ï¼Œå‡½æ•°æœ¬è´¨ä¸Šæ˜¯ç”¨`__call__`ç¥å¥‡å‡½æ•°è°ƒç”¨çš„å¯¹è±¡ã€‚å®ƒä»¬å¯ä»¥åƒä»»ä½•å…¶ä»–å¯¹è±¡ä¸€æ ·ä¼ é€’ï¼Œç”šè‡³å¯ä»¥ä¸ºå®ƒä»¬åˆ†é…å±æ€§ã€‚è¿™å¯¹äºä¼ é€’å›è°ƒå‡½æ•°å¾ˆæœ‰ç”¨ã€‚è™½ç„¶æƒ¯ç”¨çš„ Python æ²¡æœ‰å¤§é‡ä½¿ç”¨å‡½æ•°ä½œä¸ºå˜é‡ï¼Œä½†è¿™ä¸ªç‰¹æ€§ç»å¸¸ä¼šæ´¾ä¸Šç”¨åœºã€‚

```
def plus_one(x):
    return x + 1

def map_on_list(arr, func):
    return [func(x) for x in arr]

arr = [1, 2, 3]
map_on_list(arr, plus_one)
# [2, 3, 4] 
```

Enter fullscreen mode Exit fullscreen mode

Rust ä¹Ÿæœ‰ä¸€æµçš„åŠŸèƒ½ã€‚å‡½æ•°å’Œé—­åŒ…å¯ä»¥ç”¨ä½œå…¶ä»–å‡½æ•°çš„å‚æ•°:

```
fn plus_one(x: i32) -> i32 {
    x + 1
}

fn map_on_vec(vec: &Vec<i32>, func: fn(i32) -> i32) -> Vec<i32>
{
    let mut new_vec = Vec::new();
    for i in 0..vec.len() {
        new_vec.push(func(vec[i]));
    }
    new_vec
}

let vec = vec![1, 2, 3];
println!("{:?}", map_on_vec(&vec, plus_one));
// [2, 3, 4]

// Equivalently:
println!("{:?}", map_on_vec(&vec, |x| x + 1)); 
```

Enter fullscreen mode Exit fullscreen mode

æœ‰è¶£çš„æ˜¯ï¼ŒRust å‡½æ•°å’Œé—­åŒ…ä¹‹é—´æœ‰ä¸€äº›å¾®å¦™çš„åŒºåˆ«ã€‚ <sup id="fnref:3">[3](#fn:3)</sup> ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«å½“ä½œåŒä¸€ä»¶äº‹æ¥å¤„ç†ã€‚å½“ç„¶ï¼ŒRust ä¸­çš„å‡½æ•°æ˜¯*è€Œä¸æ˜¯*å¯¹è±¡ï¼Œä½†æ˜¯ Rust struct å¯ä»¥å®ç° [Fn](https://doc.rust-lang.org/std/ops/trait.Fn.html) ã€ [FnMut](https://doc.rust-lang.org/std/ops/trait.FnMut.html) æˆ– [FnOnce](https://doc.rust-lang.org/std/ops/trait.FnOnce.html) ç‰¹å¾ï¼Œè¾¾åˆ°ç±»ä¼¼ Python çš„`__call__`çš„æ•ˆæœ(å°½ç®¡è¿™æ˜¯[ä¸æ¨è](https://stackoverflow.com/a/38672502/2421634))ã€‚

## ç»“è®º

å¸Œæœ›æˆ‘å·²ç»ç»™å‡ºäº†ä¸€ç‚¹æç¤ºï¼Œä¸ºä»€ä¹ˆä¸€ä¸ª Python å¼€å‘è€…å¯èƒ½ä¼šå¯¹ç”Ÿé”ˆæ„Ÿå…´è¶£(å‡ºäºå®¡ç¾åŸå› ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–åŸå› çš„è¯ï¼).Rust æœ‰ä¸€ä¸ªæ˜ç¡®çš„å­¦ä¹ æ›²çº¿ï¼Œä½†å®ƒæ˜¯ä¸€ç§å¿«é€Ÿçš„è¯­è¨€ï¼Œä»ç„¶å…·æœ‰å¾ˆå¼ºçš„è¡¨ç°åŠ›ã€‚

ä»è¯­æ³•çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘å‘ç° Rust æ¯” Python æ›´åƒ Pythonã€‚ä½¿ç”¨æ³›å‹å’Œç±»å‹æ¨æ–­ï¼Œä½ å¯ä»¥æœ€ç»ˆå†™å‡ºåªæœ‰æœ€å°‘â€œç±»å‹æ ·æ¿â€çš„ Rust ä»£ç ï¼Œå¹¶ä¸”*æ„Ÿè§‰*éå¸¸ç±»ä¼¼äº Pythonã€‚

å¦‚æœæ‚¨å¯¹ Rust æ„Ÿå…´è¶£ï¼Œæˆ‘å¼ºçƒˆæ¨èä»¥ä¸‹èµ„æº:

*   Rust ç¼–ç¨‹è¯­è¨€ -å®˜æ–¹(å…è´¹)ä¹¦ç±ï¼Œå¸¦ä½ äº†è§£ Rust è¯­è¨€
*   Rust è¯­è¨€æ–‡æ¡£â€”â€”Rust è¯­è¨€çš„ API æ–‡æ¡£â€”â€”å®ƒçš„æœç´¢åŠŸèƒ½éå¸¸å¼ºå¤§
*   [/r/Rust](https://www.reddit.com/r/rust/)-Rust å­ç¼–è¾‘

*å°é¢:[pix abay](https://pixabay.com/en/crab-baskets-scotland-fishing-2550284/)T3ã€‘*

## è„šæ³¨

1ã€‚ [é˜¿æ˜Â·ç½—çº³å½»](https://twitter.com/mitsuhiko)åšäº†ä¸€ä¸ª[å…³äº Rust å’Œ Python é…å¯¹çš„ç²¾å½©æ¼”è®²](https://www.youtube.com/watch?v=zmtHaZG7pPc)ï¼Œå®ƒæ‰©å±•äº† Rust æ˜¯â€œPythonâ€çš„æ¦‚å¿µ

2ã€‚å…¶ä¸­ä¸€äº›å¯èƒ½æ›´å¥½åœ°å®šä¹‰ä¸ºå¥æ³•ç³–æˆ–è¯­è¨€ç‰¹å¾ã€‚ğŸ˜›

3ã€‚é‡Œå¡å¤šÂ·é©¬ä¸æ–¯å†™äº†ä¸€ç¯‡[çš„åšæ–‡](https://ricardomartins.cc/2015/10/12/practical_differences_between_rust_closures_and_functions)è®²è¿°å‡½æ•°å’Œé—­åŒ…ä¹‹é—´çš„åŒºåˆ«