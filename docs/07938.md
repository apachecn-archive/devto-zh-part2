# 用 Linux Shell 处理文本——第 2 部分

> 原文:[https://dev.to/shamil/processing-text-with-linux-shell-第二部分- ogo](https://dev.to/shamil/processing-text-with-linux-shell---part-2--ogo)

# `grep` -搜索干草堆变得容易了

当您需要从一个非常大的源中搜索一段文本时，`grep`命令就是答案。`grep`接受字符串、正则表达式，可以产生各种格式的输出。

在文件中搜索一段文本的最基本语法是:

```
grep "pattern" file_name 
```

如果我们需要在多个文件中搜索一个模式，我们可以这样做:

```
grep "pattern" file1 file2 file3 ... 
```

`grep`也可用于标准输入。

```
echo "linux is awesome" | grep linux 
```

如果没有指定文件或目录，`grep`读取`STDIN`进行输入。

### #高亮显示匹配的文本

grep 的一个主要特性是它能够在输出中突出显示匹配的字符串。有三种颜色可供选择:`auto`、`always`和`never`。为了使用颜色选项，我们可以传递一个额外的`--color`标志来指示使用哪个选项。

```
grep "pattern" file_name --color=always 
```

正如我们已经猜到的，使用`--color=always`选项，它将总是给输出匹配的字符串着色。使用`--color=auto`，`grep`只在输出没有被传送到命令或重定向到任何文件时才在输出中显示颜色。最后一个选项，`--color=never`将关闭着色。

如果你想为每一个`grep`操作打开着色，但是又懒得为每个命令输入`--color=always`(也就是我)，你可以在你的环境中添加`GREP_OPTIONS`。

```
export GREP_OPTIONS='--color=always' 
```

这将打开所有`grep`命令的着色。

### #限制输出什么

通常，`grep`只输出包含匹配模式的行。但是在某些情况下，我们可能希望看到整个文件的内容，并突出显示匹配的模式。为此，我们可以做以下工作:

```
grep --color 'pattern\|' file_name 
```

这将输出包含图案的所有行以及有结尾的行，即文件的完整内容，只有匹配的部分有颜色。当然，我们可以传递多个模式来进行匹配。

```
grep --color 'pattern_one\|pattern_two\|' file_name 
```

注意`|`前的`\`。这是因为`grep`只解释了一些特殊字符。然而，我们也可以在没有`\`的情况下编写命令。

```
grep -E --color 'pattern_one|pattern_two|' file_name 
```

`-E`选项指示`grep`使用全套正则表达式。然而，有一种更好的方法来编写包含正则表达式的模式。我们可以使用`egrep`，它是`grep`的扩展版本，支持开箱即用的扩展正则表达式。因此，我们可以这样重写上面的命令。

```
egrep --color 'pattern_one|pattern_two|' file_name 
```

但是，如果我们既不需要包含匹配文本的完整行，也不需要完整的内容，而只需要匹配的内容，那该怎么办呢？

例如，如果我们要搜索一个文件中的所有电子邮件地址，我们不需要包含该电子邮件的行，而是只需要文件中出现的所有电子邮件。

嗯，我们可以使用`-o`选项，它代表*仅匹配*，这将输出限制为仅匹配的文本。

```
egrep -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" file_name 
```

很整洁，不是吗？

如果我们需要看到除了给定模式出现的那些行之外的所有行怎么办？

```
grep -v "pattern" file_name 
```

`-v`选项反转结果，因此上述命令将输出除包含匹配模式的行之外的所有内容。

### #统计出场次数

如果我们需要计算一个模式在一个文件中出现的次数，我们可以使用`-c`标志。根据上面的电子邮件模式示例，如果我们需要查看一个文件中有多少个电子邮件地址，我们可以执行以下操作。

```
egrep -c "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" file_name 
```

但是等等，有一个问题。

`-c`只计算包含模式的行数，而不是匹配模式的实际数量。所以如果在一行中有多个匹配，它将只计算一次！

我们可以稍微调整一下来解决这个问题。

还记得我们如何只打印上面带有`-o`标志的匹配部分吗？如果管`wc -l`用它，

```
egrep -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" file_name | wc -l 
```

它将给出特定模式在文件中出现的准确次数。

### #提取附加信息

如果我们想打印搜索模式出现的行号，我们可以使用`-n`标志。

```
grep -n --color "pattern" file_name 
```

如果我们在多个文件中进行搜索，`-n`标志也将打印文件名。

如果我们想看到模式开始的偏移，我们可以使用`-b`标志。

```
echo "linux is the answer" | grep -b -o "the" 
```

这是打印的`9:the`，因为被搜索的单词*“*从该行的第 9 个位置开始。请注意，`-b`标志总是与`-o`标志一起使用。

### #目录内搜索

要查看哪些文件包含特定的模式，我们可以使用`-l`标志。

```
grep -l "pattern" file1 file2 file3 ... 
```

这将只输出包含给定模式的文件名。如果我们想查看不包含文件的文件名，我们可以使用`-L`标志(注意区分大小写的标志)。这基本上颠倒了我们用`-l`标志得到的结果。

到目前为止，我们只看到了如何在命令中指定的单个文件或一组文件中进行搜索。然而，我们也可以递归地搜索一个完整目录及其子目录中的所有文件。

```
grep -r "pattern" . 
```

这里`.`指定了当前目录。`-r`标志意味着搜索应该在所有子目录中递归完成。该搜索区分大小写。

如果我们想搜索模式的所有出现，我们可以添加`-i`标志。

```
grep -ir "pattern" . 
```

这将输出所有匹配的模式，而不考虑大小写。

### #模式文件

如果我们有太多的模式、字符串等需要搜索，用`|`来处理它们是非常繁琐的。在这种情况下，我们可以使用一个模式文件，其中包含我们想要搜索的所有字符串/模式，*各占一行*。然后我们可以在`grep`命令中使用这个模式文件。

```
grep -ir . -f pattern_file 
```

这将打印模式文件中所有匹配的字符串。

(▽` ) /

(你可以在这里找到这个系列的第一部分)