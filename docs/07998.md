# 绑定变量对 SQL 性能的影响

> 原文:[https://dev . to/vikastwittes/impact-of-bind-variables-on-SQL-performance-3500](https://dev.to/vikastwittes/impact-of-bind-variables-on-sql-performance-3500)

解析是动态 SQL 的一大问题，影响 SQL 语句的整体性能。由于 SQL 开发人员无法访问生产环境，所以他们通常不知道确切的问题。

早期版本的数据库供应商通常将解析后的 SQL 语句存储在数据库中，这些计划甚至可以被数据库开发人员重用。这种存储称为执行计划缓存。
通过绑定变量，数据库可以识别相同的 SQL 语句，甚至可以从先前解析的已执行语句中识别。此外，可以重新执行先前执行的数据库计划，以生成新的计划。

**绑定变量如何与 SQL 性能相关联？**

当一条 SQL 语句在 Oracle 中执行时，它的引擎会检查语句的有效性，并计划如何访问语句中使用的表并将其连接在一起。这个过程叫做解析。在这里，优化器确定需要访问和连接的表。这样，一个完整的执行计划就形成了。Oracle 将语句发送到优化器的步骤称为硬解析。

在这种情况下，如果任何查询的执行计划已经存在，那么 Oracle 不会将查询发送给优化器，甚至不会使用现有的计划。这个过程被称为软解析。在比较两个 SQL 语句时，Oracle engine 甚至会考虑微小的格式差异。

像以下两种说法对甲骨文来说都是不同的:

`select * from students where student_id=s012;
And
SELECT * FROM students WHERE student_id=s012;`

虽然这两个语句是相同的，但是 Oracle 引擎在第一次执行它们时几乎不会解析这些语句。

**绑定变量如何提高 SQL 性能？**

通常，任何表都是在执行查询时通过主键进行查询的。查询按以下步骤执行:

1.  对主键索引执行唯一扫描
2.  通过使用索引的行来访问所需的行

每次调用或查询执行时都会执行这个计划。与下面列出的两个查询一样，上面列出的同一个计划将被执行两次，换句话说，每次都会执行一个困难阶段。

`select * from students where student_id=4444;
select * from students where student_id=1233;`

因此，对于这两个查询，将生成相同的计划并执行两次，这会降低 SQL 性能。在这种情况下，为了避免额外的硬解析，我们可以用一个变量或绑定变量来替换数字，只需一条语句就可以执行任务:

`select * from students where student_id=:std;`

现在，当同一个查询将针对两个不同的 std 值执行两次时，第一次将进行硬解析，第二次将进行软解析以生成结果。

**使用绑定变量的影响**

通过使用绑定变量，两种类型的性能受到很大影响，如下所列和定义:

*单个执行性能
*整个系统性能

**绑定变量如何影响个体执行性能？**

当涉及到缓存一些信息时，也会带来一些开销。解析总会带来一些开销。即使用户需要执行一个小的执行计划，仍然会带来一些开销。在这里，在这种情况下，开销将是 SQL 语句解析和创建相同的执行计划。

与不使用执行计划相比，使用绑定变量可以将执行计划的速度提高 2.5 倍。对于简单的查询，这种性能很重要，而对于复杂的查询，这种性能就不那么重要了，因为在复杂的查询中，执行本身就需要花费很多时间。没有人愿意付出额外的代价，所以 query 和它的计划通常会被缓存起来，这是一个更好的选择。

**绑定变量如何影响整个系统？**

如果没有绑定变量，不仅单个查询会受到影响，整个系统也会受到影响。在某些情况下，单个查询可以生成额外的 20，000 个查询，因此许多重要的查询可能需要等待缓存。因此，不仅单个查询的执行变慢，而且许多重要的查询可能需要等待，结果整个系统的速度可能变慢。

如果每个查询都变慢了，那么整个系统的速度就会变慢并受到很大影响。许多可能更重要的查询将会排队，服务器速度最终会变慢。

**解决方法**

在一些数据库中，常量被绑定以强制解析。在 Oracle 数据库中，可以将变量 CURSOR_SHARING=FORCE 指定为“quick fix”。在另一个数据库 SQL Server 中，此变量称为强制参数化。在这种情况下，也有一些限制。在特殊情况下，可能需要额外的解析工作。在解析时，开销会增加，因为必须找出这些文字，然后用绑定变量替换它们。然后，这种开销将应用于所有查询。因此，虽然绑定变量很快提高了性能，但另一方面也增加了开销。

**最后的话:**

对于 SQL 的性能来说，绑定变量非常重要。尤其是如果你使用客户端工具，比如 Hibernate，jOOQ 等等。，这里绑定变量必须用作默认变量。对于像 T-SQL 或 PL/SQL 这样的过程语言，绑定变量是自动生成的。通过这篇文章，您对绑定变量以及它们如何积极影响 SQL 性能有了一个清晰的概念。要了解更多关于 SQL 及其绑定变量的信息，您可以参加在[举办的甲骨文认证培训](https://www.janbasktraining.com)。