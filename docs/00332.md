# 你好 AWS 世界！

> 原文:[https://dev.to/n0kit31/hello-aws-world-30kl](https://dev.to/n0kit31/hello-aws-world-30kl)

我们 Magento 2 的一个客户问我们上线时使用什么基础设施？他们受够了单一的私人托管。在我们部门的快速头脑风暴会议之后，我们决定采用云技术。我们熟悉微软 Azure，但他们的服务(如 Redis)并没有达到我们的预期。我们最终决定亚马逊网络服务将是我们尝试的地方。我们还就两件事达成了一致。首先，一切可以、应该作为服务运行的东西。其次，为了一开始不花太多钱，我们从非常低的实例类型开始，随着时间的推移，我们将切换到更强大的实例类型。

### 开始

成功配置 Magento 服务(RDS、Redis、S3 和 Elasticsearch)后，我们创建了一个带有 20GB SSD 驱动器、2 个 CPU 和 2gb RAM 的微型节点实例。节点基本上只适用于 PHP-FPM 和 Nginx。Magento 的媒体存储在 S3 桶。客户的新 Magento 2 商店已经由我们公司开发了一段时间，所以在从测试环境导入数据库后，我们进行了第一次工件部署。弗兰奇，当我点击管理网址时，我感到惊喜，在缓存预热和成功登录后，我看到管理面板已经加载得相当快。一切似乎都正常。

### 调整

尽管后端的运行速度比我预期的要快，但基本的产品和类别操作，比如插入或编辑，还是相当慢。然而，我们发现，当两个以上的人同时使用后端时，例如，他们正在保存产品或添加产品的图像，我们会在数据库表上出现死锁。是时候调整一些东西了。
首先，RDS 实例。我们已经将其升级到更强大的 16 GB 内存和 4 个 CPU。非常有趣的事实是，当您升级 RDS 实例时，像 innodb_buffer_pool 这样的数据库设置也会动态地改变。当改变实例时，你不需要担心关键的设置。RDS 会帮你搞定的。升级 RDS 后有趣的两个事实是，IOPS 的写入计数增加了，尽管我们没有更改 SSD 类型，并且我们在升级后的日志中没有发现任何死锁信息。
处理完 RDS 之后，应用节点就是我们照顾的地方了。我们注意到，在提货期间，CPU 利用率超过了 80%。我们已经从微型实例切换到中型实例(4 个 CPU、4GB RAM、20GB SSD ),并且我们添加了第二个应用程序节点以实现更多冗余。据我们所知，在后端多个用户现在能够工作，包括重型产品或类别操作，没有延迟或死锁。然而，前端可以同时处理多达 70 个用户，没有任何进一步的问题。至少我们能数出这个数字。

### 还有什么？

AWS 主机太牛了！它对用户友好，易于探索，非常直观。在不了解它的角落和缝隙的情况下，你需要几个小时来适应它，并且感觉你已经和它一起工作了很多年。
老实说，基于第一个应用程序节点设置第二个应用程序节点再简单不过了。点击几下，工作就完成了。更重要的是，这样的操作，可能基于实例大小，并不需要那么多时间。
更改数据库高级设置也很简单。设置网格非常清晰，选项非常直观。实时操作状态栏显示当集群应用设置和重新启动时正在发生什么。
免费排行榜！几乎每个实例和服务都有基本图表。当然，它们不能像新的遗迹那样先进和精确，否则会适得其反。然而，你可能总是决定使用亚马逊的付费分析工具。

### 摘要

当然，我们这边还需要做一些事情，比如多节点部署、自动节点可伸缩性或启用 Amazon CloudFront，但我现在很肯定选择 AWS 是个好主意。可伸缩、灵活和可靠的基础设施现在是世界上每个电子商务客户必须具备的。如果您将准备充分的监控添加到这样的基础设施中，您可以确保您的商店可用性尽可能高。