# ä¸€ä¸ªç®€å•ã€çœŸå®çš„ Vue.js æŒ‡ä»¤

> åŸæ–‡:[https://dev . to/Hugo _ _ df/a-simple-real-world-vue js-directive-1p7m](https://dev.to/hugo__df/a-simple-real-world-vuejs-directive-1p7m)

[VueJS](https://vuejs.org/) æ˜¯â€œæ¸è¿›å¼ JavaScript æ¡†æ¶â€ã€‚å®ƒä»è§†å›¾åº“å’Œå‰ç«¯æ¡†æ¶ä¸–ç•Œçš„æ‰€æœ‰ç°æœ‰æŠ€æœ¯ä¸­è·å¾—çµæ„Ÿï¼ŒåŒ…æ‹¬ AngularJSã€Reactã€Angularã€Emberã€Knockout å’Œ Polymerã€‚
åœ¨ Vue(å’Œ Angular/AngularJS)ä¸­ï¼ŒæŒ‡ä»¤æ˜¯ä¸€ç§åŒ…è£…é€šå¸¸åº”ç”¨äº DOM å…ƒç´ çš„åŠŸèƒ½çš„æ–¹å¼ã€‚Vue æ–‡æ¡£ä¸­çš„ä¾‹å­æ˜¯ä¸€ä¸ª`focus`æŒ‡ä»¤ã€‚

åœ¨ AngularJS å†…éƒ¨è¿è¡Œ VueJS æ—¶ï¼ŒAngularJS è·¯ç”±å™¨ä¼šåœ¨ç‚¹å‡»æ—¶å°è¯•è§£æ
æ™®é€šé”šâ€˜`href`ã€‚
çš„`href`ä¸æ˜¯ AngularJS ç½‘å€ï¼Œæ‰€ä»¥å®ƒä¼šå›è½åˆ°é»˜è®¤é¡µé¢ã€‚
ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå¯ä»¥åˆ©ç”¨ç»„ä»¶ç›´æ¥æ›´æ–°`window.location`ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªæ¼‚äº®çš„æŒ‡ä»¤æ¥åšåŒæ ·çš„äº‹æƒ…:

```
<a v-href="'/my-url'">Go</a> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªéå¸¸é…·çš„ APIï¼Œå¯èƒ½æ¯”:
æ›´åœ°é“

```
<MyAnchor href="/my-url">
  Go
</MyAnchor> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ‰å‡ ä¸ªé—®é¢˜:

*   [æœ¬åœ°ä¸å…¨çƒæŒ‡ä»¤æ³¨å†ŒğŸŒ](https://codewithhugo.com/a-simple-real-world-vuejs-directive#local-global)
*   ä¸€ä¸ªæœ€å°æŒ‡ä»¤ APIğŸ‘Œ
*   [Vue æŒ‡ä»¤æŒ‚é’©å’Œ`removeEventListener`ğŸ†“](https://codewithhugo.com/a-simple-real-world-vuejs-directive#hooks-and-remove)
*   [æ­£ç¡®å¤„ç†ç‚¹å‡»ğŸ–±](https://codewithhugo.com/a-simple-real-world-vuejs-directive#handling-clicks)
*   [ç¦»åˆ«çš„æ€å¿µğŸ“š](https://codewithhugo.com/a-simple-real-world-vuejs-directive#parting-thoughts)

[è®¢é˜…](https://buttondown.email/hugo)åœ¨ä½ çš„æ”¶ä»¶ç®±é‡Œè·å¾—æœ€æ–°çš„å¸–å­(æ¯”ä»»ä½•äººéƒ½è¦æ—©)ã€‚

# [](#local-vs-global-directive-registration)æœ¬åœ°ä¸å…¨çƒæŒ‡ä»¤æ³¨å†ŒğŸŒ

å…¨å±€ Vue æŒ‡ä»¤å¯ä»¥è¿™æ ·å®šä¹‰:

```
Vue.directive("non-angular-link", {
  // directive definition
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹Ÿå¯ä»¥å±€éƒ¨å®šä¹‰å¦‚ä¸‹:

```
Vue.component("my-component", {
  directives: {
    "non-angular-link": nonAngularLinkDirective
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¶ä¸­`nonAngularLinkDirective`æ˜¯å®šä¹‰æŒ‡ä»¤çš„ JavaScript å¯¹è±¡ï¼Œä¾‹å¦‚

```
const nonAngularLinkDirective = {
  bind(el, binding) {},
  unbind(el) {}
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½¿ç”¨åƒ webpack è¿™æ ·çš„æ†ç»‘å™¨å’Œå•ä¸ªæ–‡ä»¶ç»„ä»¶ï¼Œè¿™å°±æä¾›äº†çµæ´»æ€§:

```
// non-angular-link-directive.js
export const nonAngularLinkDirective = {
  // directive definition
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// MyComponent.vue
<template>
  <a
    href="/my-url"
    v-non-angular-link
  >
    Go
  </a>
</template>

<script>
import { nonAngularDirective } from './non-angular-link.directive';
export default {
  directives: {
    'non-angular-link': nonAngularLinkDirective
  }
};
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#a-minimal-directive-api)ä¸€ä¸ªæœ€å°æŒ‡ä»¤ APIğŸ‘Œ

ä¸€ä¸ªå®Œæ•´çš„`MyAnchor`å•ä¸ªæ–‡ä»¶ç»„ä»¶å°†å¦‚ä¸‹æ‰€ç¤º:

```
// MyAnchor.vue
<template>
  <a
    @click="goToUrl($event)"
    :href="href"
  >
    <slot />
  </a>
</template>
<script>
export default {
  props: {
    href: {
      type: String,
      required: true
    }
  },
  methods: {
    goToUrl(e) {
      e.preventDefault();
      window.location.assign(this.href);
    }
  }
});
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç›¸å½“å†—é•¿ï¼Œå¹¶ä¸”åˆ©ç”¨äº†ä¸€ä¸ªå…¨å±€ DOM å¯¹è±¡...ä¸ç†æƒ³ã€‚
è¿™é‡Œæœ‰ä¸€äº›ç±»ä¼¼çš„æŒ‡ä»¤:

```
// non-angular-link-directive.js
export const nonAngularLinkDirective = {
  bind(el) {
    el.addEventListener("click", event => {
      event.preventDefault();
      window.location.assign(event.target.href);
    });
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæŒ‡ä»¤å¿…é¡»åƒ so `<a href="/my-url" v-non-angular-link>Go</a>`ä¸€æ ·ä½¿ç”¨ï¼Œè¿™ä¸æ˜¯æœ€å¥½çš„ APIã€‚
é€šè¿‡åˆ©ç”¨ä¼ é€’ç»™`bind`çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å®ƒï¼Œä»¥ä¾¿å®ƒå¯ä»¥åƒ`<a v-href="'/my-url'">Go</a>`
ä¸€æ ·ä½¿ç”¨(æœ‰å…³`el`å’Œ`binding`çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[https://vuejs . org/v2/guide/custom-Directive . html # Directive-Hook-Arguments):](https://vuejs.org/v2/guide/custom-directive.html#Directive-Hook-Arguments):)

```
// non-angular-link-directive.js
export const nonAngularLinkDirective = {
  bind(el, binding) {
    el.href = binding.value;
    el.addEventListener("click", event => {
      event.preventDefault();
      window.location.assign(event.target.href);
    });
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨å¯ä»¥åƒä½¿ç”¨æœ¬åœ°æŒ‡ä»¤å®šä¹‰ä¸€æ ·ä½¿ç”¨å®ƒ:

```
// MyComponent.vue
<template>
  <a v-href="'/my-url'">Go</a>
</template>
<script>
import { nonAngularLinkDirective } from './non-angular-link.directive';
export default {
  directives: {
    href: nonAngularLinkDirective
  }
};
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#vue-directive-hooks-and-raw-removeeventlistener-endraw-)Vue æŒ‡ä»¤æŒ‚é’©å’Œ`removeEventListener`ğŸ†“

æœ‰å…³æŒ‡ä»¤æŒ‚é’©çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§[https://vue js . org/v2/guide/custom-directive . html # Hook-Functions](https://vuejs.org/v2/guide/custom-directive.html#Hook-Functions)ã€‚

ä¸€ä¸ªå¥½çš„åšæ³•æ˜¯ï¼Œå½“ä¸å†éœ€è¦äº‹ä»¶ä¾¦å¬å™¨æ—¶ï¼Œåº”è¯¥å°†å…¶åˆ é™¤ã€‚
è¿™å¯ä»¥åœ¨`unbind`ä¸­ä»¥ä¸æ·»åŠ æ—¶ç›¸åŒçš„æ–¹å¼å®Œæˆï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ
ä¼ é€’ç»™`removeEventListener`çš„å‚æ•°å¿…é¡»ä¸ä¼ é€’ç»™`addEventListener` :
çš„å‚æ•°ç›¸åŒ

```
// non-angular-link-directive.js
const handleClick = event => {
  event.preventDefault();
  window.location.assign(event.target.href);
};
export const nonAngularLinkDirective = {
  bind(el, binding) {
    el.href = binding.value;
    el.addEventListener("click", handleClick);
  },
  unbind(el) {
    el.removeEventListener("click", handleClick);
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“ä½¿ç”¨è¯¥æŒ‡ä»¤çš„ç»„ä»¶è¢«é”€æ¯/å¸è½½
æ—¶ï¼Œå°†ä¼šåˆ é™¤ç›‘å¬å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ²¡æœ‰æŒ‚èµ·çš„ç›‘å¬å™¨äº†ã€‚

# [](#handling-clicks-properly-%F0%9F%96%B1)å¦¥å–„å¤„ç†ç‚¹å‡»ğŸ–±

å½“é”šç‚¹åŒ…å«å›¾åƒæ—¶ï¼Œä¼šå‘ç”Ÿè¾¹ç¼˜æƒ…å†µ:äº‹ä»¶çš„`target`ä¸æ˜¯`anchor`ã€
ï¼Œè€Œæ˜¯æ²¡æœ‰`href`å±æ€§çš„`img` â€¦ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¨å¾®äº†è§£ä¸€ä¸‹`addEventListener`å¦‚ä½•è°ƒç”¨ä¼ é€’çš„å¤„ç†ç¨‹åºï¼Œ
æˆ‘ä»¬å¯ä»¥é‡æ„`handleClick`å‡½æ•°ã€‚

```
// non-angular-link-directive.js
function handleClick(event) {
  // The `this` context is the element
  // on which the event listener is defined.
  event.preventDefault();
  window.location.assign(this.href);
}

// rest stays the same 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡ä½¿ç”¨å‘½åå‡½æ•°å’Œ`this`å…è®¸äº‹ä»¶ç›‘å¬å™¨å°†
`this`ç»‘å®šåˆ°å®ƒæ‰€é™„ç€çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç®­å¤´å‡½æ•°çš„è¯æ³•`this`ã€‚

## [](#parting-thoughts)ç¦»åˆ«çš„æ€å¿µğŸ“š

æˆ‘ä»¬ä½¿ç”¨`window.location.assign`ä»¥ä¾¿äºæµ‹è¯•ã€‚ä½¿ç”¨ Jest å’Œ`@vue/test-utils`ï¼Œç»„ä»¶çº§çš„æµ‹è¯•åº”è¯¥æ˜¯è¿™æ ·çš„:

```
import { shallowMount } from '@vue/test-utils';
import MyComponent from './MyComponent.vue';

test('It should call window.location.assign with the right urls', () => {
  // Stub window.location.assign
  window.location.assign = jest.fn();

  const myComponent = shallowMount(MyComponent);

  myComponent.findAll('a').wrappers.forEach((anchor) => {
    const mockEvent = {
      preventDefault: jest.fn()
    };
    anchor.trigger('click', mockEvent);
    expect(mockEvent.preventDefault).toHaveBeenCalled();
    expect(window.location.assign).toHaveBeenCalledWith(
      anchor.attributes().href
    );
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŒ‡ä»¤å…è®¸æ‚¨åŒ…å«ä¸ DOM äº¤äº’çš„ä»£ç ç‰‡æ®µã€‚è¯¥ä»£ç éœ€è¦è¶³å¤Ÿé€šç”¨ï¼Œä»¥ä¾¿ä¸æŒ‡ä»¤å¯ç”¨çš„æœ‰é™ä¿¡æ¯ä¸€èµ·ä½¿ç”¨ã€‚

é€šè¿‡é’ˆå¯¹ DOM ç¼–ç ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†æµè§ˆå™¨ APIï¼Œè€Œä¸æ˜¯é‡æ–°å‘æ˜å®ƒä»¬ã€‚

[è®¢é˜…](https://buttondown.email/hugo)åœ¨ä½ çš„æ”¶ä»¶ç®±é‡Œè·å¾—æœ€æ–°çš„å¸–å­(æ¯”ä»»ä½•äººéƒ½è¦æ—©)ã€‚

å¼—å…°å…‹Â·éº¦è‚¯çº³åœ¨ [Unsplash](https://unsplash.com/search/photos/contain?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„çš„å°é¢ç…§ç‰‡