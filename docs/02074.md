# ä½¿ç”¨ Heroku å’Œ Git çš„å¤šç§ç¯å¢ƒ

> åŸæ–‡:[https://dev . to/upper nauts/multiple-environments-with-heroku-and-git-c9l](https://dev.to/uppernauts/multiple-environments-with-heroku-and-git-c9l)

åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨ Heroku ä½œä¸ºå¼€å‘ç¯å¢ƒå’Œæˆ‘çš„å›¢é˜Ÿä¸€èµ·å·¥ä½œã€‚å®ƒè¿›è¡Œå¾—å¾ˆå¥½ï¼Œç›´åˆ°ä¸Šå‘¨æˆ‘ä»¬çš„å®¢æˆ·è¦æ±‚ç°åœºæ¼”ç¤ºğŸ˜±ã€‚
æˆ‘ä»¬ä¸èƒ½åœ¨å¼€å‘ç¯å¢ƒä¸Šåšæ¼”ç¤ºï¼Œä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬ä¸èƒ½è¦æ±‚æˆ‘ä»¬çš„å›¢é˜Ÿåœ¨æ¼”ç¤ºæœŸé—´åœæ­¢å·¥ä½œ(æˆ‘ä»¬éƒ½çŸ¥é“å¼€å‘ç¯å¢ƒé€šå¸¸å……æ»¡äº†çŒ«å›¾ç‰‡ã€â€œæµ‹è¯•â€å’Œâ€œlorem ipsumsâ€)ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šåˆ›å»ºä¸€ä¸ªâ€œæ¼”ç¤ºâ€ç¯å¢ƒã€‚
æˆ‘ç›´æ¥å»æ‰¾ Heroku docs äº†è§£å¦‚ä½•å¤„ç†å¤šç§ç¯å¢ƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•æ¶µç›–æˆ‘åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæ‰€å­¦åˆ°çš„ä¸€åˆ‡ã€‚

## Git remote

æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯`git remote`ã€‚
æ‘˜è‡ª GitHub æ–‡æ¡£:

> è¿œç¨‹ URL æ˜¯ Git å¯¹â€œå­˜å‚¨ä»£ç çš„åœ°æ–¹â€çš„åˆ«å‡ºå¿ƒè£çš„è¯´æ³•ã€‚

æ‚¨å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤æ¥æ£€æŸ¥æ‚¨å·²ç»åœ¨é¡¹ç›®ä¸­é…ç½®äº†å“ªäº›è¿œç¨‹:

```
git remote -v 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨æ‚¨çš„å…¸å‹é¡¹ç›®ä¸­ï¼Œè¾“å‡ºåº”è¯¥æ˜¯è¿™æ ·çš„:

```
> origin https://your-git-repo/your-git-project (fetch)
> origin https://your-git-repo/your-git-project (push) 
```

Enter fullscreen mode Exit fullscreen mode

ğŸ‘†åœ¨è¿™ç§æƒ…å†µä¸‹,`your-git-project`åªé…ç½®äº†ä¸€ä¸ªé¥æ§å™¨ï¼Œå®ƒè¢«ç§°ä¸ºâ€œåŸç‚¹â€ã€‚

*(ä½ ä¹Ÿå¯ä»¥åœ¨`your-git-project/.git/config`ä¸‹æŸ¥çœ‹ä½ é¡¹ç›®çš„é¥æ§å™¨)*

å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³äºç®¡ç†é¥æ§å™¨çš„ GitHub æ–‡æ¡£

## å¤šä¸ªé¥æ§å™¨

å› æ­¤ï¼Œæ­£å¦‚æ‚¨å¯èƒ½å·²ç»çŒœåˆ°çš„ï¼Œæ‚¨çš„ git é¡¹ç›®å¯ä»¥å¤„ç†å¤šä¸ªè¿œç¨‹ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†æ‚¨çš„ä»£ç æ¨é€åˆ°ä»»ä½•ç°æœ‰çš„è¿œç¨‹ã€‚

è‹¥è¦å°†æ–°é¥æ§å™¨æ·»åŠ åˆ°é¡¹ç›®:

```
git remote add remote-name https://your-git-repo/your-git-project.git 
```

Enter fullscreen mode Exit fullscreen mode

å¹¶æŠŠä½ çš„ä»£ç æ¨åˆ°ä¸€ä¸ªç‰¹å®šçš„è¿œç¨‹å’Œåˆ†æ”¯:

```
git push remote-name branch-name 
```

Enter fullscreen mode Exit fullscreen mode

# é‚£ä¹ˆ Heroku å‘¢ï¼Ÿ

å½“æˆ‘ä»¬ä½¿ç”¨ Heroku CLI åˆ›å»º Heroku åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†é¥æ§å™¨æ·»åŠ åˆ°æˆ‘ä»¬çš„æ–°åº”ç”¨ç¨‹åºä¸­ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæ‚¨æ£€æŸ¥æ—¥å¿—ï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

```
> Git remote heroku added 
```

Enter fullscreen mode Exit fullscreen mode

æ‘˜è‡ª Heroku çš„æ–‡æ¡£:

> å½“æ‚¨åœ¨ Heroku ä¸Šåˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šå°†ä¸€ä¸ªæ–°çš„ Git remote(é€šå¸¸åä¸º Heroku)ä¸æ‚¨çš„åº”ç”¨ç¨‹åºçš„æœ¬åœ° Git å­˜å‚¨åº“ç›¸å…³è”ã€‚

æ‰€ä»¥ Heroku CLI è´Ÿè´£å°†ä¸€ä¸ªåä¸ºâ€œHerokuâ€çš„é¥æ§å™¨æ·»åŠ åˆ°æ‚¨çš„ git é…ç½®ä¸­ã€‚æˆ‘çš„å»ºè®®æ˜¯ç”¨ä¸€ä¸ªèƒ½æ›´å‡†ç¡®åæ˜ é¥æ§å™¨ç”¨é€”çš„åå­—æ¥ä»£æ›¿è¿™ä¸ªåå­—ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ æ‰“ç®—ç”¨ Heroku æ¥å¤„ç†ä½ çš„åº”ç”¨ç¨‹åºçš„å¤šä¸ªç¯å¢ƒã€‚

## æ›´æ–° Heroku çš„è¿œç¨‹åç§°

è¦ä¸º Heroku é¥æ§å™¨è®¾ç½®ä¸€ä¸ªæ›´å¥½çš„åç§°ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
git remote rename heroku heroku-dev 
```

Enter fullscreen mode Exit fullscreen mode

## åˆ›å»º Heroku app æ—¶æŒ‡å®šè¿œç¨‹åç§°

æ‚¨ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶å®šä¹‰ä¸€ä¸ªæ›´å¥½çš„è¿œç¨‹åç§°ï¼Œå°±åƒè¿™æ ·:

```
heroku create myAppName --remote heroku-dev 
```

Enter fullscreen mode Exit fullscreen mode

## é…ç½®å˜é‡

è¿˜æœ‰ä¸€ä»¶äº‹ã€‚æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦çŸ¥é“å®ƒè¢«éƒ¨ç½²åˆ°å“ªä¸ª envï¼Œè¿™å°±æ˜¯é…ç½®å˜é‡å‡ºç°çš„æ—¶å€™ã€‚å¯ä»¥ä»æˆ‘ä»¬çš„ä»£ç ä¸­è®¿é—®é…ç½®å˜é‡ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥åˆ¤æ–­å®ƒåœ¨å“ªä¸ª env ä¸­ï¼Œä¾‹å¦‚ï¼Œè®¿é—®ç‰¹å®šç¯å¢ƒçš„æ•°æ®åº“(æ‚¨ä¸å¸Œæœ›æ‚¨çš„å¼€å‘ç¯å¢ƒåœ¨æ‚¨çš„æ¼”ç¤ºæ•°æ®åº“ä¸­æ’å…¥å†…å®¹)ã€‚

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä» Heroku CLI æ·»åŠ ä¸€ä¸ªæ–°çš„é…ç½®å˜é‡ï¼Œå°±åƒè¿™æ ·:

```
heroku config:add ENV="dev" --remote heroku-dev 
```

Enter fullscreen mode Exit fullscreen mode

ä¾‹å¦‚:è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜æˆ‘å¦‚ä½•ç”¨ Node.jsã€MongoDB å’Œ config vars ä¸ºæ¯ä¸ªç¯å¢ƒç®¡ç†ä¸åŒçš„è¿æ¥å­—ç¬¦ä¸²:

```
// config.js
const config = {
    dev: {
        connectionString: "mongodb://my-DEV-db-connection-string"
    },
    demo: {
        connectionString: "mongodb://my-DEMO-db-connection-string"
    }
}

// app.js
const config = require('./config').get(process.env.NODE_ENV);
const mongoose = require('mongoose');
mongoose.connect(config.connectionString, { useMongoClient: true }); 
```

Enter fullscreen mode Exit fullscreen mode

æŸ¥çœ‹ Heroku æ–‡æ¡£ï¼Œäº†è§£å…³äºé…ç½®å˜é‡çš„æ›´å¤šä¿¡æ¯

# æ€»ç»“

### å¦‚ä½•ä¸ºä¸€ä¸ªæ–° app åˆ›å»ºå¤šä¸ªç¯å¢ƒ:

1-ä¸ºæ‚¨éœ€è¦çš„æ¯ä¸ªç¯å¢ƒåˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸ºæ¯ä¸ªç¯å¢ƒæŒ‡å®šä¸€ä¸ªè¿œç¨‹åç§°ã€‚

```
 heroku create myAppName --remote heroku-dev
    heroku create myAppName --remote heroku-demo 
```

Enter fullscreen mode Exit fullscreen mode

2-ä¸ºæ¯ä¸ªç¯å¢ƒè®¾ç½®ä¸€ä¸ªé…ç½®å˜é‡ï¼Œè®©ä½ çš„ç¨‹åºçŸ¥é“åœ¨å“ªé‡Œè¿è¡Œ

```
 heroku config:add ENV="dev" --remote heroku-dev
    heroku config:add ENV="demo" --remote heroku-demo 
```

Enter fullscreen mode Exit fullscreen mode

### å¦‚æœæ‚¨å·²ç»åœ¨ Heroku ä¸­è¿è¡Œäº†æ‚¨çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”æƒ³è¦æ·»åŠ æ–°çš„ env:

1-é‡å‘½åæ‚¨å½“å‰çš„ Heroku é¥æ§å™¨(å¯é€‰):

```
 git remote rename heroku heroku-dev 
```

Enter fullscreen mode Exit fullscreen mode

2-ä¸ºæ–°ç¯å¢ƒåˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºï¼ŒæŒ‡å®šä¸€ä¸ªæ–°çš„è¿œç¨‹åç§°:

```
 heroku create myAppName --remote heroku-demo 
```

Enter fullscreen mode Exit fullscreen mode

3-ä¸ºæ¯ä¸ªç¯å¢ƒè®¾ç½®ä¸€ä¸ªé…ç½®å˜é‡ï¼Œè®©ä½ çš„ç¨‹åºçŸ¥é“åœ¨å“ªé‡Œè¿è¡Œ:

```
 heroku config:add ENV="dev" --remote heroku-dev
    heroku config:add ENV="demo" --remote heroku-demo 
```

Enter fullscreen mode Exit fullscreen mode

## ç°åœ¨æ¨é€ï¼

ç°åœ¨æˆ‘ä»¬çš„é¥æ§å™¨éƒ½å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„æ›´æ”¹æ¨é€åˆ°æ¼”ç¤ºç¯å¢ƒä¸­ï¼Œå°±åƒè¿™æ ·:

```
 git push heroku-demo master 
```

Enter fullscreen mode Exit fullscreen mode

Heroku ç°åœ¨å°†æ£€ç´¢æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦çš„ä»»ä½•ä¾èµ–é¡¹ï¼Œå¹¶ä¸ºæˆ‘ä»¬æ„å»ºå®ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å‡ ä¹ç«‹å³å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸Šçº¿ã€‚

# å°±æ˜¯è¿™æ ·ï¼

å¸Œæœ›è¿™å¯¹æŸäººæœ‰æ‰€å¸®åŠ©ï¼Œæ„Ÿè°¢é˜…è¯»ï¼