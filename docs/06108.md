# 脸书 API:不惜一切代价避免

> 原文:[https://dev . to/katafrakt/Facebook-API-avoid-at-all-costs-m42](https://dev.to/katafrakt/facebook-api-avoid-at-all-costs-m42)

半年多来，我一直负责开发和维护与脸书营销 API 的集成。到目前为止除了疼痛什么都没有。我决定从阴影中走出来，列出我遇到的一些事情，这样你就知道大公司是如何完全不尊重开发者地开发他们的 API 的。被警告！如果你能避免与脸书融合，就不要融合。

## 1。证明文件

乍一看，脸书的医生真的很好，很干净。他们很棒。然而，我需要的功能是自定义受众。有趣的是:文档中有对自定义受众的介绍，但是没有实际端点引用的链接。这并不意味着该文件不存在。它在那里，但是你只能通过谷歌或者他们的内部搜索来访问它。我花了一个多星期才偶然发现这个。

## 2。版本控制

当你进入 Graph API 的 [changelog 页面](https://developers.facebook.com/docs/graph-api/changelog/)时，你可以看到一个漂亮的表格，列出了不同版本的 API 应该可用多长时间。这很好，因为宽限期真的很长——在推出新版本后的两年。这是应该的...

...只是这不完全是真的。所有对脸书 API 的请求都必须通过在他们的开发门户中创建的应用程序来完成。并且在创建 app 时，只能使用创建时最新版本或更新版本的 API。虽然这听起来很有道理，但对我们来说并不完全是这样。我们只充当真实客户(负责他们的广告帐户、应用程序等)之间的代理。他们只是给我们一个正确的访问令牌)。这意味着我们总是需要最新版本的 API，因为客户可以随时创建新的应用程序。

虽然脸书不支持我们的用例可能没问题，但它真的可以在文档中清楚地提到。我会浪费至少两周的时间去找出为什么只有部分客户的请求失败了。

## 3。错误消息

在某个时候，我们引入了一个回归——当创建一个新的定制受众时，我们发送了一个带有空`name`参数的有效负载。结果应该是什么？你认为是验证错误？我也这么想。这就是为什么我检查了许多权限相关的东西，并在看到这样的错误消息后没有查看有效载荷:

```
{"message": "(#2654) Failed to create custom audience", "type": "OAuthException", "code": 2654, "fbtrace_id": "xxxxyyyy"} 
```

Enter fullscreen mode Exit fullscreen mode

很明显，当你得到`OAuthException`时，意味着有效载荷中的一个必需字段是空的。对吗？对吗？

最好的事？我已经向脸书报告了。他们的反应？“由于这不是一个真正的错误(错误是有意的)，我不能从该报告中分配它，但我一定会将您的反馈传递给相关的工程团队，至少了解他们对此的想法”。没错。那是馄饨。

## 4。临时搬东西

去年圣诞节前后(没错，这是巨大突破性变化的最佳时机)，脸书移除了他们系统中定制观众的估计数量。这是什么？基本上，当您将用户列表上传到脸书营销 API 时，您永远不知道有多少用户将与脸书数据库匹配。如果你上传 1000 封散列邮件，可能会出现所有邮件都匹配，或者零封，或者两者之间的任意数字。近似计数的目的是让你知道多少人或多或少匹配。

所以，突然在圣诞节它开始总是显示-1。这是一个“临时解决方案”,因为显然有些人利用这些计数做一些可疑和非法的事情。补丁没有在任何地方公布。人们度假回来后，开始接到客户打来的惊恐电话，说他们的观众停止了工作，展示了-1 的尺寸。

去吧，试着向他们解释我上面写的东西。

当然，现在 8 个月过去了，这个临时的解决方法仍然有效(我想他们至少不再称它为临时的)。

## 5。在没有任何通知的情况下更改 API

但最近他们真的超越了自己。

有时您需要从自定义受众中删除一些人。哦，我说“有时候”了吗？您需要一直这样做，因为人们选择退出您的系统，您需要从所有同步中删除他们。他们也可以撤销同意或任何事情。有几十个理由去做这件事。

另一方面，观众需要有一个正确的规模，以便在脸书方面运作。这样做的原因是为了避免用针对一两个人的非常具体和精确的广告来“狙击”用户。然而，正如你在第四点中读到的，你永远不知道你的受众到底有多大。当它的规模降到“安全阈值”以下时，受众将变得不可用，基于它的活动将停止，直到您再次添加一些用户，然后它将恢复运行。

听起来很有道理？确实如此。但现在不是了。

根据这篇报道，它在 8 月 8 日就停止工作了。现在，当您删除用户时，它会使其变得太小，很少会发生以下情况:

*   请求返回错误。当然是脸书，所以误差是`Permissions error`
*   它也返回`"error_subcode": 1870047`。在任何地方都没有提到它，尤其是在一个包含 API 可能返回的所有错误代码的页面上。
*   请求失败，意味着**用户实际上没有被删除**。他们仍然在那里，违反你们的协议。

你可能已经猜到了，报告很快就被关闭了，因为这是“合理的行为”。

也许他们引入了新的 API 版本？不，我不这么认为。最后一个版本是在 7 月 26 日发布的，所以差不多提前了两周。此外，变更日志没有提到任何这一点。

是的。**原本很好的请求在一夜之间开始返回错误**。似乎没有人认为脸书方面有问题。这毕竟是一个稳定的 API。

# 结束语

如果你有机会说服你的经理不要与脸书整合，那就不惜一切代价去做。你以后会感谢我的。