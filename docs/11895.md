# æ•™ç¨‹:ç”¨ React å’Œ Next.js è¿è¡Œä¸€ä¸ªå¥å…¨çš„åšå®¢

> åŸæ–‡:[https://dev . to/sanity-io/tutorial-run-a-sanity-backed-blog-with-react-and-nextjs-1 eek](https://dev.to/sanity-io/tutorial-run-a-sanity-backed-blog-with-react-and-nextjs-1eek)

æœ‰æ—¶å€™ä½ åªæ˜¯éœ€è¦ä¸€ä¸ªåšå®¢ã€‚è™½ç„¶æœ‰å¤§é‡çš„åšå®¢å¹³å°ï¼Œä½†æœ‰å¾ˆå¥½çš„ç†ç”±è®©ä½ çš„åšå®¢å†…å®¹ä¸ä½ çš„å…¶ä»–å†…å®¹ä¸€èµ·å­˜åœ¨ï¼Œæ— è®ºæ˜¯æ–‡æ¡£(å°±åƒæˆ‘ä»¬çš„æƒ…å†µ)ï¼Œäº§å“ï¼ŒæŠ•èµ„ç»„åˆè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆã€‚åšå®¢çš„å†…å®¹æ¨¡å‹ï¼Œæˆ–è€…è¯´æ•°æ®æ¨¡å¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç®€å•çš„èµ·ç‚¹ï¼Œå¯ä»¥è®©ä½ å¼€å§‹åšä¸€äº›æœ‰ç†æ™ºå’Œç‹¬ç«‹å‰ç«¯çš„äº‹æƒ…ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä»¥[å¥å…¨](https://sanity.io/?utm_source=devto&utm_medium=cpc&utm_campaign=rbt)ä¸ºå†…å®¹åç«¯çš„åšå®¢ï¼Œä»¥åŠç”¨äºå‘ˆç°ç½‘é¡µçš„åŸºäºååº”çš„æ¡†æ¶ Next.jsã€‚

# [](#1-install-sanity-and-the-preconfigured-blog-schemas)1ã€‚å®‰è£… Sanity å’Œé¢„é…ç½®çš„åšå®¢æ¨¡å¼

å¦‚æœæ‚¨è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œè¯·ä½¿ç”¨ npm å®‰è£… Sanity å‘½ä»¤è¡Œ(CLI)å·¥å…·ã€‚

```
npm i -g @sanity/cli. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å…è®¸æ‚¨åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œ`sanity init`å‘½ä»¤ï¼Œäº‹å®ä¸Šï¼Œè¿™æ˜¯ä¸‹ä¸€æ­¥ã€‚ä½ å°†è¢«è¦æ±‚åœ¨ Google æˆ– Github ä¸Šåˆ›å»ºä¸€ä¸ªè´¦æˆ·ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¿™æ—¶ä¼šè¦æ±‚æ‚¨é€‰æ‹©ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ã€‚é€‰æ‹©åšå®¢æ¨¡å¼æ¨¡æ¿ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸ºæ‚¨çš„é¡¹ç›®å’Œæ•°æ®é›†å‘½å(å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªæ•°æ®é›†ç”¨äºæµ‹è¯•ï¼Œæ‚¨å¯ä»¥æ·»åŠ æ›´å¤šçš„æ•°æ®é›†)ï¼Œå¹¶ä¸ºæ‚¨æƒ³è¦å­˜å‚¨ content studio æ–‡ä»¶çš„ä½ç½®é€‰æ‹©ä¸€ä¸ªè·¯å¾„ã€‚

```
$ Select project to use: Create new project
$ Informal name for your project: sanity-tutorial-blog
$ Name of your first data set: production
$ Output path: ~/Sites/sanity-tutorials/blog
$ Select project: template Blog (schema) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥è¿è¡Œ`sanity start`æ¥å¯åŠ¨ Content Studioï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥å¼€å§‹ç¼–è¾‘æ‚¨çš„å†…å®¹ã€‚ä¸€æ—¦ä½ ç‚¹å‡»å‘å¸ƒï¼Œè¿™äº›å†…å®¹å°†ç«‹å³è¢«åŒæ­¥åˆ°äº‘ç«¯ï¼Œå¹¶å¯é€šè¿‡ API è·å¾—ã€‚é€šè¿‡è¿è¡Œ`sanity deploy`ï¼Œä½ å°†ä¸Šä¼ è¿™ä¸ªå·¥ä½œå®¤ï¼Œå¹¶ä½¿å®ƒåœ¨ç½‘ç»œä¸Šå¯¹é‚£äº›æœ‰è®¿é—®æƒé™çš„äººå¯ç”¨(ä½ å¯ä»¥é€šè¿‡å¯¼èˆªåˆ° [manage.sanity.io](https://manage.sanity.io/?utm_source=devto&utm_medium=cpc&utm_campaign=react_blog_tutorial) æ¥æ·»åŠ ç”¨æˆ·)ã€‚

æ‚¨å¯ä»¥å¯¹å­˜å‚¨åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„æ¨¡å¼åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯è¿™æ˜¯å¦ä¸€ä¸ªæ•™ç¨‹çš„å†…å®¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªæƒ³è®©æˆ‘ä»¬çš„åšå®¢è¿è¡Œèµ·æ¥ï¼

# [](#2-install-nextjs-and-get-it-running)2ã€‚å®‰è£… Next.js å¹¶è®©å®ƒè¿è¡Œ

(ç”±ä»¤äººæ•¬ç•çš„å…¬å¸[å¼€å‘çš„)Zeit](https://zeit.co/) ä¸ºåˆ¶ä½œåŸºäº React çš„ç½‘é¡µæä¾›äº†ä¸€ä¸ªç®€æ´çš„è®¾ç½®ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è¿›è¡ŒæœåŠ¡å™¨æ¸²æŸ“ï¼Œä»¥åŠè®¸å¤šå…¶ä»–æœ‰ç”¨çš„åŠŸèƒ½ã€‚å¦‚æœä½ å·²ç»ä¹ æƒ¯äº† Reactï¼Œæˆ–è€…å·²ç»å°è¯•è¿‡ create-react-appï¼Œå®ƒåº”è¯¥ä¸ä¼šå¤ªéš¾ä¸Šæ‰‹ã€‚

ä¸ºæ‚¨çš„å‰ç«¯æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶è¿è¡Œ`npm init`ä¸ºæ‚¨çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ª package.json æ–‡ä»¶ã€‚ç„¶åç”¨
å®‰è£…ä½ çš„ Next.js ä¾èµ–é¡¹

```
npm install --save next react react-dom 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„ package.json ä¸­:

```
{  "scripts":  {  "dev":  "next",  "build":  "next build",  "start":  "next start"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Next.js æ ¹æ®æ‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®è¿›è¡Œè·¯ç”±ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ·»åŠ ä¸€ä¸ªåä¸º`pages`çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ `index.js`ï¼Œå®ƒå°†æˆä¸ºä½ ç½‘ç«™çš„é¦–é¡µã€‚åŒæ ·ï¼Œå¦‚æœä½ åœ¨`/pages`ä¸­æ·»åŠ `about.js`ï¼Œä¸€æ—¦ä½ å¯åŠ¨é¡¹ç›®ï¼Œè¿™å°†æ˜¾ç¤ºåœ¨`[localhost:3000/about](http://localhost:3000)`ä¸Šã€‚ä¸ºäº†ç¡®ä¿ä¸€åˆ‡å°±ç»ªï¼Œå°è¯•å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`pages/index.js`ï¼Œå¹¶åœ¨ shell ä¸­é”®å…¥`npm run dev`:

```
const Index = (props) => <div>Hello world!</div>

export default Index 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡» [localhost:3000](http://localhost:3000) ï¼Œä½ åº”è¯¥ä¼šæœ‰ä¸€ä¸ªé—®å€™ã€‚

# [](#3-make-a-dynamic-page-template)3ã€‚åˆ¶ä½œåŠ¨æ€é¡µé¢æ¨¡æ¿

åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ï¼Œä½†ç°åœ¨æ˜¯æœ‰è¶£çš„éƒ¨åˆ†:è®©æˆ‘ä»¬ä» Sanity ä¸­è·å–ä¸€äº›å†…å®¹ï¼Œå¹¶åœ¨ React ä¸­å‘ˆç°å‡ºæ¥ã€‚é¦–å…ˆå®‰è£…è¿æ¥åˆ° Sanity API æ‰€éœ€çš„ä¾èµ–é¡¹:`npm install @sanity/client --save`ã€‚åœ¨æ ¹å‰ç«¯æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`client.js`çš„æ–°æ–‡ä»¶ã€‚æ‰“å¼€æ–‡ä»¶ï¼Œæ”¾å…¥ä»¥ä¸‹å†…å®¹:

```
import sanityClient from '@sanity/client'

export default sanityClient({
  projectId: 'your-project-id', // you can find this in sanity.json
  dataset: 'production', // or the name you chose in step 1
  useCdn: true // `false` if you want to ensure fresh data
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºæ¯ä¸ªæ–°çš„åšå®¢æ¡ç›®æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶æ˜¯ä¸åˆ‡å®é™…çš„ã€‚ç”šè‡³æ˜¯ä¸€åœºäº‰è®ºã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªé¡µé¢æ¨¡æ¿ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ¥è‡ª Sanity çš„ URL slugsã€‚ä¸å¹¸çš„æ˜¯ï¼ŒNext.js æ²¡æœ‰å¼€ç®±å³ç”¨çš„åŠ¨æ€é¡µé¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ ä¸€äº›æœåŠ¡å™¨ä»£ç ã€‚è®©æˆ‘ä»¬é‡ç”¨`nextjs/examples`ä¸­çš„ä»£ç ï¼Œåœ¨æ ¹æ–‡ä»¶å¤¹ä¸­æ·»åŠ ä¸€ä¸ª`server.js`æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹:

```
const { createServer } = require('http')
const { parse } = require('url')
const next = require('next')
const pathMatch = require('path-match')

const port = parseInt(process.env.PORT, 10) || 3000
const dev = process.env.NODE_ENV !== 'production'
const app = next({ dev })
const handle = app.getRequestHandler()
const route = pathMatch()
const match = route('/blog/:slug')

app.prepare()
  .then(() => {
    createServer((req, res) => {
      const { pathname, query } = parse(req.url, true)
      const params = match(pathname)
      if (params === false) {
        handle(req, res)
        return
      }
      // assigning `query` into the params means that we still
      // get the query string passed to our application
      // i.e. /blog/foo?show-comments=true
      app.render(req, res, '/blog', Object.assign({}, query, params))
    })
      .listen(port, (err) => {
        if (err) throw err
        console.log(`> Ready on http://localhost:${port}`)
      })
  }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> *æŠ“åˆ°ä½ äº†*ğŸ‘†
> å¦‚æœæ‚¨å¯¹`server.js`æˆ–`package.json`è¿›è¡Œäº†æ›´æ”¹ï¼Œæ‚¨å¿…é¡»é‡å¯ npm è¿è¡Œå¼€å‘ã€‚

æ‚¨è¿˜åº”è¯¥è¿è¡Œ`npm install http url path-match --save`ä»¥è·å¾—å¿…è¦çš„ä¾èµ–é¡¹ï¼Œå¹¶å°†`package.json`ä¸­çš„è„šæœ¬éƒ¨åˆ†æ”¹ä¸º:

```
{  "scripts":  {  "dev":  "node server.js",  "build":  "next build",  "start":  "NODE_ENV=production node server.js"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨çš„å‰ç«¯æ–‡ä»¶å¤¹ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
~/blog/frontend
# install tree with homebrew install tree
$ tree -I node_modules
.
â”œâ”€â”€ client.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ pages
    â”œâ”€â”€ blog.js
    â””â”€â”€ index.js
â”œâ”€â”€ server.js
1 directory, 6 files 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Next.js é™„å¸¦äº†ä¸€ä¸ªåä¸º`getInitialProps`çš„ç‰¹æ®Šå‡½æ•°ï¼Œåœ¨`/pages`ä¸­å‘ˆç°æ¨¡æ¿ä¹‹å‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°å¹¶å‘ react ç»„ä»¶è¿”å›é“å…·ã€‚è¿™æ˜¯è·å–é¡µé¢æ‰€éœ€æ•°æ®çš„ç»ä½³ä½ç½®ã€‚

> *æŠ“åˆ°ä½ äº†*ğŸ‘†
> getInitialProps ä»…åœ¨ pages æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸­å·¥ä½œï¼Œå¹¶ç”¨äºè·¯ç”±ï¼Œå³ä¸ä¼šä¸ºè¿™äº›é¡µé¢ä¸­åŒ…å«çš„ react ç»„ä»¶è°ƒç”¨å®ƒã€‚[é˜…è¯» Next.js æ–‡æ¡£ä¸­çš„æ›´å¤šä¿¡æ¯](https://github.com/zeit/next.js/#user-content-fetching-data-and-component-lifecycle)ã€‚

æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•å¯ä»¥ç¼–å†™ react é¡µé¢ç»„ä»¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¯ä»¥è®©ä½ æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥ blog.js ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬å°† slug è®¾ç½®ä¸ºæ ‡é¢˜ï¼Œåªæ˜¯ä¸ºäº†åœ¨æ·»åŠ ä» Sanity è·å–å†…å®¹çš„ä»£ç ä¹‹å‰æµ‹è¯•ä»£ç æ˜¯å¦æœ‰æ•ˆ:

```
const Post = ({ title = 'No title' }) => (
  <div>
    <h1>{title}</h1>
  </div>
)

Post.getInitialProps = ({ query: { slug = '' } }) => { 
  const title = slug
  return { title }
}

export default Post 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ è½¬åˆ°`[localhost:3000/blog/whatever](http://localhost:3000/blog/whatever)`ï¼Œä½ ç°åœ¨åº”è¯¥çœ‹åˆ°â€œwhateverâ€ä½œä¸º H1 æ‰“å°åœ¨é¡µé¢ä¸Šã€‚

# [](#4-get-some-content-from-sanity)4ã€‚ä»ç†æ™ºä¸­è·å–ä¸€äº›å†…å®¹

æˆ‘ä»¬ç°åœ¨å·²ç»ä¸º Next.js è®¾ç½®äº†ä¸€ä¸ªç”¨äºé¦–é¡µçš„æ¨¡æ¿(index.js)å’Œä¸€ä¸ªè‡ªå®šä¹‰æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä½¿ blog.js æ¨¡æ¿å¯ä»¥å°†/blog/ä¸‹çš„ slug ä½œä¸ºæŸ¥è¯¢ã€‚ç°åœ¨æœ‰è¶£çš„éƒ¨åˆ†å¼€å§‹äº†ï¼Œè®©æˆ‘ä»¬ç»™è¿™ä¸ªæ··åˆä½“æ·»åŠ ä¸€äº›ç†æ™º:

```
import client from '../client'

const BlogPost = ({ title = 'No title' }) => (
  <div>
    <h1>{title}</h1>
  </div>
)

BlogPost.getInitialProps = async ({ query: { slug } }) => {
  const { title } = await client.fetch('*[_type == "post" && slug.current == $slug][0]', { slug })
  return { title }
}

export default BlogPost 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä½¿ç”¨ async/awaitï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨è¿›è¡Œå¼‚æ­¥ API è°ƒç”¨ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚`client.fetch()`æœ‰ä¸¤ä¸ªå‚æ•°:ä¸€ä¸ªæŸ¥è¯¢å’Œä¸€ä¸ªå¸¦æœ‰å‚æ•°å’Œå€¼çš„å¯¹è±¡ã€‚

> *Pro-tip*
> æœ¬æ•™ç¨‹ä¸­çš„ GROQ è¯­æ³•å¯ä»¥è¿™æ ·ç†è§£:
> 
> `*`ğŸ‘ˆé€‰æ‹©æ‰€æœ‰æ–‡æ¡£
> 
> `[_type == 'post' && slug.current == $slug]`ğŸ‘ˆå°†æ‰€é€‰å†…å®¹è¿‡æ»¤åˆ°ç±»å‹ä¸ºâ€œpostâ€çš„æ–‡æ¡£ï¼Œä»¥åŠé‚£äº›ä¸æˆ‘ä»¬åœ¨å‚æ•°ä¸­æ‹¥æœ‰çš„ slug ç›¸åŒçš„æ–‡æ¡£
> 
> `[0]`ğŸ‘ˆé€‰æ‹©åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ª

ä¸ºäº†è®©å‰ç«¯æœåŠ¡å™¨çœŸæ­£ä» Sanity è·å–æ•°æ®ï¼Œæˆ‘ä»¬å¿…é¡»å°†å…¶åŸŸæ·»åŠ åˆ°[CORS-è®¾ç½®](https://www.sanity.io/docs/front-ends/cors?utm_source=devto&utm_medium=cpc&utm_campaign=react_blog_tutorial)ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»å°†`localhost:3000`(ä»¥åŠæœ€ç»ˆä½ çš„åšå®¢æ‰€åœ¨çš„åŸŸå)æ·»åŠ åˆ° Sanity çš„ CORS æºè®¾ç½®ä¸­ã€‚å¦‚æœæ‚¨åœ¨ shell ä¸­è¾“å…¥`sanity manage`,æ‚¨å°†åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°è¯¥é¡¹ç›®çš„è®¾ç½®ã€‚å¯¼èˆªåˆ°è®¾ç½®å¹¶æ·»åŠ `http://localhost:3000`ä½œä¸ºæ–°çš„åŸç‚¹ã€‚

ç°åœ¨ï¼Œä½ å¯ä»¥åˆ›å»ºå¹¶å‘å¸ƒä¸€ä¸ªè‡³å°‘æœ‰ä¸€æ®µæ–‡å­—å’Œä¸€ä¸ªæ ‡é¢˜çš„å¸–å­:

[![A post in the content studio with Hello World in the title field](../Images/25c831758eaed2023b7bafdf6cffbf1f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ECcUpiOR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/01bc987afc3baa6c026f5fe99b74f5d4c2a5c041-1125x316.png%3Fw%3D1000)

è½¬åˆ°[http://localhost:3000/Hello-world](http://localhost:3000/hello-world)å¹¶ç¡®è®¤ H1 æ‹¼å†™ä¸ºâ€œHello worldï¼â€ã€‚ç°åœ¨ï¼Œæ‚¨å·²ç»æˆåŠŸåœ°å°†å‰ç«¯ä¸ç†æ™ºè¿æ¥èµ·æ¥ã€‚ğŸ‰

# [](#5-add-a-byline-with-author-and-categories)5ã€‚æ·»åŠ ä½œè€…å’Œç±»åˆ«ç½²å

åœ¨ Content Studio ä¸­ï¼Œæ‚¨ä¼šå‘ç°ï¼Œæ‚¨å¯ä»¥ä¸ºä½œè€…å’Œç±»åˆ«æ·»åŠ æ¡ç›®ã€‚å»æ·»åŠ è‡³å°‘ä¸€ä¸ªæœ‰å›¾ç‰‡çš„ä½œè€…ã€‚

[![Content Studio with author name and image filled out](../Images/c3234d354c2f3f81b634bcc545768ee0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--v-xaX71P--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/070502c8d3fe8a28fab737dd3869be3220363782-1208x833.png%3Fw%3D1000%26h%3D350%26fit%3Dmax)

å›åˆ°ä½ çš„åšå®¢æ–‡ç« ï¼Œåœ¨ä½œè€…æ é™„ä¸Šè¿™ä¸ªä½œè€…ï¼Œåƒè¿™æ ·:

[![Animated GIF of typing in Knut MelvÃ¦r as the author in the reference field](../Images/98340bdd638c0e66c607f3ae9a3b7955.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--q_hx07kC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/2da04a862d99dc1a179aaef911857ddb37384c78-601x447.gif%3Fw%3D1000%26h%3D350%26fit%3Dmax)

å‘å¸ƒæ›´æ”¹ï¼Œç„¶åå›åˆ°ä»£ç ç¼–è¾‘å™¨ã€‚æˆ‘ä»¬åˆšæ‰æ‰€åšçš„æ˜¯å¼•ç”¨ä¸€ä½æ¥è‡ªåšå®¢å¸–å­çš„ä½œè€…ã€‚å¼•ç”¨æ˜¯å¥å…¨æ€§çš„ä¸€ä¸ªå¼ºå¤§éƒ¨åˆ†ï¼Œå®ƒä½¿å¾—è·¨ç±»å‹è¿æ¥å’Œé‡ç”¨å†…å®¹æˆä¸ºå¯èƒ½ã€‚å¦‚æœæ£€æŸ¥ä½ çš„å—æ–‡æ¡£(`ctrl + alt/opt + i`)ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒè¿™æ ·:

```
"author":  {  "_ref":  "fdbf38ad-8ac5-4568-8184-1db8eede5d54",  "_type":  "reference"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæˆ‘ä»¬ç°åœ¨å–å‡º author-variable ( `const { title, author } = await client.fetch('*[slug.current == $slug][0]',{ slug })`)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†å¾—åˆ°çš„å†…å®¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è¿™å¯¹æˆ‘ä»¬æ¥è¯´ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚è¿™å°±æ˜¯ GROQ ä¸­æŠ•å½±æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚ [Projections æ˜¯ GROQ](https://www.sanity.io/docs/data-store/query-cheat-sheet#object-projections?utm_source=devto&utm_medium=cpc&utm_campaign=react_blog_tutorial) çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå…è®¸æˆ‘ä»¬æŒ‡å®š API-response æ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚

```
import client from '../client'

const BlogPost = ({ title = 'No title', name = 'No name' }) => (
  <div>
    <h1>{title}</h1>
    <span>By {name}</span>
  </div>
)

BlogPost.getInitialProps = async ({ query: { slug } }) => {
  const document = await client.fetch('*[_type == "post" && slug.current == $slug][0]{title, "name": author->name}', { slug })
  return document
}

export default BlogPost 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™é‡Œï¼Œæˆ‘å°†æŠ•å½±`{title, "name": author->name}`æ·»åŠ åˆ°æˆ‘ä»¬çš„æŸ¥è¯¢ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æŒ‡å®šæˆ‘å¸Œæœ›åœ¨ API è°ƒç”¨ä¸­è¿”å›æ–‡æ¡£ä¸­çš„ä»€ä¹ˆå†…å®¹ã€‚æˆ‘ä»¬éœ€è¦ä¸ºä½œè€…ååˆ›å»ºä¸€ä¸ªé”®ï¼Œå¹¶ä½¿ç”¨ç®­å¤´`->`è·Ÿè¸ªå¯¹ä½œè€…æ–‡æ¡£ä¸Š name-property çš„å¼•ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬è¦æ±‚ Sanity è·Ÿè¸ª`_ref`ä¸‹çš„ idï¼Œå¹¶ä»è¯¥æ–‡æ¡£è¿”å›å˜é‡`name`çš„å€¼ã€‚

è®©æˆ‘ä»¬è¯•ç€å¯¹ç±»åˆ«åšåŒæ ·çš„äº‹æƒ…ã€‚é¦–å…ˆï¼Œåœ¨ Content Studio ä¸­åˆ›å»ºè‡³å°‘ä¸¤ä¸ªç±»åˆ«ã€‚æˆ‘ç»™ Next.js åŠ äº†ä¸€ä¸ªï¼Œç»™*æ•™ç¨‹*åŠ äº†ä¸€ä¸ªã€‚

[![Next.js and Tutorials as categories in an array field](../Images/896d013bececeb621321ed37cb0d63be.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yQtjlpGJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/39c9adb5a886d2a5fa4fc183cfafe5dc136b8514-663x273.png%3Fw%3D1000%26h%3D350%26fit%3Dmax)

ç°åœ¨æˆ‘ä»¬çš„åšå®¢æ–‡ç« ä¸­æœ‰äº†ä¸€ç³»åˆ—å¯¹ç±»åˆ«çš„å¼•ç”¨ã€‚å¦‚æœæ‚¨åœ¨æ–‡æ¡£æ£€æŸ¥å™¨ä¸­å–ä¸€ä¸ªå³°å€¼ï¼Œæ‚¨ä¼šçœ‹åˆ°è¿™äº›æ˜¾ç¤ºä¸ºä½œè€…æ¡ç›®ï¼Œå¸¦æœ‰`_ref` -id çš„å¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¿…é¡»ä½¿ç”¨æŠ•å½±æ¥å¾—åˆ°è¿™äº›ã€‚

```
import client from '../client'

const BlogPost = ({ title = 'No title', name = 'No name', categories = [] }) => (
  <div>
    <h1>{title}</h1>
    <span>By {name}.</span>
    {categories && (
      <ul>Posted in
        { categories.map(category => (
          <li key={category}>{category}</li>
        ))}
      </ul>
      )
    }
  </div>
)

BlogPost.getInitialProps = async ({ query: { slug } }) => {
  const document = await client.fetch('*[_type == "post" && slug.current == $slug][0]{title, "name": author->name, "categories": categories[]->title}', { slug })
  return document
}

export default BlogPost 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç±»åˆ«çš„æŠ•å½±ä¸ author éå¸¸ç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘åœ¨å…³é”®ç±»åˆ«ä¸ŠåŠ äº†æ–¹æ‹¬å·ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨æ•°ç»„ã€‚

ä½†æ˜¯æˆ‘ä»¬ä¹Ÿæƒ³æŠŠä½œè€…çš„ç…§ç‰‡æ·»åŠ åˆ°ç½²åä¸­ï¼Sanity ä¸­çš„å›¾åƒå’Œæ–‡ä»¶èµ„äº§ä¹Ÿæ˜¯å¼•ç”¨ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬è¦è·å¾—ä½œè€…å›¾åƒï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»éµå¾ªå¯¹ä½œè€…æ–‡æ¡£å’Œå›¾åƒèµ„äº§çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®`"imageUrl": author->image.asset->url`ç›´æ¥æ£€ç´¢ imageUrlï¼Œä½†æ˜¯è¿™é‡Œä½¿ç”¨æˆ‘ä»¬åˆ¶ä½œçš„[å›¾åƒ Url åŒ…](https://www.sanity.io/docs/front-ends/presenting-images)æ›´å®¹æ˜“ã€‚ç”¨`npm i --save @sanity/image-url`åœ¨å‰ç«¯å·¥ç¨‹ä¸­å®‰è£…åŒ…ã€‚å®ƒè·å–å›¾åƒå¯¹è±¡å¹¶ç¡®å®šä»å“ªé‡Œè·å–å›¾åƒï¼Œè¿™ä½¿å¾—ä½¿ç”¨ç„¦ç‚¹ç‰¹å¾ç­‰å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

```
import client from '../client'
import imageUrlBuilder from '@sanity/image-url'
const builder = imageUrlBuilder(client)

function urlFor(source) {
  return builder.image(source)
}

const BlogPost = ({ title = 'No title', name = 'No name', categories = [], authorImage = {} }) => (
  <div>
    <h1>{title}</h1>
    <span>By {name}.</span>
    {categories && (
      <ul>Posted in
        { categories.map(category => (
          <li key={category}>{category}</li>
        ))}
      </ul>
      )
    }
    <div>
      <img src={urlFor(authorImage).width(50).url()} />
    </div>
  </div>
)

BlogPost.getInitialProps = async ({ query: { slug } }) => {
  const document = await client.fetch(`*[_type == "post" && slug.current == $slug][0]{
      title,
      "name": author->name,
      "categories": categories[]->title,
      "authorImage": author->image
    }`, { slug })
  return document
}

export default BlogPost 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å·²ç»ä¸ºå›¾åƒ URL æ„å»ºå™¨æ·»åŠ äº†ä»£ç è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`urlFor()`å‡½æ•°ä¸­å‘é€æ¥è‡ª Sanity çš„å›¾åƒå¯¹è±¡ï¼Œå¹¶åœ¨ä¸åŒçš„æ–¹æ³•(ä¾‹å¦‚`.width(50)`)åé¢æ·»åŠ `.url()`-æ–¹æ³•ã€‚

# [](#6-add-rich-text-content)6ã€‚æ·»åŠ å¯Œæ–‡æœ¬å†…å®¹

å¦‚æœæ²¡æœ‰å¯¹æ–‡æœ¬å†…å®¹çš„å¼ºå¤§æ”¯æŒï¼Œä¸€ä¸ªåšå®¢å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚Sanity ä¸­çš„å¯Œæ–‡æœ¬æ˜¯ä»¥ä¸€ç§å…è®¸æˆ‘ä»¬åœ¨è®¸å¤šä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒçš„æ–¹å¼æ„å»ºçš„:ä»æµè§ˆå™¨ä¸­çš„ HTML åˆ°è¯­éŸ³ç•Œé¢ä¸­çš„è¯­éŸ³å®ç°ã€‚å…³äºå—å†…å®¹å’Œå®ƒçš„å¯æ‰©å±•æ€§æœ‰å¾ˆå¤šè¦è¯´çš„ï¼Œä½†åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨åŒ…[å—å†…å®¹ååº”](https://github.com/sanity-io/block-content-to-react)é™„å¸¦çš„å¼€ç®±å³ç”¨åŠŸèƒ½ã€‚ç”¨`npm install --save @sanity/block-content-to-react`å®‰è£…ã€‚

```
import BlockContent from '@sanity/block-content-to-react'
import imageUrlBuilder from '@sanity/image-url'
import client from '../client'
const builder = imageUrlBuilder(client)
function urlFor(source) {
  return builder.image(source)
}
const BlogPost = ({ title = 'No title', name = 'No name', categories = [], authorImage = {}, body = [] }) => (
  <div>
    <h1>{title}</h1>
    <span>By {name}.</span>
    {categories && (
      <ul>Posted in
        { categories.map(category => (
          <li key={category}>{category}</li>
        ))}
      </ul>
      )
    }
    <div>
      <img src={urlFor(authorImage).width(50).url()} />
    </div>
    <BlockContent
      blocks={body}
      imageOptions={{w: 320, h: 240, fit: 'max'}}
      projectId={client.clientConfig.projectId}
      dataset={client.clientConfig.dataset}
    />
  </div>
)

BlogPost.getInitialProps = async ({ query: { slug } }) => {
  const document = await client.fetch(`*[_type == "post" && slug.current == $slug][0]{
      title,
      "name": author->name,
      "categories": categories[]->title,
      "authorImage": author->image,
      body
    }`, { slug })
  return document
}

export default BlogPost 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°† react-component ä½œä¸º`BlockContent`å¯¼å…¥ï¼Œå¹¶ä» post-document è·å–ä¸»ä½“ã€‚æˆ‘ä»¬å°†ä¸»ä½“ä½œä¸º`blocks-prop`å‘é€ï¼Œå¹¶æ·»åŠ `projectID`å’Œæ¥è‡ª`client-config`çš„æ•°æ®é›†ï¼Œä»¥ä¾¿è®©`BlockContent`ç»„ä»¶çŸ¥é“ä»å“ªé‡Œè·å–å¯èƒ½å‡ºç°åœ¨å¯Œæ–‡æœ¬å­—æ®µä¸­çš„å›¾åƒã€‚

æˆ‘è¿˜åŠ äº†ä¸€ä¸ªå«`imageOptions`çš„é“å…·ï¼Œæ§åˆ¶å›¾åƒçš„é»˜è®¤è¾“å‡ºã€‚å°±æ˜¯è¿™æ ·ï¼æ‚¨å¯ä»¥[å®šåˆ¶ä¸åŒå…ƒç´ çš„è¾“å‡ºï¼Œç”šè‡³é€šè¿‡å‘é€æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œåºåˆ—åŒ–å™¨â€çš„ä¸œè¥¿æ¥æ·»åŠ æ‚¨è‡ªå·±çš„å®šåˆ¶å—ç±»å‹](https://github.com/sanity-io/block-content-to-react)â€”â€”æˆ‘ä»¬å°†åœ¨å¦ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­ä»‹ç»è¿™äº›ã€‚

[![Webpage showing the content from Sanity rendered through Next.js](../Images/8be1507f1ab237727318908e82061c01.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zCxJjr1e--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/0897b09dd01278a99a7386611e943f652076efe1-785x578.png%3Fw%3D1000%26h%3D350%26fit%3Dmax)

æœ¬æ•™ç¨‹åˆ°æ­¤ç»“æŸï¼å½“è°ˆåˆ°ä¸ºä¸€ä¸ªéå¸¸å¸¸è§çš„å†…å®¹è®¾ç½®ç¼–å†™å‰ç«¯å±‚æ—¶ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æ¶‰åŠäº†å¾ˆå¤šå†…å®¹ï¼Œä½†æ˜¯ä»…ä»…æ¶‰åŠäº†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»“åˆä½¿ç”¨ Sanity å’Œ React æ¥å®Œæˆçš„åŠŸèƒ½å’Œæ¼‚äº®çš„äº‹æƒ…çš„å†°å±±ä¸€è§’ã€‚

ä½ å¯ä»¥ä» GitHub ä¸‹è½½[ç¤ºä¾‹é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥åœ¨](https://github.com/sanity-io/sanity-blog-tutorial) [Gitter](https://gitter.im/sanity-io/sanity) æˆ–[ä¸Šéšæ„å‘æˆ‘ä»¬æé—®ï¼Œä¸è¿‡ä½ ä¹Ÿå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬](https://twitter.com/sanity_io)ã€‚