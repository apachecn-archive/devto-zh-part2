# æ–°æ¸¸æˆ:å¯¹å›¾å½¢çš„è¿½æ±‚(åˆ©å¤«-SDL #1)

> åŸæ–‡:[https://dev . to/mortoray/new-game-a-quest-for-graphics-leaf-SDL-1-n16](https://dev.to/mortoray/new-game-a-quest-for-graphics-leaf-sdl-1-n16)

æˆ‘å¼€å§‹äº†ä¸€æ®µæ—…ç¨‹ï¼Œè®© Leaf æ›´å…·è§†è§‰æ•ˆæœã€‚ä½ å¯èƒ½å·²ç»çœ‹è¿‡æˆ‘çš„ä¸€äº›å…³äºå¤æ‚æ€§çš„è§†é¢‘ï¼Œç”¨æŠ–åŠ¨çš„é¼ æ ‡ç”»å‡ºçº¿æ¡ã€‚è¿™è¿˜ä¸å¤Ÿå¥½ï¼Œå°¤å…¶æ˜¯å¦‚æœæˆ‘æƒ³å±•ç¤ºæ ‘çš„æ—‹è½¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘æƒ³æŠŠé‚£äº›åšå¾—æ›´å¥½ï¼Œä½†æ˜¯æˆ‘æƒ³åœ¨[å¶å­](http://leaflang.org/)é‡Œåšã€‚

ç”¨ Leaf ç¼–å†™å®Œæ•´çš„å›¾å½¢è§£å†³æ–¹æ¡ˆè¿˜ä¸ºæ—¶è¿‡æ—©ï¼›æˆ‘éœ€è¦ä½¿ç”¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆã€‚æœ€å¥½æ˜¯å°½å¯èƒ½ç®€å•çš„è¯­è¨€ï¼Œå› ä¸ºé›†æˆè¿˜ä¸æ˜¯è¿™ç§è¯­è¨€çš„å¼ºé¡¹ã€‚è¿›å…¥ SDL - [ç®€å• DirectMedia å±‚](https://www.libsdl.org/)ã€‚

## å®šä¹‰ SDL_Init

ç¬¬ä¸€æ­¥æ˜¯åˆå§‹åŒ– SDL åº“ã€‚è¿™çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†å´æ˜¯ç¼–å†™è¯­è¨€çš„é‡è¦ä¸€æ­¥ã€‚

ä¸ºäº†è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå¯¼å…¥åˆ° Leaf ä¸­ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:

```
@import( "SDL_Init" ) multi sdl_init : ( flags : binary 32bit ) ->  ( : abi_int ) raw no_throw 
```

Enter fullscreen mode Exit fullscreen mode

`@import( "SDL_Init")`ä»£ç é€šè¿‡åç§°åˆ›å»ºä¸€ä¸ªå¯¼å…¥ã€‚é“¾æ¥å™¨éœ€è¦è§£ææ­¤ç¬¦å·ã€‚

`multi`åªæ˜¯ä¸€ä¸ªå¶å­ï¼Œå®ƒå…è®¸`sdl_init`æœ‰å¤šä¸ªé‡è½½ã€‚è¿™é‡Œæœ‰å…¶ä»–çš„é€‰æ‹©ï¼Œåƒ`var`å’Œ`defn`ï¼Œå¹¶ä¸”æœ‰å¯èƒ½`multi`ä¸èƒ½é•¿æœŸç”Ÿå­˜ã€‚

ä¸‹ä¸€ä½`( flags : binary 32bit ) -> ( : abi_int ) raw no_throw`æ˜¯å‡½æ•°çš„ç±»å‹ã€‚ç¬¬ä¸€éƒ¨åˆ†è¦æ˜ç¡®ï¼›è¿™æ˜¯ä¸€ä¸ªé‡‡ç”¨ 32 ä½æ•´æ•°æ ‡å¿—å‚æ•°å¹¶è¿”å›æ•´æ•°ç»“æœçš„å‡½æ•°ã€‚`abi_int`ä¸­çš„`abi`æ˜¯æŒ‡æ“ä½œç³»ç»Ÿçš„åº”ç”¨äºŒè¿›åˆ¶æ¥å£:è¯¥ç³»ç»Ÿä¸Šç±»å‹çš„é€šç”¨å®šä¹‰ã€‚å®ƒå¯èƒ½å’Œä¸€ç‰‡å¶å­çš„å¤§å°ä¸ä¸€æ ·ã€‚

`raw`æœ‰ç‚¹éš¾æ‡‚ã€‚åœ¨ Leaf ä¸­ï¼Œå‡½æ•°å˜é‡å¯ä»¥è¡¨ç¤ºç»‘å®šã€æœªç»‘å®šæˆ–åŸå§‹å‡½æ•°ã€‚ç»‘å®šæŒ‡çš„æ˜¯è°ƒç”¨å‡½æ•°æ‰€éœ€çš„ä¸Šä¸‹æ–‡(æƒ³è±¡ä¸€ä¸ªå¸¦æœ‰`this`å˜é‡çš„ç±»å‡½æ•°)ã€‚åœ¨ Leaf ä»£ç ä¸­ï¼Œæ‚¨å¾ˆå°‘è€ƒè™‘è¿™ç§ç±»å‹ï¼Œä½†æ˜¯å½“ä½¿ç”¨å¤–éƒ¨åº“æ—¶ï¼Œè¿™å¾ˆé‡è¦ã€‚è¿™äº›å°†æ°¸è¿œæ˜¯`raw`ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ä¸Šä¸‹æ–‡æˆ–ç»‘å®šã€‚

`no_throw`è¡¨ç¤ºä¸äº§ç”Ÿä»»ä½•é”™è¯¯ã€‚è‡³å°‘åœ¨ Leaf æŠ¥å‘Šé”™è¯¯çš„æ„ä¹‰ä¸Šæ˜¯è¿™æ ·çš„:è¿”å›çš„`abi_int`ä»ç„¶æ˜¯ä¸€ä¸ªé”™è¯¯ä»£ç ã€‚æœ¯è¯­`no_throw`å¯èƒ½ä¼šè¢«æ›¿æ¢ä¸º`no_error`ï¼Œå› ä¸º`throw`æ˜¯ä¸€ä¸ªä¸“ç”¨äºå¼‚å¸¸çš„æœ¯è¯­ï¼ŒLeaf ä¸å†ä½¿ç”¨(è‡³å°‘ä¸å†ä½¿ç”¨)ã€‚

## è°ƒç”¨ SDL_Init

æˆ‘ä»¬ç°åœ¨å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°:

```
var q = sdl_init( SDL_INIT_VIDEO )
std.println([ "sdl_init: ", q]) 
```

Enter fullscreen mode Exit fullscreen mode

SDL _ åˆå§‹åŒ– _ è§†é¢‘æ˜¯åº“ä¸­çš„ä¸€ä¸ªæ ‡å¿—å€¼:

```
literal SDL_INIT_VIDEO =  0x0000_0020 
```

Enter fullscreen mode Exit fullscreen mode

æ³¨æ„è¿™é‡Œæ²¡æœ‰ç±»å‹:è¿™æ˜¯ Leaf çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¸¸é‡å¯ä»¥æ˜¯æœ‰ç†æ•°ã€‚å½“æ‚¨ä½¿ç”¨è¯¥å€¼æ—¶ï¼Œå®ƒå°†æ£€æŸ¥æ˜¯å¦å¯ä»¥å®‰å…¨åœ°è½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ã€‚å¯¹äºç®€å•çš„æ——å¸œï¼Œå°±æ²¡é‚£ä¹ˆæœ‰è¶£äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥èµ°äº†ã€‚è¿è¡Œå®ƒï¼Œç„¶å...`SEGFAULT`ã€‚

```
#0  __strcmp_ssse3 () at ../sysdeps/x86_64/multiarch/../strcmp.S:173
#1  0x00007fffeff1a667 in llvm::cl::generic_parser_base::findOption(char const*) () from /home/src/leaf/sdl/dist/libLLVM-3.8.so
#2  0x00007ffff02f291f in llvm::RegisterPassParser<llvm::MachineSchedRegistry>::NotifyAdd(char const*, void* (*)(), char const*) () from /home/src/leaf/sdl/dist/libLLVM-3.8.so
#3  0x00007fffe3ab4754 in llvm::MachinePassRegistry::Add(llvm::MachinePassRegistryNode*) () from /usr/lib/x86_64-linux-gnu/libLLVM-5.0.so.1
#4  0x00007fffe36fe616 in ?? () from /usr/lib/x86_64-linux-gnu/libLLVM-5.0.so.1
#5  0x00007ffff7de76ba in call_init (l=<optimised out>, argc=argc@entry=4, argv=argv@entry=0x7fffffffdac8, env=env@entry=0x7fffffffdaf0) at dl-init.c:72
#6  0x00007ffff7de77cb in call_init (env=0x7fffffffdaf0, argv=0x7fffffffdac8, argc=4, l=<optimised out>) at dl-init.c:30
#7  _dl_init (main_map=main_map@entry=0x86b1b0, argc=4, argv=0x7fffffffdac8, env=0x7fffffffdaf0) at dl-init.c:120
#8  0x00007ffff7dec8e2 in dl_open_worker (a=a@entry=0x7fffffffc470) at dl-open.c:575
#9  0x00007ffff7de7564 in _dl_catch_error (objname=objname@entry=0x7fffffffc460, errstring=errstring@entry=0x7fffffffc468, mallocedp=mallocedp@entry=0x7fffffffc45f, 
    operate=operate@entry=0x7ffff7dec4d0 <dl_open_worker>, args=args@entry=0x7fffffffc470) at dl-error.c:187
#10 0x00007ffff7debda9 in _dl_open (file=0x7fffffffc6f0 "/usr/lib/x86_64-linux-gnu/dri/r600_dri.so", mode=-2147483390, caller_dlopen=0x7fffe9580a39, nsid=-2, argc=<optimised out>, 
    argv=<optimised out>, env=0x7fffffffdaf0) at dl-open.c:660
#11 0x00007ffff53c4f09 in dlopen_doit (a=a@entry=0x7fffffffc6a0) at dlopen.c:66
#12 0x00007ffff7de7564 in _dl_catch_error (objname=0x69d830, errstring=0x69d838, mallocedp=0x69d828, operate=0x7ffff53c4eb0 <dlopen_doit>, args=0x7fffffffc6a0) at dl-error.c:187
#13 0x00007ffff53c5571 in _dlerror_run (operate=operate@entry=0x7ffff53c4eb0 <dlopen_doit>, args=args@entry=0x7fffffffc6a0) at dlerror.c:163
#14 0x00007ffff53c4fa1 in __dlopen (file=<optimised out>, mode=<optimised out>) at dlopen.c:87
#15 0x00007fffe9580a39 in ?? () from /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1
#16 0x00007fffe95838f3 in ?? () from /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1
#17 0x00007fffe955ba54 in ?? () from /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1
#18 0x00007fffe9557c2b in ?? () from /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1
#19 0x00007fffe9558062 in glXQueryExtensionsString () from /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1
#20 0x00007fffef080caf in ?? () from /usr/lib/x86_64-linux-gnu/libSDL2.so
#21 0x00007fffef07337f in ?? () from /usr/lib/x86_64-linux-gnu/libSDL2.so
#22 0x00007fffef07528c in ?? () from /usr/lib/x86_64-linux-gnu/libSDL2.so
#23 0x00007fffef074f35 in ?? () from /usr/lib/x86_64-linux-gnu/libSDL2.so
#24 0x00007fffeefdc397 in ?? () from /usr/lib/x86_64-linux-gnu/libSDL2.so
#25 0x00007ffff7ff55b5 in _init_module_main_5 ()
#26 0x00007ffff7ff516f in _entry ()
#27 0x00007ffff7ff65dc in main ()
#28 0x00007ffff0d7f9bd in llvm::MCJIT::runFunction(llvm::Function*, llvm::ArrayRef<llvm::GenericValue>) () from /home/src/leaf/sdl/dist/libLLVM-3.8.so
#29 0x00007ffff4c843d9 in ir_llvm::gen::execute (this=this@entry=0x7fffffffcd90, m=..., sc="") at src/ir/llvm/gen.cpp:249
#30 0x00007ffff6bd9e90 in runner::execute (this=0x7fffffffd8b0, m=std::shared_ptr (count 3, weak 0) 0x6c9d40, args=std::vector of length 0, capacity 0) at src/runner/runner.cpp:339
#31 0x00007ffff6bda264 in runner::execute (this=this@entry=0x7fffffffd8b0, m=std::shared_ptr (count 3, weak 0) 0x6c9d40) at src/runner/runner.cpp:264
#32 0x0000000000413687 in main (argc=4, argv=0x7fffffffdac8) at src/bin/leaf.cpp:256 
```

Enter fullscreen mode Exit fullscreen mode

å•Šå“¦ï¼é‚£æ˜¯åœ¨ LLVM æ‰§è¡Œå¼•æ“å†…éƒ¨ã€‚æ³¨æ„ï¼Œå¤±è´¥çš„å¹¶ä¸æ˜¯ SDL çš„åŠ è½½ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä¼ é€’çš„åº“ï¼Œé€šè¿‡`libGL.so.1`ï¼Œå°½ç®¡`dri/r600_dri.so`ã€‚å¤±è´¥çš„ä¹Ÿä¸æ˜¯åº“ï¼Œè€Œæ˜¯ LLVM çš„è¿è¡Œæ—¶å·¥å…·ã€‚

æˆ‘åœ¨é‚®ä»¶åˆ—è¡¨ä¸Šè¯¢é—®è¿‡ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚ä¹Ÿè®¸ LLVM å‡çº§ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä¸ç„¶æˆ‘å°±è¦è‡ªå·±è°ƒè¯•äº†ã€‚

å¹¸è¿çš„æ˜¯ï¼ŒLeaf ä¸å¿…é‚£æ ·è·‘ï¼Œè¿™æ˜¯ä¸ºäº†æ›´å¿«å‘¨è½¬çš„æ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ¥ç¼–è¯‘ç¨‹åºã€‚

```
leaf  --library SDL2 --exe /tmp/demo . 
```

Enter fullscreen mode Exit fullscreen mode

å½“ç„¶ï¼Œè¿™å¤±è´¥äº†:æ²¡æœ‰ä»€ä¹ˆæ˜¯å…è®¸ç®€å•çš„ï¼åŸæ¥æˆ‘åªä¸º LLVM JIT å¼•æ“å®ç°äº†`--library`ã€‚å¯¹é“¾æ¥å™¨å‘½ä»¤è¡Œçš„ä¸€ä¸ªå°å°çš„è¡¥å……å°±å®Œæˆäº†ã€‚

å±å¹•ä¸Šæ˜¾ç¤ºè¿è¡Œ`/tmp/demo`å’Œ`0`ã€‚`0`æ˜¯æ¥è‡ª`SDL_Init`çš„æˆåŠŸå€¼ã€‚å¤ªå¥½äº†ï¼

## SDL _ åˆ›å»º _ çª—å£

æˆ‘é€‰æ‹©äº† SDL è€Œä¸æ˜¯ GL åº“ï¼Œå› ä¸ºæˆ‘ä¸æƒ³åˆ›å»ºä¸€ä¸ªæœ¬åœ°çª—å£ã€‚è¿™å¹¶ä¸éš¾ï¼Œä½†å®ƒæ˜¯ç‰¹å®šäºå¹³å°çš„ï¼Œé€šå¸¸æ¶‰åŠè®¸å¤šå®šä¹‰ã€ç»“æ„å’Œå‡½æ•°ã€‚

```
typedef SDL_Window : abi_pack [
] 

literal SDL_WINDOW_SHOWN = 0x0000_0004

@import( "SDL_CreateWindow" ) multi sdl_create_window : ( title : raw_arrayï½¢abi_charï½£,
    x : abi_int, y : abi_int, w : abi_int, h : abi_int, flags : binary 32bit ) -> ( : SDL_Window value_ptr ) raw no_throw 
```

Enter fullscreen mode Exit fullscreen mode

`SDL_Window`æ˜¯åº“ä¸­çš„ä¸€ä¸ªä¸é€æ˜ç»“æ„(æˆ–è€…å®ƒä¸æ˜¯ï¼Œä½†æ˜¯æˆ‘ä¸éœ€è¦å®ƒçš„ä»»ä½•éƒ¨åˆ†)ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œæˆ‘è¿˜æ˜¯å£°æ˜äº†ä¸€ä¸ªç±»å‹ã€‚return ä¸Šçš„`value_ptr`è¡¨ç¤ºä¸€ä¸ª C é£æ ¼çš„æŒ‡é’ˆ:è¿™äº›åœ¨ Leaf ä¸­è¢«è®¤ä¸ºæ˜¯â€œä¸å®‰å…¨çš„â€å¼•ç”¨ï¼Œä½†æ˜¯å¯¹äºè°ƒç”¨åº“æ˜¯å¿…è¦çš„ã€‚

> Leaf ç¡®å®åœ¨è®¸å¤šéœ€è¦å®‰å…¨çš„æƒ…å†µä¸‹ä½¿ç”¨äº†`value_ptr`ã€‚æˆ‘ç›®å‰æ­£åœ¨ç ”ç©¶ Rust æ˜¯å¦‚ä½•å€Ÿç”¨çš„â€”â€”ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ªå°†æˆä¸º Leaf çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘å°†èƒ½å¤Ÿæ£€æµ‹åˆ°`value_ptr`çš„ä½¿ç”¨ä½•æ—¶æ— æ•ˆã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™äº›å¤–æ¥åŠŸèƒ½ä»å°†æ˜¯ä¸å®‰å…¨çš„ã€‚

```
var window = sdl_create_window( std.u8_encode("Leaf SDL Window"),  0, 0, 400, 300, SDL_WINDOW_SHOWN )
//TODO: null check on `window` 
```

Enter fullscreen mode Exit fullscreen mode

Leaf ä¸­çš„å­—ç¬¦ä¸²ç›®å‰åªæ˜¯ä¸€ä¸ª`arrayï½¢charï½£`ï¼Œå…¶ä¸­`char`æ˜¯ä¸€ä¸ª Unicode ç ä½(ä¸€ä¸ªå®Œæ•´çš„ 32 ä½å€¼)ã€‚è°ƒç”¨ ABI API éœ€è¦å°†å…¶è½¬æ¢ä¸º ABI å½¢å¼ã€‚è¿™é‡Œæˆ‘åªæ˜¯å‡è®¾é‚£æ˜¯`utf8`ã€‚æœ€ç»ˆï¼Œæ ‡å‡†åº“å°†éœ€è¦ä¸€ä¸ª`abi_encode`å‡½æ•°æ¥æ­£ç¡®å®Œæˆå®ƒ(å°½ç®¡ utf-8 æ˜¯æœ€å¸¸è§çš„)ã€‚

> ä¸ºä»€ä¹ˆæˆ‘æ”¾äº†ä¸€ä¸ªå…³äº null çš„`TODO`è€Œä¸æ˜¯åªæ£€æŸ¥å®ƒï¼Ÿç°åœ¨åœ¨ Leaf ä¸­æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œä½ ä¸èƒ½ç›´æ¥æ£€æŸ¥æŒ‡é’ˆã€‚é‚£ä¸ª`window`æ˜¯ä¸€ä¸ª`SDL_Window`ï¼›é‚£æ˜¯å®ƒçš„å›ºæœ‰ç±»å‹ã€‚Leaf ä¸»è¦å¤„ç†å†…éƒ¨ç±»å‹ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥å¤–éƒ¨éƒ¨åˆ†`value_ptr`ã€‚

è¿è¡Œè¿™æ®µä»£ç ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªçª—å£ã€‚

[![empty window graphic](../Images/3c56007e570c1f40eeadf38dd750a7dd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--t4JDMpVn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://mortoray.files.wordpress.com/2018/02/sdl_window_empty.png)

å¯ä»¥çœ‹åˆ°æ ‡é¢˜ï¼Œä½†æ˜¯å†…å®¹å¥½åƒä¸å¯¹ã€‚å®ƒçœ‹èµ·æ¥æ˜¯é€æ˜çš„ï¼Œåªæ˜¯åœ¨å¯åŠ¨æ—¶æ˜¾ç¤ºå®ƒåé¢çš„å†…å®¹ã€‚æˆ‘ä»¬æ²¡æœ‰ç”»ä»»ä½•ä¸œè¥¿ï¼Œç”šè‡³æ²¡æœ‰æ¸…é™¤å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„åŒºåŸŸ(å°½ç®¡æ•æ‰å·²ç»å­˜åœ¨çš„å†…å®¹çœ‹èµ·æ¥å¯èƒ½æ˜¯ä¸€ä¸ªå®‰å…¨é—®é¢˜)ã€‚

## SDL _ è·å– _ çª—å£ _ è¡¨é¢

æ¥ä¸‹æ¥æ˜¯`SDL_Get_Window_Surface`ã€`SDL_Fill_Rect`å’Œ`SDL_Update_Window_Surface`ã€‚è¿™äº›éƒ½åªæ˜¯ä¹‹å‰çš„å˜åŒ–ã€‚æˆ‘èƒ½è®©çª—æˆ·å˜æˆç°è‰²ã€‚ä½†æ˜¯æˆ‘ä¸æƒ³è¦ç°è‰²ï¼Œæˆ‘æƒ³è¦ä¸€ç§ RGB é¢œè‰²ã€‚

ä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨äº†`SDL_Map_RGB`å‡½æ•°ï¼Œä» RGB ç©ºé—´æ˜ å°„åˆ°è¡¨é¢ä½¿ç”¨çš„ä»»ä½•é¢œè‰²ç©ºé—´ã€‚å®ƒæœ‰è¿™æ ·çš„å®šä¹‰:

```
typedef SDL_PixelFormat : abi_pack [
]
@import( "SDL_MapRGB" ) multi sdl_map_rgb : ( format : SDL_PixelFormat value_ptr, r : octet, b : octet, c : octet ) -> ( : binary 32bit ) raw no_throw 
```

Enter fullscreen mode Exit fullscreen mode

å—¯ï¼Œå®ƒéœ€è¦ä¸€ä¸ª`SDL_PixelFormat`ã€‚åœ¨ SDL çš„ä¾‹å­ä¸­ï¼Œè¿™æ¥è‡ªè¡¨é¢ã€‚

```
@import( "SDL_GetWindowSurface" ) multi sdl_get_window_surface : ( window : SDL_Window value_ptr ) -> ( : SDL_Surface value_ptr ) raw no_throw 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨`SDL_Surface`é‡Œé¢æ˜¯ä¸€ä¸ªåä¸º`format`çš„å±æ€§ã€‚ä¸ºäº†è®©`map_rgb`å·¥ä½œï¼Œæˆ‘éœ€è¦æ·±å…¥äº†è§£è¿™ä¸ªç»“æ„â€”â€”ä¸å†åƒ`SDL_Window`é‚£æ ·æ™¦æ¶©éš¾æ‡‚ã€‚

```
typedef SDL_Surface : abi_pack [
    _flags : binary 32bit,
    format : SDL_PixelFormat value_ptr,
    w : abi_int,
    h : abi_int,
    pixels : abi_ptr,
    userdata : abi_ptr,
    _locked : abi_int,
    _lock_data : abi_ptr,
    //more
] 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ Leaf ä¸­ä½¿ç”¨å…ƒç»„æ¥è¡¨ç¤ºä»»ä½•çº¯æ•°æ®ç±»å‹(æ²¡æœ‰å‡½æ•°çš„ç±»å‹ï¼Œæ¯”å¦‚ç±»)ã€‚æ³¨æ„`abi_pack`çš„ä½¿ç”¨ï¼Œå®ƒè¡¨ç¤ºè¿™é‡Œå­—æ®µçš„æ’åºå’Œå¯¹é½å¿…é¡»ç¬¦åˆæ“ä½œç³»ç»Ÿ ABIã€‚Leaf å¯ä»¥å¯¹å­—æ®µè¿›è¡Œé‡æ–°æ’åºï¼Œå¹¶å…·æœ‰ä¸åŒçš„å¯¹é½æ–¹å¼ï¼Œå› æ­¤åƒåŸç”Ÿåº“ä¸€æ ·å®‰æ’è¿™ç§ç»“æ„éå¸¸é‡è¦ã€‚*â€œ*â€å‰ç¼€å­—æ®µæ˜¯é‚£äº›è¢« docs_ æ ‡è®°ä¸ºå†…éƒ¨çš„å­—æ®µã€‚

åœ¨è¿›å…¥ RGB æ˜ å°„ä¹‹å‰ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨å¤§å°å­—æ®µæ¥æ£€æŸ¥è¿™æ˜¯å¦æœ‰æ•ˆ:

```
var surface = sdl_get_window_surface( window )
std.println(["surface ", surface.w, "x", surface.h]) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸€å¼€å§‹å¹¶ä¸æ˜¯ã€‚æˆ‘å¿˜è®°äº†`_flags`å­—æ®µï¼Œæ­£åœ¨è·å–éšæœºå€¼ã€‚ä¸€æ—¦ä¿®å¤ï¼Œæˆ‘å¯ä»¥ç»§ç»­åˆ›å»ºä¸€ä¸ªå½©è‰²çŸ©å½¢ã€‚

```
ignore sdl_fill_rect( surface, 0, sdl_map_rgb(surface.format, 0, 100, 0) )
ignore sdl_update_window_surface( window ) 
```

Enter fullscreen mode Exit fullscreen mode

> `ignore`æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæˆ‘å¿½ç•¥äº†è¿™äº›å‡½æ•°çš„è¿”å›å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒLeaf ä¸å…è®¸å¿½ç•¥å€¼ã€‚è¿™é‡Œçš„å½¢å¼ä¹Ÿä¸å¥½:æˆ‘åº”è¯¥æ£€æŸ¥è¿™äº›è¿”å›å€¼æ˜¯å¦æœ‰é”™è¯¯ã€‚

[![a green window](../Images/d96f3d1ff73c236648b998922f806457.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3Xg4clAl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://mortoray.files.wordpress.com/2018/02/sdl_window_green.png)

æˆ‘ä»¬çœ‹åˆ°äº†:ä¸€æ‰‡ç»¿è‰²çš„çª—æˆ·ï¼

> æ¥çœ‹çœ‹[çš„](http://leaflang.org) [SDL åˆ†åº—](https://code.launchpad.net/~eda-qa/leaflang/sdl)å’Œçš„å¶å­å§ã€‚æ¼”ç¤ºä»£ç æ˜¯ github ä¸Šçš„[ï¼Œè™½ç„¶æˆ‘ä¸èƒ½ä¿è¯å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆğŸ™ˆã€‚ä¸€å®šè¦è·Ÿç€æˆ‘ä¸€èµ·è·³](https://github.com/mortoray/leaf-algorithms/tree/master/sdl) [Twitch](https://www.twitch.tv/mortoray) ã€‚