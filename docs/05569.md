# Go æ•™ç¨‹:2ã€‚åˆ›å»º HTTP è¯·æ±‚å’ŒæœåŠ¡å™¨

> åŸæ–‡:[https://dev . to/coh hei/go-tutorial-2-create-an-http-request-and-server-1 h82](https://dev.to/cohhei/go-tutorial-2-create-an-http-request-and-server-1h82)

*æœ¬æ–‡æœ€åˆå‘è¡¨åœ¨ [GitHub](https://github.com/cohhei/go-to-the-handson) ä¸Šã€‚*

## [](#-raw-nathttp-endraw-package)`nat/http`åŒ…

### [](#create-a-request)åˆ›å»ºè¯·æ±‚

```
$ touch request.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// request.go
package main

import (
    "fmt"
    "io/ioutil"
    "net/http"
)

func main() {
    res, err := http.Get("https://api.github.com/users/defunkt")
    if err != nil {
        panic(err)
    }
    defer res.Body.Close()

    body, err := ioutil.ReadAll(res.Body)

    fmt.Println(string(body))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$  go  run  request.go  |  jq  {  "login":  "defunkt",  "id":  2,  "node_id":  "MDQ6VXNlcjI=",  "avatar_url":  "https://avatars0.githubusercontent.com/u/2?v=4",  "gravatar_id":  "",  "url":  "https://api.github.com/users/defunkt",  "html_url":  "https://github.com/defunkt",  "followers_url":  "https://api.github.com/users/defunkt/followers",  "following_url":  "https://api.github.com/users/defunkt/following{/other_user}",  "gists_url":  "https://api.github.com/users/defunkt/gists{/gist_id}",  "starred_url":  "https://api.github.com/users/defunkt/starred{/owner}{/repo}",  "subscriptions_url":  "https://api.github.com/users/defunkt/subscriptions",  "organizations_url":  "https://api.github.com/users/defunkt/orgs",  "repos_url":  "https://api.github.com/users/defunkt/repos",  "events_url":  "https://api.github.com/users/defunkt/events{/privacy}",  "received_events_url":  "https://api.github.com/users/defunkt/received_events",  "type":  "User",  "site_admin":  true,  "name":  "Chris Wanstrath",  "company":  "@github ",  "blog":  "http://chriswanstrath.com/",  "location":  "San Francisco",  "email":  null,  "hireable":  true,  "bio":  "ğŸ” ",  "public_repos":  107,  "public_gists":  273,  "followers":  20213,  "following":  210,  "created_at":  "2007-10-20T05:24:19Z",  "updated_at":  "2018-06-05T19:29:51Z"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#setup-a-server)è®¾ç½®æœåŠ¡å™¨

```
$ touch server.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// server.go
package main

import (
    "fmt"
    "log"
    "net/http"
)

func main() {
    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        fmt.Fprintf(w, "Hello, %q", r.URL.Path)
    })

    fmt.Println("http://localhost:8080")
    log.Fatal(http.ListenAndServe(":8080", nil))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$ go run server.go
http://localhost:8080
...

$ curl http://localhost:8080
Hello, "/" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#-raw-json-endraw-package)`json`åŒ…

```
$ touch json.go 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// json.go
package main

import (
    "encoding/json"
    "fmt"
)

func main() {
    str := []byte(`{"id":1,"name":"Gopher"}`)
    data := struct {
        ID   int    `json:"id"`
        Name string `json:"name"`
    }{}

    if err := json.Unmarshal(str, &data); err != nil {
        panic(data)
    }
    fmt.Println("ID: ", data.ID, "Name: ", data.Name)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
$ go run json.go
ID:  1 Name:  Gopher 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#exercise-21)ç»ƒä¹  2-1

åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åº`request.go`ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå¯¹[https://api.github.com/users/defunkt](https://api.github.com/users/defunkt)çš„`GET`è¯·æ±‚ï¼Œå¹¶è§£æåªæœ‰`json.Unmarshal``login`ã€`id`ã€`site_admin`å’Œ`bio`çš„å“åº”ä½“ã€‚

```
$ go run request.go
Login:  defunkt
ID:  2
SiteAdmin:  true Bio:  ğŸ” 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç­”æ¡ˆæ˜¯ [request.go](https://github.com/cohhei/go-to-the-handson/blob/master/02/main/request.go)

## [](#exercise-22)ç»ƒä¹  2-2

åˆ›å»ºä¸€ä¸ªæ„å»ºæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åº`server.go`ã€‚å®ƒæœ‰ä¸‰ä¸ªç«¯ç‚¹ï¼Œ`/`ã€`/json`å’Œ`/404`ã€‚`/`å½’æ¥`Hello, "/"`ã€‚`/json`è¿”å›`{"id":1,"name":"my_name","mail_address":""}`ã€‚`/404`è¿”å›å¸¦æœ‰ 404 çŠ¶æ€ä»£ç çš„`Not Found, /404`ã€‚

```
$ go run server.go
http://localhost:8080

$ curl http://localhost:8080/
Hello, "/"

$ curl http://localhost:8080/json
{"id":1,"name":"my_name","mail_address":""}

$ curl http://localhost:8080/404
Not Found, /404 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç­”æ¡ˆæ˜¯ [server.go](https://github.com/cohhei/go-to-the-handson/blob/master/02/main/server.go) ã€‚

[ä¸Šä¸€å¼ ](https://dev.to/cohhei/go-tutorial-1-command-line-arguments-and-file-io-3l9n) | [ä¸‹ä¸€å¼ ](https://dev.to/cohhei/3-connect-db-and-execute-queries-2aa8)