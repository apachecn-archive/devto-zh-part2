# 帮我决定:嵌入子文档还是有一个新的文档集？

> 原文:[https://dev . to/imthedeveloper/help-me-decide-embed-sub document-or-have-a-new-document-collection-5bg 2](https://dev.to/imthedeveloper/help-me-decide-embed-subdocument-or-have-a-new-document-collection-5bg2)

我最近在制作一个电报机器人，它有一个用户跟踪的元素，允许在我的聊天中加入白名单。我现在进入了建立声誉系统的领域。这将允许用户互相传递声誉，也许是通过一个命令，也许只是回复他们并说声谢谢。

我现在使用的是 neDB，它保存到本地文件系统，但是行为非常类似于 mongoDB，一个文档存储数据库。到目前为止，我已经为每种情况用简单的单个文档建模了用户、命令和其他对象。

在设计信誉系统时，我遇到了一个岔路口，我需要决定在用户文档中的什么地方使用子文档，或者创建一个新的信誉集合，它可能存储对我的用户的引用。

对信誉系统的大致要求是:

*   每个用户可以将信誉给予除他们自己以外的任何其他用户
*   每个用户每天最多有 10 点信誉点数
*   每个用户每天只能为同一个人添加 3 次信誉
*   声誉点每天都会重新生成(回到 10 点)
*   用户想知道谁给了他们最多的声誉
*   用户想知道谁最有声望
*   管理员可以逐步删除信誉点
*   管理员可以删除所有信誉点
*   用户希望看到他们拥有的信誉点数

还有一些其他要求，但这些是与我的问题最相关的。所以我一直在考虑用以下方法来做这件事:

1.  利用我的用户集合中的一个数组来存储给予声誉的人的 userID。然后，我可以检查数组长度以获得总信誉，并推送/弹出该数组以添加和删除信誉。我在这里关心的是数组可能永远增长，然后询问用户拉回一个带有大数组的对象是否有效？

2.  与上面类似，除了我持有一个数组和一个 reputation_count，这意味着我可以在执行查询时过滤掉大数组，并简单地从用户那里获取计数。如果我需要得到“用户想知道谁给了最多的声誉”，我也可以提取数组信息。再说一次，我还没有被说服。这是简单查询和大型数据检索之间的一个权衡。

3.  为信誉生成新的集合，这可以是每个用户 1 个信誉文档，具有与之前类似的阵列场景。

4.  为信誉生成一个新的集合，但是每个文档是 1 个信誉点，包含目标的用户 ID 和给予它的人的用户 ID。

5.  与 3 或 4 相同的场景，但也在用户文档级别保存一个信誉计数。这使我可以很容易地获得计数，但是如果我需要进一步的细节，可以查询信誉文档。

上面提到的都只是选项，因为我会根据情况减少我的查询次数。我宁愿做一次查询并获得我需要的数据，但同时，如果不需要，我也不想拉大文档。我认为需求中存在细微差别，这可能要求我无论做什么都要执行多个查询。我甚至还没有深入讨论关于一个用户在一天内可以给另一个用户信誉的最大次数的检查。

有什么办法解决这个问题吗？甚至可能只是在一个一般的层面上思考这些问题？