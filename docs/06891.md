# å°† Node.js API å®¹å™¨åŒ–&å°† Docker ä¸ Kubernetes å’Œ Minikube ä¸€èµ·ä½¿ç”¨

> åŸæ–‡:[https://dev.to/nickparsons/containerizing-a-nodejs-api-ä½¿ç”¨-docker-with-kubernetes-and-mini kube-16o 9](https://dev.to/nickparsons/containerizing-a-nodejs-api--using-docker-with-kubernetes-and-minikube-16o9)

[![](../Images/4ce65fcc668b1c441894f4e87e362693.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Gnz8E4de--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3qlr9tepvzqg3550p6w6.jpeg)

ä½œä¸º [Stream](https://getstream.io) çš„å¼€å‘è€…ä¼ é“è€…ï¼Œæˆ‘æœ‰æœºä¼šäº†è§£æˆ‘ä»¬çš„å·¥ç¨‹å›¢é˜Ÿå’Œå®¢æˆ·æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„å¤§é‡ä»¤äººæ•¬ç•çš„æ–°æŠ€æœ¯ã€‚å¯ä»¥å¸æ”¶çš„çŸ¥è¯†é‡ç»å¯¹æƒŠäººï¼Œæˆ‘å–œæ¬¢æŠ“ä½æ¯ä¸€ä¸ªæœºä¼šå­¦ä¹ æ‰€æœ‰çš„æ–°å…´å·¥å…·å’Œç©å…·ã€‚

æœ€è¿‘è°ˆè®ºæœ€å¤šçš„ç»„åˆä¹‹ä¸€æ˜¯ Docker å’Œ Kubernetesã€‚Docker å’Œ Kubernetes æ˜¯ä¸€ä¸ªå‘ç”µç«™ï¼Œå®ƒä½¿å¾—å¼€å‘èƒ½å¤Ÿåœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„å¿«é€Ÿã€ä¸å¯å˜çš„åº”ç”¨ç¨‹åºå˜å¾—éå¸¸å®¹æ˜“ï¼Œè€Œæ²¡æœ‰å¤„ç†åŒ…ç®¡ç†çš„æ‰€æœ‰éœ€æ±‚çš„æ‰€æœ‰éº»çƒ¦ã€‚Docker å°†ä»»ä½•ç»™å®šæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰éœ€æ±‚æ‰“åŒ…åˆ°æ‚¨çš„ Docker å®¹å™¨ä¸­ï¼Œé€šè¿‡å‡ ä¸ª Kubernetes å‘½ä»¤ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥æä¾›ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”å…·æœ‰ä¸å¯å˜çš„ podsï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª Kubernetes å‘½ä»¤éšæ—¶ç»ˆæ­¢å’Œå¯åŠ¨ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»æˆ‘å¦‚ä½•ç”¨ Docker å°è£…ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ Kubernetes å’Œ Minikube åœ¨æœ¬åœ°æä¾›å®ƒã€‚æœ€ç»ˆï¼Œä½ å°†è·å¾—è¶³å¤Ÿçš„çŸ¥è¯†å»åšåŒæ ·çš„äº‹æƒ…ï¼Œå¹¶æœ‰å¸Œæœ›é€šè¿‡åœ¨ Kubernetes çš„äº‘ä¸­å¯åŠ¨ä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œå°†å®ƒå¸¦åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚

# è¦æ±‚

å’Œä»»ä½•æ•™ç¨‹ä¸€æ ·ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€äº›è¦æ±‚æ¥å¸®åŠ©ä½ èµ°å‘æˆåŠŸï¼›æˆ‘ä»¬æƒ³ç¡®ä¿ä½ ï¼Œè¯»è€…ï¼Œèƒ½å¤Ÿè·Ÿä¸Šè€Œä¸ä¼šè¿·è·¯ğŸ˜‰ã€‚

è¿™ç¯‡æ–‡ç« æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒæ˜¯é¢å‘ macOS ç”¨æˆ·çš„ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Windows æˆ– Linuxï¼Œä½ ä»ç„¶å¯ä»¥è·Ÿç€åšï¼›ä½†æ˜¯ï¼Œæˆ‘çš„å‘½ä»¤å°†ä¸æ‚¨æƒ³è¦ä½¿ç”¨çš„å‘½ä»¤ç•¥æœ‰ä¸åŒã€‚

## ç¬¬ä¸€æ­¥:è‡ªåˆ¶

å¦‚æœä½ çš„ç”µè„‘ä¸Šæ²¡æœ‰å®‰è£…å®¶é…¿è½¯ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ https://brew.sh/ç½‘ç«™ä¸Šçš„å®‰è£…å‘½ä»¤æ¥å®‰è£…ã€‚

[![](../Images/c6c74f275071bd01a3397d853782eeb8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--uxSbJWR3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1l2xwgk9tqfpwdlthvug.png)

## ç¬¬äºŒæ­¥:Docker

è¦å®‰è£… Dockerï¼Œè¯·è¿›å…¥å…¥é—¨é¡µé¢ï¼Œç‚¹å‡»â€œMac ç‰ˆä¸‹è½½â€ã€‚æ‚¨å°†è¢«é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå¸æˆ·ã€‚

[![](../Images/00c227669f10fcf7f2370a8059774949.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wYHzoJFn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2l3bife2spvgprdxxngn.png)

## ç¬¬ä¸‰æ­¥:Minikube

æœ¬æ•™ç¨‹ä½¿ç”¨ Minikube åˆ›å»ºä¸€ä¸ªæœ¬åœ°é›†ç¾¤ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬å®‰è£… Minikube:

```
brew cask install minikube 
```

## [æ­¥éª¤ 4:è¶…é“¾æ¥](#step-4-hyperkit)

æŒ‰ç…§ [Minikube é©±åŠ¨ç¨‹åºå®‰è£…æŒ‡å—](https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#hyperkit-driver)æ‰€è¿°å®‰è£… HyperKit é©±åŠ¨ç¨‹åºã€‚æˆ–è€…ï¼Œè¿è¡Œè¿™ä¸ªå‘½ä»¤(å¦‚æœä½ åœ¨ macOS ä¸Š)æ¥å®‰è£… Hyperkit é©±åŠ¨ç¨‹åº:

```
curl -Lo docker-machine-driver-hyperkit https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-hyperkit \
&& chmod +x docker-machine-driver-hyperkit \
&& sudo cp docker-machine-driver-hyperkit /usr/local/bin/ \
&& rm docker-machine-driver-hyperkit \
&& sudo chown root:wheel /usr/local/bin/docker-machine-driver-hyperkit \
&& sudo chmod u+s /usr/local/bin/docker-machine-driver-hyperkit 
```

## æ­¥éª¤ 5:ä¸é—´æ–­ CLI

ä½¿ç”¨ Homebrew ä¸‹è½½ kubectl å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä¸ Kubernetes é›†ç¾¤è¿›è¡Œäº¤äº’:

```
brew install kubernetes-cli 
```

# å…‹éš†æ ·æ¿ Express APIğŸ’¾

ç°åœ¨æ‚¨å·²ç»å®Œæˆäº†å¯åŠ¨å’Œè¿è¡Œ Docker å’Œ Kubernetes çš„æ­¥éª¤ï¼Œè®©æˆ‘ä»¬ç»§ç»­ä¸‹è½½æˆ‘æ•´ç†çš„æ ·æ¿ Express APIã€‚æ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å‘½ä»¤ï¼Œä½†æ˜¯ï¼Œæˆ‘å»ºè®®æ‚¨é¦–å…ˆå°è¯•ä¸€ä¸‹ï¼Œç›´åˆ°æ‚¨æŒæ¡äº†æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„å‘½ä»¤ã€‚

## å‰å¾€ä½ æƒ³è¦å­˜å‚¨ä»£ç çš„ç›®å½•ã€‚ç„¶åç»§ç»­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å­˜å‚¨åº“å…‹éš†åˆ°æ‚¨çš„ç›®å½•ä¸­:

```
git clone git@github.com:nparsons08/boilerplate-express-api.git api 
```

> æ³¨:å¦‚æœä½ æƒ³å…ˆçœ‹çœ‹å›è´­ï¼Œ[ç‚¹å‡»è¿™é‡Œ](https://github.com/nparsons08/boilerplate-express-api)ã€‚

## æ¥ä¸‹æ¥ï¼Œè¿›å…¥ç›®å½•ï¼Œæ„å»º API å¹¶å¯åŠ¨å®ƒè¿›è¡Œæµ‹è¯•:

```
cd api && yarn build && yarn start 
```

## API ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸æ­¤ç±»ä¼¼çš„å†…å®¹:

[![](../Images/50f31d9c8364cef3112afa8dadba5e36.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--LZRMTjYd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vm51r7a7dg0duqmi0zyv.png)

# ç”¨ Docker å®¹å™¨åŒ– APIğŸ“¦

æˆ‘æ‰¿è®¤ï¼Œå½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ° Docker çš„æ—¶å€™ï¼Œæˆ‘æœ‰ç‚¹å®³æ€•ã€‚è¿™ä¸ªæ¦‚å¿µå¯¹æˆ‘æ¥è¯´æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå‘½ä»¤çœ‹èµ·æ¥å®Œå…¨é™Œç”Ÿã€‚ç„¶è€Œï¼Œåœ¨é˜…è¯»å’Œç ”ç©¶äº†ä¸€äº›æ–‡æ¡£ä¹‹åï¼Œæˆ‘å¼€å§‹ç†è§£ä½¿ç”¨ Docker çš„åŸºæœ¬åŸç†â€”â€”ä½ ä¹Ÿä¼šç†è§£çš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ä¿æŒäº‹æƒ…ç®€å•ï¼›åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¿›ï¼Œè®©äº‹æƒ…æ›´ä¸Šä¸€å±‚æ¥¼ğŸ˜€ã€‚

> æ³¨æ„:æ‰€æœ‰å‘½ä»¤éƒ½åº”è¯¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œã€‚

## ç¬¬ä¸€æ­¥:äº†è§£ Dockerfile(ç›®å½•ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªæ¨¡æ¿):

```
# use latest version of node
FROM mhart/alpine-node:latest

# set working directory
WORKDIR /dist

# bundle source code
COPY . .

# expose port 3000
EXPOSE 3000

# start app with yarn
CMD ["yarn", "start"] 
```

## ç¬¬äºŒæ­¥:æ„å»º Docker é•œåƒ:

```
docker build -t boilerplate-api/api . 
```

## ç¬¬ä¸‰æ­¥:åˆ—å‡ºæ‰€æœ‰ Docker å›¾ç‰‡(éªŒè¯æ‚¨çš„å›¾ç‰‡æ˜¯å¦å­˜åœ¨):

```
# list all docker images
docker images 
```

## ç¬¬å››æ­¥:è¿è¡Œ Docker é•œåƒ:

```
# run the docker image
docker run -p 8080:3000 -d boilerplate-api/api 
```

## ç¬¬äº”æ­¥:æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ API:

```
# open in browser
open http://localhost:8080 
```

ç¹è£ğŸ’¥ï¼æ‚¨åˆšåˆšä½¿ç”¨ Docker å¯åŠ¨äº† APIï¼ç°åœ¨è®©æˆ‘ä»¬æŠŠå®ƒæ‹†äº†ï¼Œå› ä¸ºå‡ åˆ†é’Ÿåæˆ‘ä»¬å°†ä½¿ç”¨ Kubernetes å’Œ Minikube æ¥å¯åŠ¨ Docker å®¹å™¨ã€‚

## ç¬¬å…­æ­¥:æ‹†æ‰:

```
# stop all containers
docker stop $(docker ps -a -q)

# destroy all containers
docker rm $(docker ps -a -q)

# destroy all images
docker rmi $(docker images -q) 
```

# è¸å…¥è¿·ä½ åº“è´&åº“è´å†…æ–¯çš„åœŸåœ°ğŸ‘£

Minikube æ˜¯ä¸€ä¸ªè®©æœ¬åœ°è¿è¡Œ Kubernetes å˜å¾—å®¹æ˜“çš„å·¥å…·ã€‚Minikube åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„è™šæ‹Ÿæœºä¸­è¿è¡Œå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ã€‚

## è®¾ç½® Minikube

é€šè¿‡æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®å®šä½ æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®åƒ https://cloud.google.com/container-registry/è¿™æ ·çš„ç½‘ç«™ï¼Œè€Œä¸éœ€è¦ä»£ç†æœåŠ¡å™¨:

```
# check that you have access to google's container registry
curl --proxy "" https://cloud.google.com/container-registry/ 
```

> æ³¨æ„:å¦‚æœè¿™ä¸ª cURL å‘½ä»¤ä¸èµ·ä½œç”¨ï¼Œè¯·åœæ­¢å¹¶å°è¯•è§£å†³é—®é¢˜ã€‚å¦‚æœä¸èƒ½è®¿é—®å¤–éƒ¨äº’è”ç½‘ï¼ŒMinikube å°†æ— æ³•æ­£å¸¸å¯åŠ¨(å¯¹äºæœ¬æ•™ç¨‹)ã€‚

cURL å‘½ä»¤åº”è¯¥ä¼šé€€å›ä¸€å †ç±»ä¼¼å¦‚ä¸‹çš„ HTML:

[![](../Images/552911b9716279348603820cf55b86c7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tfhpZ7bo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6e3vzebpehnilo2sccm0.png)

> æ³¨æ„:å¦‚æœæ‚¨æ— æ³•è®¿é—® Google å®¹å™¨æ³¨å†Œè¡¨ï¼Œåˆ™æ‚¨çš„è¿æ¥æœ‰é—®é¢˜ã€‚åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œæ‚¨éœ€è¦å¯¹æ­¤è¿›è¡Œè°ƒè¯•ã€‚

æ¥ä¸‹æ¥ï¼Œç¡®ä¿ Docker å®ˆæŠ¤è¿›ç¨‹å·²ç»å¯åŠ¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥ç¡®å®š docker æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œä¾‹å¦‚:

```
# quick check if docker is running
docker images 
```

> æ³¨æ„:å¦‚æœå‘½ä»¤æˆåŠŸï¼Œæ‚¨åº”è¯¥åœ¨ç»ˆç«¯ä¸­çœ‹åˆ° Docker å›¾åƒåˆ—è¡¨ã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œä½ éœ€è¦è°ƒè¯•ä¸ºä»€ä¹ˆ Docker æ²¡æœ‰åœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œã€‚

ç°åœ¨æ‚¨å·²ç»éªŒè¯äº† Docker æ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ä¸€ä¸ª Minikube è¿›ç¨‹:

```
# start minikube with kyperkit specified
minikube start --vm-driver=hyperkit 
```

> æ³¨æ„:`--vm-driver=hyperkit`æ ‡å¿—æŒ‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨ macOS çš„ Dockerã€‚é»˜è®¤çš„ VM é©±åŠ¨å®é™…ä¸Šæ˜¯ VirtualBoxï¼Œä½†åœ¨ macOS ä¸Šé¦–é€‰ HyperKitã€‚

å¦‚æœæˆåŠŸï¼Œæ‚¨çš„ç»ˆç«¯çœ‹èµ·æ¥å°†å®Œå…¨åƒè¿™æ ·:

[![](../Images/7faa59fed2e42df2ff28fd7a8a28f831.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--us7KUVCV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ywmjkt274rh37dczdiim.png)

ç°åœ¨è®¾ç½® Minikube ä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡å†³å®šäº†ä¸å“ªä¸ªé›†ç¾¤`kubectl`è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åšåˆ°è¿™ä¸€ç‚¹:

```
# specify context
kubectl config use-context minikube 
```

éªŒè¯`kubectl`æ˜¯å¦é…ç½®ä¸ºä¸æ‚¨çš„é›†ç¾¤:
é€šä¿¡

```
# get cluster info
kubectl cluster-info 
```

# å¯åŠ¨ Minikube ä»ªè¡¨ç›˜

> æ³¨æ„:Minikube é™„å¸¦äº†ä¸€ä¸ªä»ªè¡¨ç›˜ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ­£åœ¨å‘ç”Ÿçš„ä¸€åˆ‡ï¼

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹å¯åŠ¨ä»ªè¡¨æ¿å§ï¼

```
# start minikube dashboard
minikube dashboard 
```

[![](../Images/7fa7b3aa405332e42c80782ff57e0434.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7w10P-KY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vpjvsuxplhwyhkso7dr7.png)

å¥½å§ï¼Œä½ å·²ç»èµ°åˆ°è¿™ä¸€æ­¥äº†ã€‚æˆ‘ä»¬ç»§ç»­å§ï¼

## åˆ›å»ºä¸€ä¸ª Docker å›¾åƒ

ä¸ºäº†ç®€å•èµ·è§ï¼Œè®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬åœ¨æœ¬æ–‡å‰é¢ä½¿ç”¨çš„æ ·æ¿ APIã€‚

å› ä¸ºæœ¬æ•™ç¨‹ä½¿ç”¨ Minikubeï¼Œè€Œä¸æ˜¯å°† Docker æ˜ åƒæ¨é€åˆ°æ³¨å†Œè¡¨ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ä½¿ç”¨ä¸ Minikube VM ç›¸åŒçš„ Docker ä¸»æœºæ¥æ„å»ºæ˜ åƒï¼Œè¿™æ ·æ˜ åƒå°±ä¼šè‡ªåŠ¨å‡ºç°ã€‚ä¸ºæ­¤ï¼Œè¯·ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯ Minikube Docker å®ˆæŠ¤è¿›ç¨‹:

```
# set the docker daemon to minikube
eval $(minikube docker-env) 
```

ç°åœ¨æˆ‘ä»¬çš„å®ˆæŠ¤è¿›ç¨‹å·²ç»ä¸º Docker è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ›å»º Docker æ˜ åƒã€‚è½¬åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„`/api`ç›®å½•ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤:

```
# build docker image
docker build -t api:v1 . 
```

> æ³¨æ„:ç°åœ¨ Minikube VM å¯ä»¥è¿è¡Œæ‚¨æ„å»ºçš„æ˜ åƒäº†ã€‚

è¯¥å‘½ä»¤çš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

[![](../Images/9a22b10fc6b1655161199efff23c757a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fGjhLLMn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fds37ewg68j66ijzky8q.png)

# åˆ›å»ºä¸€ä¸ª Kubernetes éƒ¨ç½²ğŸ’»

Minikube æ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬çš„ Docker æ˜ åƒå·²ç»åˆ›å»ºï¼Œä¸€åˆ‡è¿›å±•é¡ºåˆ©ã€‚è®©æˆ‘ä»¬å¿«é€Ÿè®¨è®ºä¸€ä¸‹ Kubernetes éƒ¨ç½²çš„ç»“æ„ã€‚

Kubernetes [Pod](https://kubernetes.io/docs/concepts/workloads/pods/pod/) æ˜¯ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œä¸ºäº†ç®¡ç†å’Œè”ç½‘è€Œè¿æ¥åœ¨ä¸€èµ·ã€‚æœ¬æ•™ç¨‹ä¸­çš„ Pod åªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚Kubernetes [éƒ¨ç½²](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)æ£€æŸ¥ä½ çš„ Pod çš„å¥åº·çŠ¶å†µï¼Œå¦‚æœå®ƒç»ˆæ­¢ï¼Œé‡å¯ Pod çš„å®¹å™¨ã€‚éƒ¨ç½²æ˜¯ç®¡ç† pod çš„åˆ›å»ºå’Œæ‰©å±•çš„æ¨èæ–¹å¼ã€‚

ä½¿ç”¨ kubectl run å‘½ä»¤åˆ›å»ºä¸€ä¸ªç®¡ç† Pod çš„éƒ¨ç½²ã€‚Pod è¿è¡Œä¸€ä¸ªåŸºäºæ‚¨çš„`api:v1` Docker å›¾åƒçš„å®¹å™¨ã€‚å°†`--image-pull-policy`æ ‡å¿—è®¾ç½®ä¸º`Never`ï¼Œä»¥ä¾¿æ€»æ˜¯ä½¿ç”¨æœ¬åœ°å›¾åƒï¼Œè€Œä¸æ˜¯ä» Docker æ³¨å†Œè¡¨ä¸­æå–å›¾åƒ(å› ä¸ºæ‚¨è¿˜æ²¡æœ‰å°†å®ƒæ¨åˆ°é‚£é‡Œ):

```
# create a kubernetes deployment
kubectl run api --image=api:v1 --port=8080 --image-pull-policy=Never 
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹éƒ¨ç½²:

```
# get kubernetes deployments
kubectl get deployments 
```

è€Œä¸”ï¼Œå¦‚æœæ‚¨è®¿é—®æ‚¨çš„ä»ªè¡¨æ¿(åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œ minikube dashboard å‘½ä»¤)ï¼Œæ‚¨ä¼šçœ‹åˆ°ç»¿è‰²ï¼

[![](../Images/49980a032ff2137ccd34f8614ac2ee63.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--DeC2LaUZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tr4vdurfsbeccqcdb9sy.png)

ä½ ç”šè‡³å¯ä»¥åœ¨ [http://localhost:8080](http://localhost:8080) è®¿é—® APIï¼

> æ³¨æ„:å½“æ‚¨ä¸æƒ³å†ä½¿ç”¨ Minikube ä¸»æœºæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ`eval $(minikube docker-env -u)`æ¥æ’¤é”€æ­¤æ›´æ”¹ã€‚

# æ­å–œæ­å–œï¼ğŸ‰

æ­å–œä½ ï¼æ‚¨åˆšåˆšç”¨ Docker å°è£…äº†ä¸€ä¸ª APIï¼Œå¯åŠ¨äº† Minikubeï¼Œå¹¶åœ¨æœ¬åœ°æœºå™¨ä¸Šå°† Docker æ˜ åƒéƒ¨ç½²åˆ° Kubernetesã€‚

å¹²å¾—å¥½ï¼åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å°è£…å’Œè¿è¡Œä¸€ä¸ªæ— çŠ¶æ€ä½†éœ€è¦è®¿é—®å¤–éƒ¨æœåŠ¡(å¦‚ Streamã€MongoDBã€Redis ç­‰)çš„åº”ç”¨ç¨‹åºã€‚

åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘æ¨èä»¥ä¸‹æ–‡ç« æ¥æé«˜ä½ çš„æŠ€èƒ½:

*   [Docker å…¥é—¨](https://docs.docker.com/get-started/)
*   [Kubernetes åŸºç¡€çŸ¥è¯†](https://kubernetes.io/docs/tutorials/kubernetes-basics/)
*   [Docker æœ€ä½³å®è·µ](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
*   [Kubernetes æœ€ä½³å®è·µ](https://kubernetes.io/docs/concepts/configuration/overview/)

ç¼–ç å¿«ä¹ï¼ğŸ‘