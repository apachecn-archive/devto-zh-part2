# 单元测试。域中的逻辑与 SQL 中的逻辑

> 原文:[https://dev . to/jad jare/unit-testing-logic-in-domain-vs-logic-in-SQL-ph8](https://dev.to/jadjare/unit-testing-logic-in-domain-vs-logic-in-sql--ph8)

# [](#unit-testing-logic-in-domain-vs-logic-in-sql)单元测试。域中的逻辑与 SQL 中的逻辑

我们有一个包含 1000 万条记录的表，其中包括位置、产品、订购日期和订购数量的详细信息。

我们需要查询该数据，以找到给定位置集的产品订购量总和。
我们必须应用一个业务规则，即如果订单日期是过去的 N 天，那么订购的单位被分类为`late units`，否则它们被分类为`pending units`。

此信息将显示在“阅读”表(即屏幕报告)中
|产品|延迟单位|待定单位|

我们当前的设计是有一个 SQL 查询，该查询被传递的日期是订购单位应该被分类为`late units`的日期。然后在 SQL 存储过程中应用聚合数据并将单元置于“延迟”或“挂起”状态的逻辑。
然后，查询结果被放入数据传输对象(例如`{"product": "a", "lateUnits": 0, "pendingUnits": 100}`)中，并通过 Web Api 提供给客户端应用。

这种设计的挑战是，编写一套单元测试来证明业务规则被正确应用变得更加困难。目前，我们已经创建了封装的集成测试数据，然后我们启动数据库的一个特殊的集成测试实例，并针对样本数据运行测试。

这允许我们利用 SQL 查询引擎来提高性能，同时具有合理的测试覆盖率。

我仍然不是 100%确信我们正在采取的方法，并且想知道其他开发人员可能会采取什么方法来解决这个问题，例如，您会将所有数据加载到域中并在那里应用逻辑，在 SQL 中应用逻辑，还是其他方法？