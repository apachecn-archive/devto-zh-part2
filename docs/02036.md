# 解析桥支持模式文件

> 原文:[https://dev . to/progrium/parsing-bridge support-schema-files-25me](https://dev.to/progrium/parsing-bridgesupport-schema-files-25me)

周二，我开始了为 AppKit 开发 Go API 的艰巨工作，app kit 是苹果开发应用程序的框架。随着核心桥的工作，我希望为所有的苹果 API 提供本地绑定。他们有很多！

幸运的是，正如我前面提到的，每个框架都有一个巨大的 XML 文件来描述 API 的每个部分。它们专门用于生成绑定和/或头文件。所以第一步是将它们解析成 Go 结构。

尽管没有很好的文档记录，Go 对将 XML 解析成结构有惊人的支持。您只需布置数据类型，并使用 struct 标记映射它们。有一些关于这些 XML 文件结构的文档，但是我也只是引用了一些文件来弄清楚数据模型。

有一个转折。当模式需要讨论任何值或变量的特定数据类型时，它们被编码成这些奇怪的字符串。幸运的是，这些是...大部分记录在案。我不得不四处寻找为什么非正式协议上的方法有一些我可以忽略的额外数字，有几个例子我不知道它们是什么。

最重要的是，它们被编码成一种奇怪的字符串编码，其中大多数类型被表示为单个字符，但少数像位域掩码和指针这样的类型有额外的信息，像结构和数组这样的复合类型当然是更复杂的结构。我花了一段时间才明白应该如何解析这些。我最后使用了`bufio.Scanner`，这是一种可编程的记号赋予器，可以用来相对容易地组合成一个词法分析器。经过一系列的实验，我得到了一个似乎可以工作的系统，并且我可以在遇到特定的场景时进行扩展和定制。我用它来创建一个`TypeInfo`结构，它有一个更友好的类型数据表示。

最棒的是，我可以让 XML 解析器自动将这些编码字段解组为 TypeInfo 类型。这样的例子不多，但是可以做到，而且效果很好。此时，我可以正确地解析几个 XML 文件，尽管有很多漏洞，但这足以开始生成一些 Go 绑定。下周！

[https://www.youtube.com/embed/xui7cNeMwZ0](https://www.youtube.com/embed/xui7cNeMwZ0)