# å¿«é€Ÿæç¤º:å¦‚ä½•å‘å‡º HTTP è¯·æ±‚(Dart)

> åŸæ–‡:[https://dev . to/graphic beacon/quick-tip-how-to-make-http-requests-dart-56dd](https://dev.to/graphicbeacon/quick-tip-how-to-make-http-requests-dart-56dd)

æ„å»ºä»å…¶ä»– web åº”ç”¨ç¨‹åºè·å–æ•°æ®çš„ web åº”ç”¨ç¨‹åºæ˜¯å¾ˆå¸¸è§çš„ï¼Œè¿™æ˜¯ç”±å¯¹ç¬¬ä¸‰æ–¹æœåŠ¡æ‰§è¡Œ HTTP è°ƒç”¨çš„é€»è¾‘å¯åŠ¨çš„ã€‚

åœ¨ä»Šå¤©çš„å¿«é€ŸæŠ€å·§ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å†…ç½®çš„`HttpClient`å’Œ`HttpRequest`ç±»å¯¹å¤–éƒ¨æœåŠ¡è¿›è¡Œ HTTP è°ƒç”¨ã€‚è¿™äº›ç±»åˆ†åˆ«åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¸Šä½¿ç”¨ã€‚

* * *

## [æœåŠ¡å™¨ä¸Šçš„](#on-the-server)

Dart åœ¨ **dart:io** åº“ä¸­æä¾›äº†ç”¨äºè¿›è¡Œ HTTP è°ƒç”¨çš„`HttpClient`ç±»ã€‚ä¸‹é¢æ˜¯å®ƒçš„ä¸€ä¸ªä¾‹å­:

```
import 'dart:io';
import 'dart:convert';

void main() {
  HttpClient()
    .getUrl(Uri.parse('https://swapi.co/api/people/1')) // produces a request object
    .then((request) => request.close()) // sends the request
    .then((response) => response.transform(Utf8Decoder()).listen(print)); // transforms and prints the response
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿è¡Œè¿™ä¸ªæ–‡ä»¶å°†ä¼šå¾—åˆ°ä¸‹é¢çš„ JSON å“åº”:

```
{"name":"Luke Skywalker","height":"172","mass":"77","hair_color":"blond","skin_color":"fair","eye_color":"blue","birth_year":"19BBY","gender":"male","homeworld":"https://swapi.co/api/planets/1/","films":["https://swapi.co/api/films/2/","https://swapi.co/api/films/6/","https://swapi.co/api/films/3/","https://swapi.co/api/films/1/","https://swapi.co/api/films/7/"],"species":["https://swapi.co/api/species/1/"],"vehicles":["https://swapi.co/api/vehicles/14/","https://swapi.co/api/vehicles/30/"],"starships":["https://swapi.co/api/starships/12/","https://swapi.co/api/starships/22/"],"created":"2014-12-09T13:50:51.644000Z","edited":"2014-12-20T21:17:56.891000Z","url":"https://swapi.co/api/people/1/"} 
```

Enter fullscreen mode Exit fullscreen mode

è¿˜æœ‰æ›´æ¼‚äº®çš„**å¼‚æ­¥/ç­‰å¾…**ç‰ˆæœ¬:

```
import 'dart:io';
import 'dart:convert';

void main() async {
  var request = await HttpClient().getUrl(Uri.parse('https://swapi.co/api/people/1')); // produces a request object
  var response = await request.close(); // sends the request

  // transforms and prints the response
  await for (var contents in response.transform(Utf8Decoder())) {
    print(contents);
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ˜¯æˆ‘ä¹‹å‰åšçš„ä¸€ä¸ªè§†é¢‘:

[https://www.youtube.com/embed/Sz2JbmRKxY8](https://www.youtube.com/embed/Sz2JbmRKxY8)

## [å®¢æˆ·ç«¯ä¸Šçš„](#on-the-client)

Dart åœ¨ **dart:html** åº“:
ä¸­æä¾›äº†`HttpRequest`ç±»

```
import 'dart:html';

void main() {
  HttpRequest.getString('https://swapi.co/api/people/1')
    .then(print);
} 
```

Enter fullscreen mode Exit fullscreen mode

ä¸**å¼‚æ­¥/ç­‰å¾…** :

```
import 'dart:html';

void main() async {
  print(await HttpRequest.getString('https://swapi.co/api/people/1'));
} 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨[çš„é•–é¶](https://dartpad.dartlang.org)ä¸Šè¯•è¯•è¿™ä¸ªç‰‡æ®µã€‚

## æ›´æ–°æ—¶é—´:2018-06-10

æˆ‘çš„ä¸€ä¸ªåª’ä½“è¯»è€…æƒ³çŸ¥é“å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸Šå‘å¸ƒè¯·æ±‚ã€‚è§‰å¾—åœ¨è¿™é‡Œå¾—åˆ°æˆ‘çš„ç­”æ¡ˆä¹Ÿå¾ˆæœ‰ç”¨:

æ‚¨å¯ä»¥ä½¿ç”¨`postFormData`é™æ€æ–¹æ³•:
å‘å‡º POST è¯·æ±‚

```
var data = { 'firstName' : 'John', 'lastName' : 'Doe' };
HttpRequest.postFormData('/send', data).then((HttpRequest resp) {
  // Do something with the response.
}); 
```

Enter fullscreen mode Exit fullscreen mode

é»˜è®¤æƒ…å†µä¸‹,`Content-Type`å¤´å°†è¢«è®¾ç½®ä¸º`Content-Type: application/x-www-form-urlencoded; charset=UTF-8`,é™¤éæ‚¨å¸Œæœ›æœ‰æ•ˆè´Ÿè½½è¢«è§†ä¸ºä¸€ä¸ª JSON å¯¹è±¡:

```
import 'dart:html';
import 'dart:convert';

void main() {
  var data = { 'title' : 'My first post' };
  HttpRequest.request(
    'https://jsonplaceholder.typicode.com/posts',
    method: 'POST',
    sendData: json.encode(data),
    requestHeaders: {
      'Content-Type': 'application/json; charset=UTF-8'
    }
  )
  .then((resp) {
    print(resp.responseUrl);
    print(resp.responseText);           
  });
}

// Response
// https://jsonplaceholder.typicode.com/posts
// { "title": "My first post", "id": "101" } 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨[çš„é•–é¶](https://dartpad.dartlang.org)ä¸Šè¯•è¯•è¿™ä¸ªç‰‡æ®µã€‚

ä¸ºäº†ç»™å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„è¯·æ±‚æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆï¼ŒDart å›¢é˜Ÿåˆ›å»ºäº†ä¼˜ç§€çš„ [HTTP åŒ…](https://pub.dartlang.org/packages/http)ï¼Œç°åœ¨å¯ä»¥åœ¨ Pub ä¸Šè·å¾—ã€‚

* * *

ä»Šå¤©çš„å¿«é€Ÿæç¤ºå°±åˆ°è¿™é‡Œã€‚æŸ¥çœ‹ä¸‹é¢çš„æ–‡æ¡£é“¾æ¥ï¼Œäº†è§£å¦‚ä½•æ‰§è¡Œå…¶ä»–ç±»å‹çš„è¯·æ±‚ã€‚

**å–œæ¬¢ã€åˆ†äº«å¹¶å…³æ³¨æˆ‘**äº†è§£ Dart çš„æ›´å¤šå†…å®¹ã€‚

## äº†è§£æ›´å¤š

1.  [HttpClient ç±»](https://api.dartlang.org/stable/2.0.0/dart-io/HttpClient-class.html)
2.  [HttpRequest ç±»](https://api.dartlang.org/stable/2.0.0/dart-html/HttpRequest-class.html)
3.  [åŠ¨æ€è·å–æ•°æ®-å®¢æˆ·ç«¯](https://webdev.dartlang.org/tutorials/get-data/fetch-data)

***æœ€åä¸€ä¸ª**...æˆ‘æƒ³æ„Ÿè°¢å¤§å®¶å¯¹æˆ‘çš„â€œDarticlesâ€çš„ç§¯æåé¦ˆ*ğŸ¤“ã€‚*æˆ‘å¾—åˆ°äº†è¶Šæ¥è¶Šå¤šçš„æ”¯æŒ* â­ *è¿™çœŸçš„æ„å‘³ç€å¾ˆå¤šï¼Œæˆ‘å¾ˆé«˜å…´çœ‹åˆ° Dart ç¤¾åŒºçš„æˆé•¿ï¼Œå› ä¸ºæœ‰äº†åƒ* [Flutter](https://flutter.io) *å’Œ* [Aqueduct](https://aqueduct.io) è¿™æ ·çš„åˆ›æ–°ã€‚