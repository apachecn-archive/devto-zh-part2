# 弹性研究和困难

> 原文：<https://dev.to/rohithmenon89/elasticsearches-and-the-hardships-4hcc>

我一直在一个 CRM 行业做后端开发，这个行业的核心就是搜索:)。是的，你是正确的，它是一个有许多数据表列的系统。所以选择支持这种高度可定制的搜索的后端框架是集成了 spring 的 Java。是的，你的想法是对的，我们选择 Elasticsearch 作为我们的数据存储。一如往常，有支持票也有反对票，但最终这是一个正确的决定。那是四年前，最新的稳定版是 1.7。哎呀完全忘了，我来说一点 ES 吧。

ES 是一个基于 Lucene 的开源搜索引擎。当然，这不是一个主要的数据存储，但是对于到处都有搜索的系统来说是非常有效的。ES 很容易扩展。Elasticsearch 在文件[中存储关于 index 的元数据信息(把这个当做 SQL 中的一个表)和其他数据信息，在 ES](https://www.elastic.co/blog/found-dive-into-elasticsearch-storage) 中是如何存储的。节点只不过是你的服务器，它们可以一起被称为一个集群。节点有助于保存数据的副本。ES 以 JSON 的形式保存数据，并且特别遵循所谓的 JSON 法则。如果你想了解更多关于 ES 术语[的基础知识，请访问这里。](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/_basic_concepts.html)

让我们回到我实际上应该说的话题上来。维护 ES 真的很辛苦，成本也很高。我的意思是，由于大多数初创公司没有所谓的 DevOps 自动扩展机制和很酷的东西，随着数据的增加，我们需要启动机器或节点来保持 es 稳定。否则会看到“堆空间错误”，因为这完全是用 JAVA 构建的，是的，Java 开发人员会喜欢这个错误:)。

### 真正的开发者困难

1.  欢迎来到索引的真实世界。在 elasticsearch 中，你总是会听到索引。索引只不过是将所有数据写入 ES。索引也是系统中的创建/更新操作。有一些索引策略，应该在 es 中仔细配置。这意味着读/写繁重的系统应该在 ES 中进行适当的配置。索引会像印度人吃辣一样吃掉你的系统内存(我就是喜欢)。完全索引应该在高峰时间小心地执行，因为它是一个繁重的操作。
2.  1.7 版本没有父子关系。是的，在以后的版本中，您可以在 es 中维护索引之间的关系。我们是如何解决的？我们还必须将子 JSON 数据存储在父 JSON 中。这有点重复，因为我们为子数据建立了单独的索引，但仍然需要保存在父索引中。那么问题可能是为什么在父索引中？因为系统搜索通过筛选子数据在父页面中进行。另一种方法是将每个索引中的查询分开，然后将它们链接在一起。但是，分页需要定制，你的 [MVP](https://en.wikipedia.org/wiki/Minimum_viable_product) 模型策略将不起作用(由于各种问题，不能很快发布)。
3.  Awwww 然后来到字段分析器和索引分析器。谁说是的很容易，去他妈的。不，我只是在开玩笑。但是我们在元数据的配置上遇到了困难。因此，在 ES 中，数据存储要么分析它们，要么不分析它们。例如，如果您想要一个支持搜索字段的通配符，您需要将它们存储在小写字符串中。如果你想让搜索和空格一起工作，那么你需要一些其他的分析器，这样的例子不胜枚举。最糟糕的是你不能直接在现有的索引中改变它，你只能把它添加到新的索引中。所以我们需要重新索引数据。
4.  假设你的客户想出了新点子。他们希望搜索特殊字符，现在您需要创建特殊的分析器并将其添加到您的元数据中。是的，您可以关闭索引并添加它。但是如果您想要在任何字段中指定新创建的分析器，那么您不能这样做。再次回到第一步，创建新的索引并重新索引数据。
5.  现在为什么我不能先用 analyzer 本身存储每个字段。您不应该这样做，因为在使用分析器的字段中，搜索和索引将花费更多的时间。因此，在将分析器分配给字段时一定要小心。
6.  聚合是专家系统最好的部分。Group by 是我能找到的最好的同义词。人们喜欢在 ES 中做聚合。是的，但它甚至可以破坏系统。因为，在 ES 上非常繁重的操作会消耗大量 RAM。应该小心建造和使用。现在大多数推荐系统更喜欢用这个。
7.  Elasticdump 是平滑发布和重新索引的最好的库。我记得一个月至少用 3 次。
8.  更喜欢查询生成器，而不是过滤器。过滤器仅在从节点获取数据后应用。是的，你说得对，这很费时间。

### 结论

尽快升级到最新版本。你越早升级，你的发布过程就会越好越快。尽管发生了所有这些问题，我还是喜欢和 es 一起工作，并且仍然喜欢同样的工作。