# Next.js +æ ·å¼åŒ–ç»„ä»¶çœŸæ­£ç®€å•çš„æŒ‡å—â–² +ğŸ’…

> åŸæ–‡:[https://dev.to/aprietof/nextjs é£æ ¼-ç»„ä»¶-çœŸæ­£ç®€å•-æŒ‡å—- 101c](https://dev.to/aprietof/nextjs--styled-components-the-really-simple-guide----101c)

æˆ‘æœ€è¿‘å¼€å§‹ä½¿ç”¨ [Next.js](https://nextjs.org/) ï¼Œè€å®è¯´ï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œä½ å¯ä»¥ä»ç›’å­é‡Œå¾—åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œè™½ç„¶æœ‰äº›ä¸œè¥¿æˆ‘ä¸å¤ªåŒæ„ï¼Œä½†æ€»ä½“æ¥è¯´ï¼Œå®ƒä½¿åˆ›å»ºé™æ€å’ŒæœåŠ¡å™¨æ¸²æŸ“çš„åº”ç”¨ç¨‹åºå˜å¾—éå¸¸ç®€å•ã€‚

æ¥ä¸‹æ¥æ†ç»‘äº† [styled-jsx](https://github.com/zeit/styled-jsx) ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€æœ‰ä½œç”¨åŸŸçš„ã€ç»„ä»¶å‹å¥½çš„ CSS æ”¯æŒ jsx(å‘ˆç°åœ¨æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¸Š)ï¼Œè™½ç„¶è¿™å¾ˆæ£’ï¼Œä½†æˆ‘å®æ„¿ä½¿ç”¨æ ·å¼åŒ–çš„ç»„ä»¶ï¼Œè¿™åªæ˜¯æˆ‘çš„åå¥½ã€‚

æœ¬æŒ‡å—ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ä¸åŒäº [styled-jsx](https://github.com/zeit/styled-jsx) çš„æ ·å¼è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¹Ÿæ”¯æŒé€šç”¨æ ·å¼ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ HTML ä¸­ä¸ºç¬¬ä¸€æ¬¡å‘ˆç°æä¾›æ‰€éœ€çš„æ ·å¼ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯åŠ è½½å…¶ä½™çš„æ ·å¼ã€‚

Next.js æœ‰ä¸€ä¸ªå·²ç»å¸¦æœ‰æ ·å¼åŒ–ç»„ä»¶çš„[ç¤ºä¾‹ repo](https://github.com/zeit/next.js/tree/canary/examples/with-styled-components) ,ä½†æ˜¯ä½ éœ€è¦å…‹éš†å®ƒï¼Œç„¶åè¯•ç€ç†è§£åœ¨å¹•åå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘å†³å®šåˆ¶ä½œè¿™ä¸ªå¿«é€Ÿè€Œåˆéå¸¸ç®€å•çš„æŒ‡å—ï¼Œæ¼”ç¤ºå¦‚ä½•è®©æ ·å¼åŒ–ç»„ä»¶ä¸ next.js ä¸€èµ·å·¥ä½œã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼

## [](#1-create-a-project-directory-and-install%C2%A0next-and-react-dependencies)1ã€‚åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶å®‰è£… next å’Œ react ä¾èµ–é¡¹

```
mkdir my-next-app && cd my-next-app && yarn add next react react-dom 
```

> Next.js åªæ”¯æŒ [React 16](https://reactjs.org/blog/2017/09/26/react-v16.0.html) ã€‚
> ç”±äº React 16 çš„å·¥ä½œæ–¹å¼å’Œæˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ”¾å¼ƒ React 15 æ”¯æŒã€‚
> 
> *   [Next.org](https://nextjs.org/)

## [](#2-add-scripts-to-your-raw-packagejson-endraw-)2ã€‚å°†è„šæœ¬æ·»åŠ åˆ°æ‚¨çš„`package.json`

```
{
  "scripts": {
    "dev": "next",
    "build": "next build",
    "start": "next start"
  },
  "dependencies": {
    "next": "^...",
    "react": "^...",
    "react-dom": "^..."
  }
} 
```

ä¹‹åï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸»è¦çš„ APIã€‚æ¯ä¸€ä¸ª`.js`æ–‡ä»¶éƒ½å˜æˆäº†è‡ªåŠ¨å¤„ç†å’Œæ¸²æŸ“çš„è·¯å¾„ã€‚

## [](#3-create-a-pages-directory-and-your-first-page)3ã€‚åˆ›å»ºä¸€ä¸ª/pages ç›®å½•å’Œä½ çš„ç¬¬ä¸€é¡µã€‚

ä»æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•:

```
mkdir pages && touch pages/index.js 
```

å¡«å……`./pages/index.js`:

```
export default () => (
   <div>
       <h1>My First Next.js Page</h1>
   </div>
) 
```

ç„¶ååªéœ€è¿è¡Œ`yarn dev`å¹¶è½¬åˆ°`http://localhost:3000`ã€‚

[![localhost:3000](../Images/1aada08108bf521f48c1bc84afdf0cd9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--J6Po-7h9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.adrianprieto.com/wp-content/uploads/2018/06/run.png)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¾—åˆ°:

*   è‡ªåŠ¨ä¼ è¾“å’Œæ†ç»‘(ä½¿ç”¨ webpack å’Œ babel)
*   çƒ­ä»£ç é‡è½½
*   `./pages`çš„æœåŠ¡å™¨æ¸²æŸ“å’Œç´¢å¼•

## [](#4-add-styledcomponents%C2%A0)4ã€‚æ·»åŠ æ ·å¼ç»„ä»¶

```
yarn add styled-components 
```

ç°åœ¨è®©æˆ‘ä»¬æ¥ç¼–è¾‘`./pages/index.js`:

```
import styled from 'styled-components';

export default () => (
  <div>
    <Title>My First Next.js Page</Title>
  </div>
);

const Title = styled.h1`
  color: red;
`; 
```

å¦‚æœä½ é‡æ–°åŠ è½½é¡µé¢ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è®¾ç½®æ­£ç¡®çš„é…ç½®ï¼Œä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬æ­£åœ¨åšä¸‹ä¸€æ­¥ã€‚

## [](#5-add-babel-plugin-and-custom-raw-bablerc-endraw-file)5ã€‚æ·»åŠ  babel æ’ä»¶å’Œè‡ªå®šä¹‰`.bablerc`æ–‡ä»¶

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†æ ·å¼åŒ–ç»„ä»¶ babel æ’ä»¶ä½œä¸ºå¼€å‘ä¾èµ–é¡¹è¿›è¡Œå®‰è£…:

```
yarn add -D babel-plugin-styled-components 
```

ç„¶ååœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`.babelrc`æ–‡ä»¶ã€‚

```
touch .babelrc 
```

*   æ·»åŠ ä¸€ä¸ªé€šå¤©å¡”/é¢„è®¾
*   æ·»åŠ ä¸€ä¸ªæ ·å¼ç»„ä»¶æ’ä»¶ï¼Œå°†`ssr`æ ‡å¿—è®¾ç½®ä¸º`true`ï¼Œå°†`displayName`è®¾ç½®ä¸º`true`ï¼Œå°†`preprocess`è®¾ç½®ä¸º falseã€‚

æœ€ç»ˆçš„`.babelrc`æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:

```
{
  "presets": [
    "next/babel"
  ],
  "plugins": [
    [
      "styled-components",
      {
        "ssr": true,
        "displayName": true,
        "preprocess": false
      }
    ]
  ]
} 
```

**æ³¨æ„:** `displayName`å°†ç”Ÿæˆæ›´å®¹æ˜“è°ƒè¯•çš„ç±»å(è¿˜å°†åŒ…å«ç»„ä»¶åï¼Œè€Œä¸ä»…ä»…æ˜¯æ•£åˆ—)ï¼›`preprocess`â€“å®éªŒåŠŸèƒ½æ˜ç¡®å…³é—­ã€‚

## â‘¥ã€‚åˆ›å»ºè‡ªå®šä¹‰çš„`_document.js`æ–‡ä»¶

å¦‚æœä½ ä»¥å‰ä½¿ç”¨è¿‡`create-react-app`ï¼Œä½ ä¹ æƒ¯äºçŸ¥é“ä½ çš„ä¸»æ–‡æ¡£åœ¨å“ªé‡Œï¼Œå—¯ï¼Œnext.js ä¸å…¬å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„ pages æ–‡ä»¶å¤¹ä¸­æ·»åŠ ä¸€ä¸ª`_document.js`æ–‡ä»¶æ¥è¦†ç›–é»˜è®¤æ–‡æ¡£ã€‚

```
touch pages/_document.js 
```

æˆ‘ä»¬å°†æ‰©å±•`<Document />`å¹¶å°†æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ ·å¼æ³¨å…¥åˆ°`<head>`ä¸­ã€‚

> è¦è¦†ç›–é»˜è®¤è¡Œä¸ºï¼Œæ‚¨å¿…é¡»åœ¨`./pages/_document.js`å¤„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰©å±• Document ç±»ã€‚https://github.com/zeit/next.js/#custom-document
> T2

å¦‚æœæˆ‘ä»¬åªæ¸²æŸ“é¡µé¢è€Œä¸æ¸²æŸ“å…¶ä»–å†…å®¹ï¼Œè¿™å°±æ˜¯è‡ªå®šä¹‰`_document.js`çš„æ ·å­:

```
import Document, { Head, Main, NextScript } from 'next/document'

export default class MyDocument extends Document {
  static getInitialProps ({ renderPage }) {
    // Returns an object like: { html, head, errorHtml, chunks, styles } 
    return renderPage();
  }

  render () {    
    return (
      <html>
        <Head>
          <title>My page</title>
        </Head>
        <body>
          <Main />
          <NextScript />
        </body>
      </html>
    )
  }
} 
```

è¿™æ˜¯æˆ‘ä»¬æ·»åŠ  SSR é£æ ¼çš„ç»„ä»¶åçš„æ ·å­ã€‚

```
import Document, { Head, Main, NextScript } from 'next/document';
// Import styled components ServerStyleSheet
import { ServerStyleSheet } from 'styled-components';

export default class MyDocument extends Document {
  static getInitialProps({ renderPage }) {
    // Step 1: Create an instance of ServerStyleSheet
    const sheet = new ServerStyleSheet();

    // Step 2: Retrieve styles from components in the page
    const page = renderPage((App) => (props) =>
      sheet.collectStyles(<App {...props} />),
    );

    // Step 3: Extract the styles as <style> tags
    const styleTags = sheet.getStyleElement();

    // Step 4: Pass styleTags as a prop
    return { ...page, styleTags };
  }

  render() {
    return (
      <html>
        <Head>
          <title>My page</title>
          {/* Step 5: Output the styles in the head  */}
          {this.props.styleTags}
        </Head>
        <body>
          <Main />
          <NextScript />
        </body>
      </html>
    );
  }
} 
```

ä¸€æ—¦å®Œæˆï¼Œé‡å¯ä½ çš„æœåŠ¡å™¨ï¼Œé”™è¯¯åº”è¯¥æ¶ˆå¤±ï¼Œä½ çš„`<h1>`æ ‡ç­¾åº”è¯¥æ˜¯çº¢è‰²çš„ï¼ŒSSR é£æ ¼çš„ç»„ä»¶åº”è¯¥å·¥ä½œã€‚

å°±æ˜¯è¿™æ ·ï¼Œæ¦‚æ‹¬ä¸€ä¸‹:

1.  åˆ›å»ºé¡¹ç›®å¹¶å®‰è£…ä¾èµ–é¡¹
2.  æ·»åŠ è„šæœ¬
3.  åˆ›å»ºä¸€ä¸ªé¡µé¢æ–‡ä»¶å¤¹å’Œç¬¬ä¸€é¡µ
4.  æ·»åŠ æ ·å¼ç»„ä»¶
5.  æ·»åŠ ä¸€ä¸ª babel æ’ä»¶å’Œä¸€ä¸ªå®šåˆ¶çš„`.babelrc`æ–‡ä»¶
6.  åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„`_document.js`æ–‡ä»¶

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå¦‚æœæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªç°æœ‰çš„ next.js é¡¹ç›®ï¼Œé‚£ä¹ˆæ‚¨åªéœ€è¦å®ç°æ­¥éª¤ 4 åˆ° 6ã€‚

è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨ next.js ä¸­ä½¿ç”¨æ™®é€šçš„`.css`æ–‡ä»¶ï¼Œæˆ‘å°†å¾ˆå¿«å†™ä¸€ä¸ªå…³äºå¦‚ä½•è®¾ç½®å®ƒçš„æŒ‡å—ã€‚

## [](#resources)èµ„æº

*   [Next.js æ–‡æ¡£](https://nextjs.org/docs/#setup)
*   [JavaScript æ¼«è°ˆ](https://jsramblings.com)

*è¿™ä¸ªå¸–å­æœ€åˆäº 2018 å¹´ 6 æœˆ 26 æ—¥å‘å¸ƒåœ¨æˆ‘çš„[ç½‘ç«™](https://www.adrianprieto.com/next-js-styled-components-the-really-simple-guide-%E2%96%B2-%F0%9F%92%85/)ä¸Šã€‚*