# 用你的报价生成图片的 Twitter 机器人！

> 原文：<https://dev.to/nirzaq/twitter-bot-that-generates-an-image-with-your-quote-4m4h>

在 Twitter 上，我经常看到人们发励志的、有趣的甚至是愚蠢的引用。我想象一下，如果有一个 twitter 机器人可以生成一张图片，上面有他们的引用呢？像这样:

[![Copy and Pasting from Stack Overflow](../Images/fa043d9c6feffa88b3a187f1bcd0f54a.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--EICda_Xo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/s6i8emgfeidtv33mejti.jpg)

所以我决定造一个。

除了“将此脚本复制到页脚部分”或“将此脚本包含在 head 标签中”，我没有用 javascript 创建应用程序的经验，为了获得经验和学习 Javascript，我选择用 Javascript 构建这个 bot。

谢天谢地，丹尼尔·希夫曼的视频教程对我的起步帮助很大。

[https://www.youtube.com/embed/mUoIPmZ4KwA](https://www.youtube.com/embed/mUoIPmZ4KwA)

(另请查看[精彩的播放列表](https://www.youtube.com/watch?v=RF5_MPSNAtU&list=PLRqwX-V7Uu6byiVX7_Z1rclitVhMBmNFQ))

## 设置 Twitter 应用

设置与此非常相似，所以您可以按照这篇文章来设置 Twitter 应用程序。ðÿ˜…

## 文章不再可用

### 监听用户事件

当有人引用这个机器人的任何推文时，我希望这个机器人能够工作。我们将创建一个监听用户事件的流:

```
const stream = T.stream("user");
stream.on("quoted_tweet", tweetEvent); 
```

Enter fullscreen mode Exit fullscreen mode

如果有人引用了这个机器人的任何推文，它将执行`tweetEvent`回调，下面是`tweetEvent`回调的代码:

```
function tweetEvent(eventMsg) {

  const text = eventMsg.target_object.text;
  const from = `@${eventMsg.source.screen_name}`;
  const twit_id = eventMsg.target_object.id_str;

  if (eventMsg.event === "quoted_tweet") {
    const tweetMedia = imagePath => {
      try {
        var b64content = fs.readFileSync(imagePath, { encoding: "base64" });
        T.post("media/upload", { media_data: b64content }).then(response => {
          var mediaIdStr = response.data.media_id_string;
          var altText = "Image Quote Generated By Quotemakerbot";
          var meta_params = {
            media_id: mediaIdStr,
            alt_text: { text: altText }
          };

          T.post("media/metadata/create", meta_params).then(() => {
            var params = {
              status: `${from}`,
              in_reply_to_status_id: twit_id,
              media_ids: [mediaIdStr]
            };
            T.post("statuses/update", params).then(response => {
              console.log("Successfully post to twitter");

    //some code omitted 
```

Enter fullscreen mode Exit fullscreen mode

`tweetMedia`只是一个函数，它接受一个图像路径，将图像发布到 Twitter，这里是进行图像处理的“实际”代码:

```
exports.processImage = async (from, text) => {
  const param = tweetUtil.getUnsplashParam(text)
  options = {
    url: `https://source.unsplash.com/1024x576/${param}`,
    dest: `${from}.jpg`
  }
  const { filename, image } = await download.image(options)
  const filteredImage = await ImageProcessor.filterImage(filename,`${from}-filtered.jpg`)
  setTimeout(function() {
  ImageProcessor.drawImageAndTextToCanvas(filteredImage,{
      text:tweetUtil.cleanAndTidyTweet(text),
      imageName: from+`-quoted.jpg`,
      username: from
    })
  }, 1500);
  return `${from}-quoted.jpg`
} 
```

Enter fullscreen mode Exit fullscreen mode

老实说，我无法解释代码的每一部分，这个机器人是 9 个月前制作的，当我再次阅读代码时，我就像是:

[![I have no memory](../Images/13125a66b19e153d2dbdcadc279de9d5.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--K0XN4zHG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nd6wk8brbgvp5zuao4q0.gif)

但是这个机器人通常是这样工作的:

1.  有人引用了这个机器人的推文。
2.  这个机器人将从 Unsplash 随机或指定类别下载图像，例如我添加编码选项，所以它将从 Unsplash 下载编码类别的图像。下面是图片:![Original Image](../Images/894df6c326e6b7854fe9a199048c10a3.png)
3.  然后，图像的亮度和对比度下降了一点，使文本更具可读性。![Filtered Image](../Images/ad5ac755037e77421388b38e9920f0d5.png)
4.  将图像和文本绘制到画布上![Finished Image](../Images/fa043d9c6feffa88b3a187f1bcd0f54a.png)
5.  发到推特上！

就是这样，试试看！ [@quotemakerbot](https://twitter.com/quotemakerbot)

[点击此处](https://gist.github.com/nirzaq/088f95a984430535054e0ab002bdfb61)查看可用选项列表，如果不添加选项，背景图像将来自 Unsplash 上的随机类别。

## 用法举例

推文格式:-选项(您的报价)

[![how to](../Images/91ebeef61bf34c087268f25c2d874952.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--ERPoFwXv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/x3eptlhlmfs3u1ggsve0.png)

## 结果

[![Result](../Images/cc3cbfb535509125f12828c36b70568b.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--gdP-nul6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2k5wsdd2i2gmnovyvdii.png)

PS:有时候这个 bot 并不能像预期的那样工作。ðŸ™‡