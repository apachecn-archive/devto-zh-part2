# æ¸…é™¤ docker æœªä½¿ç”¨çš„æ•°æ®

> åŸæ–‡:# t0]https://dev . to/mayu/cleaning them-data-no use-par-docker-3l7j

*æ³¨æ„:é”®å…¥å¯èƒ½ä¼šåæ‚”çš„å‘½ä»¤å‰ï¼Œè¯·å…ˆé˜…è¯»æ•´ç¯‡æ–‡ç« ã€‚*

å¦‚æœä½¿ç”¨ docker(æ— è®ºæ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿˜æ˜¯åœ¨å¼€å‘æœºå™¨ä¸Š)ï¼Œæ‚¨å¯èƒ½å·²ç»ç§¯ç´¯äº†å¤§é‡ä¸å¿…è¦çš„æ•°æ®ã€‚æœ‰è¯¸å¦‚[åç«™-gc](https://github.com/spotify/docker-gc) ä¹‹ç±»çš„å·¥å…·æ¥æ¸…ç†è¿™ä¸€åˆ‡ï¼Œä½†ä»[API 1.25](https://docs.docker.com/engine/api/v1.25/)åç«™é›†æˆäº†`prune`å‘½ä»¤ï¼Œè¿™å¯èƒ½å°±è¶³å¤Ÿäº†ã€‚

åŸºæœ¬ç”¨æ³•ç›¸å½“ç®€å•:

```
$ sudo docker system prune
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to continue? [y/N] y

Deleted Containers:
deleted: sha256:ea43728b2d10e7b0fe24036f9531caac96bd02f779b95a6620110f00ccd3b002
deleted: sha256:022db612b3070971ce7d51778806a1f995a9c3aa1a741a6c0be0bca603787387
...approximativement 2 gajillion de hashes...

Total reclaimed space: 5.64GB 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åˆ é™¤å¾ˆå¤šå†…å®¹ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œä¸ä¼šåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„å†…å®¹(ä¾‹å¦‚ï¼Œæ²¡æœ‰å®¹å™¨çš„å›¾åƒä¸æ˜¯ä½¿ç”¨æ­¤å‘½ä»¤åˆ é™¤çš„)ã€‚ä¸ºæ­¤ï¼Œåº”å¢åŠ é€‰é¡¹`--all` :

```
$ sudo docker system prune --all
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all images without at least one container associated to them
        - all build cache
Are you sure you want to continue? [y/N] y
... moar hashes...

Total reclaimed space: 26.78GB 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™è¿˜ä¸é”™ï¼Œä½†è¿˜ä¸å¤ªç†æƒ³ã€‚ä¿æŒä¸€ç‚¹ç‚¹çš„éšè”½è¿˜æ˜¯æœ‰åŠ©äºåŠ å¿«äº‹æƒ…çš„è¿›å±•ã€‚ä¸ºæ­¤æœ‰ä¸€ä¸ªé€‰é¡¹`--filter`(ä»…ä»[API 1.28](https://docs.docker.com/engine/api/v1.28/)å¼€å§‹æä¾›)ã€‚åœ¨æ’°å†™è¿™äº›è¡Œæ—¶ï¼Œåªæœ‰ä¸¤ä¸ªç­›é€‰å™¨å¯ç”¨:`until`å’Œ`label`ã€‚åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¸»è¦ä½¿ç”¨`until`ï¼Œå®ƒå°†åœ¨æŸä¸ªæ—¥æœŸä¹‹å‰(ä½¿ç”¨æ—¶é—´æˆ³)æ¸…é™¤æ‰€æœ‰å†…å®¹ã€‚

å½“ç„¶ï¼Œæˆ‘ä¸å–œæ¬¢æ‰“å­—æ—¶é—´æˆ³ï¼Œä½†æˆ‘ç”¨`date`ç”Ÿæˆå®ƒ:

```
$ sudo docker system prune --all --filter until=$(date -d "1 month ago" +%s) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ­¤ï¼Œæˆ‘ä½¿ç”¨å¸¦æœ‰â€œ`$( commande )`â€çš„æ›¿æ¢ï¼Œè¯¥æ›¿æ¢å…è®¸æ‚¨æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä»¥ä¾¿å°†å…¶ç»“æœä½œä¸ºå­—ç¬¦ä¸²è¾“å…¥åˆ°å¦ä¸€ä¸ªå‘½ä»¤ä¸­ã€‚å‘½ä»¤`date`åˆ†è§£ä¸º`date -d <description de
la date> <format de sortie>`ã€‚è¿™é‡Œè¾“å‡ºæ ¼å¼`+%s`æ˜¯æŒ‡â€œæ—¶é—´æˆ³â€ã€‚çœ‹çœ‹`man date`å¦‚æœä½ æƒ³äº†è§£æ›´å¤šã€‚

å°±è¿™æ ·ğŸ˜ƒæˆ‘å¾ˆå°‘éœ€è¦æ¯”ä¸€ä¸ªæœˆå¤§çš„æ•°æ®(è€Œä¸”å³ä½¿ 1 ä¸ªæœˆä¹Ÿéå¸¸ä¿å®ˆï¼Œä½†ç”±äºæˆ‘å¾ˆå°‘è·å¾—è‰¯å¥½çš„ååé‡ï¼Œæ‰€ä»¥æˆ‘å°½é‡ä¿æŒä¸‹å»)ã€‚

æœ€åï¼Œå¦‚æœæœ‰å†’é™©å®¶çš„çµé­‚ï¼Œå¯ä»¥æ·»åŠ `--force`é€‰é¡¹ï¼Œåœ¨æ²¡æœ‰å¿…è¦ç¡®è®¤çš„æƒ…å†µä¸‹å‘å‡ºè®¢å•ã€‚æˆ‘åœ¨æˆ‘çš„æŒç»­é›†æˆæœåŠ¡å™¨ä¸Šä½¿ç”¨å®ƒæ¥æ‰§è¡Œ cron ä»»åŠ¡:

```
$ sudo docker system prune --force --all --filter until=$(date -d "1 week ago" +%s) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¿«ä¹çš„å®¶åº­

*å…³äº`sudo`çš„æ³¨é‡Š:åœ¨æˆ‘çš„å¼€å‘æœºå™¨ä¸Š(è¿™æ˜¯ GNU/Linux ç³»ç»Ÿ)ï¼Œæˆ‘åªé€šè¿‡`sudo`ä½¿ç”¨åç«™ï¼Œå› ä¸ºåœ¨`docker`ç»„ä¸­å°±ç­‰äºæˆäºˆå…¶ç”¨æˆ· root æƒé™ã€‚è¿™æ˜¯å› ä¸º docker æ˜¯ç³»ç»Ÿä¸Šçš„é¦–é€‰å®ˆæŠ¤ç¨‹åºã€‚å®˜æ–¹æ–‡ä»¶ä¸­çš„æ›´å¤šä¿¡æ¯:[ç å¤´å®‰å…¨](https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface)ã€‚*

*è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨[mayu . me](https://mayeu.me/blog/nettoyer-les-donnees-de-docker/)ä¸Šã€‚*