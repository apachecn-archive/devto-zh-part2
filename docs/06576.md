# ç”± Nuxt å’Œ AWS æ”¯æŒçš„é™æ€ç«™ç‚¹

> åŸæ–‡:[https://dev . to/lee Smith/static-sites-powered-by-nuxt-and-AWS-2hp 7](https://dev.to/leesmith/static-sites-powered-by-nuxt-and-aws-2hp7)

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘çš„åšå®¢ä¸Šã€‚

[![Nuxt and AWS](../Images/d433dd55bbff867188f46c34dff89066.png "Static Sites Powered By Nuxt and AWS")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--rmDCC4Nd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rd5n1lbv0ww72ht01r90.png)

æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•å»ºç«‹æˆ‘çš„æ–°ä¸ªäººç½‘ç«™å’Œåšå®¢çš„ã€‚å°±é™æ€åšå®¢è€Œè¨€ï¼Œæˆ‘çš„ç›®æ ‡éå¸¸ç®€å•ã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä¸æƒ³ç”¨ CMSã€‚æˆ‘æƒ³ä½¿ç”¨é™æ€æ‰˜ç®¡ç¯å¢ƒï¼Œè¿™æ ·æˆ‘å°±ä¸ç”¨ç®¡ç†æœåŠ¡å™¨äº†ã€‚æˆ‘è¿˜æƒ³æ¢ç´¢é’ˆå¯¹å‰ç«¯çš„æŠ€æœ¯ï¼Œå› ä¸ºæˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ä½¿ç”¨æœåŠ¡å™¨ç«¯è¯­è¨€æ„å»º web åº”ç”¨ç¨‹åºã€‚ç°åœ¨åœ¨é™æ€ç«™ç‚¹ç”Ÿæˆé¢†åŸŸçœŸçš„æœ‰å¾ˆå¤šäº‹æƒ…æ­£åœ¨å‘ç”Ÿã€‚é™æ€ç«™ç‚¹å·²ç»è¯æ˜äº†å®ƒä»¬çš„ä»·å€¼ï¼Œå°¤å…¶æ˜¯åœ¨æ€§èƒ½å’Œæˆæœ¬æ–¹é¢ã€‚ä» React ç¤¾åŒºå¼€å§‹ï¼ŒNext.js å’Œ Gatsby å¼€å§‹æµè¡Œèµ·æ¥ã€‚Hugo æ˜¯ä¸€ä¸ªç”¨ go ç¼–å†™çš„æµè¡Œé¡¹ç›®ï¼ŒVuePress åˆšåˆšåœ¨ä»Šå¹´ 4 æœˆé—®ä¸–ã€‚

æ‰€ä»¥æˆ‘æœ€ç»ˆé€‰æ‹©äº† [Nuxt](https://nuxtjs.org/) ä½œä¸ºæˆ‘çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ã€‚Nuxt æ˜¯ä¸€ä¸ªé«˜å±‚æ¡†æ¶ï¼Œä½äº Vue ä¹‹ä¸Šï¼Œæä¾›äº†è®¸å¤šå¾ˆé…·çš„ç‰¹æ€§å’Œä¸€äº›æˆ‘å¾ˆæ¬£èµçš„çº¦å®šã€‚æˆ‘å…³æ³¨ Vue å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘å–œæ¬¢æˆ‘æ‰€çœ‹åˆ°çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹© Nuxt çš„ä¸€ä¸ªåŸå› ã€‚æˆ‘è¿˜å°†éƒ¨ç½²åˆ° AWS S3ï¼Œå¹¶ä½¿ç”¨ AWS Cloudfront ä½œä¸º CDNï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œ HTTPS é€šä¿¡ã€‚è¿™ä¸ªç½‘ç«™æ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ [Github](https://github.com/leesmith/leesmith-dot-net) ä¸Šéšæ„æŸ¥çœ‹ã€‚

## Nuxt

Nuxt ä¸»è¦å— Next.js çš„å¯å‘ï¼Œæ˜¯åœ¨ Vue ä¸­å¼€å‘é€šç”¨ JavaScript åº”ç”¨ç¨‹åºçš„é«˜çº§æ¡†æ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNuxt æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä½†ä¹Ÿå¯ä»¥é…ç½®ä¸º SPAã€‚Nuxt çš„é‡å¤§åˆ›æ–°æ˜¯â€œé¢„æ¸²æŸ“â€ï¼Œå®ƒå…è®¸ä½ ç”Ÿæˆä½ çš„ web åº”ç”¨ç¨‹åºï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æ‰˜ç®¡åœ¨ä»»ä½•æµè¡Œçš„é™æ€æ‰˜ç®¡æä¾›å•†ä¸Šï¼Œå¦‚äºšé©¬é€Š S3 æˆ– Netlifyã€‚

å¼€å§‹æ—¶ï¼Œæˆ‘ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºæˆ‘çš„é¡¹ç›®:

```
# install vue-cli globally
npm install -g vue-cli

# create a project using a nuxt template
vue init nuxt-community/starter-template leesmith-dot-net

# cd into the project and install dependencies
cd leesmith-dot-net
npm install

# spin up a local dev server on port 3000
npm run dev 
```

Enter fullscreen mode Exit fullscreen mode

è‡³æ­¤ï¼ŒNuxt å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ç»“æ„ï¼ŒåŒ…æ‹¬`assets`ã€`components`ã€`layouts`ã€`pages`ã€`plugins`ç­‰ã€‚åœ¨æˆ‘çš„ç½‘ç«™ä¸Šï¼Œæˆ‘å»ºç«‹äº†ä¸€ä¸ªåŸºæœ¬çš„å¸ƒå±€ï¼Œæˆ‘å†™çš„æ¯ä¸€ç¯‡æ–‡ç« éƒ½åœ¨æˆ‘çš„å¸ƒå±€ä¸­ã€‚ä½¿ç”¨ Nuxt çš„ä¸€ä¸ªçº¦å®šæ˜¯ï¼Œæ”¾åœ¨ pages ç›®å½•ä¸­çš„æ¯ä¸ª`.vue`ç»„ä»¶æ–‡ä»¶éƒ½ç”Ÿæˆä¸ºè‡ªå·±çš„ html æ–‡ä»¶ã€‚åœ¨æˆ‘çš„ pages ç›®å½•ä¸­ï¼Œæˆ‘æœ‰ä¸€ä¸ª posts ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æˆ‘ç«™ç‚¹çš„æ¯ç¯‡åšå®¢æ–‡ç« ã€‚æœ‰äº†è¿™ä¸ªçº¦å®šï¼Œæ‚¨åªéœ€åšå¾ˆå°‘çš„é…ç½®å·¥ä½œã€‚

`nuxt.config.js`æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®èŒƒå›´çš„è®¾ç½®ã€‚æœ‰ä¸€ä¸ªéƒ¨åˆ†å…è®¸æ‚¨ä¸º`<head>`éƒ¨åˆ†ä¸­çš„å…ƒç´ è®¾ç½®å±æ€§ã€‚ä½ éœ€è¦è®¾ç½®è¯­è¨€å’Œå…ƒæ ‡ç­¾ç­‰ä¸œè¥¿ã€‚

å°±å¸ƒå±€è€Œè¨€ï¼Œä»¥ä¸‹å†…å®¹è¶³ä»¥æ»¡è¶³ä¸€äº›éå¸¸åŸºæœ¬çš„è¦æ±‚:

```
<template>
  <header>
    <h1>Example Site Title</h1>
  </header>
  <section>
    <nuxt/>
  </section>
</template>

<script>
</script>

<style>
</style> 
```

Enter fullscreen mode Exit fullscreen mode

å¯¹äºä¸€ä¸ªåŸºæœ¬é¡µé¢ï¼Œä»¥ä¸‹å†…å®¹å°±è¶³å¤Ÿäº†:

```
<template>
  <article><p>Hello World</p></article>
</template>

<script>
</script>

<style>
</style> 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘æœ€å–œæ¬¢çš„å¼€ç®±å³ç”¨åŠŸèƒ½ä¹‹ä¸€æ˜¯é¡µé¢è¿‡æ¸¡ï¼Œå®ƒç”± Vue æä¾›æ”¯æŒã€‚å®ƒç»™äº†ç½‘ç«™ä¸€ç§è‡ªç„¶çš„æ„Ÿè§‰ï¼Œè€Œä¸æ˜¯ç‚¹å‡»ä¸åŒé¡µé¢æ—¶é€šå¸¸çš„â€œé—ªçƒâ€ã€‚è¦æ§åˆ¶é¡µé¢è½¬æ¢çš„æ ·å¼ï¼Œæ‚¨éœ€è¦ä¸ºè½¬æ¢æŒ‚é’©æ·»åŠ æ ·å¼ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
.page-enter-active,
.page-leave-active {
  transition: opacity 0.3s;
}

.page-enter,
.page-leave-to {
  opacity: 0;
} 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘é€‰æ‹©äº†å¸ƒå°”ç›ä½œä¸ºæˆ‘çš„ CSS æ¡†æ¶ã€‚æˆ‘è¿˜ä½¿ç”¨äº† Fontawesome å›¾æ ‡å’Œ vue-highlightjs æ’ä»¶ã€‚æˆ‘å¯èƒ½ä¼šåœ¨ä»¥åçš„æ–‡ç« ä¸­è¿›ä¸€æ­¥è¯¦è¿°è¿™äº›ã€‚

é™¤äº†`nuxt.config.js`ä¸­çš„é¡¹ç›®çº§è®¾ç½®ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨é¡µé¢çº§åˆ«æ§åˆ¶ meta æ ‡ç­¾ã€‚æˆ‘å¸Œæœ›æ¯ä¸ªåšå®¢å¸–å­(é¡µé¢)æœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ ‡é¢˜ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ Nuxt çš„ APIâ€”â€”ç‰¹åˆ«æ˜¯`head()`æ–¹æ³•:

```
// script section of your vue component
<script>
export default {
  head() {
    return {
      title: "Static sites powered by Nuxt and AWS - LeeSmith.net",
      meta: [
        {
          hid: "description",
          name: "description",
          content: "Static sites powered by Nuxt and AWS"
        }
      ]
    };
  }
};
</script> 
```

Enter fullscreen mode Exit fullscreen mode

è¿™äº›æ˜¯ Nuxt çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚ä»è¿™é‡Œæ‚¨å¯ä»¥ç”Ÿæˆæ‚¨çš„ç«™ç‚¹:

```
npm run generate 
```

Enter fullscreen mode Exit fullscreen mode

Nuxt ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‚¨ç”Ÿæˆçš„ç«™ç‚¹æ–‡ä»¶çš„`dist`æ–‡ä»¶å¤¹ã€‚è¿™äº›æ˜¯æ‚¨å°†æ¨é€åˆ°é™æ€ä¸»æœºçš„æ–‡ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åœ¨äºšé©¬é€Šæ‰˜ç®¡æ—¶æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

## AWS è®¾ç½®

åœ¨ AWS ä¸Šè¿›è¡Œè®¾ç½®éå¸¸ç®€å•ã€‚ä»–ä»¬æœ‰æ˜“äºéµå¾ªçš„æ•´ä¸ªè¿‡ç¨‹çš„æ–‡ä»¶ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œé‡æ–°åˆ›å»ºä»–ä»¬çš„æ–‡æ¡£ï¼Œä½†ä½ è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä½ çš„ S3 æ¡¶ï¼Œå¹¶åœ¨å…¶ä¸Šå¯ç”¨é™æ€æ‰˜ç®¡ã€‚æˆ‘å‡è®¾ä½ å·²ç»æ³¨å†Œäº†ä¸€ä¸ªåŸŸåï¼Œä½†å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ AWS Route 53 è¿›è¡ŒåŸŸåæ³¨å†Œå’Œ DNS ç®¡ç†ã€‚

æŒ‰ç…§ [AWS S3 æ¼”ç»ƒ](https://docs.aws.amazon.com/AmazonS3/latest/dev/HostingWebsiteOnS3Setup.html)åˆ›å»ºå’Œé…ç½®æ‚¨çš„ S3 é“²æ–—ã€‚

æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥å‘ä¸Šæ¨æ‚¨ç”Ÿæˆçš„ç«™ç‚¹æ–‡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨çš„ bucket é…ç½®æ­£ç¡®ã€‚æˆ‘å¼ºçƒˆæ¨èåœ¨ä½¿ç”¨ AWS æ—¶ä½¿ç”¨ [awscli](https://aws.amazon.com/cli/) ã€‚é€šè¿‡ web æ§åˆ¶å°ç‚¹å‡»å¹¶ä¸æ˜¯æœ€æœ‰æ•ˆçš„å®Œæˆå·¥ä½œçš„æ–¹å¼ã€‚ä¸€æ—¦ä¸ºæ‚¨çš„ AWS å¸æˆ·å®‰è£…å¹¶é…ç½®äº† awscliï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå°†æ–‡ä»¶å¤åˆ¶åˆ°æ‚¨çš„ bucket:

```
aws s3 cp dist s3://mybucket --recursive 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨ï¼ŒS3 æ°´æ¡¶æœåŠ¡äºæ‚¨çš„ç½‘ç«™ï¼Œä¸‹ä¸€ä»¶äº‹æ˜¯é€šè¿‡ AWS Cloudfront å‘è¡Œç‰ˆæœåŠ¡æ‚¨çš„ç½‘ç«™ã€‚è¿™ä½¿æ‚¨å¯ä»¥é€šè¿‡ä½¿æ‚¨çš„ç½‘ç«™çš„é™æ€æ–‡ä»¶(å¦‚ HTMLã€å›¾åƒå’Œè§†é¢‘)å¯ä»ä¸–ç•Œå„åœ°çš„æ•°æ®ä¸­å¿ƒ(ä»–ä»¬ç§°ä¹‹ä¸ºè¾¹ç¼˜ä½ç½®)è·å¾—æ¥æé«˜æ€§èƒ½ã€‚æœ‰äº† AWS Cloudfrontï¼Œä½ è¿˜å¯ä»¥é…ç½®ä½ çš„ç½‘ç«™åœ¨ HTTPS æä¾›æœåŠ¡ã€‚é€Ÿåº¦å’Œå®‰å…¨æ€§å¯¹ä»Šå¤©çš„ç½‘ç»œè‡³å…³é‡è¦ã€‚ç½‘ç«™çš„ HTTPS å‡ ä¹æˆäº†æ ‡å‡†ï¼Œå› ä¸ºå½“é¡µé¢æ²¡æœ‰ä½¿ç”¨ HTTPS æ—¶ï¼Œæµè§ˆå™¨ä¼šè­¦å‘Šä½ ã€‚è°·æ­Œæœç´¢ç®—æ³•ä¹Ÿæœ‰åˆ©äºé€Ÿåº¦æ›´å¿«çš„ç½‘ç«™ã€‚

éµå¾ª [AWS Cloudfront æ¼”ç»ƒ](https://docs.aws.amazon.com/AmazonS3/latest/dev/website-hosting-cloudfront-walkthrough.html)æ¥åˆ›å»ºå’Œé…ç½®æ‚¨çš„ Cloudfront å‘è¡Œç‰ˆã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç¯å¡”å¾—åˆ†çœ‹èµ·æ¥ç›¸å½“ä¸é”™:

[![Lighthouse](../Images/8aab9c03de773acdcaae015157f99978.png "Lighthouse score")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NATJBnvE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5sgnln5pa14tozy5u0jb.png)

## éƒ¨ç½²

æˆ‘å·²ç»ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚è¯¥è„šæœ¬å–å†³äºæ‚¨çš„ AWS è®¾ç½®ã€‚å¦‚æœä¸€ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œåœ¨æ‚¨å¡«å……ä¸¤ä¸ªå˜é‡(S3Â·URI å’Œ Cloudfront å‘è¡Œç‰ˆ ID)ä¹‹åï¼Œéƒ¨ç½²å°±åƒè¿è¡Œè„šæœ¬ä¸€æ ·ç®€å•ã€‚æˆ‘æ­£åœ¨ä½¿ç”¨ S3 `sync`å‘½ä»¤å°†æˆ‘çš„æ–‡ä»¶æ¨åˆ°æ¡¶ä¸­ã€‚`sync`å‘½ä»¤ä½¿ç”¨ä¸€ä¸ªç¼“å­˜æ§åˆ¶é€‰é¡¹æ¥è®¾ç½®æ–‡ä»¶çš„æœªæ¥æœ€å¤§å¹´é¾„å€¼ï¼Œä»¥åŠä¸€ä¸ªåˆ é™¤é€‰é¡¹æ¥åˆ é™¤æˆ‘çš„ dist ç›®å½•ä¸­ä¸åŒ…å«çš„ä»»ä½•å†…å®¹ã€‚é™¤äº†å°†æ–‡ä»¶åŒæ­¥åˆ°æ¡¶ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿æˆ‘ä»¬çš„ cloudfront å‘è¡Œç‰ˆæ— æ•ˆï¼Œä»¥ä¾¿å°†æ¥è®¿é—®è¯¥ç«™ç‚¹æ—¶å¯ä»¥è·å¾—æœ€æ–°çš„å†…å®¹ã€‚

```
# deploy.sh
if [ ! -f .env ]; then
    echo "# Project environment variables...do not commit this file." >> .env
    echo "AWS_CF_DIST_ID=" >> .env
    echo "AWS_S3_URI=" >> .env
    echo "Please add the necessary values to the .env file."
else
    export $(egrep -v '^#' .env | xargs)
    echo "CF DIST -> $AWS_CF_DIST_ID"
    echo "S3 URI -> $AWS_S3_URI"
    echo "Performing sync..."
    aws s3 sync dist s3://$AWS_S3_URI --cache-control "max-age=31536000" --delete
    echo "Invalidating cloudfront distribution..."
    aws cloudfront create-invalidation --distribution-id $AWS_CF_DIST_ID --paths "/*"
    echo "Deploy complete! ğŸ‰"
fi 
```

Enter fullscreen mode Exit fullscreen mode

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ CI/CD æœåŠ¡(å¦‚ [Semaphore](https://semaphoreci.com/docs/deploying-to-amazon-s3.html) )è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–æ‚¨çš„éƒ¨ç½²ï¼Œè¿™æ ·æ¯æ¬¡æ¨é€åˆ°æ‚¨çš„ä¸»åˆ†æ”¯éƒ½ä¼šå¯åŠ¨ä¸€æ¬¡éƒ¨ç½²ã€‚è¿™ä¸ Netlify æ‰€æä¾›çš„éå¸¸ç›¸ä¼¼ã€‚æˆ‘å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä»äº‹æ›´å¤§çš„é¡¹ç›®æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘çœŸçš„å¾ˆå–œæ¬¢ç© Nuxtã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜/æ„è§ï¼Œè¯·é€šè¿‡ [Twitter](https://twitter.com/jeremyleesmith) è”ç³»æˆ‘ã€‚

å¹²æ¯ï¼ğŸ»