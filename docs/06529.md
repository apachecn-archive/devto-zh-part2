# NodeJS ä¸­çš„ç®€å•è¯·æ±‚

> åŸæ–‡:[https://dev.to/nulldreams/easy-requests-in-nodejs-1fke](https://dev.to/nulldreams/easy-requests-in-nodejs-1fke)

âš :åœ¨ä½ å¼€å§‹é˜…è¯»ä¹‹å‰ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘æ²¡æœ‰å¤ªå¤šçš„åšå®¢ç»éªŒï¼Œæ‰€ä»¥è¯·ç»™æˆ‘ä¸€ä¸ªå…³äºè¿™ç¯‡æ–‡ç« çš„åé¦ˆï¼Œâ˜„

[![follow the rabbit](../Images/501a4db8ec912188b8a7b5ffb9e54200.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Vj5OBk8Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tex6ej8ecu75ppoxa8ez.jpg)

### [](#hi)å—¨ï¼

ä»Šå¤©æˆ‘å°†ä¸ä½ åˆ†äº«æˆ‘å¦‚ä½•ä½¿ç”¨ async/await æ¥ä½¿æˆ‘çš„ http/https è¯·æ±‚æ›´å®¹æ˜“ã€‚

### [](#what-is-asyncawait)ä»€ä¹ˆæ˜¯ async/awaitï¼Ÿ

ç®€å•çš„å›ç­”ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨`await`è¡¨è¾¾å¼æ—¶ï¼Œä¸€ä¸ªæœ‰`async`å£°æ˜çš„å‡½æ•°å¯ä»¥è¢«â€œæš‚åœâ€ã€‚

### [](#lets-see-how-it-works)è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„â€¦â€¦

[https://www.youtube.com/embed/plfMjbnM2Ek](https://www.youtube.com/embed/plfMjbnM2Ek)

åœ¨ã€Šé»‘å®¢å¸å›½ã€‹(1999)ä¸­ï¼Œä¸‰ä½ä¸€ä½“ç»™å°¼æ¬§å‘äº†ä¸€æ¡ä¿¡æ¯ï¼Œä¸Šé¢å†™ç€`Folow the white rabbit`ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒTrinity é‡åˆ°äº†å¼‚æ­¥ javascript çš„é—®é¢˜:

```
function sendMessageToNeo() {
    partOne()
    partTwo()
}
function partOne() {
    setTimeout(() => {
        console.log('follow the')
    }, 1000)
}
function partTwo() {
    setTimeout(() => {
        console.log('white rabbit')
    }, 500)
}

sendMessageToNeo() 
```

è¾“å‡º

```
white rabbit
follow the 
```

åˆ©ç”¨`async/await`æˆ‘ä»¬å¯ä»¥å¸®åŠ©ä¸‰ä¸€

```
async function sendMessageToNeo() {
    await partOne()
    await partTwo()
}
async function partOne() {
    await wait(1000)
    console.log('follow the')
}
async function partTwo() {
    await wait(500)
    console.log('white rabbit')
}

async function wait(ms = 0) {
    return new Promise(r => setTimeout(r, ms))
}

sendMessageToNeo() 
```

è¾“å‡º

```
follow the
white rabbit 
```

ğŸ°ğŸ°ğŸ°

### è®©æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„é¡¹ç›®å§

åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶

*   package.json
*   è¯·æ±‚. js
*   app.js

### [](#packagejson)package.json

```
{  "dependencies":  {  "cheerio":  "^1.0.0-rc.2",  "request":  "^2.87.0"  }  } 
```

*   `cheerio`:ç”¨äº html æ“ä½œ
*   `request`:æå‡ºè¦æ±‚

### [T1ã€‘request . js](#requestjs)

```
const request = require('request')

async function get (url) {
  return new Promise((resolve, reject) => {
    request({ url, method: 'GET' }, (error, response, body) => {
      if (error) return reject(error)

      return resolve({ body, response })
    })
  })
}

async function post (url, data) {
  return new Promise((resolve, reject) => {
    request({ url, method: 'POST', data }, (error, response, body) => {
      if (error) return reject(error)

      return resolve({ body, response })
    })
  })
}

module.exports = {
  get,
  post
} 
```

åœ¨`request.js`ä¸­ï¼Œæˆ‘ä»¬ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªåŒæ­¥é€»è¾‘ï¼Œå‚è§`async`å£°æ˜å’Œ`Promises`ã€‚

### [](#appjs)app.js

```
const request = require('./request')
const cheerio = require('cheerio')

async function sendRequest () {
  let { response, body } = await request.get(`https://www.google.com.br/search?q=node+js`)

  if (response.statusCode !== 200) {
      return error(response, body)
  }

  success(response, body)
}

function success (response, body) {
    const $ = cheerio.load(body)

    console.log(`Status: ${response.statusCode}`)
    console.log(`Message: ${response.statusMessage}`)
    console.log(`Request: ${$('.g').length} results found!`)
}
function error (response) {
    console.log(`Status: ${response.statusCode}`)
    console.log(`Message: ${response.statusMessage}`)
}

sendRequest() 
```

åœ¨`app.js`ä¸­ï¼Œæˆ‘ä»¬å°†å‘ Google å‘å‡ºè¯·æ±‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰æˆåŠŸçš„å“åº”ï¼Œæˆ‘ä»¬å°†ä»ç»“æœä¸­æ‰“å°ä¸€ä¸ªè®¡æ•°ã€‚

è¾“å‡º

```
Status: 200
Message: OK
Request: 10 results found! 
```

### [](#see-the-diference)è§ä¸¤è€…ä¸åŒ

æ— å¼‚æ­¥/ç­‰å¾…

```
function sendRequest() {
    request({ url: '_url', method: 'GET' }, (error, response, body) => {
      if (error) return console.log(error)

      console.log(body)
      console.log(response)
    })  
}
sendRequest() 
```

å¸¦å¼‚æ­¥/ç­‰å¾…

```
async function sendRequest() {
    let { response, body } = await request.get(`_url`)

    console.log(body)
    console.log(response)
}
sendRequest() 
```

## [](#conclusion)ç»“è®º

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`async/await`å¦‚ä½•è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´æ¼‚äº®ï¼Œæœ‰äº†è¿™ä¸ªå®¶ä¼™ï¼Œæˆ‘ä»¬å°±ä¸ä¼šæœ‰è‘—åçš„å›è°ƒåœ°ç‹±çš„é—®é¢˜

å›è°ƒåœ°ç‹±

```
function hell() {
    functionOne('one', (err, one) => {
        console.log(one)
        functionTwo('two', (err, two) => {
            console.log(two)
            functionThree('three', (err, three) => {
                console.log(three)
                functionFour('four', (err, four) => {
                    console.log(four)
                })
            })
        })
    })
} 
```

å¸¦å¼‚æ­¥/ç­‰å¾…

```
async function heaven() {
    let one = await functionOne('one')
    let two = await functionTwo('two')
    let three = await functionThree('three')
    let four = await functionFour('four')

    console.log(one)
    console.log(two)
    console.log(three)
    console.log(four)
} 
```

æ‰€ä»¥ï¼Œå¦‚æœä½ å¯¹ async/await æœ‰é—®é¢˜ï¼Œæˆ–è€…ä½ å¯¹æˆ‘æœ‰ä»€ä¹ˆå»ºè®®ï¼Œè¯·åœ¨è¿™ç¯‡æ–‡ç« ä¸­å‘è¡¨è¯„è®ºã€‚

å†è§ï¼å›å¤´è§ï¼

[![bye](../Images/f8555732a8d27df95474cd47629539e2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--KARXg9Zw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1slphnrscfe2b8mpw89w.gif)