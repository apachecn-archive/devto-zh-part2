# åœ¨ Docker ä¸­è¿è¡Œ Expo/React Native

> åŸæ–‡:[https://dev . to/ghost/running-Expo react-native-in-docker-4hme](https://dev.to/ghost/running-exporeact-native-in-docker-4hme)

[![](../Images/062de94383a7aa9c367dfdaf41c28c51.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--X-aiw6-I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/500/1%2AlnXvsEAIgA1cLp20M20Q4Q.gif) 

<figcaption>åŸå›¾:[https://maraaverick . rbind . io/2017/11/docker-izing-your-work-in-r/](https://maraaverick.rbind.io/2017/11/docker-izing-your-work-in-r/)å’Œ[https://tutuappapkdownload.com/expo-apk/](https://tutuappapkdownload.com/expo-apk/)</figcaption>

åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ Expo/React Native æœ‰æ—¶ä¼šå¯¼è‡´é—®é¢˜ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å°†è¿è¡Œ DockerğŸ³åœ¨å°†åœ¨æˆ‘çš„ä¸»æœº(Windows)ä¸Šè¿è¡Œçš„æ¥å®¾è™šæ‹Ÿæœº(Ubuntu)ä¸­ã€‚æˆ‘çš„ä¸»æœºè¿˜å°†è¿è¡Œå¦ä¸€ä¸ª VM ä½œä¸º Expo è¦è¿æ¥çš„ Android æ¨¡æ‹Ÿå™¨(Genymotion)ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œï¼Œ#PlugPlugPlug è·å¾—å…³äºå¦‚ä½•å°†ä¸¤ä¸ªè™šæ‹Ÿæœºè¿æ¥åœ¨ä¸€èµ·çš„æ›´è¯¦ç»†çš„å¸–å­ğŸ”ŒğŸ”ŒğŸ”Œã€‚å› ä¸ºæˆ‘å·²ç»åœ¨è¿™ä¸¤ä¸ªè™šæ‹Ÿæœºä¸Šè®¾ç½®äº†ç½‘ç»œï¼Œå°± Expo è€Œè¨€ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨ä¸»æœº(Windows)ä¸Šè¿è¡Œã€‚åŒæ ·åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å°†åœ¨ Android è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ã€‚

### å…ˆå†³æ¡ä»¶

*   [å®‰è£…å¯¹æ¥å™¨](https://docs.docker.com/install/)
*   [(å¯é€‰)å®‰è£…åç«™-å¤åˆ](https://docs.docker.com/compose/install/)
*   è¦æµ‹è¯•çš„ Android è®¾å¤‡/ä»¿çœŸå™¨

### package.json

[![](../Images/d9a207455c637d477e11a28b0b539b5f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LEKO3CLL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AGYvaZ5hVpe4lQ3Rf2mq97A.png)

<figcaption>

æˆ‘å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä½¿ç”¨çš„ *package.json* æ–‡ä»¶æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–‡ä»¶ï¼ŒåªåŒ…æ‹¬è¿è¡Œ Expo æ‰€éœ€çš„æœ€å°‘çš„åŒ…ã€‚

### Dockerfile

[![](../Images/d3a4252d4fd9d5e89fe620b871619fcc.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iNom9Onw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AHLrfzHNuXn6BHpgmoAzHoA.png)

<figcaption>

```
FROM node:latest 
```

å‘Šè¯‰æˆ‘ä»¬ä½¿ç”¨å“ªä¸ª Docker å›¾åƒä½œä¸ºåŸºç¡€ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯å®˜æ–¹çš„ *node.js* å›¾åƒã€‚è¿™æ˜¯å› ä¸ºå®ƒå·²ç»å®‰è£…äº†æˆ‘ä»¬éœ€è¦çš„å¾ˆå¤šä¾èµ–é¡¹ï¼Œæ¯”å¦‚ *yarn* å’Œ *npm* ã€‚

```
ENV ADB\_IP="192.168.1.1"
ENV REACT\_NATIVE\_PACKAGER\_HOSTNAME="192.255.255.255" 
```

è®¾ç½®ä¸€ä¸ªå¯ä»¥åœ¨ Docker å®¹å™¨è¿è¡Œæ—¶è®¿é—®çš„ç¯å¢ƒå˜é‡ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œè¿™äº›ä¸éœ€è¦åœ¨è¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶æ³¨å…¥åˆ° Docker å®¹å™¨ä¸­ï¼Œä½†æˆ‘å–œæ¬¢å°†ç¯å¢ƒå˜é‡è®°å½•ä¸‹æ¥ã€‚

*ADB_IP* æ˜¯ Android è®¾å¤‡çš„ IPğŸ“±è¦è¿æ¥åˆ°ã€‚*REACT _ NATIVE _ PACKAGER _ HOSTNAME*ç¯å¢ƒå˜é‡éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒè®¾ç½® Expo (cli)è¿è¡Œçš„ IP åœ°å€ï¼Œè¿™æ˜¯æ‚¨çš„æ‰‹æœºå°†å°è¯•è¿æ¥çš„ IP åœ°å€ã€‚å¦‚æœè®¾ç½®ä¸æ­£ç¡®ï¼Œæ‚¨å°†å¾—åˆ°ç±»ä¼¼äºå›¾ 1 çš„é”™è¯¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åœ¨ Linux ä¸Šè®¡ç®—å‡ºæ­£ç¡®çš„ IP åœ°å€ã€‚ç¬¬ä¸€ä¸ªåº”è¯¥æ˜¯ä¸»æœº IP(æˆ‘æœºå™¨ä¸Šçš„ 192.168.27.128)ã€‚

```
hostname -I
192.168.27.128 192.168.130.128 172.17.0.1 172.19.0.1 172.18.0.1 
```

éœ€è¦è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡çš„åŸå› æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒReact Native packager(expo æ‰€ä¾èµ–çš„)é€‰æ‹©å®ƒåœ¨æœºå™¨ä¸Šçœ‹åˆ°çš„ç¬¬ä¸€ä¸ª IPï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨æ‚¨çš„ä¸»æœºä¸Šè¿è¡Œ Expoï¼Œä½†æ˜¯å½“æ‚¨åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œæ‚¨æ— æ³•è¿æ¥åˆ°å®ƒï¼Œå› ä¸ºå®ƒè¯•å›¾ä½¿ç”¨ Docker IP åœ°å€(ä»¥ 172.xxx.xxx.xxx å¼€å¤´çš„åœ°å€ä¹‹ä¸€)ã€‚

```
EXPOSE 19000
EXPOSE 19001 
```

è¿™å®é™…ä¸Šæ˜¯å…ƒæ•°æ®ï¼Œè®© Docker å®¹å™¨çš„ç”¨æˆ·çŸ¥é“ä»–ä»¬å¯ä»¥è®¿é—®è¿™äº›ç«¯å£ä¸Šçš„æ•°æ®ã€‚

```
RUN apt-get update && \
 apt-get install android-tools-adb 
```

å®‰è£… Android è°ƒè¯•æ¡¥(ADB ),ç”¨äºè¿æ¥åˆ° Android è®¾å¤‡å¹¶è°ƒè¯•åº”ç”¨ç¨‹åºã€‚

```
COPY package.json yarn.lock app.json ./
RUN yarn --network-timeout 100000 
```

å°†ä¸€äº›é‡è¦æ–‡ä»¶ä»ä¸»æœºå¤åˆ¶åˆ° Docker å®¹å™¨ã€‚*package . JSON*å’Œ *yarn.lock* ç”¨äºå®‰è£…ä¾èµ–é¡¹ï¼Œ *app.json* æ˜¯ä¸–åšä¼šæœ€ä½è¦æ±‚ã€‚

```
CMD adb connect $ADB\_IP && \
 yarn run android
 # runs expo-cli start --android 
```

[![](../Images/077b215726580497f486f3c74e7e341c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--jRMynIa---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/819/1%2AZYbIrUe9j6TmwssuPBJIXw.png) 

<figcaption>å›¾ 1:æ— æ³•è¿æ¥é”™è¯¯ğŸ˜¢</figcaption>

### è¿è¡Œ Docker

è¯¥å‘½ä»¤åœ¨ Docker æ˜ åƒç¬¬ä¸€æ¬¡è¿è¡Œæ—¶è¿è¡Œï¼Œå…¶ä»–å‘½ä»¤ç”¨äºæ„å»ºæ˜ åƒæœ¬èº«ã€‚è¿™ä½¿ç”¨äº†ä¼ å…¥ Docker å®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶é€šè¿‡$ADB_IP è¿æ¥åˆ° Android è®¾å¤‡ã€‚ç„¶åè¿è¡Œ *package.json* ä¸­çš„ *android* å‘½ä»¤ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ç®€å•åœ°è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºå’Œå¯åŠ¨ Docker å®¹å™¨ã€‚

[![](../Images/0833bf6844953e4b179c42d90699d398.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--4IEeEVKW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AIcXbBc7wMexVQhGkC51J9g.png) 

<figcaption>Docker æ„å»º/è¿è¡Œå‘½ä»¤</figcaption>

*   -t ç”¨äºå‘½åå›¾åƒ(expo-android)
*   ã€‚å‘Šè¯‰ Docker Docker æ–‡ä»¶çš„ä½ç½®(åœ¨å½“å‰ç›®å½•ä¸­)
*   â€” env è®¾ç½® Docker å®¹å™¨å¼€å§‹è¿è¡Œæ—¶ä½¿ç”¨çš„ç¯å¢ƒ(ä½¿ç”¨è¿™äº›æ–°å€¼è¦†ç›– REACT_NATIVE_PACKAGER_HOSTNAME å’Œ ADB_IP)
*   -p å‘å¸ƒç«¯å£ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå°†ä¸»æœºä¸Šçš„ç«¯å£ 19000 æ˜ å°„åˆ° Docker å®¹å™¨ä¸Šçš„ç«¯å£ 19000(è¿˜æœ‰ 19001)ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è®¿é—®ç«¯å£ 19000 å’Œ 19001ï¼Œä»¥ä¾¿ Expo (expo-cli)å¯ä»¥è¿æ¥åˆ°æˆ‘ä»¬çš„ Android è®¾å¤‡ã€‚

### ç å¤´å·¥-åŒ–åˆç‰©. yml

[![](../Images/b9c5599c5b77b85037e60cd7b5a0dbdf.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FA8OOA1R--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/790/1%2AprYM2gdRWurpCgYiI58vUA.png) 

<figcaption>ç å¤´å·¥-åŒ–åˆç‰©. yml</figcaption>

å› ä¸º expo æ˜¯ç”¨æ¥æ„å»ºæ‰‹æœºåº”ç”¨ç¨‹åºçš„ï¼ŒDocker ä¸ä¼šç”¨äºç”Ÿäº§ã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ docker-compose æ¥æ„å»ºå’Œè¿è¡Œï¼Œè¿™æ„å‘³ç€æˆ‘å¯ä»¥è¿è¡Œä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œä¸€æ­¥å®Œæˆæ„å»ºå’Œè¿è¡Œã€‚quick side docker-compose éå¸¸é€‚åˆå¼€å‘ï¼Œå°¤å…¶æ˜¯å½“æ‚¨éœ€è¦è¿è¡Œå¤šä¸ª Docker å®¹å™¨æ—¶ï¼Œä½†å®ƒå¹¶ä¸æ˜¯çœŸæ­£ä¸ºç”Ÿäº§ä¸­ä½¿ç”¨è€Œæ„å»ºçš„ã€‚çœ‹çœ‹ä½¿ç”¨ä¸€ä¸ªå®¹å™¨ç¼–æ’å·¥å…·ï¼Œæ¯”å¦‚ Kubernetesã€‚

æˆ‘è¿˜å°†ä¸»æœºä¸Šçš„å½“å‰ç›®å½•æŒ‚è½½åˆ° docker å®¹å™¨ä¸Šçš„/app/ç›®å½•ä¸­ï¼Œè¿™æ ·ï¼Œä¸»æœºä¸Šçš„ä»»ä½•æ–‡ä»¶æ›´æ”¹ä¹Ÿä¼šåœ¨ Docker å®¹å™¨ä¸­æ›´æ”¹ï¼Œè€Œä¸å¿…å†æ¬¡æ„å»º Docker å®¹å™¨ã€‚

[![](../Images/0904f95f7939a6dfc388867591a920fa.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OpBc1yQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/706/1%2A6MCPmNosDhRT9oSEKfSXyQ.png)

<figcaption>docker-æ’°å†™æ„å»º/è¿è¡Œå‘½ä»¤ã€‚</figcaption>

### [T1ã€‚åŒ…å°/åŒ…å›´ï¼ˆåŠ¨è¯ envelop çš„ç®€å†™ï¼‰](#env)

[![](../Images/d6e7c5ecd1e003c5af604496890f4858.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yCW0NdJB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AK2zO9L8rWsCtULuY3D9wrw.png) 

<figcaption>ã€‚ç¯å¢ƒ</figcaption>

ä¸€ä¸ªä¾‹å­ã€‚ç”¨äºå°†ç¯å¢ƒå˜é‡(ä½¿ç”¨ docker-compose)ä¼ é€’ç»™ docker å®¹å™¨çš„ env æ–‡ä»¶ã€‚

### é™„å½•

*   [ç”¨ç¢³ç å›¾åƒ](https://carbon.now.sh)
*   [ç å¤´å·¥äººè§£é‡Š](https://medium.freecodecamp.org/a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b)
*   [GitHub é—®é¢˜å›´ç»•æ— æ³•è¿æ¥é”™è¯¯](https://github.com/react-community/create-react-native-app/issues/81)
*   [Genymotion ä»¿çœŸå™¨](https://www.genymotion.com/)
*   [GIF è¦†ç›–å›¾åˆ›å»ºè€…](https://ezgif.com/overlay)

</figcaption>

</figcaption>