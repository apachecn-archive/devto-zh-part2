# DynamoDB PrimaryKey、HashKey、SortKey (RangeKey)

> 原文:[https://dev . to/tomerbendavid/dynamo db-primary key-hashkey-sort key-range key-1n 38](https://dev.to/tomerbendavid/dynamodb-primarykey-hashkey-sortkey-rangekey-1n38)

上周我偶然发现了发电机。在过去的几年里，我对这个行业是如何从关系型到 nosql 再到 newsql，然后扩展到各个方向，最终发展成 mysql / postgres 等等非常感兴趣。整件事既有趣又迷人。你可以称之为滑稽表演。

从我过去的经验来看，每当我们使用 kv 商店时，我们都会花大价钱，可伸缩性带来了一张支票，你为失去的功能付出代价，你通过拥有高性能而获益，所以你必须权衡经济 101。

总之，我开始阅读 DynamoDB，这是一个托管的 KV 商店，并注意到它的关键结构和索引既复杂又强大。我花了一些时间来学习(我学得慢，忘得快:)它的关键结构是如何工作的，我花了一些额外的时间来了解如何索引工作。我仍然不确定我是否得到了它。总之，我想与你分享我对它的视觉理解，以及我希望这个主题如何呈现给我:

这是在谈论 DynamoDB 时首先应该介绍的内容。首先，请注意有 3 个组件，一旦您记住了它们，我们就开始吧:

第一次学习 DynamoDB 时，您应该熟悉 3 个基本构件或术语，您的数据位于:

1.  桌子
2.  项目
3.  KV 属性。

这是一个 3 级层次结构。您存储的任何数据首先属于一个表(有些使用单个表)，然后属于一个项目，然后您的内部实际数据值在项目内部的内部 kv 属性中。

您可以通过主键获取一个或多个项目。通过主键查询获取多个条目的方法(这听起来很奇怪)，是指定散列键，然后在范围键上指定一个范围。

这就好像你的关键是分裂到:

(第一部分你必须指定它的全部，第二部分你可以在它上面指定一个范围)。

更直观的是它的复杂性，我的看法是:

```
 +----------------------------------------------------------------------------------+
    |Table                                                                             |
    |+------------------------------------------------------------------------------+  |
    ||Item                                                                          |  |
    ||+-----------+ +-----------+ +-----------+ +-----------+                       |  |
    |||primaryKey | |kv attr    | |kv attr ...| |kv attr ...|                       |  |
    ||+-----------+ +-----------+ +-----------+ +-----------+                       |  |
    |+------------------------------------------------------------------------------+  |
    |+------------------------------------------------------------------------------+  |
    ||Item                                                                          |  |
    ||+-----------+ +-----------+ +-----------+ +-----------+ +-----------+         |  |
    |||primaryKey | |kv attr    | |kv attr ...| |kv attr ...| |kv attr ...|         |  |
    ||+-----------+ +-----------+ +-----------+ +-----------+ +-----------+         |  |
    |+------------------------------------------------------------------------------+  |
    |                                                                                  |
    +----------------------------------------------------------------------------------+

    +----------------------------------------------------------------------------------+
    |1\. Always get item by PrimaryKey                                                  |
    |2\. PK is (Hash,RangeKey), great get MULTIPLE Items by Hash, filter/sort by range     |
    |3\. PK is HashKey: just get a SINGLE ITEM by hashKey                               |
    |                                                      +--------------------------+|
    |                                 +---------------+    |getByPK => getBy(1        ||
    |                 +-----------+ +>|(HashKey,Range)|--->|hashKey, > < or startWith ||
    |              +->|Composite  |-+ +---------------+    |of rangeKeys)             ||
    |              |  +-----------+                        +--------------------------+|
    |+-----------+ |                                                                   |
    ||PrimaryKey |-+                                                                   |
    |+-----------+ |                                       +--------------------------+|
    |              |  +-----------+   +---------------+    |getByPK => get by specific||
    |              +->|HashType   |-->|get one item   |--->|hashKey                   ||
    |                 +-----------+   +---------------+    |                          ||
    |                                                      +--------------------------+|
    +----------------------------------------------------------------------------------+ 
```

Enter fullscreen mode Exit fullscreen mode

所以上面发生的事情。请注意以下观察结果。正如我们所说，我们的数据属于(表，项目，KVAttribute)。那么每一项都有一个主键。现在，您构造主键的方式对您如何访问数据有意义。

如果你决定你的主键只是一个散列键，那么很好，你可以从中获得一个条目。但是，如果您决定您的主键是 hashKey + SortKey，那么您也可以对您的主键进行范围查询，因为您将通过(hashKey+SomeRangeFunction(on range key))获得您的项目。因此，您可以通过主键查询获得多个项目。

注意:我没有提到次要索引。

希望一些雾被驱散了。