# 无服务器运营:当服务器消失时，我们该怎么办？

> 原文:[https://dev . to/tmclaughbos/server less-ops-what-do-we-do-when-the-server-away-1 mln](https://dev.to/tmclaughbos/serverless-ops-what-do-we-do-when-the-server-goes-away-1mln)

[![twitter-server-trash.png](../Images/c0bb6e8501ce09e8db9ee195a2d0d9fb.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--k2cgph1F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.serverlessops.io/hs-fs/hubfs/blog/twitter-server-trash.png%3Fnoresize%26t%3D1519097594657%26width%3D640%26name%3Dtwitter-server-trash.png)

我最初是为我的公司博客写这篇文章的。它更多的是面向操作，而不是面向开发者。然而，代码的维护和维护与代码的编写一样重要。如果你要去无服务器，这些是要考虑的操作方面。如果你是一个开发者，那么这是一个无服务器操作复杂性的概述。如果你在运营部门，我知道有些人在这里，那么这是一个定义未来工作角色的尝试。

当我开始使用 AWS Lambda 并构建我的第一个无服务器服务时，我为我能够实现的交付速度感到兴奋。有了这些惊人的好处，我知道其他人也会很兴奋。结果呢？更少担心我的服务的配置容量，更多时间花在该服务的实际功能上。这种兴奋也让我开始质疑自己未来作为运营或开发工程师的角色。如果没有服务器需要管理，我该怎么办？我每天会做什么？我该如何解释我的工作？我该如何向我现在的雇主或未来的新雇主解释我的价值？

> 当服务器消失时，我该怎么办？

现在是开始讨论无服务器世界中的操作的时候了。如果我们没有，那么它将为我们定义。目前，有人提出 NoOps——将操作职责转移给软件工程师。另一端是那些相信运营团队会改变的人，他们总是被需要的。

未来的真相就在这两种方法之间——生产运作的复杂性正在改变和扩大。随着运营中的传统问题被无服务器计算抽象化，运营 SaaS 产品的团队和组织的构成将发生变化。然而，仍然存在许多问题:适当的架构设计、可观察性、部署、安全性等等。

说白了:没有运营专业知识的团队是有风险的。

运营永远不会消失；它只是在意义和实践中进化。运营原则和运营工程师仍然有巨大的价值。然而，作为一个群体，我们需要成为定义我们新角色的人。

考虑到这一点，以下是这篇文章将涵盖的内容:

*   探索在如此多的堆栈层被抽象掉的世界中的操作职责
*   关于组织角色以履行这些新职责的提议

这篇文章是定义这个新的运营角色的开始，但是请记住，这不是在无服务器架构下定义运营角色的唯一方法。我倾向于在 SaaS 的初创公司工作，并在这种背景下思考运营。这是对话的开始。人们会不同意我的观察、想法和结论，这很好。这些分歧将帮助我们为不同的人和不同的组织找到正确的答案。

以下是我对无服务器基础设施运营未来的看法。

## [](#what-is-operations)什么是“运营”？

先说一个常见的定义。我发现人们对操作有不同的理解，每个人都有自己正确的方式。定义的选择只是传达了一个人的观点。最终结果是人们谈论不同的事情。

从最高层面来说，运营是让技术支持您的业务运营。但是在那之下，术语“操作”可以有几种不同的用法。人们倾向于将这些含义混为一谈，因为在很长一段时间里，它们是紧密联系在一起的。

运营是:

*   精选部队
*   一个角色
*   一种责任
*   一组任务

传统上，运营团队的运营工程师负责运营。随着 DevOps 的推出，这种情况在过去几年发生了显著变化。我们拆除了筒仓，没有我们周围的刚性结构来保持这些意义的耦合，它们开始彼此分离。

当开发人员不再能够将代码扔给运营团队时，他们开始承担一些运营责任。这种操作职责划分的经典例子是当有人说，“开发人员首先获得他们服务的警报。”

在定义的另一端，一些组织引入了由拥有操作和软件开发技能的工程师组成的跨职能团队。这些组织没有运营团队，也不打算有。

中间角色本身变化很大。在一些组织中，这个角色的变化很小，只不过是在技能组合中增加了对自动化的理解，比如 Puppet、Chef 和 Ansible。一些团队已经将自动化作为增加传统操作职责的手段，而其他团队已经看到操作工程师更接近于开发人员，在配置管理和其他工具方面进行开发。

那么，无服务器对于这些操作的定义有什么意义呢？

## [](#what-will-operations-be-with-serverless)使用无服务器会有什么操作？

我认为无服务器世界的运营有两个方面:

1.  运营团队离开。
2.  操作角色从开发人员手中接过操作角色的主要职责。

无服务器操作不是 NoOps。这不是反 DevOps 和回到筒仓。随着传统运营团队的解散，这些工程师将需要新的住所。那些家将会是单独的开发团队，而这些开发团队将会是产品 pods 或者特性团队。这种新方法将引领跨职能团队的崛起；这是一个我们很多人都在谈论却未能实现的目标。

### [](#the-product-pod-cross-function-in-action)产品 Pod:交叉功能在起作用

许多组织已经采用了产品单元和功能团队。这些通常是跨职能的多学科团队，他们的存在是为了解决一个特定的问题或一组问题。这些团队通过不同技能、经验和视角的团队成员之间的合作而蓬勃发展。

产品 pod 在实践中是什么样子的？在我所在的组织中，他们通常由以下角色组成:

*   生产部经理
*   工程主管
*   后端开发人员(1-2 名)
*   前端开发人员(1-2 名)
*   产品设计师和/或 UX 研究员(有时是一个人)

产品经理是团队中负责拥有和代表业务需求的人。项目经理的工作是了解业务需求，并将它们转化为可行的想法。同样，你将有一个产品设计师或 UX 研究员，他们将与项目经理一起工作，将这些想法转化为成熟的设计和原型。反过来，技术领导负责估计所涉及的技术工作量，并领导工程工作。在此基础上，你就有了许多合适的后端和前端工程师。

最终结果是一个小团队专注于使用他们不同的技能来解决业务问题。团队中跨职能的技能组合会带来更强大的团队和更好的系统。

### [](#our-role-in-the-product-pod)我们在产品 Pod 中的角色

作为产品小组的成员，运营人员的角色是什么？总的来说，他们将负责团队提供的系统或服务的整体健康。操作人员将充当公用事业参与者。他们将擅长自己的主要角色，确保团队服务的可靠性。他们在团队的其他角色上也足够出色，可以在必要时增加、减少或填补有限的能力。

作为产品小组的一员，操作工程师将重新承担系统整体可靠性和性能的主要责任。这并不意味着他们每次都是第一个被呼叫的。这意味着他们将成为这些领域的专家

软件开发人员关注单个组件，而操作工程师将负责整个系统。他们将采取全面的方法来确保整个系统可靠运行并正常运行。这反过来将解放软件开发人员，让他们花更多的时间在功能开发上，花更少的时间在运营上。

## [](#the-ops-skillset)运营技能组合

那么，担任运营角色的人需要什么样的技能才能有效工作呢？让我们将其分为两组:运营人员目前拥有的支持其价值的技能，以及许多运营人员需要提升或可能开始获得的技能。

### [](#the-skills-we-bring)我们带来的技能

让我们看一下运营专家为团队带来的一系列技能。这些技能历来是运营工程师的主要技能；这些是他们专业知识的重点..

*   系统工程
*   平台/工具理解
*   人际技能(对所有角色都很重要)

我们的系统工程技能包括设计、构建、操作、扩展和调试系统。我们的角色要求我们对自己负责的系统有一个全面的了解。这意味着发现弱点、潜在的改进领域，以及理解变化如何影响系统的整体可靠性和性能。

所有工程师都在他们经常使用的平台和工具上积累了专业知识。前端工程师开发 JavaScript 和框架方面的专业知识。(或者自己发明的...)后端工程师开发构建 API 和分布式后端系统之间通信的专业知识。作为运营工程师，我们开发工具和平台方面的专业知识。在 AWS 环境中，我们磨练 CloudFormation 和 Terraform 等工具的专业知识，这些工具的初始学习曲线很陡。我们还拥有 AWS 方面的专业知识，比如理解不同服务的特性:例如，Lambda 冷启动以及它的 CPU 伸缩如何与函数内存分配相关联。

最后，还有我们的人际技能。既然我们在这里，就不要再称它们为软技能了。人很难，因为计算机的行为是相当确定的。然而，人却不是。运营工程师的大部分工作是接受人们的请求，并找出人们试图解决的实际问题。好的运营团队是服务团队，他们了解他们试图服务的人的需求。这些技能有助于加强技术团队与产品经理之间的关系。

### [](#the-skills-we-need)我们需要的技能

以下是我们需要提高甚至还需要掌握的技能。运营角色向不同方向的演变导致了这些技能的不均衡分布。

#### [](#coding)编码

毫无疑问，操作人员需要学习编码。最重要的是，他们需要学习他们团队选择的语言。不管是 Python(耶！)，JavaScript(嗯，好吧。)，Java (ummm...)，或者二郎(真的？？？)，操作人员需要精通该语言。

请记住，操作人员是一个公用事业玩家。他们不是来做开发者的。精通这种语言意味着能够阅读它，编写轻量级特性代码并修复轻量级错误，并进行一些代码审查。如果你在 fizz-buzz 上测试这个人，或者让他们用 b-tree 做一些事情，你可能做错了。然而，如果你要求他们编写一个基本功能，或者阅读一段代码，解释它，并指出潜在的系统故障点，那么恭喜你！你做得对。

从对代码恐惧的积极方面来看，纳米服务比单片甚至微服务简单得多。在许多情况下，您应该能够将您的问题隔离到单个函数，因此只需处理一小部分代码，而不是在一个大型代码库中蜿蜒前进。这应该会使理解代码更容易。

## Ops 角色职责

在无服务器环境中，一旦运营工程师加入了产品小组，他们每天会做什么？他们的工作描述是什么？

我们需要能够阐明我们组织的一系列责任；解释角色，因为没有职位描述，你就没有工作。而且，如果你不能解释，那么别人会…这可能意味着你的工作会因为“NoOps”而被解释掉。

大部分 ops 角色将收回开发人员开始拥有的过去的职责。同样，运营人员不会是负责这些领域的唯一人员，但他们将是主要负责人，负责帮助他们的同事在适当的时候应对这些挑战。

### [](#systems-standards-and-best-practices)系统标准和最佳实践

运营工程师将负责建立系统标准和最佳实践，以构建可靠和高性能的无服务器系统。我们应该定义要使用的正确模式(以及何时使用)，并确保这些模式得到遵守。

以一个简单的任务为例，比如在无服务器系统的不同部分之间传递事件。一般人会做他们知道的事情，并且坚持他们上次做的事情。但是，在 AWS 上，即使这样简单的任务也可以用多种方式解决。SNS 优于 SQS 的利弊是什么？Lambda 扇出函数怎么样？也许应该将事件写入像 S3 或 DynamoDB 这样的持久存储中，并使用这些动作中的事件来触发更多的工作动作？

正确的选择是什么？这取决于你要解决的问题和约束条件。(根据记录，我通常讨厌 Lambda 扇出函数，因为它们需要在扇出函数中进行更多的错误处理，以避免丢失事件，而不仅仅是让系统的设计处理弹性。)

### [](#build-deploy-and-management-tooling)构建、部署和管理工具

作为工程师，我们都面临的主要障碍之一是什么？了解我们的工具。我们的工具通常非常复杂，但是我们尽可能多地学习我们真正需要的知识来完成工作。

像无服务器框架和 CloudFormation 这样的工具可能很复杂。我发现许多开发人员并不完全喜欢它们。你的开发队友将硬编码的东西，并阻挠 CFN 内置的许多问题解决。如果你知道如何正确使用它，云的形成是非常灵活的。无服务器框架通过其插件功能极大地改进了 CloudFormation。编写无服务器框架插件来解决组织问题将取代编写木偶事实和厨师`knife`插件。

还将有测试和部署工作要做。从 Python、Node 或 Go 的标准测试框架开始。但是等等，还有呢！负载测试呢？如果您服务的计算层可以快速扩展，这对您的数据层意味着什么？您的 DynamoDB 表能跟上 Lambda 对它的写操作吗？由于写限制，那些失败的写操作会发生什么？你的 SQS 消费者能跟上队伍吗？实施像*cannon*这样的工具来发现扩展问题，然后由运营人员负责解决，这将成为角色的一部分。

一旦所有测试都通过了，就该推出新代码了。最终，组织会想要蓝/绿部署系统、特性标志等等，以确保向生产用户优雅地展示代码。需要有人来建造它。

### [](#scaling-and-performance-tuning-systems)扩展和性能调优系统

我将这两者组合在一起，因为它们都是修改已经运行的系统的一部分，并且因为它们可以归结为满足新建立的系统度量目标。将系统从服务数量级的事件扩展到服务数量级的事件，与试图将响应时间减少几毫秒是同一类工作。有一个确定的基线、一个目标和一个需要修改以满足目标的系统。

无服务器系统缩小了扩展系统的工作范围。单个系统组件可自行扩展。您不负责扩展您的消息传递、队列、存储或数据库层。那么，还有什么需要优化，如何扩展呢？

Lambda 可以增加它们的内存量，这也增加了 Lambda 可用的 CPU 量。在推出旧的计算实例时，无需创建新的计算实例，只需通过无服务器框架或 CloudFormation 进行简单的点击或堆栈部署即可更改内存。此外，您还将考虑用不同的服务替换系统的组件。如果 SNS 太慢，那么也许是时候评估 Kinesis 了？或者也许整个系统及其事件路径需要重新思考？

需要评估代码的变化，从修复低效的函数到用不同语言编写的函数替换单个函数。在扩展 Lambda 内存的某一点上，一个额外的 CPU 内核变得可用。也许应该用一种能有效利用额外内核的语言来重写一个函数？(与重写整个微服务相比，重写单个 nanoservice 函数的能力是不是很酷！？！？)

但是，这种轻松扩展的能力带来了新的潜在问题。您系统中的下游服务能够处理新的规模或性能吗？有人需要将系统作为一个整体来看待，并理解上游的变化将如何影响下游。

### [](#reliability-of-systems)系统的可靠性

我们一直在处理我们系统的监控、度量、记录和可观察性，并将继续这样做。我们要寻找的问题会改变。我们将寻找函数执行时间长度、冷启动和函数内存不足异常，而不是主机 CPU 和内存利用率。ops 人员将负责为团队选择合适的工具，并解决出现的问题。如果一个函数开始抛出内存不足异常，那么 ops 人员应该负责通过增加函数内存(简单但更昂贵的方法)或者通过重构给定的函数来解决这个问题。

此外，我们使用的为微服务设计的指标和日志记录解决方案中，有多少适合纳米服务？纳米服务是功能，我们被告知最好的功能只做一件事。那么为什么你的函数要负责做它的命名函数呢？...写度量，写日志，写错误？当然，有 CloudWatch，但它的延迟对许多团队来说不够短。也许我们需要重新思考如何将这些应用交付给其他平台。

### [](#coding-and-code-review)编码和代码审查

不可避免的是，运营工程师将需要编码，并参与编码过程的其他领域。这在实践中看起来会因团队和需求而异，当然，应该有一些既定的最小值。

团队的操作工程师应该精通团队的编码语言。他们应该能修理光虫。在处理可靠性角色的同时调查错误日志的过程中，操作工程师应该能够查看有问题的代码区域，并解决容易解决的问题，而不仅仅是给软件工程师开罚单。如果他们不能，那么他们应该能够写一份详细的罚单，解释问题以及他们认为 3 代码哪里出了问题。

> *“这应该包装在 try/except 块中，以处理 API 故障。让我补充一下。”*

理想情况下，我们最终应该能够编写更简单的任务和功能。我加上这个是因为它提高了我们的技能，让我们保持敏锐。在团队需要出货的时候也有实用价值。可以交给初级工程师(甚至实习生)的工作可以交给运营工程师来增加开发人员的产出。

> “我可以建立一个 REST 端点来接收 webhook 数据，解析它，执行一些 web 请求来增强数据，并将其发布到另一个系统。” *(* [)灵感来自爱丽丝·戈德福斯](https://twitter.com/alicegoldfuss/status/932079153582452736) *。)*

最后，还有代码审查。我们应该带来我们所使用的平台如何工作的独特知识和视角，并且把代码看作更大系统的一部分。

> *“当您将记录添加到 Route53 时，该操作将排队。您需要使用回调并检查操作是否成功。以下是你需要做的。”*
> 
> *“这个函数应该有重试次数，因为我们最终可能会失败，但是你不能安全地重试这个函数，因为由于之前的这个点，我们最终会得到重复的 DynamoDB 记录。”*

一个摩擦的领域是开发人员不正确地评估一个操作工程师的价值和技能，仅仅基于他们的编码能力。操作工程师只是一个兼职开发人员，他们应该被如此对待。如果一个团队需要一个高级开发人员来做高级开发人员的工作，那么就把这项工作交给一个高级开发人员。团队中的开发人员需要认识到他们的操作工程师的价值和他们带来的专业知识。否则，操作工程师将注定失败，团队作为一个整体将无法实现其他更有凝聚力的团队所能实现的。

### [](#security)安全

关于安全性的好消息是:ops 可以不再把时间和精力放在运行代码的主机上。这是 AWS 现在的责任。以最近的 Meltdown 和 Spectre 攻击为例，想想人们花在推出、回滚和再次推出补丁上的时间。在 AWS 执行其工作时，ops 人员将继续确保服务的性能和可靠性保持在可接受的参数范围内，而不是修补系统。这意味着监控可接受的 Lambda 调用失败率，然后执行时间保持在可接受的水平。当然，这是作为标准可靠性责任的一部分已经在做的工作。这有效地释放了时间。

然而，这段时间很快就会被填满。节省下来的时间将花在我们以前没有足够时间去做的任务上。你审计过你的 S3 水桶吗？你有任何不应该公开的信息吗？你的 Lambda 函数有最小权限访问的 IAM 角色吗？我们可以花更多时间保护非 EC2 资源。

有了这些额外的时间，ops 也可以沿堆栈向上进入 AppSec。最容易摘到的果子:应用程序依赖关系是否是最新的*和*没有漏洞？目前，运营部门花时间修补主机，但往往没有足够的时间来确保应用程序依赖关系保持最新。Ops 将致力于秘密管理等任务，并确保秘密得到妥善存储和轮换。

这些任务仅仅是示例；这并不是说它们目前没有被处理。在许多组织中，它们只是在不同的级别上得到处理。

### [](#system-cost-management)系统成本管理

围绕按使用付费模式，无服务器带来了一些新的有趣的成本挑战。

首先，存在防止 Lambda 函数失控的技术挑战。递归函数是一种东西，是特定工作负载的有效设计选择。但是任何时候你看到一个，你应该确保循环将退出，否则你可能会在你的账单上有一些惊喜。(哎哟！这最近发生在我身上...)

问题也不仅仅是代码。SQS 队列中格式错误的消息可能会导致队列永不耗尽，并且函数会持续执行。了解您的系统意味着知道如何以及何时对异常的功能活动发出警报。如果您正在处理定期消息转储中的队列，那么您的使用者应该表现出某种行为——比如超过一定时间不执行。如果他们没有遵循这种模式，那么也许有什么需要调查的？

从成本角度来看，确定系统何时更适合在容器中运行甚至在 EC2 实例上运行也很困难。Lambda 的按使用付费模型在实际调用时会产生溢价。

最后，无服务器为您提供了一种独特的测量能力，不仅可以测量系统级别，还可以测量功能级别。我喜欢称之为“应用程序美元监控”。如果您跟踪每次函数调用的成本和一段时间内的整体系统成本，然后覆盖特性部署事件，您就能够在更精细的级别上理解系统成本的变化。潜在地，一个组织甚至可以将特性与收入联系起来，并且能够对特性价值和特性工作做出更明智的决策。不可否认的是，现在你谈论的是小金额，相比 EC2 节省的成本可能已经足够了，以至于在特性层面上根本不在乎。然而，在未来，当我们习惯了无服务器的低成本，我们会开始更加关心。

## [](#conclusion)结论

这篇文章中有很多假设的、无法解释的、不设防的内容。在接下来的几个月里，我们将扩展这里的想法和主题。这篇文章很有希望引起人们的疑问，需要进一步的回答。最后，这篇文章中的想法在实践中是什么样子，以及如何实现，需要实际的解释。

对你刚刚读到的有什么想法？[在 Twitter 上找到我](https://twitter.com/tmclaughbos)，我们来聊聊。我们也很乐意发表您对未来无服务器运营的想法，您的想法不一定要与我们的一致！只需在 [hello@serverlessops.io](//mailto:hello@serverlessops.io) 上留言即可。

继续回来了解更多！

感谢在我写这篇文章时提供反馈的几个人。他们分别是 [【布莱恩·哈特菲尔德】](https://twitter.com/brianhatfield)*[特拉维斯·坎贝尔](https://twitter.com/hcoyote) *等人在# atxdevops on*[HangOps](https://twitter.com/hangops)*[瑞安·斯科特·布朗](https://twitter.com/ryan_sb)*[本·布里兹](https://twitter.com/ikB3N)*[罗布·帕克](https://twitter.com/robpark)*[格温·贝茨](https://twitter.com/gwennasaurus) *。******

 ***这最初出现在 [ServerlessOps 博客](https://www.serverlessops.io/blog)上。请访问以阅读更多我们的作品！*

[![](../Images/b62e18a737030f426f83954aecdddd10.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--uz8tgiS8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://track.hubspot.com/__ptq.gif%3Fa%3D277116%26k%3D14%26r%3Dhttps%253A%252F%252Fwww.serverlessops.io%252Fblog%252Fserverless-ops-what-do-we-do-when-the-server-goes-away%26bu%3Dhttps%25253A%25252F%25252Fwww.serverlessops.io%25252Fblog%26bvt%3Drss)**