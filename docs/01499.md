# å¸¦æ ‘è“çš®å’Œæ¡‘å·´çš„å®¶åº­å‚¨ç‰©ä»¶

> åŸæ–‡:[https://dev . to/petarov/shared-home-storage-with-raspberry-pi-and-samba-38d 9](https://dev.to/petarov/shared-home-storage-with-raspberry-pi-and-samba-38d9)

# ç›®å½•

*   [ç›®æ ‡](#goal)
*   [æ ‘è“æ´¾](#rpi)
    *   [ç§»é™¤ X11](#remove-x11)
    *   [å­˜å‚¨ç”¨æˆ·](#storage-user)
*   [æ¡‘å·´æœåŠ¡å™¨](#samba-server)
    *   [å®‰è£…](#samba-server-install)
    *   [é…ç½®](#samba-server-conf)
*   [Clinets](#clients)
    *   [Linux å®¢æˆ·ç«¯](#linux-client)
        *   [æŸ¥çœ‹è‚¡ä»½](#linux-client-shares)
        *   [fstab å®‰è£…](#linux-client-fstab)
    *   [å®‰å“å®¢æˆ·ç«¯](#android-client)
    *   [iOS å®¢æˆ·ç«¯](#ios-client)
*   [å‚è€ƒæ–‡çŒ®](#refs)

# ç›®æ ‡

è¿™é‡Œçš„æƒ³æ³•å¾ˆç®€å•ã€‚åœ¨ Raspberry Pi[ã€1ã€‘](#refs)è®¾å¤‡ä¸Šå®‰è£…ä¸€ä¸ªä¸­å¤®å­˜å‚¨å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®¶é‡Œäº¤æ¢æ–‡ä»¶ï¼Œè€Œä¸ç”¨ä½¿ç”¨*äº‘*æˆ– *Skype* æˆ–ä»»ä½•å…¶ä»–æ¶ˆæ¯æœåŠ¡ã€‚æ•´ä¸ªäº‹æƒ…å¹¶ä¸éš¾è®¾ç½®ï¼Œæˆ‘æ¨èç»™æ¯ä¸ªäººï¼Œå¯ä»¥æŠ½å‡ºä¸€äº›æ—¶é—´å’Œç²¾åŠ›æ¥åšè¿™ä»¶äº‹ã€‚

æˆ‘æƒ³æ‹¥æœ‰çš„ä¸œè¥¿:

1.  æ”¾ç½®å’Œäº¤æ¢æ–‡ä»¶çš„ä¸­å¤®å­˜å‚¨ã€‚
2.  å¯é€šè¿‡æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡è®¿é—®ã€‚
3.  ä»…åœ¨å†…éƒ¨ç½‘ç»œä¸Šå¯ç”¨ã€‚
4.  ç”¨æˆ·/å¯†ç ä¿æŠ¤ã€‚
5.  ä¸€ä¸ªæœ€ç»ˆç”¨æˆ‘å¾—åˆ°çš„ RPi åšäº›äº‹æƒ…çš„ç†ç”±ã€‚

[![Samba share scheme](../Images/1a0f9477ebbaf71840d97caac8e6a030.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WjsysnSB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kxofvivme0llfdl6x154.png)

æœ€åˆï¼Œæˆ‘æƒ³åœ¨ RPi è®¾å¤‡ä¸Šå®‰è£…ä¸€ä¸ªä¸“ç”¨çš„äº‘æˆ–å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œæˆ‘å‘ç°é…ç½®ä¸€ä¸ª Samba æœåŠ¡å™¨æ›´åŠ ç®€å•å’Œç›´è§‚ã€‚

# æ ‘è“æ´¾

å®‰è£…ä¸€ä¸ª Raspbian Liteã€T1ã€2ã€‘ï¼Œç”¨`dd`æŠŠå›¾åƒå¤åˆ¶åˆ°ä½ çš„ SD å¡ä¸Šã€‚æŸ¥çœ‹å®˜æ–¹å®‰è£…æŒ‡å—[ã€3ã€‘](#refs)ã€‚

åœ¨ Linux ä¸Šï¼Œä»¥ä¸‹å†…å®¹åº”è¯¥è¶³å¤Ÿäº†:

```
dd bs=4M if=2018-10-09-raspbian-stretch.img of=/dev/sd? conv=fsync 
```

å°å¿ƒ`sd?`éƒ¨åˆ†ï¼ç¡®ä¿é‚£æ˜¯ä½ çš„ SD å¡è®¾å¤‡ã€‚

## åˆ é™¤ X11(å¯é€‰)

ç¼–è¾‘:å¦‚æœä½ ä¸‹è½½äº† Raspbian Liteï¼Œä½ ä¸éœ€è¦åœ¨è¿™é‡Œåšä»»ä½•äº‹æƒ…ã€‚

å¦‚æœæ‚¨æƒ³åœ¨æ²¡æœ‰æ¡Œé¢ç¯å¢ƒçš„æƒ…å†µä¸‹ä»…å°† Raspbian ç”¨ä½œæœåŠ¡å™¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ä½ ä¹Ÿå¯èƒ½ä¼šé‡Šæ”¾é«˜è¾¾ 500 å…†çš„ SD å¡ç©ºé—´ã€‚

```
sudo apt-get remove --purge x11-common
sudo apt-get autoremove 
```

## å­˜å‚¨ç”¨æˆ·

æ·»åŠ åä¸º`storeuser`çš„æ–°ç”¨æˆ·ã€‚æ‰€æœ‰å…±äº«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹éƒ½å°†å­˜å‚¨åœ¨è¯¥ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚

```
sudo adduser storeuser 
```

å¯¹è¿™ä¸ªäººç¦ç”¨ shell ç™»å½•ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚æœ€åï¼Œæˆ‘ä»¬åªæƒ³å°†è¿™ä¸ªç”¨æˆ·ä½œä¸º Samba å…±äº«é…ç½®çš„åŸºç¡€ã€‚

```
sudo usermod -s /usr/sbin/nologin storeuser 
```

å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸ªäººæ–‡ä»¶å¤¹`/home/storeuser`ã€‚æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª`share`æ–‡ä»¶å¤¹ï¼Œå…±äº«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å°†ä¿å­˜åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ã€‚

```
sudo cd /home/storeuser && mkdir share 
```

è°ƒæ•´å¯¹å…±äº«æ–‡ä»¶å¤¹çš„è¯»/å†™æƒé™:

```
sudo chown -R storeuser /home/storeuser/share
sudo chgrp -R storeuser /home/storeuser/share
sudo chmod -R 1770 /home/storeuser/share 
```

å…³äº`1770`æƒé™ã€‚æˆ‘ä»¬å°†ç²˜æ€§ä½[ã€4ã€‘](#refs)è®¾ç½®ä¸º`1`ï¼Œåªå…è®¸è¿™ä¸ªæ–‡ä»¶å¤¹`storeuser`çš„æ‰€æœ‰è€…ç¼–è¾‘æˆ–åˆ é™¤æ–‡ä»¶ã€‚

åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶ï¼Œä¾‹å¦‚è‡ªè¿°æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨å…±äº«æ–‡ä»¶å¤¹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ–‡ä»¶ç”¨äºæµ‹è¯•ã€‚

```
sudo touch /home/storeuser/share/README 
```

# æ¡‘å·´æœåŠ¡å™¨

è®¾ç½® Samba å…±äº«æœ‰å¤šç§æ–¹æ³•ã€‚å‡ºäºæˆ‘çš„éœ€è¦ï¼Œæˆ‘é€‰æ‹©äº†å•ç”¨æˆ·å¯†ç ä¿æŠ¤çš„å…±äº«æœºåˆ¶ï¼Œä½†æ˜¯æ‚¨å¯ä»¥å°†å…¶æ‰©å±•åˆ°ä½¿ç”¨ç»„å’Œæ›´å¤æ‚çš„èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚

## å®‰è£…

```
sudo apt-get install samba samba-common-bin 
```

## é…ç½®

ç¼–è¾‘`smb.conf`æ–‡ä»¶:

```
nano /etc/samba/smb.conf 
```

æ²¡é”™ï¼æˆ‘ç”¨äº†`nano`ã€‚æˆ‘è¿˜æ˜¯æ— æ³•åœ¨å¦ä¸€ä¸ªç»ˆç«¯é€€å‡º`vim`ã€‚å¤„ç†å¥½å®ƒã€‚ğŸ˜Š

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå°†æ‚¨çš„ç½‘ç»œæ·»åŠ åˆ°å…è®¸çš„ä¸»æœº:

```
[global]

hosts allow = 192.168.1\. 127. 
```

æˆ‘åœ¨å®¶é‡Œä½¿ç”¨çš„æ˜¯å•å­ç½‘ç½‘ç»œã€‚æ ¹æ®æ‚¨çš„ç½‘ç»œé…ç½®è¿›è¡Œè°ƒæ•´ã€‚

æ·»åŠ ä¸€ä¸ª`workgroup`åç§°å¹¶å¯ç”¨ Windows äº’è”ç½‘åç§°æœåŠ¡:

```
[global]

hosts allow = 192.168.1\. 127.
workgroup = homeworld.net
wins support = yes 
```

ç°åœ¨é…ç½®å…±äº«ã€‚åœ¨`smb.conf`æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
[mystorage]
   comment= my home storage
   path=/home/storeuser/share
   browseable=Yes
   writeable=Yes
   only guest=no
   create mask=1770
   directory mask=1770
   public=no 
```

`path`æŒ‡å®šæœåŠ¡ç”¨æˆ·å°†è¢«æˆäºˆè®¿é—®æƒé™çš„ç›®å½•ã€‚`browseable`æ§åˆ¶è¯¥å…±äº«æ˜¯å¦å‡ºç°åœ¨ç½‘ç»œè§†å›¾çš„å¯ç”¨å…±äº«åˆ—è¡¨å’Œæµè§ˆåˆ—è¡¨ä¸­ã€‚

å‘æœ¬åœ° Samba `smbpasswd`æ–‡ä»¶æ·»åŠ ä¸€ä¸ªæ–°çš„`storeuser`å¯†ç ã€‚è¯¥ç”¨æˆ·å¿…é¡»å·²ç»å­˜åœ¨äºç³»ç»Ÿä¸­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„`storeuser`ã€‚

```
smbpasswd -a storeuser 
```

è¿™æ­£æ˜¯å®¢æˆ·ç«¯å°†ç”¨æ¥è®¿é—® Samba å…±äº«çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

# å«–å®¢

## Linux å®¢æˆ·ç«¯

æˆ‘åœ¨å®¶é‡Œç»å¸¸ä½¿ç”¨ Arch Linuxï¼Œæ‰€ä»¥ä¸‹é¢çš„æè¿°ä¸»è¦é’ˆå¯¹è¿™ç§æƒ…å†µã€‚ç„¶è€Œï¼Œè¿™åœ¨å…¶ä»– Linux å‘è¡Œç‰ˆä¸Šåº”è¯¥ä¸ä¼šæœ‰å¤ªå¤§çš„ä¸åŒã€‚

### æŸ¥çœ‹è‚¡ç¥¨

æˆ‘ä»¬å¯ä»¥é¦–å…ˆé€šè¿‡ä½¿ç”¨`smbtree`æ¥æŸ¥çœ‹ç½‘ç»œä¸­å¯ç”¨çš„å…±äº«ã€‚å°±è¿™æ ·ï¼Œä¸ºäº†ä¹è¶£å’Œè£è€€ã€‚

```
smbtree -U storeuser 
```

å‡ºç°æç¤ºæ—¶ï¼Œç»™å‡ºæ‚¨ä¹‹å‰ä½¿ç”¨`smbpasswd`è®¾ç½®çš„`storeuser`å¯†ç ã€‚ç»“æœåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
MYDOMAIN.TLD
    \\RASPBIAN              my raspbian server
        \\RASPBIAN\storeuser        Home Directories
        \\RASPBIAN\IPC$             IPC Service
        \\RASPBIAN\mystorage        my home storage 
```

è¿™å°†æ‰“å°ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²çŸ¥åŸŸã€è¿™äº›åŸŸä¸­çš„æœåŠ¡å™¨ä»¥åŠè¿™äº›æœåŠ¡å™¨ä¸Šå¯ç”¨çš„å…±äº«çš„æ ‘ã€‚

### fstab æŒ‚è½½

åˆ›å»ºç›®æ ‡è£…è½½æ–‡ä»¶å¤¹ã€‚

```
sudo mkdir /mnt/storage 
```

é€šè¿‡å°†å…±äº«æ·»åŠ åˆ°`/etc/fstab`æ¥è®¾ç½®è‡ªåŠ¨æŒ‚è½½ã€‚

```
//RASPBIAN/mystorage /mnt/storage cifs username=storeuser,password=<password>,comment=noauto,x-systemd.automount,_netdev,uid=<your linux user>,gid=<your linux user group> 0 0 
```

å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨`systemd`(å¯¹æ­¤æˆ‘ä¸æ€ªä½ ğŸ˜‰)ï¼Œæ‹†ä¸‹`noauto,x-systemd.automount`éƒ¨åˆ†ã€‚

*å¥½å§ï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆ`_netdev`è¯¡è®¡ï¼Ÿ*

åŸºæœ¬ä¸Šï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›æ¨è¿Ÿè£…è½½å…±äº«ï¼Œç›´åˆ°ç½‘ç»œæ¥å£å¯åŠ¨[ã€5ã€‘](#refs)ã€‚å¦‚æœè¿˜æ²¡æœ‰å»ºç«‹è¿æ¥ï¼Œå°è¯•å®‰è£…æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ˜¾å¼è£…è½½å…±äº«:

```
sudo mount -a 
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æˆ‘ä»¬ä¹‹å‰åœ¨`/mnt/storage`ä¸­åˆ›å»ºçš„æ ·æœ¬`README`æ–‡ä»¶ã€‚

## å®‰å“å®¢æˆ·ç«¯

æœ‰è®¸å¤š Android å·¥å…·å¯ä¾›é€‰æ‹©ã€‚å‡ ä¹æ‰€æœ‰æ”¯æŒ SMB å…±äº«çš„ä¸œè¥¿éƒ½åº”è¯¥å¯ä»¥å·¥ä½œã€‚è¿‡å»æˆ‘ç”¨çš„æ˜¯ ES æ–‡ä»¶æµè§ˆå™¨[ã€6ã€‘](#refs)ï¼Œä½†æ˜¯æˆ‘å‘ç°å¹¿å‘Šå¤ªç¢äº‹äº†ï¼Œæ‰€ä»¥æˆ‘æ¢æˆäº†æ–‡ä»¶ç®¡ç†å™¨[ã€7ã€‘](#refs)

è¿™é‡Œæœ‰ä¸€ä¸ª ES æ–‡ä»¶èµ„æºç®¡ç†å™¨çš„å¿«é€Ÿè®¾ç½®æ¦‚è¿°ã€‚

*   ä»åº”ç”¨èœå•ä¸­é€‰æ‹©`Network` / `LAN`ï¼Œç„¶åç”¨`New`æ·»åŠ ä¸€ä¸ªæ–°è¿æ¥ã€‚
*   é”®å…¥ RPi è®¾å¤‡çš„æœåŠ¡å™¨åç§°æˆ– IP åœ°å€ã€‚
*   é”®å…¥`storeuser`ç”¨æˆ·åå’Œå¯†ç ã€‚

[![ES File Explorer](../Images/4379ca8a73a0934f211280370f5601b6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aapH-BRz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/f1abbbbux0zncxhbyi2d.png)

ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä»¥è¯»/å†™æƒé™è®¿é—® Samba å…±äº«äº†ã€‚

è®¾ç½®æ–‡ä»¶ç®¡ç†å™¨ä¹Ÿå¾ˆå®¹æ˜“ã€‚åªéœ€ä»èœå•ä¸­ä½¿ç”¨`Network place`é€‰æ‹©æ‚¨çš„å…±äº«å¹¶è¾“å…¥å‡­è¯ã€‚

[![File Manager](../Images/5e4b42f8d5ada5b8d279938fb2d424dd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--yGcAdd29--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ouip5s8b60qpsh74u8gk.png)

## iOS å®¢æˆ·ç«¯

æˆ‘æ­£åœ¨ä½¿ç”¨å…è´¹çš„æ–‡ä»¶æµè§ˆå™¨[ã€7ã€‘](#refs)ä» iOS è®¾å¤‡è®¿é—® Samba å…±äº«ã€‚å…è´¹ç‰ˆä»…é™ä¸€ä»½ï¼Œå¯¹æˆ‘æ¥è¯´å·²ç»è¶³å¤Ÿå¥½äº†ã€‚

é…ç½®ç›¸å½“å®¹æ˜“ã€‚æ·»åŠ æ–°çš„`Linux/Unix`å…±äº«å¹¶é…ç½® RPi è®¾å¤‡çš„æœåŠ¡å™¨åç§°æˆ– IP åœ°å€ã€‚

é”®å…¥`storeuser`ç”¨æˆ·åå’Œå¯†ç ã€‚

[![File Explorer Free](../Images/d211b64fa8fa2bf18269db849e3b8c96.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FswXAWEC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1new2cle3m70y05t36ur.jpg)

ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä»¥è¯»/å†™æƒé™è®¿é—® Samba å…±äº«äº†ã€‚

ä½ çŸ¥é“å…¶ä»–å¥½çš„å·¥å…·å—ï¼Ÿå…è´¹æˆ–ä»˜è´¹ã€‚åœ¨ä¸‹é¢ç•™è¨€ã€‚

# å‚è€ƒæ–‡çŒ®

1.  [raspberrypi.org](https://www.raspberrypi.org)
2.  [raspberrypi.org/downloads](https://www.raspberrypi.org/downloads/raspbian)
3.  [raspberrypi . org/documentation/installation/installing-images/readme . MD](http://www.raspberrypi.org/documentation/installation/installing-images/README.md)
4.  [en.wikipedia.org/wiki/Sticky_bit](http://en.wikipedia.org/wiki/Sticky_bit)
5.  [coding Berg . com/Linux/systemd _ when _ to _ use _ net dev _ mount _ option](http://codingberg.com/linux/systemd_when_to_use_netdev_mount_option)
6.  ç”¨äº Android çš„ ES æ–‡ä»¶æµè§ˆå™¨
7.  å®‰å“ç³»ç»Ÿçš„æ–‡ä»¶ç®¡ç†å™¨
8.  [iOS ç‰ˆå…è´¹æ–‡ä»¶æµè§ˆå™¨](https://itunes.apple.com/us/app/fileexplorer-free/id510282524?mt=8)
9.  æ¡‘å·´å¥—ä»¶é…ç½®æ–‡ä»¶å¼•ç”¨-[samba.org/samba/docs/man/manpages-3/smb.conf.5.html](https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html)
10.  Arch Linux èŠ½ï¼Ÿæ¡‘å·´ç»´åŸº-[wiki.archlinux.org/index.php/samba](https://wiki.archlinux.org/index.php/samba)