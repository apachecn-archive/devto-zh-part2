# åœ¨ Heroku ä¸Šéƒ¨ç½² Dart 2 åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/graphic beacon/deploying-dart-apps-to-heroku-23ih](https://dev.to/graphicbeacon/deploying-dart-apps-to-heroku-23ih)

ä½œä¸ºæ¢ç´¢ Dart å®¢æˆ·ç«¯å¼€å‘çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘èŠ±äº†ä¸¤å‘¨æ—¶é—´å¼€å‘äº†ä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œæˆ‘å·²ç»å°†å®ƒ[éƒ¨ç½²åœ¨ Heroku ä¸Š](https://memorygameweb.herokuapp.com),æˆ‘æƒ³å‘æ‚¨å±•ç¤ºå¦‚ä½•åšåŒæ ·çš„äº‹æƒ…ã€‚æˆ‘ä¸ä¼šè®²è¿°æˆ‘æ˜¯å¦‚ä½•ç¼–å†™è¿™ä¸ªåº”ç”¨ç¨‹åºçš„ï¼Œå› ä¸ºè¿™é‡Œçš„é‡ç‚¹æ˜¯éƒ¨ç½²ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å°†åœ¨æ–‡ç« æœ«å°¾é“¾æ¥åˆ°æºä»£ç ğŸ˜‰

## [](#prerequisites)å…ˆå†³æ¡ä»¶ğŸ”¥

ä½ éœ€è¦è¿™äº›æ¥å¼€å§‹:

1.  [Dart 2 SDK](https://www.dartlang.org/tools/sdk#install)
2.  [å»](https://git-scm.com/downloads)
3.  [Heroku è´¦å·](https://signup.heroku.com/)
4.  [è‹±é›„åº“ CLI](https://devcenter.heroku.com/articles/heroku-cli)

è®¾ç½®å¥½ä¹‹åï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸Šè¿è¡Œ`heroku login`ï¼Œä½¿ç”¨æ‚¨çš„å‡­è¯ç™»å½•ã€‚

* * *

## [](#1-set-up-your-web-project)1ã€‚è®¾ç½®æ‚¨çš„ web é¡¹ç›®

åœ¨ç»ˆç«¯ä¸­å¯¼èˆªåˆ°æ‚¨çš„é¡¹ç›®ã€‚å¦‚æœä½ æ²¡æœ‰ï¼Œä½ å¯ä»¥[å¤åˆ¶æˆ‘çš„åŒ…å«æˆ‘çš„è§£å†³æ–¹æ¡ˆçš„å›è´­](https://github.com/graphicbeacon/dart_web_project),ç›´æ¥è·³åˆ°ç¬¬ 3 æ­¥ã€‚

æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **stagehand** è„šæ‰‹æ¶å·¥å…·:
ç”Ÿæˆä¸€ä¸ªæµ‹è¯•é¡¹ç›®

```
$ pub global activate stagehand
$ mkdir web_project && cd web_project
$ stagehand web-simple 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#2-write-an-http-server)2ã€‚å†™ä¸€ä¸ª HTTP æœåŠ¡å™¨

å°†ç”Ÿæˆçš„`pubspec.yaml`æ–‡ä»¶çš„ä¾èµ–å…³ç³»ä¿®æ”¹ä¸º:

```
dependencies:
  shelf: any
  shelf_static: any 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œ`pub get`æ¥æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬ä½¿ç”¨**è´§æ¶**æ¥ç®€åŒ–åˆ›å»º web æœåŠ¡å™¨ã€‚

ç”¨ç”Ÿæˆæˆ‘ä»¬çš„æœåŠ¡å™¨:
çš„é€»è¾‘åˆ›å»º`bin/main.dart`

```
import 'dart:io' show Platform;
import 'dart:async' show runZoned;
import 'package:path/path.dart' show join, dirname;
import 'package:shelf/shelf_io.dart' as io;
import 'package:shelf_static/shelf_static.dart';

void main() {
  // Assumes the server lives in bin/ and that `webdev build` ran
  var pathToBuild = join(dirname(Platform.script.toFilePath()), '..', 'build');

  var handler = createStaticHandler(pathToBuild, defaultDocument: 'index.html');

  var portEnv = Platform.environment['PORT'];
  var port = portEnv == null ? 9999 : int.parse(portEnv);

  runZoned(() {
    io.serve(handler, '0.0.0.0', port);
    print("Serving $pathToBuild on port $port");
  }, onError: (e, stackTrace) => print('Oh noes! $e  $stackTrace'));
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#3-run-the-project-locally)3ã€‚åœ¨æœ¬åœ°è¿è¡Œé¡¹ç›®

å®‰è£… **webdev** å·¥å…·:

```
$ pub global activate webdev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆæˆ‘ä»¬çš„åŒ…:

```
$ webdev build # or `pub global run webdev build` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†äº§ç”Ÿä¸€ä¸ª`build`æ–‡ä»¶å¤¹ã€‚

[![Production bundle generated with webdev tool](../Images/30dc89b27c993c4d5ddcc5dec4ae2d4e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--0tcfw4WM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ll3793zxvasgw4yfpgt4.png)

è¿è¡Œ`dart bin/main.dart`å¹¶è®¿é—®`http://localhost:9999`

[![Image of localhost:9999](../Images/4a7227da01a6b810800005cd42883699.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zVo7M4nm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/oxepyr1nnqtqfvf3clov.png)

## [](#4-create-your-heroku-app)4ã€‚åˆ›å»ºæ‚¨çš„ Heroku åº”ç”¨ç¨‹åº

è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨:

```
$ heroku create
Creating secure-spire-84236... done, stack is cedar-14
http://secure-spire-84236.herokuapp.com/ | https://git.heroku.com/secure-spire-84236.git
Git remote heroku added 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªéšæœºåç§°ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ä¸º`secure-spire-84236`ã€‚

æœ€åï¼Œæäº¤æ‚¨çš„é¡¹ç›®å¹¶æ·»åŠ `heroku` remote:

```
$ git init
$ git add .
$ git commit -m "Initial commit."

$ heroku git:remote -a secure-spire-84236 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#5-configure-the-buildpack)5ã€‚é…ç½®æ„å»ºåŒ…

è¿è¡Œéƒ¨ç½²å‘½ä»¤(`git push heroku master`)ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸º Heroku éœ€è¦æ­£ç¡®çš„*æ„å»ºåŒ…*æ¥è¿è¡Œ Dart åº”ç”¨ã€‚

buildpack åŒ…å«ä¸€äº›è„šæœ¬ï¼Œè¿™äº›è„šæœ¬è®¾ç½®äº†æ„å»ºå’ŒæœåŠ¡é¡¹ç›®æ‰€å¿…éœ€çš„ä¾èµ–é¡¹ã€‚Heroku ç›®å‰æ²¡æœ‰æ­£å¼æ”¯æŒ Dartã€‚

ç„¶è€Œï¼Œå¹³å°å…è®¸æˆ‘ä»¬æŒ‡å®šå®šåˆ¶çš„æ„å»ºåŒ…ï¼Œè™½ç„¶ Dart å›¢é˜Ÿï¼Œæˆ‘åšäº†ä¸€ä¸ª[è°ƒæ•´](https://github.com/graphicbeacon/heroku-buildpack-dart/blob/ae89937a28eeb463d25299d5b37341dd138f4793/bin/compile#L103-L107)è®©å®ƒä¸ Dart 2 ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨æˆ‘çš„æ„å»ºåŒ…:

```
$ heroku buildpacks:set https://github.com/graphicbeacon/heroku-buildpack-dart.git 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶è®¾ç½® buildpack æ‰€éœ€çš„é…ç½®:

```
$ heroku config:set DART_SDK_URL=https://storage.googleapis.com/dart-archive/channels/dev/release/2.0.0-dev.67.0/sdk/dartsdk-linux-x64-release.zip # From the dart install page
$ heroku config:set DART_BUILD_CMD="/app/dart-sdk/bin/pub global activate webdev && /app/dart-sdk/bin/pub global run webdev build" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‘Šè¯‰ buildpack è·å–æœ€æ–°çš„ Dart SDKï¼Œå¹¶ä½¿ç”¨ **webdev** å·¥å…·æ„å»ºé¡¹ç›®ã€‚

## [](#6-deploy-all-the-things)6ã€‚éƒ¨ç½²æ‰€æœ‰çš„ä¸œè¥¿ï¼ğŸš€

åœ¨æˆ‘ä»¬çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`Procfile`ï¼Œå…¶ä¸­åŒ…å«å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨çš„æŒ‡ä»¤:

```
web: ./dart-sdk/bin/dart bin/main.dart 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æäº¤æ›´æ”¹å¹¶ç«‹å³éƒ¨ç½²:

```
$ git push heroku master 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡å¸¦æœ‰ç½‘å€çš„ç¡®è®¤æ¶ˆæ¯:

[![Confirmation message with web url](../Images/fd178f675ce7a631bb7b893c0563915d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--REeYEvGQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/2cmna80oxs7vfw54ftuk.png)

å¹¶åœ¨æµè§ˆå™¨ä¸­è®¿é—®:

[![Site open in browser](../Images/b47216a5351bb6b37b8c583f60a37656.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zoljQc2j--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vgu17zr7xl5k1bwd0c6v.png)

## [](#conclusion)ç»“è®º

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ã€‚è®°ä¸‹ä¸€äº›è¯„è®ºï¼Œè®©æˆ‘çŸ¥é“ä½ å¯¹æ­¤æœ‰ä½•æ„Ÿæƒ³ã€‚

è¿™é‡Œæ˜¯æˆ‘éƒ¨ç½²çš„[æ¸¸æˆ](https://memorygameweb.herokuapp.com)å’Œ[æºä»£ç ](https://github.com/graphicbeacon/memory-game-web)ã€‚

**å–œæ¬¢ï¼Œåˆ†äº«ï¼Œå…³æ³¨æˆ‘**ğŸ˜æœ‰å…³ Dart çš„æ›´å¤šå†…å®¹ã€‚

## [](#quick-links)å¿«é€Ÿé“¾æ¥

1.  [Dart 2 SDK](https://www.dartlang.org/tools/sdk#install)
2.  [Heroku å¦‚ä½•å·¥ä½œ](https://devcenter.heroku.com/articles/how-heroku-works)
3.  [å¼€å§‹| Webdev Dart](https://webdev.dartlang.org/guides/get-started)
4.  **[å…è´¹é£é•–æˆªå±åœ¨ Egghead.io](http://egghead.io/instructors/jermaine-oppong)**