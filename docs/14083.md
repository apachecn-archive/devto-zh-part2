# é¢å‘ React/Redux å¼€å‘äººå‘˜çš„ MobX 4 ç®€ä»‹

> åŸæ–‡:[https://dev . to/swyx/introduction-to-mobx-4-for-reactredux-developers-3k 07](https://dev.to/swyx/introduction-to-mobx-4-for-reactredux-developers-3k07)

MobX ä½¿ç”¨å¯è§‚æµ‹é‡çš„â€œé­”åŠ›â€æ¥ç®¡ç†çŠ¶æ€å’Œå‰¯ä½œç”¨ã€‚è¿™ä¸ä»…æœ‰ä¸€ä¸ªå­¦ä¹ æ›²çº¿ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ç¼–ç¨‹èŒƒå¼ï¼Œå¹¶ä¸”æ²¡æœ‰å¾ˆå¤šå…³äºå¦‚ä½•ä½¿ç”¨ React with Mobx çš„æœ€æ–°åŸ¹è®­ææ–™ï¼Œè€Œå…³äºä½¿ç”¨ React with Redux çš„å†…å®¹åˆ™å¤šå¾—å¤šã€‚

åœ¨è¿™ä¸ªä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å°†é€æ­¥æ„å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åº pings ä¸€ä¸ªæ¨¡æ‹Ÿ API æ¥æŸ¥çœ‹ MobX å¦‚ä½•ä¸ React ä¸€èµ·å·¥ä½œï¼Œç„¶ååˆ¶ä½œä¸€ä¸ª MobX + React çœ‹æ¿æ¥å±•ç¤º MobX çš„å¼ºå¤§åŠŸèƒ½ï¼

[![it will look like this](../Images/cadbefe437f14f9238c9c6cff317cf92.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VjwhytmQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://user-images.githubusercontent.com/6764957/37550034-5a31617a-295d-11e8-8799-60c6f57bde0a.gif)

æˆ‘ä»¬å°†å¦‚ä½•ç»§ç»­:

*   **ä¾‹ä¸€**ã€‚æ„å»ºä¸€ä¸ªåŸºæœ¬çš„åº”ç”¨ç¨‹åºï¼Œè®©ä½ é”®å…¥æ–‡æœ¬**è¾“å…¥**ï¼Œå¹¶åæ˜ åœ¨**æ˜¾ç¤º**ã€‚*æˆ‘ä»¬å±•ç¤ºäº†å»ºç«‹`observable` s å’Œ`observer`ç»„ä»¶çš„åŸºç¡€ã€‚*
*   **ä¾‹å­ B** ã€‚æˆ‘ä»¬å°†**è¾“å…¥**å’Œ**æ˜¾ç¤º**åˆ†æˆå…„å¼Ÿå§å¦¹ï¼Œä»¥æ¨¡æ‹Ÿä¸€ä¸ªæ›´å¤æ‚çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜é€šè¿‡ ping ä¸€ä¸ªæ¨¡æ‹Ÿ API æ¥å¼•å…¥å¼‚æ­¥çŠ¶æ€æ›´æ–°ã€‚*ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨`mobx-react` `Provider`å°† MobX çŠ¶æ€æ”¾å…¥ React ä¸Šä¸‹æ–‡ä¸­ï¼Œä»¥æ¼”ç¤ºç±»ä¼¼äº`react-redux`çš„ç®€å•çš„å…„å¼Ÿå¯¹å…„å¼Ÿæˆ–å…„å¼Ÿå¯¹çˆ¶æ¯çš„é€šä¿¡ã€‚*
*   **ä¾‹å­ C** :æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ äº†ä¸€ä¸ªè¾…åŠ©**æ˜¾ç¤ºå±**ã€‚*å±•ç¤ºäº†`computed`å˜é‡çš„ç”¨å¤„(Mobx çš„ä¸€ä¸ªæ¦‚å¿µ)ã€‚*
*   ä¾‹ D :æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ”¾å¤§åˆ°ä»»æ„æ•°é‡çš„æ˜¾ç¤ºå™¨ã€‚*æ¼”ç¤ºäº†å¦‚ä½•ä¸ºæˆ‘ä»¬çš„ MobX çŠ¶æ€ä½¿ç”¨æ•°ç»„å’Œæ˜ å°„ã€‚*
*   ä¾‹å­ E :è°ƒæ•´å’Œæ¸…ç†ï¼*æˆ‘ä»¬æ·»åŠ äº† MobX å¼€å‘å·¥å…·ï¼Œå°†æ•´ä¸ªåº”ç”¨ç½®äº`useStrict`æ¨¡å¼ï¼Œå¹¶è§£é‡Šäº† MobX `action`å’Œ`transaction`çš„æ­£å¼ç”¨æ³•ï¼Œä»¥è·å¾—æ›´å¥½çš„åº”ç”¨æ€§èƒ½ã€‚*

æœ¬æ•™ç¨‹å°†ä½¿ç”¨[æœ€è¿‘å‘å¸ƒçš„ MobX 4](https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da) å’Œ MobX-React 5ã€‚å¾ˆå¤šäººå°† MobX ä¸è£…é¥°è€…è”ç³»åœ¨ä¸€èµ·ï¼Œè¿™åªæ˜¯ä¸€ä¸ª[ç¬¬äºŒé˜¶æ®µææ¡ˆ](https://www.github.com/tc39/proposal-decorators)ã€‚è¿™(ç†æ‰€å½“ç„¶åœ°)å¼•èµ·äº†ä¸€äº›äººçš„çŠ¹è±«ï¼Œä½†æ˜¯ MobX 4 å¼•å…¥äº†åŸºäºéä¿®é¥°çš„è¯­æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ä¹Ÿæ²¡æœ‰é‚£ä¸ªå€Ÿå£äº†ï¼ç„¶è€Œï¼›å¯¹äºæ•™ç¨‹ä½œè€…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½ å¿…é¡»å†³å®šè¦ä¹ˆæ•™ä¸€ä¸ªï¼Œè¦ä¹ˆæ•™å¦ä¸€ä¸ªï¼Œæˆ–è€…ä¸¤ä¸ªéƒ½æ•™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œçš„æ¯ä¸ªä¾‹å­éƒ½å°†ä½¿ç”¨é decorator è¯­æ³•ä½œä¸ºä¸»è¦ç‰ˆæœ¬ï¼Œä½†æ˜¯å°†æœ‰ä¸€ä¸ªä½¿ç”¨ decorator çš„å…‹éš†æ¥æ˜¾ç¤ºç­‰ä»·çš„å®ç°(ä¾‹å¦‚ï¼Œä¾‹å­ A å¯¹ Decorators A)ã€‚

è¯»è€…è¯·æ³¨æ„:æˆ‘ä»¬å¹¶æ²¡æœ‰è¯•å›¾æ¨è MobX è€Œä¸æ˜¯ Reduxï¼Œåä¹‹äº¦ç„¶ã€‚è¿™åªæ˜¯ä¸ºäº†å‘åƒæˆ‘è¿™æ ·åªç†Ÿæ‚‰ Redux çš„äººä»‹ç» MobX çš„æ ¸å¿ƒæ¦‚å¿µã€‚æˆ‘å°†è¯•å›¾å¾—å‡ºä¸€äº›ç»“è®ºï¼Œä½†é€šæƒ…è¾¾ç†çš„äººä¸ä¼šåŒæ„ã€‚æ­¤å¤–ï¼ŒMichel Weststrate åå¤å£°æ˜[ä¸¤ä¸ªåº“æ»¡è¶³å®Œå…¨ä¸åŒçš„éœ€æ±‚å’Œä»·å€¼è§‚](https://codeburst.io/the-curious-case-of-mobx-state-tree-7b4e22d461f)ã€‚

# ä¾‹ A1: React + MobX

ä¸‹é¢æ˜¯æˆ‘ä»¬ä½¿ç”¨ React + MobX çš„éå¸¸åŸºç¡€çš„åº”ç”¨:

```
import { decorate, observable } from "mobx";
import { observer } from "mobx-react";

const App = observer(
  class App extends React.Component {
    text = ""; // observable state
    render() {
      // reaction
      return (
        <div>
          Display: {this.text} <br />
          <input
            type="text"
            onChange={e => {
              this.text = e.target.value; // action
            }}
          />
        </div>
      );
    }
  }
);
decorate(App, { text: observable }); 
```

*( [ä¸¾ä¾‹ A1](https://codesandbox.io/s/236xqx6qn0) ï¼Œ[è£…ä¿®å·¥ A1](https://codesandbox.io/s/n7ynrm72op) )*

æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°,`observer`è¿æ¥äº†`App`çš„å¯è§‚å¯Ÿçš„`text`å±æ€§ï¼Œè¿™æ ·æ¯å½“æ‚¨æ›´æ–°`text`æ—¶ï¼Œå®ƒå°±ä¼šé‡æ–°å‘ˆç°ã€‚

è™½ç„¶è¿™å¾ˆå¥½ï¼Œä½†å®ƒç¡®å®ä¸ä½¿ç”¨`state`å’Œ`setState`æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚å¦‚æœä½ æœ‰ Reactï¼Œä½ ä¸éœ€è¦ MobX æ¥åšè¿™äº›ã€‚

# ä¾‹ A2:é‚£åˆæ€æ ·ï¼Ÿ

è®©æˆ‘ä»¬è¯•ç€å°†çŠ¶æ€å’Œè§†å›¾æ¨¡å‹çš„å…³æ³¨ç‚¹åˆ†å¼€:

```
// this deals with state
const appState = observable({
  text: "" // observable state
});
appState.onChange = function(e) { // action
  appState.text = e.target.value;
};

// this deals with view
const App = observer(
  class App extends React.Component {
    render() { // reaction
      const { text, onChange } = this.props.store;
      return (
        <div>
          Display: {text} <br />
          <input type="text" onChange={onChange} />
        </div>
      );
    }
  }
);

// you only connect state and view later on...
// ... 
<App store={appState} /> 
```

*( [ä¸¾ä¾‹ A2](https://codesandbox.io/s/n995rqm67j) ï¼Œ[è£…ä¿®å·¥ A2](https://codesandbox.io/s/wqowjv9rvw) )*

è¿™é‡Œçš„`store`:

*   è¢«æ˜¾å¼åœ°ä½œä¸ºé“å…·ä¼ å…¥(æˆ‘ä»¬ç¨åå°†ä½¿ç”¨`Provider`æ¨¡å¼)
*   è‡ªå¸¦è‡ªå·±çš„åŠ¨ä½œå¤„ç†ç¨‹åº(ä¸éœ€è¦å¯¼å…¥å•ç‹¬çš„ reducers)

# ä¾‹ A3:ä½†é‚£ä¸æ˜¯ OO

çœ‹çœ‹ä¸Šé¢ä»£ç çš„è¿™ä¸€éƒ¨åˆ†ã€‚

```
const appState = observable({
  text: "" // observable state
});
appState.onChange = function(e) { // action
  appState.text = e.target.value;
}; 
```

æ˜¯çš„ï¼Œæˆ‘ä¸å–œæ¬¢é‚£æ ·ã€‚æ–¹æ³•æ²¡æœ‰å°è£…åœ¨å¯è§‚å¯Ÿå¯¹è±¡ä¸­ã€‚æˆ‘ä»¬èƒ½è®©å®ƒæ›´é¢å‘å¯¹è±¡å—ï¼Ÿ

```
// import { decorate } from 'mobx'

class State {
  text = ""; // observable state
  onChange = e => (this.text = e.target.value); // action
};
decorate(State, { text: observable });
const appState = new State() 
```

*( [ä¸¾ä¾‹ A3](https://codesandbox.io/s/5xmo5n513n) ï¼Œ[è£…ä¿®å·¥ A3](https://codesandbox.io/s/wo8k6j190k) )*

å•Šã€‚å¥½å¤šäº†(å°¤å…¶æ˜¯ä¸éœ€è¦ä½¿ç”¨`decorate`çš„ Decorators ä¾‹å­)ï¼

# ä¾‹ B1:ä½†æ˜¯æˆ‘è®¨åŒé“å…·é’»ï¼

å°±åƒ`react-redux`è®©ä½ æŠŠå•†åº—æ”¾åœ¨`Provider`é‡Œä¸€æ ·ï¼Œ`mobx-react`ä¹Ÿæœ‰ä¸€ä¸ª`Provider`ä»¥åŒæ ·çš„æ–¹å¼å·¥ä½œã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„æ˜¾ç¤ºå’Œè¾“å…¥ç»„ä»¶é‡æ„ä¸ºå…„å¼Ÿåº”ç”¨:

```
 import { inject, observer, Provider } from "mobx-react";

class State {
  text = ""; // observable state
  onChange = e => (this.text = e.target.value); // action
}
decorate(State, { text: observable });
const appState = new State();

const Display = inject(["store"])(
  observer(({ store }) => <div>Display: {store.text}</div>) );

const Input = inject(["store"])(
  observer(
    class Input extends React.Component {
      render() {
        // reaction
        return <input type="text" onChange={this.props.store.onChange} />;
      }
    }
  )
);

// look ma, no props
const App = () => (
  <React.Fragment>
    <Display />
    <Input />
  </React.Fragment> );

// connecting state with context with a Provider later on...
// ...
<Provider store={appState}>
    <App />
  </Provider> 
```

*( [ä¸¾ä¾‹ B1](https://codesandbox.io/s/n71y76okym) ï¼Œ[è£…ä¿®å·¥ B1](https://codesandbox.io/s/mjz6jlyj0j) )*

æ³¨æ„ï¼Œå¦‚æœæˆ‘è¦æ·»åŠ ä¸€ä¸ª-second- storeï¼Œæˆ‘å¯ä»¥ç®€å•åœ°å®šä¹‰å¦ä¸€ä¸ª`observable`ï¼Œå¹¶å°†å…¶ä½œä¸ºå¦ä¸€ä¸ªå±æ€§ä¼ é€’ç»™`Provider`ï¼Œç„¶åæˆ‘å¯ä»¥ä»ä»»ä½•å­èŠ‚ç‚¹è°ƒç”¨å®ƒã€‚ä¸å†æœ‰é›·æœé£æ ¼`combineReducers`ï¼

ä½¿ç”¨æä¾›è€…è¿˜æœ‰åŠ©äºé¿å…åˆ›å»ºå…¨å±€å­˜å‚¨å®ä¾‹ï¼Œè¿™æ˜¯ MobX React æœ€ä½³å®è·µä¸­å¼ºçƒˆåå¯¹çš„ã€‚

*MobX 4 æ³¨æ„:å¦‚æœä½ åªæ˜¯è¯•å›¾ä½¿ç”¨æ—§çš„ MobX `observer(['store'])`ç®€å†™ï¼Œå®ƒæ€»æ˜¯ä¸`observer` + `inject(['store'])`åŒä¹‰ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªéå¸¸å¥½çš„åå¯¹è­¦å‘Šï¼Œä¸è¦å†è¿™æ ·åšäº†ã€‚*

æˆ‘å‘ç°è¿™ä¸ªæ³¨å…¥/è§‚å¯Ÿå™¨è¯­æ³•æœ‰ç‚¹å¤æ‚ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°å®ç”¨å‡½æ•°ï¼Œä½ å¯ä»¥å®šä¹‰å®ƒæ¥å‡å°‘è¾“å…¥:

```
const connect = str => Comp => inject([str])(observer(Comp)); 
```

å˜¿ï¼é‚£å°±åƒæˆ‘ä»¬çš„å¥½æœ‹å‹`react-redux`é‡Œçš„`connect`ï¼API ç•¥æœ‰ä¸åŒï¼Œä½†æ˜¯æ‚¨å¯ä»¥å®šä¹‰ä»»ä½•æ‚¨æƒ³è¦çš„ä¸œè¥¿ğŸ¤·ğŸ¼â€â™‚ï¸.

# ä¸¾ä¾‹ B2:å¥½å§ï¼Œä½†æ˜¯å¼‚æ­¥å‘¢

å¯¹äºå¼‚æ­¥ API è·å–ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªé€‰æ‹©ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©:

*   `mobx-thunk`
*   `mobx-observable`
*   `mobx-saga`
*   å’Œå¤§çº¦ 300 ä¸ªå…¶ä»–é€‰é¡¹ã€‚

å®ƒä»¬éƒ½æ˜¯ç‰¹åˆ«çš„é›ªèŠ±ï¼Œæˆ‘ä»¬è¿«ä¸åŠå¾…åœ°æƒ³çœ‹çœ‹ä½ ä¼šé€‰æ‹©ä»€ä¹ˆï¼

*å› æ„¤æ€’è€Œæš‚åœä¸å¹²äº†...*

å¥½å§ï¼Œå¦‚æœä½ çœ‹ä¸å‡ºæ¥ï¼Œæˆ‘æ˜¯åœ¨å¼€ç©ç¬‘ã€‚ä½¿ç”¨å¯è§‚æµ‹é‡æ„å‘³ç€ä½ å¯ä»¥â€œä»…ä»…â€æ”¹å˜å¯è§‚æµ‹é‡ï¼Œä½ çš„ä¸‹æ¸¸çŠ¶æ€ä¼šç›¸åº”åœ°åšå‡ºååº”ã€‚ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘å·²ç»ç”¨`// reaction`ã€`// action`å’Œ`// observable state`æ³¨é‡Šäº†ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ï¼Œå®ƒä»¬çš„æ„æ€å°±æ˜¯å®ƒä»¬åœ¨è‹±è¯­ä¸­é€šå¸¸çš„æ„æ€ã€‚æˆ‘ä»¬ä¼šå›æ¥çš„ã€‚

å›åˆ°ä»£ç ï¼å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªåä¸º`fetchAllCaps`çš„å¼‚æ­¥ APIã€‚è¿™æ˜¯ä¸€ä¸ª`Promise`,åœ¨ 1 ç§’é’Ÿçš„ç­‰å¾…åï¼Œå®ƒåŸºæœ¬ä¸Šå°†ä½ ä¼ é€’ç»™å®ƒçš„ä»»ä½•æ–‡æœ¬å¤§å†™ã€‚å› æ­¤ï¼Œè¿™æ¨¡æ‹Ÿäº†æ‚¨æƒ³è¦é‡‡å–çš„ä»»ä½•å¼‚æ­¥æ“ä½œçš„åŸºæœ¬è¯·æ±‚-å“åº”æµã€‚è®©æˆ‘ä»¬æŠŠå®ƒæ’å…¥åˆ°æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çš„ä¾‹å­ä¸­ï¼

```
class State {
  text = ""; // observable state
  onChange = e => {
    // action
    this.text = e.target.value;
    fetchAllCaps(e.target.value).then(val => (this.text = val));
  };
}
decorate(State, { text: observable });
const appState = new State(); 
```

*( [ä¸¾ä¾‹ B2](https://codesandbox.io/s/nn957yx004) ï¼Œ[è£…ä¿®å·¥ B2](https://codesandbox.io/s/mjz6jlyj0j) )*

é‚£æ˜¯...å®¹æ˜“å—ï¼Ÿ

æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†[å…¬å…±ç±»å­—æ®µ](https://tc39.github.io/proposal-class-public-fields/)çš„ç¬¬äºŒé˜¶æ®µç‰¹æ€§æ¥å¤„ç†`onChange`å±æ€§ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨ decoratorsï¼Œè¿™ä¹Ÿæ˜¯ç¬¬äºŒé˜¶æ®µã€‚æˆ‘å†³å®šè¿™æ ·åšï¼Œå› ä¸ºå…¬å…±ç±»å­—æ®µåœ¨ React ä¸­æ˜¯å¦‚æ­¤å¹¿æ³›(ä¾‹å¦‚ï¼Œå®ƒé™„å¸¦äº†`create-react-app`)ä»¥è‡³äºæ‚¨å¯èƒ½å·²ç»åœ¨ Babel ä¸­è®¾ç½®äº†å®ƒï¼Œæˆ–è€…å¦‚æœéœ€è¦çš„è¯ï¼Œæ‚¨å¯ä»¥çŸ¥é“å¦‚ä½•è®¾ç½®å®ƒ)ã€‚

* * *

# æ¦‚å¿µæ‰“ç ´ï¼æ˜¯æ—¶å€™å›é¡¾ä¸€ä¸‹äº†ï¼

æˆ‘ä»¬å·²ç»èµ°äº†è¿™ä¹ˆè¿œï¼Œå´æ²¡æœ‰è®¨è®ºæ ¸å¿ƒçš„ MobX æ¦‚å¿µï¼Œæ‰€ä»¥å®ƒä»¬åœ¨è¿™é‡Œ:

*   å¯è§‚å¯ŸçŠ¶æ€
*   è¡ŒåŠ¨
*   å¯¼æ•°(ååº”å’Œè®¡ç®—å€¼)

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†**å¯è§‚å¯ŸçŠ¶æ€**ä»¥åŠä¿®æ”¹è¿™äº›çŠ¶æ€çš„å·²å®šä¹‰çš„**åŠ¨ä½œ**ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†`mobx-react`çš„`@observer`æ¥å¸®åŠ©å°†æˆ‘ä»¬çš„ React ç»„ä»¶ç»‘å®šåˆ°**å¯¹çŠ¶æ€å˜åŒ–åšå‡ºååº”**ã€‚æ‰€ä»¥æ˜¯å››åˆ†ä¹‹ä¸‰ã€‚æˆ‘ä»¬è¦æ£€æŸ¥è®¡ç®—å€¼å—ï¼Ÿ

* * *

## ä¾‹ C:è®¡ç®—å€¼

**è®¡ç®—å€¼**æœ¬è´¨ä¸Šæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„**ååº”**ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹[è§‚å¯Ÿå¯¹è±¡æ˜¯æ‡’æƒ°çš„](https://github.com/ReactiveX/rxjs/blob/master/doc/observable.md)ï¼Œæ‰€ä»¥ MobX å¯ä»¥æ ¹æ®éœ€è¦æ¨è¿Ÿè®¡ç®—ã€‚åªè¦**å¯è§‚æµ‹çŠ¶æ€**æ›´æ–°ï¼Œå®ƒä»¬å°±ä¼šæ›´æ–°ã€‚æ¢å¥è¯è¯´ï¼Œè®¡ç®—å‡ºçš„å€¼æ˜¯ä»å¯è§‚æµ‹çš„çŠ¶æ€ä¸­å¾—åˆ°çš„ã€‚

è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè®¡ç®—å€¼ï¼Œè¯¥å€¼æ­£å¥½åè½¬`text` :
ä¸­çš„å†…å®¹

```
class State {
  text = "";
  get reverseText() {
    return this.text
      .split("")
      .reverse()
      .join("");
  }
  onChange = e => {
    // action
    this.text = e.target.value;
    fetchAllCaps(e.target.value).then(val => (this.text = val));
  };
}
decorate(State, { text: observable, reverseText: computed });
const appState = new State();

// lower down...
const Display2 = inject(["store"])(
  observer(({ store }) => <div>Display: {store.reverseText}</div>) ); 
```

*( [ä¸¾ä¾‹ C1](https://codesandbox.io/s/jnmz0v2189) ï¼Œ[è£…ä¿®å·¥ C1](https://codesandbox.io/s/qk933p79j4) )*

é…·ï¼å®ƒâ€œå°±æ˜¯ç®¡ç”¨â€(TM)ï¼

åœ¨è€ƒè™‘è¿™ä¸ªé—®é¢˜æ—¶ï¼Œä¸€ä¸ªåˆç†çš„é—®é¢˜æ˜¯:**ä¸ºä»€ä¹ˆè¦éº»çƒ¦**ï¼Ÿï¼Ÿæˆ‘æ€»æ˜¯å¯ä»¥å°†åŒæ­¥ä¸šåŠ¡é€»è¾‘æ”¾åœ¨æˆ‘çš„ React `render`å‡½æ•°ä¸­ï¼Œä¸ºä»€ä¹ˆè¦åœ¨ appState çº§åˆ«è®¡ç®—å€¼å‘¢ï¼Ÿ

åœ¨è¿™ä¸ªå°ä¾‹å­ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆç†çš„æ‰¹è¯„ï¼Œä½†æ˜¯æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªä½ç½®ä¾èµ–äºç›¸åŒçš„è®¡ç®—å€¼ã€‚æ‚¨å¿…é¡»åˆ°å¤„å¤åˆ¶ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ–è€…å°†å…¶æå–åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åå°†å…¶å¯¼å…¥åˆ°ä»»ä½•åœ°æ–¹ã€‚é€šè¿‡*å°†è®¡ç®—å€¼å®šä½åœ¨æ›´æ¥è¿‘çŠ¶æ€*è€Œä¸æ˜¯æ›´æ¥è¿‘*è§†å›¾*ï¼Œè®¡ç®—å€¼æ˜¯å»ºæ¨¡çŠ¶æ€æ´¾ç”Ÿçš„ä¸€ä¸ªå¥½æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ï¼Œä½†å¯ä»¥åœ¨å¤§èŒƒå›´å†…äº§ç”Ÿå½±å“ã€‚

é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ [vue.js](https://vuejs.org/v2/guide/computed.html) ä¹Ÿæœ‰è®¡ç®—å˜é‡ï¼Œè€Œ [Angular](https://stackoverflow.com/questions/43710642/does-angular-have-the-computed-property-feature-like-in-vue-js) åªæ˜¯éšå¼åœ°ä½¿ç”¨å®ƒä»¬ã€‚

## ä¸¾ä¾‹ D1:å¯è§‚æµ‹é˜µåˆ—

MobX å¯ä»¥è®©ä»»ä½•ä¸œè¥¿å˜å¾—å¯è§ã€‚è®©æˆ‘å¼•ç”¨ä¸€ä¸‹è¿™äº›æ–‡ä»¶:

1.  å¦‚æœå€¼æ˜¯ ES6 åœ°å›¾:å°†è¿”å›ä¸€ä¸ªæ–°çš„[å¯è§‚å¯Ÿåœ°å›¾](https://mobx.js.org/refguide/map.html)ã€‚å¦‚æœæ‚¨ä¸æƒ³åªå¯¹ç‰¹å®šæ¡ç›®çš„æ›´æ”¹åšå‡ºååº”ï¼Œä¹Ÿä¸æƒ³å¯¹æ¡ç›®çš„æ·»åŠ æˆ–åˆ é™¤åšå‡ºååº”ï¼Œé‚£ä¹ˆå¯è§‚å¯Ÿåœ°å›¾éå¸¸æœ‰ç”¨ã€‚
2.  å¦‚æœ value æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå°†è¿”å›ä¸€ä¸ªæ–°çš„[å¯è§‚å¯Ÿæ•°ç»„](https://mobx.js.org/refguide/array.html)ã€‚
3.  å¦‚æœä»·å€¼æ˜¯ä¸€ä¸ªæ²¡æœ‰åŸå‹çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå½“å‰çš„æ‰€æœ‰å±æ€§éƒ½å°†æ˜¯å¯è§‚å¯Ÿçš„ã€‚è§[å¯è§‚å¯Ÿç‰©ä½“](https://mobx.js.org/refguide/object.html)
4.  å¦‚æœ value æ˜¯ä¸€ä¸ªå¸¦æœ‰åŸå‹ã€JavaScript åŸè¯­æˆ–å‡½æ•°çš„å¯¹è±¡ï¼Œå°†è¿”å›ä¸€ä¸ª[è£…ç®±çš„å¯è§‚å¯Ÿå¯¹è±¡](https://mobx.js.org/refguide/boxed.html)ã€‚MobX ä¸ä¼šè®©å¸¦æœ‰åŸå‹çš„å¯¹è±¡è‡ªåŠ¨å¯è§‚å¯Ÿï¼›å› ä¸ºè¿™æ˜¯å®ƒçš„æ„é€ å‡½æ•°çš„è´£ä»»ã€‚è¯·åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ extendObservableï¼Œæˆ–è€…åœ¨å…¶ç±»å®šä¹‰ä¸­ä½¿ç”¨@observableã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»åˆ¶ä½œäº†[ç›’çŠ¶çš„å¯è§‚å¯Ÿç‰©ä½“](https://mobx.js.org/refguide/boxed.html)å’Œ[å¯è§‚å¯Ÿç‰©ä½“](https://mobx.js.org/refguide/object.html)ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ¶ä½œä¸€ä¸ªå¯è§‚å¯Ÿç‰©ä½“çš„æ•°ç»„å‘¢ï¼Ÿ

[å¯è§‚å¯Ÿé˜µåˆ—](https://mobx.js.org/refguide/array.html)æ˜¯ç±»ä¼¼å¯¹è±¡çš„é˜µåˆ—*ï¼Œè€Œä¸æ˜¯å®é™…çš„é˜µåˆ—ã€‚è¿™å¯èƒ½ä¼šåœ¨èƒŒåä¼¤äººï¼Œå°¤å…¶æ˜¯åœ¨å‘å…¶ä»–åº“ä¼ é€’æ•°æ®æ—¶ã€‚è¦è½¬æ¢æˆæ™®é€šçš„ JS æ•°ç»„ï¼Œè°ƒç”¨`observable.toJS()`æˆ–`observable.slice()`ã€‚*

ä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ä½ å¯ä»¥æŠŠæ•°ç»„å½“ä½œæ•°ç»„ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä½¿ç”¨å¯è§‚å¯Ÿæ•°ç»„çš„ Todo åº”ç”¨:

```
class State {
  text = ["get milk"]; // observable array
  onSubmit = e => this.text.push(e); // action
}
decorate(State, { text: observable });
const appState = new State();

const Display = inject(["store"])(
  observer(({ store }) => (
    <ul>Todo: {store.text.map(text => <li key={text}>{text}</li>)}</ul>
  ))
);

const Input = observer(
  ["store"],
  class Input extends React.Component {
    render() {
      // reaction
      return (
        <form
          onSubmit={e => {
            e.preventDefault();
            this.props.store.onSubmit(this.input.value);
            this.input.value = "";
          }}
        >
          <input type="text" ref={x => (this.input = x)} />
        </form>
      );
    }
  }
);

const App = () => (
  <React.Fragment>
    <Display />
    <Input />
  </React.Fragment> ); 
```

*( [ä¸¾ä¾‹ D1](https://codesandbox.io/s/p0m2l15vm) ï¼Œ[è£…ä¿®å·¥ D1](https://codesandbox.io/s/o9y428q9zq) )*

æ³¨æ„â€œjust `push`â€å°±è¡Œï¼

## ä¸¾ä¾‹ D2:å¯è§‚æµ‹çš„åœ°å›¾

å¯è§‚å¯Ÿçš„ç‰©ä½“(æˆ‘ä»¬åœ¨ä¾‹å­ Aã€B å’Œ C ä¸­ä½¿ç”¨çš„)å’Œ[å¯è§‚å¯Ÿçš„åœ°å›¾](https://mobx.js.org/refguide/map.html)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå—¯ï¼Œæ™®é€šçš„æ—§ Javascript å¯¹è±¡å’Œ [ES6 åœ°å›¾](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)ä¹‹é—´çš„åŒºåˆ«æ˜¯ä¸€æ ·çš„ã€‚æˆ‘å°†å¼•ç”¨ MobX æ–‡æ¡£æ¥è§£é‡Šä½•æ—¶åœ¨å¯¹è±¡ä¸Šä½¿ç”¨åœ°å›¾:

> å¦‚æœæ‚¨ä¸æƒ³åªå¯¹ç‰¹å®šæ¡ç›®çš„æ›´æ”¹åšå‡ºååº”ï¼Œä¹Ÿä¸æƒ³å¯¹æ¡ç›®çš„æ·»åŠ æˆ–åˆ é™¤åšå‡ºååº”ï¼Œé‚£ä¹ˆå¯è§‚å¯Ÿåœ°å›¾éå¸¸æœ‰ç”¨ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœ‰ä¸€å †å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œè¿™æ˜¯æ­£ç¡®çš„æŠ½è±¡ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä» D1 çš„ä¾‹å­ä¸­å–å‡ºé‚£ä¸ªåº”ç”¨ç¨‹åºï¼Œå°†å…¶é‡å‘½åä¸º`TodoList`ï¼Œå¹¶åœ¨`todolist.js`ä¸­åšä¸€äº›å…¶ä»–è¡¨é¢çš„è°ƒæ•´ï¼Œç„¶ååœ¨`index.js`ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
// index.js
const connect = str => Comp => inject([str])(observer(Comp)); // helper function

const listOfLists = observable.map({
  Todo1: new TodoListClass(),
  Todo2: new TodoListClass()
  // observable map rerenders when you add new members
});
const addNewList = e => listOfLists.set(e, new TodoListClass());

const App = connect("lists")(
  class App extends React.Component {
    render() {
      const { lists } = this.props;
      return (
        <div className="App">
          <span />
          <h1>MobX Kanban</h1>
          <span />
          {Array.from(lists).map((k, i) => (
            <div key={i}>
              {/*Provider within a Provider = Providerception */}
              <Provider todolist={k}>
                <TodoList />
              </Provider>
            </div>
          ))}
          <div>
            <h3>Add New List</h3>
            <form
              onSubmit={e => {
                e.preventDefault();
                addNewList(this.input.value);
                this.input.value = "";
              }}
            >
              <input type="text" ref={x => (this.input = x)} />
            </form>
          </div>
        </div>
      );
    }
  }
); 
```

*( [ä¸¾ä¾‹ D2](https://codesandbox.io/s/x3pl9p042w) ï¼Œ[è£…ä¿®å·¥ D2](https://codesandbox.io/s/ryonwww274) )*

å˜¿ï¼Œå¾ˆå¿«ï¼æˆ‘ä»¬æœ‰ä¸€ä¸ªçœ‹æ¿(ä¸€ä¸ªå¯æ‰©å±•çš„åˆ—è¡¨)ï¼

[![kanban](../Images/cadbefe437f14f9238c9c6cff317cf92.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VjwhytmQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://user-images.githubusercontent.com/6764957/37550034-5a31617a-295d-11e8-8799-60c6f57bde0a.gif)

è¿™æ˜¯ç”±é‚£ä¸ª`listOfLists`çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›å®ç°çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿåˆ°çš„åœ°å›¾ã€‚è€å®è¯´ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ä¸€ä¸ªæ›´é€‚åˆæ¼”ç¤ºå¯è§‚å¯Ÿåœ°å›¾çš„ç”¨ä¾‹ï¼Œè¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚

# ä¸¾ä¾‹ E1: MobX å¼€å‘å·¥å…·

Redux å¼€å‘å·¥å…·æ˜¯ Redux ä»·å€¼çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹ [MobX React å¼€å‘å·¥å…·](https://github.com/mobxjs/mobx-react-devtools)ï¼

```
import DevTools from 'mobx-react-devtools'; // npm install --save-dev mobx-react-devtools

// somewhere within your app...
        <DevTools /> 
```

*( [ä¸¾ä¾‹ E1](https://codesandbox.io/s/7m0xoy9336) ï¼Œ[è£…ä¿®å·¥ E1](https://codesandbox.io/s/oo2n902jr5) )*

æ‚¨å¯ä»¥çœ‹åˆ°å¼¹å‡ºçš„ä¸‰ä¸ªå›¾æ ‡:

*   å¯è§†åŒ–é‡æ–°æ¸²æŸ“
*   å®¡æ ¸ä¾èµ–å…³ç³»æ ‘
*   å°†æ‰€æœ‰å†…å®¹è®°å½•åˆ°æ§åˆ¶å°(ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°ï¼Œè€Œä¸æ˜¯ä»£ç æ‰“å¼€æ§åˆ¶å°)

ä½ ä¸èƒ½è¿›è¡Œæ—¶é—´æ—…è¡Œï¼Œä½†è¿™æ˜¯ä¸€å¥—å¾ˆå¥½çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å®¡è®¡ä½ çš„åº”ç”¨ç¨‹åºä¸­ä»»ä½•æ„æƒ³ä¸åˆ°çš„çŠ¶æ€å˜åŒ–ã€‚

# æ•¬è¯·æœŸå¾…...

æœ‰ä¸€ä¸ªé˜»å¡é”™è¯¯`mobx-dev-tools`å’Œ`mobx`4:ã€https://github.com/mobxjs/mobx-react-devtools/issues/86ã€‘T2ï¼Œæˆ‘ä¼šåœ¨é”™è¯¯ä¿®å¤åå®Œæˆè¿™ä¸ªã€‚

ç„¶è€Œï¼Œä¸æ­¤åŒæ—¶ï¼Œæ‚¨å¯ä»¥äº†è§£å¦‚ä½•æ˜¾å¼å®šä¹‰`actions`,ä»¥ä¾¿ MobX å¯ä»¥å°†æ‚¨çš„çŠ¶æ€æ›´æ”¹æ‰¹å¤„ç†åˆ°`transaction`ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ€§èƒ½èŠ‚çœ:

[https://mobx . js . org/ref guide/action . html](https://mobx.js.org/refguide/action.html)

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨`action` s - MobX çš„æƒ…å†µä¸‹å®Œæˆæ‰€æœ‰æ¼”ç¤ºï¼ŒMobX æœ‰ä¸€ä¸ª(å¾ˆå°‘)è®°å½•åœ¨æ¡ˆçš„ä¸¥æ ¼æ¨¡å¼(ä»¥å‰çš„`useStrict`ï¼Œç°åœ¨çš„`configure({enforceActions: true});`)â€”â€”å‚è§[MobX 4 æ–‡æ¡£](https://github.com/mobxjs/mobx/blob/gh-pages/docs/refguide/api.md#configure)ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦å¼€å‘å·¥å…·æ¥çœŸæ­£å±•ç¤ºæˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„å¥½å¤„ã€‚

## è‡´è°¢

è¿™ç¯‡ç®€ä»‹ä» Michel Weststrate çš„ egghead.io è¯¾ç¨‹ä¸­å€Ÿç”¨äº†å¾ˆå¤šä»£ç å’Œç»“æ„ï¼Œä½†æ˜¯ä¸ºå½“å‰çš„ Mobx 4 API æ›´æ–°äº† 2 å¹´å‰çš„è¯¾ç¨‹ã€‚æˆ‘ä¹Ÿè¦æ„Ÿè°¢æˆ‘çš„é›‡ä¸»å…è®¸æˆ‘åœ¨å…¬å…±åœºåˆå­¦ä¹ ã€‚

è¿™é‡Œçš„ä¾‹å­æ˜¯åœ¨[è´¾ç»´å¾·Â·é˜¿æ–¯å…‹ç½—å¤«](http://twitter.com/askerovlab)ã€[çº³å¾·Â·è¾¾æ¯”ç‰¹](http://twitter.com/dabit3)å’Œ[ç±³æ­‡å°”](http://twitter.com/mweststrate)çš„å¸®åŠ©ä¸‹å®Œæˆçš„ã€‚

## å…¶ä»–æ•™ç¨‹å’Œè¿›ä¸€æ­¥é˜…è¯»

å…¶ä»–æœ€æ–°æŒ‡å—

*   [MobX + React Native](https://dev.to/satansdeer/react-native-mobx-tutorial---part-1--2df0)
*   [MobX + React æœ€ä½³å®è·µ](https://medium.com/dailyjs/mobx-react-best-practices-17e01cec4140)
*   [MobX 4 å‘å¸ƒåšæ–‡](https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da)

æ–‡ä»¶ï¼ˆdocuments çš„ç®€å†™ï¼‰

*   [MobX æ–‡æ¡£-å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ](https://mobx.js.org/best/pitfalls.html)
*   [MobX å˜æ›´æ—¥å¿—â€”â€”å¯¹ v3 å’Œ v4 çš„å˜æ›´è¦éå¸¸å°å¿ƒ](https://github.com/mobxjs/mobx/blob/master/CHANGELOG.md)
*   [å®˜æ–¹ MobX+React 10 åˆ†é’ŸæŒ‡å—](https://mobx.js.org/getting-started.html)

å¹´é•¿çš„

*   [ä¸€ä¸ªå¼€å‘è€…å¯¹ redux vs mobx çš„ä¼˜åŠ£å¯¹æ¯”](https://dannyherran.com/2017/03/react-redux-mobx-takeaways/)
*   [Adam Rackis å¯¹ MobX çš„è€è¯„ä»·](https://medium.com/@adamrackis/a-redux-enthusiast-tries-mobx-af675f468c11)

è¦æ¢ç´¢çš„ç›¸å…³åº“

*   [MobX çŠ¶æ€æ ‘](https://github.com/mobxjs/mobx-state-tree)å’Œå…³è”çš„[åšå®¢æ–‡ç« ](https://codeburst.io/the-curious-case-of-mobx-state-tree-7b4e22d461f)

## æŠ•ç¨¿

æˆ‘åº”è¯¥åœ¨æœ¬æŒ‡å—ä¸­åŒ…æ‹¬å“ªäº›å…¶ä»–å½“å‰(< 1 å¹´)èµ„æºï¼Ÿæˆ‘çŠ¯äº†ä»€ä¹ˆé”™è¯¯å—ï¼Ÿä¸‹é¢è®©æˆ‘çŸ¥é“ï¼