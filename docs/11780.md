# Laravel API èµ„æº+ Vue.js åˆ†é¡µ(ç¬¬ä¸€éƒ¨åˆ†)

> åŸæ–‡:[https://dev.to/fwartner/laravel-api-resource-vuejs-åˆ†é¡µ-ç¬¬ä¸€éƒ¨åˆ†-5836](https://dev.to/fwartner/laravel-api-resource--vuejs-pagination-part-one-5836)

Laravel ä» 5.5 ç‰ˆæœ¬å¼€å§‹æä¾›è‡ªå·±çš„ api-transformersï¼Œå°†æ‚¨çš„é›„è¾©æ¨¡å‹è½¬æ¢æˆ JSONã€‚å½“æ‚¨ä½¿ç”¨ Laravel æ„å»º API æ—¶ï¼Œè¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¼šéå¸¸æ–¹ä¾¿ã€‚

ä½†æ˜¯å¦‚ä½•ä½¿ç”¨ Vue.js åœ¨åº”ç”¨ç¨‹åºä¸­æ¶ˆè´¹å’Œåˆ†é¡µ api çš„ç»“æœå‘¢ï¼Ÿåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ç®¡ç†ç»“æœçš„åˆ†é¡µã€‚

## [](#what-you-will-need)ä½ å°†éœ€è¦ä»€ä¹ˆ

æˆ‘å‡è®¾æ‚¨çš„æœºå™¨ä¸Šå®‰è£…äº† Laravel ä»£å®¢å’Œ Laravel å®‰è£…ç¨‹åºã€‚æˆ‘è¿˜å‡è®¾ä½ çŸ¥é“åœ¨ Laravel ä¸­ä½¿ç”¨é›„è¾©èµ„æºçš„åŸºæœ¬çŸ¥è¯†ã€‚
æˆ‘å‡è®¾æ‚¨å¯¹ Bootstrap 4 æœ‰åŸºæœ¬çš„äº†è§£ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ BS4ã€‚

## [](#creating-a-new-laravel-project)åˆ›å»ºæ–°çš„ Laravel é¡¹ç›®

æ‰“å¼€ä½ çš„ç»ˆç«¯ï¼Œè¾“å…¥

```
laravel new pagination-example 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åœ¨æ‚¨çš„æœºå™¨ä¸Šè®¾ç½®ä¸€ä¸ªæ–°çš„ laravel 5.6 åº”ç”¨ç¨‹åºã€‚

ç°åœ¨ï¼Œé€šè¿‡é”®å…¥
å°†â€œcdâ€å¯¼å…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­

```
cd pagination-example 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#prepare-a-demomodel)å‡†å¤‡ä¸€ä¸ªæ¼”ç¤ºæ¨¡å‹

æˆ‘ä»¬éœ€è¦æ¼”ç¤ºæ•°æ®ã€‚æˆ‘ä»¬éœ€è¦å¤§é‡çš„æ¼”ç¤ºæ•°æ®ã€‚Laravel å°†å¸®åŠ©æˆ‘ä»¬ï¼Œä½¿ç”¨æ¨¡å‹å·¥å‚åˆ›å»ºè¿™äº›æ•°æ®ã€‚

ä½†æ˜¯é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡å‹ï¼Œä¸€ä¸ªè¿ç§»å’Œä¸€ä¸ªæˆ‘ä»¬æƒ³è¦åˆ†é¡µçš„æ¦‚å¿µ(æ©™å­ï¼Œè‹¹æœï¼Œæ±½è½¦ï¼Œç­‰ç­‰ï¼)..æˆ‘å°†ä¸ºè¿™ä¸ªä¾‹å­é€‰æ‹©ç®€å•çš„äººï¼Œå› ä¸ºæˆ‘åƒå¤§å¤šæ•°äººä¸€æ ·ç”¨æ•°æ®åˆ›å»ºäº†ä¸€äº›é¡¹ç›®ğŸ˜†ã€‚

ç±»å‹

```
php artisan make:model Person -m 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åœ¨æ‚¨çš„`app/`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`Person`çš„æ–°æ¨¡å‹ï¼Œå¹¶åœ¨æ‚¨çš„`database/`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`2018_05_03_create_persons_table.php`çš„æ–°è¿ç§»æ–‡ä»¶ã€‚

è¿™æ˜¯æˆ‘çš„*äºº*æ¨¡å‹çš„æ ·å­:

```
<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreatePeopleTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('people', function (Blueprint $table) {
            $table->increments('id');
            $table->string('name');
            $table->string('email');
            $table->string('city');
            $table->string('country');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('people');
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç±»å‹

```
php artisan migrate 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿ç§»æ‚¨çš„æ•°æ®åº“ã€‚

## [](#the-eloquent-resource)é›„è¾©çš„èµ„æº

æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†æ¨¡å‹å’Œè¿ç§»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæœ‰è¯´æœåŠ›çš„èµ„æºã€‚
æ‚¨å¯ä»¥é€šè¿‡é”®å…¥
è½»æ¾åˆ›å»ºä¸€ä¸ª

```
php artisan make:resource PersonResource 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åœ¨æ‚¨çš„`app/Http/Resources/`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`PersonResource`çš„æ–°æ–‡ä»¶ã€‚

ç°åœ¨å‡†å¤‡æ‚¨çš„æ¨¡å‹ï¼Œå…è®¸ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œæ‰¹é‡åˆ†é…:

```
<?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Person extends Model
{
    protected $guarded = [];
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#creating-the-modelfactory)åˆ›å»ºæ¨¡å‹å·¥å‚

åˆ›å»ºä¸€ä¸ªæ¨¡å‹å·¥å‚éå¸¸ç®€å•ã€‚ä½ åŸºæœ¬ä¸Šåªéœ€è¦è¾“å…¥

```
php artisan make:factory PersonFactory --model=Person 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¾“å…¥ä½ çš„ç»ˆç«¯ï¼Œå°±è¿™æ ·ã€‚(æ²¡æœ‰..æˆ‘åªæ˜¯åœ¨å¼€ç©ç¬‘ğŸ˜†)

è¿™æ ·ç¼–è¾‘ä½ çš„äººå·¥å‚:

```
<?php

use Faker\Generator as Faker;

$factory->define(App\Person::class, function (Faker $faker) {
    return [
        'name' => $faker->name,
        'email' => $faker->safeEmail,
        'city' => $faker->city,
        'country' => $faker->country
    ];
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#faking-the-data)ä¼ªé€ æ•°æ®

æˆ‘ä»¬ä»ç„¶éœ€è¦æ•°æ®ã€‚è¦åˆ›å»ºæ•°æ®ï¼Œåªéœ€é”®å…¥

```
php artisan tinker 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿›å…¥æ‚¨çš„ç»ˆç«¯ï¼Œç„¶åæŒ‰

```
$persons = factory('App\Person', 30)->create(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦å»·å…‹è£…ä¸Šå­å¼¹ã€‚åœ¨æ‚¨æŒ‰ä¸‹ enter é”®åï¼Œæ‚¨å°†ä¼šçœ‹åˆ°æˆ‘ä»¬èµ„æºçš„æ¨¡æ‹Ÿæ•°æ®æ•°ç»„ã€‚

## [](#giving-back-json-collection)å›é¦ˆ JSON(æ”¶è—)

æ—¢ç„¶æˆ‘ä»¬å·²ç»ä¸ºæµ‹è¯•åº”ç”¨ç¨‹åºå‡†å¤‡å¥½äº†å‡ ä¹æ‰€æœ‰çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æä¾›æ•°æ®..
é›„è¾©â€”â€”èµ„æºå¾ˆèªæ˜ã€‚
æ‚¨å¯ä»¥å°†æ•°ç»„æˆ–å¯¹è±¡ä¼ é€’ç»™èµ„æºï¼Œå®ƒä¼šè‡ªåŠ¨å°†æ•°æ®æ˜ å°„åˆ° json-collection / json-objectã€‚

æˆ‘ä»¬ç°åœ¨éœ€è¦é€šè¿‡ä¿®æ”¹æˆ‘ä»¬çš„`routes/web.php`æ–‡ä»¶æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<?php

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| contains the "web" middleware group. Now create something great!
|
*/

Route::get('/', function () {
    $persons = \App\Person::paginate(5);

    return \App\Http\Resources\PersonResource::collection($persons);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€`http://pagination-example.test`æ—¶ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰äººçš„é›†åˆã€‚

## [](#giving-back-json-object)è¿”å› JSON(å¯¹è±¡)

æ­£å¦‚æˆ‘ä¹‹å‰å‘Šè¯‰ä½ çš„ï¼Œèµ„æºä¹Ÿå¯ä»¥å¤„ç†ç®€å•çš„å¯¹è±¡..
ä¸ºäº†åªæ˜¾ç¤ºæˆ‘ä»¬é›†åˆä¸­çš„ ***ä¸€ä¸ª*** ï¼Œä¿®æ”¹`routes/web.php`æ–‡ä»¶å¦‚ä¸‹:

```
<?php

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| contains the "web" middleware group. Now create something great!
|
*/
// Collection
Route::get('/', function () {
    $persons = \App\Person::paginate(5);

    return \App\Http\Resources\PersonResource::collection($persons);
});

// Object
Route::get('{id}', function ($id) {
    $person = \App\Person::find($id);

    return \App\Http\Resources\PersonResource::make($person);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€`http://pagination-example.test/1`æ—¶ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæ•°æ®åº“ä¸­ ID ä¸º *1* çš„äººçš„ç®€å•å¯¹è±¡ã€‚

## [](#conclusion)ç»“è®º

è¿™æ˜¯â€œLaravel API Resource + Vue.js åˆ†é¡µâ€ä¸¤éƒ¨åˆ†ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ† ã€‚
åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç®¡ç† vueâ€”â€”è¿™æ˜¯æˆ‘ä»¬ç¤ºä¾‹çš„ä¸€éƒ¨åˆ†ã€‚

ä½ å¯ä»¥åœ¨ [GitHub](https://github.com/fwartner/laravel-vue-pagination/tree/34171ca452c657670a20ed1dc5c4e4b124e88996) ä¸Šæ‰¾åˆ°è¿™éƒ¨åˆ†çš„æºä»£ç ã€‚