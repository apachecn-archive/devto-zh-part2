# 单元测试:最佳实践

> 原文：<https://dev.to/ice_lenor/unit-testing-best-practices-27ec>

*这篇文章最初发表在我的博客[smartpuffin.com](http://smartpuffin.com/unit-testing-best-practices/)上。*

多年来，我一直在对我的代码进行单元测试。

在[建造 GIS 系统](http://smartpuffin.com/tag/fiji/)的时候，我们真的很关心我们的产品质量。我们用户的需求要求应用程序正常工作。我对所有关键和/或复杂的代码部分进行了 100%的测试，有多条路径和角落案例。找到一个 bug，修复它，为这个令人惊讶的场景编写几个测试，并确保它不会再次出错，这是一件非常愉快的事情。啊，美好时光。

以下是我多年来积累的最佳实践。请注意:我假设你已经熟悉了单元测试的概念。

# 测试什么

当然，你的资源有限。当然，测试所有的东西需要大量的时间。当然，你需要向你的项目经理解释单元测试及其好处，并与他们协商。这就是为什么你需要分清主次。

确定优先级的最佳方式是**着眼于业务需求。**

对于一些开发人员来说，这听起来可能令人惊讶。你可能会想:测试是代码，它们与业务没有任何关系。

事实上，[所有代码都与业务](https://dev.to/ice_lenor/how-to-answer-the-question-whats-the-most-challenging-task-you-have-ever-implemented-27ki/#usercentricthinking)有关。最终，您编写代码来解决用户的问题，这就是业务需求。

但是我跑题了。比方说，你没有任何测试，但你真的想开始。太棒了。

选择系统中最关键的部分。是你客户的购买体验吗？你的用户使用的是工具吗？是数据流吗？是复杂的数学计算吗？

确定这个地方，从那里开始。因为它是系统中最重要的部分，绝对必须正常工作，你可以证明花时间在单元测试上是合理的。

# 为什么需要单元测试

单元测试有助于确保代码正确运行。单元测试是进行回归测试的一个很好的方法:只要在每次你改变一些东西的时候运行它们，并确保没有任何东西被破坏。发现了一个漏洞？修复它并编写一个单元测试来确保它不会再次发生。

对于您确定的重要代码部分，您需要编写单元测试来确保代码正常工作:

##### 在基本情况下

当用户和其他代码做了期望他们做的事情。

这些测试是最容易编写的——毕竟，我们都以成功为目标:)。

*   向您的函数传递适当的参数，并让测试预期适当的返回值。

##### 在角落情况下

您希望确保代码在角落和边缘情况下都能工作——当一个罕见的场景发生时。

*   将 0 传递给数学函数。通行证-1。传递 INT_MAX。传递一个空字符串。

##### 万一失败了

您还需要验证代码*是否正确地中断了*。例如，如果一个金融操作失败了，我们必须确保钱没有完全消失。

*   传递一个空对象引用。做一些会产生异常的事情。
*   你认为这是不可能的，因为调用你的函数的代码不会这样做？也许现在就是这种情况。但是代码变了。如果前端表单验证了所有输入，但是明天有人重构它，您不希望您的后端开始意外失败。

在用全面的单元测试覆盖了最重要的代码之后，您可以用更少的单元测试来处理不太重要的代码。优先顺序！

# 模块化和依赖性

有时候，第一步是为单元测试准备你的代码。这就是[模块化](https://dev.to/ice_lenor/modularization-and-dependency-management-three-steps-to-better-code)派上用场的时候！代码越模块化，就越容易测试。

在您确定了依赖项并正确地分割它们之后，剩下的就很容易了。对于单元测试，你必须*模仿*依赖关系，以确保你只测试你当前模块的行为。否则，你也将测试它所依赖的其他事物的行为。但是这些东西值得他们自己去测试。

您也可以决定用依赖项来测试模块*。虽然有些人可能会说这不再是单元测试(而是集成测试)，但它仍然是测试，并且仍然有用。*

# 测试结构

##### 测试命名

有几种命名测试方法的方法。在我看来，最重要的是——名字应该是描述性的。尽可能的描述。长度为 200 个字符，越清晰越好。

##### 小型测试

因为所有的测试都有非常描述性的名字，你可以添加尽可能多的小测试——为了你所有的角落。确保您的测试只测试一个场景。

##### 文件夹结构

对我来说，当测试项目结构重复主项目结构时，结果是最方便的。这样很容易找到模块的测试。

##### 独立测试

确保你的测试不互相依赖。如果需要的话，在每个测试的开始和结束时执行一个清理步骤——在单元测试框架中通常有特殊的方法来做这件事。

##### 更改代码运行测试

有时我会听到有人问:当我编辑代码时，我如何理解要运行哪些测试？

全部运行！

因为测试的文件夹结构重复了主代码的结构，所以很容易找到与您的变更相关的测试包。

当你执行[模块化](#modularization)步骤时，以及当你使它们变小时，你已经确保它们运行得很快。因此，你可以经常运行测试包，例如，在你开发的时候和推进之前。

##### 添加代码编写测试

根据您的业务需求，更改必须工作的重要代码？写一个测试。

修复 bug？写一个测试。让它成为一种习惯！测试是代码的重要组成部分，所以努力使它们保持最新，作为回报，它们将为您节省很多时间。

##### 如果测试数量超过代码数量，那也没关系

其实那是意料之中的！

如果你对一段代码有很多测试，那就太好了——这意味着你要检查很多情况。

如果你花时间写测试没关系——有时，甚至比写代码还要多。测试是关键业务部分的安全网，记得吗？

# 当*不需要*单元测试时

在我的项目中，我们没有用单元测试覆盖所有的代码。对一些人来说，我们有意识地决定不去做。那么，什么时候不需要呢？

当您的代码不是关键的，并且您的业务能够承受系统中这一部分的一些错误时。

当使代码可测试和编写测试的工作量太大，而手工测试需要较少的工作量时。您需要对您计划维护项目期间的工作进行累积评估。

当有一个你不能抽象掉的依赖时:你把它从所有其他模块中移到一个模块中，但是你不能把它从那里移走。在这种情况下，您可以对所有其他模块进行单元测试，但是这个模块必须保持原样。一个常见的例子是使用当前时间戳的模块。

当它是一个原型，一个概念验证，或者实验代码，并且你需要尽可能快地开发它时，你可能无论如何都要扔掉它。

最后但同样重要的是——当你确信[你的代码是最好的](https://dev.to/ice_lenor/do-i-want-to-work-in-this-company-or-what-questions-to-ask-on-an-interview-7po/#mycodeisperfect):)