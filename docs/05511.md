# åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ jq å°† JSON è½¬æ¢ä¸º CSV

> åŸæ–‡:[https://dev . to/sanity-io/transform-JSON-to-CSV-using-jq-in-the-command line-53gb](https://dev.to/sanity-io/transform-json-to-csv-using-jq-in-the-commandline-53gb)

æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å°å·¥å…·ï¼Œå®ƒå­˜åœ¨äºä½ çš„ç»ˆç«¯ä¸­ï¼Œç”¨ JSON-data åšæœ‰ç”¨çš„äº‹æƒ…ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½†å¯¹äºå°äº‹æƒ…ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°† JSON æ•°æ®é€šè¿‡ç®¡é“ä¼ é€’ç»™å®ƒï¼Œå®ƒä¼šç”¨è¯­æ³•é«˜äº®æ˜¾ç¤ºæ‰“å°å‡ºæ¥ğŸ”¦é»˜è®¤æƒ…å†µä¸‹:

`$ cat some-data.json|jq`

ä½ å¯ä»¥[åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šå®‰è£… jq](https://stedolan.github.io/jq/download/) (åœ¨è£…æœ‰[å®¶é…¿](https://brew.sh/) / `chocolatey install jq`çš„ mac ä¸Šå®‰è£…`brew install jq`ï¼Œåœ¨è£…æœ‰[å·§å…‹åŠ›](https://chocolatey.org/)çš„ windows ä¸Šå®‰è£…`chocolatey install jq`)ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ç§æ›´å…ˆè¿›çš„`jq`æŠ€æœ¯ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è·å¾—åŸºç¡€çŸ¥è¯†ï¼Œä½ åº”è¯¥æŸ¥çœ‹æ•™ç¨‹ã€‚

`jq`é€‚ç”¨äºä»»ä½• JSON æºä»£ç ï¼Œä½†æ˜¯ç”±äºæˆ‘å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ä½¿ç”¨åŸºäº [Sanity.io](https://sanity.io/) çš„åç«¯ï¼Œæˆ‘å°†ç”¨å®ƒä½œä¸ºä¾‹å­ã€‚è¿˜å› ä¸ºæˆ‘è®¤ä¸ºæˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§ç»„åˆåšçš„äº‹æƒ…éå¸¸é…·ã€‚

[Sanity æ˜¯ç»“æ„åŒ–å†…å®¹](https://www.sanity.io/docs/introduction/getting-started)çš„åç«¯ï¼Œå¸¦æœ‰ä¸€ä¸ªå®æ—¶ API å’Œä¸€ä¸ªåä¸º [GROQ](https://www.sanity.io/docs/data-store/how-queries-work) çš„æŸ¥è¯¢è¯­è¨€ã€‚CLI å·¥å…·ï¼Œè®©æ‚¨æŸ¥è¯¢æ‚¨çš„åç«¯ï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­ç”¨`$ sanity documents query 'GROQ-expression'`è¾“å‡ºç»“æœã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¦ç±»å‹ä¸º`post`çš„æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥è¾“å…¥`$ sanity documents query '*[_type == "post"]'`ã€‚æˆ–è€…ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¦é‚£äº›å‡ºç‰ˆæ—¥æœŸåœ¨ 2018 å¹´çš„ï¼Œé‚£å°±åº”è¯¥æ˜¯`$ sanity documents query '*[_type == "post" && publishedAt > "2018-01-01"]'`ã€‚è¿™ä¸ªæŸ¥è¯¢ç»™å‡ºäº†å®Œæ•´çš„æ–‡æ¡£ï¼Œä½†æ˜¯å¦‚æœæ‚¨åªæ˜¯æƒ³è¦æ ‡é¢˜å’Œå‡ºç‰ˆæ—¥æœŸï¼Œæ‚¨å¯ä»¥å†™:`*[_type == "post"]{title, publishedAt}`ã€‚

[![The output from Sanity CLI piped through jq](../Images/59683a819120f46a659a4cd108b96bf7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UPGiuOhs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/12b7f7872916dda7170928afaf279d18424e4177-1386x1512.png)

æ‚¨ä¹Ÿå¯ä»¥åœ¨`jq`ä¸­ä» JSON æ•°æ®ä¸­æŒ‘é€‰å‡ºé”®å’Œå€¼ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå°† JSON æ•°ç»„ä¸­çš„ç»“æ„åŒ–å†…å®¹è½¬æ¢æˆ CSV æ–‡ä»¶ã€‚å› ä¸ºä½ çš„è€æ¿æƒ³è¦ Excel è¡¨æ ¼é‡Œçš„ä¸œè¥¿ï¼Œå¯¹å—ï¼Ÿåå¥½ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼ğŸŠâ€â™€ï¸

å‡è®¾ä½ æƒ³åœ¨ä¸€ä¸ªç”µå­è¡¨æ ¼ä¸­åˆ—å‡ºä½ çš„åšå®¢æ¡ç›®çš„æ ‡é¢˜ã€æ®µè½å’Œå‘å¸ƒæ—¥æœŸã€‚æ•´ä¸ªè¡¨è¾¾å¼å°†å¦‚ä¸‹æ‰€ç¤º:

```
sanity documents query '*[_type == "post"]{title, "slug": slug.current, publishedAt}'|jq -r '(map(keys) | add | unique) as $cols | map(. as $row | $cols | map($row[.])) as $rows | $cols, $rows[] | @csv' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ å¯ä»¥å¤åˆ¶è¿™ä¸ªç„¶åç”¨å®ƒè¿è¡Œæˆ–è€…åœ¨ jqplay.com ä¸Š[ç”¨å®ƒç©ï¼Œä½†æ˜¯è®©æˆ‘ä»¬çœ‹çœ‹`jq`é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ-è¡¨æƒ…:](https://jqplay.org/s/QOs3d_fMLU)

*   `-r`ä»£è¡¨`--raw-ouput`,ç¡®ä¿è¾“å‡ºæ˜¯æ²¡æœ‰é¢œè‰²æˆ–ç‰¹æ®Šæ ¼å¼çš„æ™®é€šçš„æ—§æ–‡æœ¬ã€‚
*   `(map(keys) |Â add | unique) as $cols`éå†å¯¹è±¡ä¸­çš„é”®(`map`)å’Œ`add` `unique`åˆ°ä¸€ä¸ªåä¸º`$cols`çš„å˜é‡ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æœ€ç»ˆæˆä¸ºæ‚¨çš„åˆ—æ ‡é¢˜ã€‚

[![Map out unique keys](../Images/992cb45e44cd318ceeb5cf10dd910707.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZZ4tCn1d--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/da54941c127a979d03d7bf057cd5a5154a0a8608-1640x476.png)

*   `map(. as $row | $cols | map($row[.])) as $rows`è·å–å¤–éƒ¨æ•°ç»„ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œéå†æ‰€æœ‰å¯¹è±¡é”®(titleã€slugã€publishedAt)å¹¶å°†å€¼é™„åŠ åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œè¿™æ ·å°±å¾—åˆ°ä¸€ä¸ªåŒ…å«å€¼çš„æ•°ç»„ï¼Œè¿™å°±æ˜¯å°† JSON è½¬æ¢ä¸º CSV æ—¶æ‰€éœ€è¦çš„ã€‚
*   `$cols, $rows[] | @csv`é¦–å…ˆå°†åˆ—æ ‡é¢˜æ”¾å…¥æ•°ç»„ï¼Œç„¶åå°†æ¯ä¸ªæ•°ç»„é€šè¿‡ç®¡é“ä¼ è¾“åˆ°`@csv`è½¬æ¢ä¸ºè¡Œï¼Œè¿™å°†è¾“å‡ºæ ¼å¼åŒ–ä¸ºâ€¦ csvã€‚

[![The final result](../Images/b4f3ddaed5494c4b90f8e5d3395a216d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NdprNK3w--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.io/images/3do82whm/production/92c28578b1eadd30205b92842b2a4fbcbc12e31c-2080x452.png)

è¿™ä¸ªå‘½ä»¤åœ¨ shell ä¸­æ‰“å°å‡ºç»“æœï¼Œä½†æ˜¯å¦‚æœæ‚¨æƒ³ç›´æ¥å°†ç»“æœå†™åˆ°æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥å°†`> filename.csv`é™„åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…é™„åŠ åˆ°å‰ªè´´æ¿ä¸­(å¦‚æœæ‚¨åœ¨ mac ä¸Šï¼Œåˆ™é€šè¿‡ç®¡é“å°†ç»“æœä¼ é€åˆ°`| pbcopy`)ã€‚æˆ–è€…ä¹Ÿè®¸ä½ ä¼šåœ¨[ç†ŠçŒ«](https://pandas.pydata.org/)ä¸­ç”¨ csv åšä¸€äº›é€€å‡ºçš„äº‹æƒ…ğŸ¼ğŸ¼ç”¨ Pythonï¼Ÿ

å¦‚æœä½ è§‰å¾—è¿™æœ‰ç”¨ï¼Œæˆ‘å¾ˆä¹æ„å¬å¬ï¼