# 2FA 和短信的心碎

> 原文：<https://dev.to/ferricoxide/2fa-and-the-heartbreak-of-sms-32p9>

所以，很久以前，我开始启用我所有支持双因素认证(也就是“2FA”)的互联网账户。这是一条有些“令人担忧”的道路。

通常情况下，网站会为您提供使用基于令牌的硬件或“虚拟”/软件设备或短信的能力。我选择了 SMS，因为我的一些客户使用基于硬件的令牌(比如我想使用的 YubiKeys)是不可行的。然后，几年后，有人发现“SS7 有一个漏洞，其副作用是使基于 SMS 的 2FA 不再安全”，不久之后，一个[记录的利用](https://www.theregister.co.uk/2017/05/03/hackers_fire_up_ss7_flaw/)被发现。发出警告说“2FA 不要用短信”。

然而，当你的工作环境有时像我一样，基于 SMS 的 2FA 是唯一有意义的选择。没有更好的选择，我选择“接受风险”,继续前进。毕竟，在我看来，某种形式的 2FA——即使有潜在的利用价值——总比没有 2FA 好...如果仅仅是因为这使得被攻击比攻击一个连第二层保护都没有的人更难的话。我的意思是，即使你知道一个足够果断和/或熟练的小偷仍然可以破门而入，你还是锁上了你的车和你的房子的门，对吗？你最希望的是“如果我的房子是一个更难击中的目标，他们会寻找更容易的目标。”有点像“通过模糊来获得安全感”，但是，可能会更好一点。

无论如何，这些警告甚至在“在野外”的漏洞被发现之前就开始出现了。然而，在这些发现之前，这些警告主要是建议性的。然后，去年，AWS 决定“我们放弃基于 SMS 的 2FA:无论如何，这是一个测试版功能。”这让我有点“卡住”了。当我第一次用 2FA 设置我的 AWS 账户时，唯一的非短信选项要么是硬件键，要么是基于手机的软键。如前所述，硬件键不是一个选项。类似地，基于手机的软键也是如此。虽然有其他基于软件的关键选项，但很少有基于桌面的客户端。少数有桌面选项的*和*似乎假设你只使用过一个桌面(例如，如果你在家用电脑上用这样的应用程序为 2FA 设置了银行账户，你就不能在工作中使用银行网站，除非使用“备份”访问代码)。我*以为*我会被困回 2FA-less 为我的 AWS 帐户。

幸运的是，2FA 似乎有更多的选择。有些甚至包括设计假设，“许多人没有能力仅仅依靠一个*令牌(虚拟)设备”。或者，也许他们只是意识到没有人会随身携带一副一英寸厚的档案卡，每张卡上都印有一个给定的 2FA-enabled 站点的备份代码。我不在乎为什么，只在乎现在我可以“2FA *所有*的东西”(完全支持 2FA)。*

今天早上，是工作日的最后一天(美国许多人在 7 月 4 日的第二天休息)。因此，我决定看看是否/如何改变我的 AWS 帐户，以使用不依赖于 SMS 的 2FA 保护。我查看了 [AWS 支持的软键列表](https://aws.amazon.com/iam/details/mfa/)——Google Authenticator(可能还有兼容的——比如 LastPass 声称的)和 Authy——这让我的选择很容易:Google Authenticator 只能在手机上使用，因此，我可以取消它。所以，我选择[下载](https://authy.com/download/)并安装 Authy，看看我是否能让它工作(令人惊讶的是，他们似乎还没有为 Linux 桌面用户提供选项)。我还想看看设置有多难，这样我就可以向我们的安全策略团队提出“我们应该要求我们所有的 AWS 用户启用他们的帐户的 2FA 功能”(或者不启用)的建议。所以，下载安装 Authy 之后:

1.  不想把自己锁在 AWS 帐户之外，我创建了一个具有控制台登录权限的测试控制台用户。
2.  我注销了启用了 IAM 用户创建的帐户
3.  使用标准用户/密码凭据登录我的测试帐户
4.  转到我的测试用户的 IAM 控制台
5.  单击了“安全凭证”选项卡
6.  单击“分配的 MFA 设备”行旁边的(编辑)铅笔图标
7.  从第一个弹出对话框中选择“虚拟 MFA 设备”
8.  单击“下一步”,直到出现“管理 MFA 设备”屏幕
9.  点击“显示手动配置的密钥”按钮，显示手动配置的令牌串(因为我的电脑没有扫描二维码的能力)
10.  单击 Authy 中的“令牌”图标，然后单击“+”图标添加一个新的帐户绑定
11.  将密钥从 AWS 页面复制到我的剪切缓冲区
12.  将 AWS 密钥粘贴到 Authy 中的“输入网站提供的代码”文本框中，并点击“添加帐户”按钮
13.  选择一个有意义的帐户名称和图标，点击“保存”按钮
14.  然后将第一个和第二个六字符令牌复制到“验证代码 1”和“验证代码 2”字段中，然后单击“激活虚拟 MFA”按钮
15.  在 AWS 弹出“MFA 设备已成功与您的帐户关联”之后消息时，我单击“完成”按钮退出 MFA 设置工具
16.  然后，我使用不同的浏览器登录了该帐户。在输入测试用户的普通用户/密码凭证后，它提示我输入 Authy 生成的字符串。我输入后，就像平常一样进入了 AWS 控制台。
17.  我很快退出了我的测试帐户，然后通过我的 IAM 管理员启用帐户 nuked 它。我用我的其他 AWS 帐户重复了上述内容(我有几个帐户，每个帐户都有不同的权限)。每一个都很容易安装和使用。

现在来看看我的其他 2FA-via-SMS 帐户中有多少可以转换为 Authy。我真的更喜欢“一环”，但有些网站希望你使用特定的 2FA 工具。