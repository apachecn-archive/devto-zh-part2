# ç†è§£ç›®æ ‡ C ä¸­çš„å¼±å’Œå¼º

> åŸæ–‡:[https://dev . to/on myway 133/understanding-weak-and-strong-in-objective-c-4a3m](https://dev.to/onmyway133/understanding-weak-and-strong-in-objective-c-4a3m)

ç§¯æœ¨å¾ˆæ£’ã€‚ä¸ºäº†é¿å…â€œä¿ç•™å¾ªç¯â€,ä½ ç»å¸¸ä¼šçœ‹åˆ°è½¯å¼±çš„è‡ªå·±åƒè¿™æ ·è·³èˆ

```
__weak __typeof__(self) weakSelf = self;
    self.block = ^{
        __typeof__(self) strongSelf = weakSelf;
        [strongSelf doSomething];
        [strongSelf doSomethingElse];
    }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#when-block-is-created)åˆ›å»ºå—æ—¶

#### [](#block-is-object-when-it-is-copied)å—è¢«å¤åˆ¶æ—¶æ˜¯å¯¹è±¡

å—æ˜¯åœ¨å †æ ˆä¸Šåˆ›å»ºçš„ï¼Œå½“å®ƒä»¬çš„å †æ ˆå¸§è¿”å›æ—¶ï¼Œå—å°±ä¼šæ¶ˆå¤±ã€‚åœ¨å †æ ˆä¸Šï¼Œå—å¯¹å®ƒè®¿é—®çš„ä»»ä½•ä¸œè¥¿çš„å­˜å‚¨æˆ–ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰å½±å“ã€‚

å¦‚æœå †æ ˆå¸§è¿”å›åå—éœ€è¦å­˜åœ¨ï¼Œå®ƒä»¬å¯ä»¥è¢«å¤åˆ¶åˆ°å †ä¸­ï¼Œè¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªæ˜¾å¼æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå—å°†åƒ Cocoa ä¸­çš„æ‰€æœ‰å¯¹è±¡ä¸€æ ·è·å¾—å¼•ç”¨è®¡æ•°ã€‚å½“å®ƒä»¬è¢«å¤åˆ¶æ—¶ï¼Œå®ƒä»¬ä¼šå¸¦èµ°å®ƒä»¬æ•è·çš„èŒƒå›´ï¼Œä¿ç•™å®ƒä»¬å¼•ç”¨çš„ä»»ä½•å¯¹è±¡

#### [](#blocks-can-capture-values-from-the-enclosing-scope)å—å¯ä»¥ä»å°é—­èŒƒå›´ä¸­æ•è·å€¼

é™¤äº†åŒ…å«å¯æ‰§è¡Œä»£ç ä¹‹å¤–ï¼Œå—è¿˜å…·æœ‰ä»å…¶å°é—­èŒƒå›´æ•è·çŠ¶æ€çš„èƒ½åŠ›ã€‚æ³¨æ„ï¼Œblock æ•è·å˜é‡åŠå…¶è£…é¥°ç¬¦(å³å¼±é™å®šç¬¦)ï¼Œ

= >è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä½ éœ€è¦æŠŠè‡ªæˆ‘å£°æ˜ä¸º _ _ è½¯å¼±

## [](#when-block-is-executed)å½“å—è¢«æ‰§è¡Œæ—¶

å½“æ‰§è¡Œ block æ—¶ï¼ŒweakSelf å¯¹äºç¬¬ä¸€ä¸ªæ–¹æ³•(doSomething)å¯èƒ½ä¸ºé nilï¼Œä½†å¯¹äºç¬¬äºŒä¸ªæ–¹æ³•(doSomethingElse)å¯èƒ½ä¸æ˜¯

é¦–å…ˆï¼Œæ‚¨å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåœ¨å—å†…ä½¿ç”¨ self æ¥é¿å…ä¿ç•™å‘¨æœŸè­¦å‘Šçš„æŠ€å·§ã€‚äº‹å®å¹¶éå¦‚æ­¤ã€‚å¯¹ self çš„å¼ºå¼•ç”¨æ˜¯åœ¨å—æ‰§è¡Œæ—¶åˆ›å»ºçš„ï¼Œè€Œåœ¨å—ä¸­ä½¿ç”¨ self æ˜¯åœ¨å—å£°æ˜æ—¶è®¡ç®—çš„ï¼Œå› æ­¤ä¿ç•™äº†å¯¹è±¡ã€‚

ç„¶è€Œï¼Œå¯¹äºæœ€ä½³å®è·µï¼Œæ‚¨åº”è¯¥ä½¿ç”¨å¼±å¼•ç”¨åˆ›å»ºå¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚è¿™ä¹Ÿä¸ä¼šåˆ›å»ºä¸€ä¸ªä¿ç•™å¾ªç¯ï¼Œå› ä¸ºå—ä¸­çš„å¼ºæŒ‡é’ˆåªä¼šåœ¨å—å®Œæˆä¹‹å‰å­˜åœ¨(å®ƒå”¯ä¸€çš„ä½œç”¨åŸŸæ˜¯å—æœ¬èº«)ã€‚

= >è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆä½ éœ€è¦å£°æ˜å¦ä¸€ä¸ª _ _ å¼ºå¤§çš„è‡ªæˆ‘

## [](#more-explanation)æ›´å¤šè§£é‡Š

è¿™æ˜¯æˆ‘å¯¹è¯»è€…å°¼åŸºå¡”çš„å›ç­”

1.  æ­£å¦‚è®¸å¤šäººæŒ‡å‡ºçš„é‚£æ ·ï¼Œâ€œå—æ˜¯åœ¨å †æ ˆä¸Šåˆ›å»ºçš„ï¼Œå½“å®ƒä»¬çš„å †æ ˆå¸§è¿”å›æ—¶ï¼Œå—å°±ä¼šæ¶ˆå¤±ã€‚åœ¨å †æ ˆä¸­ï¼Œå—å¯¹å®ƒæ‰€è®¿é—®çš„ä»»ä½•å†…å®¹çš„å­˜å‚¨æˆ–ç”Ÿå­˜æœŸéƒ½æ²¡æœ‰å½±å“ã€‚å³ä½¿å—(åœ¨å †æ ˆä¸Šå£°æ˜)å¢åŠ äº†å¯¹å®ƒè®¿é—®çš„æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œè¿™ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºå½“å‡½æ•°è¿”å›æ—¶ï¼Œè¿™ä¸ªå—å°†è¢«ä¸¢å¼ƒ

2.  å½“å—è¢«å¤åˆ¶æ—¶(ä½ çœ‹åˆ°äººä»¬é€šå¸¸ä¸ºå—å£°æ˜å±æ€§(copy))ï¼Œå®ƒå°†å¢åŠ å¯¹å®ƒè®¿é—®æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚

ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå—æ„å‘³ç€åœ¨ä»¥åæ‰§è¡Œï¼Œæ‰€ä»¥å®ƒéœ€è¦ä¿æŒå¯¹å®ƒè®¿é—®çš„æ‰€æœ‰å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚å—å¯ä»¥è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šåœ¨è¿™æ¬¡è¿è¡Œåé‡Šæ”¾ selfã€‚

å½“ä½ æ¸…ç©ºè¿™ä¸ªå—æ—¶ï¼Œå®ƒå°†è¢« deallocï¼Œå› æ­¤å®ƒå°†å‡å°‘å¯¹å®ƒè®¿é—®çš„æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚

AFNetworking åœ¨è¢«è°ƒç”¨åå°±æ¶ˆå¤±äº†ï¼Œæ‰€ä»¥ä½ ä¸å¿…åœ¨å—å†…ä½¿ç”¨ weak self[http://www.fantageek.com/1376/afnetworking-gotcha-2/](http://www.fantageek.com/1376/afnetworking-gotcha-2/)

1.  æ‰€ä»¥æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ ä¸å¿…åœ¨å— a ä¸­ä½¿ç”¨ weakselfã€‚ç¡®ä¿è¯¥å—æ²¡æœ‰è¢«å¤åˆ¶ï¼Œä½ åªéœ€å£°æ˜å¹¶è¿è¡Œå®ƒ bã€‚ç¡®ä¿è¯¥å—åœ¨è¢«è°ƒç”¨åä¸ºé›¶

## [](#reference)å¼•ç”¨

*   [æˆ‘ç»ˆäºæ˜ç™½äº†è½¯å¼±çš„è‡ªå·±å’Œåšå¼ºçš„è‡ªå·±](http://dhoerl.wordpress.com/2013/04/23/i-finally-figured-out-weakself-and-strongself/)
*   [ä½¿ç”¨æ¨¡å—](https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/WorkingwithBlocks/WorkingwithBlocks.html)
*   [ç›®æ ‡-C å—è­¦å‘Š](http://albertodebortoli.github.io/blog/2013/08/03/objective-c-blocks-caveat/)
*   [ç‰©é•œ-å¼•æ“ç›–ä¸‹çš„ C å—](http://albertodebortoli.github.io/blog/2013/04/21/objective-c-blocks-under-the-hood/)
*   çœ‹è¡—åŒºå†…éƒ¨:ç¬¬ä¸€é›†
*   çœ‹è¡—åŒºå†…éƒ¨:ç¬¬äºŒé›†
*   çœ‹è¡—åŒºå†…éƒ¨:ç¬¬ä¸‰é›†
*   [ä» C å£°æ˜ç¬¦åˆ° Objective-C å—è¯­æ³•](http://nilsou.com/blog/2013/08/21/objective-c-blocks-syntax/)
*   [Objective-C ç¨‹åºå—çš„è¯­æ³•](http://arigrant.com/blog/2014/1/18/the-syntax-of-objective-c-blocks)
*   [æŒ‡åµŒå¥—å—å†…çš„å¼±è‡ªæˆ‘](http://stackoverflow.com/a/17105368/1418457)
*   [æ•æ‰æˆ‘(è‡ªå·±)](http://blackpixel.com/blog/2014/03/capturing-myself.html)

* * *

æ”¯æŒæˆ‘çš„åº”ç”¨ç¨‹åº

*   [æ¨é€ Hero -æµ‹è¯•æ¨é€é€šçŸ¥çš„çº¯ Swift åŸç”Ÿ macOS åº”ç”¨](https://onmyway133.com/pushhero)
*   [PastePal -ç²˜è´´æ¿ã€ä¾¿ç¬ºå’Œå¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/pastepal)
*   [å¿«é€Ÿæ£€æŸ¥-æ™ºèƒ½å¾…åŠäº‹é¡¹ç®¡ç†å™¨](https://onmyway133.com/quickcheck)
*   [Alias - App å’Œæ–‡ä»¶å¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/alias)
*   [æˆ‘çš„å…¶ä»–åº”ç”¨](https://onmyway133.com/apps/)

â¤ï¸â¤ï¸ğŸ˜‡ğŸ˜ğŸ¤˜â¤ï¸â¤ï¸