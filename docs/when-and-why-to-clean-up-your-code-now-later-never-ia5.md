# 何时以及为什么清理你的代码:现在，以后，永远不要

> 原文：<https://dev.to/itamarst/when-and-why-to-clean-up-your-code-now-later-never-ia5>

你必须赶上最后期限，你必须修复错误，你必须交付产品。

但是你也必须考虑未来:你现在引入的每一个 bug 都必须在以后被修复，这甚至会耗费更多的时间。所有这些被否决的 API、过时的依赖和旧的做事方式真的不应该存在。

那么你什么时候清理你的代码呢？

你现在做吗？

后来呢？

从来没有？

在本文中，我将介绍一组启发法，帮助您决定何时应用三种修复:

1.  **更新**过时的依赖项和不推荐使用的 API。
2.  **重构**修复不好的抽象。
3.  从违反编码标准到笨拙的习惯用法，其他任何事情的杂项清理。

## 按情境启发式

### 原型制作

在你开始认真地构建一些东西之前，你可以从一个原型开始(或者极限编程所说的“尖峰”)。你不需要保留这些代码，你只需要探索问题和解决方案的空间，看看你能学到什么。

鉴于您将丢弃这些代码，更新或其他清理工作就没有什么意义了。如果你只是试图理解一个现有的 API 或技术问题，你不会做太多的重构工作。

另一方面，如果你的原型目标是找到正确的抽象，你将会做大量的重构。

1.  更新:从不。
2.  重构:现在，如果你试图原型化一个 API 或抽象，否则永远不要。
3.  杂项清理:从不。

### 新项目

当您开始一个全新的项目时，您所做的决定将对以后的维护代码产生强烈的影响。

这是一个很好的机会，可以从最新的(工作中的)依赖项、特定情况的最佳实践和可维护的代码以及您能想到的最佳抽象开始。你可能不会完全正确地得到它们，但是通常值得花时间去尽可能地接近它们。

1.  更新:现在。
2.  重构:现在。
3.  杂项清理:现在。

### 一个紧急的错误修复

你需要尽快为用户修复一个漏洞。虽然在这个过程中您可能会看到问题，但是除非它们与这个特定的 bug 修复相关，否则最好将它们推迟到以后。

有时，这可能意味着修复两次错误:第一次以快速的方式，第二次在你完成必要的清理之后。

1.  更新:稍后。
2.  重构:以后。
3.  杂项清理:稍后。

### 新功能或非紧急 bug 修复

当你有一个正在开发的项目，并且你正在做正在进行的工作，无论是特性还是 bug 修复，你都有一个很好的机会来逐步清理你的代码。

**你不需要每次接触代码都修复所有东西。相反，对你已经接触过的代码进行持续的清理将逐渐保持你的代码库处于良好的状态。详见 [Ron Jefferies 的精彩文章](https://ronjeffries.com/xprog/articles/refactoring-not-on-the-backlog/)。**

1.  更新:现在，对于你正在触摸的代码。
2.  重构:现在，对于你正在接触的代码。
3.  杂项清理:现在，对于你接触的代码。

### 一个项目处于维护模式

最终你的项目将会完成:没有多少新的开发完成，大多数情况下，它只是每隔几个月当一些东西损坏或者一个下拉菜单需要一个额外的选项时稍微调整一下。

此时你的目标是做最少的必要工作来维持项目的进行。重构和各种清理不是必需的，但是更新可能是必需的——依赖项可能会停止工作，或者需要安全更新。提前 5 年改变依赖关系通常比每年更新 5 次依赖关系要困难得多。

因此，无论何时您必须修复一个 bug，您都应该更新依赖关系——理想情况下是长期支持版本，以减少对 API 使用更新的需求。

1.  更新:现在，最好是长期支持版本。
2.  重构:从不。
3.  杂项清理:从不。

## 平衡现在和未来

软件项目倾向于持续的过程，而不是一次性的努力。现在清理可能会节省你以后的时间——但是如果你现在有一个最后期限要满足，那么推迟它可能会更好，即使代价是以后稍微多做一些工作。

所以，这篇文章只是一个起点:和任何启发一样，规则会有例外，你需要根据你的情况和你的目标来指导。

* * *

### 我们都会犯错，我有 20 年的经验:从每天凌晨 4 点让生产崩溃的代码，到接受一份糟糕透顶的工作邀请。

### 每一次痛苦的失败都给了我一个教训——但已经太迟了。

### 你可以做得更好！加入 3300 名其他程序员，每周你都会学习如何[避免我的另一个错误](https://codewithoutrules.com/softwareclown/?ref=dev.to)。