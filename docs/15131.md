# å…·æœ‰ Go åç«¯çš„ Angular åº”ç”¨ç¨‹åºä¸­çš„ JWT è®¤è¯

> åŸæ–‡:[https://dev . to/Nikola/jwt-authentic ation-in-a-angular-application-with-a-go-back end-13cg](https://dev.to/nikola/jwt-authentication-in-an-angular-application-with-a-go-backend--13cg)

[![](../Images/e7cc6508cbdad581190ec1fdc0929602.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--O5Px3b5J--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mk6if274wu7uk9otmyu5.jpg)

*æœ€åˆå‘è¡¨äº[æˆ‘çš„åšå®¢](http://www.nikola-breznjak.com/blog/go/jwt-authentication-angular-application-go-backend/)ã€‚*

## TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„ web åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ JWT æ¥å¤„ç†èº«ä»½éªŒè¯ã€‚å‰ç«¯ä¼šç”¨ Angular 5 å†™ï¼Œåç«¯ä¼šç”¨ Goã€‚æˆ‘è¿˜ä¼šä»‹ç»ä¸€äº›ç†è®ºæ¦‚å¿µã€‚

ä½ å¯ä»¥åœ¨ Github ä¸ŠæŸ¥çœ‹æœ€ç»ˆçš„æºä»£ç 

## [](#jwt)JWT

JWT ä»£è¡¨`JSON Web Token`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¼–ç å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:

`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==.mKIuU0V0Bo99JU5XbeMe6g-Hrd3ZxJRlmdHFrEkz0Wk`

å¦‚æœä½ ç”¨`.`åˆ†å‰²è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä½ ä¼šå¾—åˆ°ä¸‰ä¸ªç‹¬ç«‹çš„å­—ç¬¦ä¸²:

*   **æŠ¥å¤´** -åŒ…å«å…³äºä»¤ç‰Œçš„ç¼–ç ä¿¡æ¯
*   **æœ‰æ•ˆè½½è·** -åŒ…å«åœ¨åŒæ–¹ä¹‹é—´ä¼ è¾“çš„ç¼–ç æ•°æ®
*   **éªŒè¯ç­¾å** -ç”¨äºéªŒè¯æ•°æ®æœªè¢«æ›´æ”¹

å®˜ç½‘æ˜¯è¿™æ ·è¯´ JWTs çš„:

> JSON Web ä»¤ç‰Œæ˜¯ä¸€ç§å¼€æ”¾çš„è¡Œä¸šæ ‡å‡† RFC 7519 æ–¹æ³•ï¼Œç”¨äºå®‰å…¨åœ°è¡¨ç¤ºåŒæ–¹ä¹‹é—´çš„å£°æ˜ã€‚

å¦‚æœä½ å–œæ¬¢

[![](../Images/42afe7892d970e9c979700041a1af96e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--kalX7sVS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/hzZHo9S.jpg)

é‚£æˆ‘ä¸æ€ªä½ ã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°å®šä¹‰ä¸€ä¸‹ã€‚

JSON Web ä»¤ç‰Œæ˜¯åŒæ–¹å®‰å…¨äº¤æµä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚ä¸€ä¸ª`claim`æ˜¯å’Œä»¤ç‰Œä¸€èµ·å‘é€çš„ä¸€äº›æ•°æ®ï¼Œåƒ`user_id`ã€‚

**å®‰å…¨é€šä¿¡**åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯æˆ‘ä»¬å¯ä»¥ç¡®å®šä¿¡æ¯**æ²¡æœ‰è¢«ç¯¡æ”¹**çš„äº‹å®ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒå¯¹æ½œåœ¨çš„æ”»å‡»è€…æ˜¯éšè—çš„ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªæ½œåœ¨çš„æ”»å‡»è€…å¯ä»¥è¯»å– JWT çš„å†…å®¹(æ‰€ä»¥è¯·**ä¸è¦åƒå£°ç§°çš„é‚£æ ·å‘é€ä»»ä½•å¯†ç **)ï¼Œä½†æ˜¯ä»–ä¸èƒ½ä¿®æ”¹å®ƒå¹¶ä»¥é‚£ç§å½¢å¼å‘å›ã€‚

åŸºäº JWT ä¸å¯ç¯¡æ”¹çš„å‰æä¸‹ï¼Œå¯¹äº**è®¤è¯**éå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªåŒ…å«ä»–ä»¬çš„`userid`çš„ JWTï¼Œå®ƒå¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç”¨äºéªŒè¯è¯·æ±‚æ˜¯å¦æ¥è‡ªç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚

jwt å¾ˆçŸ­ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å®ƒä»¬ä½œä¸º POST å‚æ•°ã€HTTP å¤´å‘é€ï¼Œæˆ–è€…ä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æ·»åŠ åˆ° URLã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œç„¶åå°†å®ƒä»¬ä¸æ¯ä¸ªè¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ï¼Œç¡®ä¿ç”¨æˆ·å¾—åˆ°æˆæƒã€‚

ä¼¼ä¹å¾ˆå¤šäººå–œæ¬¢å¹¶ä½¿ç”¨å®ƒä»¬ã€‚ç„¶è€Œï¼Œæˆ‘å¿…é¡»æŒ‡å‡ºï¼Œå¾ˆå¤šå®‰å…¨ç ”ç©¶äººå‘˜[ä¸èµæˆè¿™ç§åšæ³•](https://www.rdegges.com/2018/please-stop-using-local-storage/)ã€‚

## [](#learn-by-doing)è¾¹åšè¾¹å­¦

æ²¡æœ‰å¿…è¦çŸ¥é“ jwt å¦‚ä½•å·¥ä½œçš„å¤æ‚ç»†èŠ‚ï¼Œèƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ï¼Œä½†æ˜¯å½“ä½ èµ°å¾—æ›´è¿œæ—¶ï¼Œå®ƒæœ‰æ—¶ä¼šç»™ä½ è¿™ç§äº†ä¸èµ·çš„æ„Ÿè§‰ã€‚

å› æ­¤ï¼Œæœ¬ç€è¿™ç§ç²¾ç¥ï¼Œæˆ‘ä»¬ç°åœ¨è¦åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ JSON Web ä»¤ç‰ŒğŸ’ª

### [](#payload)æœ‰æ•ˆè½½è·

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘æƒ³å°†ä»¥ä¸‹æ•°æ®å®‰å…¨åœ°å‘é€ç»™æŸäºº:

```
{
    "user_id": "a1b2c3",
    "username": "nikola"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯æˆ‘çš„`payload`ã€‚ä¸ºäº†å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ JWT ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹å®ƒè¿›è¡Œ`base64`ç¼–ç ã€‚é€šè¿‡ä½¿ç”¨`btoa`åŠŸèƒ½:
ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·(æ§åˆ¶å°çª—å£)ä¸­ä½¿ç”¨ JavaScript è½»æ¾å®ç°è¿™ä¸€ç‚¹

```
btoa(JSON.stringify({
    "user_id": "a1b2c3",
    "username": "nikola"
})); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ï¼Œç”¨æ›¾ç»ç¨å¾®æµè¡Œçš„å›´æ£‹ï¼Œä½ ä¼šè¿™æ ·åš:

```
package main

import (
    "encoding/base64"
    "fmt"
)

func main() {
    data := `{"user_id":"a1b2c3","username":"nikola"}`
    uEnc := base64.URLEncoding.EncodeToString([]byte(data))
    fmt.Println(uEnc)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»è€Œå¾—åˆ°:
`eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==`

> âš ï¸åœ¨ JavaScript ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆä½¿ç”¨`JSON.stringify`å‡½æ•°ï¼Œå¦åˆ™å¾—åˆ°çš„è§£ç å­—ç¬¦ä¸²å°†åªæ˜¯`[object Object]`ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ JavaScript:
ä¸­çš„`atob`å‡½æ•°æ¥è§£ç  base64 ç¼–ç çš„å­—ç¬¦ä¸²

```
atob('eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿˜æ˜¯åœ¨å›´æ£‹:

```
uDec, _ := base64.URLEncoding.DecodeString("eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç»“æœéƒ½æ˜¯`{"user_id":"a1b2c3","username":"nikola"}`

### [](#header)è¡¨å¤´

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æŠ¥å¤´è¿›è¡Œç¼–ç :

```
{
    "alg": "HS256",
    "typ": "JWT"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ JWTï¼ŒæŠ¥å¤´å®é™…ä¸Šåœ¨æœ‰æ•ˆè½½è·ä¹‹å‰ã€‚åœ¨å¤´ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª JWTï¼Œå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨äº†æŸç§æ•£åˆ—ç®—æ³•`HS256`ã€‚è¿™ä¸ªç‰¹æ®Šçš„ç®—æ³•å°†å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç§˜å¯†å¯†ç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`RSA SHA256`ç®—æ³•æ¥ä½¿ç”¨ç§æœ‰çš„&å…¬é’¥å¯¹ã€‚[è¿™é‡Œæœ‰ä¸€ä¸ªå…³äº jwt ä¸­ä½¿ç”¨çš„ä¸åŒæ•£åˆ—ç®—æ³•çš„å¾ˆå¥½çš„æ•™ç¨‹ã€‚](https://blog.angular-university.io/angular-jwt/)

base64 ç¼–ç çš„å¤´çœ‹èµ·æ¥åƒè¿™æ ·:`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9`ã€‚

### [](#verification-signature)éªŒè¯ç­¾å

ä½œä¸ºæœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºéªŒè¯ç­¾åã€‚æˆ‘ä»¬é€šè¿‡è¿æ¥ç¼–ç çš„å¤´å’Œæœ‰æ•ˆè½½è·å­—ç¬¦ä¸²ï¼Œç”¨`.`å°†å®ƒä»¬åˆ†å¼€æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨`HS256`ç®—æ³•ä»¥åŠåªæœ‰å‘é€è€…çŸ¥é“çš„ç§˜å¯†å¯†ç ã€‚

æˆ‘ä»¬çš„ç¼–ç å¤´å’Œæœ‰æ•ˆè½½è·å¦‚ä¸‹æ‰€ç¤º:

`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==`

æˆ‘ä»¬å°†ä½¿ç”¨`42isTheAnswer`ä½œä¸ºå¯†ç ã€‚

æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ²¡æœ‰è¿™ä¸ªæ•£åˆ—å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Node æ¥å®Œæˆå®ƒã€‚é¦–å…ˆï¼Œé€šè¿‡è¿è¡Œ:`npm install base64url`å®‰è£…`base64url`ã€‚å¦‚æœä½ æ˜¯ Node æ–°æ‰‹ï¼Œæˆ‘æ¨è[è¿™ä¸ªæ•™ç¨‹](https://hackhands.com/how-to-get-started-on-the-mean-stack/)ã€‚

ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„ JavaScript æ–‡ä»¶:

```
var base64url = require('base64url');

var crypto    = require('crypto');
var message     = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==';
var key       = '42isTheAnswer';
var algorithm = 'sha256';
var hash, hmac;

hmac = crypto.createHmac(algorithm, key);
hmac.setEncoding('base64');
hmac.write(message);
hmac.end();
hash = hmac.read();

var final = base64url.fromBase64(hash);
console.log(final); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ï¼Œåœ¨ Go ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨:

```
package main

import (
    "crypto/hmac"
    "crypto/sha256"
    "encoding/base64"
    "fmt"
)

func main() {
    message := "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ=="
    sKey := "42isTheAnswer"

    key := []byte(sKey)
    h := hmac.New(sha256.New, key)
    h.Write([]byte(message))
    b := base64.URLEncoding.EncodeToString(h.Sum(nil))
    fmt.Println(string(b))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ‚¨æ‰§è¡Œä¸Šé¢çš„ä»»ä½•è„šæœ¬ä¹‹åï¼Œæ‚¨åº”è¯¥å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²:

`mKIuU0V0Bo99JU5XbeMe6g-Hrd3ZxJRlmdHFrEkz0Wk`

ç°åœ¨æˆ‘ä»¬å°†è¿™ä¸ªå­—ç¬¦ä¸²æ·»åŠ åˆ°ä¹‹å‰çš„ä»¤ç‰Œä¸­(ä¹Ÿç”¨`.`åˆ†éš”)ï¼Œæˆ‘ä»¬å¾—åˆ°:

`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYTFiMmMzIiwidXNlcm5hbWUiOiJuaWtvbGEifQ==.mKIuU0V0Bo99JU5XbeMe6g-Hrd3ZxJRlmdHFrEkz0Wk`

æˆ‘ä»¬å¯ä»¥åœ¨ jwt.io ä¸Šæµ‹è¯•è¿™ä¸ª JWT:

[![](../Images/f3482840e33a4a707960a57da0755bc2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SeZdLWuT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/OOsBnYy.png)

## [](#security)å®‰å…¨

æˆ‘ä»¬çš„`payload`å’Œ`header`æ˜¯ base64 ç¼–ç çš„ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢« base64 è§£ç ã€‚é‚£ä¹ˆï¼Œè¿™åˆ°åº•æœ‰å¤šå®‰å…¨å‘¢ï¼Ÿ

é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒ**ä¸èƒ½è¢«æ›´æ”¹**ï¼Œå› ä¸ºéªŒè¯ç­¾åæ˜¯ä½¿ç”¨æŠ¥å¤´å’Œæœ‰æ•ˆè½½è·æ•°æ®æ„å»ºçš„ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘ä»¬å°†æ— æ³•éªŒè¯ç­¾åâ€”â€”å› æ­¤ï¼Œå¦‚æœæœ‰äººç¯¡æ”¹ JWTï¼Œæˆ‘ä»¬ä¼šçŸ¥é“ã€‚

ç”±äºæœ‰æ•ˆè½½è·æ•°æ®å·²ç»æ”¹å˜ï¼ŒéªŒè¯ç­¾åå°†ä¸å†åŒ¹é…ï¼Œå¹¶ä¸”æ²¡æœ‰åŠæ³•ä¼ªé€ ç­¾åï¼Œé™¤éæ‚¨çŸ¥é“ç”¨äºæ•£åˆ—å®ƒçš„ç§˜å¯†ã€‚å½“è¿™ä¸ª JWT æ”»å‡»æœåŠ¡å™¨æ—¶ï¼Œå®ƒå°†çŸ¥é“å®ƒå·²ç»è¢«ç¯¡æ”¹ã€‚

## [](#general-remarks)æ€»è¿°

å¦‚æœ jwt ç”¨äºè®¤è¯ï¼Œå®ƒä»¬å°†è‡³å°‘åŒ…å«ä¸€ä¸ªç”¨æˆ· ID å’Œä¸€ä¸ª`expiration timestamp`ã€‚
è¿™ç§ç±»å‹çš„ä»¤ç‰Œè¢«ç§°ä¸º`Bearer Token`ã€‚å®ƒæ ‡è¯†æ‹¥æœ‰å®ƒçš„ç”¨æˆ·å¹¶å®šä¹‰ç”¨æˆ·ä¼šè¯ã€‚

ä¸€ä¸ª`Bearer Token`æ˜¯ç”¨æˆ·å/å¯†ç ç»„åˆçš„ç­¾åä¸´æ—¶æ›¿ä»£ã€‚å®ç°åŸºäº JWT çš„èº«ä»½éªŒè¯çš„ç¬¬ä¸€æ­¥æ˜¯é¢å‘ä¸€ä¸ªæ‰¿è½½ä»¤ç‰Œï¼Œå¹¶é€šè¿‡ç™»å½•è¿‡ç¨‹å°†å…¶äº¤ç»™ç”¨æˆ·ã€‚

jwt çš„å…³é”®å±æ€§æ˜¯ï¼Œè¦ç¡®è®¤å®ƒä»¬æ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹ä»¤ç‰Œæœ¬èº«ã€‚

## [](#demo-apps)æ¼”ç¤ºåº”ç”¨ç¨‹åº

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„å…¨æ ˆåº”ç”¨ï¼Œå®ƒå°†å…·æœ‰:

*   ç™»å½•é¡µé¢
*   ç™»å½•é¡µé¢
*   æˆå‘˜é¡µé¢
*   ç”¨äºéªŒè¯çš„åç«¯

JWTs çš„è®¤è¯æ˜¯å¦‚ä½•å·¥ä½œçš„:

[![](../Images/e038062df8a1899a5a05b7ef5969a750.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--IX-y468A--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/hthWzSx.png)

*   ç”¨æˆ·é€šè¿‡ç™»å½•é¡µé¢å‘æœåŠ¡å™¨æäº¤ç”¨æˆ·åå’Œå¯†ç 
*   æœåŠ¡å™¨éªŒè¯å‘é€çš„æ•°æ®ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª JWT ä»¤ç‰Œï¼Œå…¶æœ‰æ•ˆè´Ÿè½½åŒ…å«ç”¨æˆ·çš„ id å’Œè¿‡æœŸæ—¶é—´æˆ³
*   æœåŠ¡å™¨ç”¨ä¸€ä¸ªç§˜å¯†å¯†ç å¯¹æŠ¥å¤´å’Œæœ‰æ•ˆè½½è·è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¶å‘é€å›ç”¨æˆ·çš„æµè§ˆå™¨
*   æµè§ˆå™¨è·å–ç­¾åçš„ JWTï¼Œå¹¶å¼€å§‹å°†å®ƒä¸æ¯ä¸ª HTTP è¯·æ±‚ä¸€èµ·å‘é€å›æœåŠ¡å™¨
*   ç­¾åçš„ JWT å……å½“ä¸´æ—¶ç”¨æˆ·å‡­æ®ï¼Œæ›¿ä»£æ°¸ä¹…å‡­æ®(ç”¨æˆ·åå’Œå¯†ç )

ä¸‹é¢æ˜¯æœåŠ¡å™¨åœ¨æ”¶åˆ° JWT ä»¤ç‰Œæ—¶æ‰€åšçš„äº‹æƒ…:

*   æœåŠ¡å™¨æ£€æŸ¥ JWT ç­¾åå¹¶ç¡®è®¤å®ƒæ˜¯æœ‰æ•ˆçš„
*   æœ‰æ•ˆè½½è·é€šè¿‡ç”¨æˆ· id è¯†åˆ«ç‰¹å®šç”¨æˆ·
*   åªæœ‰æœåŠ¡å™¨æœ‰ç§˜å¯†å¯†ç ï¼Œå¹¶ä¸”æœåŠ¡å™¨åªå‘æäº¤æ­£ç¡®å¯†ç çš„ç”¨æˆ·åˆ†å‘ä»¤ç‰Œã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å¯ä»¥ç¡®å®šè¯¥ä»¤ç‰Œç¡®å®æ˜¯ç”±æœåŠ¡å™¨ç»™äºˆè¯¥ç‰¹å®šç”¨æˆ·çš„
*   æœåŠ¡å™¨ä½¿ç”¨è¯¥ç”¨æˆ·çš„å‡­è¯ç»§ç»­å¤„ç† HTTP è¯·æ±‚

### [](#angular-cli-with-bulma)æ£±è§’åˆ†æ˜çš„ CLI ä¸å¸ƒå°”ç›

Angular CLI å¯¹äº [Angular](https://angular.io/) æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œè€Œ[å¸ƒå°”ç›](https://bulma.io/)æ˜¯ä¸€ä¸ªç®€å•çš„ CSS æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥çº¯ç²¹æ˜¯ä¸€ç§äº«å—ã€‚

è®©æˆ‘ä»¬ä»ç”¨ Angular CLI ç”Ÿæˆä¸€ä¸ªæ–°é¡¹ç›®å¼€å§‹(å®‰è£…å®ƒï¼Œä»¥é˜²æ‚¨è¿˜æ²¡æœ‰å®ƒ):

`ng new jwt-auth`

è¿™ä¸ªè¿‡ç¨‹å®Œæˆåï¼Œè¿è¡Œ`jwt-auth`æ–‡ä»¶å¤¹å†…çš„`ng serve`ï¼Œä½ å°±ä¼šæœ‰ä¸€ä¸ª app è¿è¡Œåœ¨ [http://localhost:4200/](http://localhost:4200/) :

[![](../Images/63ea27cffedba7eab2e8d8a4d4049cb2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--M9ZFWKoM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/WtR7ukv.png)

#### [](#adding-bulma)æ·»åŠ å¸ƒå°”ç›

å°†æ­¤æ·»åŠ åˆ°`index.html`æ–‡ä»¶:

```
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
  <script defer src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`app.component.html`æ›´æ–°ä¸º:

```
<nav class="navbar">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item">
        JWT Angular Login
      </a>
    </div>

    <div id="navbarMenuHeroA" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item">
          Home
        </a>
        <a class="navbar-item">
          Login
        </a>
        <a class="navbar-item">
          Members
        </a>
        <a class="navbar-item">
          Logout
        </a>
      </div>
    </div>
  </div>
</nav>

<router-outlet></router-outlet>

<footer class="footer">
  <div class="container has-text-centered">
    <div class="content">
      From Croatia with â¤ï¸
    </div>
  </div>
</footer> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ ç°åœ¨çœ‹ä¸€ä¸‹è¿™ä¸ªé¡µé¢ï¼Œä½ ä¼šçœ‹åˆ°:

[![](../Images/47017197c1073c9a253be36d10596047.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--D3LCWnz2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/jiXVEYT.png)

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰é“¾æ¥çš„é¡µçœ‰å’Œä¸€ä¸ªå¸¦æœ‰ç®€å•æ–‡æœ¬çš„é¡µè„šã€‚

å…ƒç´ å°†ç”¨äºæœåŠ¡å…¶ä»–é¡µé¢ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Angular CLI åˆ›å»ºä¸‰ä¸ªæ–°ç»„ä»¶:

```
ng g component home
ng g component login
ng g component members 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Angular CLI æœ‰ç”¨çš„ä¸€ä¸ªåŸå› æ˜¯ï¼Œé€šè¿‡ç”Ÿæˆç»„ä»¶ï¼Œå®ƒä¸ºæˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨`app.module.ts`æ–‡ä»¶ä¸­å¯¼å…¥ç»„ä»¶:

```
create src/app/members/members.component.css (0 bytes)
create src/app/members/members.component.html (26 bytes)
create src/app/members/members.component.spec.ts (635 bytes)
create src/app/members/members.component.ts (273 bytes)
update src/app/app.module.ts (1124 bytes) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿æ¥`app.module.ts` :
ä¸­çš„è·¯çº¿

```
const routes = [
    { path: 'login', component: LoginComponent },
    { path: 'members', component: MembersComponent },
    { path: '', component: HomeComponent },
    { path: '**', redirectTo: '' }
];

...
imports: [
    BrowserModule,
    RouterModule.forRoot(routes)
], 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åƒè¿™æ ·ä½¿ç”¨`routerLink`è®¾ç½®`app.component.html`ä¸­çš„é“¾æ¥:

```
<a class="navbar-item" [routerLink]="['']">Home</a>
<a class="navbar-item" [routerLink]="['/login']">Login</a>
<a class="navbar-item" [routerLink]="['/members']">Members</a> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥ä¼šåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹:

[![](../Images/65da593172b3150f009b831a5e2fad6e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Jbd8xiad--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i.imgur.com/rkIbHca.gif)

#### [](#login)ç™»å½•

å°†`login.component.html`çš„å†…å®¹æ›¿æ¢ä¸º:

```
<section class="hero">
  <div class="hero-body has-text-centered">
    <form [formGroup]="form">
      <div class="columns">
        <div class="column"></div>

        <div class="column is-3">
          <div class="field">
            <label class="label is-pulled-left">Email</label>
            <div class="control">
              <input class="input" type="text" placeholder="john@gmail.com" formControlName="email" name="email">
            </div>
          </div>
        </div>

        <div class="column"></div>
      </div>

      <div class="columns">
        <div class="column"></div>

        <div class="column is-3">
          <div class="field">
            <label class="label is-pulled-left">Password:</label>
            <div class="control">
              <input class="input" type="password" formControlName="password" name="password">
            </div>

            <br>
            <br>
            <a class="button is-primary is-medium is-fullwidth" (click)='login()'>Login</a>
          </div>
        </div>

        <div class="column"></div>
      </div>
    </form>
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶å°†`login.component.ts`åŠ ä¸Š:

```
import { Component, OnInit } from '@angular/core';
import { FormGroup, FormBuilder, Validators, FormsModule, ReactiveFormsModule } from '@angular/forms';

@Component({
    selector: 'app-login',
    templateUrl: './login.component.html',
    styleUrls: ['./login.component.css']
})
export class LoginComponent implements OnInit {
    form: FormGroup;

    constructor(private fb: FormBuilder) {
        this.form = this.fb.group({
            email: ['', Validators.required],
            password: ['', Validators.required]
        });
    }

    ngOnInit() {
    }

    login() {
        console.log('Clicked the Login button');
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨äº†ä¸€å †æ¥è‡ª`@angular/forms`çš„å¯¼å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦å°†å®ƒæ·»åŠ åˆ°`imports`æ•°ç»„ä¸­çš„`app.module.ts`ä¸­:

```
...
imports: [
    BrowserModule,
    FormsModule,
    ReactiveFormsModule,
    RouterModule.forRoot(routes)
],
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æˆ‘ä»¬è¿›å…¥å®é™…çš„èº«ä»½éªŒè¯éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ Home å’Œ Members åŒºåŸŸã€‚

#### [](#home-and-members)é¦–é¡µå’Œæˆå‘˜

å°† HTML æ–‡ä»¶æ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹:

`home.component.html` :

```
<section class="hero" id="hero">
  <div class="hero-head"></div>
  <div class="hero-body">
    <div class="container has-text-centered">
      <h1 class="is-1 title">
        Welcome to JWT Angular Auth!
      </h1>
    </div>
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`members.component.html` :

```
<section class="hero" id="hero">
  <div class="hero-head"></div>
  <div class="hero-body">
    <div class="container has-text-centered">
      <h1 class="is-1 title">
        Members area
      </h1>
    </div>
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#go)å»å§

æˆ‘ä»¬çš„åç«¯æ˜¯ç”¨ Golang å†™çš„ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
package main

import (
    "encoding/json"
    "errors"
    "fmt"
    "io/ioutil"
    "log"
    "net/http"
    "strings"
    "time"

    jwt "github.com/dgrijalva/jwt-go"
    "github.com/rs/cors"
)

const (
    PORT   = "1337"
    SECRET = "42isTheAnswer"
)

type JWTData struct {
    // Standard claims are the standard jwt claims from the IETF standard
    // https://tools.ietf.org/html/rfc7519
    jwt.StandardClaims
    CustomClaims map[string]string `json:"custom,omitempty"`
}

type Account struct {
    Email    string  `json:"email"`
    Balance  float64 `json:"balance"`
    Currency string  `json:"currency"`
}

func main() {
    mux := http.NewServeMux()
    mux.HandleFunc("/", hello)
    mux.HandleFunc("/login", login)
    mux.HandleFunc("/account", account)

    handler := cors.Default().Handler(mux)

    log.Println("Listening for connections on port: ", PORT)
    log.Fatal(http.ListenAndServe(":"+PORT, handler))
}

func hello(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello from Go!")
}

func login(w http.ResponseWriter, r *http.Request) {
    body, err := ioutil.ReadAll(r.Body)
    if err != nil {
        log.Println(err)
        http.Error(w, "Login failed!", http.StatusUnauthorized)
    }

    var userData map[string]string
    json.Unmarshal(body, &userData)

    // Demo - in real case scenario you'd check this against your database
    if userData["email"] == "admin@gmail.com" && userData["password"] == "admin123" {
        claims := JWTData{
            StandardClaims: jwt.StandardClaims{
                ExpiresAt: time.Now().Add(time.Hour).Unix(),
            },

            CustomClaims: map[string]string{
                "userid": "u1",
            },
        }

        token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
        tokenString, err := token.SignedString([]byte(SECRET))
        if err != nil {
            log.Println(err)
            http.Error(w, "Login failed!", http.StatusUnauthorized)
        }

        json, err := json.Marshal(struct {
            Token string `json:"token"`
        }{
            tokenString,
        })

        if err != nil {
            log.Println(err)
            http.Error(w, "Login failed!", http.StatusUnauthorized)
        }

        w.Write(json)
    } else {
        http.Error(w, "Login failed!", http.StatusUnauthorized)
    }
}

func account(w http.ResponseWriter, r *http.Request) {
    authToken := r.Header.Get("Authorization")
    authArr := strings.Split(authToken, " ")

    if len(authArr) != 2 {
        log.Println("Authentication header is invalid: " + authToken)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    jwtToken := authArr[1]

    claims, err := jwt.ParseWithClaims(jwtToken, &JWTData{}, func(token *jwt.Token) (interface{}, error) {
        if jwt.SigningMethodHS256 != token.Method {
            return nil, errors.New("Invalid signing algorithm")
        }
        return []byte(SECRET), nil
    })

    if err != nil {
        log.Println(err)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    data := claims.Claims.(*JWTData)

    userID := data.CustomClaims["userid"]

    // fetch some data based on the userID and then send that data back to the user in JSON format
    jsonData, err := getAccountData(userID)
    if err != nil {
        log.Println(err)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    w.Write(jsonData)
}

func getAccountData(userID string) ([]byte, error) {
    output := Account{"nikola.breznjak@gmail.com", 3.14, "BTC"}
    json, err := json.Marshal(output)
    if err != nil {
        return nil, err
    }

    return json, nil
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> âš ï¸:æˆ‘è¿˜ä¸æ˜¯å›´æ£‹ä¸“å®¶ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™é—¨è¯­è¨€æ—¶é—´é•¿çš„äººä¼šå†™å¾—æ›´åœ°é“ã€‚ä½†æ˜¯ï¼Œå½“ä½ è‡ªå·±é¢å¯¹è¿™ç§æƒ³æ³•æ—¶ï¼Œè®°ä½è¿™ä¸€ç‚¹:â€œå®Œç¾æ˜¯å¥½çš„æ•Œäººâ€ï¼Œé€šè¿‡â€œåœ¨å¤–é¢â€åšä¸œè¥¿å’Œè·å¾—åé¦ˆæ¥å­¦ä¹ æ¯”â€œç­‰ x ä¸ªæœˆç›´åˆ°ä½ æŒæ¡ä¸€é—¨è¯­è¨€â€å¥½å¾—å¤šã€‚

å› æ­¤ï¼Œæˆ‘å°†å°½æœ€å¤§åŠªåŠ›ä»ä¸Šåˆ°ä¸‹è§£é‡Šè¿™æ®µä»£ç çš„ä½œç”¨:

#### [](#package)åŒ…

```
package main 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰`package`è¯­å¥ã€‚æ¯ä¸ª Go ç¨‹åºéƒ½å¿…é¡»æœ‰ä¸€ä¸ª`main`åŒ…ã€‚

#### [](#imports)è¿›å£

```
import (
    "encoding/json"
    "errors"
    "fmt"
    "io/ioutil"
    "log"
    "net/http"
    "strings"
    "time"

    jwt "github.com/dgrijalva/jwt-go"
    "github.com/rs/cors"
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬æœ‰è¿›å£è´§ã€‚é™¤äº† jwt å’Œ cors ä¹‹å¤–ï¼Œæ‰€æœ‰çš„å¯¼å…¥éƒ½æ¥è‡ªæ ‡å‡† Go åº“ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ VS Code ä¹‹ç±»çš„ç¼–è¾‘å™¨ï¼Œæˆ–è€… GoLand ä¹‹ç±»çš„ IDEï¼Œé‚£ä¹ˆè¿™äº›å¯¼å…¥ä¼šåœ¨æ‚¨ä¿å­˜ä»£ç æ—¶è‡ªåŠ¨æ·»åŠ ã€‚

æˆ‘å–œæ¬¢ Go çš„ä¸€ç‚¹æ˜¯å®ƒçš„è‡ªåŠ¨ä»£ç æ ¼å¼ï¼Œæ‰€ä»¥æœ€ç»ˆï¼Œè¿™ç§è¯­è¨€ä¸å†éœ€è¦äº‰è®ºæ‹¬å·æ˜¯åœ¨åŒä¸€è¡Œè¿˜æ˜¯åœ¨ä¸‹ä¸€è¡Œã€‚ä¸€è‡´æ€§ FTWï¼

#### [](#constants)å¸¸æ•°

```
const (
    PORT   = "1337"
    SECRET = "42isTheAnswer"
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‚£ä¹ˆæˆ‘ä»¬æœ‰ä¸¤ä¸ªå¸¸æ•°:`PORT`å’Œ`SECRET`ã€‚è®©æ‰€æœ‰çš„[å¤§å†™å­—æ¯ä»£è¡¨å¸¸é‡](https://stackoverflow.com/questions/22688906/go-naming-conventions-for-const)ä¸æ˜¯è€Œæ˜¯**å›´æ£‹ä¸­çš„æƒ¯ä¾‹ï¼Œä½†æˆ‘ä¼¼ä¹åœ¨ç›²ç›®åœ°åšæŒè¿™ä¸ªä¹ æƒ¯ã€‚**

#### [](#structs)ç»“æ„

```
type JWTData struct {
    // Standard claims are the standard jwt claims from the IETF standard
    // https://tools.ietf.org/html/rfc7519
    jwt.StandardClaims
    CustomClaims map[string]string `json:"custom,omitempty"`
}

type Account struct {
    Email    string  `json:"email"`
    Balance  float64 `json:"balance"`
    Currency string  `json:"currency"`
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç»“æ„:`JWTData`å’Œ`Account`ã€‚`JWTData`ç»“æ„å’Œä¸€äº›æ ‡å‡†å­—æ®µ(å£°æ˜)æœ‰ä¸€ä¸ªé¢å¤–çš„`CustomClaims`æ˜ å°„ï¼Œå¯ä»¥ä¿å­˜`string`ç±»å‹çš„é”®å€¼å¯¹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ•°æ®ç±»å‹æ¥æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„å®šåˆ¶å£°æ˜(`userid`)ã€‚

`Account`ç»“æ„è¢«ç”¨ä½œä¸€ä¸ªç¤ºä¾‹ç»“æ„ï¼Œç”¨äºåœ¨ç”¨æˆ·ç™»å½•å¹¶è¿›å…¥æˆå‘˜é¡µé¢åå¯¹å…¶åšå‡ºå“åº”ã€‚å®ƒåŒ…å«`Email`ã€`Balance`å’Œ`Currency`å­—æ®µã€‚

#### [](#main)ä¸»

```
func main() {
    mux := http.NewServeMux()
    mux.HandleFunc("/", hello)
    mux.HandleFunc("/login", login)
    mux.HandleFunc("/account", account)

    handler := cors.Default().Handler(mux)

    log.Println("Listening for connections on port: ", PORT)
    log.Fatal(http.ListenAndServe(":"+PORT, handler))
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`main`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸º APIâ€œæ³¨å†Œâ€äº†å¤„ç†ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬å‡è®¾è¿™ä¸ª Go ç¨‹åºå°†åœ¨ä¸€ä¸ªåŸŸ`http://api.boringcompany.com`ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ª URL çš„è¯·æ±‚å°†ç”±ä¸‹é¢æ˜¾ç¤ºçš„`hello`å‡½æ•°å¤„ç†ã€‚å¦‚æœè¯·æ±‚è¢«å‘é€åˆ°`http://api.boringcompany.com/login` URLï¼Œå®ƒå°†è¢«æˆ‘ä»¬å°†åœ¨ä¸‹é¢å±•ç¤ºçš„`login`å‡½æ•°å¤„ç†ï¼Œç­‰ç­‰ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡`log`æ‰“å°æ¶ˆæ¯ï¼Œå¹¶ç”¨`http.ListenAndServe`å‡½æ•°å¯åŠ¨æœåŠ¡å™¨ã€‚

åªæœ‰åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œæ‰éœ€è¦ CORS å¤„ç†ç¨‹åºã€‚å¦‚æœä½ ä¼šè¿™æ ·åšï¼Œé‚£ä¹ˆæˆ‘ä¹Ÿæ¨èä½ æ­£åœ¨ä½¿ç”¨çš„æµè§ˆå™¨çš„ CORS æ’ä»¶([è¿™é‡Œæ˜¯æˆ‘ç”¨äº Chrome çš„ä¸€ä¸ª](https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?hl=en))ã€‚

#### [](#hello-handler)æ‚¨å¥½å¤„ç†ç¨‹åº

```
func hello(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello from Go!")
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æˆ‘ä»¬çš„ä¸» API URL æ—¶ï¼Œå®ƒä¼šå°†`Hello from Go!`è¾“å‡ºç»™ç”¨æˆ·ã€‚

#### [](#login-handler)ç™»å½•å¤„ç†ç¨‹åº

```
func login(w http.ResponseWriter, r *http.Request) {
    body, err := ioutil.ReadAll(r.Body)
    if err != nil {
        log.Println(err)
        http.Error(w, "Login failed!", http.StatusUnauthorized)
    }

    var userData map[string]string
    json.Unmarshal(body, &userData)

    // Demo - in real case scenario you'd check this against your database
    if userData["email"] == "admin@gmail.com" && userData["password"] == "admin123" {
        claims := JWTData{
            StandardClaims: jwt.StandardClaims{
                ExpiresAt: time.Now().Add(time.Hour).Unix(),
            },

            CustomClaims: map[string]string{
                "userid": "u1",
            },
        }

        token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
        tokenString, err := token.SignedString([]byte(SECRET))
        if err != nil {
            log.Println(err)
            http.Error(w, "Login failed!", http.StatusUnauthorized)
        }

        json, err := json.Marshal(struct {
            Token string `json:"token"`
        }{
            tokenString,
        })

        if err != nil {
            log.Println(err)
            http.Error(w, "Login failed!", http.StatusUnauthorized)
        }

        w.Write(json)
    } else {
        http.Error(w, "Login failed!", http.StatusUnauthorized)
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`login`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¯»å–è¯·æ±‚çš„ä¸»ä½“ï¼Œè§£æå‡º`email`å’Œ`password`å‚æ•°ã€‚ç„¶åæˆ‘ä»¬æ£€æŸ¥è¿™ä¸ªç”µå­é‚®ä»¶/å¯†ç ç»„åˆï¼Œç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„ã€‚å½“ç„¶ï¼Œå‡ºäºæ¼”ç¤ºçš„ç›®çš„ï¼Œä»£ç ä¸­æ˜¯è¿™æ ·åšçš„ï¼›åœ¨çœŸå®æƒ…å†µä¸‹ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šæ ¹æ®æ‚¨çš„æ•°æ®åº“æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚

å¦‚æœç”¨æˆ·å‡­è¯æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘ä»¬å‡†å¤‡å£°æ˜ï¼Œå…¶ä¸­æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„`ExpiresAt`å£°æ˜ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰å£°æ˜`userid`ï¼Œå€¼ä¸º`u1`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`jwt.NewWithClaims`å‡½æ•°å’Œ`HS256`å“ˆå¸Œç®—æ³•å¯¹æŠ¥å¤´å’Œæœ‰æ•ˆè½½è·è¿›è¡Œç­¾åï¼Œå¹¶ä½¿ç”¨`SECRET`ä½œä¸ºå¯†é’¥ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªä»¤ç‰Œä»¥ JSON æ ¼å¼è¿”å›ç»™ç”¨æˆ·ã€‚

å¦åˆ™ï¼Œå¦‚æœå‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œæˆ‘ä»¬å°†å‘é€å›å¸¦æœ‰å¤±è´¥æ¶ˆæ¯çš„æœªæˆæƒçŠ¶æ€ã€‚

#### [](#account-handler)è´¦æˆ·å¤„ç†äºº

```
func account(w http.ResponseWriter, r *http.Request) {
    authToken := r.Header.Get("Authorization")
    authArr := strings.Split(authToken, " ")

    if len(authArr) != 2 {
        log.Println("Authentication header is invalid: " + authToken)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    jwtToken := authArr[1]

    claims, err := jwt.ParseWithClaims(jwtToken, &JWTData{}, func(token *jwt.Token) (interface{}, error) {
        if jwt.SigningMethodHS256 != token.Method {
            return nil, errors.New("Invalid signing algorithm")
        }
        return []byte(SECRET), nil
    })

    if err != nil {
        log.Println(err)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    data := claims.Claims.(*JWTData)

    userID := data.CustomClaims["userid"]

    // fetch some data based on the userID and then send that data back to the user in JSON format
    jsonData, err := getAccountData(userID)
    if err != nil {
        log.Println(err)
        http.Error(w, "Request failed!", http.StatusUnauthorized)
    }

    w.Write(jsonData)
}

func getAccountData(userID string) ([]byte, error) {
    output := Account{"nikola.breznjak@gmail.com", 3.14, "BTC"}
    json, err := json.Marshal(output)
    if err != nil {
        return nil, err
    }

    return json, nil
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`account`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¯»å–`Authorization`å¤´å¹¶å–å‡ºä»¤ç‰Œã€‚ç„¶åï¼Œæˆ‘ä»¬ç¡®ä¿ä»¤ç‰Œæ˜¯æœ‰æ•ˆçš„å¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨`jwt.ParseWithClaims`å‡½æ•°è§£æå‡ºå£°æ˜ã€‚

ä½¿ç”¨`userID`å£°æ˜ï¼Œæˆ‘ä»¬è·å–ä¸€äº›æ•°æ®(ä½¿ç”¨`getAccountData`å‡½æ•°),ç„¶åä»¥ JSON æ ¼å¼å°†æ•°æ®å‘é€å›ç”¨æˆ·ã€‚

#### [](#running-the-go-app)è¿è¡Œ Go åº”ç”¨

æ‚¨å¯ä»¥ä½¿ç”¨`go run main.go`åœ¨æ‚¨çš„ç”µè„‘ä¸Šæœ¬åœ°è¿è¡Œæ­¤åº”ç”¨ç¨‹åºã€‚å½“ç„¶ï¼Œä½ éœ€è¦å®‰è£… Goã€‚ä½ å¯ä»¥åœ¨æœ¬æ•™ç¨‹ä¸­æŸ¥çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

### [](#finishing-up-the-angular-frontend)å®Œæˆæœ‰è§’çš„å‰ç«¯

ç°åœ¨è®©æˆ‘ä»¬åˆ‡æ¢å›æˆ‘ä»¬çš„ Angular é¡¹ç›®ï¼Œå¹¶å‘æˆ‘ä»¬çš„ API å‘å‡ºå®é™…è¯·æ±‚ã€‚

#### [](#auth-service)è®¤è¯æœåŠ¡

ä½¿ç”¨ Angular CLIï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```
ng g service auth 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç°åœ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶:

```
create src/app/auth.service.spec.ts (362 bytes)
create src/app/auth.service.ts (110 bytes) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°`auth.service.ts`æ–‡ä»¶ä¸­:

```
import { Injectable } from '@angular/core';
import { RequestOptions, Response } from '@angular/http';

import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Router } from '@angular/router';

@Injectable()
export class AuthService {

    API_URL = 'http://localhost:1337';
    TOKEN_KEY = 'token';

    constructor(private http: HttpClient, private router: Router) { }

    get token() {
        return localStorage.getItem(this.TOKEN_KEY);
    }

    get isAuthenticated() {
        return !!localStorage.getItem(this.TOKEN_KEY);
    }

    logout() {
        localStorage.removeItem(this.TOKEN_KEY);
        this.router.navigateByUrl('/');
    }

    login(email: string, pass: string) {
        const headers = {
            headers: new HttpHeaders({ 'Content-Type': 'application/json', 'Cache-Control': 'no-cache' })
        };

        const data = {
            email: email,
            password: pass
        };

        this.http.post(this.API_URL + '/login', data, headers).subscribe(
            (res: any) => {
                localStorage.setItem(this.TOKEN_KEY, res.token);

                this.router.navigateByUrl('/members');
            }
        );
    }

    getAccount() {
        return this.http.get(this.API_URL + '/account');
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`AuthService`ç”±è¿™äº›åŠŸèƒ½ç»„æˆ:

*   `login` -æˆ‘ä»¬å°†ç”¨æˆ·è¾“å…¥çš„ç”µå­é‚®ä»¶/å¯†ç å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°†ä»¤ç‰Œå­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ã€‚*è¯·æ³¨æ„æˆ‘åœ¨æœ¬æ•™ç¨‹ç†è®ºéƒ¨åˆ†ç»™å‡ºçš„è­¦å‘Šã€‚*
*   `logout` -æˆ‘ä»¬ä»æœ¬åœ°å­˜å‚¨ä¸­åˆ é™¤ä»¤ç‰Œï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µé¢
*   `token` -ä»æœ¬åœ°å­˜å‚¨å™¨è¿”å›ä»¤ç‰Œ
*   `isAuthenticated` -å¦‚æœä»¤ç‰Œå­˜åœ¨äºæœ¬åœ°å­˜å‚¨å™¨ä¸­ï¼Œåˆ™è¿”å›çœŸ/å‡
*   `getAccount` -è¯·æ±‚ç”¨æˆ·æ•°æ®å¹¶è¿”å›æ‰¿è¯º

#### [](#login-component)ç™»å½•ç»„ä»¶

```
import { Component, OnInit } from '@angular/core';
import { FormGroup, FormBuilder, Validators, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { AuthService } from '../auth.service';

@Component({
    selector: 'app-login',
    templateUrl: './login.component.html',
    styleUrls: ['./login.component.css']
})
export class LoginComponent implements OnInit {
    form: FormGroup;

    constructor(private fb: FormBuilder, private authService: AuthService) {
        this.form = this.fb.group({
            email: ['', Validators.required],
            password: ['', Validators.required]
        });
    }

    ngOnInit() {
    }

    login() {
        const val = this.form.value;

        if (val.email && val.password) {
            this.authService.login(val.email, val.password);
        }
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯ç™»å½•å‡½æ•°ï¼Œå®ƒè°ƒç”¨`AuthService`ç™»å½•å‡½æ•°å¹¶ä¼ é€’ç»™å®ƒ`email`å’Œ`password`ã€‚æˆ‘ä»¬ä½¿ç”¨ Angular ä¸­çš„`FormBuilder`æ¥è®¿é—® HTML ä»£ç ä¸­çš„è¡¨å•å­—æ®µï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<section class="hero">
  <div class="hero-body has-text-centered">
    <form [formGroup]="form">
      <div class="columns">
        <div class="column"></div>

        <div class="column is-3">
          <div class="field">
            <label class="label is-pulled-left">Email</label>
            <div class="control">
              <input class="input" type="text" placeholder="john@gmail.com" formControlName="email" name="email">
            </div>
          </div>
        </div>

        <div class="column"></div>
      </div>

      <div class="columns">
        <div class="column"></div>

        <div class="column is-3">
          <div class="field">
            <label class="label is-pulled-left">Password:</label>
            <div class="control">
              <input class="input" type="password" formControlName="password" name="password">
            </div>

            <br>
            <br>
            <a class="button is-primary is-medium is-fullwidth" (click)='login()'>Login</a>
          </div>
        </div>

        <div class="column"></div>
      </div>
    </form>
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„`<form [formGroup]="form">`å’Œ`formControlName="email"`ã€‚åœ¨ Angular ä¸­ï¼Œæˆ‘ä»¬è¿™æ ·æ³¨å†Œç‚¹å‡»å¤„ç†ç¨‹åº:`(click)='login()'`ã€‚

#### [](#members-component)æˆå‘˜æ„ä»¶

æˆå‘˜ç»„ä»¶ç›¸å½“ç®€å•:

```
<section class="hero" id="hero">
  <div class="hero-head"></div>
  <div class="hero-body">
    <div class="container has-text-centered">
      <h1 class="is-1 title">
        Members area
      </h1>

      <p>Email:
        <b>{{accountData?.email}}</b>
      </p>
      <p>Balance:
        <b>{{accountData?.balance}} {{accountData?.currency}}</b>
      </p>
    </div>
  </div>
</section> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç”¨å®ƒæ¥æ˜¾ç¤ºæˆ‘ä»¬å°†ä» API ä¸­è·å¾—çš„ä¸€äº›æ•°æ®ã€‚éå¸¸é‡è¦çš„éƒ¨åˆ†æ˜¯ä½¿ç”¨äº†`?`â€”â€”è¿™æŒ‡ç¤º Angular åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ä¸è¦æŠ›å‡ºé”™è¯¯ï¼Œä»¥é˜²æ•°æ®å°šä¸å­˜åœ¨(å› ä¸ºæˆ‘ä»¬å°†ä» API ä¸­è·å–è¿™äº›æ•°æ®ï¼Œæ‰€ä»¥ä¼šå‡ºç°è¿™ç§æƒ…å†µ)ã€‚

æ§åˆ¶å™¨ä»£ç å¦‚ä¸‹:

```
import { Component, OnInit } from '@angular/core';
import { AuthService } from '../auth.service';
import { Router } from '@angular/router';

@Component({
    selector: 'app-members',
    templateUrl: './members.component.html',
    styleUrls: ['./members.component.css']
})
export class MembersComponent implements OnInit {
    accountData: any;
    constructor(private authService: AuthService, private router: Router) { }

    ngOnInit() {
        this.authService.getAccount().subscribe(
            (res: any) => {
                this.accountData = res;
            }, (err: any) => {
                this.router.navigateByUrl('/login');
            }
        );
    }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç»„ä»¶åŠ è½½æ—¶ï¼Œæˆ‘ä»¬å‘ API å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°†æ•°æ®ä¿å­˜åœ¨`accountData`å˜é‡ä¸­ï¼Œç„¶ååƒå‰é¢çœ‹åˆ°çš„é‚£æ ·åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¯¥å˜é‡ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬ä¼šå°†ç”¨æˆ·è½¬åˆ°ç™»å½•é¡µé¢ã€‚

#### app.component.html

```
<nav class="navbar">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item">
        JWT Angular Login
      </a>
    </div>

    <div id="navbarMenuHeroA" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" [routerLink]="['']">
          Home
        </a>
        <a class="navbar-item" [routerLink]="['/login']" *ngIf="!authService.isAuthenticated">
          Login
        </a>
        <a class="navbar-item" [routerLink]="['/members']" *ngIf="authService.isAuthenticated">
          Members
        </a>
        <a class="navbar-item" *ngIf="authService.isAuthenticated" (click)="authService.logout()">
          Logout
        </a>
      </div>
    </div>
  </div>
</nav>

<router-outlet></router-outlet>

<footer class="footer">
  <div class="container has-text-centered">
    <div class="content">
      From Croatia with â¤ï¸
    </div>
  </div>
</footer> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œéœ€è¦æ³¨æ„çš„é‡è¦éƒ¨åˆ†æ˜¯ä½¿ç”¨`*ngIf="!authService.isAuthenticated"`æ ¹æ®ç”¨æˆ·æ˜¯å¦ç™»å½•æ¥æ˜¾ç¤º/éšè—å¯¼èˆªé“¾æ¥ã€‚

åœ¨â€œä»£ç â€æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ç¡®ä¿é€šè¿‡æ„é€ å‡½æ•°`constructor(private authService: AuthService) { }`å¯¼å…¥ AuthServiceã€‚

#### [](#appmodulets)åº”ç”¨æ¨¡å—. ts

```
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { RouterModule } from '@angular/router';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';

import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { LoginComponent } from './login/login.component';
import { MembersComponent } from './members/members.component';

import { AuthService } from './auth.service';
import { AuthInterceptorService } from './auth-interceptor.service';
import { CanActivateViaAuthGuard } from './can-activate-via-auth.guard';

const routes = [
    { path: 'login', component: LoginComponent },
    {
        path: 'members',
        component: MembersComponent,
        canActivate: [
            CanActivateViaAuthGuard
        ]
    },
    { path: '', component: HomeComponent },
    { path: '**', redirectTo: '' }
];

@NgModule({
    declarations: [
        AppComponent,
        HomeComponent,
        LoginComponent,
        MembersComponent
    ],
    imports: [
        BrowserModule,
        FormsModule,
        ReactiveFormsModule,
        HttpClientModule,
        RouterModule.forRoot(routes)
    ],
    providers: [
        AuthService,
        {
            provide: HTTP_INTERCEPTORS,
            useClass: AuthInterceptorService,
            multi: true
        },
        CanActivateViaAuthGuard
    ],
    bootstrap: [AppComponent]
})
export class AppModule { } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæ–‡ä»¶å¯¼å…¥äº†æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æ‰€æœ‰ç»„ä»¶ã€‚å¦‚æ‚¨æ‰€è§ï¼Œåœ¨â€œå£°æ˜â€ä¸­ï¼Œæˆ‘ä»¬åˆ—å‡ºäº†æ­£åœ¨ä½¿ç”¨çš„ç»„ä»¶ï¼Œ`imports`åŒ…å«äº†ç”¨äºå¤„ç†è¡¨å•æˆ–å‘é€ HTTP è¯·æ±‚çš„å¯¼å…¥ç»„ä»¶ã€‚

#### [](#guards-and-interceptors)å®ˆå«å’Œæ‹¦æˆªè€…

æœ€åï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°`providers`æ•°ç»„ä¸­çš„ä¸€äº›æ–°ä¸œè¥¿ï¼Œåœ¨é€šå¸¸çš„`AuthService`ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªé¢å¤–çš„ä¸œè¥¿(æ‹¦æˆªå™¨æœåŠ¡å’Œæˆæƒä¿æŠ¤):

```
{
    provide: HTTP_INTERCEPTORS,
    useClass: AuthInterceptorService,
    multi: true
},
CanActivateViaAuthGuard 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‹¦æˆªå™¨æœåŠ¡æœ‰ä¸€ä¸ªä»»åŠ¡:æ‹¦æˆªæ¥è‡ªåº”ç”¨ç¨‹åºçš„æ¯ä¸ªè¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ä»¤ç‰Œ:

```
import { Injectable, Injector } from '@angular/core';
import { HttpInterceptor } from '@angular/common/http';
import { AuthService } from './auth.service';

@Injectable()
export class AuthInterceptorService implements HttpInterceptor {

    constructor(private injector: Injector) { }

    intercept(req, next) {
        const authService = this.injector.get(AuthService);
        const authRequest = req.clone({
            // tslint:disable-next-line:max-line-length
            headers: req.headers.set('Authorization', 'Bearer ' + authService.token)
        });

        return next.handle(authRequest);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ˆå«ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒæ˜¯è¿™æ ·å®šä¹‰çš„:

```
import { Injectable } from '@angular/core';
import { CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';
import { Observable } from 'rxjs/Observable';
import { AuthService } from './auth.service';

@Injectable()
export class CanActivateViaAuthGuard implements CanActivate {
    constructor(private authService: AuthService) {

    }

    canActivate() {
        return this.authService.isAuthenticated;
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ‰€è°“çš„â€œcanActivateâ€ä¿æŠ¤ï¼Œå½“æˆ‘ä»¬å¸Œæœ›é˜»æ­¢ç”¨æˆ·è¿›å…¥ä»–æ— æƒè®¿é—®çš„åº”ç”¨ç¨‹åºä¸­çš„æŸä¸ªè·¯çº¿æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å®ƒã€‚æˆ‘ä»¬åœ¨è·¯ç”±å®šä¹‰ä¸­ä½¿ç”¨è¿™ç§ä¿æŠ¤æªæ–½æ¥é˜²æ­¢ç”¨æˆ·åœ¨æ²¡æœ‰ç™»å½•çš„æƒ…å†µä¸‹è¿›å…¥`/members`é“¾æ¥:

```
const routes = [
    { path: 'login', component: LoginComponent },
    {
        path: 'members',
        component: MembersComponent,
        canActivate: [
            CanActivateViaAuthGuard
        ]
    },
    { path: '', component: HomeComponent },
    { path: '**', redirectTo: '' }
]; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æ‚¨å°†æ‰€æœ‰è¿™äº›è¿æ¥èµ·æ¥(å¹¶åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ª Go ç¨‹åº)æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°:

[![](../Images/b075c19bb0365fe26c447edaeb5b6355.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--XVVmgAUZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i.imgur.com/7Dk3EJ7.gif)

## [](#conclusion)ç»“è®º

åœ¨è¿™ç¯‡é•¿æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¶‰åŠäº†å¾ˆå¤šå†…å®¹:

*   æˆ‘ä»¬äº†è§£äº†ä¸€äº› jwt æ˜¯å¦‚ä½•å·¥ä½œçš„
*   æˆ‘ä»¬ç”¨ JavaScript å’Œ Go åˆ›å»ºäº†è‡ªå·±çš„ JWT
*   æˆ‘ä»¬åœ¨å‰ç«¯ä½¿ç”¨ Angular 5 åˆ¶ä½œäº†ä¸€ä¸ªæˆç†Ÿçš„åº”ç”¨ç¨‹åºï¼Œåœ¨åç«¯ä½¿ç”¨ JWTs è¿›è¡Œèº«ä»½éªŒè¯
*   æˆ‘ä»¬ä½¿ç”¨äº† angularjs è­¦å«å’Œæˆªå‡»æœº

æˆ‘å¸Œæœ›è¿™è¶³ä»¥è®©æ‚¨å¼€å§‹å¹¶å»ºç«‹åœ¨è¿™ä¸ªä¾‹å­ä¹‹ä¸Šã€‚

å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸­è”ç³»æˆ‘ä»¬ã€‚