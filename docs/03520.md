# OpenBSD httpd 6.3: Web æœåŠ¡å™¨

> åŸæ–‡:[https://dev . to/nab bisen/setting-up-openbsds-httpd-we b-server-4p9f](https://dev.to/nabbisen/setting-up-openbsds-httpd-web-server-4p9f)

## [T1ã€‘ç®€ä»‹](#intro)

OpenBSD æœ‰è‡ªå·±çš„ web æœåŠ¡å™¨ï¼Œåä¸ºâ€œ [httpd](https://man.openbsd.org/httpd.8) â€ã€‚

* * *

### [](#backgrounds)èƒŒæ™¯

åœ¨ OpenBSD ä¸Šå¯ä»¥å®‰è£… [Nginx](https://www.nginx.com/resources/wiki/start/topics/tutorials/openbsd/) å’Œ [Apache](http://httpd.apache.org/) (ç§°ä¸ºâ€œapache-httpdâ€)ã€‚

ç„¶è€Œï¼Œç”±äºå†å²èƒŒæ™¯çš„åŸå› ï¼Œä»–ä»¬å¹¶æ²¡æœ‰å¾—åˆ°å®˜æ–¹çš„æ”¯æŒã€‚
Nginx åœ¨ 2015 å¹´ [5.6 ç‰ˆæœ¬](https://man.openbsd.org/OpenBSD-5.6/man8/nginx.8)ç»“æŸæ—¶ä»å®˜æ–¹æ‰‹å†Œä¸­æ¶ˆå¤±ã€‚
OpenBSD httpd éšååŠ å…¥ã€‚

ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®‰è£… [Caddy](https://caddyserver.com/download) ã€‚

* * *

å¦ç‡åœ°è¯´ï¼ŒOpenBSD httpd çš„ conf ä¾‹å­å’Œæ•™ç¨‹ä¼¼ä¹æ¯”ä»–ä»¬å°‘ã€‚å› æ­¤ï¼Œæœ‰äº›äººå¯èƒ½è®¤ä¸ºè¿™æ›´å›°éš¾ã€‚

æˆ‘å–œæ¬¢ OpenBSD httpdï¼Œå› ä¸ºå®ƒç®€å•ã€æœ€å°åŒ–[å¹¶å¸¦æœ‰æ˜ç¡®è®¸å¯çš„](https://cvsweb.openbsd.org/src/share/misc/license.template?rev=HEAD)ï¼Œå¥å£®ä¸”å®‰å…¨ï¼Œå› æ­¤ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒå¾ˆæ¼‚äº®ã€‚
è¿˜æœ‰ï¼Œéšç€[ä¸­ç»§](https://man.openbsd.org/relayd.8)å®ƒå˜å¾—æ›´åŠ å¼ºå¤§ã€‚

<center>âœ¿ âœ¿ âœ¿</center>

### [](#environment)ç¯å¢ƒ

*   æ“ä½œç³»ç»Ÿ:OpenBSD 6.3 amd64

## [](#procedure)ç¨‹åº

### [](#1-prepare-a-configuration-file)1ã€‚å‡†å¤‡é…ç½®æ–‡ä»¶

æ¿€æ´» httpd æœåŠ¡éœ€è¦ [`httpd.conf`](https://man.openbsd.org/httpd.conf.5) ã€‚
é»˜è®¤è·¯å¾„æ˜¯`/etc/httpd.conf`ã€‚

#### [](#11-make-raw-etchttpdconf-endraw-)1-1ã€‚åˆ¶ä½œ`/etc/httpd.conf`

```
#  # Using fish shell:
#  if not test -e /etc/httpd.conf; touch /etc/httpd.conf; end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç„¶ï¼Œç®€å•çš„ç”¨`touch /etc/httpd.conf`æˆ–è€…`vi /etc/httpd.conf`éƒ½å¯ä»¥ã€‚

#### [](#12-edit-raw-etchttpdconf-endraw-)1-2ã€‚ç¼–è¾‘`/etc/httpd.conf`

```
#[ MACROS ] ext_ip = "127.0.0.1"
# ext_ip = "*"      # open to the outside network
# ext_ip = "egress" # open to only the primary IP address of the network interface 
# [ GLOBAL CONFIGURATION ]
# none 
# [ SERVERS ] server "default" {
    listen on $ext_ip port 80
    root "/htdocs/my.domain"
}

# [ TYPES ] types {
    include "/usr/share/misc/mime.types"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*(æ³¨æ„)* `root`â€œæœåŠ¡å™¨â€éƒ¨åˆ†çš„å±æ€§æ˜¯æŒ‡`/var/www`ä¸‹çš„ç›®å½•ã€‚å®˜æ–¹æ–‡ä»¶åœ¨[å…¨çƒé…ç½®](https://man.openbsd.org/httpd.conf.5#GLOBAL_CONFIGURATION)éƒ¨åˆ†æåˆ°:

> chroot ç›®å½•
> è®¾ç½® chroot(2)ç›®å½•ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º/var/wwwï¼Œå³ www ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚

å¯é€‰åœ°æ·»åŠ å…¶ä»–æœåŠ¡å™¨å®šä¹‰ï¼Œå¦‚ä¸‹:

```
server "www.https-example.domain" { 
    alias "https-example.domain" 
    listen on $ext_ip port 80 
    listen on $ext_ip tls port 443
    tls {
        key         "/etc/ssl/private/www.https-example.domain.key"
        certificate "/etc/ssl/www.https-example.domain.crt"
    }
    root "/htdocs/www.https-example.domain" 
}

server "www.fastcgi-example.domain" {
    alias "fastcgi-example.domain"
    listen on $ext_ip port 80
    fastcgi socket ":{% port-number %}"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¬æ–‡æ˜¯[è¿™é‡Œ](https://man.openbsd.org/httpd.conf.5)ã€‚

#### [](#13-make-indexhtml-for-testing)1-3ã€‚è®© index.html æ¥å—æµ‹è¯•

```
#  mkdir -p /var/www/htdocs/my.domain
#  chown {% user %}:{% group %} /var/www/htdocs/my.domain # if necessary
$  echo "Hello, world. from OpenBSD httpd" > /var/www/htdocs/my.domain/index.html 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#2-activate-httpd-service)2ã€‚æ¿€æ´» httpd æœåŠ¡

å¯ç”¨ httpd:

```
#  rcctl enable httpd 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨:è¿™æ¬¡`/etc/rc.conf.local`æ˜¯è¿™æ ·åˆ›å»ºçš„:*

```
#  cat /etc/rc.conf.local
httpd_flags= 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶å¯åŠ¨å®ƒ:

```
#  rcctl start httpd
httpd(ok) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨:é»˜è®¤è®¾ç½®:`httpd_flags=NO`ã€`# rcctl -f start httpd`ä¸‹å¯ä»¥å¼ºåˆ¶å¯åŠ¨ httpdã€‚*

### [](#3-test-if-the-server-is-listening)3ã€‚æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦åœ¨ç›‘å¬

```
$  curl localhost:80
Hello, world. from OpenBSD httpd 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<center>âœ¿ âœ¿ âœ¿</center>

## [](#outro)å…¶ä»–

éå¸¸æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚
ä¸ºğŸ•ŠæœåŠ¡æ„‰å¿«