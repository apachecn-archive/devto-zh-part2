# SQL Server Reporting Services:从战壕中吸取的教训

> 原文：<https://dev.to/bengreenberg/sql-server-reporting-services-lessons-learned-from-the-trenches-1p0d>

两个月前，我甚至还没有听说过 SQL Server Reporting Services(SSRS ),我对 SQL 最感兴趣的体验是在 Rails 中使用 ActiveRecord 操作数据库。然而，在过去的近两个月里，我全职为一家金融服务公司优化现有的 SSRS 报表和创建新的 SSRS 报表。这绝对是一次学习经历，让我以我以前从未想过的方式与 SQL 进行了深入的互动。

我学到了哪些关键的经验教训，我希望从第一天就知道？

## 了解你的数据库

这也许是最重要的一点，也是绝对必要的。在参与任何报告之前，花些时间认真研究一下数据库。了解你的数据。和你的数据成为好朋友。在几次约会中拿出你的数据。

这些表之间有什么关系？识别每个表中的外键以及数据库中一个项目的各种连接方式。做到这一点的一个好方法是从表中随机选取几行，并跟踪它在数据库中的路径。如果是销售表，销售记录如何与客户、销售人员、公司等相关联。？

你的数据库里有什么样的数据？列类型是否与其中存储的数据类型相匹配？这是一个经常被忽视的方面，但是如果您正在使用一个遗留数据库，不要做任何假设。此外，如果您发现存储的数据类型有差异(例如，varchar 列中的日期),请调查原因。很可能这是一个疏忽，但总有可能是有原因的。也许原因是错误的，也许它不再适用，但尽管如此，调查是好的。

## 有目的地建立你的查询

SQL Server Management Studio 是构建 SQL 查询的绝佳工具。用户界面相对容易导航，并且内置了一些很好的诊断信息。注意执行查询需要多长时间。需要几秒钟以上吗？这是为什么呢？您是否在不必要地使用“昂贵”的 SQL 操作？

在使用 SSRS 构建报表之前，尽可能提高 SQL 查询的性能非常重要，因为 SSRS 会增加处理和呈现报表的额外时间。从业务角度来看，终端用户需要等待报表加载并盯着可怕的“正在加载”显示的每一秒钟，对开发人员来说都是坏消息。报表的执行日志实际上保存在报表服务器的数据库中，您可以查看按查询、处理和呈现细分的报表呈现所需的时间。这将非常有助于优化你的报告，这是你不可避免地需要做的。

当运行您在 SQL Server Management Studio 中构建的查询时，一个有用的选项是能够查看该查询的执行计划。您将看到执行查询的路径，以及每个点的时间和一些关键的诊断信息，比如一个表是否没有索引。使用执行计划中提供的信息，我能够将查询的执行时间从大约 30 秒减少到 1 秒。

## SSRS 很贵

不，我不是说就钱而言它很贵。就时间而言，SSRS 是昂贵的。有这么多有用的功能可用于构建您的报告。你可能会想把它们都用上。把我的战斗伤疤当作警告。把它们当作有价值的商品，你想节约使用，只在必要的时候使用。即使是看起来很基本的项目，如报表中表格的“尽可能将项目保留在一页上”选项，也可能会在处理过程中花费宝贵的时间，并导致您的用户向您发送电子邮件，询问为什么报表需要这么长时间。

但是，除非你返回的是十(也许是百？)在成千上万的记录中，有一些功能，如果小心谨慎地使用，确实可以在开发报告时节省一些精力。但是，我再重复一遍，尝试让您从查询中带回的数据尽可能格式化，并尽量减少 SSRS 的这类工作。已经证明对数据或美观有用的 SSRS 功能的一些例子:在表格中交替行颜色、按用户定义的参数排序、点击通过一个项目到另一个报告(例如从摘要报告到详细的子报告)或外部 URL 的能力，以及为行中没有数据的列提供默认文本。

## 小心你的数据集

在最近的一份报告中，我被要求为数据之间的多种细微关系创建多种数据表示。我首先想到的是创建多个数据集，每个数据集对应一种数据关系。然而，事实证明这非常具有挑战性。让多个数据集中的字段出现在同一个表中非常困难，需要很多变通方法。此外，在 SSRS 开始处理和呈现数据以及应用于报表的所有格式之前，必须执行每个数据集的查询。查询越多，用户查看报告“加载”显示的时间就越长。

最终，我想出了一种方法，通过一个查询就可以得到我需要的所有数据，并且我将数据集减少到一个。然而，我忘了删除旧的数据集！我花了大约 30 分钟(虽然感觉时间更长)才意识到每次运行报告时都在运行那些旧的数据集查询。这个故事的教训是:小心处理你的数据集。

## 用户参数

用户喜欢根据自己的需求定制报告的能力。此外，作为一名开发人员，当您可以只创建一个报告并让用户选择为哪个业务线运行它时，为什么要为 8 个不同的业务线构建 8 个报告呢？然而，尽管参数可能很大，但它们也是一个真正的复杂因素。

想要将报表设置为在夜间运行并缓存数据，以便用户在早上打开报表时，报表会立即呈现？如果用户每次打开报表时都要选择一个日期范围，那就很难做到。您打算缓存一周中每一天的数据吗？月份？年份？如果他们可以选择一个日期范围、一个业务服务线、一类员工或特定员工等等，又会怎么样呢？用户可以选择的参数越多，报告的变化就越多。

对我来说，真正有助于加快报告速度的一项是将参数值赋给数据集查询中声明的变量，并在查询中使用该变量，而不是参数本身的值。老实说，我不确定为什么这样会让事情变得更快，但是对于我做过的每一个报告来说都是如此。

除此之外，花时间在没有 ORM 库的 SQL 奇妙世界中，会让你在下次用 ActiveRecord、Doctrine、SQLAlchemy 等构建方法时，更加欣赏和理解幕后发生的事情。如果你像我一样，第一次接近 SSRS，我希望这些建议对你的学习有所帮助。