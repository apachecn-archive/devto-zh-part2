# å‡½æ•°å¼ JavaScript:å‡½æ•°è£…é¥°å™¨ç¬¬ 2 éƒ¨åˆ†#JavaScript

> åŸæ–‡:[https://dev . to/Joel net/function-decorators-part-2-JavaScript-4k M9](https://dev.to/joelnet/function-decorators-part-2-javascript-4km9)

[æœ¬æ–‡æœ€åˆå‘å¸ƒåœ¨åª’ä½“](https://hackernoon.com/function-decorators-part-2-javascript-fadd24e57f83)ä¸Šã€‚

# å¼€å¤´

> **å‡½æ•°è£…é¥°å™¨**å…è®¸ä½ åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°çš„æƒ…å†µä¸‹å¢å¼ºç°æœ‰å‡½æ•°ã€‚

åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­ï¼Œæˆ‘æ¼”ç¤ºäº†å‡½æ•°è£…é¥°è€…å¦‚ä½•å°†å›è°ƒè½¬åŒ–ä¸ºæ‰¿è¯ºï¼Œç„¶åå†è½¬åŒ–å›æ¥ã€‚ä½†æ˜¯å‡½æ•°è£…é¥°å™¨æ¯”æœ‰é™èŒƒå›´çš„å›è°ƒå’Œæ‰¿è¯ºæœ‰ç”¨å¾—å¤šï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºè¿™ä¸ªä¸»é¢˜éœ€è¦é‡å¯ã€‚

æˆ‘è®¤ä¸ºå±•ç¤ºä¸€å †ä¾‹å­å°†æ˜¯å±•ç¤ºå‡½æ•°è£…é¥°è€…çš„æœ€å¥½æ–¹å¼ï¼Œæ‰€ä»¥**è¿™ç¯‡æ–‡ç« å°†ç¨å¾®è½»äºæ–‡å­—ï¼Œæ›´å¤šåœ°å…³æ³¨ä»£ç **ã€‚

# ä¸€ä¸ªå‡½æ•°è£…é¥°è€…çš„ Hello World

```
// basic decorator (supports 1 arity functions)
const decorator = f => a => f(a) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸ºäº†æ”¯æŒ n-arity å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‰©å±•æˆè¿™æ ·(ä»ç„¶ä»€ä¹ˆä¹Ÿä¸åš)ã€‚

```
// basic decorator (supports n-arity functions)
const decorator = f => (...args) => f(...args) 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºå¹¶ä½¿ç”¨ä¸€ä¸ª`helloWorld`è£…é¥°å™¨æ¥è£…é¥°`add`å‡½æ•°ã€‚

```
// our Hello World decorator
const helloWorld = f => (...args) => {
  console.log('Hello World')
  return f(...args)
}

// function to be decorate
const add = (a, b) => a + b

// decorate the function
const helloWorldAdd = helloWorld(add)

// run it
helloWorldAdd(3, 4)
//=> "Hello World"
//=> 7 
```

Enter fullscreen mode Exit fullscreen mode

ä½¿ç”¨è¿™ä¸ªåŸºç¡€è£…é¥°å™¨ä½œä¸ºæ‚¨æƒ³è¦åˆ›å»ºçš„ä»»ä½•å‡½æ•°è£…é¥°å™¨çš„æ¨¡æ¿ã€‚

# æ—¥å¿—åŠŸèƒ½è£…é¥°å™¨

è½»æ¾åœ°å°†æ‚¨çš„æ—¥å¿—é€»è¾‘åŒ…è£…åˆ°ç°æœ‰å‡½æ•°ä¸­ã€‚

```
// note: logged function name may change with minification
const logger = f => (...args) => {
  const value = f(...args)
  console.log(`${f.name||'Anonymous'}(${args}) = ${value}`)
  return value
}

const add = (a, b) => a + b

// we can make a new decorated function like so
const logAdd = logger(add)
logAdd(3, 4)
//=> "add(3, 4) = 7"
//=> 7 
```

Enter fullscreen mode Exit fullscreen mode

ä½œä¸š:ä½ å¦‚ä½•ä¿®æ”¹å®ƒæ¥æ”¯æŒå¼‚æ­¥åŠŸèƒ½ï¼Ÿè¦å¾—åˆ°æç¤ºï¼Œè¯·çœ‹ä¸‹é¢çš„å®šæ—¶å‡½æ•°è£…é¥°å™¨ã€‚

# å®šæ—¶å™¨åŠŸèƒ½è£…é¥°å™¨

åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½å¯ä»¥ä½¿ç”¨çš„åŸºæœ¬å®šæ—¶å™¨å‡½æ•°ã€‚

ç¬¬ 15 è¡Œæ£€æŸ¥å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªæ‰¿è¯ºï¼Œå¹¶å°†è¿”å›å€¼æ”¾å…¥ä¸€ä¸ª then ä¸­ï¼Œè€Œä¸æ˜¯è¿”å›å®ƒã€‚

```
// timed decorator
const timed = f => (...args) => {
  const start = Date.now()
  const value = f(...args)
  return value && typeof value.then === 'function'
    ? value.then(value =>
      ({ timespan: Date.now() - start, value }))
    : { timespan: Date.now() - start, value }
}

// synchronous function
const fastFunction = x => x * 2

// asynchronous function
const slowFunction = x => new Promise(resolve =>
  setTimeout(() => resolve(x * 2), 2000)
)

timed(fastFunction)(123)
//=> { timespan: 0, value: 246 }

timed(slowFunction)(456)
//=> Promise: { timespan: 2000, value: 912 } 
```

Enter fullscreen mode Exit fullscreen mode

# å‡½æ•°å‚æ•°ä¿æŠ¤è£…é¥°å™¨

é˜²æ­¢æ‰€æœ‰å‚æ•°ä¸ºç©ºæˆ–æœªå®šä¹‰ã€‚

```
// requireAll decorator
const requireAll = f => (...args) => {
  const valid = args.filter(arg => arg != null)
  if (valid.length < f.length) {
    throw new TypeError('Argument cannot be null or undefined.')
  }
  return f(...valid)
}

// decorated add function
const add = requireAll((a, b) => a + b)

add(3, 4)
//=> 7

add(3)
//=> TypeError: Argument cannot be null or undefined.

add(null, 4)
//=> TypeError: Argument cannot be null or undefined. 
```

Enter fullscreen mode Exit fullscreen mode

ä½œä¸š:å¦‚ä½•æ”¹è¿›è¿™ä¸ªè£…é¥°å™¨ï¼Ÿå¦‚ä½•æ·»åŠ å‚æ•°åï¼Ÿä½ å¦‚ä½•é˜²èŒƒä¸€äº›äº‰è®ºï¼Ÿ

# å¼‚å¸¸å¤„ç†

æ‚¨å¯ä»¥è¿”å›ä¸€ä¸ªåŒ…å«å€¼æˆ–é”™è¯¯çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å¼•å‘å¼‚å¸¸ã€‚è¿™ç±»ä¼¼äºä»»ä¸€å•å­å¦‚ä½•å¤„ç†å®ƒçš„å€¼ã€‚(ç°åœ¨ä¸ç”¨æ‹…å¿ƒå•å­)ã€‚

```
// function decorator to catch exceptions
const tryCatch = f => (...args) => {
  try {
    return { error: null, value: f(...args) }
  } catch(err) {
    return { error: err, value: null }
  }
}

const double = x => {
  if (!isNumeric(x)) {
    throw new TypeError('value must be numeric')
  }

  return x * 2
}

// new "safe" double function
const safeDouble = tryCatch(double);

safeDouble('abc')
//=> { error: [TypeError: value must be numeric], value: null }

safeDouble(4)
//=> { error: null, value: 8 } 
```

Enter fullscreen mode Exit fullscreen mode

**ä½œä¸š**:ç ”ç©¶å¹¶å­¦ä¼šä½¿ç”¨ä»»ä¸€å•å­ã€‚æ›´æ”¹æ­¤ä»£ç ä»¥è¿”å›ã€‚

# å– JSON å‡½æ•°è£…é¥°å™¨

å½“ä½¿ç”¨ fetch æ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„ä»£ç æ•£å¸ƒåœ¨ä½ çš„ä»£ç åº“ä¸­:

```
fetch(url)
  .then(response => response.json())
  .then(data => /* now we can use data! */) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸ºäº†å¾—åˆ°é‚£ä¸ª jsonï¼Œä½ å¿…é¡»é¦–å…ˆè°ƒç”¨`response.json()`ã€‚

```
// function decorator
const withJson = f => url =>
  f(url).then(response => response.json())

// decorated function
const fetchJson = withJson(fetch)

// now all your fetch calls are simplified
fetchJson(url)
  .then(data => /* we are ready to go! */) 
```

Enter fullscreen mode Exit fullscreen mode

# é€¢è¿

å¦‚æœä½ ç†Ÿæ‚‰åƒ Ramda çš„`curry`è¿™æ ·çš„ currying å‡½æ•°ï¼Œé‚£ä¹ˆä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰å‡½æ•°è£…é¥°å™¨äº†ã€‚

```
// basic curry function decorator
const curry = f => (...args) =>
  args.length >= f.length
    ? f(...args)
    : curry(f.bind(undefined, ...args))

const multiply = curry((a, b) => a * b)
const double = multiply(2)

double(3)
//=> 6

multiply(3, 3)
//=> 9

multiply(4)(4)
//=> 16 
```

Enter fullscreen mode Exit fullscreen mode

æ³¨:æˆ‘æ¨èç”¨æ›´æˆç†Ÿçš„[åº“é‡Œå‡½æ•°](http://ramdajs.com/docs/#curry)ï¼Œåƒ Ramda çš„é‚£ä¸ªã€‚å°½ç®¡è¿™ç§æ–¹æ³•å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†å®ƒåªæ˜¯ä½œä¸ºç¤ºä¾‹æä¾›çš„ã€‚

# Next.js æµè§ˆå™¨æ£€æŸ¥

åœ¨æˆ‘åˆ›å»ºçš„ä¸€ä¸ª Next.js é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸å¾—ä¸é™åˆ¶å‡ ä¸ªå‡½æ•°åªèƒ½åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œã€‚æˆ‘å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°è£…é¥°å™¨å¹²å‡€åˆ©è½åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚

```
const onlyBrowser = f => () =>
  process.browser && f()

class MyComponent extends Component {
  componentWillMount = onlyBrowser(() =>
    console.log('This is the browser!')
  })
} 
```

Enter fullscreen mode Exit fullscreen mode

# å¤šç§æ–¹å¼è£…ä¿®

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¿®é¥°å‡½æ•°ã€‚ä½ å¦‚ä½•å†³å®šä½¿ç”¨ decorators å°†å–å†³äºä½ çš„ç”¨ä¾‹ã€‚

```
// decorate the function
const add = decorator((a, b) => a + b)

// create a new decorated function
const add = (a, b) => a + b
const decoratedAdd = decorator(add)

// decorate just for the call
const add = (a, b) => a + b
decorator(add)(3, 4) 
```

Enter fullscreen mode Exit fullscreen mode

# ç»„åˆåŠŸèƒ½è£…é¥°å™¨

å› ä¸ºæ¯ä¸ªè£…é¥°å™¨ä¹Ÿè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°è£…é¥°å™¨å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»„åˆèµ·æ¥åˆ›å»ºä¸€ä¸ªå¤§å‹å‡½æ•°ã€‚

```
// returns true if is numeric
const isNumeric = n => !isNaN(parseFloat(n)) && isFinite(n)

// function decorator for only numeric args
const onlyNumeric = f => (...args) => {
  const valid = args.filter(isNumeric)
  if (valid.length < f.length) {
    throw new TypeError('Argument must be numeric.')
  }
  return f(...valid)
}

// function decorator to catch exceptions
const tryCatch = f => (...args) => {
  try {
    return { error: null, value: f(...args) }
  } catch(err) {
    return { error: err, value: null }
  }
}

// our double function
const double = x => x * 2

// decorated double function
const safeDouble = tryCatch(onlyNumeric(double));

safeDouble('abc')
//=> { error: [TypeError: value must be numeric], value: null }

safeDouble(4)
//=> { error: null, value: 8 } 
```

Enter fullscreen mode Exit fullscreen mode

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°ç»„åˆæ¥ç»„åˆè£…é¥°å™¨

```
// function composer
const compose = (f, g) => x => f(g(x))

// returns true if is numeric
const isNumeric = n => !isNaN(parseFloat(n)) && isFinite(n)

// function decorator for only numeric args
const onlyNumeric = f => (...args) => {
  const valid = args.filter(isNumeric)
  if (valid.length < f.length) {
    throw new TypeError('Argument must be numeric.')
  }
  return f(...valid)
}

// function decorator to catch exceptions
const tryCatch = f => (...args) => {
  try {
    return { error: null, value: f(...args) }
  } catch(err) {
    return { error: err, value: null }
  }
}

// compose two decorators into one decorator
const tryCatchOnlyNumeric = compose(tryCatch, onlyNumeric)

// decorated double function
const double = tryCatchOnlyNumeric(x => x * 2)

double('abc')
//=> { error: [TypeError: value must be numeric], value: null }

double(4)
//=> { error: null, value: 8 } 
```

Enter fullscreen mode Exit fullscreen mode

# åšå‡ºååº”

ååº”å’Œæ•´ä¸ªç”Ÿæ€ç³»ç»Ÿå……æ»¡äº†åŠŸèƒ½è£…é¥°ã€‚å¦‚æœä½ ç”¨è¿‡ Reactï¼Œå¾ˆæœ‰å¯èƒ½ä½ å·²ç»ç”¨è¿‡å‡½æ•°è£…é¥°å™¨äº†ã€‚`react-redux`çš„`connect`æ˜¯ä¸€ä¸ªå‡½æ•°è£…é¥°å™¨ã€‚`redux`çš„`bindActionCreators`æ˜¯ä¸€ä¸ªå‡½æ•°è£…é¥°è€…ã€‚

# ç»“æŸ

å‡½æ•°è£…é¥°å™¨æ˜¯ç”¨æ¥å¢å¼ºç°æœ‰å‡½æ•°çš„å¼ºå¤§å·¥å…·ã€‚å®ƒä»¬ä¸æ˜¯ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡å‡½æ•°è£…é¥°å™¨ï¼Œä½ å¾ˆå¯èƒ½ä¼šåœ¨ä¸ä¹…çš„å°†æ¥ä½¿ç”¨å®ƒä»¬ã€‚

å³ä½¿å®ƒä»¬å¦‚æ­¤å¼ºå¤§ä¸”æ˜“äºåˆ›å»ºï¼Œæˆ‘ä¹Ÿæ²¡æœ‰çœ‹åˆ°å¾ˆå¤šäººåœ¨ä»–ä»¬çš„ä»£ç ä¸­åˆ›å»ºå‡½æ•°è£…é¥°å™¨ã€‚è¿™å‘Šè¯‰æˆ‘ï¼Œå‡½æ•°è£…é¥°å™¨æ˜¯æœªè¢«å……åˆ†åˆ©ç”¨çš„å·¥å…·ï¼Œå€¼å¾—æ›´å¤šçš„æ¢ç´¢ã€‚

åˆ«å¿˜äº†åšè¿™ç¯‡æ–‡ç« é‡Œçš„ä½œä¸šï¼

æˆ‘å¾ˆæƒ³åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å¬åˆ°ä½ å¦‚ä½•ä½¿ç”¨å‡½æ•°è£…é¥°å™¨æ¥æ”¹è¿›ä½ çš„ä»£ç åº“ï¼ğŸ˜ƒ

å¹²æ¯ï¼

# è·Ÿç€æˆ‘

Twitter:[https://twitter.com/joelnet](https://twitter.com/joelnet)
LinkedIn:[https://www.linkedin.com/in/joel-thoms/](https://www.linkedin.com/in/joel-thoms/)T5ã€‘Medium:[https://medium.com/@joelthoms/latest](https://medium.com/@joelthoms/latest)T8ã€‘dev . to:[https://dev.to/joelnet](https://dev.to/joelnet)T11ã€‘Github:[https://github.com/joelnet](https://github.com/joelnet)