# 用 Sitecore 设置建议玩流言终结者

> 原文:[https://dev . to/jermdavis/playing-myth busters-with-sitecore-setup-suggestions-1d g6](https://dev.to/jermdavis/playing-mythbusters-with-sitecore-setup-suggestions-1dg6)

[![](../Images/c146ed59eb2e5d89d1116fa08e37b822.png)](https://jermdavis.files.wordpress.com/2018/05/mythbuster-group.jpg) 最近，我的一位同事告诉我，他们得到了一个关于建立 Sitecore 实例的建议。他们被告知您应该将许可文件放在数据目录的子文件夹中，因为许可检查会枚举包含该文件的目录中的文件和文件夹。所以如果文件夹里有其他东西，这将会减慢检查的速度。这对我来说听起来很奇怪，因为你必须在你的配置中指定许可证的确切路径，所以我想我应该做一些调查，看看我是否能证明或否定这个建议。

所以，戴上我最好的贝雷帽去参加一个欢快的“为了科学！”安格尔，这是我的发现:

## 如何测试这样一个理论？

我的计划是，我需要记录数据文件夹设置方式的一些变化的启动和请求时间。在考虑了它们可能是什么之后，我提出了三种需要测试的变体:

*   数据文件夹是站点的网站文件夹的同级文件夹，还是其子文件夹。
*   数据目录中是否有大量文件和文件夹。
*   许可文件是在数据文件夹中，还是在它的子文件夹中。

为了证实这个理论，如果有很多文件，并且许可证和它们在同一个文件夹中，那么时间会明显变慢。如果额外的文件丢失，或者许可证在子文件夹中，它应该以“正常”速度运行。而且，我的直觉告诉我，许可证在`/data/`还是`/website/data`应该没什么区别。

所以有两种状态的三个变量给了我们八个可能的测试来运行。手动设置和运行它们有点麻烦，所以需要一些脚本来实现自动化。我花了一点时间编写了一些快速而肮脏的 PowerShell 来在我碰巧拿到的 Sitecore v8.2 实例上设置这些状态。

测试事件的计时通常受益于多次执行事件并对结果取平均值，所以我设置脚本依次处理每个场景，并计算出“第一次请求”时间的平均值和“后续请求”时间的平均值。我选择让它在“数据文件夹中的垃圾”和“整洁的数据文件夹”之间交替，即使这将使测试总体上变慢——但我的直觉告诉我，如果这样工作，我应该会在数据中看到更明显的模式。

最后，我让脚本将时间和平均值写入一个 CSV 文件，这样就可以很容易地在 Excel 中制作图表。

如果你想的话，可以下载这个非常粗糙的脚本的源代码。请注意，我没有试图使路径和实例名可配置，或者使代码漂亮——这只是为了运行我的测试，而不是为了在您的机器上工作。

## [](#so-what-results-do-i-get)那么我得到什么结果呢？

设置要使用的脚本

*   创建 1500 个随机文件和 1500 个随机文件夹，以形成“最坏情况”数据文件夹。
*   每个测试结果平均 25 个请求

我运行了脚本两次，并将结果整合到一个图表中:

[![](../Images/c850d0e8053419dab705a215b6701c99.png)T2】](https://jermdavis.files.wordpress.com/2018/05/timingaveragesgraph2.png)

(启动时间在左边的轴上，请求时间在右边的轴上——尽管绝对时间可能没有那么大的意义，只是它们之间的差异)

很快，这些数据似乎并不支持最初的断言。

偶数编号的测试(标有红色箭头)是将垃圾数据添加到数据文件夹中的测试。但与其他测试相比，它们似乎没有显示出可预测的时间增长。大多数情况下，这些行相当稳定，有无垃圾数据的请求大致相似。这表明各种测试设置对网站启动或请求的速度没有任何明显的影响。

测试#6 的启动时间请求的第二次运行的计时中有一个明显的故障——但是考虑到这是所有结果中的一个奇怪的结果，我的直觉是这可能只是在我的机器的后台发生的一些事情扰乱了计时。(我确实尝试过稍后重新运行测试——我经常得到至少一个错误的结果——但是我从来没有看到一个可预测的“偶数编号的测试都需要更长时间”的结果)

如果你觉得有必要检查的话，可以下载的[原始数据。](https://jermdavis.files.wordpress.com/2018/05/testdata.xlsx)

## [](#confirming-things)确认事物

因此，根据这些结果，我很有信心，你的数据文件夹的内容不会对许可证检查时间产生任何真正的影响。但是为了确保万无一失，我试图弄清楚 Sitecore 代码在检查许可证时发生了什么。这并不容易——许可是“网站核心”的一部分。Nexus”库，这是混淆。因此解读它的逻辑是相当棘手的。

但是我在这里看到了一些东西，让我确信它没有做任何枚举。首先，代码直接引用许可证文件配置设置，并检查特定文件是否存在:

[![](../Images/a5c302c91af4abc55a93dcf882f81494.png)T2】](https://jermdavis.files.wordpress.com/2018/05/licensefilecheck.png)

第二，如果我遵循调用树，许可证文件属性的值会传递给一个`XmlDocument`的 load 调用:

[![](../Images/e11d500fe1e83b71c0162259212258c9.png)T2】](https://jermdavis.files.wordpress.com/2018/05/licensefilecheck2.png)

因此，您在 config 中描述的特定文件似乎已经过验证和加载。

最后一点是，我看不到任何看起来像是在枚举一组文件的构造。虽然这种混淆使生活变得艰难，但没有什么比“针对文件夹中的每个文件”类型的调用更突出的了。

## [](#in-conclusion)总之…

[![](../Images/8d47705ecbc7cd49d298b554a400b413.png)T2】](https://jermdavis.files.wordpress.com/2018/05/15130616.jpg)

我称之为“终结”。在我看来，你可以把你的执照放在你想放的地方——处理时间似乎不会受到有意义的影响。