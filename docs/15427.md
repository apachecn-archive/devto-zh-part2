# Prisma â€”æ·±æ½œ

> åŸæ–‡:[https://dev.to/divyenduz/prisma-æ·±æ½œ-384o](https://dev.to/divyenduz/prisma--deep-dive-384o)

#### [](#cloud-native%E2%80%8A%E2%80%8Agraphql%E2%80%8A%E2%80%8Adatabase-api%C2%A0layer)äº‘åŸç”Ÿâ€” GraphQL â€”æ•°æ®åº“ API å±‚

<figure>[![](../Images/af7e677fa6b8388677d4f7c82f399ab1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--udWQUjy7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AoK0VF4K-Z1JsxsKytP54nA.png) 

<figcaption>ä¸€ä¸ªæœªæ¥ä¸»ä¹‰çš„äº‘åŸç”Ÿâ€” GraphQL æ•°æ®åº“ API å±‚</figcaption>

</figure>

é™„:è¿™ç¯‡æ–‡ç« æ—¨åœ¨æ·±å…¥æ¢ç©¶ [Prisma](https://www.prismagraphql.com/) ã€‚å¦‚æœæ‚¨è®¤ä¸ºæœ‰ä»»ä½•éƒ¨åˆ†ç¼ºå¤±æˆ–ä¸æ¸…æ¥šæˆ–å¯ä»¥ä»¥ä»»ä½•æ–¹å¼æ”¹è¿›ã€‚é€šè¿‡è¯„è®ºæˆ–[æ¨ç‰¹è”ç³»æˆ‘](https://twitter.com/divyenduz)ã€‚

### [](#table-of%C2%A0contents)ç›®å½•

1.  ä»‹ç»
2.  è®¾ç½®
3.  Prisma init å‘½ä»¤æ•…éšœ
4.  ç›®å½•ç»“æ„
5.  è¿è¡Œåº”ç”¨æœåŠ¡å™¨
6.  è®¿é—®æ•°æ®åº“
7.  æ•™ä¸€ä¸ªäººå¦‚ä½•é’“é±¼
8.  è®¸å¯
9.  é«˜çº§æŸ¥è¯¢
10.  é«˜çº§çªå˜
11.  ææ¬¾
12.  å¯¼å‡º/å¯¼å…¥æ•°æ®
13.  ç›‘è§†
14.  å…ˆè¿›çš„ Prisma å’Œ GraphQL çš„ä¸œè¥¿
15.  é€®åˆ°ä½ äº†
16.  æ’å¤´
17.  è¿›ä¸€æ­¥é˜…è¯»

### [](#introduction)ç®€ä»‹

è¿™ç¯‡æ–‡ç« è°ˆåˆ°äº†æˆ‘é‡åˆ°çš„æœ€æœ‰è¶£çš„ GraphQL å·¥å…·ä¹‹ä¸€ã€‚

#### [](#what-is%C2%A0prisma)**ä»€ä¹ˆæ˜¯æ£±é•œï¼Ÿ**

[Prisma](https://blog.graph.cool/introducing-prisma-1ff423fd629e) æ˜¯ä¸€ä¸ªå·¥å…·( [read äº§å“ï¼Œç»è¿‡å¤§é‡çš„ç”Ÿäº§ç»éªŒ](https://blog.graph.cool/graphql-databases-a-preview-into-the-future-of-graphcool-c1d4981383d9)åå‘å±•è€Œæ¥)ï¼Œå®ƒå°†ä½ çš„æ•°æ®åº“è½¬æ¢æˆä¸€ä¸ªéå¸¸å¼ºå¤§çš„ GraphQL APIã€‚

å¯ä»¥æŠŠ Prisma çœ‹ä½œæ˜¯ä¸€ä¸ªâ€œäº‘åŸç”Ÿçš„â€ã€â€œGraphQL ä¼˜å…ˆçš„â€æ•°æ®åº“ï¼Œä½†æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œå®ƒä¸ä»…ä»…æ˜¯è¿™æ ·ã€‚

Prisma å¤„äºä¸€ä¸ªéå¸¸å¼ºå¤§çš„ GraphQL ç”Ÿæ€ç³»ç»Ÿçš„å‰æ²¿ã€‚

#### **Prisma åœ¨æˆ‘çš„è®¾ç½®ä¸­å¤„äºä»€ä¹ˆä½ç½®ï¼Ÿ**

<figure>[![](../Images/9135e2d9df14136083513e3d9b664622.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--bq2AMAi6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2A3cqtoZ02tki_CYffhA2snQ.jpeg)

<figcaption>ã€Prisma(èƒ½)åšä»€ä¹ˆï¼Ÿ</figcaption>

</figure>

æ‚¨å¯èƒ½å¤„äºä»¥ä¸‹æƒ…å†µ:-

**ä½ æ­£ä»é›¶å¼€å§‹**

Prisma å¯ä»¥ç”¨æ¥è‡ªåŠ¨æ„å»ºè¡¨æ ¼ï¼Œå¹¶åœ¨å…¶ä¸Šæ„å»ºä¸€ä¸ªå¼ºå¤§çš„ GraphQL API(è¿™æ˜¯æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®¨è®ºçš„)ã€‚ç„¶åä½ å°±å¯ä»¥[å°†ä½ çš„æ•°æ®å¯¼å…¥ Prisma](https://www.prismagraphql.com/docs/reference/data-import-and-export/data-import-ol2eoh8xie) ä¸­ï¼Œå°½æƒ…äº«å—å§ã€‚

Prisma å·²ç»å¯ä»¥é€šè¿‡ MySQL éå¸¸æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œå…¶ä»–(MongoDBã€ElasticSearchã€Postgres ç­‰)ä¹Ÿå³å°†æ¨å‡ºã€‚

**æ‚¨æœ‰ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“ï¼Œä½†æ˜¯æ‚¨æƒ³é€šè¿‡ GraphQL API å…¬å¼€å®ƒ**

æ‚¨ä¹Ÿå¯ä»¥åœ¨åº”ç”¨æœåŠ¡å™¨çº§åˆ«å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œæˆ–è€… Prisma å¯ä»¥åœ¨ç°æœ‰æ•°æ®åº“çš„åŸºç¡€ä¸Šå……å½“ä¸€ä¸ªç˜¦çš„ GraphQL åŒ…è£…å™¨ã€‚

**æ‚¨ä¾èµ–ç¬¬ä¸‰æ–¹ GraphQL å’Œ REST APIs è·å–ä¿¡æ¯**

åœ¨åº”ç”¨æœåŠ¡å™¨çº§åˆ«ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ REST API ä½œä¸ºæ•°æ®æºã€‚è¿™ä¸ªç¤¾åŒºæ­£åœ¨ç§¯æåœ°å¼€å‘å·¥å…·æ¥è®©è¿™ç§ä½“éªŒå˜å¾—æ›´å¥½ã€‚

**ä»¥ä¸Š 3 ç§çš„ä»»æ„ç»„åˆã€‚**

Prisma ä¸å±€é™äºä¸€ç§è®¾ç½®ï¼Œå®ƒå¯ä»¥åœ¨åº”ç”¨å±‚æœ‰æ•ˆåœ°ç»„åˆä¸Šè¿°çš„ä»»ä½•æ’åˆ—å’Œç»„åˆã€‚

æœ€é‡è¦çš„æ˜¯ï¼ŒPrisma æ˜¯è¯­è¨€ä¸å¯çŸ¥çš„ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç”¨ç›¸åº”çš„è¯­è¨€æå‡ºâ€œGraphQL ç»‘å®šâ€ã€‚"ä»€ä¹ˆæ˜¯ GraphQL ç»‘å®šï¼Ÿ"æ˜¯ä¸€ä¸ªåœ¨[è¿™ä¸ª](https://blog.graph.cool/reusing-composing-graphql-apis-with-graphql-bindings-80a4aa37cff5)å¸–å­é‡Œå›ç­”çš„å¾ˆå¥½çš„é—®é¢˜ã€‚

### [](#setup)è®¾ç½®

è®©æˆ‘ä»¬å…ˆä»å®‰è£…å¼€å§‹ã€‚

```
npm install -g prisma 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªå…¨å±€å®‰è£…çš„ prisma å‘½ä»¤(ä¹Ÿå¯ä»¥é€šè¿‡ npm ä»¥é™å®šèŒƒå›´çš„æ–¹å¼å®‰è£…)ã€‚å¯ä» prisma help æˆ– prisma help <command></command>è·å¾—å¸®åŠ©ã€‚

æ‚¨è¿˜éœ€è¦å®‰è£… [docker](https://docs.docker.com/install/) ã€ [docker-compose](https://docs.docker.com/compose/install/) å’Œ [node](https://github.com/creationix/nvm) æ¥ä½¿è®¾ç½®å·¥ä½œã€‚

### [](#prisma-init-command-breakdown)Prisma init å‘½ä»¤æ•…éšœ

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ prisma init å‘½ä»¤å¼€å§‹äº†ã€‚è¿è¡Œå‘½ä»¤ï¼Œå»å»å»â€¦ä½ åšäº†å—ï¼Ÿè®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹å®ƒæä¾›çš„é€‰é¡¹:

```
divyendusingh [prisma-examples]$ prisma init

? How to set up a new Prisma service? (Use arrow keys)

â¯ Minimal setup: database-only
  GraphQL server/fullstack boilerplate (recommended) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬é‡‡ç”¨è¿™ä¸€æ­¥ä¸­æ¨èçš„é€‰é¡¹ã€‚

```
Running $ graphql create ...
? Directory for new GraphQL project (.) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒæ­£åœ¨è¿è¡Œä¸€ä¸ªåä¸º graphql çš„ CLI å‘½ä»¤â€”â€”ç­‰ç­‰ä»€ä¹ˆï¼Ÿâ€”è®°ä½ä½ çš„è®­ç»ƒ(è¯»ä½œ [GraphQL ç”Ÿæ€ç³»ç»Ÿ](https://www.prismagraphql.com/docs/graphql-ecosystem/) â€” [GraphQL CLI](https://www.prismagraphql.com/docs/graphql-ecosystem/graphql-cli/overview-quaidah9pj) )å£«å…µã€‚

ç›´æ¥æ¥è‡ªæ–‡ä»¶:ğŸ“Ÿ [graphql-cli](https://github.com/graphql-cli/graphql-cli) æ˜¯é€šç”¨ graphql å¼€å‘å·¥ä½œæµçš„å‘½ä»¤è¡Œå·¥å…·ã€‚

çŸ¥é“è¿™ä¸€ç‚¹å¾ˆæœ‰å¸®åŠ©ï¼Œprisma åœ¨å¾ˆå¤šæ“ä½œä¸­éƒ½ä½¿ç”¨åº•å±‚çš„ graphql å‘½ä»¤ã€‚

æˆ‘ä»¬å¯ä»¥æŒ‡å®šç›®å½•å¹¶ç»§ç»­å‰è¿›ï¼Œæ³¨æ„å¦‚æœæ‚¨é€‰æ‹©å½“å‰ç›®å½•(é€šè¿‡ã€‚)ï¼Œè‚¯å®šæ˜¯ç©ºçš„ã€‚

å®ƒé—®ä½ çš„ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯é€‰æ‹©ä¸€ä¸ª[æ ·æ¿](https://blog.graph.cool/graphql-boilerplates-graphql-create-how-to-setup-a-graphql-project-6428be2f3a5) :

```
? Choose GraphQL boilerplate project:
  node-basic Basic GraphQL server (incl. database)
â¯ node-advanced GraphQL server (incl. database & authentication)
  typescript-basic Basic GraphQL server (incl. database)
  typescript-advanced GraphQL server (incl. database & authentication)
  react-fullstack-basic React app + GraphQL server (incl. database ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ä½¿ç”¨èŠ‚ç‚¹é«˜çº§ã€‚å°½ç®¡ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²ï¼Œä½†æ¦‚å¿µä¸ä¼šæœ‰å¤ªå¤§å˜åŒ–ã€‚

æˆ‘ä»¬ä¼šæ³¨æ„åˆ°å®ƒä»ä¸€ä¸ªç‰¹å®šçš„åº“ä¸­è·å–æ ·æ¿æ–‡ä»¶ã€‚

```
? Choose GraphQL boilerplate project: node-advanced GraphQL server (incl. database & authentication)
[graphql create] Downloading boilerplate from https://github.com/graphql-boilerplates/node-graphql-server/archive/master.zip... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±å¼•å‡ºäº†ä¸‹ä¸€ä¸ªé—®é¢˜ã€‚ä½ èƒ½åˆ›å»ºè‡ªå·±çš„æ ·æ¿æ–‡ä»¶å—ï¼Ÿ **ç»å¯¹ï¼ï¼â€”** [ping me](https://twitter.com/divyenduz) æˆ–[å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥æ¢ç´¢è¿™ä¸€ç‚¹ï¼Œè¯·åŠ å…¥ç¤¾åŒº](http://graphcool.slack.com)ã€‚

è¿›å…¥ä¸‹ä¸€ä¸ªé—®é¢˜:

```
? Please choose the cluster you want to deploy "deep-dive@dev" to (Use arrow keys)

â¯ prisma-eu1 Public development cluster (hosted in EU on Prisma Cloud)
  prisma-us1 Public development cluster (hosted in US on Prisma Cloud)
  local Local cluster (requires Docker)

Log in or create new account on Prisma Cloud

Note: When not logged in, service deployments to Prisma Cloud expire after 7 days.
  You can learn more about deployment in the docs: http://bit.ly/prisma-graphql-deployment 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

CLI ä¼šæç¤ºæ‚¨é€‰æ‹©è¦éƒ¨ç½² Prisma æœåŠ¡çš„ç¾¤é›†ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ‰ä¸¤ä¸ªå…¬å…±é›†ç¾¤ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ¬åœ°é›†ç¾¤(åŸºäº docker)æ¥å®Œæˆè¿™ç¯‡æ–‡ç« ã€‚åŒæ ·ï¼Œä½ å¯ä»¥éšæ„é€‰æ‹©â€”â€”æ¦‚å¿µä¸ä¼šæ”¹å˜å¤ªå¤šã€‚

å•Šå“ˆï¼é€‰æ‹©ä¸€ä¸ªé›†ç¾¤ä¼šè¿è¡Œæ›´å¤šçš„å‘½ä»¤ï¼Œä¸‹é¢æ˜¯ CLI æ‰“å°çš„è¾“å‡º:

```
? Please choose the cluster you want to deploy "deep-dive@dev" to
Added cluster: local to prisma.yml
Creating stage dev for service deep-dive âœ”
Deploying service `deep-dive` to stage `dev` on cluster `local` 1.7s

Changes:
... (many changes, not listed for brevity)

Applying changes 3.8s

Hooks:
Importing seed dataset from `seed.graphql` 733ms

Your GraphQL database endpoint is live:

HTTP: http://localhost:4466/deep-dive/dev
WS: ws://localhost:4466/deep-dive/dev

Checking, if schema file changed 366ms
Writing database schema to `src/generated/prisma.graphql` 1ms
Running $ graphql prepare...

Next steps:
  1\. Change directory: `cd deep-dive`
  2\. Start local server and open Playground: `yarn dev` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹åœ°æ¢ç´¢è¿™ä¸ªè¾“å‡ºã€‚

```
Deploying service `deep-dive` to stage `dev` on cluster `local` 1.7s 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨å†…éƒ¨ï¼Œè¿™æ˜¯è¿è¡Œ prisma deploy å‘½ä»¤(æˆ‘ä»¬å°†ç»å¸¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤)ã€‚æˆ‘ä»¬åœ¨è¿™è¡Œè¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°çš„ä¸‰ä¸ªå…³é”®è¯æ˜¯**æœåŠ¡**ã€**é˜¶æ®µ**ã€**é›†ç¾¤**ã€‚

*   **æœåŠ¡** â€”ä¸€ä¸ªå°†è¯·æ±‚æ˜ å°„åˆ°åº•å±‚æ•°æ®åº“çš„ GraphQL ç«¯ç‚¹ã€‚
*   **é˜¶æ®µ** â€”ä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªé˜¶æ®µ(æ¯”å¦‚å¼€å‘ã€ç”Ÿäº§ç­‰)ã€‚
*   **é›†ç¾¤** â€”å¯ä»¥å°† service@stage éƒ¨ç½²åˆ°[é›†ç¾¤](https://www.prismagraphql.com/docs/reference/clusters/overview-eu2ood0she)ã€‚æ­£å¦‚æœ¬æ–‡æåˆ°çš„â€œæœ¬åœ° docker â€,æœ‰ä¸¤ä¸ªå…±äº«é›†ç¾¤å¯ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„é›†ç¾¤(æ¯”å¦‚åœ¨[æ•°å­—æµ·æ´‹](https://m.do.co/c/efabde48fb30)ä¸Š)å¹¶ä½¿ç”¨ prisma cluster add å‘½ä»¤å°†å…¶æ·»åŠ åˆ° prisma ä¸­ã€‚ [Ping me](https://twitter.com/divyenduz) æˆ–[åŠ å…¥ç¤¾åŒº](http://graphcool.slack.com)å¦‚æœä½ æƒ³è¿›ä¸€æ­¥æ¢ç´¢è¿™ä¸€ç‚¹ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½å¯ä»¥åœ¨ [prisma.yml](https://www.prismagraphql.com/docs/reference/service-configuration/prisma.yml/overview-and-example-foatho8aip) æ–‡ä»¶ä¸­è®¾ç½®/æ›´æ”¹ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼Œé€šè¿‡è¿™é‡Œä½¿ç”¨çš„æ ·æ¿ã€‚

```
Changes:
... (many changes, not listed for brevity)

Applying changes 3.8s 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

prisma deploy å‘½ä»¤è¿˜è·å–å·²éƒ¨ç½²æœåŠ¡çš„å·®å¼‚(åœ¨æœ¬ä¾‹ä¸­æ²¡æœ‰å·®å¼‚ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²æœåŠ¡)å¹¶åº”ç”¨ç›¸å…³çš„æ›´æ”¹ã€‚

```
Hooks:
Importing seed dataset from `seed.graphql` 733ms

Your GraphQL database endpoint is live:

HTTP: http://localhost:4466/deep-dive/dev
WS: ws://localhost:4466/deep-dive/dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³è®©ä¸€ä¸ªæœåŠ¡æ‹¥æœ‰ä¸€äº›åˆå§‹æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ [prisma.yml](https://www.prismagraphql.com/docs/reference/service-configuration/prisma.yml/overview-and-example-foatho8aip) æ–‡ä»¶ä¸­çš„ç§å­é€‰é¡¹ã€‚

å¦‚è¾“å‡ºæ‰€ç¤ºï¼ŒPrisma ç«¯ç‚¹æ˜¯æ´»åŠ¨çš„ï¼Œå¹¶ä¸”æ‚¨æœ‰å†…ç½®çš„ web å¥—æ¥å­—(GraphQL è®¢é˜…æ”¯æŒï¼Œå“‡ï¼å“‡ï¼).

```
Checking, if schema file changed 366ms
Writing database schema to `src/generated/prisma.graphql` 1ms
Running $ graphql prepare... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å•Šå“ˆï¼æ¥ä¸‹æ¥æ˜¯ç”Ÿæˆçš„ prisma.graphql æ–‡ä»¶ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ prisma åŸºäºæ‚¨çš„ datamodel.graphql æ–‡ä»¶ä¸ºæ‚¨æä¾›çš„å®Œæ•´çš„ GraphQL APIã€‚å®ƒä¸º datamodel.graphql æ–‡ä»¶ä¸­çš„ç±»å‹å®šä¹‰äº† CRUD æ“ä½œã€‚

åŒæ ·ï¼ŒPrisma ä½¿ç”¨çš„æ˜¯åº•å±‚çš„ graphql å‡†å¤‡å‘½ä»¤ï¼Œåœ¨ GraphQL CLI æ–‡æ¡£ä¸­æè¿°å¦‚ä¸‹:â€”

```
graphql prepare Bundle schemas and generate bindings 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç¨åæˆ‘ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸€ç‚¹â€”â€”è¿™éå¸¸é‡è¦ã€‚

æœ€åï¼Œè¾“å‡ºå»ºè®®æ‚¨ä½¿ç”¨ cd è¿›å…¥ç›®å½• cd deep-diveã€‚è®©æˆ‘ä»¬è¿™æ ·åšï¼Œå¹¶åœ¨è¿è¡Œ yarn dev å‘½ä»¤ä¹‹å‰æ¢ç´¢ç›®å½•ç»“æ„ã€‚

### [](#directory-structure)ç›®å½•ç»“æ„

```
divyendusingh [deep-dive]$ tree -I node_modules
.
â”œâ”€â”€ README.md
â”œâ”€â”€ database
â”‚ â”œâ”€â”€ datamodel.graphql
â”‚ â”œâ”€â”€ prisma.yml
â”‚ â””â”€â”€ seed.graphql
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚ â”œâ”€â”€ generated
â”‚ â”‚ â””â”€â”€ prisma.graphql
â”‚ â”œâ”€â”€ index.js
â”‚ â”œâ”€â”€ resolvers
â”‚ â”‚ â”œâ”€â”€ AuthPayload.js
â”‚ â”‚ â”œâ”€â”€ Mutation
â”‚ â”‚ â”‚ â”œâ”€â”€ auth.js
â”‚ â”‚ â”‚ â””â”€â”€ post.js
â”‚ â”‚ â”œâ”€â”€ Query.js
â”‚ â”‚ â””â”€â”€ index.js
â”‚ â”œâ”€â”€ schema.graphql
â”‚ â””â”€â”€ utils.js
â””â”€â”€ yarn.lock

5 directories, 15 files 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ¢ç´¢æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·çš„ã€‚

**æ•°æ®åº“**æ–‡ä»¶å¤¹:

*   prisma . ymlâ€”â€”è¿™æ˜¯æˆ‘ä»¬å®šä¹‰æœåŠ¡ã€é˜¶æ®µã€é›†ç¾¤å’Œå…¶ä»–é€‰é¡¹çš„åœ°æ–¹ã€‚
*   datamodel.graphql â€”åœ¨æ­¤å®šä¹‰æ‰€éœ€çš„ graphql ç±»å‹ï¼Œå¹¶åœ¨ prisma.yml æ–‡ä»¶ä¸­å¼•ç”¨è¯¥æ–‡ä»¶ã€‚
*   seed.graphql â€”å¦‚ä¸Šæ‰€è¿°ï¼Œç”¨ä¸€äº›æ•°æ®åˆå§‹åŒ–æ‚¨çš„æœåŠ¡ï¼Œè¿™æ˜¯è¦è®¾ç½®çš„æ–‡ä»¶ï¼Œåœ¨ prisma.yml æ–‡ä»¶ä¸­å¼•ç”¨ã€‚

**src** æ–‡ä»¶å¤¹:

*   index . jsâ€”â€”è¿™æ˜¯æˆ‘ä»¬è®¾ç½®åº”ç”¨æœåŠ¡å™¨çš„åœ°æ–¹(åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ç”¨ [graphql-yoga](https://github.com/graphcool/graphql-yoga) ä½†æ˜¯é€šå¸¸æ˜¯çµæ´»çš„),å®ƒå°†ä½äº prisma æœåŠ¡çš„å‰é¢ã€‚è®¾ç½®åŒ…æ‹¬å°† graphql-yoga ä¸ prisma é“¾æ¥ï¼Œå¹¶ä¸” resolver æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨è¿™é‡Œä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹ã€‚
*   schema.graphql â€”è¿™æ˜¯åº”ç”¨æœåŠ¡å™¨çš„ GraphQL APIã€‚è¿™ä¹Ÿç§°ä¸ºåº”ç”¨ç¨‹åºæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œprisma æ ¹æ®æ‚¨çš„ datamodel.graphql ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ‰©å±•çš„ APIï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€‰æ‹©é€šè¿‡ä½¿ç”¨è¯¥æ–‡ä»¶ä»¥ä»»ä½•æ‚¨æƒ³è¦çš„å½¢å¼å…¬å¼€å®ƒçš„å­é›†/ç»„åˆã€‚è¿™ä½¿å¾—æ•´ä¸ªè®¾ç½®éå¸¸çµæ´»ã€‚
*   è§£æå™¨ index.js æ–‡ä»¶ä½¿ç”¨çš„æŸ¥è¯¢å’Œå˜å¼‚çš„è§£æå™¨çš„å®šä¹‰ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆâ€œAuthPayloadâ€åœ¨é¡¶çº§ï¼Ÿå¾ˆé«˜å…´ä½ é—®äº†ã€‚[ä¸‹é¢æ˜¯åŸå› ï¼](https://blog.graph.cool/graphql-server-basics-demystifying-the-info-argument-in-graphql-resolvers-6f26249f613a)

### [](#run-the-application-server)è¿è¡Œåº”ç”¨æœåŠ¡å™¨

ç°åœ¨ï¼Œåœ¨ç®€å•æŸ¥çœ‹äº†ç›®å½•ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ yarn dev å‘½ä»¤æ¥è¿è¡Œåº”ç”¨æœåŠ¡å™¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å¯ç”¨çš„ç«¯ç‚¹ã€‚

[http://localhost:4000](http://localhost:4000) â€”æˆ‘ä»¬åˆšåˆšæ¢ç´¢è¿‡çš„å¸¦æœ‰è‡ªå®šä¹‰æ¨¡å¼çš„åº”ç”¨æœåŠ¡å™¨ã€‚è¿™æ˜¯é’ˆå¯¹ schema.graphql å®šä¹‰çš„ GraphQL API çš„ã€‚

[http://localhost:4466/deep-dive/dev](http://localhost:4466/deep-dive/dev)â€”å…·æœ‰ç”Ÿæˆçš„ GraphQL æ¨¡å¼çš„ prisma æœåŠ¡ï¼Œè¿™æ˜¯ç”±åˆå§‹ Prisma éƒ¨ç½²è®¾ç½®çš„ã€‚è¿™æ˜¯é’ˆå¯¹ prisma.graphql(ä¹Ÿç§°ä¸º prisma æ•°æ®åº“æ¨¡å¼)æ–‡ä»¶ä¸­æ•°æ®åº“æ¨¡å¼å®šä¹‰çš„ GraphQL APIã€‚

å¦‚æœåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™äº›é“¾æ¥ï¼ŒGraphQL Playground åº”è¯¥å¯ç”¨ã€‚

application server ä¸­çš„è§£æå™¨é€šè¿‡ä½¿ç”¨ç»‘å®šæ¥ä½¿ç”¨åº•å±‚ prisma æœåŠ¡ã€‚

[é‡ç”¨&ç”¨ GraphQL ç»‘å®šç»„æˆ GraphQL APIsã€‘](https://blog.graph.cool/reusing-composing-graphql-apis-with-graphql-bindings-80a4aa37cff5)

### [](#teach-a-man-how-to%C2%A0fish)æˆäººä»¥é±¼

<figure>[![](../Images/a684c53d815048f9dccf77af73ba291b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--wywkGygM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2Ay_FrAGK1g-nYf3lCpmHM4Q.jpeg) 

<figcaption>æ•™äººå¦‚ä½•é’“é±¼â€”â€”ç…§ç‰‡ç”±[çº³æ’’å°¼å°”Â·èˆ’æ›¼](https://unsplash.com/photos/ahKO5IOXFDM?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)ä¸Šä¼  [Unsplash](https://unsplash.com/search/photos/fish?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)</figcaption>

</figure>

è®©æˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚ä¸­è®¨è®ºæ›´å¤šå…³äºç”Ÿæˆçš„ prisma.graphql æ–‡ä»¶(ä¹Ÿç§°ä¸º prisma æ•°æ®åº“æ¨¡å¼)ã€‚

è¯¥æ–‡ä»¶åŒ…å« prisma é’ˆå¯¹ datamodel.graphql æ–‡ä»¶çš„å½“å‰çŠ¶æ€æä¾›çš„å®Œæ•´ APIã€‚ç»™å®šè¿™äº›ä¿¡æ¯å’Œ GraphQL æ¨¡å¼çš„æ€§è´¨ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œå¼€å§‹æ¢ç´¢æ–‡æ¡£åŒ–å’Œæœªæ–‡æ¡£åŒ–ç‰¹æ€§çš„æ½œåœ¨ç”¨é€”ã€‚æˆ‘æ˜¯[â€œä»£ç å³æ–‡æ¡£â€](https://martinfowler.com/bliki/CodeAsDocumentation.html)çš„åšå®šä¿¡ä»°è€…ï¼Œè¿™æ˜¯æˆ‘åœ¨ Prisma å¤„äºæµ‹è¯•é˜¶æ®µå¹¶ä¸”æ–‡æ¡£ä¸æ˜¯æœ€æ–°çš„æ—¶å€™ä½¿ç”¨çš„(å®ƒç°åœ¨çŠ¶æ€å¾ˆå¥½)ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢éƒ¨ç½²çš„æœåŠ¡ï¼Œæ‚¨å¯ä»¥è®¿é—® prisma.graphql å¹¶æœç´¢ç±»å‹æŸ¥è¯¢ã€ç±»å‹å˜å¼‚ã€ç±»å‹è®¢é˜…ï¼Œä»¥æ¢ç´¢è¯¥ API çš„å…¨éƒ¨å…¬å¼€æ½œåŠ›(è¯·æ³¨æ„ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨ [GraphQL Playground](https://github.com/graphcool/graphql-playground) ï¼Œè®°ä½[ç”Ÿæ€ç³»ç»Ÿ](https://www.prismagraphql.com/docs/graphql-ecosystem/) soldierã€‘ä¸­è·å¾—)ï¼Œå¹¶ä»é‚£é‡Œæ·±å…¥ç ”ç©¶å„ç§è¾“å…¥ç±»å‹ã€‚è¿™æ ·åšä¼šè®©æ‚¨å¯¹ API å’Œæœªè®°å½•çš„ç‰¹æ€§æœ‰ä¸€ä¸ªåšå®çš„ç†è§£ã€‚

### [](#access-the%C2%A0database)è®¿é—®æ•°æ®åº“

æˆ‘çš„æ•°æ®åœ¨å“ªé‡Œï¼Ÿ

åœ¨è¿™é¡¹æœåŠ¡ä¸­ï¼Œå®ƒä½äºä½¿ç”¨ Docker æ‰˜ç®¡çš„ [MySQL ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥ä½äºæ‚¨è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚](https://www.prismagraphql.com/docs/tutorials/database/database-access-(sql)-eechaeth3l)

è¦è®¿é—®æ•°æ®åº“ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤

```
docker exec -it prisma-db mysql -u root --host 127.0.0.1 --port 3306 --password=graphcool 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯†ç å¯ä»¥æ˜¯ graphcool æˆ– prismaã€‚

```
mysql> show databases;
+--------------------+
| Database |
+--------------------+
| information_schema |
| deep-dive@dev |
| graphcool |
| mysql |
| performance_schema |
| sys |
+--------------------+
8 rows in set (0.00 sec) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“ä»¥ <service>@<stage></stage></service>
çš„å½¢å¼å‘½å

```
mysql> show tables;
+-------------------------+
| Tables_in_deep-dive@dev |
+-------------------------+
| Post |
| User |
| _PostToUser |
| _RelayId |
+-------------------------+
4 rows in set (0.00 sec)

mysql> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åœ¨ datamodel.graphql æ–‡ä»¶ä¸­æœ‰åŒ¹é…ç±»å‹çš„è¡¨ã€‚Prisma ä¸ºæˆ‘ä»¬åšäº†è¿™ä¸€åˆ‡ã€‚å¾ˆå¥½ã€‚

### [](#permissions)æƒé™

å¦‚ä½•åœ¨è¯¥ç³»ç»Ÿä¸­éªŒè¯è¯·æ±‚ï¼Ÿ

æˆ‘ä»¬æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåº”ç”¨æœåŠ¡å™¨å’Œ Prisma æœåŠ¡ï¼Œè¿™ä¸¤ä¸ªæœåŠ¡éƒ½éœ€è¦è®¤è¯(å¯èƒ½è¿˜éœ€è¦æŸç§æˆæƒ)ã€‚

è®©æˆ‘ä»¬å…ˆè°ˆè°ˆ Prisma æœåŠ¡ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ° prisma.yml æ–‡ä»¶ä¸­çš„ä¸€ä¸ªç§˜å¯†å­—æ®µï¼Œä»¥åŠæ‚¨çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨éƒ¨åˆ†çš„ src/index.js ä¸­çš„ç›¸åŒç§˜å¯†ã€‚æ­£å¦‚è¿™é‡Œæ‰€è®°å½•çš„[ï¼Œè¿™ä¸ªç§˜å¯†è¢«ç”¨æ¥ç­¾ç½²ä¸€ä¸ª JWT ä»¤ç‰Œï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡è¿™ä¸ªä»¤ç‰Œæ¥éªŒè¯è¯·æ±‚ã€‚](https://www.prismagraphql.com/docs/reference/prisma-api/concepts-utee3eiquo#service-token)

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨éœ€è¦åœ¨åº”ç”¨æœåŠ¡å™¨éƒ¨åˆ†æåŠç§˜å¯†ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿä¸ Prisma æœåŠ¡å¯¹è¯ï¼Œå¹¶ä¸”åœ¨ Prisma æœåŠ¡çš„æ¸¸æˆä¸­ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å‘é€ [HTTP æˆæƒå¤´ï¼Œå¦‚è®°å½•çš„](https://www.prismagraphql.com/docs/reference/prisma-api/concepts-utee3eiquo#service-token)ã€‚

æ‚¨å¯èƒ½è¿˜å¯¹ prisma token å‘½ä»¤æ„Ÿå…´è¶£ã€‚åœ¨[æ–‡æ¡£](https://www.prismagraphql.com/docs/reference/cli-command-reference/database-service/prisma-token-shoo8cioto)ä¸­æˆ–é€šè¿‡é”®å…¥ prisma help token äº†è§£æ›´å¤šä¿¡æ¯ã€‚

æ¥ä¸‹æ¥æ˜¯åº”ç”¨æœåŠ¡å™¨éƒ¨åˆ†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æœªç»éªŒè¯çš„ï¼Œæ‚¨éœ€è¦åƒå¯¹ä»»ä½•èŠ‚ç‚¹æœåŠ¡ä¸€æ ·è‡ªå·±æ·»åŠ å®ƒã€‚

å› ä¸ºï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº†èŠ‚ç‚¹é«˜çº§æ ·æ¿ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†è¿™æ ·åšçš„åŸææ–™ã€‚

æŸ¥çœ‹ src/utils.js æ–‡ä»¶ï¼Œå®ƒæåˆ°äº†å¦‚ä½•ä»å³å°†åˆ°æ¥çš„ JWT ä»¤ç‰Œ HTTP æˆæƒå¤´ä¸­è·å–ç”¨æˆ· idã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å¦‚ä½•åœ¨ src/resolvers/Query.js çš„æŸ¥è¯¢è§£æå™¨æ–‡ä»¶ä¸­ä½¿ç”¨å…¬å¼€çš„å‡½æ•° getUserId æ¥è·å–ç”¨æˆ· Id å¹¶ä¸ºâ€œç™»å½•â€ç”¨æˆ·æå–è‰ç¨¿ã€‚

### [](#advanced-queries)é«˜çº§æŸ¥è¯¢

d [æ–‡æ¡£](https://www.prismagraphql.com/docs/reference/prisma-api/queries-ahwee4zaey)å¾ˆå¥½åœ°æ¶µç›–äº†æŸ¥è¯¢å’Œé™åˆ¶ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨â€œæˆäººä»¥æ¸”â€çš„æ–¹æ³•æ¥æ¢ç©¶æŸ¥è¯¢ã€‚æ·±å…¥åˆ°ç”Ÿæˆçš„ prisma.graphql æ–‡ä»¶å¹¶æœç´¢ç±»å‹ Queryã€‚ä½ å°†åœ¨ä¸‹é¢ç€é™†ã€‚