# é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸å¸Œè…Šç¥è¯

> åŸæ–‡:[https://dev . to/Hector 6872/é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå¸Œè…Šç¥è¯-6jg](https://dev.to/hector6872/object-oriented-programming-and-greek-mythology-6jg)

## åŸç†å’Œè§„å¾‹

æˆ‘ä»¬ç»å¸¸å‘ç°è¿™æ ·çš„ä»£ç ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ç»™å®ƒä»»ä½•é‡è¦æ€§ï¼Œå› ä¸ºå®ƒå¾ˆå¸¸è§:

```
val model = Model(id = "whatever")

if (model.id.*isNotEmpty*()) {  // <<< look at this !!!
    doThis()
} else {
    doThat()
}

... where `model` is:

data class Model(
    val id: String = String(),
    val color: Color = Color.RED
) 
```

Enter fullscreen mode Exit fullscreen mode

å¥½äº†ï¼Œ[ç»§ç»­å‰è¿›ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼Œè¯·å¤§å®¶æ•£å»](https://www.youtube.com/watch?v=rSjK2Oqrgic)ã€‚

ç„¶åï¼Œä¾‹å¦‚ï¼Œä¸šåŠ¡éœ€æ±‚æ”¹å˜ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»æ£€æŸ¥å®ƒçš„`color`æ˜¯å¦ç­‰äº`Color.GREEN`æ¥éªŒè¯è¯¥æ¨¡å‹ï¼Œè¿«ä½¿æˆ‘ä»¬åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å¯»æ‰¾é‚£ä¸ª`if`æ¥æ›´æ–°å®ƒï¼Œæµªè´¹æ—¶é—´ï¼Œå¯¹ä¸€å †æ–‡ä»¶(*åˆå[çŒæªæ‰‹æœ¯ä»£ç æ°”å‘³](https://refactoring.guru/smells/shotgun-surgery)* )è¿›è¡Œæ›´æ”¹å’Œ/æˆ–åœ¨å…¶ä»–åœ°æ–¹ç ´åæŸäº›ä¸œè¥¿ã€‚

æœ€åï¼Œæˆ‘ä»¬ä¼šç¥ˆç¥·é‚£äº›è¦æ±‚ä¸ä¼šå†æ”¹å˜ã€‚ä½†æ˜¯ä»–ä»¬æ€»æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚

è¿™é‡Œçš„é—®é¢˜ä¸æ˜¯éœ€æ±‚ï¼Œè€Œæ˜¯è®¾è®¡:[ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»ç„¶åœ¨é—®è€Œä¸æ˜¯å‘Šè¯‰ï¼Ÿ](https://martinfowler.com/bliki/TellDontAsk.html)

### ä»€ä¹ˆæ˜¯å‘Šè¯‰ï¼Œä¸é—®(TDA)åŸåˆ™ï¼Ÿ

> ç¨‹åºä»£ç è·å–ä¿¡æ¯ï¼Œç„¶ååšå‡ºå†³ç­–ã€‚é¢å‘å¯¹è±¡çš„ä»£ç å‘Šè¯‰å¯¹è±¡å»åšäº‹æƒ…ã€‚
> â€”â€”äºšå†å…‹Â·å¤æ™®[ã€Šç”¨ä¾‹å­è¯´è¯ã€‹](https://www.amazon.com/Smalltalk-Example-Developers-Alec-Sharp/dp/0079130364)éº¦æ ¼åŠ³Â·å¸Œå°”å…¬å¸ï¼Œ1997 å¹´

åœ¨å¯¹è±¡ä¹‹å¤–åšå†³å®šè¿åäº†å®ƒä»¬çš„å°è£…ï¼Œæ‰€ä»¥**ä¸æ˜¯[è¯¢é—®å¯¹è±¡çš„çŠ¶æ€](https://www.martinfowler.com/bliki/GetterEradicator.html)ç„¶ååšå†³å®šï¼Œæˆ‘ä»¬åº”è¯¥å‘Šè¯‰å¯¹è±¡åšä»€ä¹ˆã€‚**

> å‘Šè¯‰æ˜¯å‘½ä»¤ï¼Œè¯¢é—®æ˜¯è¯¢é—®ã€‚

æˆ‘ä»¬åº”è¯¥åœæ­¢åˆ°å¤„ä½¿ç”¨è‡­åæ˜­è‘—çš„[è´«è¡€çš„é¢†åŸŸæ¨¡å‹](https://en.wikipedia.org/wiki/Anemic_domain_model) [åæ¨¡å¼](https://www.martinfowler.com/bliki/AnemicDomainModel.html)ï¼Œ**å¼€å§‹æŠŠæ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•æ”¾åœ¨åŒä¸€ä¸ªåœ°æ–¹** :

```
val model = Model(id = "whatever")

if (model.isValid()) {
    doThis()
} else {
    doThat()
}

... where `model` is:

data class Model(
    val id: String = String(),
    val color: Color = Color.RED
) {

    fun isValid() = id.isNotEmpty() && color == Color.GREEN
} 
```

Enter fullscreen mode Exit fullscreen mode

é€šè¿‡è¿›è¡Œä¸Šé¢æ‰€ç¤ºçš„æ›´æ”¹ï¼Œæˆ‘ä»¬éšè—äº†å®ç°ç»†èŠ‚ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œå¹¶ä¸”[ç»´æŠ¤](https://en.wikipedia.org/wiki/Don't_repeat_yourself) : **ä¸‹æ¬¡å›´ç»•è¯¥æ¨¡å‹çš„ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šå½±å“æˆ‘ä»¬é¡¹ç›®çš„å…¶ä½™éƒ¨åˆ†**ã€‚

### åŸåˆ™ä¸æ˜¯æ³•å¾‹

[![](../Images/2da8b0acee6648a7155c56ac5f48887e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7ImY5FFX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/hrules6872/Writings/master/6-greek-oop/art/1.jpeg)

æˆ‘ä»¬å¿…é¡»å§‹ç»ˆç‰¢è®°å°è£…ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¿…é¡»åœ¨ä½¿ç”¨ **TDA** æˆ–ä¸ä½¿ç”¨ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œå› ä¸ºä¸¥æ ¼éµå®ˆå®ƒå°±åƒå®ƒæ˜¯ä¸€æ¡å®šå¾‹ä¸€æ ·æœ‰ä¸€äº›ç¼ºç‚¹:

*   **ç±»å¾€å¾€æ›´å¤§ï¼Œ**å¢åŠ äº†å®ƒä»¬çš„å¤æ‚æ€§ï¼Œä½¿å®ƒä»¬æ›´éš¾å¤„ç†

*   è´£ä»»å¢å¤š ( *â€œæƒåŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ã€‚â€â€” [æœ¬å¤§å”](https://en.wikipedia.org/wiki/Uncle_Ben#%22With_great_power_comes_great_responsibility%22)* )ä»¥åŠå®ƒä»¬çš„è€¦åˆ(åœ¨è¿™é‡Œæƒ³æƒ³ä½œä¸ºåº”ç”¨ç¨‹åºæ ¸å¿ƒéƒ¨åˆ†çš„å…¸å‹å¯¹è±¡:æˆ‘ä»¬ä¸éœ€è¦ä¸Šå¸å¯¹è±¡)

*   æˆ‘ä»¬å¯èƒ½ä¼šè¿åå…¶ä»–åŸåˆ™ï¼Œä¾‹å¦‚ [SRP](https://en.wikipedia.org/wiki/Single_responsibility_principle)

    > # Tell everyone that the principle of don't ask can't be treated like the rule of thumb (like many other principles) because we often have to ask questions.

## å¾·ç±³ç‰¹é‡Œå®šå¾‹

é€šå¸¸ä¸ **TDA** åŸç†ç›¸å…³çš„æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°[å¾—å¢¨å¿’è€³](https://en.wikipedia.org/wiki/Law_of_Demeter)å®šå¾‹( *LoD åˆåâ€œæœ€å°‘çŸ¥è¯†åŸç†ã€‘*)ã€‚

**LoD å¯ä»¥æ€»ç»“ä¸ºâ€œç‰©ä½“é—´çš„å‹è°Šâ€**:ç‰©ä½“å¿…é¡»æ˜¯ç‹¬ç«‹çš„ï¼Œåªå’Œå®ƒçš„â€œæœ€äº²å¯†çš„ç›´ç³»æœ‹å‹â€æ¥è§¦ï¼Œâ€œä¸è¦å’Œé™Œç”Ÿäººè¯´è¯â€ã€‚

> æˆ‘æœ‹å‹çš„ä¸€ä¸ªæœ‹å‹æ˜¯â€¦ï¼Ÿ(æ ¹æ® LoD)ä¸æ˜¯æˆ‘çš„æœ‹å‹ã€‚

å› æ­¤ï¼Œè¦å®ç°è¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬å¿…é¡»éµå®ˆè¿™ä¸ªç®€å•çš„è§„åˆ™:å¯¹è±¡çš„ä»»ä½•æ–¹æ³•éƒ½åªèƒ½è°ƒç”¨å±äºä»¥ä¸‹å¯¹è±¡çš„æ–¹æ³•:

*   å®ƒè‡ªå·±

*   å®ƒçš„å‚æ•°(ä¹Ÿæ˜¯å¯¹è±¡)

*   å®ƒåˆ›å»º/å®ä¾‹åŒ–çš„ä»»ä½•å¯¹è±¡

*   å…¶ç›´æ¥ç»„æˆå¯¹è±¡

```
class A {
    private val c = C()

    fun method(b: B) {
        b.method()
        c.method()
        Object.method()
        D().method()
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

å°½ç®¡æœ‰äº›äººå°†è¿™ä¸ª*æ³•åˆ™*å½’ç»“ä¸ºâ€œç‚¹è®¡æ•°â€(å…¶ä¸­`model.getX().getY().doSomething()`æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯`model.doSomethingXY()`å¾ˆå¥½*ï¼Œæ²¡æœ‰æ˜ç¡®çš„åŸå› *â€¦â€¦)å¹¶ä¸”å€¾å‘äºä½¿ç”¨å¤ªå¤šçš„åŒ…è£…ç±»(è¿™æ˜¯å½“æˆ‘ä»¬è¯•å›¾é¿å… **LoD** æ—¶æœ€å¸¸è§çš„ç»“æœ)ï¼Œä½†æ˜¯**æˆ‘ä»¬åº”è¯¥å°† LoD æ›´å¤šåœ°è§†ä¸ºä¸€ä¸ªè®¾è®¡æŒ‡å—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ³•åˆ™æœ¬èº«**ã€‚

> > Suppose you are in a store, and what you want to buy is worth $25\. Will you give the clerk $25? Or do you give your wallet to the clerk and ask him/her to get $25 back?
> > â€”Misco Herveri ["Speak in clean codeâ€”don't look for anything!"](https://youtu.be/RlfLCWKxHJ0?t=941)

è®©æˆ‘ä»¬çœ‹çœ‹å…¸å‹çš„æŠ¥ç«¥ä¾‹å­(åœ¨[æœ¬æ–‡](http://www.ccs.neu.edu/research/demeter/demeter-method/LawOfDemeter/paper-boy/demeter.pdf)ä¸­æœ‰æ·±å…¥æè¿°)ã€‚

ä¸‹é¢æ˜¯ä¸éµå¾ª **LoD** (æˆ–è€… **TDA** ):
çš„ä»£ç èŠ‚é€‰

```
// given these classes

data class Neighbour(
    val firstName: String = String(),
    val lastName: String = String(),
    val wallet: Wallet = Wallet()

    ...
)

data class Wallet(
    var money: Float = 0F  // please forgive me :(

    ...
)

// when payday comes 

class Paperboy {
    companion object {
    private const val PRICE = 2f
    }

    private var earnings: Float = 0F

    fun getMoney(neighbour: Neighbour): Boolean =
    if (neighbour.wallet.money >= PRICE) {
        neighbour.wallet.money -= PRICE
        true
    } else {
        false
    }

    ...

}

The question here is: have you ever seen a paperboy 
taking money directly from a neighbour's wallet? 
```

Enter fullscreen mode Exit fullscreen mode

å› æ­¤ï¼Œä¸ºäº†éµå¾ªâ€œçœŸå®ä¸–ç•Œâ€çš„åœºæ™¯ï¼Œæˆ‘ä»¬åº”è¯¥åƒè¿™æ ·ä½¿ç”¨ **LoD** (åŠ ä¸Š**TDA**):

```
// given these classes

interface Payer {
    fun pay(
    service: Service,
    amount: Float
    ): Boolean
}

interface Service {
    fun pay(amount: Float)
}

data class Neighbour(
    val firstName: String = String(),
    val lastName: String = String(),
    private val wallet: Wallet = Wallet()
) : Payer {
    override fun pay(
    service: Service,
    amount: Float
    ): Boolean =
    if (hasEnoughMoney(amount)) {
        service.pay(amount)
        true
    } else {
        false
    }

    private fun hasEnoughMoney(amount: Float): Boolean =
    wallet.money >= amount

    ...

}

data class Wallet(
    var money: Float = 0F // ok, I know :(

    ...
)

// when payday comes

class Paperboy(
    private var earnings: Float = 0F
) : Service {

    companion object {
    private const val PRICE = 2f
    }

    fun getPaid(payer: Payer): Boolean =
    payer.pay(this, PRICE)

    override fun pay(amount: Float) {
    earnings += amount
    }

...

}

Ok, now everything seems a little more complex but 
now the paperboy is a good guy who ask for his/her 
money and doesnâ€™t take anything from anyoneâ€™s walletÂ :) 
```

Enter fullscreen mode Exit fullscreen mode

ä½¿å¯¹è±¡ä¹‹é—´çš„è”ç³»å°½å¯èƒ½çš„æ¾æ•£(â€œè®©å®ƒä»¬æœ‰ç‚¹å®³ç¾â€)å°†å¸®åŠ©æˆ‘ä»¬æé«˜çµæ´»æ€§å¹¶ä¿ƒè¿›ä»£ç ç»´æŠ¤(ç”±äºéš”ç¦»ï¼Œä»»ä½•æœªæ¥çš„å˜åŒ–éƒ½ä¸ä¼šå¯¹æˆ‘ä»¬çš„ä»£ç åº“äº§ç”Ÿå¤ªå¤§çš„å½±å“)ä»¥åŠä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨å¤§é‡[é“¾å¼æ¨¡ä»¿çš„æƒ…å†µä¸‹æµ‹è¯•å®ƒä»¬](https://twitter.com/damianguy/status/4977743956?s=19)ã€‚

> # "True friendship is not inseparable, but not knowing what will change even if we are separated"- [TED](https://en.wikipedia.org/wiki/Ted_(film))

æœ¬æ–‡æœ€åˆå‘è¡¨äº[åª’ä½“](https://medium.com/@hector6872/object-oriented-programming-and-greek-mythology-14c9b1271e34)

* * *

[1]å¦‚æœä½ å¯¹è¿™å¥è¯çš„çœŸæ­£æ¥æºæ„Ÿåˆ°å¥½å¥‡:[https://quoteinvestigator.com/2015/07/23/great-power/](https://quoteinvestigator.com/2015/07/23/great-power/)
[2]â€œå®ƒä¹‹æ‰€ä»¥å¦‚æ­¤å‘½åæ˜¯å› ä¸ºå®ƒèµ·æºäº Demeter é¡¹ç›®ï¼Œä¸€ç§è‡ªé€‚åº”ç¼–ç¨‹å’Œé¢å‘æ–¹é¢çš„ç¼–ç¨‹å·¥ä½œã€‚è¿™ä¸ªé¡¹ç›®çš„å‘½åæ˜¯ä¸ºäº†çºªå¿µ[å¾·ç±³ç‰¹é‡Œ](https://en.wikipedia.org/wiki/Demeter)â€”â€”[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Law_of_Demeter)
ã€3ã€‘â€œæ‰€æœ‰äººçš„æœ‹å‹éƒ½ä¸æ˜¯æœ‹å‹ã€‚â€â€”äºšé‡Œå£«å¤šå¾·(ä¹Ÿæ˜¯å¸Œè…Šäºº)

* * *

[å¤–éƒ¨é“¾æ¥ğŸ‘€](https://gist.github.com/hrules6872/ad1a39005ce8eb16a665cc1e8812f8e7)