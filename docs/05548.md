# ä½¿ç”¨ Angular ä¸­çš„ APIs æ¨¡å‹é€‚é…å™¨æ¨¡å¼

> åŸæ–‡:[https://dev.to/florimondmanca/consuming-apis-in-angular-æ¨¡å‹-é€‚é…å™¨-æ¨¡å¼-3fk5](https://dev.to/florimondmanca/consuming-apis-in-angular--the-model-adapter-pattern-3fk5)

<small>*åŸè½½äº 2018 å¹´ 9 æœˆ 4 æ—¥ blog.florimondmanca.comã€‚*</small>

åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å†™äº† REST API è®¾è®¡ä¸­çš„æœ€ä½³å®è·µã€‚è¿™äº›å¤§å¤šé€‚ç”¨äºæœåŠ¡å™¨ç«¯ã€‚

ä» 2018 å¹´ 1 æœˆå¼€å§‹ï¼Œæˆ‘ä¹Ÿåœ¨ç”¨[](https://angular.io)**åš**å‰ç«¯å¼€å‘**ï¼Œæ—¢æ˜¯çˆ±å¥½ä¹Ÿæ˜¯ä¸“ä¸šã€‚**

 **ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè°ˆæ¶æ„ï¼Œå¹¶ä¸ä½ åˆ†äº«ä¸€ä¸ª**è®¾è®¡æ¨¡å¼**ï¼Œå®ƒå¸®åŠ©æˆ‘**æ„å»ºå’Œæ ‡å‡†åŒ–**æˆ‘å°†**REST API**ä¸**è§’åº¦å‰ç«¯åº”ç”¨**é›†æˆçš„æ–¹å¼ã€‚

TLï¼›åšå£«:

> ç¼–å†™ä¸€ä¸ªæ¨¡å‹ç±»ï¼Œå¹¶ä½¿ç”¨é€‚é…å™¨å°†åŸå§‹ JSON æ•°æ®è½¬æ¢æˆè¿™ç§å†…éƒ¨è¡¨ç¤ºã€‚

**æç¤º**:ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°è¿™ä¸ªå¸–å­çš„æœ€ç»ˆä»£ç : [ng-courses](https://github.com/florimondmanca/ng-courses) ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## [](#the-problem)é—®é¢˜

æˆ‘ä»¬åˆ°åº•æƒ³è§£å†³ä»€ä¹ˆï¼Ÿ

å¦‚ä»Šï¼Œå‰ç«¯åº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦ä¸å¤–éƒ¨åç«¯æœåŠ¡è¿›è¡Œå¤§é‡äº¤äº’ï¼Œä»¥äº¤æ¢ã€ä¿å­˜å’Œæ£€ç´¢æ•°æ®ã€‚

æˆ‘ä»¬ä»Šå¤©æ„Ÿå…´è¶£çš„ä¸€ä¸ªå…¸å‹ä¾‹å­æ˜¯**é€šè¿‡è¯·æ±‚ REST API** æ¥æ£€ç´¢æ•°æ®ã€‚

è¿™äº› API ä»¥ç»™å®šçš„**æ•°æ®æ ¼å¼**è¿”å›æ•°æ®ã€‚è¿™ç§æ ¼å¼**ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜**ï¼Œåœ¨æˆ‘ä»¬ç”¨**æ‰“å­—ç¨¿**æ„å»ºçš„ Angular åº”ç”¨ä¸­ï¼Œè¿™å¾ˆå¯èƒ½ä¸æ˜¯æœ€ä½³æ ¼å¼ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬è¯•å›¾è§£å†³çš„é—®é¢˜æ˜¯:

**æˆ‘ä»¬å¦‚ä½•å°† API ä¸ Angular frontend app é›†æˆï¼ŒåŒæ—¶é™åˆ¶æ›´æ”¹çš„å½±å“å¹¶å……åˆ†åˆ©ç”¨ TypeScript çš„åŠŸèƒ½ï¼Ÿ**

## [](#the-course-subscription-system)è¯¾ç¨‹è®¢é˜…ç³»ç»Ÿ

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€ä¸ª**è¯¾ç¨‹è®¢é˜…ç³»ç»Ÿ**ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå­¦ç”Ÿå¯ä»¥ç”³è¯·è¯¾ç¨‹å’Œè®¿é—®å­¦ä¹ ææ–™ã€‚

è¿™æ˜¯æˆ‘ä»¬è¯•å›¾æ„å»ºçš„åŠŸèƒ½çš„**ç”¨æˆ·æ•…äº‹**:

"*ä½œä¸ºå­¦ç”Ÿï¼Œæˆ‘æƒ³æŸ¥çœ‹è¯¾ç¨‹åˆ—è¡¨ï¼Œä»¥ä¾¿æ³¨å†Œæ–°è¯¾ç¨‹ã€‚*

ä¸ºæ­¤ï¼Œæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ API ç«¯ç‚¹:

```
GET: /courses/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒçš„å“åº”æ•°æ®(JSON æ ¼å¼)å¦‚ä¸‹æ‰€ç¤º:

```
[  {  "id":  1,  "code":  "adv-maths",  "name":  "Advanced Mathematics",  "created":  "2018-08-14T12:09:45"  },  {  "id":  2,  "code":  "cs1",  "name":  "Computer Science I",  "created":  "2018-06-12T18:34:16"  }  ] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#why-not-just-raw-jsonparse-endraw-)ä¸ºä»€ä¹ˆä¸å¹²è„†`JSON.parse()`ï¼Ÿ

å¿«é€Ÿè€Œç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯è¿›è¡Œ HTTP è°ƒç”¨ï¼Œåœ¨å“åº”ä½“ä¸Šåº”ç”¨`JSON.parse()`ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ Angular ç»„ä»¶å’Œ HTML æ¨¡æ¿ä¸­ä½¿ç”¨ç»“æœ`Object`ã€‚äº‹å®è¯æ˜ï¼ŒAngular çš„ [HttpClient](https://angular.io/guide/http) å¯ä»¥å¸®ä½ åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”šè‡³ä¸ç”¨åšå¤ªå¤šå·¥ä½œã€‚

äº‹å®ä¸Šï¼Œè¿™å°±æ˜¯`CourseService`æ‰§è¡Œè¿™ä¸ª HTTP è¯·æ±‚æœ‰å¤šç®€å•:

```
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
    providedIn: 'root'
})
export class CourseService {

    constructor(private http: HttpClient) {}

    list(): Observable<any> {
        const url = 'http://api.myapp.com/courses/';
        return this.http.get(url);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªé—®é¢˜:

*   å®¹æ˜“å‡ºé”™çš„é”™è¯¯:æœ‰è®¸å¤šæ½œåœ¨çš„é”™è¯¯ä¸ä¼šåœ¨æ—©æœŸè¢«å‘ç°ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åˆ©ç”¨ TypeScript çš„é™æ€ç±»å‹ã€‚
*   **é«˜è€¦åˆ**:å¯¹ API æ•°æ®æ¨¡å¼çš„ä»»ä½•æ”¹å˜éƒ½ä¼šåœ¨æ•´ä¸ªä»£ç åº“ä¸­å†’æ³¡ï¼Œå³ä½¿å®ƒä¸ä¼šå¯¼è‡´åŠŸèƒ½ä¸Šçš„æ”¹å˜(ä¾‹å¦‚é‡å‘½åå­—æ®µ)ã€‚

å› æ­¤ï¼Œè™½ç„¶æœåŠ¡æœ¬èº«æ˜“äºç»´æŠ¤å’Œé˜…è¯»ï¼Œä½†å¯¹äºæˆ‘ä»¬ä»£ç åº“çš„å…¶ä½™éƒ¨åˆ†æ¥è¯´ï¼Œæƒ…å†µè‚¯å®šä¸ä¸€æ ·ã€‚

## [](#the-need-to-adapt)éœ€è¦é€‚åº”

é‚£ä¹ˆï¼Œå¦‚æœä»…ä»…ä½¿ç”¨ JSON å¯¹è±¡æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„é€‰æ‹©å‘¢ï¼Ÿ

å¥½äº†ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ã€‚

é¦–å…ˆï¼Œä»£ç **å®¹æ˜“å‡ºé”™**ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åˆ©ç”¨ TypeScript çš„é™æ€ç±»å‹å’Œ OOP ç‰¹æ€§(æ¯”å¦‚ç±»å’Œæ¥å£)æ¥**å»ºæ¨¡æ•°æ®**ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹(T4 æ¨¡å‹ T5)ï¼Œè¿™æ · TypeScript å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä½¿ç”¨å®ƒã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬é‡åˆ°äº†å…³äº API æ•°æ®æ ¼å¼çš„é«˜è€¦åˆæ€§ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä»å…¶ä½™çš„åº”ç”¨ç¨‹åºç»„ä»¶ä¸­æŠ½è±¡å‡ºè¿™ç§æ•°æ®æ ¼å¼ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª**å†…éƒ¨æ•°æ®æ ¼å¼**ï¼Œå¹¶åœ¨å¤„ç† API å“åº”æ—¶æ˜ å°„åˆ°è¿™ä¸ªæ ¼å¼ã€‚

å°±æ˜¯è¿™æ ·:æˆ‘ä»¬åˆšåˆšæ¦‚å¿µåŒ–äº†**æ¨¡å‹-é€‚é…å™¨æ¨¡å¼**ã€‚å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆ:

*   **æ¨¡å‹ç±»**è®©æˆ‘ä»¬ä¿æŒåœ¨ç±»å‹è„šæœ¬çš„èŒƒå›´å†…ï¼Œè¿™ç¡®å®æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚
*   **é€‚é…å™¨**ä½œä¸ºå•ä¸€æ¥å£æ¥æ”¶ API çš„æ•°æ®å¹¶æ„å»ºæ¨¡å‹çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æ”¾å¿ƒä½¿ç”¨ã€‚

æˆ‘å‘ç°å›¾è¡¨æ€»æ˜¯æœ‰åŠ©äºç†è§£æ¦‚å¿µï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªç»™ä½ :

<figure>

[![](../Images/ef59c61e9c32ad23a6d89732a24bc069.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UnYWPU2j--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/ac486986-40d0-4dab-9dee-a9b3f569e6a1.png)

<figcaption>The Model-Adapter pattern, visualised.</figcaption>

</figure>

## [](#modeladapter-by-example)å‹å·-é€‚é…å™¨ç¤ºä¾‹

æ—¢ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä»€ä¹ˆæ˜¯æ¨¡å‹é€‚é…å™¨æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ç³»ç»Ÿä¸­å®ç°å®ƒæ€ä¹ˆæ ·ï¼Ÿå…ˆè¯´è½¦å‹ã€‚

### `Course`æ¨¡å‹

è¿™å°†æ˜¯ä¸€ä¸ªç®€å•çš„ç±»å‹è„šæœ¬ç±»ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„:

```
// app/core/course.model.ts
export class Course {
  constructor(
    public id: number,
    public code: string,
    public name: string,
    public created: Date,
  ) { }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„`created`æ˜¯ä¸€ä¸ª`Date` Javascript å¯¹è±¡ï¼Œå³ä½¿ API ç«¯ç‚¹å°†å®ƒä½œä¸º`string` (ISO æ ¼å¼çš„æ—¥æœŸ)æä¾›ç»™æˆ‘ä»¬ã€‚æ‚¨å·²ç»å¯ä»¥çœ‹åˆ°é€‚é…å™¨æ½œä¼åœ¨è¿™é‡Œã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ¨¡å‹ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç¼–å†™ä¸€ä¸ªå®é™…çš„ HTTP è¯·æ±‚æœåŠ¡ã€‚æˆ‘ä»¬ä¼šçœ‹çœ‹æœ‰ä»€ä¹ˆå‘ç°ã€‚

### [](#stubbing-out-the-raw-courseservice-endraw-)æç­`CourseService`

å› ä¸ºæˆ‘ä»¬è¦è¿›è¡Œ HTTP è°ƒç”¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é¦–å…ˆåœ¨`AppModule` :
ä¸­å¯¼å…¥`HttpClientModule`

```
 // app/app.module.ts
  import { BrowserModule } from '@angular/platform-browser';
  import { NgModule } from '@angular/core';
+ import { HttpClientModule } from '@angular/common/http'; 
  import { AppComponent } from './app.component';

  @NgModule({
    declarations: [
      AppComponent
    ],
    imports: [
      BrowserModule,
+     HttpClientModule,
    ],
    providers: [],
    bootstrap: [AppComponent]
  })
  export class AppModule { } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»º`CourseService`ã€‚æŒ‰ç…§æˆ‘ä»¬çš„è®¾è®¡ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª`list()`æ–¹æ³•æ¥è¿”å›ä»`GET: /courses/`ç«¯ç‚¹è·å¾—çš„è¯¾ç¨‹åˆ—è¡¨ã€‚

```
// app/core/course.service.ts
import { Injectable } from '@angular/core';
import { Course } from './course.model';
import { Observable, of } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class CourseService {

  list(): Observable<Course[]> {
    // TODO
    return of([]);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚æˆ‘ä»¬å·²ç»æåˆ°çš„ï¼ŒAngular çš„`HttpClientModule`çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®ƒå†…ç½®äº†å¯¹ JSON å“åº”çš„æ”¯æŒã€‚å®é™…ä¸Šï¼Œ`HttpClient`é»˜è®¤æƒ…å†µä¸‹ä¼šè§£æ JSON ä¸»ä½“å¹¶ä»ä¸­æ„å»ºä¸€ä¸ª JavaScript å¯¹è±¡ã€‚æ‰€ä»¥è®©æˆ‘ä»¬è¯•ç€åœ¨è¿™é‡Œä½¿ç”¨å®ƒ:

```
// app/core/course.service.ts
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Course } from './course.model';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class CourseService {
  private apiUrl = 'http://api.myapp.com/courses';

  constructor(private http: HttpClient) { }

  list(): Observable<Course[]> {
   return this.http.get(this.apiUrl);
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤æ—¶ï¼ŒTypeScript çš„ç¼–è¯‘å™¨å°†ä¸å¹¸åœ°å’†å“®å‡ºæ¥(è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§‚ç‚¹ï¼):

<figure>

[![](../Images/e3c4a48e48bc8ba87832524589c4e304.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YXpf2D1n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/436c8b5c-edd5-41c6-b346-77c713f9942e.png)

<figcaption>TypeScript is not happyâ€¦ Why?</figcaption>

</figure>

å½“ç„¶å•¦ï¼æˆ‘ä»¬è¿˜æ²¡æœ‰ä»æ£€ç´¢åˆ°çš„åŸå§‹æ•°æ®ä¸­æ„å»º`Course`å®ä¾‹ã€‚ç›¸åï¼Œæˆ‘ä»¬ä»ç„¶è¿”å›ä¸€ä¸ª`Observable<Object>`ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [RxJS](https://angular.io/guide/rx-library) çš„`map`æ“ä½œç¬¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å°†æŠŠæ•°æ®æ•°ç»„æ˜ å°„åˆ°ä¸€ä¸ªç”±`Course`å¯¹è±¡ç»„æˆçš„æ•°ç»„:

```
// app/core/course.service.ts
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Course } from './course.model';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class CourseService {

  private apiUrl = 'http://api.myapp.com/courses';

  constructor(private http: HttpClient) { }

  list(): Observable<Course[]> {
    return this.http.get(this.apiUrl).pipe(
      map((data: any[]) => data.map((item: any) => new Course(
        item.id,
        item.code,
        item.name,
        new Date(item.created),
      ))),
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å”·ï¼è¿™å°†æ­£å¸¸å·¥ä½œï¼Œå¹¶æŒ‰é¢„æœŸè¿”å›ä¸€ä¸ª`Observable<Course[]>`ã€‚

ç„¶è€Œï¼Œè¿™æ®µä»£ç æœ‰å‡ ä¸ªé—®é¢˜:

*   ç”±äºé€‚é…ä»£ç ä½¿æœåŠ¡å˜å¾—æ··ä¹±ï¼Œå¾ˆéš¾é˜…è¯»ã€‚
*   è¿™æ˜¯**æ²¡æœ‰å¹²**(ä¸è¦é‡å¤è‡ªå·±):æˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰å…¶ä»–éœ€è¦ä» API é¡¹æ„å»ºè¯¾ç¨‹çš„æ–¹æ³•ä¸­é‡æ–°å®ç°è¿™ä¸ªé€»è¾‘ã€‚
*   è¿™ç»™å¼€å‘äººå‘˜å¸¦æ¥äº†**çš„é«˜è®¤çŸ¥è´Ÿè·**:æˆ‘ä»¬éœ€è¦å‚è€ƒ`course.model.ts`æ–‡ä»¶æ¥ç¡®ä¿æˆ‘ä»¬å‘`new Course()`æä¾›äº†æ­£ç¡®çš„å‚æ•°ã€‚

æ‰€ä»¥ï¼Œä¸€å®šæœ‰æ›´å¥½çš„æ–¹æ³•

### [](#enter-the-adapter)å›è½¦:é€‚é…å™¨

å½“ç„¶ï¼Œæ˜¯æœ‰çš„ï¼ğŸ‰

è¿™å°±æ˜¯**é€‚é…å™¨**è¿›å…¥çš„æ—¶å€™ã€‚å¦‚æœä½ ç†Ÿæ‚‰å››äººå¸®çš„è®¾è®¡æ¨¡å¼ï¼Œä½ å¯èƒ½ä¼šæ„è¯†åˆ°è¿™é‡Œéœ€è¦ä¸€ä¸ª[æ¡¥](https://sourcemaking.com/design_patterns/bridge):

> å°†æŠ½è±¡ä¸å…¶å®ç°è§£è€¦ï¼Œè¿™æ ·ä¸¤è€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

è¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„(ä½†æˆ‘ä»¬ç§°ä¹‹ä¸ºé€‚é…å™¨)ã€‚

é€‚é…å™¨æœ¬è´¨ä¸Šå°† API çš„å¯¹è±¡è¡¨ç¤ºè½¬æ¢ä¸ºæˆ‘ä»¬çš„å†…éƒ¨è¡¨ç¤ºã€‚

äº‹å®ä¸Šï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºé€‚é…å™¨å®šä¹‰ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œæ¯”å¦‚:

```
// app/core/adapter.ts
export interface Adapter<T> {
    adapt(item: any): T;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥è®©æˆ‘ä»¬æ¥å»ºé€ `CourseAdapter`ã€‚å®ƒçš„`adapt()`æ–¹æ³•å°†æ¥å—ä¸€ä¸ªå•ç‹¬çš„è¯¾ç¨‹é¡¹ç›®(ç”± API è¿”å›),å¹¶ä»ä¸­æ„å»ºä¸€ä¸ª`Course`æ¨¡å‹å®ä¾‹ã€‚ä½ åº”è¯¥æŠŠè¿™ä¸ªæ”¾åœ¨å“ªé‡Œï¼Ÿæˆ‘ä¼šæ¨èæ¨¡å‹æ–‡ä»¶æœ¬èº«é‡Œé¢çš„**:** 

 **```
// app/core/course.model.ts
import { Injectable } from '@angular/core';
import { Adapter } from './adapter';

export class Course {
    // ...
}

@Injectable({
    providedIn: 'root'
})
export class CourseAdapter implements Adapter<Course> {

  adapt(item: any): Course {
    return new Course(
      item.id,
      item.code,
      item.name,
      new Date(item.created),
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„é€‚é…å™¨æ˜¯ä¸€ä¸ª**å¯æ³¨å°„çš„**ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å°†èƒ½å¤Ÿä½¿ç”¨ Angular çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿï¼Œå°±åƒä»»ä½•å…¶ä»–æœåŠ¡ä¸€æ ·:å°†å®ƒæ·»åŠ åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œå¹¶ç«‹å³ä½¿ç”¨å®ƒã€‚

### [](#refactoring-the-raw-courseservice-endraw-)é‡æ„äº†`CourseService`

ç°åœ¨æˆ‘ä»¬å·²ç»å°†å¤§éƒ¨åˆ†é€»è¾‘æŠ½è±¡åˆ°äº†`CourseAdapter`ä¸­ï¼Œä¸‹é¢æ˜¯`CourseService`çš„æ ·å­:

```
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Course, CourseAdapter } from './course.model';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class CourseService {

  private apiUrl = 'http://api.myapp.com/courses';

  constructor(
    private http: HttpClient,
    private adapter: CourseAdapter,
  ) { }

  list(): Observable<Course[]> {
    return this.http.get(this.apiUrl).pipe(
      // Adapt each item in the raw data array
      map((data: any[]) => data.map(item => this.adapter.adapt(item))),
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œç°åœ¨:

*   ä»£ç æ›´åŠ æ¯ç‡¥:æˆ‘ä»¬å°†é€»è¾‘æŠ½è±¡åœ¨ä¸€ä¸ªå•ç‹¬çš„å…ƒç´ (é€‚é…å™¨)ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„é‡ç”¨å®ƒã€‚
*   ç»“æœæ˜¯`CourseService`æ¯”**æ›´å…·å¯è¯»æ€§**ã€‚
*   **è®¤çŸ¥è´Ÿè·é™ä½**å› ä¸ºæ¨¡å‹åŠå…¶é€‚é…é€»è¾‘ä¿å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

æˆ‘ä¹Ÿå‘ä½ æ‰¿è¯ºè¿‡,**æ¨¡å‹é€‚é…å™¨æ¨¡å¼**å°†å¸®åŠ©**å‡å°‘ API å’Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„è€¦åˆ**ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœæˆ‘ä»¬é‡åˆ°ä¸€ä¸ªâ€¦

### [](#data-format-change)æ•°æ®æ ¼å¼æ”¹å˜ï¼

API å›¢é˜Ÿçš„äººå¯¹ API çš„æ•°æ®æ ¼å¼è¿›è¡Œäº†ä¿®æ”¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª`course`é¡¹ç›®ç°åœ¨çš„æ ·å­:

```
{  "id":  1,  "code":  "adv-maths",  "label":  "Advanced Mathematics",  "created":  "2018-08-14T12:09:45"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»–ä»¬æŠŠ`name`å­—æ®µçš„åå­—æ”¹æˆäº†`label`ï¼

ä»¥å‰ï¼Œæ— è®ºæˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åºåœ¨å“ªé‡Œä½¿ç”¨`name`å­—æ®µï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å°†å…¶æ›´æ”¹ä¸º`label`ã€‚

ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å®‰å…¨äº†ï¼å› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ª**é€‚é…å™¨**ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨ API è¡¨ç¤ºå’Œæˆ‘ä»¬çš„å†…éƒ¨è¡¨ç¤ºä¹‹é—´è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ”¹å˜å¦‚ä½•è·å¾—å†…éƒ¨çš„`name`:

```
@Injectable({
  providedIn: 'root'
})
export class CourseAdapter implements Adapter<Course> {

  adapt(item: any): Course {
    return new Course(
      item.id,
      item.code,
-     item.name, +     item.label,
      new Date(item.created),
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ä¸€è¡Œå˜åŒ–ï¼**å’Œæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ç»§ç»­ä½¿ç”¨`name`å­—æ®µã€‚å¤ªæ£’äº†ã€‚âœ¨

## [](#good-principles-always-apply)å¥½çš„åŸåˆ™æ°¸è¿œé€‚ç”¨

æˆ‘å·²ç»åœ¨æˆ‘çš„å¤§éƒ¨åˆ† Angular é¡¹ç›®ä¸­ä½¿ç”¨äº†**æ¨¡å‹é€‚é…å™¨æ¨¡å¼**ï¼Œè¿™äº›é¡¹ç›®æ¶‰åŠåˆ° **REST API äº¤äº’**ï¼Œå¹¶å–å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚

å®ƒå¸®åŠ©æˆ‘**å‡å°‘è€¦åˆ**å¹¶å……åˆ†åˆ©ç”¨**æ‰“å­—ç¨¿**çš„åŠ›é‡ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œè¿™å®é™…ä¸Šå¯ä»¥å½’ç»“ä¸ºåšæŒè½¯ä»¶å·¥ç¨‹çš„è‰¯å¥½åŸåˆ™ã€‚è¿™é‡Œä¸»è¦çš„æ˜¯**å•ä¸€è´£ä»»åŸåˆ™** â€” *æ¯ä¸ªä»£ç å…ƒç´ åº”è¯¥åšä¸€ä»¶äº‹ï¼Œå¹¶ä¸”åšå¥½*ã€‚

å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æœ€ç»ˆä»£ç : [ng-courses](https://github.com/florimondmanca/ng-courses) ã€‚

æˆ‘å¸Œæœ›è¿™ä¸ªç®€å•çš„æ¶æ„æŠ€å·§èƒ½å¸®åŠ©ä½ **æ”¹è¿›åœ¨ Angular åº”ç”¨ä¸­é›†æˆ API çš„æ–¹å¼**ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è‡ªå·±ç”¨å¦ä¸€ç§æ–¹æ³•æˆåŠŸäº†ï¼Œæˆ‘å¾ˆæƒ³å¬å¬è¿™ä¸ªæ•…äº‹ï¼

* * *

**æ›´æ–°**(2019 . 3 . 1):æˆ‘å†™äº†è¿™ç¯‡æ–‡ç« çš„åç»­å¸–å­ã€‚å®ƒè§£é‡Šäº†å¦‚ä½•åœ¨è§’åº¦åˆ†é‡ä¸­ä½¿ç”¨è¿™é‡Œåˆ›å»ºçš„`CourseService`:

[![florimondmanca](../Images/122f3b1f9c33dcdad1433bb20f0dab94.png)](/florimondmanca) [## åœ¨ Angular ä¸­ä½¿ç”¨ API:åœ¨ç»„ä»¶ä¸­æ˜¾ç¤ºæ•°æ®

### å¼—æ´›é‡Œè’™å¾·Â·æ›¼å¡ 3 æœˆ 1 æ—¥ 1915 åˆ†é’Ÿé˜…è¯»

#webdev #angular #showdev #tutorial](/florimondmanca/consuming-apis-in-angular-displaying-data-in-components-3b97)

## [](#stay-in-touch)ä¿æŒè”ç³»ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šæ‰¾åˆ°æˆ‘ï¼Œè·å–æ›´æ–°ã€å…¬å‘Šå’Œæ–°é—»ã€‚ğŸ¤****