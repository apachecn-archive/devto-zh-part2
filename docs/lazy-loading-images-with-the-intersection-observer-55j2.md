# ä½¿ç”¨äº¤å‰ç‚¹è§‚å¯Ÿå™¨å»¶è¿ŸåŠ è½½å›¾åƒ

> åŸæ–‡ï¼š<https://dev.to/mrfrontend/lazy-loading-images-with-the-intersection-observer-55j2>

[![](../Images/b29e77214dc2bc6c57bfc02bb48b8e14.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xmAcXOYu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AHzI6z9f-Hy5_ZxzyY_wuMA.png)

å»å¹´ï¼Œæˆ‘è¯•å›¾è¶Šæ¥è¶Šå¤šåœ°å…³æ³¨ç½‘ç«™å’Œç½‘ç»œåº”ç”¨çš„æ€§èƒ½ã€‚åœ¨æ‰€æœ‰å¤§å‹æ¡†æ¶å’Œåº“çš„ä¸–ç•Œä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æŒ‘æˆ˜ã€‚

å¸Œæœ›æ‚¨çŸ¥é“åŠ è½½å›¾åƒä¼šè€—è´¹æ›´å¤šçš„æ—¶é—´å’Œæ•°æ®ã€‚ä½†æ˜¯å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æŠ€æœ¯å«åšå»¶è¿ŸåŠ è½½å›¾åƒã€‚

### åŠ è½½å›¾åƒ

åŠ è½½å¸¦æœ‰æ™®é€š`<img>`æ ‡ç­¾çš„å›¾åƒï¼Œè®©æµè§ˆå™¨ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„å›¾åƒéƒ½åŠ è½½å®Œæ¯•ã€‚

```
<img src="https://loadyourimages.nl/image-nam.jpg" src="This is my awesome image" /> 
```

ç‰¹åˆ«æ˜¯å¦‚æœä½ æœ‰ä¸€ä¸ªæœ‰å¾ˆå¤šå›¾ç‰‡çš„ç½‘ç«™ï¼Œåœ¨ç”¨æˆ·æœ‰ä¸€ä¸ªäº’åŠ¨é¡µé¢ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ 10 ç§’é’Ÿã€‚

åœ¨ç§»åŠ¨è¿æ¥ä¸Šï¼Œæƒ…å†µä¼šæ›´ç³Ÿã€‚å¦‚æœè¿æ¥ä¸å¥½æˆ–é€Ÿåº¦æ…¢ï¼Œç”¨æˆ·æœ‰æ—¶ä¼šç­‰å¾…å‡ åç§’ç”šè‡³å‡ åˆ†é’Ÿã€‚

ä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“é‚£äº›ç”¨æˆ·æƒ³ç­‰é‚£ä¹ˆä¹…ï¼ä»–ä»¬ä¼šåœ¨å‡ ç§’é’Ÿåç¦»å¼€ï¼

### æ‡’äººåŠ è½½å›¾ç‰‡

æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å¿«åœ°åŠ è½½æˆ‘ä»¬çš„é¡µé¢ã€‚æˆ‘ä»¬çš„ç›®æ ‡åº”è¯¥æ˜¯ 0-5 ç§’ï¼Œè¿™æ˜¯ç”¨æˆ·èƒ½å¤Ÿè€å¿ƒç­‰å¾…é¡µé¢åŠ è½½çš„æ—¶é—´ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬é¿å…æ™®é€šçš„`<img src="url" />`ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é¡µé¢å°†åŠ è½½å¾—æ›´å¿«ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ•°æ®å±æ€§æ¥æ”¾å…¥å›¾åƒçš„ urlï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ”¾å…¥ src å±æ€§ä¸­ï¼Œä»¥ä¾¿å½“å®ƒåœ¨è§†å£ä¸­æ—¶åŠ è½½å®ƒä»¬ã€‚

å¤§å¤šæ•°å¼€å‘äººå‘˜å°†ä½¿ç”¨å»¶è¿ŸåŠ è½½çš„åº“ï¼Œè¿™äº›åº“åœ¨ scroll äº‹ä»¶ä¸Šä½¿ç”¨ eventListener æ¥æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨ viewport ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ›´å¥½çš„ä¸œè¥¿ï¼Œå› ä¸ºå·è½´ä¸Šçš„ eventListener åœ¨æŸäº›è®¾å¤‡ä¸Šæœ‰ç‚¹é‡ï¼

### è·¯å£è§‚å¯Ÿè€…

äº¤å‰ç‚¹è§‚å¯Ÿå™¨åœ¨æ£€æµ‹æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨æµè§ˆå™¨çš„å¯è§éƒ¨åˆ†ä¸­åšå¾—å¾ˆå¥½ã€‚

> äº¤å‰ç‚¹è§‚å¯Ÿå™¨ API æä¾›äº†ä¸€ç§å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£çš„è§†å£çš„äº¤å‰ç‚¹å˜åŒ–çš„æ–¹æ³•ã€‚**æ¥æº:** [**Mozilla Docs**](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)

æœ‰äº†è¿™ä¸ª APIï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨è§†å£ä¸­ï¼Œå¦‚æœå®ƒä»¬ä¸è§†å£ç›¸äº¤çš„è¯ã€‚

### é…ç½®è·¯å£è§‚å¯Ÿè€…

åœ¨é…ç½®è§‚å¯Ÿå™¨æ—¶ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªé€‰é¡¹ã€‚

```
const options = { root: document.querySelector('#container'), rootMargin: '0px', threshold: 1.0 }

const observer = new IntersectionObserver(callback, options); 
```

#### æ ¹

åœ¨ root å±æ€§ä¸­å®šä¹‰å°†è¢«è®¾ç½®ä¸ºè§†å£çš„å…ƒç´ ã€‚è¯·è®°ä½ï¼Œå¦‚æœæ‚¨çš„ç›®æ ‡æ˜¯ä¸€ä¸ªå…ƒç´ (æˆ–èº«ä½“)ï¼Œå½“å®ƒçš„é«˜åº¦æ˜¯è‡ªåŠ¨çš„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å…ƒç´ å°†è¢«è®¾ç½®ä¸ºå¯è§ã€‚æ‰€ä»¥å¦‚æœä½ è®¾ç½®ä¸€ä¸ªå…ƒç´ ï¼Œè®¾ç½®ä¸€ä¸ªä¸æ˜¯ auto çš„é«˜åº¦ï¼Œå¦åˆ™å®ƒä¸ä¼šåƒé¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚å¦‚æœä½ ä¸å®šä¹‰è¿™ä¸ªå±æ€§ï¼Œå®ƒå°†è‡ªåŠ¨ä½¿ç”¨æµè§ˆå™¨è§†çª—ã€‚

#### æ ¹ç¼˜

å¦‚æœ rootMargin å€¼è®¾ç½®ä¸º 0ï¼Œå®ƒå°†ä¸ä¼šæŸ¥çœ‹æ ¹å…ƒç´ ä¹‹å¤–çš„å†…å®¹ã€‚å¦‚æœä½ è¾“å…¥ 10pxï¼Œå®ƒä¼šæå‰æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦è¢«æ»šåŠ¨åˆ°å®ƒçš„ rootelement ä¸­ã€‚

#### é˜ˆå€¼

å¦‚æœ threshold çš„å€¼ä¸º 0ï¼Œé‚£ä¹ˆå½“å…ƒç´ çš„ 1px åœ¨æ ¹å…ƒç´ å†…éƒ¨æ—¶ï¼Œå®ƒå°†è¿è¡Œå›è°ƒã€‚å½“å€¼ä¸º 1.0 æ—¶ï¼Œå½“å®ƒ 100%ä½äºæ ¹å…ƒç´ å†…éƒ¨æ—¶ï¼Œå°†è§¦å‘å›è°ƒã€‚ä½†æ˜¯å¦‚æœæ‚¨å¸Œæœ›å›è°ƒåœ¨å…ƒç´ ä½äºæ ¹å…ƒç´ å†…éƒ¨ 50%æ—¶è¢«è°ƒç”¨ï¼Œè¯·è¾“å…¥å€¼ 0.5ã€‚

### ç›®æ ‡å…ƒç´ 

ä¸ºäº†ä½¿ç”¨äº¤é›†è§‚å¯Ÿå™¨ï¼Œæˆ‘ä»¬éœ€è¦å…ƒç´ æ¥è§‚å¯Ÿä¸€äº›å…ƒç´ ï¼

æˆ‘ä»¬æƒ³è¦è§‚å¯Ÿçš„å…ƒç´ æœ‰ä¸€ä¸ªç±»åâ€œfake-image â€,æˆ‘ä»¬å°†éå†è¿™äº›å…ƒç´ ï¼Œä¸ºæ¯ä¸ª fake-image å…ƒç´ å¯åŠ¨ä¸€ä¸ªè§‚å¯Ÿå™¨ã€‚

æˆ‘ä»¬è¿˜æƒ³ç¡®å®šï¼Œå½“å…ƒç´ åœ¨æˆ‘ä»¬çš„æ ¹å…ƒç´ ä¸­æ—¶ï¼Œè§‚å¯Ÿå°†è¢«åœæ­¢ã€‚è¿™å¯ä»¥èŠ‚çœç”µè„‘æˆ–è®¾å¤‡çš„ä¸€äº›ç”µé‡ã€‚

```
const io = new IntersectionObserver((entries) => { entries.forEach((entry) => { if (entry.intersectionRatio > 0) { io.unobserve(entry.target); } }); }, options);

const targetElements = document.querySelector('.fake-image'); for(let element of targetElements) { io.observe(element); } 
```

[https://medium . com/media/32b 567 eede 7146781 e 35 da 37 ef 081 b 8 c/href](https://medium.com/media/32b567eede7146781e35da37ef081b8c/href)

### æ¼”ç¤º

è®©æˆ‘ä»¬è¯•è¯•è¿™ä¸ªï¼

æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå°æ¼”ç¤ºï¼Œå‘æ‚¨å±•ç¤ºäº¤é›†è§‚å¯Ÿå‘˜å·¥ç¨‹çœŸçš„å¾ˆé¡ºåˆ©ã€‚

å¼€å§‹æ»šåŠ¨ï¼Œæ¯å½“ä¸€ä¸ªå…ƒç´  100%å¯è§æ—¶ï¼Œå®ƒå°†å˜æˆç»¿è‰²ï¼Œæ–‡æœ¬å°†â€œåŠ è½½ï¼â€ã€‚

### æµè§ˆå™¨æ”¯æŒ

å¯¹äº¤å‰ç‚¹è§‚å¯Ÿå™¨çš„[æ”¯æŒéå¸¸å¥½ã€‚å®ƒåœ¨ Chrome(æ¡Œé¢&ç§»åŠ¨)ã€Firefoxã€Edgeã€Android æµè§ˆå™¨ä¸­å®ç°ã€‚æ‰€ä»¥åœ¨ IE11 å’Œ Safari(æ¡Œé¢&ç§»åŠ¨)é‡Œæ˜¯æ²¡æœ‰çš„ã€‚](https://caniuse.com/#feat=intersectionobserver) [webkit å›¢é˜Ÿæ­£åœ¨åŠªåŠ›å·¥ä½œ](https://webkit.org/status/#specification-intersection-observer)ï¼Œå› ä¸ºå®ƒè¢«æ ‡è®°ä¸ºâ€œå¼€å‘ä¸­â€ğŸ‘ï¼Œæ‰€ä»¥å¸Œæœ›å®ƒèƒ½å¾ˆå¿«åœ¨ Safari ä¸­å¾—åˆ°æ”¯æŒ(2018 å¹´ 3 æœˆ)ã€‚

ä¸ºäº†æ”¯æŒä¸æ”¯æŒè¿™ä¸ªå¾ˆé…·çš„ API çš„æµè§ˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ polyfillã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ npm å¾—åˆ°:[äº¤é›†-è§‚å¯Ÿè€…](https://www.npmjs.com/package/intersection-observer) npm å®‰è£…äº¤é›†-è§‚å¯Ÿè€…-ä¿å­˜ã€‚

### è®©æˆ‘ä»¬æ„å»ºæ‡’æƒ°åŠ è½½çš„æ˜ åƒ

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨äº¤å‰ç‚¹è§‚å¯Ÿå™¨ï¼Œæˆ‘ä»¬å°†ä½¿æˆ‘ä»¬çš„å›¾åƒåœ¨å¯è§è§†å£ä¸­å¼‚æ­¥åŠ è½½åˆ°æµè§ˆå™¨ä¸­ã€‚

åœ¨è¿™ç¯‡åšæ–‡çš„å¼€å§‹ï¼Œæˆ‘å·²ç»å‘ä½ å±•ç¤ºäº†å¤§éƒ¨åˆ†çš„å»¶è¿ŸåŠ è½½åŠŸèƒ½æ˜¯å¦‚ä½•åœ¨å»å¹´æ„å»ºçš„ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸ºäº¤å‰ç‚¹è§‚å¯Ÿå™¨æ›¿æ¢æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨ã€‚

### HTML

å¦‚æœæ‚¨è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ä½¿ç”¨çš„ HTMLï¼Œé‚£ä¹ˆæ‚¨ä¼šçœ‹åˆ°æˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªå¸¦æœ‰æ•°æ®å±æ€§ data-src çš„`<img>`æ ‡ç­¾ã€‚

æ•°æ®å±æ€§æ˜¯æ”¾å…¥ url çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† url æ”¾å…¥å®ƒä»¬çš„ã€‚

```
<div class="fake-image"> <h2>Fake image</h2> <img data-src="https://images.unsplash.com/photo-1521315807607-8220d719f0e4?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjF9&s=558cae1f662f20ea31f3ffda21a766f8" alt="" /> </div> 
```

### JavaScript

å¯¹äº JavaScriptï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°æ¥åŠ è½½æˆ‘ä»¬çš„å›¾åƒã€‚è°ƒç”¨äº¤å‰ç‚¹è§‚å¯Ÿå™¨å†…éƒ¨çš„å‡½æ•°ã€‚

```
const io = new IntersectionObserver(entries => { entries.forEach(entry => { // console.log('entry: ', entry); if (entry.intersectionRatio > 0.9) { loadImage(entry.target); entry.target.classList.add('active'); // entry.target.innerHTML = '<h2>Loaded!</h2>'; io.unobserve(entry.target); } }); }, options); function loadImage(imageElement) { setTimeout(() => { console.dir(imageElement.querySelector('img')); imageElement.querySelector('img').src = imageElement.querySelector('img').dataset.src; }, 1000); } 
```

æˆ‘ä»¬åœ¨å‡½æ•°ä¸­å”¯ä¸€éœ€è¦åšçš„äº‹æƒ…æ˜¯ï¼Œå°† url ä» data-src å±æ€§æ”¾å…¥ src å±æ€§ã€‚

å½“ src å±æ€§å‡ºç°æ—¶ï¼Œå›¾åƒå°†åŠ è½½åˆ°æµè§ˆå™¨ä¸­ã€‚

åœ¨ JavaScript ä»£ç ä¸­ï¼Œæˆ‘è®¾ç½®äº† 1 ç§’é’Ÿçš„è¶…æ—¶æ—¶é—´æ¥è§‚å¯ŸåŠ è½½è¿‡ç¨‹ã€‚

### ä¸¾ä¾‹

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ã€‚å‘ä¸‹æ»šåŠ¨è§†å›¾ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

[https://medium . com/media/Abd 8222 a 0096 cab 0350 e 994 F4 edd 1947/href](https://medium.com/media/abd8222a0096cab0350e994f4edd1947/href)

### æ„Ÿè°¢

å¦‚æœæ‚¨ä» querySelectorAll å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿æˆ–è€…æœ‰å…¶ä»–æ–¹æ³•æ¥å¾ªç¯éå† NodeList å¯¹è±¡ï¼Œè¯·åœ¨ twitter ä¸Šå‘Šè¯‰æˆ‘ğŸ˜‰: [@rsschouwenaar](https://twitter.com/rsschouwenaar)

*åŸè½½äº*[*https://raymonschouwenaar . nl/lazy-loading-images-intersection-observer/*](https://raymonschouwenaar.nl/lazy-loading-images-intersection-observer/)