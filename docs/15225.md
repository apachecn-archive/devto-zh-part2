# å¹¸è¿æ•°å­—å’Œç§‘å­¦

> åŸæ–‡:[https://dev.to/rpalo/lucky-numbers-and-science-46mj](https://dev.to/rpalo/lucky-numbers-and-science--46mj)

æœ¬å‘¨æ—©äº›æ—¶å€™ï¼Œ [Heiko Dudzus](https://dev.to/heikodudzus) åœ¨ Dev.to ä¸Šå‘å¸ƒäº†[è¿™ä¸ªæŒ‘æˆ˜å¸–å­](https://dev.to/heikodudzus/write-a-program-or-script-to-find-lucky-numbers--23me)ï¼ŒæŒ‘æˆ˜æ˜¯è¿™æ ·çš„:

> ç”¨ä½ é€‰æ‹©çš„è¯­è¨€å†™ä¸€ä¸ªç¨‹åºæˆ–è„šæœ¬ï¼Œæ‰“å° 1 åˆ° n ä¹‹é—´çš„å¹¸è¿æ•°å­—ã€‚è¯•ç€å°½å¯èƒ½å¿«åœ°ç­›é€‰ 1 åˆ° 100 ä¸‡ä¹‹é—´çš„å¹¸è¿æ•°å­—ã€‚(ä¹Ÿè®¸æµ‹é‡æ—¶é—´è€Œä¸æ‰“å°ç»“æœæ˜¯æ˜æ™ºçš„ã€‚)

ä¸€ä¸ªå¹¸è¿æ•°å­—è¢«å®šä¹‰ä¸ºä¸€ä¸ªèƒ½é€šè¿‡çº¦ç‘Ÿå¤«æ–¯ç­›å­[çš„æ•°å­—ã€‚æˆ‘åœ¨è¿™é‡Œå¼•ç”¨åŸå¸–ï¼Œè¿™æ ·ä½ å°±æ˜ç™½äº†ã€‚](https://en.wikipedia.org/wiki/Lucky_number)

> æ ¹æ®å®šä¹‰ï¼Œ1 æ˜¯å¹¸è¿çš„ã€‚
> 
> 1 çš„åç»§è€…æ˜¯ 2ã€‚å› æ­¤ï¼Œæ¯éš”ä¸€ä¸ªæ•°å­—å°±ä¼šè¢«åˆ é™¤:
> 1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11ï¼Œ13ï¼Œ15ï¼Œ17ï¼Œ19ï¼Œ21ï¼Œ...
> 
> ä¸‹ä¸€ä¸ªæ•°å­—æ˜¯ 3ã€‚ç°åœ¨ï¼Œæ¯ä¸‰ä¸ªæ•°å­—ä¸­å°±æœ‰ä¸€ä¸ªè¢«å‰”é™¤:1ï¼Œ3ï¼Œ7ï¼Œ9ï¼Œ13ï¼Œ15ï¼Œ19ï¼Œ21ï¼Œ...
> 
> 3 å·æ˜¯å¹¸è¿çš„ï¼å®ƒçš„[åŸæ–‡]ç»§ä»»è€…æ˜¯ 7ã€‚ç°åœ¨ï¼Œæ¯ä¸ƒä¸ªæ•°å­—ä¸­å°±æœ‰ä¸€ä¸ªè¢«æ·˜æ±°ã€‚è¯¸å¦‚æ­¤ç±»ã€‚

æ›´å¤šè¯¦æƒ…è¯·è§ä¸Šé¢çš„é“¾æ¥ã€‚æˆ‘å»ºè®®ä½ åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†ä¹‹å‰å°è¯•ä¸€ä¸‹è¿™ä¸ªæŒ‘æˆ˜ï¼Œå› ä¸ºæˆ‘å°†å‘Šè¯‰ä½ æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚

æˆ‘æå‡ºäº†ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½†æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæœ€ç»ˆæ˜¯ä¸¤è€…çš„æœ‰è¶£ç»“åˆã€‚ä½ ä¼šæ˜ç™½æˆ‘çš„æ„æ€ã€‚

## [](#solution-1-naively-run-the-algorithm)è§£å†³æ–¹æ¡ˆ 1:å¤©çœŸåœ°è¿è¡Œç®—æ³•

æˆ‘å–œæ¬¢â€œè®©å®ƒå·¥ä½œï¼Œè®©å®ƒæ­£ç¡®ï¼Œè®©å®ƒå¿«é€Ÿâ€è¿™å¥è¯ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œè¿™æ˜¯è‚¯ç‰¹Â·è´å…‹è¯´çš„ã€‚å› æ­¤ï¼Œæˆ‘çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸“æ³¨äºæŒ‰ç…§æä¾›çš„é—®é¢˜ç¼–å†™ä»£ç ï¼Œç®€å•çš„æ–¹æ³•ï¼Œä¸ç®¡è¿™æ˜¯ä¸æ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚

```
def lucky_numbers(max)
  possibles = (1..max).to_a
  1.step do |current_index|
    break if current_index >= possibles.size

    step_size = possibles[current_index]
    possibles = reject_every_nth_item(possibles, step_size)

    # If current_index is one of the items to get wiped out
    # the same current index will actually point at the next
    # number.  Reuse this index.
    redo if wiped_out?(ind, step_size)
  end
  possibles
end

def reject_every_nth_item(items, n)
  items.reject.each_with_index do |_, ind|
    ((ind + 1) % n).zero?
  end
end

def wiped_out?(ind, step_size)
  ((ind + 1) % step_size).zero?
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“æˆ‘è·‘çš„æ—¶å€™ï¼Œæˆ‘ä¸ºè‡ªå·±æ„Ÿåˆ°éª„å‚²ã€‚ç„¶åæˆ‘ç”¨`max = 1_000_000`è·‘äº†ä¸€ä¸‹ã€‚æˆ‘åç€ã€‚æˆ‘ååœ¨â€¦

è¿™èŠ±çš„æ—¶é—´å¤ªé•¿äº†ï¼æˆ‘å¯ä»¥åšå¾—æ›´å¥½ã€‚

## è§£å†³æ–¹æ¡ˆ 2:å…³æ³¨è¢«ä¿ç•™è€…ï¼Œè€Œä¸æ˜¯è¢«æ‹’ç»è€…

å½“æˆ‘è¿›è¡Œè¯•éªŒå’Œæµ‹è¯•æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°ï¼Œåœ¨è¾ƒé«˜çš„å€¼`step_size`ä¸‹ï¼Œæœ´ç´ ç®—æ³•åªæ˜¯å¶å°”æ‹’ç»ä¸€ä¸ªæ•°å­—ã€‚æ‰€ä»¥æˆ‘å¯¹è‡ªå·±è¯´ï¼Œâ€œå¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠæ­¥é•¿ä»ç­‰å¼ä¸­å»æ‰ï¼Œè®©æ¯ä¸€æ­¥èŠ±è´¹å¤§è‡´ç›¸åŒçš„æ—¶é—´ï¼Œä¸ç®¡å®ƒæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿâ€å› æ­¤ï¼Œæˆ‘æ²¡æœ‰æ£€æŸ¥æ¯ä¸€ä»¶å•†å“çœ‹å®ƒæ˜¯å¦è¢«æ‹’ç»ï¼Œè€Œæ˜¯è®¡ç®—å‡ºäº†*æœªè¢«æ‹’ç»çš„*æ•°å­—å—çš„å¤§å°ï¼Œå¹¶å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸€ä¸ª`results`æ•°ç»„ä¸­ï¼Œå¿½ç•¥äº†æ‹’ç»è€Œä¸æ˜¯æ˜¾å¼æ‹’ç»å®ƒä»¬ã€‚

```
def lucky_numbers(max)
  possibles = (1..max).to_a
  1.step do |current_index|
    break if current_index >= possibles.size

    step_size = possibles[current_index]
    possibles = grab_chunks_between_rejects(possibles, step_size)

    redo if wiped_out?(current_index, step_size)
  end
  possibles
end

def grab_chunks_between_rejects(items, n)
  chunk_count = (items.size / n).floor

  # The new array will be the same size minus one reject item
  # for every chunk possible
  result = Array.new(items.size - chunk_count)
  chunk_target_index = 0

  # Some tricky indexing...
  # 1) Select chunks of size n - 1 (so as to not include the reject endpoint)
  # 2) Copy it into the results array
  # 3) Continue, each chunk after the one in front of it.
  (0...items.size).step(n) do |chunk_start|
    chunk = items[chunk_start...(chunk_start + n - 1)]
    result[chunk_target_index...(chunk_target_index + chunk.size)] = chunk
    chunk_target_index += chunk.size
  end
  result
end

def wiped_out?(ind, step_size)
  ((ind + 1) % step_size).zero?
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªæ•ˆæœå¾ˆå¥½ï¼å³ä½¿åœ¨æˆ‘çš„å°ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼Œå®ƒä¹Ÿè¿è¡Œå¾—ç›¸å¯¹è¾ƒå¿«(åˆ«æ‹…å¿ƒï¼ŒåŸºå‡†æµ‹è¯•å³å°†åˆ°æ¥)ã€‚ä½†æ˜¯æœ‰äº›äº‹æƒ…æ„Ÿè§‰å¾ˆå¥‡æ€ªã€‚æˆ‘çš„ç¨‹åºå‘˜æ„Ÿè§‰å¾ˆå…´å¥‹ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æ²¡æœ‰è¯æ®ï¼Œä½†ä¼¼ä¹æ¯ä¸ªâ€œå›åˆâ€çš„ç¬¬äºŒä¸ªæ•°ç»„çš„æ‰€æœ‰è®¾ç½®å’Œåˆ›å»ºéƒ½ä¼šå¯¼è‡´è¯¥ç®—æ³•åœ¨å°çš„`step_size` s æ—¶è¡¨ç°ä¸ä½³ã€‚æ­£æ˜¯åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™ä¸å†æ˜¯ä¸€ä¸ªä»£ç æŒ‘æˆ˜ï¼Œè€Œæ˜¯ä¸€ä¸ªç§‘å­¦å®éªŒã€‚

## [](#solution-3-a-combination-of-the-two)æ–¹æ¡ˆä¸‰:ä¸¤è€…ç»“åˆ

> å‡è®¾:å¯¹äºæˆ‘çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä½ç«¯å’Œé«˜ç«¯ä¹‹é—´å­˜åœ¨æ€§èƒ½æƒè¡¡ã€‚å› æ­¤ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªä¸¤è€…çš„ç»„åˆï¼Œå®ƒæ¯”å•ç‹¬ä½¿ç”¨ä»»ä½•ä¸€ä¸ªéƒ½è¦å¿«ã€‚

å¦‚æœåœ¨ä¸¤ç§è§£å†³æ–¹æ¡ˆä¹‹é—´æœ‰*å’Œ*çš„æƒè¡¡ï¼Œæˆ‘å°†èƒ½å¤Ÿè¿è¡Œä¸€äº›æµ‹è¯•å¹¶æ‰¾åˆ°æœ€ä½³çš„å¯èƒ½ç»„åˆã€‚æˆ‘å¾ˆå¿«æ›´æ–°äº†æˆ‘çš„`lucky_numbers`æ–¹æ³•ã€‚

```
def lucky_numbers(max, strategy_switch = 10)
  possibles = (1..max).to_a
  1.step do |current_index|
    break if current_index >= possibles.size

    step_size = possibles[current_index]

    # Calculate next round of numbers
    possibles = if step_size <= strategy_switch
                  reject_every_nth_item(possibles, step_size)
                else
                  grab_chunks_between_rejects(possibles, step_size)
                end

    redo if wiped_out?(current_index, step_size)
  end
  possibles
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æ¥æ”¶é›†ä¸€äº›æ•°æ®ï¼ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘å°†æ¯ä¸ªå‡½æ•°åŒ…è£…åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä»¥åŒºåˆ†å®ƒä»¬ã€‚

[![Data, data, data!  I cannot make bricks without clay.](../Images/648a1a93a2fcdcc7a639960cb976b560.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--W1H73Ary--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://assertnotmagic.com/img/data-data-data.gif)T3ã€‘

```
require "benchmark"

require_relative "lucky_numbers3"

max_nums = 1_000_000
switch_levels = [
  2,
  10,
  100,
  500,
  1000,
  5000,
  10_000,
  50_000,
  100_000,
  500_000,
]

Benchmark.bm do |bm|
  switch_levels.each do |level|
    bm.report(level.to_i) do
      Lucky3::lucky_numbers(max_nums, level)
    end
  end
end

# â–¶ ruby optimize_lucky3.rb
#        user     system      total        real
#      2 17.550718  21.655086  39.205804 ( 39.535233)
#     10 18.351711  23.234818  41.586529 ( 42.615220)
#    100 18.443557  22.266405  40.709962 ( 41.178138)
#    500 20.278373  23.325708  43.604081 ( 44.987643)
#   1000 20.725864  22.510307  43.236171 ( 43.617160)
#   5000 27.245503  21.725938  48.971441 ( 49.304915)
#  10000 33.828295  22.476806  56.305101 ( 56.742865)
#  50000 82.069851  37.399753 119.469604 (120.174670)
# 100000 120.410101  23.425739 143.835840 (144.841090)
# 500000 445.835956  31.520488 477.356444 (483.688845) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ²¡æœ‰æƒ…èŠ‚çš„ç§‘å­¦å®éªŒæ˜¯ä¸å®Œæ•´çš„ï¼ä¸å¹¸çš„æ˜¯ï¼ŒRuby ä¸­çš„æ•°æ®å¯è§†åŒ–æ•…äº‹(åœ¨ web ä¹‹å¤–)æ²¡æœ‰ Python ä¸­çš„é‚£ä¹ˆè½»æ¾ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘æ‰¾åˆ°äº† Python çš„`matplotlib`çš„åŒ…è£…å™¨ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨å¯ä»¥ç•™åœ¨ Ruby landã€‚è¯·æ³¨æ„ï¼Œæˆ‘åœ¨ X è½´ä¸Šä½¿ç”¨äº†åŸºäºå¯¹æ•°çš„åˆ»åº¦ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ˜¾ç¤ºæˆ‘çš„ç»“æœã€‚

```
# plot_lucky3.rb

require "matplotlib/pyplot"

plt = Matplotlib::Pyplot

xs = [2, 10, 100, 500, 1000, 5000, 10_000, 50_000, 100_000, 500_000]
ys = [
  39.54,
  42.62,
  41.18,
  44.99,
  43.62,
  49.30,
  56.74,
  120.17,
  144.84,
  483.69,
]
ax = plt.gca()
ax.scatter(xs, ys)
ax.set_xscale('log')
plt.show() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![Lucky 3 results](../Images/b6b885436275d4020969b5cdb1efe874.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Gdijtfju--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://assertnotmagic.com/img/lucky3-results.png)

è¿™æ˜¯è®©æˆ‘å›°æƒ‘çš„éƒ¨åˆ†ã€‚æˆ‘å·²ç»å¤šæ¬¡è¿è¡Œè¿™ä¸ªå®éªŒï¼Œæˆ‘æ€»æ˜¯åœ¨ 1000 ç‚¹å·¦å³ç»“æŸã€‚æˆ‘ä»¬ä¸€ä¼šå„¿ä¼šè°ˆåˆ°è¿™ä¸€ç‚¹ã€‚ä¸‹é¢æ˜¯ç›´æ¥æ¯”è¾ƒçš„æ¯ä¸ªè§£å†³æ–¹æ¡ˆçš„åŸºå‡†ã€‚

```
require "benchmark"

require_relative "lucky_numbers"
require_relative "lucky_numbers2"
require_relative "lucky_numbers3"

iterations = 1_000_000

Benchmark.bm do |bm|
  bm.report("Version 1") do
    Lucky1::lucky_numbers(iterations)
  end

  bm.report("Version 2") do
    Lucky2::lucky_numbers(iterations)
  end

  bm.report("Version 3") do
    Lucky3::lucky_numbers(iterations, 1000)
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è€Œç»“æœ:

```
â–¶ ruby lucky_number_timer.rb
          user        system    total      real
Version 1 794.304851  28.946642 823.251493 (826.377494)
Version 2  23.267372  33.858966  57.126338 ( 57.238392)
Version 3  19.517162  20.816684  40.333846 ( 40.470201) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#conclusion)ç»“è®º

> ç»“è®º:æˆ‘çš„å‡è®¾å¾—åˆ°äº†æ”¯æŒã€‚è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„ç»„åˆæ¯”ä»»ä½•ä¸€ç§è§£å†³æ–¹æ¡ˆå•ç‹¬ä½¿ç”¨éƒ½è¦å¥½ã€‚ä½†æ˜¯ï¼Œè¿™èƒŒåçš„åŸå› å¾ˆå¯èƒ½ä¸æ˜¯æˆ‘æœ€åˆæƒ³çš„é‚£æ ·ã€‚éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶æ¥æ‰¾å‡ºè¿™ç§æ–¹æ³•å¥æ•ˆçš„åŸå› ã€‚

æˆ‘çš„å¦»å­æ•™ä¸­å­¦ç§‘å­¦ï¼Œæˆ‘åˆšåˆšå¸®å¥¹è¯„åˆ¤ä»–ä»¬çš„ç§‘å­¦å±•ï¼Œæ‰€ä»¥æˆ‘åœ¨å¤§è„‘ä¸Šåšå®éªŒã€‚å¸Œæœ›è¿™ä¸ªå°å®éªŒèƒ½è®©å¥¹éª„å‚²ï¼

æˆ‘ç¡®ä¿¡æˆ‘çš„è§£å†³æ–¹æ¡ˆä¸æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯å®ƒå®Œæˆäº†ä»»åŠ¡ã€‚Ruby ä¸ä¸€å®šæ˜¯é«˜ååé‡è®¡ç®—çš„é¦–é€‰è¯­è¨€([å°½ç®¡å®ƒä¹Ÿä¸ä¸€å®šæ˜¯ä¸ªåé€‰æ‹©](https://blog.heroku.com/ruby-3-by-3))ã€‚å¦‚æœæœ‰äººèƒ½æå‡ºä¸€ä¸ªä»¤äººä¿¡æœçš„ç†ç”±æ¥è§£é‡Šä¸ºä»€ä¹ˆæˆ‘çš„æ•°æ®ä¼šè¿™æ ·ï¼ŒåŒ…æ‹¬ 1000 ç‚¹çš„ä¸‹è·Œï¼Œæˆ‘ä¼šäº²è‡ªé€ä½ ä¸€ä¸ªé—ªäº®çš„æ–°å¥–æ¯è¡¨æƒ…ç¬¦å·ã€‚ğŸ†æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰æ¯”è¿™äº›æ›´å–œæ¬¢çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æƒ³çœ‹çœ‹ã€‚åˆ†äº«ä¸€ä¸‹ï¼(æˆ–è€…åˆ†äº«ä¸€ä¸ªé“¾æ¥ï¼Œé“¾æ¥åˆ°ä½ åœ¨ [Heiko çš„åŸå¸–](https://dev.to/heikodudzus/write-a-program-or-script-to-find-lucky-numbers--23me)ä¸Šè¯„è®ºçš„è§£å†³æ–¹æ¡ˆ)ã€‚

* * *

*åŸå¸– [`assert_not magic?`](https://assertnotmagic.com/2018/02/15/lucky-numbers-and-science/)*