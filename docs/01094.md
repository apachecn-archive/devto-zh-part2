# JavaScript:å¤„ç† Go ä¹‹ç±»çš„é”™è¯¯

> åŸæ–‡:[https://dev . to/oieduardorabelo/JavaScript-handling-errors-like-go-3 efk](https://dev.to/oieduardorabelo/javascript-handling-errors-like-go-3efk)

æ—©åœ¨å…«æœˆä»½ï¼Œæˆ‘ç”¨å·´è¥¿è‘¡è„ç‰™è¯­å†™äº†ä¸€ç¯‡[æ–‡ç« ï¼Œè§£é‡Šäº†æˆ‘å¦‚ä½•ä½¿ç”¨`async` / `await`æ¥éš”ç¦»é”™è¯¯å¤„ç†ã€‚](https://medium.com/@oieduardorabelo/javascript-tratando-erros-ao-estilo-go-65c5da9c12a9)

ä»Šå¤©æˆ‘å°†æŠŠå®ƒç¿»è¯‘æˆè‹±è¯­ï¼Œä½†æ˜¯ç”¨ä¸åŒçš„ä¾‹å­ï¼

* * *

æˆ‘å–œæ¬¢ [Go](http://golang.org/) ä»¥ç±»ä¼¼åŒæ­¥çš„æ–¹å¼å¤„ç†å‰¯ä½œç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¥è‡ª`net/http`åŒ…çš„ä¾‹å­:

```
func main() {
  res, err := http.Get("http://example.com/")

  if err != nil {
    // handle `err`
  }

  // do something with `res`
} 
```

Enter fullscreen mode Exit fullscreen mode

æˆ–è€…å¯èƒ½æ˜¯`os`åŒ…:

```
func main() {
  file, err := os.Open("words.txt")

  if err != nil {
    // handle `err`
  }

  // do something with `file`
} 
```

Enter fullscreen mode Exit fullscreen mode

æ’‡å¼€å®ç°ç»†èŠ‚ä¸è°ˆï¼Œæˆ‘æƒ³çŸ¥é“æ˜¯å¦æœ‰åŠæ³•ç”¨ JavaScript å†™å‡ºè¿™æ ·çš„ä¸œè¥¿ï¼Ÿ

å—¯ï¼Œå°±åƒä»–ä»¬è¯´çš„ï¼Œæœ‰å¿—è€…äº‹ç«Ÿæˆï¼ğŸ˜‚

# æ—¥å¸¸æ‰¿è¯ºç±»åŠŸèƒ½

å¦‚ä»Šï¼Œç±»ä¼¼æ‰¿è¯ºçš„ç¯å¢ƒåœ¨æˆ‘ä»¬ä¸­é—´å¾ˆå¸¸è§ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¯»å– Node.js ä¸­çš„ä¸€ä¸ªæ–‡ä»¶:

```
let util = require("util");
let fs = require("fs");

let read = util.promisify(fs.readFile);

function main() {
  read("./test.js", { encoding: "utf8" })
    .then(file => {
      // do something with `file`
    })
    .catch(err => {
      // handle `err`
    });
}

main(); 
```

Enter fullscreen mode Exit fullscreen mode

ä¹Ÿè®¸ä» API ä¸­è·å–ä¸€äº›æ•°æ®:

```
let url = "https://dog.ceo/api/breeds/image/random";

function main() {
  fetch(url)
    .then(res => res.json())
    .then(res => {
      // do something with `res`
    })
    .catch(err => {
      // handle `err`
    });
}

main(); 
```

Enter fullscreen mode Exit fullscreen mode

ç”±äºå¤©ç”Ÿæ‡’æƒ°ï¼Œæˆ‘ä»¬åˆ›å»ºå‡½æ•°æ¥éšè—ä¸€äº›æ ·æ¿æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»£ç åº“ä¸­ç¼–å†™æ›´å°‘çš„ä»£ç :

```
let readFile = require("./readFile");

function main() {
  readFile("./test.js")
    .then(file => {
      // do something with `file`
    })
    .catch(err => {
      // handle `err`
    });
}

main();

// readFile.js
let util = require("util");
let fs = require("fs");

let read = util.promisify(fs.readFile);

module.exports = path => {
  return read(path, { encoding: "utf8" })
    .then(file => {
      return file;
    })
    .catch(err => {
      throw err;
    });
}; 
```

Enter fullscreen mode Exit fullscreen mode

è¿˜æœ‰:

```
let api = require("./api");

function main() {
  api.getRandomDog()
    .then(res => {
      // do something with `res`
    })
    .catch(err => {
      // handle `err`
    });
}

main();

// api.js
let url = "https://dog.ceo/api/breeds/image/random";

let api = {};

api.getRandomDog = () => {
  return fetch(url)
    .then(res => res.json())
    .catch(err => {
      throw err;
    });
};

module.exports = api; 
```

Enter fullscreen mode Exit fullscreen mode

å°½ç®¡å¦‚æ­¤ï¼Œè¿™é‡Œè¿˜æ˜¯æœ‰å¾ˆå¤šé‡å¤ï¼Œåœ¨è¿™æ®µä»£ç çš„ä¸¤è¾¹éƒ½æœ‰`.then`å’Œ`.catch`ã€‚

ä»–ä»¬è¯´`async` / `await`å¯ä»¥ä¿®å¤è¿™ä¸ªï¼Œæ‰€ä»¥...é‚£æˆ‘ä»¬è¯•è¯•å§ï¼Ÿ

# è½¬æ¢ä¸º`async` / `await`

æ¥çœ‹çœ‹æˆ‘ä»¬çš„ Node.js åœ¨`async` / `await` :
åšçš„æ€ä¹ˆæ ·

```
let readFile = require("./readFile");

async function main() {
  try {
    let res = await readFile("./test.js");
    // do something with `file`
  } catch (err) {
    // handle `err`
  }
}

main();

// readFile.js
let util = require("util");
let fs = require("fs");

let read = util.promisify(fs.readFile);

module.exports = async path => {
  try {
    let res = await read(path, { encoding: "utf8" });
    return res;
  } catch (err) {
    throw err;
  }
}; 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬æ€æ ·æ‰èƒ½ç”¨å®ƒæ¥æ‰¾å›æˆ‘ä»¬çš„ç‹—

```
let api = require("./api");

async function main() {
  try {
    let res = await api.getRandomDog();
    // do something with `res`
  } catch (err) {
    // handle `err`
  }
}

main();

// api.js
let url = "https://dog.ceo/api/breeds/image/random";

let api = {};

api.getRandomDog = async () => {
  try {
    let res = await fetch(url);
    let json = await res.json();
    return json;
  } catch (err) {
    throw err;
  }
};

module.exports = api; 
```

Enter fullscreen mode Exit fullscreen mode

å’³...æˆ‘æƒ³æˆ‘ä»¬ç”¨å¦ä¸€ä¸ªé—®é¢˜æ”¹å˜äº†ä¸€ä¸ªé—®é¢˜ã€‚ç°åœ¨ä¸¤ä¸ªåœ°æ–¹éƒ½æœ‰`try...catch`ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬å½“å‰çš„æ¶ˆè´¹è€…/æœåŠ¡ç•Œé¢ï¼Œæˆ‘ä»¬å·²ç»:

1.  åœ¨æˆ‘ä»¬çš„`main()`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªâ€œæœåŠ¡â€( **readFile** å’Œ **api)ã€‚**
2.  æˆ‘ä»¬çš„â€œæœåŠ¡â€å‡½æ•°è¿”å›ä¸€ä¸ª`Promise`
3.  å½“å®Œæˆæ—¶ï¼Œæˆ‘ä»¬çš„æœåŠ¡**è¿”å›**ä¸€ä¸ªæœ‰æ•ˆè½½è·
4.  å½“è¢«æ‹’ç»æ—¶ï¼Œæˆ‘ä»¬çš„æœåŠ¡**æŠ›å‡º**ä¸€ä¸ªé”™è¯¯

å—¯ï¼ˆè¡¨ç¤ºè¸Œèº‡ç­‰ï¼‰...ä¹Ÿè®¸è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼å¯¹äºæ»¡è¶³å’Œæ‹’ç»çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„æ¶ˆè´¹è€…/æœåŠ¡ä¹‹é—´çš„æ¥å£**ä¸åŒ**ã€‚

åˆ·æ–°æˆ‘ä»¬å¯¹ [Go](http://golang.org/) çš„è®°å¿†ï¼Œä¾‹å¦‚é¡¶éƒ¨çš„

```
 func main() {
  res, err := http.Get("http://example.com/")

  if err != nil {
    // handle `err`
  }

  // do something with `res`
} 
```

Enter fullscreen mode Exit fullscreen mode

çœ‹èµ·æ¥æˆ‘ä»¬å¯¹æ»¡è¶³å’Œæ‹’ç»åœºæ™¯éƒ½æœ‰ç›¸åŒçš„æ¥å£ã€‚

è®©æˆ‘ä»¬ç”¨ä¸Šä¸€ä¸ª`async` / `await`ä¾‹å­æ¥è¯•è¯•å§ï¼

# ä¸`async` / `await`ç»Ÿä¸€è¿”å›ç•Œé¢

åœ¨æˆ‘ä»¬çš„ Node.js ç¤ºä¾‹ä¸­:

```
let readFile = require("./readFile");

async function main() {
  let [err, file] = await readFile("./test.js");

  if (err) {
    // handle `err`
  }

  // do something with `file`
}

main();

// readFile.js
let util = require("util");
let fs = require("fs");

let read = util.promisify(fs.readFile);

module.exports = async path => {
  try {
    let res = await read(path, { encoding: "utf8" });
    return [null, res];
  } catch (err) {
    return [err, null]
  }
}; 
```

Enter fullscreen mode Exit fullscreen mode

è¿˜æœ‰æˆ‘ä»¬çš„ Fetch API:

```
let api = require("./api");

async function main() {
  let [err, res] = await api.getRandomDog();

  if (err) {
    // handle `err`
  }

  // do something with `res`
}

main();

// api.js
let url = "https://dog.ceo/api/breeds/image/random";

let api = {};

api.getRandomDog = async () => {
  try {
    let res = await fetch(url);
    let json = await res.json();
    return [null, json];
  } catch (err) {
    return [err, null]
  }
};

module.exports = api; 
```

Enter fullscreen mode Exit fullscreen mode

å¹²å¾—å¥½ï¼ï¼ğŸ‰ğŸ‰ğŸ‰

é‚£æ­£æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼æˆ‘ä»¬çš„`main()`å‡½æ•°çœ‹èµ·æ¥åƒæˆ‘ä»¬çš„ Go ç¤ºä¾‹ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»åœ¨â€œæœåŠ¡â€å‡½æ•°ä¸­éš”ç¦»äº†æ‰€æœ‰çš„`try...catch`ã€‚

ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥æ¸…ç† Node.js ä¸­é—´ä»¶/æ§åˆ¶å™¨ï¼Œåœ¨ä½ çš„å‰ç«¯ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨ React/Reduxï¼Œæ¸…ç†`redux-thunks`æˆ–`redux-saga`å‡½æ•°/ç”Ÿæˆå™¨ã€‚

æ‚¨è¿˜å¯ä»¥å•ç‹¬å¯¹è¿™äº›â€œæœåŠ¡â€åŠŸèƒ½è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¹¶ä¿è¯å®ƒä»¬è¿”å›é¢„æœŸçš„æ¥å£/æ•°æ®ã€‚