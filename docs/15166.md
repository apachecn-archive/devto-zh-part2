# å¦‚ä½•ç”¨ Swift å’Œ Pusher åˆ›å»ºå®æ—¶åœ°å›¾

> åŸæ–‡:[https://dev . to/neo/how-to-build-a-real-time-map-with-swift-and-pusher-1 OCP](https://dev.to/neo/how-to-build-a-realtime-map-with-swift-and-pusher--1ocp)

å®æ—¶åœ°å›¾ç°åœ¨éå¸¸æµè¡Œã€‚å°¤å…¶æ˜¯ç°åœ¨æœ‰è®¸å¤šæŒ‰éœ€è¿è¾“æœåŠ¡ï¼Œå¦‚ä¼˜æ­¥å’Œ Lyftï¼Œéƒ½æœ‰å®æ—¶ä½ç½®æŠ¥å‘Šã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Pusher åœ¨ iOS ä¸Šæ„å»ºå®æ—¶åœ°å›¾ã€‚

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰è¦æ±‚:

*   ä¸€å° MacBook (Xcode åªèƒ½åœ¨ Mac ä¸Šè¿è¡Œ)ã€‚
*   å®‰è£…åœ¨æ‚¨æœºå™¨ä¸Šçš„ Xcode ã€‚
*   JavaScript çŸ¥è¯†(Node.js)ã€‚
*   Swift å’Œ Xcode ä½¿ç”¨çŸ¥è¯†ã€‚è¿™é‡Œå¯ä»¥å¼€å§‹[ã€‚](https://developer.apple.com/library/content/referencelibrary/GettingStarted/DevelopiOSAppsSwift/)
*   æœ¬åœ°å®‰è£…çš„ [NPM å’Œ Node.js](https://docs.npmjs.com/getting-started/installing-node) ã€‚
*   æœ¬åœ°å®‰è£…çš„åŒ…ç®¡ç†å™¨ã€‚
*   ä¸€ä¸ªè°·æ­Œ iOS API å¯†é’¥ã€‚å‚è§[æ­¤å¤„](https://developers.google.com/maps/documentation/ios-sdk/start#step_4_get_an_api_key)è·å–å¦‚ä½•è·å–å¯†é’¥çš„è¯´æ˜ã€‚
*   æ¨é€åº”ç”¨ç¨‹åºã€‚åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªã€‚

å‡è®¾ä½ æœ‰æ‰€æœ‰çš„è¦æ±‚ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚è¿™æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºçš„å†…å®¹çš„å±å¹•è®°å½•:

[![](../Images/2fa3303c681c3bbd6a679987bea96d3d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JLZ8aere--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://blog.pusher.com/wp-content/uploads/2017/12/realtime-map-ios-pusher.gif)

æ­£å¦‚æ‚¨åœ¨æ¼”ç¤ºä¸­çœ‹åˆ°çš„ï¼Œæ¯æ¬¡ä½ç½®æ›´æ–°æ—¶ï¼Œè¿™ç§å˜åŒ–éƒ½ä¼šåæ˜ åœ¨ä¸¤å°è®¾å¤‡ä¸Šã€‚è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦å¤åˆ¶çš„ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

## [](#setting-up-our-ios-application)è®¾ç½®æˆ‘ä»¬çš„ iOS åº”ç”¨

å¯åŠ¨ Xcode å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„â€œå•åº”ç”¨ç¨‹åºâ€é¡¹ç›®ã€‚ä½ å¯ä»¥éšæ„ç§°å‘¼è¿™ä¸ªé¡¹ç›®ã€‚

[![](../Images/ddc79bb0455206b0a8df8c7b2f1940c2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--had8i_JO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.pusher.com/wp-content/uploads/2017/12/realtime-map-ios-pusher-2-1024x532.png)

åˆ›å»ºé¡¹ç›®åï¼Œå…³é—­ Xcodeã€‚æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œ`cd`åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆå§‹åŒ–é¡¹ç›®ä¸Šçš„ cocoa pods:

```
 $ pod init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„å‘½ä»¤å°†åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`Podfile`ã€‚åœ¨è¿™ä¸ª`Podfile`ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å®šæˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–å…³ç³»ï¼Œå¹¶è®© Cocoapods æ‹‰å–å’Œç®¡ç†å®ƒä»¬ã€‚æ‰“å¼€`Podfile`ï¼Œå°†æ–‡ä»¶å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹:

```
 platform :ios, '10.0'
    target 'application_name' do
      use_frameworks!

      pod 'GoogleMaps'
      pod 'Alamofire', '~> 4.4.0'
      pod 'PusherSwift', '~> 4.1.0'
    end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> âš ï¸ **ç”¨ä½ çš„åº”ç”¨ç¨‹åºçš„åå­—æ›¿æ¢** `**application_name**` **ã€‚**

è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¼€å§‹å®‰è£…æˆ‘ä»¬åœ¨`Podfile` :
ä¸­æŒ‡å®šçš„åŒ…

```
 $ pod install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…å®Œæˆåï¼Œæ‰“å¼€æ·»åŠ åˆ°åº”ç”¨ç¨‹åºç›®å½•æ ¹ç›®å½•çš„`*.xcworkspace`æ–‡ä»¶ã€‚è¿™åº”è¯¥ä¼šå¯åŠ¨ Xcodeã€‚

## [](#setting-up-our-nodejs-simulator-app)è®¾ç½®æˆ‘ä»¬çš„ Node.js æ¨¡æ‹Ÿå™¨åº”ç”¨

åœ¨å›åˆ°æˆ‘ä»¬çš„ iOS åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºå°†å‘ Pusher å‘é€å¸¦æœ‰æ•°æ®çš„äº‹ä»¶ã€‚å‘é€åˆ°æ¨è¿›å™¨çš„æ•°æ®å°†æ˜¯æ¨¡æ‹Ÿçš„ GPS åæ ‡ã€‚å½“æˆ‘ä»¬çš„ iOS åº”ç”¨ç¨‹åºä» Pusher è·å–äº‹ä»¶æ•°æ®æ—¶ï¼Œå®ƒä¼šå°†åœ°å›¾æ ‡è®°æ›´æ–°åˆ°æ–°çš„åæ ‡ã€‚

åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•æ¥ä¿å­˜æˆ‘ä»¬çš„ Node.js åº”ç”¨ç¨‹åºã€‚æ‰“å¼€ç»ˆç«¯å¹¶`cd`åˆ° Node.js åº”ç”¨ç¨‹åºçš„ç›®å½•ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„`package.json`æ–‡ä»¶ã€‚æ‰“å¼€è¯¥æ–‡ä»¶å¹¶ç²˜è´´ä¸‹é¢çš„ JSON:

```
 {
      "main": "index.js",
      "dependencies": {
        "body-parser": "^1.16.0",
        "express": "^4.14.1",
        "pusher": "^1.5.1"
      }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ä½œä¸ºä¾èµ–é¡¹åˆ—å‡ºçš„ NPM è½¯ä»¶åŒ…:

```
 $ npm run install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„`index.js`æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç ç²˜è´´åˆ°æ–‡ä»¶ä¸­:

```
 //
    // Load the required libraries
    //
    let Pusher     = require('pusher');
    let express    = require('express');
    let bodyParser = require('body-parser');

    //
    // initialize express and pusher
    //
    let app        = express();
    let pusher     = new Pusher(require('./config.js'));

    //
    // Middlewares
    //
    app.use(bodyParser.json());
    app.use(bodyParser.urlencoded({ extended: false }));

    //
    // Generates 20 simulated GPS coords and sends to Pusher
    //
    app.post('/simulate', (req, res, next) => {
      let loopCount = 0;
      let operator = 0.001000  
      let longitude = parseFloat(req.body.longitude)
      let latitude  = parseFloat(req.body.latitude)

      let sendToPusher = setInterval(() => {
        loopCount++;

        // Calculate new coordinates and round to 6 decimal places...
        longitude = parseFloat((longitude + operator).toFixed(7))
        latitude  = parseFloat((latitude - operator).toFixed(7))

        // Send to pusher
        pusher.trigger('mapCoordinates', 'update', {longitude, latitude})

        if (loopCount === 20) {
          clearInterval(sendToPusher)
        }
      }, 2000);
      res.json({success: 200})
    })

    //
    // Index
    //
    app.get('/', (req, res) => {
      res.json("It works!");
    });

    //
    // Error Handling
    //
    app.use((req, res, next) => {
        let err = new Error('Not Found');
        err.status = 404;
        next(err);
    });

    //
    // Serve app
    //
    app.listen(4000, function() {
        console.log('App listening on port 4000!')
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ Express åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å·²ç»åˆå§‹åŒ–äº† Express `app`å’Œ`pusher`å®ä¾‹ã€‚åœ¨`/simulate`è·¯çº¿ä¸­ï¼Œæˆ‘ä»¬ä»¥ 2 ç§’çš„é—´éš”è·‘ä¸€åœˆï¼Œå¹¶åœ¨è·‘å®Œç¬¬ 20 åœˆååœæ­¢ã€‚æ¯æ¬¡å¾ªç¯è¿è¡Œæ—¶ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„ GPS åæ ‡å¹¶å‘é€ç»™ Pusherã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„`config.js`æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç ç²˜è´´åˆ°å…¶ä¸­:

```
 module.exports = {
        appId: 'PUSHER_APP_ID',
        key: 'PUSHER_APP_KEY',
        secret: 'PUSHER_APP_SECRET',
        cluster: 'PUSHER_APP_CLUSTER',
    }; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`*PUSHER_APP_ID*`ã€`*PUSHER_APP_KEY*`ã€`PUSHER_APP_SECRET`å’Œ`PUSHER_APP_CLUSTER`çš„å€¼æ›¿æ¢ä¸ºæ¨åŠ¨å™¨åº”ç”¨ä»ªè¡¨æ¿ä¸­çš„å€¼ã€‚æˆ‘ä»¬çš„ Node.js åº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè§¦å‘ GPS åæ ‡æ—¶æ¨¡æ‹Ÿå®ƒäº†ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®Œæˆäº† Node.js åº”ç”¨ç¨‹åºçš„åˆ›å»ºï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ›å»º iOS åº”ç”¨ç¨‹åºäº†ã€‚

## åœ¨ Xcode ä¸­åˆ›å»ºæˆ‘ä»¬çš„å®æ—¶åœ°å›¾è§†å›¾

ç”¨æˆ‘ä»¬çš„é¡¹ç›®é‡æ–°æ‰“å¼€ Xcode å¹¶æ‰“å¼€`Main.storyboard`æ–‡ä»¶ã€‚åœ¨`ViewController`ä¸­æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª`UIView`ï¼Œåœ¨`UIView`ä¸­æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ¨¡æ‹ŸæŒ‰é’®ã€‚å¤§æ¦‚æ˜¯è¿™æ ·çš„:

[![](../Images/f8408290613ea32e930899262896539d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--9hVRvq22--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.pusher.com/wp-content/uploads/2017/12/realtime-map-ios-pusher-3-866x600.png)

ä»æŒ‰é’®åˆ°`ViewController`åˆ›å»ºä¸€ä¸ª`@IBAction`ã€‚ä¸ºæ­¤ï¼Œç‚¹å‡» Xcode å·¥å…·é›†å³ä¸Šè§’çš„â€œæ˜¾ç¤ºåŠ©ç†ç¼–è¾‘å™¨â€ã€‚è¿™å°†æŠŠå±å¹•åˆ†æˆæ•…äº‹æ¿å’Œä»£ç ç¼–è¾‘å™¨ã€‚ç°åœ¨å°†`ctrl`ä»æŒ‰é’®ä¸­æ‹–åˆ°ä»£ç ç¼–è¾‘å™¨ä¸­æ¥åˆ›å»º`@IBAction`ã€‚æˆ‘ä»¬å°†ç§°è¿™ä¸ªæ–¹æ³•ä¸º`simulateMovement`ã€‚

[![](../Images/962a52a050a2cf2a09ad834b11d910e2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Sqh9RE1M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.pusher.com/wp-content/uploads/2017/12/realtime-map-ios-pusher-4-964x600.png)

æ¥ä¸‹æ¥ï¼Œç‚¹å‡» Xcode å·¥å…·æ ä¸Šçš„â€œæ˜¾ç¤ºæ ‡å‡†ç¼–è¾‘å™¨â€æŒ‰é’®ï¼Œå…³é—­åˆ†å±ï¼Œåªæ˜¾ç¤º`Main.storyboard`ã€‚ä»æœ€åä¸€ä¸ª`UIView`çš„åº•éƒ¨å¼€å§‹æ·»åŠ å¦ä¸€ä¸ª`UIView`åˆ°å±å¹•åº•éƒ¨ã€‚è¯¥è§†å›¾å°†æ˜¾ç¤ºåœ°å›¾ã€‚

åœ¨â€œèº«ä»½æ£€æŸ¥å™¨â€ä¸­å°†`UIView`çš„è‡ªå®šä¹‰ç±»è®¾ç½®ä¸º`GMSMapView`ã€‚ç°åœ¨ç‚¹å‡» Xcode å·¥å…·é›†å³ä¸Šè§’çš„â€œæ˜¾ç¤ºåŠ©ç†ç¼–è¾‘å™¨â€ã€‚`ctrl`å¹¶ä»`UIView`ä¸­æ‹–æ‹½åˆ°ä»£ç ç¼–è¾‘å™¨ä¸­ã€‚åˆ›å»ºä¸€ä¸ª`@IBOutlet`ï¼Œå‘½åä¸º`mapView`ã€‚

ç‚¹å‡» Xcode å·¥å…·æ ä¸Šçš„â€œæ˜¾ç¤ºæ ‡å‡†ç¼–è¾‘å™¨â€æŒ‰é’®ï¼Œå…³é—­åˆ†å‰²è§†å›¾ã€‚æ‰“å¼€`ViewController`æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢å†…å®¹:

```
 //
    // Import libraries
    //
    import UIKit
    import PusherSwift
    import Alamofire
    import GoogleMaps

    //
    // View controller class
    //
    class ViewController: UIViewController, GMSMapViewDelegate {
        // Marker on the map
        var locationMarker: GMSMarker!

        // Default starting coordinates
        var longitude = -122.088426
        var latitude  = 37.388064

        // Pusher
        var pusher: Pusher!

        // Map view
        @IBOutlet weak var mapView: GMSMapView!

        //
        // Fires automatically when the view is loaded
        //
        override func viewDidLoad() {
            super.viewDidLoad()

            //
            // Create a GMSCameraPosition that tells the map to display the coordinate
            // at zoom level 15.
            //
            let camera = GMSCameraPosition.camera(withLatitude:latitude, longitude:longitude, zoom:15.0)
            mapView.camera = camera
            mapView.delegate = self

            //
            // Creates a marker in the center of the map.
            //
            locationMarker = GMSMarker(position: CLLocationCoordinate2D(latitude: latitude, longitude: longitude))
            locationMarker.map = mapView

            //
            // Connect to pusher and listen for events
            //
            listenForCoordUpdates()
        }

        //
        // Send a request to the API to simulate GPS coords
        //
        @IBAction func simulateMovement(_ sender: Any) {
            let parameters: Parameters = ["longitude":longitude, "latitude": latitude]

            Alamofire.request("http://localhost:4000/simulate", method: .post, parameters: parameters).validate().responseJSON { (response) in
                switch response.result {
                case .success(_):
                    print("Simulating...")
                case .failure(let error):
                    print(error)
                }
            }
        }

        //
        // Connect to pusher and listen for events
        //
        private func listenForCoordUpdates() {
            // Instantiate Pusher
            pusher = Pusher(key: "PUSHER_APP_KEY", options: PusherClientOptions(host: .cluster("PUSHER_APP_CLUSTER")))

            // Subscribe to a Pusher channel
            let channel = pusher.subscribe("mapCoordinates")

            //
            // Listener and callback for the "update" event on the "mapCoordinates"
            // channel on Pusher
            //
            channel.bind(eventName: "update", callback: { (data: Any?) -> Void in
                if let data = data as? [String: AnyObject] {
                    self.longitude = data["longitude"] as! Double
                    self.latitude  = data["latitude"] as! Double

                    //
                    // Update marker position using data from Pusher
                    //
                    self.locationMarker.position = CLLocationCoordinate2D(latitude: self.latitude, longitude: self.longitude)
                    self.mapView.camera = GMSCameraPosition.camera(withTarget: self.locationMarker.position, zoom: 15.0)
                }
            })

            // Connect to pusher
            pusher.connect()
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„æ§åˆ¶å™¨ç±»ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†æ‰€æœ‰éœ€è¦çš„åº“ã€‚ç„¶åæˆ‘ä»¬å®ä¾‹åŒ–è¿™ä¸ªç±»çš„ä¸€äº›å±æ€§ã€‚åœ¨`viewDidLoad`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†`mapView`ä¸Šçš„åæ ‡ï¼Œå¹¶ç»™å®ƒæ·»åŠ äº†`locationMarker`ã€‚

ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è°ƒç”¨`listenForCoordUpdates()`ã€‚åœ¨`listenForCoordUpdates`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ° Pusher çš„è¿æ¥ï¼Œå¹¶ç›‘å¬`mapCoordinates`é€šé“ä¸Šçš„`update`äº‹ä»¶ã€‚

å½“`update`äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå›è°ƒè·å–æ–°çš„åæ ‡å¹¶ç”¨å®ƒä»¬æ›´æ–°`locationMarker`ã€‚è¯·è®°ä½ï¼Œæ‚¨éœ€è¦å°†`PUSHER_APP_KEY`å’Œ`PUSHER_APP_CLUSTER`æ›´æ”¹ä¸ºæ‚¨çš„æ¨åŠ¨å™¨åº”ç”¨æä¾›çš„å®é™…å€¼ã€‚

åœ¨`simulateMovement`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å‘æœ¬åœ° web æœåŠ¡å™¨(æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ Node.js åº”ç”¨ç¨‹åº)å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚è¯¥è¯·æ±‚å°†æŒ‡ç¤º Node.js åº”ç”¨ç¨‹åºç”Ÿæˆå‡ ä¸ª GPS åæ ‡ã€‚

> ğŸ’¡**æˆ‘ä»¬æ”»å‡»çš„ç«¯ç‚¹çš„ URL([http://localhost:3000/simulate](http://localhost:3000/simulate))æ˜¯ä¸€ä¸ªæœ¬åœ° web æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€åœ¨æ„å»ºçœŸå®æ¡ˆä¾‹æ—¶ï¼Œæ‚¨å°†éœ€è¦æ›´æ”¹ç«¯ç‚¹ URLã€‚**

## [](#configuring-google-maps-for-ios)ä¸º iOS é…ç½®è°·æ­Œåœ°å›¾

æˆ‘ä»¬éœ€è¦é…ç½® Google Maps iOS SDK æ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚é¦–å…ˆï¼Œ[åˆ›å»ºä¸€ä¸ª Google iOS SDK å¯†é’¥](https://developers.google.com/maps/documentation/ios-sdk/start#step_4_get_an_api_key)ï¼Œç„¶åï¼Œå½“æ‚¨æœ‰äº† API å¯†é’¥åï¼Œåœ¨ Xcode ä¸­æ‰“å¼€`AppDelegate.swift`æ–‡ä»¶ã€‚

åœ¨ç±»ä¸­ï¼ŒæŸ¥æ‰¾ä¸‹é¢çš„ç±»:

```
 func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        // Override point for customization after application launch.
        return true
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶æ›¿æ¢ä¸º:

```
 func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        GMSServices.provideAPIKey("GOOGLE_IOS_API_KEY")
        return true
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> ğŸ’¡**ä½ éœ€è¦æŠŠ** `**GOOGLE_IOS_API_KEY**` **æ›¿æ¢æˆä½ åˆ›å»º Google iOS API å¯†é’¥æ—¶å¾—åˆ°çš„å¯†é’¥ã€‚**

åœ¨åŒä¸€ä¸ªæ–‡ä»¶çš„é¡¶éƒ¨ï¼ŒæŸ¥æ‰¾`import UIKit`ï¼Œå¹¶åœ¨å®ƒä¸‹é¢æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
 import GoogleMaps 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†åœ¨ iOS ä¸Šé…ç½®è°·æ­Œåœ°å›¾çš„å·¥ä½œã€‚

## [](#testing-our-realtime-ios-map)æµ‹è¯•æˆ‘ä»¬çš„å®æ—¶ iOS åœ°å›¾

ä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºï¼ŒæŒ‡ç¤º iOS å…è®¸è¿æ¥åˆ°æœ¬åœ° web æœåŠ¡å™¨ï¼Œç„¶åè¿è¡Œæˆ‘ä»¬çš„ iOS åº”ç”¨ç¨‹åºã€‚

è¦è¿è¡Œ Node.js åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨æ‚¨çš„ç»ˆç«¯å°†`cd`æ·»åŠ åˆ° Node.js åº”ç”¨ç¨‹åºç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Node åº”ç”¨ç¨‹åº:

```
 $ node index.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›æœ€åçš„æ›´æ”¹ï¼Œè¿™æ ·æˆ‘ä»¬çš„ iOS åº”ç”¨ç¨‹åºå°±å¯ä»¥è¿æ¥åˆ°æˆ‘ä»¬çš„`localhost`åç«¯ã€‚åœ¨ Xcode ä¸­æ‰“å¼€`info.plist`æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œä»¥ä¸‹è°ƒæ•´:

[![](../Images/7967867d2e6531cdf0510f53e8883553.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--czPkQ-Xh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.pusher.com/wp-content/uploads/2017/12/realtime-map-ios-pusher-5-1001x600.png)

è¿™ä¸€æ›´æ”¹å°†ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¿æ¥åˆ°æœ¬åœ°ä¸»æœºã€‚æ˜ç¡®åœ°è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸éœ€è¦è¿™ä¸€æ­¥ã€‚

ç°åœ¨æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥çœ‹åˆ° iOS åº”ç”¨ç¨‹åºç°åœ¨æ˜¾ç¤ºäº†åœ°å›¾å’Œåœ°å›¾ä¸Šçš„æ ‡è®°ã€‚ç‚¹å‡»æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»ç«¯ç‚¹ï¼Œç„¶åå°†æ–°åæ ‡å‘é€ç»™ Pusherã€‚æˆ‘ä»¬çš„ä¾¦å¬å™¨æ•æ‰äº‹ä»¶å¹¶æ›´æ–°`locationMarker`ï¼Œä»è€Œç§»åŠ¨æˆ‘ä»¬çš„æ ‡è®°ã€‚

## [](#conclusion)ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ Pusher å’Œ Swift åœ¨ iOS ä¸Šæ„å»ºå®æ—¶åœ°å›¾ã€‚å¸Œæœ›ä½ å­¦åˆ°äº†ä¸€äº›å¦‚ä½•åˆ›å»ºå®æ—¶ iOS åº”ç”¨ç¨‹åºçš„ä¸œè¥¿ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨ä¸‹é¢ç•™ä¸‹è¯„è®ºã€‚

æœ¬æ•™ç¨‹çš„æºä»£ç å¯ä»¥åœ¨ [GitHub](https://github.com/neoighodaro/Sample-Realtime-Map-on-iOS) ä¸Šè·å¾—ã€‚

è¿™ç¯‡æ–‡ç« æœ€åˆå‡ºç°åœ¨ [Pusher åšå®¢](https://blog.pusher.com/realtime-map-swift-pusher/)ä¸Šã€‚