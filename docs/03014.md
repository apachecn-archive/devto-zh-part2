# ä½¿ç”¨@react-firebase ä»¥å£°æ˜æ–¹å¼å‘ˆç°æ‚¨çš„ Firebase èº«ä»½éªŒè¯ã€æ•°æ®åº“å’Œ Firestore æ•°æ®ã€‚

> åŸæ–‡:[https://dev . to/rakan nimer/declarative ly-render-your-firebase-auth-database-firestore-data-with-react-firebase-52b 6](https://dev.to/rakannimer/declaratively-render-your-firebase-auth-database--firestore-data-with-react-firebase-52b6)

## TLDRï¼›

å‘å¸ƒ@react-firebase æ˜¯ä¸ºäº†è®©åœ¨ react åº”ç”¨ä¸­é›†æˆ firebase å¿«é€Ÿ&å˜å¾—å®¹æ˜“ğŸ‰ã€‚

å¦‚æœä½ ä½¿ç”¨ React & Firebaseï¼Œå»[æ£€æŸ¥ä¸€ä¸‹](https://react-firebase-js.com)ï¼

## åŠ é•¿ç‰ˆ

I â¤ï¸ Firebase & React ä½†æ˜¯è®©ä»–ä»¬å’Œå…¶ä»–è´¡çŒ®è€…ä¸€èµ·å¼€å‘ç›¸å¯¹è¾ƒå¤§çš„ä»£ç åº“å¾€å¾€ä¼šå¯¼è‡´:

1.  ğŸä»£ç åº“ä¸­ä¸å¿…è¦çš„å¤æ‚æ€§
2.  ğŸ›è®¢é˜…ç®¡ç†å’Œèµ„æºé—´ä¾èµ–çš„ç»†å¾®é”™è¯¯ã€‚
3.  ğŸƒå½“ä½ çš„ç”¨æˆ·ç•Œé¢ä¸éœ€è¦çš„æ—¶å€™ï¼Œåƒµå°¸ç›‘å¬å™¨ä¼šä¸€ç›´åœ¨ä½ èº«è¾¹ã€‚

[`@react-firebase`](https://react-firebase-js.com) æä¾›å°å‹ã€ç±»å‹åŒ–ã€ç»è¿‡è‰¯å¥½æµ‹è¯•çš„å¯ç»„åˆç»„ä»¶ï¼Œå…è®¸åœ¨ React æˆ– React æœ¬æœºåº”ç”¨ç¨‹åºä¸­è½»æ¾é›†æˆ Firebase Authã€å®æ—¶æ•°æ®åº“å’Œ/æˆ– Firestoreã€‚

## æ¦‚è¿°

`@react-firebase/auth`ã€`@react-firebase/database`ã€`@react-firebase/firestore`å‡ºå£`Provider`å’Œ`Consumer`ç»„ä»¶ã€‚

### æä¾›è€…

`Provider`ç»„ä»¶æ¥å—`firebase`å’Œ firebase é…ç½®é€‰é¡¹é“å…·ï¼Œåº”è¯¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æ¸²æŸ“ä¸€æ¬¡ï¼Œä½œä¸ºä½ çš„`Consumer`ç»„ä»¶çš„ç¥–å…ˆã€‚

#### å¦‚ä½•è·å¾—æˆ‘çš„ Firebase é…ç½®ï¼Ÿ

##### Web æˆ– React Native ä¸ Expo

å¦‚æœä½ ç”¨çš„æ˜¯ [firebase](https://www.npmjs.com/package/firebase)

å°†`PROJECT_NAME`æ›´æ”¹ä¸ºæ‚¨çš„é¡¹ç›®åç§°ï¼Œå¹¶åœ¨æ­¤è·å–æ‚¨çš„ firebase é…ç½®:

`https://console.firebase.google.com/project/PROJECT_NAME/settings/general/`

å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

```
// Firebase Config
const config = {
  apiKey: "API_KEY",
  projectId: "PROJECT_ID",
  databaseURL: "DATABASE_URL",
  authDomain: "AUTH_DOMAIN",
  // OPTIONAL
  storageBucket: "STORAGE_BUCKET",
  messagingSenderId: "MESSAGING_SENDER_ID"
}; 
```

##### ååº”åŸç”Ÿç«åŸº

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ [react-native-firebase](https://rnfirebase.com) ï¼Œé‚£ä¹ˆä½ åªéœ€è¦ä¼ å…¥ä½ çš„ firebase ç‰ˆæœ¬ä½œä¸ºé“å…·(firebase åº”ç”¨å·²ç»åœ¨åŸç”Ÿç«¯åˆå§‹åŒ–äº†ã€‚)

### æä¾›å•†ç¤ºä¾‹

```
import * as firebase from "firebase/app";

import "firebase/auth";
import { FirebaseAuthProvider } from "@react-firebase/auth";

// And or
import { FirebaseDatabaseProvider } from "@react-firebase/database";
import "firebase/database";

// And or
import "firebase/firestore";
import { FirestoreProvider } from "@react-firebase/firestore"; 
```

```
<FirebaseAuthProvider firebase={firebase} {...config}>
  <MyApp1 />
  <MyApp2 />
</FirebaseAuthProvider> 
```

### æ¶ˆè´¹è€…

æ¯ä¸ªæ¨¡å—éƒ½å¯¼å‡ºå°†æ¶ˆè´¹å’Œååº”çš„æ¶ˆè´¹ç»„ä»¶(ğŸ˜…)æ¥æ¿€å‘åŸºæœ¬å˜åŒ–ã€‚

æ‰€æœ‰æ¶ˆè´¹è€…ç»„ä»¶éƒ½æœŸæœ›å®ƒä»¬çš„`children`å±æ€§æ˜¯ä¸€ä¸ªååº”èŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªè¿”å›ååº”èŠ‚ç‚¹çš„åŒæ­¥å‡½æ•°ã€‚(ä¸‹é¢æ˜¯ç‰¹å®šäºåº“çš„ç¤ºä¾‹ğŸ‘‡)

#### Firebase æˆæƒæ¶ˆè´¹è€…

##### `FirebaseAuthConsumer`

åœ¨åº”ç”¨ç¨‹åºç»„ä»¶æ ‘ä¸­çš„ä»»ä½•ä½ç½®ï¼Œæ·»åŠ ä¸€ä¸ª FirebaseAuthConsumerï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·çš„èº«ä»½éªŒè¯çŠ¶æ€æ”¹å˜æ—¶ç›‘å¬å’Œæ›´æ–° uiã€‚

```
<FirebaseAuthConsumer>
  {({ isSignedIn, user, providerId }) => {
    return isSigned ? (
      <pre style={{ height: 300, overflow: "auto" }}>
        {JSON.stringify({ isSignedIn, user, providerId }, null, 2)}
      </pre>
    ) : <div>Not signed in.</div>;
  }}
</FirebaseAuthConsumer> 
```

##### [è®¤è¯ API å¼•ç”¨](https://react-firebase-js.com/docs/react-firebase-auth/api)

#### Firebase æ•°æ®åº“æ¶ˆè´¹è€…

##### è¯»å–æ•°æ®

###### `FirebaseDatabaseNode`

åœ¨åº”ç”¨ç¨‹åºç»„ä»¶æ ‘ä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œæ·»åŠ ä¸€ä¸ª`FirebaseDatabaseNode`æ¥ç›‘å¬å’Œæ›´æ–° uiï¼Œå½“æ•°æ®åœ¨æä¾›çš„è·¯å¾„ä¸Šæ”¹å˜æ—¶ã€‚

```
<FirebaseDatabaseNode path={"user_bookmarks/BOOKMARK_ID"}>
  {({ value, isLoading }) => {
    return (
      <pre>
        {JSON.stringify({ value, isLoading })}
      </pre>
    );
  }}
</FirebaseDatabaseNode> 
```

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ‰€æœ‰æ”¯æŒçš„ Firebase å®æ—¶æ•°æ®åº“æ“ä½œç¬¦æ¥æŸ¥è¯¢æ‚¨çš„ Firebase æ•°æ®:

```
<FirebaseDatabaseNode path={"user_bookmarks/BOOKMARK_ID"} limitToFirst={10} orderByKey>
  {({ value, isLoading }) => {
    return (
      <pre>
        {JSON.stringify({ value, isLoading })}
      </pre>
    );
  }}
</FirebaseDatabaseNode> 
```

æ‰€æœ‰æ”¯æŒçš„é“å…·ã€‚

##### å†™æ•°æ®

###### [T3`FirebaseDatabaseMutation`T4ã€‘T1ã€‘](#-raw-firebasedatabasemutation-endraw-amp-raw-firebasedatabasetransaction-endraw-)

å˜å¼‚ API çš„çµæ„Ÿæ¥è‡ªäº [apollo-graphql å˜å¼‚](https://www.apollographql.com/docs/react/essentials/mutations.html)ã€‚

å˜å¼‚ç»„ä»¶åˆ†åˆ«å‘å®ƒä»¬çš„å­ç»„ä»¶æ³¨å…¥ä¸€ä¸ª`runMutation`æˆ–`runTransaction`é“å…·ã€‚

`FirebaseDatabaseMutation`ï¼Œé™¤äº†`path`é“å…·è¿˜éœ€è¦ä¸€ä¸ªå˜å¼‚`type`é“å…·ï¼Œå¯ä»¥æ˜¯
ä¹‹ä¸€

```
"set" | "update" | "push"; 
```

###### FirebaseDatabaseMutation ä¾‹å­ã€‚

```
<FirebaseDatabaseMutation path={collectionPath} type="push">
  {({ runMutation }) => (
    <button
      onClick={async () => {
        const { key } = await runMutation(testDocValue);
        if (key === null || typeof key === "undefined") return;
        this.setState(state => ({
          keys: [...state.keys, key]
        }));
      }}
    >
      add-node-with-generated-key
    </button>
  )}
</FirebaseDatabaseMutation> 
```

###### FirebaseDatabaseTransaction ç¤ºä¾‹ã€‚

```
<FirebaseDatabaseTransaction path={path}>
  {({ runTransaction }) => {
    return (
      <div>
        <button
          onClick={() => {
            runTransaction({
              reducer: val => {
                if (val === null) {
                  return 1;
                } else {
                  return val + 1;
                }
              }
            }).then(() => {
              console.log("Ran transaction");
            });
          }}
        >
          Click me to run a transaction
        </button>
      </div>
    );
  }}
</FirebaseDatabaseTransaction> 
```

*   [FirebaseDatabaseMutation API](https://react-firebase-js.com/docs/react-firebase-realtime-database/api#firebasedatabasemutation-props)
*   [FirebaseDatabaseTranasaction API](https://react-firebase-js.com/docs/react-firebase-realtime-database/api#firebasedatabasetransaction-props)

#### Firestore æ•°æ®åº“æ¶ˆè´¹è€…

##### è¯»å–æ•°æ®åŒ`FirestoreDocument` & `FirestoreCollection`

åœ¨åº”ç”¨ç¨‹åºç»„ä»¶æ ‘çš„ä»»ä½•åœ°æ–¹ï¼Œæ·»åŠ ä¸€ä¸ª`FirestoreDocument`æˆ–`FirestoreCollection`æ¥ç›‘å¬æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®æ”¹å˜æ—¶æ›´æ–° uiã€‚

###### `FirestoreDocument`ä¸¾ä¾‹ã€‚

```
const s = v => JSON.stringify(v, null, 2);
const App = () => (
  <FirestoreDocument path={`/user_bookmarks/id`}>
    {({ value, path, isLoading }) => {
      return (
        <div>
          {value && <pre>{s(value)}</pre>}
          {path && <div>{path}</div>}
          <div>{isLoading}</div>
        </div>
      );
    }}
  </FirestoreDocument>
); 
```

###### [`FirestoreDocument` API](https://react-firebase-js.com/docs/react-firestore-database/api#firestoredocument)

`FirestoreCollection`ä¾‹å­

```
<FirestoreCollection path="/user_bookmarks/" limit={5}>
  {d => {
    return <pre>{s(d)}</pre>;
  }}
</FirestoreCollection> 
```

###### [`FirestoreCollection` API](https://react-firebase-js.com/docs/react-firestore-database/api#firestorecollection)

##### ç”¨`FirestoreMutation` & `FirestoreTransaction` & `FirestoreBatchedWrite`å†™æ•°æ®

å˜å¼‚ API çš„çµæ„Ÿæ¥è‡ªäº [apollo-graphql å˜å¼‚](https://www.apollographql.com/docs/react/essentials/mutations.html)ã€‚

å°†`FirestoreMutation` & `FirestoreTransaction`çš„å˜å¼‚æˆåˆ†åˆ†åˆ«æ³¨å…¥ä¸€ä¸ª`runMutation`æˆ–è€…`runTransaction`çš„é“å…·ï¼Œç»™å®ƒä»¬çš„å­©å­ã€‚

`FirestoreMutation`é™¤äº†`path`é“å…·è¿˜éœ€è¦ä¸€ä¸ªçªå˜`type`é“å…·ï¼Œå¯ä»¥æ˜¯
ä¹‹ä¸€

```
"set" | "update" | "add"; 
```

`BatchedWrite`å…¬å¼€äº†ä¸åŒçš„ APIï¼Œå› ä¸ºå®ƒçš„è¡Œä¸ºä¸åŒäºå†™å’Œäº‹åŠ¡ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨`committing`æ›´æ–°ä¹‹å‰è¿è¡Œè®¸å¤šæ›´æ–°ã€‚

å®ƒå°†ä¸¤ä¸ªé“å…·`addMutationToBatch`å’Œ`commit`æ³¨å…¥åˆ°å®ƒçš„å­å…ƒç´ ä¸­ã€‚

*   `addMutationToBatch`

```
type addMutationToBatch = (
  {
    path,
    value,
    type
  }: {
    path: string;
    value: any;
    type: "add" | "update" | "set" | "delete";
  }
) => void; 
```

*   `commit`

```
type commit = () => Promise<void>; 
```

##### `FirestoreMutation`ä¸¾ä¾‹

```
<FirestoreProvider firebase={firebase} {...config}>
  <FirestoreMutation type="set" path={path}>
    {({ runMutation }) => {
      return (
        <div>
          <h2> Mutate state </h2>
          <button
            onClick={async () => {
              const mutationResult = await runMutation({
                nowOnCli: Date.now(),
                nowOnServer: firebase.firestore.FieldValue.serverTimestamp()
              });
              console.log("Ran mutation ", mutationResult);
            }}
          >
            Mutate Set
          </button>
        </div>
      );
    }}
  </FirestoreMutation>
</FirestoreProvider> 
```

##### `FirestoreTranasaction`ä¸¾ä¾‹

```
<FirestoreProvider firebase={firebase} {...config}>
  <FirestoreTransaction>
    {({ runTransaction }) => {
      return (
        <div>
          <button
            data-testid="test-set"
            onClick={async () => {
              await runTransaction(async ({ get, update }) => {
                const res = await get({
                  path
                });
                const data = res.data();
                if (typeof data === "undefined") return;
                await update(path, {
                  ...data,
                  a: isNaN(parseInt(data.a, 10)) ? 1 : data.a + 1
                });
              });
            }}
          >
            runTransaction
          </button>
        </div>
      );
    }}
  </FirestoreTransaction>
</FirestoreProvider> 
```

##### `FirestoreBatchedWrite`ä¸¾ä¾‹

```
<FirestoreBatchedWrite>
  {({ addMutationToBatch, commit }) => {
    return (
      <div>
        <h2>Batched write</h2>
        <button
          onClick={() => {
            console.log("adding to batch");
            addMutationToBatch({
              path,
              value: { [`a-value-${Date.now()}`]: Date.now() },
              type: "set"
            });
          }}
        >
          Add to batch
        </button>
        <button
          onClick={() => {
            console.log("committing to batch");
            commit().then(() => {
              console.log("Committed");
            });
          }}
        >
          Commit batch
        </button>
      </div>
    );
  }}
</FirestoreBatchedWrite> 
```

## èµ„æº

*   [æºä»£ç ](https://github.com/rakannimer/react-firebase)

*   [å¯ç¼–è¾‘æ²™ç®±](https://react-firebase-js.com/docs/try-it-out)

*   [è¯¦ç»†æ•™ç¨‹(WIP)](https://react-firebase-js.com/docs/guides/build-a-react-app-with-firebase-auth-and-realtime-database/setup-the-development-environment)

*   [ä¹¦ç­¾åº”ç”¨ç¤ºä¾‹](https://github.com/rakannimer/react-firebase/tree/master/modules/tutorial-bookmarking-app)

*   [ç”¨ Expo å’Œ Firebase ååº”æœ¬åœ°ç¤ºä¾‹](https://github.com/rakannimer/react-firebase/tree/master/react-native-examples/react-native-expo-firebase-example)

*   [React Native Firebase å¯åŠ¨å™¨ç¤ºä¾‹](https://github.com/rakannimer/react-firebase/tree/master/react-native-examples/react-native-firebase-starter)

## ç›¸å…³å·¥ä½œ

*   [é‡ç½®åŸºç¡€](https://github.com/tylermcginnis/re-base)
*   [redux-firebase](https://github.com/prescottprue/redux-firebase)
*   [react-firestore](https://github.com/green-arrow/react-firestore)
*   ä½ çš„å›¾ä¹¦é¦†ï¼Ÿåœ¨è¿™é‡Œç»™æˆ‘å‘ä¸ª DM æˆ–è€…è¯„è®ºè¡¥å……ä¸€ä¸‹ã€‚

æ„Ÿè°¢ä½ åšæŒåˆ°â¤ï¸é‚®æŠ¥çš„æœ€åï¼

è¿™é‡Œæœ‰å‡ ä¸ªä¸“é—¨ä¸ºæ‚¨å‡†å¤‡çš„é™„åŠ èµ„æº:

*   [ç”Ÿæˆè¿æ¥çš„ JSON æ•°æ®](https://react-firebase-js.com/docs/generate-json-data)
*   [åœ¨ Firebase å®æ—¶æ•°æ®åº“ä¸­ç”Ÿæˆæ•°æ®](https://react-firebase-js.com/docs/generate-firebase-data)
*   [åœ¨ Firebase Firestore æ•°æ®åº“ä¸­ç”Ÿæˆæ•°æ®](https://react-firebase-js.com/docs/generate-firestore-data)