# 具有代码审查指南的 Sane 办公环境

> 原文:[https://dev . to/sandordargo/sane-office-environment-with-code-review-guidelines-3k0h](https://dev.to/sandordargo/sane-office-environment-with-code-review-guidelines-3k0h)

在我的新团队中，我们正在制定一些指导方针、规则和流程改进。为什么我们认为这些如此重要？如果事情被很好地记录下来，新人就更容易开始交付价值。它降低了每个人犯错的可能性。它排除了很多争论的可能性。我们都知道一个人不可能赢得争论，我们应该不惜一切代价避免争论。

关于指南重要性的更详细的观点，请查看本文，顺便说一句，我将很快再看一遍。

这一次我将把重点放在代码审查和相应的指导方针上。

## [](#the-aim-of-the-code-review)代码评审的目的

审查拉取请求是一项重要而敏感的任务。在我看来，这至少和写代码一样重要。此外，审查别人的代码不仅仅是一项技术任务，也是一项人类的任务。这赋予了它大部分的精致。

因此，让我从最重要的规则开始，每当您开始审核拉动式请求或打开您收到的审核时，您都应该牢记这条规则:

***无可奉告应属个人。不得对作者或评论者发表任何评论。审查必须总是关于代码！**T3】*

代码评审的目的是使代码更好，在合并和交付之前检测错误，此外，提高给定代码库的可维护性。

## [](#items-to-be-checked-in-a-code-review)代码评审中需要检查的项目

审查代码是困难的，事实上，这是一个非常广泛的任务。据我的老板说，我被认为是一个优秀的代码审查者，但我仍然认为我的效率可以提高很多。我认为在大多数情况下，遵循清单会有很大的帮助。

很明显，这些清单和/或任务中的一部分是特定语言的。然而，不管使用什么语言，大多数时候是相同的概念，这才是好的评论。

这些列表主要是给你一些想法，它们还远未完成。随意使用它们，更新它们，个性化它们，或者只是让它们激发你想出全新的。

我认为一个评论者不应该使用所有的，但也许只是一些。但是如果你有单独的清单，就很容易分担任务。

请注意，并不是所有的清单都可以用于所有的代码评审。如果拉请求是一个非常小的错误修正，只是纠正一个条件下的一个错误，它不需要检查整个域的设计。

### [](#full-process-checklist)全流程检查表

这一个主要关注拉请求的一些基本特征。我没有添加到列表中，但是您应该确保新的提交不会破坏编译或测试。您的持续集成管道应该注意这一点，但以防万一。别忘了这件事。否则，检查这些。

*   是否添加了新的单元/回归测试？
*   有新的编译器警告吗？
*   功能上的改变有意义吗？
*   依赖性大吗？
*   提交消息干净吗？
*   ...

### [](#solid-objectoriented-design-principles-checklist)固体(面向对象设计)原则检查表

为了验证设计的合理性，有必要浏览一下坚实的原则。很可能值得将这些项目扩展成子列表，以帮助验证每个原则。

*   单一责任原则
*   开/关原则
*   利斯科夫替代原理
*   界面分离原理
*   从属倒置原则
*   ...

### [](#security-checklist)安全检查表

您的应用程序可能是也可能不是安全关键的。一旦它被黑了一次或者因为一些乱七八糟的输入而失败，它就会变成一个...这个清单如果有用的话，应该是非常依赖于语言的，我给你一个 C++的清单。我的一位同事主要从 2018 年 NDC 安全会议上关于安全编程实践的[演讲中摘录](https://www.youtube.com/watch?v=Jh0G_A7iRac)

*   外部输入是否处理得当？
*   是否使用了 C 风格的接口？
*   是否多余使用了`new`运算符来代替堆栈分配？
*   有很多(容易出错的)尺寸计算吗？
*   指针用的多吗？
*   shared_ptrs 用的多吗？
*   有线索吗？
*   ...

### [](#testing-best-practices-checklist)测试最佳实践清单

我希望我们都同意测试是开发人员工作的一部分，如果我们讨论测试，那将是关于做测试的不同方式，而不是我们是否应该做测试。坏消息是没有一种方法适合所有人——我仍然建议你遵循测试驱动开发的周期。好消息是，希望在一个项目上，至少对应该做什么有一个共同的理解。如果没有，介入并提倡测试，收集文章，研究和说服。你会更受尊重。关于测试部分，有几点需要澄清:

*   有足够的单元测试吗？
*   有足够的非回归测试吗？
*   测试测试一样东西吗？
*   他们有主张吗？(一个测试可能有多个断言，但从逻辑上讲，它们仍然断言一件事)
*   它们可读吗？
*   日期是如何使用的？(固定与生成)
*   ...

### [](#code-readability-checklist)代码可读性检查表

我们——开发者——都是作者。如果我们做得无可挑剔，我们的代码读起来会像散文一样。我不是说整个代码库总能达到这个目标，但是我们应该以此为目标。代码审查者在这里有着巨大的责任。如果您正在阅读拉取请求，请思考以下问题:

*   名字有意义吗？
*   类/函数足够小吗？
*   代码“读起来像散文”吗？
*   代码的格式是否良好？
*   是否存在重复代码？
*   ...

### [](#resource-handling-checklist-aka-raii)资源处理清单，又名 [RAII](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)

最后一个是特定于语言的。不仅仅是针对 C++，大部分都是。如果你是一名 C++开发人员，并且曾经与悬空指针、内存泄漏和令人讨厌的核心转储作斗争。你知道我的意思。对于非专业人士来说，发现这些问题可能非常困难，但遵循一个有用的清单可能会帮助您指出有问题的线路，并发展 RAII 专业知识。

*   对象所有权是否明确？
*   对象是否被正确销毁/内存是否被正确释放？
*   新字段是否处理得当？
*   构造函数中的字段初始化正确吗？
*   是否更新了比较运算符？
*   ...

## [](#the-code-of-conduct-for-code-reviewers)代码评审者的行为准则

如前所述，评论别人的代码也是一项人工任务，善待你的开发同事。这里有一些建议，遵循它们将会大大降低开发人员在办公室里哭泣或互相扔椅子的几率。(只是提一下，我没见过后者。迄今为止...)

### [](#donts)不要

*   不要提及个人特质，也不要做出判断(例如，提及你/你的代码很愚蠢...)
*   不要提要求(至少放一个“请”字，并解释你为什么要求改变)
*   不要冷嘲热讽，即使你们是好朋友，其他评论者/读者可能会发现一些不恰当的评论
*   永远不要说永远，也不要说永远。总会有例外。所以要小心对待这条规则...
*   避免代码的选择性所有权，即不要使用“我的”、“不是我的”、“你的”...

### [](#dos)Dos

*   提问。
*   求澄清。
*   明确一点。记住，人们在网上并不总能理解你的意图。
*   求理解作者视角。
*   如果讨论变得过于哲学或学术，将讨论转移到线下
*   找出在解决问题的同时简化代码的方法。
*   交流哪些想法你有强烈的感受，哪些没有。如果你只是表达你的偏好，就说这只是你的偏好。
*   教育。如果你提出建议，分享为什么它更好的证据。文章、研究、书籍等。

## [](#rules-for-the-authors)规则作者

*   对提交的代码保持谦逊和诚实。错误每天都在发生，过程在那里支持你。
*   请记住，你不应该把它当成个人恩怨。审查的是代码，不是你。
*   解释代码存在的原因。
*   遵循指南。
*   寻求理解评论者的观点。
*   感谢替代建议，保持讨论的技术性。试着从不同的角度学习。

## [](#call-for-action)号召行动

*   进行彻底的代码审查。你会学到很多东西，就像你的开发伙伴一样。
*   强调适当的代码审查在你的团队中的重要性，如果必要的话，教育你的同事如何审查代码。
*   检查并开始[这个库](https://github.com/sandordargo/code-review-guidelines)，我在那里收集了一些清单和想法，请随意贡献，添加您发现的重要内容！

*本文最初发表在[我的博客](http://sandordargo.com/blog/2018/03/28/codereview-guidelines)上。*