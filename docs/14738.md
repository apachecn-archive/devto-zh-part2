# ååº”æ‚¬å¿µæ¼”ç¤ºçš„æ¼”ç»ƒ

> åŸæ–‡:[https://dev . to/swyx/a-walk-of-the-react-suspension-demo-4j6a](https://dev.to/swyx/a-walkthrough-of-that-react-suspense-demo--4j6a)

## 2018 å¹´ 11 æœˆèµ·æ›´æ–°:ä¸‹é¢çš„ API å·²ç»è¿‡æ—¶ï¼ŒæŸ¥çœ‹ https://github.com/sw-yx/fresh-concurrent-reactè·å–æœ€æ–°æŒ‡å—ï¼

* * *

[![the suspense is real!](../Images/d5a7cdc53d7c26c627bd2afd32273929.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---zw0tEHc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://user-images.githubusercontent.com/3624098/36625698-50323b20-18d9-11e8-87bf-de1133b023ec.gif)

* * *

åº•çº¿æå‰:åœ¨è¿™ä¸ª 300 å¤šè¡Œç”µå½±æœç´¢æ¼”ç¤ºçš„æ¼”ç»ƒä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† React æ‚¬å¿µ API çš„å„ä¸ªæ–¹é¢:

*   `simple-cache-provider.SimpleCache` -åœ¨`createContext`ä¸­æ”¾ç½®ä¸€ä¸ª`cache`
*   `simple-cache-provider.createResource` -å®ƒ 1)ä¸ºæ‚¨çš„æ•°æ®è·å–ä¸€ä¸ª**æ‰¿è¯º**ï¼Œ2)è¾“å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è·å–ä¸€ä¸ª`cache`å’Œä¸€ä¸ª arg æ¥è°ƒç”¨æ‚¨çš„**æ‰¿è¯º**(ä¹Ÿç§°ä¸º**æŒ‚èµ·å™¨**
*   å¦‚ä½•ä½¿ç”¨`ReactDOM.unstable_deferredUpdates`å°†æ›´æ–°å§”æ‰˜ç»™è¾ƒä½çš„ä¼˜å…ˆçº§
*   `createResource`å¦‚ä½•é€šè¿‡**æŠ›å‡ºæ‰¿è¯º**å¼‚æ­¥åŠ è½½æ•°æ®(ï¼ï¼ï¼)
*   ä»…ä»…ç»™ä½ ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºåœ¨å­©å­å’Œå›é€€ä¹‹é—´åˆ‡æ¢
*   å¦‚ä½•ç”¨`createResource`åš**å¼‚æ­¥é•œåƒåŠ è½½**(ï¼ï¼ï¼)

å¦‚æœä½ æƒ³å­¦ä¹ ååº”æ‚¬å¿µï¼Œè¯·ç»§ç»­è¯»ä¸‹å»ï¼

* * *

JSConf å†°å²›ä¸Šçš„ Async React æ¼”ç¤ºä¸è´Ÿä¼—æœ›:æ—¶é—´åˆ‡ç‰‡å’Œ React æ‚¬å¿µå³å°†æ¨å‡ºï¼(è¯¦è§[å®˜æ–¹åšæ–‡](https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html)ã€[è§†é¢‘](https://www.youtube.com/watch?v=v6iR3Zk4oDY)ã€ [HN è®¨è®º](https://news.ycombinator.com/item?id=16492973))ã€‚è§‚çœ‹[è§†é¢‘](https://www.youtube.com/watch?v=v6iR3Zk4oDY)æ˜¯æœ¬æ–‡å…¶ä½™éƒ¨åˆ†çš„å…ˆå†³æ¡ä»¶ï¼

Dev Twitter ä¸Šæœ‰å¾ˆå¤šæ°å‡ºçš„å¼€å‘äººå‘˜åœ¨ç ”ç©¶ Async React å¯¹äºä»[React-loaded](https://twitter.com/jamiebuilds/status/969166935836344321?s=21)åˆ° [React Router](https://twitter.com/ryanflorence/status/969235637244018688?s=21) åˆ° [Redux](https://twitter.com/wsokra/status/969284466043703297?s=21) çš„å„ç§åº”ç”¨çš„æ„ä¹‰ï¼Œè€Œä¸€ç›´ä¿æŒè­¦æƒ•çš„ Apollo å›¢é˜Ÿç”šè‡³æ¨å‡ºäº†ç”¨ Async React å’Œ Apollo æ„å»ºçš„æ¼”ç¤ºåº”ç”¨[ï¼](https://twitter.com/apollographql/status/969313298440126466)

ä¸ç”¨è¯´ï¼Œäººä»¬å¾ˆå…´å¥‹(é˜…è¯»å…¨æ–‡ï¼Œéå¸¸æœ‰è¶£):

> ![Jani EvÃ¤kallio profile image](../Images/d63f9a28599b8092cb42764056f21161.png)Jani evkallio[@ jevakallio](https://dev.to/jevakallio)![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)å†è¿‡ä¸€ä¸ªå°æ—¶ [@dan_abramov](https://twitter.com/dan_abramov) å°†ç™»ä¸Š [@jsconfis](https://twitter.com/jsconfis) çš„èˆå°ï¼Œè¿›è¡Œå¤§ä¼šå†å²ä¸Šæœ€è¢«ç‚’ä½œçš„æ¼”è®²ä¹‹ä¸€ã€‚ä½ çŸ¥é“è¿™æ„å‘³ç€ä»€ä¹ˆå—ï¼Ÿ
> 
> æ˜¯çš„ï¼Œç°åœ¨æ˜¯ç›´æ’­çƒ­æ‹¿æ¨ç‰¹è·Ÿå¸–çš„æ—¶é—´ğŸ‘‡2018 å¹´ 03 æœˆ 01 æ—¥ä¸Šåˆ 09:01[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969135585909792768)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969135585909792768)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969135585909792768)

è€Œ [spectrum.chat](https://spectrum.chat/?t=586129b0-845c-4025-bd0e-f4a2200a971b) çš„äººéƒ½éå¸¸å…´å¥‹:

[![image](../Images/e72459eae72a87d751b1cb8ebba41d0c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--LED10XuU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/6764957/36888678-88ba5d66-1dc4-11e8-9813-7f6c034c07a2.png)

ä»¤äººå…´å¥‹çš„ä¸œè¥¿ã€‚è¿™æ˜¯ä¸€ä¸ªé•¿è¾¾æ•°å¹´çš„è¿‡ç¨‹çš„é«˜æ½®ï¼Œä» 2014 å¹´ Jordan Walke çš„è¿™æ¡æ¨æ–‡å¼€å§‹ï¼Œåˆ° [Lin Clark å¯¹ React Fiber çš„ä»‹ç»](https://www.youtube.com/watch?v=ZCuYPiUIONs)(ä½ å¯ä»¥çœ‹åˆ°æ—¶é—´åˆ‡ç‰‡å‡ ä¹åœ¨ä¸€å¹´å‰å°±å¼€å§‹å·¥ä½œäº†)ï¼Œåˆ°[2017 å¹´ 9 æœˆ React Fiber çš„å®é™…å‘å¸ƒ](https://code.facebook.com/posts/1716776591680069/react-16-a-look-inside-an-api-compatible-rewrite-of-our-frontend-ui-library/)ï¼Œåˆ° [Sebastian åœ¨ 2017 å¹´ 12 æœˆæ¨å‡ºåŠå¸¦ API](https://twitter.com/acdlite/status/969172311067713537) ã€‚

ä½†æ˜¯å¦‚æœä½ åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ Reactâ€”â€”åƒæˆ‘ä¸€æ ·çš„ Joeï¼Œä½ ä¼šè§‰å¾—æœ‰ç‚¹è½å(è¿™æ˜¯åº”è¯¥çš„â€”â€”è¿™æ˜¯é«˜çº§çš„ä¸œè¥¿ï¼Œç”šè‡³è¿˜ä¸æ˜¯æœ€ç»ˆç‰ˆæœ¬ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯ä¸€ä¸ª React æ–°æ‰‹ï¼Œåœæ­¢é˜…è¯»å¹¶å­¦ä¹  React)ã€‚

æˆ‘é€šè¿‡å®è·µæ¥å­¦ä¹ ï¼Œæˆ‘çœŸçš„ä¸æ“…é•¿é€šè¿‡è°ˆè®ºæ¥ç†è§£æŠ½è±¡çš„ä¸œè¥¿ã€‚

å¹¸è¿çš„æ˜¯ï¼Œå®‰å¾·é²Â·å…‹æ‹‰å…‹åœ¨ CodeSandbox ä¸Šå‘å¸ƒäº†ç”µå½±æœç´¢æ¼”ç¤ºçš„ç‰ˆæœ¬ã€‚æ‰€ä»¥æˆ‘æƒ³æˆ‘åº”è¯¥åªæµè§ˆè¿™ä¸€ç‚¹ï¼Œå› ä¸ºè¿™å®é™…ä¸Šæ˜¯æˆ‘ä»¬æ‰€æœ‰çš„æ¼”ç¤ºä½¿ç”¨ä»£ç (é™¤äº† Apollo æ¼”ç¤ºï¼Œå®ƒæ˜¯è¿™éƒ¨ç”µå½±æœç´¢æ¼”ç¤ºçš„ä¸€ä¸ªåˆ†æ”¯)ï¼Œæˆ‘ä¸æƒ³æµè§ˆæ•´ä¸ªæºä»£ç (æˆ‘ç°åœ¨ä¹Ÿç¢°å·§çœŸçš„ç”Ÿç—…äº†ï¼Œä½†å­¦ä¹ è®©æˆ‘å¾ˆå¼€å¿ƒ:)ã€‚

æœ€åï¼Œä¸€äº›å…è´£å£°æ˜ï¼Œå› ä¸ºäººä»¬æœ‰æ—¶å¾ˆå®¹æ˜“è¢«è§¦å‘:

1.  æˆ‘æ˜¯æœ€è¿‘çš„è®­ç»ƒè¥æ¯•ä¸šç”Ÿã€‚ä½ ä¸æ˜¯åœ¨è¯»æŸä¸ªæ€æƒ³é¢†è¢–çš„é¢„è¨€ã€‚æˆ‘åªæ˜¯ä¸€ä¸ªåœ¨å…¬å…±åœºåˆå­¦ä¹ çš„äººã€‚
2.  è¿™ç§ API éå¸¸ä¸ç¨³å®šï¼Œå¹¶ä¸”å®¹æ˜“å‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥å¿˜è®°ç»†èŠ‚ï¼Œåªè€ƒè™‘è¿™äº›æ¦‚å¿µå¯¹ä½ æ˜¯å¦æœ‰æ„ä¹‰ã€‚
3.  å¦‚æœä½ æ˜¯ä¸€ä¸ªååº”æ–°æ‰‹ï¼Œä½ æ ¹æœ¬ä¸éœ€è¦çŸ¥é“è¿™äº›ã€‚è¿™äº›éƒ½ä¸éœ€è¦å‡ºç°åœ¨ä»»ä½• React åˆå­¦è€…è¯¾ç¨‹ä¸­ã€‚æˆ‘ä¼šæŠŠè¿™ä¸ªæ”¾åœ¨ä½ å­¦ä¹ åçš„ Redux ä¸­ï¼Œå¹¶åœ¨å­¦ä¹ å®Œ [React ä¸Šä¸‹æ–‡ API](https://reactjs.org/docs/context.html) å

ä½†æ˜¯å­¦ä¹ æ˜¯æœ‰è¶£çš„ï¼äº‹ä¸å®œè¿Ÿ:

# æ½œå…¥ React æ‚¬å¿µ

å½“ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œè¯·è®©[æ¼”ç¤º](https://codesandbox.io/s/5zk7x551vk)åœ¨å¦ä¸€ä¸ªå±å¹•ä¸­æ‰“å¼€ï¼Œè¿™æ ·ä¼šæ›´æœ‰æ„ä¹‰ã€‚

* * *

å†ä¸€æ¬¡æé†’é‚£äº›ç•¥è¯»çš„äºº:

# [å˜¿ï¼ä½ ï¼åœ¨æ‚¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œè¯·æ‰“å¼€æ¼”ç¤ºï¼](https://codesandbox.io/s/5zk7x551vk)

* * *

## é‡è§`simple-cache-provider.SimpleCache`

åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†åŒ…å«åœ¨`index.js`ä¸­ï¼Œæ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬å¼€å§‹çš„åœ°æ–¹ã€‚æˆ‘å–œæ¬¢ä»ä¸Šåˆ°ä¸‹æ·±å…¥åˆ°æ ‘ä¸­ï¼Œè¿™åœ¨ä»£ç ä¸­æ„å‘³ç€ä½ ä»åº•éƒ¨å‘ä¸Šé˜…è¯»ã€‚åœ¨ç¬¬ 303 è¡Œï¼Œæˆ‘ä»¬çœ‹åˆ°é¡¶éƒ¨çš„å®¹å™¨ç”¨`withCache` HOC åŒ…è£…ã€‚è¿™æ˜¯åœ¨`withCache.js` :
ä¸­å®šä¹‰çš„

```
import React from 'react';
import {SimpleCache} from 'simple-cache-provider';

export default function withCache(Component) {
  return props => (
    <SimpleCache.Consumer>
      {cache => <Component cache={cache} {...props} />}
    </SimpleCache.Consumer>
  );
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ç¬¬äºŒä¸ª React API é‡‡ç”¨äº†å­æ¸²æŸ“é“å…·(å‚è§[è‚¯ç‰¹Â·å¤šå…¹å¯¹ç¬¬ä¸€ä¸ª](https://dev.to/kentcdodds/reacts--new-context-api-dpi)çš„æ€»ç»“)ï¼Œå®ƒåªæ˜¯ä¸ºä¼ é€’ç»™å®ƒçš„ä»»ä½•ç»„ä»¶æä¾›äº†ä¸€ä¸ª`cache`é“å…·ã€‚[ç®€å•ç¼“å­˜æä¾›è€…](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js)çš„æºä»£ç åªæœ‰ä¸åˆ° 300 è¡Œæµç±»å‹ä»£ç ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒåœ¨å¹•åä½¿ç”¨äº† [createContext](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L297) ã€‚ä½ å¯èƒ½å¬è¯´è¿‡å¾ˆå¤šå…³äºâ€œæŠ›å‡ºæ¨¡å¼â€çš„å¤§æƒŠå°æ€ªï¼Œä½†æ˜¯è¿™åœ¨`simple-cache-provider`ä¸­å·²ç»è¢«å¾ˆå¥½åœ°æŠ½è±¡å‡ºæ¥äº†ï¼Œä½ å®é™…ä¸Šä»æ¥ä¸éœ€è¦åœ¨ä½ è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚

å› ä¸ºå®ƒçœŸçš„å¾ˆé…·ï¼Œä½ å¯ä»¥åœ¨ç¬¬ 187 è¡Œçš„[ä¸­æ£€æŸ¥å®ƒï¼Œåœ¨é‚£é‡Œæ‰¿è¯ºè¢«æŠ›å‡ºï¼Œç„¶ååœ¨ç¬¬ 128](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L187) è¡Œçš„[ä¸­è°ƒç”¨`load`å‡½æ•°ã€‚æˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L128)

## æ¸²æŸ“ä¸­çš„å‰¯ä½œç”¨

ç”µå½±æœç´¢æ¼”ç¤ºçš„ä¸»ä½“åœ¨`MoviesImpl`ç»„ä»¶ä¸­:

```
class MoviesImpl extends React.Component {
  state = {
    query: '',
    activeResult: null,
  };
  onQueryUpdate = query => this.setState({query});
  onActiveResultUpdate = activeResult => this.setState({activeResult});
  clearActiveResult = () => this.setState({activeResult: null});
  render() {
    const cache = this.props.cache;
    const state = this.state;
    return (
      <AsyncValue value={state} defaultValue={{query: '', activeResult: null}}>
      /*just renders more JSX here */
      </AsyncValue>
    );
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

é¦–å…ˆè¦æ³¨æ„çš„æ˜¯`render`ä¹‹å¤–æ²¡æœ‰å‰¯ä½œç”¨ã€‚åœä¸‹æ¥æƒ³ä¸€æƒ³ä½ é€šå¸¸å¦‚ä½•åœ¨ React ç»„ä»¶ä¸­äº§ç”Ÿå‰¯ä½œç”¨â€”â€”è¦ä¹ˆç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¦‚`componentDidMount`æˆ–`componentDidUpdate`äº§ç”Ÿå‰¯ä½œç”¨ï¼Œè¦ä¹ˆç”¨ä½ çš„äº‹ä»¶å¤„ç†ç¨‹åºå¦‚ä¸Šé¢çš„`onQueryUpdate`å’Œ`onActiveResultUpdate`äº§ç”Ÿå‰¯ä½œç”¨ã€‚å½“ä½ åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æŸ¥è¯¢æ—¶ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•æ›´æ–°çš„ï¼Ÿ

è¿™å°±æ˜¯äº‹æƒ…å¼€å§‹å˜å¾—å¥‡æ€ªçš„åœ°æ–¹ã€‚ç­”æ¡ˆåœ¨ AsyncValue ç»„ä»¶ä¸­ã€‚

## æ»¡è¶³ react DOM . unstable _ deferredUpdates

ç­”æ¡ˆæ˜¯ 42ï¼Œå’Œæ‰€æœ‰çš„äº‹æƒ…ä¸€æ ·ã€‚å…·ä½“æ¥è¯´ï¼Œå‘ä¸Šæ»šåŠ¨åˆ°ç¬¬ 42 è¡Œï¼Œæ‰¾åˆ°`AsyncValue` :
çš„æºä»£ç 

```
class AsyncValue extends React.Component {
  state = {asyncValue: this.props.defaultValue};
  componentDidMount() {
    ReactDOM.unstable_deferredUpdates(() => {
      this.setState((state, props) => ({asyncValue: props.value}));
    });
  }
  componentDidUpdate() {
    if (this.props.value !== this.state.asyncValue) {
      ReactDOM.unstable_deferredUpdates(() => {
        this.setState((state, props) => ({asyncValue: props.value}));
      });
    }
  }
  render() {
    return this.props.children(this.state.asyncValue);
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

`ReactDOM.unstable_deferredUpdates`æ˜¯ä¸€ä¸ªæ²¡æœ‰æ–‡æ¡£è®°å½•çš„ APIï¼Œä½†å®ƒä¸æ˜¯æ–°çš„ï¼Œå¯ä»¥è¿½æº¯åˆ° 2017 å¹´ 4 æœˆ[(ä»¥åŠ](https://twitter.com/koba04/status/854926955463950337?lang=en) [unstable_AsyncComponent](https://github.com/koba04/react-fiber-resources) )ã€‚æˆ‘æ— çŸ¥çš„çŒœæµ‹æ˜¯ï¼Œè¿™å°†æŠŠ`asyncValue`(å³`query`å’Œ`activeResult`)ä¸­çš„ä»»ä½•ä¸œè¥¿ä½œä¸ºæ¯” UI æ›´æ–°ä¼˜å…ˆçº§æ›´ä½çš„æ›´æ–°ã€‚

## è·³è¿‡ä¸»ç»†èŠ‚ã€æ ‡é¢˜å’Œæœç´¢

å¤ªå¥½äº†ï¼å›åˆ°è§£æ`AsyncValue`çš„å†…éƒ¨ç»“æ„ã€‚

```
 <AsyncValue value={state} defaultValue={{query: '', activeResult: null}}>
        {asyncState => (
          <MasterDetail
            header={<Header />} // just a string: 'Movie search'
            search={ // just an input box, we will ignore
            }
            results={ // uses <Results />
            }
            details={ // uses <Details />
            }
            showDetails={asyncState.activeResult !== null}
          />
        )}
      </AsyncValue> 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„äº‰è®®ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªå¸¦æœ‰å››ä¸ªæ¸²æŸ“é“å…·çš„`MasterDetail`ç»„ä»¶(å“Ÿï¼Œæˆ‘å¬è¯´ä½ å–œæ¬¢æ¸²æŸ“é“å…·...).`MasterDetail`å”¯ä¸€çš„å·¥ä½œæ˜¯ CSS-in-JSï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶è·³è¿‡å®ƒã€‚`Header`åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ`Search`åªæ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è·³è¿‡è¿™äº›ã€‚æ‰€ä»¥æˆ‘ä»¬å…³å¿ƒçš„å‰©ä½™ç»„ä»¶æ˜¯`Results`å’Œ`Details`ã€‚

## æ·±æŒ–`simple-cache-provider.createResource`

åŸæ¥ä¸¤è€…å¼•æ“ç›–ä¸‹ç”¨çš„éƒ½æ˜¯å·®ä¸å¤šçš„ä¸œè¥¿ã€‚è¿™é‡Œæ˜¯ç¬¬ 184 è¡Œçš„`Results`:

```
function Results({query, cache, onActiveResultUpdate, activeResult}) {
  if (query.trim() === '') {
    return 'Search for something';
  }
  const {results} = readMovieSearchResults(cache, query);
  return (
    <div css={{display: 'flex', flexDirection: 'column'}}>
       /* some stuff here */
    </div>
  );
} 
```

Enter fullscreen mode Exit fullscreen mode

å…³é”®ä½ä¸º`readMovieSearchResults`ï¼Œå®šä¹‰å¦‚ä¸‹:

```
import {createResource} from 'simple-cache-provider';

// lower down...

async function searchMovies(query) {
  const response = await fetch(
    `${TMDB_API_PATH}/search/movie?api_key=${TMDB_API_KEY}&query=${query}&include_adult=false`,
  );
  return await response.json();
}

const readMovieSearchResults = createResource(searchMovies); 
```

Enter fullscreen mode Exit fullscreen mode

è¯·æ³¨æ„ï¼Œ`Results`ç»„ä»¶ä»ç„¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„â€œæ¸²æŸ“â€éƒ¨åˆ†ã€‚æˆ‘ä»¬æ­£åœ¨å°†`searchMovies`æ‰¿è¯ºä¼ é€’ç»™æ–°çš„`createResource` APIï¼Œå®ƒåœ¨`simple-cache-provider` [æº](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L251)ä¸­

ç°åœ¨ createResource ä½¿ç”¨äº†ä¸€äº›æˆ‘ä¸å®Œå…¨ç†è§£çš„é»‘é­”æ³•ï¼Œå¯¹æ¼”ç¤ºæ¥è¯´ä¹Ÿä¸æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œä½†æ˜¯è¯·åŸè°…æˆ‘ã€‚ç²—ç•¥çš„è¿‡ç¨‹ä»

*   [åˆ›å»ºç¬¬ 251 è¡Œå®šä¹‰çš„èµ„æº](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L251)
*   [ç¬¬ 268 è¡Œè°ƒç”¨ cache . read](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L268)
*   [ç¬¬ 175 è¡Œå®šä¹‰çš„ cache . read](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L175)
*   ç”±äºç¼“å­˜çŠ¶æ€ä¸ºç©ºï¼Œ[åœ¨ç¬¬ 187 è¡Œ](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L187)æŠ›å‡ºæŒ‚èµ·å™¨ï¼ï¼ï¼
*   æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰¿è¯ºï¼æˆ‘ä»¬åœ¨å“ªé‡ŒæŠ“ä½å®ƒï¼
*   æˆ‘æ²¡æœ‰ã€‚è¯¥æ­»çš„ã€‚çº¿ç´¢ã€‚å“ªé‡Œéƒ½æ²¡æœ‰`catch`ï¼(æ¥è‡ªæœªæ¥çš„æ›´æ–°: [Andrew è¯å®](https://twitter.com/acdlite/status/969488267073630208)è¿™æ˜¯ React çš„ç‰¹åˆ«ç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†ï¼Œä»–ä»¬æŠŠå®ƒæ”¾åœ¨ä¸€èµ·)
*   åœ¨æŸä¸€ç‚¹ä¸Šï¼Œæ‰¿è¯ºå†’æ³¡åˆ°`createCache`(æˆ‘ä»¬ç”¨`SimpleCache`å£°æ˜å®ƒä¸€ç›´åœ¨é¡¶å±‚)å¹¶ä¸”`load`åœ¨ç¼“å­˜ä¸Šè¢«è°ƒç”¨ã€‚æˆ‘æ€ä¹ˆçŸ¥é“è¿™ä¸ªï¼Ÿ[128 çº¿æ˜¯æ•´ä¸ª app](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L128) ä¸­å”¯ä¸€çš„`.then`ã€‚
*   ä»è¿™é‡Œå¼€å§‹ï¼Œå°±å˜å¾—å®¹æ˜“äº†ã€‚é«˜é€Ÿç¼“å­˜å¤„äº`Resolved`æˆ–`Rejected`çŠ¶æ€ã€‚å¦‚æœ`Resolved`ï¼Œåˆ™[è®°å½•å€¼](https://github.com/facebook/react/blob/master/packages/simple-cache-provider/src/SimpleCacheProvider.js#L192)è¢«è¿”å›ï¼Œå¹¶ä½œä¸ºæ–°çš„`activeResult`å‡ºç°åœ¨`AsyncValue`ä¸­ï¼Œé‡æ–°å‘ˆç°æ•´ä¸ªäº‹ä»¶ã€‚

è¿™ç§è¿‚å›æ›²æŠ˜çš„æ–¹æ³•æ˜¯ React æ‚¬å¿µçš„æ ¸å¿ƒåˆ›æ–°ï¼Œä½ å¯ä»¥å‘Šè¯‰æˆ‘è¿™åªæ˜¯æœ‰ç‚¹è¶…å‡ºæˆ‘ç°åœ¨çš„ç†è§£æ°´å¹³ã€‚ä½†è¿™å°±æ˜¯ä½ åœ¨æ¸²æŸ“ä¸­è·å¾—å‰¯ä½œç”¨çš„æ–¹å¼(ä¸ä¼šå¯¼è‡´æ— é™å¾ªç¯)ã€‚

**è¿™æ˜¯å…³é”®çš„æ´å¯ŸåŠ›:â€œæ‚¬å¿µâ€æ˜¯åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­åŒæ­¥ä½¿ç”¨`readMovieSearchResults(cache, query)`çš„åœ°æ–¹ã€‚å¦‚æœ`cache`ä¸åŒ…å«æ‚¨çš„`query`çš„ç»“æœ(ä½¿ç”¨å“ˆå¸Œä½œä¸º`Map`å­˜å‚¨åœ¨å†…éƒ¨)ï¼Œå®ƒä¼šâ€œæš‚åœâ€æ¸²æŸ“å¹¶æŠ›å‡ºæ‰¿è¯ºã€‚**

é˜¿æ³¢ç½—å’Œå…¶ä»–äººå°†æœ‰æ›¿ä»£çš„ç¼“å­˜å®ç°ã€‚

å“å‘€ï¼Œé‚£æ˜¯ç²—ç³™çš„ï¼å¦‚æœæˆ‘åšé”™äº†ä»€ä¹ˆï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚æˆ‘ä¹Ÿåœ¨å­¦ã€‚

æ‰€ä»¥(å¤§éƒ¨åˆ†)å·²ç»å®Œæˆäº†ã€‚ä¸Š`Details`ï¼

## ç»†èŠ‚å†³å®šæˆè´¥

å®é™…ä¸Šï¼Œ`Details`åªæ˜¯`MovieInfo`å‘¨å›´çš„ä¸€å±‚è–„è–„çš„åŒ…è£…ï¼ŒT1 æ˜¯åœ¨ç¬¬ 227 è¡Œå®šä¹‰çš„:

```
function MovieInfo({movie, cache, clearActiveResult}) {
  const fullResult = readMovie(cache, movie.id);
  return (
    <Fragment>
      <FullPoster cache={cache} movie={movie} />
      <h2>{movie.title}</h2>
      <div>{movie.overview}</div>
    </Fragment>
  );
} 
```

Enter fullscreen mode Exit fullscreen mode

`readMovie`æ˜¯ä¸€ä¸ªç±»ä¼¼äº`readMovieSearchResults`çš„ç¼“å­˜è°ƒç”¨ï¼Œå®ƒåªæ˜¯ç”¨ä¸åŒçš„ URL è°ƒç”¨æ–°çš„`createResource`åˆ°`fetch`ã€‚æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯`FullPoster` :

```
function FullPoster({cache, movie}) {
  const path = movie.poster_path;
  if (path === null) {
    return null;
  }
  const config = readConfig(cache);
  const size = config.images.poster_sizes[2];
  const baseURL =
    document.location.protocol === 'https:'
      ? config.images.secure_base_url
      : config.images.base_url;
  const width = size.replace(/\w/, '');
  const src = `${baseURL}/${size}/${movie.poster_path}`;
  return (
    <Timeout ms={2000}>
      <Img width={width} src={src} />
    </Timeout>
  );
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€å †æ–°çš„äº‹æƒ…è¦å¤„ç†ã€‚åˆæ˜¯ä¸€ä¸ªç¼“å­˜è°ƒç”¨(çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨æ¸²æŸ“éœ€è¦æ—¶éšæ„è°ƒç”¨è¿™äº›è°ƒç”¨çš„ï¼Ÿ)ï¼Œç„¶ååœ¨æˆ‘ä»¬ç»“æŸä½¿ç”¨`Timeout`å’Œ`Img`ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ­£å¸¸çš„å˜é‡æŒ‰æ‘©ã€‚

## ä»‹ç»`React.Timeout`

è¿™é‡Œæ˜¯`Timeout.js` :

```
import React, {Fragment} from 'react';

function Timeout({ms, fallback, children}) {
  return (
    <React.Timeout ms={ms}>
      {didTimeout => (
        <Fragment>
          <span hidden={didTimeout}>{children}</span>
          {didTimeout ? fallback : null}
        </Fragment>
      )}
    </React.Timeout>
  );
}

export default Timeout; 
```

Enter fullscreen mode Exit fullscreen mode

æ˜¯çš„ï¼Œè¿™æ˜¯æ–°çš„([è¿™é‡Œçš„ PR æ·»åŠ å®ƒ](https://github.com/facebook/react/pull/12279/files#diff-50d8f0a9fb4af9baa0c2d4b8905567a7)ï¼Œå®ƒä¸ä¸€å †å…¶ä»–çš„ React Fiber ä»£ç æ··åˆåœ¨ä¸€èµ·ï¼Œæ‰€ä»¥é£é™©è‡ªè´Ÿ)ã€‚ä½†æ˜¯å®ƒå¾ˆç›´è§‚:è¾“å…¥ä¸€ä¸ª`ms`å±æ€§ï¼Œç„¶åå®ƒæ§åˆ¶ä¸€ä¸ªå¸ƒå°”å€¼`didTimeout`ï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™éšè—`children`å¹¶æ˜¾ç¤º`fallback`ï¼Œå¦‚æœä¸ºå‡ï¼Œåˆ™æ˜¾ç¤º`children`å¹¶éšè—`fallback`ã€‚ç¬¬ä¸‰ä¸ªä½¿ç”¨æ¸²æŸ“é“å…·çš„ React APIï¼Œé€‚ç”¨äºæ‰€æœ‰äººï¼

çªå‡»æµ‹éªŒ:ä¸ºä»€ä¹ˆè¿™ä¸ªå­/å›é€€è¡Œä¸ºä½¿ç”¨`<span hidden>`è€Œä¸æ˜¯å°†æ•´ä¸ªäº‹æƒ…å°è£…åœ¨`{didTimeout ? fallback : children}`ä¸­ï¼Œå¹¶ä¸”æ ¹æœ¬æ²¡æœ‰`<span>`æ ‡ç­¾ï¼Ÿæœ‰è¶£çš„äº‹æƒ…ï¼Œå¦‚æœä½ ä»¥å‰æ²¡æœ‰è€ƒè™‘è¿‡(å¦‚æœä½ ä¸ç¡®å®šï¼Œè¯·åœ¨è¯„è®ºä¸­å›å¤ï¼)

è°ˆå¦ä¸€ä»¶äº‹ã€‚

## å¼‚æ­¥é•œåƒåŠ è½½ï¼Œæˆ–è€…è¯´ï¼Œå¦‚ä½•è®©ä»…ä»…ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ä¸æ— èŠ

è¿™é‡Œæ˜¯`Img.js` :

```
import React from 'react';
import {SimpleCache, createResource} from 'simple-cache-provider';
import withCache from './withCache';

function loadImage(src) {
  const image = new Image();
  return new Promise(resolve => {
    image.onload = () => resolve(src);
    image.src = src;
  });
}

const readImage = createResource(loadImage);

function Img({cache, src, ...props}) {
  return <img src={readImage(cache, src)} {...props} />; }

export default withCache(Img); 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ˜¯ä»€ä¹ˆï¼æˆ‘ä»¬æ­£åœ¨åˆ›å»ºå¦ä¸€ä¸ªç¼“å­˜ï¼æ˜¯çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰ç†ç”±ä¸èƒ½å°†å¤šä¸ªç¼“å­˜è¿æ¥åˆ°ä¸åŒçš„ç»„ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬â€œåªæ˜¯â€åœ¨å¹•åä½¿ç”¨`createContext`ï¼Œå°±åƒæˆ‘ä»¬å·²ç»å»ºç«‹çš„é‚£æ ·ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯æ–°çš„:å¼‚æ­¥å›¾åƒåŠ è½½ï¼w00tï¼ä¹Ÿå°±æ˜¯è¯´:

*   ä½¿ç”¨`Image()`æ„é€ å‡½æ•°(æ˜¯çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œ[é˜…è¯» MDN å’Œå“­æ³£](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/Image)
*   ç”¨`Promise`åŒ…èµ·æ¥ï¼Œå¹¶è®¾ç½®`src`
*   å°†è¿™ä¸ª`Promise`ä¼ é€’ç»™`createResource`,ç”±å®ƒæ¥å®Œæˆè‡ªå·±çš„å·¥ä½œ(åˆ«é—®äº†..ä»…ä»…..å‘ä¸Šæ»šåŠ¨ï¼Œè¿™æ˜¯æˆ‘ä¸ºä½ å‡†å¤‡çš„å…¨éƒ¨)
*   å½“åŠ è½½å®Œæˆåï¼Œæˆ‘ä»¬å°†å®ƒä¼ é€’ç»™`<img src`ï¼

èŠ±ä¸€ç‚¹æ—¶é—´æ¥æ¬£èµè¿™æ˜¯å¤šä¹ˆæœ‰åˆ›æ„ã€‚åœ¨ä¸€å¤©ç»“æŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æŠŠä¸€ä¸ªå­—ç¬¦ä¸²`src`ä¼ é€’ç»™ä¸€ä¸ªå­—ç¬¦ä¸²`<img src`ã€‚å†ç®€å•ä¸è¿‡äº†ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹é—´ï¼Œæˆ‘ä»¬æ’å…¥äº†æ•´ä¸ªç–¯ç‹‚çš„`createResource`è¿›ç¨‹æ¥å¼‚æ­¥åŠ è½½å›¾åƒï¼ŒåŒæ—¶`<img src`ä»€ä¹ˆä¹Ÿæ²¡æœ‰æ¸²æŸ“ï¼Œæ‰€ä»¥å®ƒä»€ä¹ˆä¹Ÿæ²¡æœ‰æ˜¾ç¤ºã€‚

**ä½ å¥½ï¼Œå…³é”®åˆæ¥äº†:å¦‚æœ`cache`æ²¡æœ‰`src`çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å°±â€œæš‚åœâ€æ¸²æŸ“ï¼Œå¹¶æŠ›å‡ºæ‰¿è¯ºï¼Œç›´åˆ°`image`åŠ è½½å®Œæ¯•ï¼ŒReact æ‰çŸ¥é“è¦é‡æ–°æ¸²æŸ“`Img`ã€‚**

åŠæ†éº¦å…‹é£ä¸‹é™ã€‚

è¿™çœ‹èµ·æ¥çœ¼ç†Ÿå—ï¼Ÿä¼ é€’å­—ç¬¦ä¸²ç°åœ¨æœ‰å‰¯ä½œç”¨ã€‚è¿™å°±è·Ÿä¼  JSX æœ‰å‰¯ä½œç”¨ä¸€æ ·ã€‚è®©ä½ åœ¨ä»»ä½•å£°æ˜æ€§çš„ä¸œè¥¿ä¸­æ’å…¥å‰¯ä½œç”¨ï¼Œä¸ä»…ä»…æ˜¯ JSXï¼

## ä½œä¸š

åªå‰©ä¸‹ä¸¤ä¸ªéœ€è¦æ¢ç´¢çš„äº†:`Result`å’Œ`PosterThumbnail`ï¼Œä½†æ˜¯ä½ ç°åœ¨åº”è¯¥å¯ä»¥ä»æˆ‘ä»¬å¯¹`FullPoster`å’Œ`Img`çš„åˆ†æä¸­è®¤å‡ºä»£ç æ¨¡å¼äº†ã€‚æˆ‘æŠŠå®ƒç•™ç»™è¯»è€…åšç»ƒä¹ ã€‚

æ‰€ä»¥é€€ä¸€æ­¥è¯´:æˆ‘ä»¬ä»Šå¤©å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

*   `simple-cache-provider.SimpleCache` -åœ¨`createContext`ä¸­æ”¾ç½®ä¸€ä¸ª`cache`
*   `simple-cache-provider.createResource` -å®ƒ 1)ä¸ºæ‚¨çš„æ•°æ®è·å–ä¸€ä¸ª**æ‰¿è¯º**ï¼Œ2)è¾“å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è·å–ä¸€ä¸ª`cache`å’Œä¸€ä¸ª arg æ¥è°ƒç”¨æ‚¨çš„**æ‰¿è¯º**(ä¹Ÿç§°ä¸º**æŒ‚èµ·å™¨**
*   å¦‚ä½•ä½¿ç”¨`ReactDOM.unstable_deferredUpdates`å°†æ›´æ–°å§”æ‰˜ç»™è¾ƒä½çš„ä¼˜å…ˆçº§
*   `createResource`å¦‚ä½•é€šè¿‡**æŠ›å‡ºæ‰¿è¯º**å¼‚æ­¥åŠ è½½æ•°æ®(ï¼ï¼ï¼)
*   ä»…ä»…ç»™ä½ ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºåœ¨å­©å­å’Œå›é€€ä¹‹é—´åˆ‡æ¢
*   å¦‚ä½•ç”¨`createResource`åš**å¼‚æ­¥é•œåƒåŠ è½½**(ï¼ï¼ï¼)

300 è¡Œä»£ç ä¸­åŒ…å«äº†å¤§é‡å†…å®¹ï¼é‚£ä¸æ˜¯å¾ˆç–¯ç‹‚å—ï¼Ÿæˆ‘å½“ç„¶ä¸æ˜¯å…‰çœ‹æ¼”è®²å°±æ˜ç™½äº†è¿™ä¸€ç‚¹ï¼›æˆ‘å¸Œæœ›è¿™ä¹Ÿèƒ½å¸®åŠ©ä½ å¤„ç†ä¸€äº›æ›´å¥½çš„ç»†èŠ‚ã€‚

ä»¥ä¸‹æ˜¯ä¼šåèŠå¤©ä¸­ä¸€äº›å€¼å¾—æ³¨æ„çš„åç»­å†…å®¹:

å¯¹äºé‚£äº›æƒ³ä½¿ç”¨ createFetcher çš„äººæ¥è¯´(å°½ç®¡ [simple-cache-provider ç›®å‰æ˜¯å®˜æ–¹å®ç°](https://twitter.com/acdlite/status/969168681644179456)):

> ![ğ•ğ•’ğ•ğ•šğ•– ğ•‚ profile image](../Images/adc5d9c9593b750deaaeea6ca1e10c77.png)[@ Jamie builds](https://dev.to/jamiebuilds)![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)TLï¼›DR
> 
> å‡½æ•° createFetcher(method){
> let resolved = new Map()ï¼›
> return {
> read(key)=>{
> if(ï¼resolved.has(key)) {
> æŠ›å‡ºæ–¹æ³•(...args)ã€‚ç„¶å(val = > resolved.set(keyï¼Œval))ï¼›
> }
> return resolved.get(å…³é”®)ï¼›
> }
> }ï¼›
> }2018 å¹´ 03 æœˆ 01 æ—¥ä¸Šåˆ 11:15[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969169357094842368)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969169357094842368)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969169357094842368)

*(é˜…è¯»æ•´ä¸ªå¸–å­ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™æ¡æ¨æ–‡)*

æƒ³çœ‹çœ‹ createFetcher(æ²¡æœ‰ç®€å•ç¼“å­˜æä¾›è€…)çš„è¿è¡Œå—ï¼Ÿ[æ°ç±³åœ¨è¿™ä¸ªæ²™ç›’æ¼”ç¤ºä¸­å‡ºç°äº†](https://codesandbox.io/s/zk0y314yqp)

éœ€è¦æ›´å¤šæ¼”ç¤ºå—ï¼ŸDan Abramov ä¸çŸ¥ä½•æ•…ä»åœ¨ç¼–å†™å®ä¾‹(ä½¿ç”¨ä»–çš„`createFetcher`å®ç°):

> ![unknown tweet media content](../Images/2d3ed8e1dd20759efe4a6dc91446cd31.png)![Play butt](../Images/980e9fb12d58fa9423fc94c33003fc4f.png)<video loop="" controls=""><source src="https://video.twimg.com/tweet_video/DXPNbWlXUAAmuxr.mp4" type="video/mp4"></video>![Dan Abramov profile image](../Images/8410abe414a98a3109390b1a1f7377ee.png)ä¸¹é˜¿å¸ƒæ‹‰è«å¤«[@ä¸¹ _ é˜¿å¸ƒæ‹‰è«å¤«](https://dev.to/dan_abramov)![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)çŠ¶æ€æ›´æ–°æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥å ä½ç¬¦ä¼šç«‹å³ç”Ÿæ•ˆã€‚è®©æˆ‘ä»¬å°†åŒæ­¥(å¯¹äºè¾“å…¥)å’Œå¼‚æ­¥(å¯¹äºç¿»è¯‘ç»„ä»¶)å€¼åˆ†å¼€ï¼Œé™ä½ API çš„é€Ÿåº¦ã€‚ç°åœ¨ä¸æ˜¾ç¤ºâ€œæ­£åœ¨ç¿»è¯‘â€¦â€é©¬ä¸Šå°±å»ã€‚[gist.github.com/gaearon/376cfaâ€¦](https://t.co/Ehb78rLB3s)2018 å¹´ 03 æœˆ 01 æ—¥ 22 ç‚¹ 51 åˆ†[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969344290567704577)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969344290567704577)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969344290567704577)

å¦‚æœä½ æ‹…å¿ƒå¤šæŠ•:

> ![Sophie Alpert profile image](../Images/841c5b0263ecfdd387021c123bce2dfc.png)ã€Sophie alpertã€‘@ sophietes![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)[@ Dan _ abramov](https://twitter.com/dan_abramov)-æˆ‘...ã€‚fns)=>{
> constr RES =[]prom =[]ï¼›
> fns . foreach(fn =>{
> ã€try {
> RES . push(fn())ï¼›
> }æŠ“(e) {
> å¦‚æœ(ï¼ä¼Šæ–¯ç›ä»ª(e)){
> æŠ› eï¼›
> }
> prom . push(e)ï¼›
> }
> }ï¼š
> å¦‚æœ(prom.length) {
> æŠ›å‡º promise . all(prom)ï¼›
> }
> è¿”å› RES
> }ï¼›ã€2018 å¹´ 3 æœˆ 19 æ—¥ä¸‹åˆ 20 åˆ†è‡³ 01 æ—¥ã€‘[>](https://twitter.com/intent/tweet?in_reply_to=969291270064451584)

*(é˜…è¯»æ•´ä¸ªå¸–å­ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™æ¡æ¨æ–‡)*

å¦‚æœä½ ä»ç„¶ä¸ç¡®å®šæŠ›å‡ºæ‰¿è¯ºæ˜¯ä¸æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½ å¹¶ä¸å­¤å•(è¿™åº”è¯¥æ˜¯æœ‰äº‰è®®çš„ï¼):

> ![Johannes Ewald profile image](../Images/536bff1b7061dde0b257b538606109c2.png)Johannes e wald@ jhnnns![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)ICYMI:[@ Dan _ abra mov](https://twitter.com/dan_abramov)åœ¨ React ä¸­å±•ç¤ºäº†ä¸€ä¸ªå³å°†æ¨å‡ºçš„ APIï¼Œå…¶ä¸­ React æŠ›å‡ºäº†ä¸€ä¸ªä¸­æ­¢ç”¨æˆ·/åº”ç”¨ç¨‹åºä»£ç çš„æ‰¿è¯ºã€‚2018 å¹´ 03 æœˆ 01 æ—¥ä¸‹åˆ 16:54[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969254508978155520)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969254508978155520)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969254508978155520)

*(é˜…è¯»æ•´ä¸ªå¸–å­ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™æ¡æ¨æ–‡)*

ä¸ºä»€ä¹ˆè¦ç”¨æ‰¿è¯ºï¼Ÿå¦‚æœæˆ‘æƒ³å–æ¶ˆæå–ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯å‘ç”µæœºï¼Ÿè¿˜æ˜¯å¯è§‚çš„ï¼Ÿ

> ![Jay Phelps profile image](../Images/04a1e20cf95ce8d17ec6dbc56a4a693a.png)æ°è²å°”æ™®æ–¯@ _ æ°è²å°”æ™®æ–¯![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)[@ ACD lite](https://twitter.com/acdlite)[@ Dan _ abra mov](https://twitter.com/dan_abramov)å¯¹è¯·æ±‚å–æ¶ˆæœ‰ä»€ä¹ˆæƒ³æ³•ï¼Ÿä¾‹å¦‚ï¼Œé€šè¿‡ Symbol.observable æ”¯æŒ observable è¿˜æ˜¯åªæ”¯æŒè®¢é˜…/å–æ¶ˆè®¢é˜…å¯¹ï¼Ÿ20:41PM-2018 å¹´ 3 æœˆ 01 æ—¥[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969311753015185408)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969311753015185408)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969311753015185408)

*(é˜…è¯»æ•´ä¸ªå¸–å­è€Œä¸ä»…ä»…æ˜¯è¿™æ¡æ¨æ–‡- [å¹‚ç­‰](https://twitter.com/acdlite/status/969173378937470977)æ˜¯å…³é”®è¯)*

å“ªé‡Œå¯ä»¥ä¸ä½¿ç”¨æŒ‚èµ·ï¼Ÿå®‰å¾·é²Â·å…‹æ‹‰å…‹æŠ“ä½äº†ä½ :

> ![Andrew Clark profile image](../Images/0e3d1effc010330edb91638551667232.png)Andrew Clark@ ACD lite![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)ä½ çŸ¥é“å—
> 
> ä½ å¯ä»¥ä» getDerivedStateFromProps å†…éƒ¨æš‚åœã€‚å®ƒâ€œå·¥ä½œæ­£å¸¸â€æ˜¯å› ä¸ºå®ƒæ˜¯ React æ¸²æŸ“é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚
> 
> ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª setState reducer å†…éƒ¨æŒ‚èµ·(ç¬¬ä¸€ä¸ªå‚æ•°)ã€‚2018 å¹´ 03 æœˆ 02 æ—¥ä¸Šåˆ 04:26[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=969428655238557697)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=969428655238557697)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=969428655238557697)

*(é˜…è¯»æ•´ä¸ªå¸–å­ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿™æ¡æ¨æ–‡)*

æˆ‘é”™è¿‡äº†ä»€ä¹ˆæˆ–åšé”™äº†ä»€ä¹ˆï¼Ÿè¯·åœ¨ä¸‹é¢å‘Šè¯‰æˆ‘ï¼å¹²æ¯ï¼

* * *

ç¼–è¾‘ 2018 å¹´ 3 æœˆ 27 æ—¥

æˆ‘ç°åœ¨æ­£åœ¨é‡æ–°è§‚çœ‹åˆå¹¶çš„ JSConf å’Œ T2 react test æ¼”ç¤ºï¼Œä»¥æ‰¾å‡ºæ‚¬å¿µç”¨ä¾‹ã€‚å¼€å§‹äº†ã€‚

*   [https://youtu.be/v6iR3Zk4oDY?t=15m50s:](https://youtu.be/v6iR3Zk4oDY?t=15m50s:)åˆ›å»ºæŠ“å–å™¨-åŸºæœ¬æŠ“å–
*   https://youtu.be/v6iR3Zk4oDY?t=17m43s:éœ€è¦å‘Šè¯‰ React è¿™å¯ä»¥æ˜¯å¼‚æ­¥çš„
*   [https://youtu.be/v6iR3Zk4oDY?t=18m5s:](https://youtu.be/v6iR3Zk4oDY?t=18m5s:)è¡¨æ˜å®ƒæ˜¯äº¤äº’å¼çš„ï¼Œæ²¡æœ‰ç«äº‰æ¡ä»¶
*   [https://youtu.be/v6iR3Zk4oDY?t=18m53s:](https://youtu.be/v6iR3Zk4oDY?t=18m53s:)é«˜å»¶è¿Ÿæ¼”ç¤º-å ä½ç¬¦ã€å»¶è¿Ÿã€å›é€€ã€‚å¦‚æœå®ƒçš„ä»»ä½•ä¸€ä¸ªå­©å­éœ€è¦æ•°æ®ï¼Œå®ƒä¼šç­‰å¾…ä»–ä»¬ã€‚å±å¹•ä¿æŒäº’åŠ¨
*   [https://youtu.be/v6iR3Zk4oDY?t=21m51s:](https://youtu.be/v6iR3Zk4oDY?t=21m51s:)ç¬¬äºŒä¸ª createFetcher æ¼”ç¤º-ç”µå½±è¯„è®ºã€‚å°† MovieDetails å’Œ MovieReviews ä½œä¸ºå…„å¼Ÿç­‰å¾…ã€‚å³ä½¿åŠ è½½äº†ä¸€ä¸ªï¼Œå®ƒä¹Ÿä¸ä¼šæ˜¾ç¤ºï¼Œç›´åˆ°å®ƒçš„å…„å¼Ÿä¹Ÿè¢«åŠ è½½ã€‚
*   https://youtu.be/v6iR3Zk4oDY?t=22m43s::å¦‚æœä½ ä¸æƒ³è®©å…„å¼Ÿå§å¦¹ä»¬äº’ç›¸ç­‰å¾…å‘¢ï¼Ÿå†åšä¸€ä¸ªå ä½ç¬¦ï¼
*   [https://youtu.be/v6iR3Zk4oDY?t=24m1s:](https://youtu.be/v6iR3Zk4oDY?t=24m1s:)æœ‰è£…è½½çš„è§†è§‰æŒ‡ç¤ºã€‚ä½¿ç”¨åŠ è½½ï¼ç®€å•çš„å†…åµŒæ—‹è½¬å™¨ï¼Œä»¥åŠç”±`isLoading`æ¸²æŸ“é“å…·æ§åˆ¶çš„å¯¼èˆªã€‚æ²¡æœ‰æ¯”èµ›æ¡ä»¶ã€‚
*   [https://youtu.be/v6iR3Zk4oDY?t=26m9s:](https://youtu.be/v6iR3Zk4oDY?t=26m9s:)ä½¿ç”¨ createFetcher è½»æ¾æ‹†åˆ†ä»£ç 
*   [https://youtu.be/v6iR3Zk4oDY?t=27m56s:](https://youtu.be/v6iR3Zk4oDY?t=27m56s:)é¿å…å›¾ç‰‡åŠ è½½æ—¶çš„é¡µé¢è·³è½¬â€”â€”å¼‚æ­¥è·å–å›¾ç‰‡ï¼ä½¿ç”¨ createFetcher åˆ›å»º ImageFetcherï¼Œå¹¶å°†å…¶æ”¾å…¥ srcï¼
*   https://youtu.be/v6iR3Zk4oDY?t=30m13s::IO æ¼”ç¤ºç»“æŸ:æˆ‘ä»¬å·²ç»ä¸ºç»„ä»¶å»ºç«‹äº†ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•æ¥åœ¨åŠ è½½å¼‚æ­¥æ•°æ®æ—¶æš‚åœæ¸²æŸ“ã€‚
*   [https://youtu.be/v6iR3Zk4oDY?t=31m32s:](https://youtu.be/v6iR3Zk4oDY?t=31m32s:)é¥­æ¡¶æ¯”å–»
*   [https://youtu.be/v6iR3Zk4oDY?t=33m12s:](https://youtu.be/v6iR3Zk4oDY?t=33m12s:)CPU+IO =å¼‚æ­¥æ¸²æŸ“

ååº”æµ‹è¯•

*   [https://youtu.be/6g3g0Q_XVb4?t=2m6s](https://youtu.be/6g3g0Q_XVb4?t=2m6s)æˆ‘ä»¬æ­£åœ¨è§£å†³çš„é—®é¢˜
*   [https://youtu.be/6g3g0Q_XVb4?t=5m15s](https://youtu.be/6g3g0Q_XVb4?t=5m15s)ç¡¬ç¼–ç ç”µå½±æ¼”ç¤º
*   [https://youtu.be/6g3g0Q_XVb4?t=7m34s](https://youtu.be/6g3g0Q_XVb4?t=7m34s)åŸºæœ¬ createFetcher æ¼”ç¤º-è§£å†³ç«äº‰æ¡ä»¶
*   [https://youtu.be/6g3g0Q_XVb4?t=10m52s](https://youtu.be/6g3g0Q_XVb4?t=10m52s)å ä½ç¬¦æ¼”ç¤ºâ€”â€”è§£å†³æ½œåœ¨çš„æ»åè¿æ¥é—®é¢˜
*   [https://youtu.be/6g3g0Q_XVb4?t=12m56s](https://youtu.be/6g3g0Q_XVb4?t=12m56s)æ·»åŠ ç¬¬äºŒä¸ªæŠ“å–å™¨â€”â€”å³ä½¿åœ¨ç¬¬ä¸€ä¸ªæŠ“å–å™¨ä¹‹å‰åŠ è½½ï¼Œç¬¬äºŒä¸ªä¹Ÿä¸ä¼šæ¸²æŸ“
*   [https://youtu.be/6g3g0Q_XVb4?t=14m43s](https://youtu.be/6g3g0Q_XVb4?t=14m43s)æ·»åŠ å ä½ç¬¦ä»¥æ˜¾ç¤ºéé˜»å¡
*   [https://youtu.be/6g3g0Q_XVb4?t=15m29s](https://youtu.be/6g3g0Q_XVb4?t=15m29s)ä¿æŒæ—§å±å¹•çš„äº¤äº’æ€§æ˜¯ä¸€ç§éœ€è¦
*   [https://youtu.be/6g3g0Q_XVb4?t=16m3s](https://youtu.be/6g3g0Q_XVb4?t=16m3s)æ‰€ä»¥ç”¨`<Loading />`ï¼
*   [https://youtu.be/6g3g0Q_XVb4?t=18m35s](https://youtu.be/6g3g0Q_XVb4?t=18m35s)ä»£ç æ‹†åˆ†
*   [https://youtu.be/6g3g0Q_XVb4?t=21m41s](https://youtu.be/6g3g0Q_XVb4?t=21m41s)å›¾åƒåŠ è½½
*   [https://youtu.be/6g3g0Q_XVb4?t=23m37s](https://youtu.be/6g3g0Q_XVb4?t=23m37s)ç”¨å ä½ç¬¦ç¼“æ…¢åŠ è½½å›¾åƒ
*   [https://youtu.be/6g3g0Q_XVb4?t=24m48s](https://youtu.be/6g3g0Q_XVb4?t=24m48s)N+1 é¢„å‹:`hidden={true}` **è¿™ä¸ªè¶…çº§é…·ï¼Œæ˜¯æ–°çš„**
*   [https://youtu.be/6g3g0Q_XVb4?t=29m15s](https://youtu.be/6g3g0Q_XVb4?t=29m15s)ååº”å‡ºæ‚¬å¿µçš„å¥½å¤„
*   [https://youtu.be/6g3g0Q_XVb4?t=30m1s](https://youtu.be/6g3g0Q_XVb4?t=30m1s)é¥­æ¡¶æ¯”å–»