# 网站可靠性工程:谷歌高可用性和快乐运营的秘方

> 原文:[https://dev . to/KMA schta/site-reliability-engineering-Google-secret-sauce-for-high-avail ability-and-happy-ops-34li](https://dev.to/kmaschta/site-reliability-engineering-googles-secret-sauce-for-high-availability-and-happy-ops-34li)

> *希望不是策略*
> ——传统的 SRE 谚语

我读过《网站可靠性工程——谷歌如何运行生产系统》这本书。我学到了很多，我把很多好的实践应用到我们自己的服务中。这是要点，也是我从中学到的。我将集中讨论 web 开发者能从 SRE 中学到什么，而不涉及谷歌基础设施的复杂性。

在开始之前，有一个简短的声明:在 Marmelab，我们不在生产中运行我们的客户服务。我们的专长是通过敏捷迭代消除不确定性，所以我们通常将托管委托给合作公司。也就是说，我们的工作不能脱离生产。我们对交付软件的质量负责，这包括制作报告服务质量问题的软件，以及使其具有弹性和性能的架构。因此，尽管这本身不是我们的工作，但 web 服务的操作让我很感兴趣。

[![Site Reliability Engineering - How Google Runs Production Systems](../Images/a786039ed6aafb5af9ca5515ba392c27.png)T2】](https://landing.google.com/sre/book.html)

## 什么是现场可靠性工程(SRE)？

首先，让我们来定义这个由谷歌工程高级副总裁本·特雷诺·斯洛斯发明的新兴职业。用他自己的话说:

> 从根本上说，SRE 就是当你要求软件工程师设计一个操作功能时所发生的事情。

一个典型的 SRE 团队由 6 到 8 名工程师组成，以保持平衡的随叫随到。一半由传统的软件工程师组成(Google 的说法是 SWE ),另一半由几乎有资格成为 SWE 的工程师组成，但是他们拥有与操作领域相关的技能和兴趣:Unix 内部、网络等等。

他们在公司的工作流程中占据中心位置。他们与软件工程师、发布经理、数据中心工程师、产品所有者、会计服务和上层管理人员有关系。

他们全面负责给定应用的可用性、延迟、性能、效率、费用管理、监控、紧急响应和容量规划。

为了面对这些巨大的责任和艰难的扩展挑战，他们小心地管理自己的时间。他们以一种不同寻常的方式来做这件事:他们必须把不到 50%的时间用于作战任务、辛劳和应急响应。他们的大部分时间应该花在编写软件和工具来自动化他们自己的工作，或者确保他们的应用程序能够自我修复。

**德沃普斯对 SRE**

DevOps 是由 Patrick Debois 于 2008-2009 年发起的一项运动，旨在促进部署流程的敏捷性，并缩小开发人员和运营人员之间的差距。

SRE 更像是一个工程领域，是一种组织工程师以整体管理可靠性的方式。正如《SRE》第七页所解释的:

> 人们可以等效地将 SRE 视为 DevOps 的一个特定实现，带有一些特殊的扩展。

[![Balancing Is Not That Easy](../Images/03fba19660980f8c1501b0a308fc9fdf.png)T2】](https://i.giphy.com/media/zjF9aoAIrrjCE/giphy.gif)

## 平衡可用性和速度

我希望这本书能教会我谷歌通向“永远可用的系统”的秘密之路。我错了，但我学到了更有价值的一课。谷歌工程师并不关注 100%的可用性，因为这是不现实和不可持续的。

相反，根据业务需求和期望，每个应用程序或生产系统都有一个服务级别目标(SLO)。对于一个典型的谷歌应用程序，SLO 被设置为 99.99%(“四个九”可用性)，或 99.999%(“五个九”可用性)的成功请求率超过所有请求。

下面是[数字 9 如何转化为每年的停机时间](https://en.wikipedia.org/wiki/High_availability#Percentage_calculation):

*   99%(“两个九”):3.65 天
*   99.9%(“三个九”):8.77 小时
*   99.99%(“四个九”):52.60 分钟
*   99.999%(“五个九”):5.26 分钟

在 marmelab，我们的大多数项目都有 99.9%的正常运行时间(三个 9，还不错！)，尽管我们更关注速度而不是可用性。SRE 书中的一个重要观点是，如果我们想要达到下一个服务级别等级(四个 9)，我们必须在可用性方面付出十倍的努力。

100%和“x 个 9”可用性之间的区别非常重要，因为它提供了一个可衡量的操作空间。例如，如果不可用性是根据计划外停机时间来衡量的，并且 SLO 设置为 99.9%，则一年中大约八小时的停机时间被认为是可以接受的。

这种相对较低的可接受和计划外停机时间是衡量速度引发的风险的一种方式。如果可用性降低，并越来越接近 SLO，SRE 团队应该放慢功能交付，并专注于稳定应用程序。相反，如果可用性远远高于 SLO，那么团队就有了一些余地，可以继续推进新特性的生产。

当然，服务级别目标会随着时间的推移而变化。应该在项目的所有利益相关者之间就所有情况进行讨论。这是一个有价值的指标。

[![Automate ALL The Things](../Images/33747226dc7446948d6a3a43b9cf8f99.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--KL3MGm37--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/1%2ATKt92huSBbSnbRNuAVTx_A.jpeg)

## 消除辛劳

由于 SRE 不应将超过 50%的时间投入到运营任务中，因此随着应用程序的扩展，他们经常需要自动完成工作。他们应该集中精力减少 **toil** ，定义为:

> 这是一项手动、重复且可自动化的任务，对于应用程序的正常运行是必不可少的，并且会随着应用程序的发展而增长。

自动化工作可能是一项不可忽视的投资，但它有几个好处。当然，它节省了工程师的时间。但它也让工程师在正确的时间(而不是在服务中断时)以一种不太容易出错的方式专注于一项任务。此外，它减少了上下文切换，允许每个人关注严肃的问题，专注于真正重要的事情。

作为开发人员，我们还必须每天关注辛苦的工作——只是形式不同而已。手动测试是最普通的工作，这就是为什么我们写自动化测试。第二个最常见的工作是一般的**部署和发布管理**。连续发货是我绝对推荐的奢侈品！其他的陷阱更加微妙:**更新没有突破性变化的依赖**，**性能基准**，**审计安全漏洞**等。

消除辛劳增加了伸缩能力，使应用程序更好玩。找到它并实现自动化就看你自己了！最好的方法是像其他开发实践一样，将这一常规作为日常习惯。

[![Shame nun of Game of Thrones](../Images/86122890cc32c53e20719e06dff493c3.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--Ti0Bkdfm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://pbs.twimg.com/media/CVkAep3UkAAXUXT.jpg:large)

## 无可指责的文化回顾

SRE 有一种持续改进的文化(敏捷方法翻译过来就是*回顾*),以**事后分析**的形式。每当问题或事故足够大或面向用户时，随叫随到的工程师会写一份事后分析，另一名工程师会对其进行审查，并将其发布给整个团队。

事后分析对于跟踪事件、计划进一步行动和避免重复错误非常有用。但是 SRE 团队不止于此:他们写事后报告，无可指责。

每次事后分析都侧重于事实和根本原因分析。它假设每个人都有良好的意图，并根据他们所掌握的信息采取了正确的行动。所有的指责和羞辱都被明令禁止。此外，管理层不会惩罚错误。取而代之的是，他们把事后检查作为提高系统健壮性的机会。

这是一件很难做到的事情，但是从回顾会(在这种情况下是事后分析)中消除责备和感觉会给你信心去升级真正的问题。此外，大多数系统故障都是由于人为错误造成的。

从谷歌工程师的书中读到这一点令人耳目一新。这是一个很好的例子，说明敏捷原则是如何在开发过程之外付诸实践的。

## 结论

这本书充满了真知灼见，我只写了其中的一小部分。在“分而治之”或“设计简单”等其他技术技巧中，它还教导了谷歌如何在员工中扩展人际互动。

我热情地向任何对生产规模和开发感兴趣的人推荐*站点可靠性工程*，当然，尤其是*实践*部分，它充满了实用的东西。

整本书是所有工程经理的必读之作。第四部分，*管理*，给出了关于如何处理中断、处理操作过载或从操作过载中恢复的宝贵见解，等等。

但我也建议每位产品所有者和敏捷大师阅读一下*原则*部分，以便更好地理解运营团队是如何工作和协作的。

这本书是模块化的，很容易理解。你可以只阅读其中的一章，而不必了解谷歌基础设施是如何工作的。

SRE 的书是免费在线阅读的，或者你可以在 T2 的亚马逊上找到它！

网站可靠性工程是一个新的非常有趣的领域，你可能希望在这个博客上读到更多关于它的内容。

关于 SRE 的进一步阅读:

*   所以你想成为 SRE？克里斯·哈德森-赫尔利
*   [谷歌 SRE 资源](https://landing.google.com/sre/resources.html)

图片来源:[谷歌芬兰数据中心](https://www.utilityclick.com/google-energy/)