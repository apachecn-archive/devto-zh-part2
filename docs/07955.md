# 统一服务器端渲染和单页应用程序

> 原文:[https://dev . to/kapo uer/unite-server-side-rendering-and-single-page-applications-5hb](https://dev.to/kapouer/unite-server-side-rendering-and-single-page-applications-5hb)

这总结了我写《https://github.com/kapouer/window-page》时的发现。

网页由其 url `pathname`和`query`定义。

# [](#phases)阶段

## [](#-route)路线

引导加载脚本和样式表的初始文档。

## [](#-build)打造

在路由期间加载的脚本和样式表是可用的。

根据`pathname`建立文档。

## [](#-patch)补丁

文档已建立。

根据`query`修改文件。

## [](#-setup)设置

初始化用户界面(动画和东西)。

在文档体上注册事件侦听器。

## [](#-close)关闭

清理用户界面。

注销文档正文上的事件侦听器。

# [](#prerendering)预渲染

`document.visibilityState == "prerendering"`

两个等效的场景:

*   服务器端预呈现(jsdom...)
*   浏览器预渲染(safari...)

必须运行绑定到这些阶段的功能:

*   途径
*   建设
*   修补

文档被序列化为 HTML。

# [](#rendering)渲染

所有其他情况。

预渲染的 HTML 与脚本和样式一起加载，然后必须运行绑定到这些阶段的函数:

*   设置

# [](#navigation)导航

可以通过历史 API，或通过以下链接，提交表格等发生...所有这些都必须被适当地拦截。

如果只有电流`query`改变，则只有绑定到该相位的功能必须运行:

*   修补

否则就是:

*   关闭
*   途径
*   建设
*   修补
*   设置

或者，如果`route`通过获取预渲染文档来替换当前文档:

*   关闭
*   途径
*   设置

# [](#credentials)凭证

路由、构建、补丁阶段通常会通过 HTTP 获取数据:如果需要，可以将凭证传递给这些请求。

# [](#custom-elements-reacting-to-patch-phase-query-changes)定制元素对补丁阶段做出反应(查询更改)

在这个框架中，必须手动完成，要么直接调用元素的 update 方法，要么在当前文档上触发一个事件，要么委托给单例管理器。

# [](#additional-comments)附加注释

*   在编写这个模块的时候，异步事件还不是一个东西，所以我必须实现我自己的承诺链，并用同步事件来加倍它们，以便能够在路由器库还没有加载之前监听变化(在用 iframes 做复杂的事情时可能需要)。