# é¢å‘ Go ç¨‹åºå‘˜çš„ C++:ç¬¬ 2 éƒ¨åˆ†-åˆ‡ç‰‡

> åŸæ–‡:[https://dev.to/dayvonjersen/c-for-go-programmers-part-2-åˆ‡ç‰‡-2771](https://dev.to/dayvonjersen/c-for-go-programmers-part-2---slices-2771)

> **å…è´£å£°æ˜** : *æœ¬ç³»åˆ—æ ‡é¢˜çš„çµæ„Ÿæ¥è‡ª Go Wiki* **ä¸Šçš„ä¸€ç¯‡ç²¾å½©æ–‡ç« [ï¼Œä½†æ˜¯ï¼Œä¸é‚£ç¯‡æ–‡ç« ](https://github.com/golang/go/wiki/GoForCPPProgrammers)**ï¼Œ*ä¸åŒçš„æ˜¯ï¼Œæœ¬ç³»åˆ—ä¸­çš„ä»»ä½•ä¿¡æ¯éƒ½ä¸åº”è¢«è¯¯è®¤ä¸ºæ˜¯å¥½çš„å»ºè®®ã€‚[å‚è§ç¬¬ 0 éƒ¨åˆ†çš„ä»‹ç»](https://dev.toabout:blank#coming-soon-i-promise)ã€‚*
> 
> è¯´çœŸçš„ï¼Œä¸è¦åšæˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†è¦æ¼”ç¤ºçš„å†…å®¹ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ C++ï¼Œåªéœ€ä½¿ç”¨ [std::vector](https://en.cppreference.com/w/cpp/container/vector) ã€‚å¦‚æœä½ ä½¿ç”¨ C è¯­è¨€ï¼Œçœ‹çœ‹[çš„å¼¹æ€§ç¼“å†²åŒº](https://github.com/nothings/stb/blob/master/stretchy_buffer.h)ã€‚
> **ç¼–è¾‘**:æˆ‘ä¹Ÿå¼„é”™äº†åˆ‡ç‰‡è¯­ä¹‰ã€‚Go ä¸­çš„`s1 := s0[:]`å®é™…ä¸Šæ˜¯è®©[ä¸¤è€…å¼•ç”¨åŒä¸€ä¸ªåº•å±‚æ•°ç»„](https://play.golang.org/p/AgiI3p902pI)ï¼Œè€Œä¸æ˜¯è¿›è¡Œå¤åˆ¶ã€‚è€Œä¸”`realloc()`ä¹Ÿå¯èƒ½æŠŠäº‹æƒ…æç ¸ã€‚æ„Ÿè°¢ jstag on [#go-nuts](//irc://irc.freenode.net/#go-nuts) æŒ‡å‡ºäº†è¿™äº›é”™è¯¯ã€‚

ä½œä¸ºä¸€ä¸ªæ€æƒ³å®éªŒï¼Œè®©æˆ‘ä»¬å°è¯•ç”¨ C å’Œ C++å®ç° Go åˆ‡ç‰‡ã€‚å¦‚æœä½ ä¸æƒ³è¦è¯¦ç»†è§£è¯´ï¼Œçœ‹çœ‹ C [å’Œ C++](https://gist.github.com/dayvonjersen/2730d637c7e5950c43f655035f060183#file-slices-cpp) ä¸­çš„æˆå“[ã€‚](https://gist.github.com/dayvonjersen/2730d637c7e5950c43f655035f060183#file-slices-c)

è®© Go slices å¦‚æ­¤å‡ºè‰²çš„éƒ¨åˆ†åŸå› æ˜¯å®ƒæ–¹ä¾¿çš„è¯­æ³•:

```
s0 := []int{1, 2, 3}       // literals
s1 := make([]byte, 0, 512) // or specify length and capacity
s2 := s0[1:]               // s2 == {2, 3}, s0 is still == {1, 2, 3}
s3 := s0[:] // create a copy of a slice
s3[2] = 5   // modify in-place
somethingThatImplementsioReader.Read(s1) // slices are reference types, s1 has data in it now (maybe)
s0 = append(s0, 4, 5, 6) // append implicitly resizes
s1 = append([]int{0}, append(s0[:1], s0[2:]...)...) // like I said, nice! 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä¸è¦é‚£ç§å¿«ä¹çš„åºŸè¯ã€‚è¿™æ˜¯ cã€‚

> **æ³¨æ„** : Go è¿˜æœ‰ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥æ¯«ä¸è´¹åŠ›åœ°å°†æœ¬æœº utf8 `string`ç±»å‹è½¬æ¢ä¸º`[]byte`æˆ–`[]rune`ç±»å‹ã€‚æˆ‘ä¸çŸ¥é“å¦‚ä½•åœ¨ C/C++ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚

## [](#slices-in-c)åˆ‡ç‰‡åœ¨ C

åˆ‡ç‰‡å…·æœ‰é•¿åº¦ã€å®¹é‡å’ŒæŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆã€‚

```
typedef struct _slice {
    int   len;
    int   cap;
    void* arr;
} slice; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†…ç½®åŠŸèƒ½ [`len`](https://godoc.org/builtin#len) å’Œ [`cap`](https://godoc.org/builtin#cap) è®©æ‚¨è®¿é—®åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ã€‚

```
int len(slice* s) { return s->len; }
int cap(slice* s) { return s->cap; } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™éå¸¸ç®€å•æ˜äº†ã€‚

ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨ç±»å‹ä¿¡æ¯ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œç±»å‹ä¸æ˜¯ä¸€çº§å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠç±»å‹çš„**å¤§å°å­˜å‚¨åœ¨å­—èŠ‚**ä¸­ï¼Œå¸Œæœ›è¿™æ ·å°±å¤Ÿäº†ã€‚æˆ‘ä»¬ç¨åå°†å›åˆ°è¿™ä¸€ç‚¹ã€‚

```
typedef struct _slice {
    size_t type;
    int    len;
    int    cap;
    void*  arr;
} slice; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†…ç½®å‡½æ•° [`make`](https://godoc.org/builtin#make) åˆ†é…å…·æœ‰æŒ‡å®šé•¿åº¦å’Œå¯é€‰å®¹é‡çš„åˆ‡ç‰‡ã€‚

æˆ‘ä»¬éœ€è¦è¿™ä¸¤ä¸ªå‚æ•°ä»¥åŠæ•°ç»„å…ƒç´ ç±»å‹çš„å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚

```
slice* make(size_t type, int len, int cap) {
    slice* s = calloc(1, sizeof(slice));
    s->arr   = calloc(cap, type);
    s->type = type;
    s->len  = len;
    s->cap  = cap;
    return s;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹åˆ‡ç‰‡è¿›è¡Œåˆ‡ç‰‡ä¼šåˆ›å»ºä¸€ä¸ªæ–°åˆ‡ç‰‡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æ‹¬å·ç¬¦å·ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒä½œä¸ºä¸€ä¸ªå‡½æ•°ã€‚

```
// naming stuff is hard
slice* sslice(slice* s, int start, int end) {
    int len = end-start;
    slice* s2 = make(s->type, len, len);
    memcpy(s2->arr, s->arr + start * s->type, len * s->type);
    s2->len = len;
    return s2;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŒ‡é’ˆç®—æ³•çš„ä¹è¶£å°±ä»è¿™é‡Œå¼€å§‹ã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œ`arr[i]`åªæ˜¯`*(arr + i)`çš„ç®€å†™ï¼Œä½†æ˜¯ç¼–è¯‘å™¨éœ€è¦çŸ¥é“`arr`çš„ç±»å‹ï¼Œè¿™æ ·æ‰èƒ½å·¥ä½œã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨`void*`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°†åç§»é‡ä¹˜ä»¥ç±»å‹çš„å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚

> â€œå¤åˆ¶å†…ç½®å‡½æ•°å°†å…ƒç´ ä»æºåˆ‡ç‰‡å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡ã€‚[...]æºå’Œç›®çš„åœ°å¯èƒ½é‡å ã€‚Copy è¿”å›å¤åˆ¶çš„å…ƒç´ æ•°ï¼Œè¿™å°†æ˜¯ len(src)å’Œ len(dst)ä¸­çš„æœ€å°å€¼ã€‚
> 
> [https://godoc.org/builtin#copy](https://godoc.org/builtin#copy)T2ã€‘

```
int copy(slice* dst, slice* src) {
    if(dst->type != src->type)  return 0; // should generate an error somehow actually
    int len = dst->len < src->len ? dst->len : src->len;
    memcpy(dst->arr, src->arr, len * src->type);
    return len;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨æœ‰è¶³å¤Ÿçš„èµ„æºæ¥å¼€å§‹ä½¿ç”¨è¿™äº›åˆ‡ç‰‡ï¼Œä½†æ˜¯`append()`æ‰æ˜¯è®© Go åˆ‡ç‰‡å¦‚æ­¤æœ‰ä»·å€¼çš„çœŸæ­£åŸå› ã€‚

å¦‚æœæˆ‘ä»¬çŸ¥é“åº•å±‚æ•°ç»„çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
typedef struct _int_slice {
    int  len;
    int  cap;
    int* arr;
} int_slice;

// same len, cap, make, sslice, and copy... except you could could omit type and use sizeof(int)

int_slice* append(slice* s, int elem) {
    if(s->cap < s->len+1) {
        s->arr = realloc(s->arr, sizeof(int) * s->len+1);
        s->cap = s->len+1;
    }
    s->arr[s->len++] = elem;
    return s;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦ä»»ä½• T2 ç±»å‹çš„åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ T0ã€‚

> **æ³¨æ„**:å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ é€’æ–‡å­—æˆ–å€¼ç±»å‹ç»™æˆ‘ä»¬çš„`append()`ï¼Œæˆ‘ä»¬æ€»æ˜¯å¿…é¡»ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆç±»å‹ã€‚ç±»ä¼¼äº`int a = 5; s = append(s, &a);`çš„ä¸œè¥¿åœ¨æˆ‘çš„å°ç©å…·ç¤ºä¾‹ä¸­èµ·ä½œç”¨ï¼Œä½†å¹¶ä¸å¤ªå¥½ã€‚

å›æƒ³ä¸€ä¸‹ï¼Œåœ¨ C è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ª`unsigned char`ï¼Œæˆ‘ä»¬ä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨äº†æ¯ä¸ªå•ç‹¬å…ƒç´ çš„ç±»å‹å¤§å°ï¼Œå› æ­¤:

```
slice* append(slice* s, void* elem) {
    if(s->cap < s->len+1) {
        s->arr = realloc(s->arr, s->type * s->len+1);
        s->cap = s->len+1;
    }
    int offset = s->len * s->type;
    for(int i = 0; i < s->type; i++) {
        *((unsigned char*)s->arr + offset + i) = *((unsigned char*)elem + i);
    }
    s->len += 1;
    return s;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â€œå•Šâ€ï¼Œæˆ‘ç°åœ¨å‡ ä¹èƒ½å¬åˆ°ä½ è¯´ï¼Œâ€œä½†æ˜¯çœŸæ­£çš„`append()`éœ€è¦å˜é‡å‚æ•°ï¼â€æˆ‘æ©æŠ¤ä½ ï¼Œå®¶äºº:

```
slice* append(int count, slice* s, ...) {
    va_list args;
    va_start(args, s);

    if(s->cap < s->len+count) {
        s->arr = realloc(s->arr, s->type * s->len+count);
        s->cap = s->len+count;
    }

    int offset = s->len * s->type;
    for(int j = 0; j < count; j++) {
        unsigned char* elem = va_arg(args, unsigned char*);
        for(int i = 0; i < s->type; i++) {
            *((unsigned char*)s->arr + offset + i + j*s->type) = elem[i];
        }
    }
    va_end(args);

    s->len += count;
    return s;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šè¿½åŠ å¤šå°‘å…ƒç´ ï¼Œå› ä¸º`<stdarg.h>`æ²¡æœ‰æä¾›è®¡ç®—å¯å˜å‚æ•°æ•°é‡çš„æœºåˆ¶ã€‚è¿™ä¸ C å¸Œæœ›ç¨‹åºå‘˜ä¸æ–­è·Ÿè¸ªæ•°ç»„é•¿åº¦çš„æ–¹å¼æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå¹¶ä¸”ä¼šå¾ˆé«˜å…´åœ°è¯»å‡ºä½ è„¸ä¸Šçš„ end å’Œ Segfaultï¼Œè¿™åˆå›åˆ°äº†ä¸ºä»€ä¹ˆä½ é¦–å…ˆä¼šæƒ³ä½¿ç”¨åƒ slices è¿™æ ·çš„ä¸œè¥¿ã€‚

**å®Œæ•´æºä»£ç :[slices . c](https://gist.github.com/dayvonjersen/2730d637c7e5950c43f655035f060183#file-slices-c)T3ã€‘ğŸ‘€**

> å½“ä½ å®Œæˆæ—¶ï¼Œä¸è¦å¿˜è®°`free()`ä½ çš„åˆ‡ç‰‡å’Œå®ƒä»¬çš„åº•å±‚æ•°ç»„ã€‚

## c++ä¸­çš„åˆ‡ç‰‡

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬åœ¨ C ä¸­æœ‰äº† Go slicesï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¯•å›¾ç¼–è¯‘è¿™æ®µä»£ç ï¼ŒC++(å’Œå®ƒçš„åˆ›å»ºè€…)ä¼šå¯¹æˆ‘ä»¬å¤§å–Šå¤§å«ã€‚è¿™åªæ˜¯å¼ºåˆ¶è½¬æ¢*alloc çš„è¿”å›å€¼å¹¶å¿½ç•¥å’Œ/æˆ–å…³é—­ä¸€äº›ç¼–è¯‘å™¨è­¦å‘Šçš„é—®é¢˜ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ç”¨ç±»å’Œæ¨¡æ¿æ¥å°è¯•æ­£ç¡®çš„æ–¹æ³•:

```
template<typename T>
class slice {
    int _len;
    int _cap;
    T*  _arr;
public:
    slice(int len) : slice(len,len) {}
    slice(int len, int cap) {
        _len = len;
        _cap = cap;
        _arr = (T*) calloc(cap, sizeof(T));
    }
    ~slice() {
        free(_arr);
    }

    int len() { return _len; }
    int cap() { return _cap; }

    T& operator[](int i) { return _arr[i]; }

    void append(T elem) {
        if(_cap < _len+1) {
            _arr = (T*) realloc(_arr, _len+1 * sizeof(T));
            _cap = _len+1;
        }
        _arr[_len++] = elem;
    }

    template<typename... Targs>
    void append(T elem, Targs... args) {
        append(elem);
        append(args...);
    }

    slice<T> sslice(int start, int end) {
        int len = end-start;
        slice<T> s2(0, len);
        for(int i = 0; i < len; i++) {
            s2.append(_arr[start + i]);
        }
        return s2;
    }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**å®Œæ•´æºä»£ç :[slices . CPP](https://gist.github.com/dayvonjersen/2730d637c7e5950c43f655035f060183#file-slices-cpp)T3ã€‘ğŸ‘€**

æ¨¡æ¿è®©æˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä»»ä½•ç±»å‹çš„åˆ‡ç‰‡ï¼Œè€Œä¸å¿…åšä»»ä½•æŒ‡é’ˆè¿ç®—æˆ–ä»¤äººè®¨åŒçš„è½¬æ¢ã€‚

æˆ‘æƒ³æˆ‘å¼€å§‹å¬èµ·æ¥æœ‰ç‚¹å¤ªåƒ Bjarne äº†ï¼Œæ‰€ä»¥æˆ‘åº”è¯¥è·³è¿‡è¯¦ç»†æŠ¥é“ï¼Œå°½å¿«ç»“æŸã€‚

> **æ³¨æ„**:æˆ‘å¿…é¡»ä½¿ç”¨ stdlib *alloc å’Œ friendsï¼Œå› ä¸º`new[]`å¯¹äºä¸€ä¸ª*æ— ç•Œçš„*æ•°ç»„ç±»æˆå‘˜ä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ç»“æœ...

ä½¿ç”¨ C++çš„å¥½å¤„:

*   æˆ‘ä»¬å¯ä»¥è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ä¸­çš„`free()`

*   ç”¨äºç›´æ¥è®¿é—®åˆ‡ç‰‡å…ƒç´ çš„æ‹¬å·ç¬¦å·ã€‚

*   æ„é€ å‡½æ•°é‡è½½è®©æˆ‘ä»¬è·å¾—ä¸ Go çš„`make()`ç›¸åŒçš„å‚æ•°(å¯ä»¥çœç•¥å®¹é‡)

*   C++11 ä¸ºå˜é‡å‚æ•°å¼•å…¥äº†å‚æ•°åŒ…ï¼Œè¿™ä¸ªå¥½å®¶ä¼™åœ¨è¿™é‡Œåšäº†å¾ˆå¥½çš„è§£é‡Šã€‚æˆ‘å¹¶ä¸çƒ­è¡·äºä½¿ç”¨é€’å½’ï¼Œä½†æ˜¯å®é™…ä¸Šä½ æ°¸è¿œä¸ä¼šåœ¨ä¸€ä¸ªè°ƒç”¨ä¸­æ·»åŠ è¶³å¤Ÿçš„å…ƒç´ æ¥æº¢å‡ºå †æ ˆã€‚

## [](#the-end)ç»“æŸ

æ€»ä¹‹ï¼Œä¸è¦è¿™æ ·ã€‚æ‚¨æ²¡æœ‰ Go åˆ‡ç‰‡çš„æ–¹ä¾¿è¯­æ³•ï¼Œä¹Ÿæ²¡æœ‰ Go å­—ç¬¦ä¸²å’Œ`[]byte`æˆ–`[]rune`ä¹‹é—´è½¬æ¢çš„çµæ´»æ€§ï¼ŒåŒæ—¶è¿˜å¿…é¡»ç®¡ç†è‡ªå·±çš„å†…å­˜ã€‚æ€»æ˜¯`realloc()`å¯¹æ€§èƒ½æ²¡æœ‰å¥½å¤„ï¼Œå¦‚æœä½ å¿˜è®°`free()`æ¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œä½ å°†ä¼šæ³„æ¼å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæ¯æ¬¡åˆ‡ç‰‡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ã€‚åŒæ ·ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ C++åªéœ€ä½¿ç”¨ [std::vector](https://en.cppreference.com/w/cpp/container/vector) å¦åˆ™æ£€æŸ¥[å¼¹æ€§ç¼“å†²åŒº](https://github.com/nothings/stb/blob/master/stretchy_buffer.h)ã€‚è¿™ä¸¤ç¯‡æ–‡ç« éƒ½æ£€æŸ¥äº† OOM æ¡ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰åœ¨ 30 åˆ†é’Ÿå†…è¢«æ‹¼å‡‘èµ·æ¥ä¸ºä¸€ä¸ªç”šè‡³ä¸æ˜¯çœŸæ­£ç³»åˆ—çš„ç³»åˆ—å†™ä¸€ç¯‡åç»­æ–‡ç« ã€‚