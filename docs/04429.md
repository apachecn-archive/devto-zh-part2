# Swift ä¸­çš„åŒæ­¥å’Œå¼‚æ­¥ä»£ç 

> åŸæ–‡:[https://dev.to/onmyway133/sync-and-async-code-in-swift-kn4](https://dev.to/onmyway133/sync-and-async-code-in-swift-kn4)

[![](../Images/afa67faa34edfd8e25992ddbd67f4a86.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--K6LAkRcr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1600/0%2AHevKOVykUzRprufo)

æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ DispatchQueue æ¥æ„å»ºçº¿ç¨‹å®‰å…¨ä»£ç ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åŒæ—¶å‘ç”Ÿä¸¤ä¸ªè¯»å’Œå†™æ“ä½œï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®æŸåå’Œæ„å¤–è¡Œä¸ºã€‚è¯·æ³¨æ„ï¼Œæ‚¨åº”è¯¥å°½é‡é¿å…æ­»é”[stack overflow . com/questions/15381209/how-do-I-create-a-deadlock-in-grand-central-dispatch](https://stackoverflow.com/questions/15381209/how-do-i-create-a-deadlock-in-grand-central-dispatch)

## å…¨éƒ¨åŒæ­¥

ä½¿ç”¨ try catch å’Œä¸²è¡Œé˜Ÿåˆ—ã€‚ä½¿ç”¨åŒæ­¥åŠŸèƒ½é˜»å¡å½“å‰é˜Ÿåˆ—ã€‚

```
func getUser(id: String) throws -> User {

  var user: User!

  try serialQueue.sync {

    user = try storage.getUser(id)

  }

è¿”å›ç”¨æˆ·
 }

func setUser(_ User:User)throws {
try serial queue . sync {
try storage . setUser(User)
}
} 
```

Enter fullscreen mode Exit fullscreen mode

## 
  
å…¨å¼‚æ­¥

ä½¿ç”¨ç»“æœï¼Œè·å¾—ä¸²è¡Œé˜Ÿåˆ—ã€‚ä½¿ç”¨å¼‚æ­¥å‡½æ•°è¿”å›å½“å‰é˜Ÿåˆ—ã€‚

```
enum Result<T> {

  case value(T)

  case error(Error)

}

func getUser(id: Stringï¼Œcompletion:(ç»“æœ<user>)-Void){
try serial queue . async {
do {
user = try storage . getUser(id)
completion(ã€‚å€¼(ç”¨æˆ·))
 } catch { 
å®Œæˆ(ã€‚é”™è¯¯(error)) 
 } 
 }</user>

è¿”å›ç”¨æˆ·
 }

func setUser(_ user: Userï¼Œcompletion:(Result)-> Void){
try serial queue . async {
do {
try storage . setUser(User)
completion(ã€‚å€¼(())
 } catch { 
å®Œæˆ(ã€‚é”™è¯¯(error)) 
 } 
 } 
 } 
```

Enter fullscreen mode Exit fullscreen mode

## 
  
åŒæ­¥è¯»å–ï¼Œå¼‚æ­¥å†™å…¥

ä½¿ç”¨ try catch è¿›è¡Œè¯»å–ï¼Œä½¿ç”¨ Result è¿›è¡Œå†™å…¥ï¼Œå¹¶ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—ã€‚å¯¹è¯»å–ä½¿ç”¨ sync å‡½æ•°æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œè€Œå¯¹å†™å…¥ä½¿ç”¨å¸¦å±éšœæ ‡å¿—çš„ async å‡½æ•°æ¥è¿”å›å½“å‰é˜Ÿåˆ—ã€‚è¿™æœ‰åˆ©äºåœ¨æ²¡æœ‰å†™æ“ä½œçš„æƒ…å†µä¸‹ä¼˜å…ˆé€‰æ‹©å¤šæ¬¡è¯»æ“ä½œã€‚å½“æœ‰éšœç¢çš„å†™å…¥è¿›å…¥é˜Ÿåˆ—æ—¶ï¼Œå…¶ä»–æ“ä½œå¿…é¡»ç­‰å¾…ã€‚

```
func getUser(id: String) throws -> User {

  var user: User!

  try concurrentQueue.sync {

    user = try storage.getUser(id)

  }

è¿”å›ç”¨æˆ·
 }

func setUser(_ user: Userï¼Œcompletion:(Result)--> Void){
try concurrent queue . async(flags:ã€‚{ 
åšå±éšœ{ 
è¯•å‚¨. setUser(ç”¨æˆ·)
å®Œæˆ(ã€‚å€¼(())
 } catch { 
å®Œæˆ(ã€‚é”™è¯¯(error)) 
 } 
 } 
 } 
```

Enter fullscreen mode Exit fullscreen mode

## 
  
å¼‚æ­¥æµ‹è¯•

ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [dispatch_apply](https://developer.apple.com/documentation/dispatch/1453050-dispatch_apply) å‘è°ƒåº¦é˜Ÿåˆ—æäº¤ä¸€ä¸ªå—ä»¥è¿›è¡Œå¤šæ¬¡è°ƒç”¨ã€‚ä» Swift å¼€å§‹ï¼Œç­‰ä»·äº[å¹¶å‘æ‰§è¡Œ](https://developer.apple.com/documentation/dispatch/dispatchqueue/2016088-concurrentperform)

```
DispatchQueue.concurrentPerform(iterations: 1000) { index in

    let last = array.last ?? 0

    array.append(last + 1)

} 
```

Enter fullscreen mode Exit fullscreen mode

## 
  
å‚è€ƒ

*   [http://basememara.com/creating-thread-safe-arrays-in-swift](http://basememara.com/creating-thread-safe-arrays-in-swift/)

*   [oleb . net/blog/2013/07/parallelize-for-loops-gcd-dispatch _ apply](https://oleb.net/blog/2013/07/parallelize-for-loops-gcd-dispatch_apply/)

åŸå¸–[https://medium . com/fantageek/sync-and-async-code-in-swift-8 E6 BC 7 BD 5866](https://medium.com/fantageek/sync-and-async-code-in-swift-8e6bc7bd5866)

æ”¯æŒæˆ‘çš„åº”ç”¨ç¨‹åº

*   [æ¨é€ Hero -æµ‹è¯•æ¨é€é€šçŸ¥çš„çº¯ Swift åŸç”Ÿ macOS åº”ç”¨](https://onmyway133.com/pushhero)
*   [PastePal -ç²˜è´´æ¿ã€ä¾¿ç¬ºå’Œå¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/pastepal)
*   [å¿«é€Ÿæ£€æŸ¥-æ™ºèƒ½å¾…åŠäº‹é¡¹ç®¡ç†å™¨](https://onmyway133.com/quickcheck)
*   [Alias - App å’Œæ–‡ä»¶å¿«æ·æ–¹å¼ç®¡ç†å™¨](https://onmyway133.com/alias)
*   [æˆ‘çš„å…¶ä»–åº”ç”¨](https://onmyway133.com/apps/)

â¤ï¸â¤ï¸ğŸ˜‡ğŸ˜ğŸ¤˜â¤ï¸â¤ï¸