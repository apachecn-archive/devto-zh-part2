# ä»æµä¸­çš„é‡ç»„å’Œå†—ä½™è¿æ¥å™¨è¿›è¡Œé€‚å½“çš„ç±»å‹æ¨ç†

> åŸæ–‡:[https://dev . to/craftzdog/making-hoc-with-prop-type-inference-from-recompose-and-redux-connector-in-flow-3mij](https://dev.to/craftzdog/making-hoc-with-prop-type-inference-from-recompose-and-redux-connector-in-flow--3mij)

ä¼¼ä¹ react-redux çš„`connect`çš„ç±»å‹æ³¨é‡Šä¸é‡æ–°ç»„åˆçš„`HOC`ç±»å‹å£°æ˜ä¸å…¼å®¹ã€‚æˆ‘ç»å¸¸åœ¨`compose`å‡½æ•°ä¸­æŒ‡å®š`connect`æ—¶é‡åˆ°è¿™æ ·çš„é”™è¯¯:

```
const enhance: HOC<*, Props> = compose(
  connect(),
  pure, // <-- Flow error - Component: This type is incompatible with the expected param type of Component
  withHandlers({
    ...
  })
) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæˆ‘ä»å‚æ•°ä¸­åˆ é™¤`connect()`ï¼Œæµé‡è¯¯å·®æ¶ˆå¤±ã€‚å•Šï¼Ÿä½†æ˜¯åŒ…å«è¿™äº›ä»£ç çš„åº”ç”¨ç¨‹åºè¿è¡Œè‰¯å¥½ï¼Œæ‰€ä»¥æˆ‘çŒœåœ¨æµç±»å‹çš„å®šä¹‰ä¸­æœ‰ä¸€äº›é”™è¯¯ã€‚æˆ‘ä¸æƒ³ä¸ºè¿™ä¸ªé—®é¢˜æµªè´¹æ—¶é—´ã€‚

æ‰€ä»¥æˆ‘åˆ¶ä½œäº†ç®€å•çš„å®ç”¨å‡½æ•°ï¼Œä½¿`connect`ä¸`compose`å‡½æ•°å…¼å®¹ï¼Œè€Œæ­£ç¡®çš„ç±»å‹æ¨æ–­åœ¨åŸºæœ¬ç»„ä»¶ä¸­å·¥ä½œã€‚ä¸‹é¢çš„ä»£ç æ˜¯ä¸å¸¦å‚æ•°è°ƒç”¨`connect`çš„`getDispatch`å‡½æ•°ï¼Œæ‰€ä»¥å®ƒä¼šç®€å•åœ°å°†`dispatch`æ·»åŠ åˆ°åŸºç¡€ç»„ä»¶
çš„`props`

```
// @flow
import { type HOC } from 'recompose'
import { connect } from 'react-redux'
import type { Dispatch } from '../types'

type CHOC<E: {}> = HOC<{ ...$Exact<E>, dispatch: Dispatch }, E>

export default function getDispatch<Enhanced: {}>(): CHOC<Enhanced> {
  return (connect(): Function)
} 
```

Enter fullscreen mode Exit fullscreen mode

å¯ä»¥è¿™ä¹ˆç”¨:

```
const enhance: HOC<*, Props> = compose(
  withDispatch(),
  pure,
  withHandlers({
    ...
  })
) 
```

Enter fullscreen mode Exit fullscreen mode

è€Œä½ ä¼šå¾—åˆ°`props.dispatch`ã€‚

å½“ä½ æƒ³è®©å•†åº—æ˜ å°„åˆ°é“å…·æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„`connectStore`å‡½æ•°:

```
// @flow
import { type HOC } from 'recompose'
import { connect } from 'react-redux'
import type { Dispatch, State } from '../types'

type F<M> = (state: State) => M
type CHOC<E: {}, M> = HOC<{ ...$Exact<E>, dispatch: Dispatch, ...M }, E>

export default function connectStore<Enhanced: {}, M: *>(
  mapper: F<M>
): CHOC<Enhanced, M> {
  return (connect(mapper): Function)
} 
```

Enter fullscreen mode Exit fullscreen mode

å®ƒå¼ºåˆ¶å°†è¿æ¥å™¨å‡½æ•°çš„ç±»å‹è½¬æ¢ä¸ºé‡æ–°ç»„åˆçš„`HOC`ï¼Œå› æ­¤å®ƒå°†æ¯«æ— é—®é¢˜åœ°å·¥ä½œ:

```
const enhance: HOC<*, Props> = compose(
  connect(({ editingNote }) => ({ editingNote })),
  pure,
  withHandlers({
    ...
  })
)
const EnhancedComponent = enhance(props => {
  console.log(props.editingNote) // <-- type inference works!
}) 
```

Enter fullscreen mode Exit fullscreen mode

å¾ˆæ˜æ˜¾ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå˜é€šåŠæ³•ï¼Œç”šè‡³å¯èƒ½åœ¨æœªæ¥å´©æºƒï¼Œä½†å®ƒç®€åŒ–äº†æˆ‘çš„ä»£ç åº“ï¼Œç›®å‰å·¥ä½œè‰¯å¥½ã€‚æµç¨‹ä¸­çš„ç±»å‹æ¨ç†éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯ç±»å‹æ³¨é‡Šå¾€å¾€éå¸¸å¤æ‚ã€‚è¿™è®©æˆ‘æƒ³èµ·äº† C/C++ä¸­çš„å®åœ°ç‹±ğŸ™„