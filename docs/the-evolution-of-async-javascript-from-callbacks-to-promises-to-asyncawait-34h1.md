# å¼‚æ­¥ JavaScript çš„æ¼”å˜:ä»å›è°ƒï¼Œåˆ°æ‰¿è¯ºï¼Œå†åˆ°å¼‚æ­¥/ç­‰å¾…

> åŸæ–‡ï¼š<https://dev.to/tylermcginnis/the-evolution-of-async-javascript-from-callbacks-to-promises-to-asyncawait-34h1>

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæ‚¨å°†äº†è§£å†å²èƒŒæ™¯ä»¥åŠä¸‰ç§æœ€æµè¡Œçš„ JavaScript å¼‚æ­¥æ¨¡å¼â€”â€”å›è°ƒã€æ‰¿è¯ºå’Œå¼‚æ­¥/ç­‰å¾…â€”â€”èƒŒåçš„ä¼˜ç¼ºç‚¹ã€‚

* * *

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨ TylerMcGinnis.com å¤§å­¦ï¼Œæ˜¯ä»–ä»¬åœ¨ T2 å¤§å­¦é«˜çº§ JavaScript è¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚

* * *

### è§†é¢‘

[https://www.youtube.com/embed/gB-OmN1egV8](https://www.youtube.com/embed/gB-OmN1egV8)

### å²—ä½

æˆ‘æœ€å–œæ¬¢çš„ç½‘ç«™ä¹‹ä¸€æ˜¯[BerkshireHathaway.com](http://www.berkshirehathaway.com/)â€”â€”å®ƒç®€å•ã€æœ‰æ•ˆï¼Œè‡ª 1997 å¹´æ¨å‡ºä»¥æ¥ä¸€ç›´åšå¾—å¾ˆå¥½ã€‚æ›´å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿‡å»çš„ 20 å¹´é‡Œï¼Œè¿™ä¸ªç½‘ç«™å¾ˆæœ‰å¯èƒ½ä»æœªå‡ºç°è¿‡ä»»ä½•é—®é¢˜ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºéƒ½æ˜¯é™æ€çš„ã€‚è‡ª 20 å¤šå¹´å‰æ¨å‡ºä»¥æ¥ï¼Œå®ƒå‡ ä¹æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚äº‹å®è¯æ˜ï¼Œå¦‚æœä½ é¢„å…ˆå‡†å¤‡å¥½äº†æ‰€æœ‰çš„æ•°æ®ï¼Œé‚£ä¹ˆå»ºç«‹ç½‘ç«™æ˜¯ç›¸å½“ç®€å•çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç°åœ¨å¤§å¤šæ•°ç½‘ç«™éƒ½æ²¡æœ‰ã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å‘æ˜äº†â€œæ¨¡å¼â€æ¥å¤„ç†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·å–å¤–éƒ¨æ•°æ®ã€‚åƒå¤§å¤šæ•°äº‹æƒ…ä¸€æ ·ï¼Œè¿™äº›æ¨¡å¼éƒ½æœ‰éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜çš„æƒè¡¡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†æä¸‰ç§æœ€å¸¸è§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼Œ`Callbacks`ã€`Promises`å’Œ`Async/Await`ï¼Œå¹¶ä»å†å²çš„è§’åº¦è®¨è®ºå®ƒä»¬çš„æ„ä¹‰å’Œå‘å±•ã€‚

è®©æˆ‘ä»¬ä»è¿™äº›æ•°æ®è·å–æ¨¡å¼çš„ OG å¼€å§‹ï¼Œå›è°ƒã€‚

### å›è°ƒ

> æˆ‘å‡è®¾ä½ å¯¹å¤è¯•å®Œå…¨ä¸äº†è§£ã€‚å¦‚æœæˆ‘å‡è®¾é”™äº†ï¼Œå°±å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹ã€‚

å½“æˆ‘ç¬¬ä¸€æ¬¡å­¦ä¹ ç¼–ç¨‹æ—¶ï¼Œå®ƒå¸®åŠ©æˆ‘æŠŠå‡½æ•°æƒ³è±¡æˆæœºå™¨ã€‚è¿™äº›æœºå™¨å¯ä»¥åšä½ æƒ³è®©å®ƒä»¬åšçš„ä»»ä½•äº‹æƒ…ã€‚å®ƒä»¬ç”šè‡³å¯ä»¥æ¥å—è¾“å…¥å¹¶è¿”å›å€¼ã€‚æ¯å°æœºå™¨ä¸Šéƒ½æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå½“ä½ æƒ³è®©æœºå™¨è¿è½¬æ—¶ï¼Œä½ å¯ä»¥æŒ‰è¿™ä¸ªæŒ‰é’®ã€‚

```
function add (x, y) {
  return x + y
}

add(2,3) // 5 - Press the button, run the machine. 
```

Enter fullscreen mode Exit fullscreen mode

æ— è®ºæ˜¯**æˆ‘**æŒ‰ä¸‹æŒ‰é’®ï¼Œ**ä½ **æŒ‰ä¸‹æŒ‰é’®ï¼Œè¿˜æ˜¯**åˆ«äºº**æŒ‰ä¸‹æŒ‰é’®éƒ½æ— æ‰€è°“ã€‚ä¸ç®¡ä½ å–œæ¬¢ä¸å¦ï¼Œåªè¦æŒ‰ä¸‹æŒ‰é’®ï¼Œæœºå™¨å°±ä¼šè¿è½¬ã€‚

```
function add (x, y) {
  return x + y
}

const me = add
const you = add
const someoneElse = add

me(2,3) // 5 - Press the button, run the machine.
you(2,3) // 5 - Press the button, run the machine.
someoneElse(2,3) // 5 - Press the button, run the machine. 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†`add`å‡½æ•°åˆ†é…ç»™ä¸‰ä¸ªä¸åŒçš„å˜é‡ï¼Œ`me`ã€`you`å’Œ`someoneElse`ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€åˆçš„`add`å’Œæˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªå˜é‡éƒ½æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®ã€‚å®ƒä»¬åœ¨ä¸åŒçš„åç§°ä¸‹å®é™…ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„ä¸œè¥¿ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨`me`ã€`you`æˆ–`someoneElse`æ—¶ï¼Œå°±å¥½åƒæˆ‘ä»¬åœ¨è°ƒç”¨`add`ã€‚

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„`add`æœºå™¨ä¼ é€’ç»™å¦ä¸€å°æœºå™¨ä¼šæ€ä¹ˆæ ·ï¼Ÿè¯·è®°ä½ï¼Œè°æŒ‰()æŒ‰é’®å¹¶ä¸é‡è¦ï¼Œå¦‚æœæŒ‰äº†ï¼Œå®ƒå°±ä¼šè¿è¡Œã€‚

```
function add (x, y) {
  return x + y
}

function addFive (x, addReference) {
  return addReference(x, 5) // 15 - Press the button, run the machine.
}

addFive(10, add) // 15 
```

Enter fullscreen mode Exit fullscreen mode

ä½ çš„å¤§è„‘å¯èƒ½ä¼šå¯¹æ­¤æ„Ÿåˆ°æœ‰ç‚¹å¥‡æ€ªï¼Œä½†è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿ã€‚æˆ‘ä»¬æ²¡æœ‰åœ¨`add`ä¸Šâ€œæŒ‰ä¸‹æŒ‰é’®â€ï¼Œè€Œæ˜¯å°†`add`ä½œä¸ºå‚æ•°ä¼ é€’ç»™`addFive`ï¼Œå°†å…¶é‡å‘½åä¸º`addReference`ï¼Œç„¶åæˆ‘ä»¬â€œæŒ‰ä¸‹æŒ‰é’®â€æˆ–è°ƒç”¨å®ƒã€‚

è¿™çªå‡ºäº† JavaScript è¯­è¨€çš„ä¸€äº›é‡è¦æ¦‚å¿µã€‚é¦–å…ˆï¼Œæ­£å¦‚æ‚¨å¯ä»¥å°†å­—ç¬¦ä¸²æˆ–æ•°å­—ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†å¯¹å‡½æ•°çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ã€‚å½“ä½ è¿™æ ·åšçš„æ—¶å€™ï¼Œä½ ä½œä¸ºå‚æ•°ä¼ é€’çš„å‡½æ•°å«åš**å›è°ƒ**å‡½æ•°ï¼Œè€Œä½ ä¼ é€’å›è°ƒå‡½æ•°çš„å‡½æ•°å«åš**é«˜é˜¶å‡½æ•°**ã€‚

å› ä¸ºè¯æ±‡å¾ˆé‡è¦ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ç›¸åŒçš„ä»£ç ï¼Œå˜é‡è¢«é‡æ–°å‘½åä»¥åŒ¹é…å®ƒä»¬æ‰€æ¼”ç¤ºçš„æ¦‚å¿µã€‚

```
function add (x,y) {
  return x + y
}

function higherOrderFunction (x, callback) {
  return callback(x, 5)
}

higherOrderFunction(10, add) 
```

Enter fullscreen mode Exit fullscreen mode

è¿™ç§æ¨¡å¼åº”è¯¥çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œåˆ°å¤„éƒ½æ˜¯ã€‚å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨è¿‡ä»»ä½• JavaScript æ•°ç»„æ–¹æ³•ï¼Œé‚£ä¹ˆæ‚¨å°±ä½¿ç”¨è¿‡å›è°ƒã€‚å¦‚æœä½ ç”¨è¿‡ lodashï¼Œä½ å°±ç”¨è¿‡å›è°ƒã€‚å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨è¿‡ jQueryï¼Œé‚£ä¹ˆæ‚¨å°±ä½¿ç”¨è¿‡å›è°ƒã€‚

```
[1,2,3].map((i) => i + 5)

_.filter([1,2,3,4], (n) => n % 2 === 0 );

$('#btn').on('click', () =>
  console.log('Callbacks are everywhere')
) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸€èˆ¬æ¥è¯´ï¼Œå›è°ƒæœ‰ä¸¤ç§æµè¡Œçš„ç”¨ä¾‹ã€‚ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨`.map`å’Œ`_.filter`ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œæ˜¯å°†ä¸€ä¸ªå€¼è½¬æ¢æˆå¦ä¸€ä¸ªå€¼çš„å¾ˆå¥½çš„æŠ½è±¡ã€‚æˆ‘ä»¬è¯´â€œå˜¿ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªå‡½æ•°ã€‚ç»§ç»­ï¼Œæ ¹æ®æˆ‘ç»™ä½ çš„å‡½æ•°ç»™æˆ‘ä¸€ä¸ªæ–°çš„å€¼ã€‚ç¬¬äºŒç§ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ jQuery ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œæ˜¯å°†å‡½æ•°çš„æ‰§è¡Œå»¶è¿Ÿåˆ°ç‰¹å®šçš„æ—¶é—´ã€‚â€œå˜¿ï¼Œè¿™é‡Œæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚åªè¦å•å‡» id ä¸º`btn`çš„å…ƒç´ ï¼Œå°±è°ƒç”¨å®ƒã€‚â€æˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯ç¬¬äºŒä¸ªç”¨ä¾‹ï¼Œâ€œå°†ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´â€ã€‚

ç°åœ¨æˆ‘ä»¬åªçœ‹äº†åŒæ­¥çš„ä¾‹å­ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æœ¬æ–‡å¼€å§‹æ—¶æ‰€è®¨è®ºçš„ï¼Œæˆ‘ä»¬æ„å»ºçš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹¶æ²¡æœ‰é¢„å…ˆè·å¾—å®ƒä»¬éœ€è¦çš„æ‰€æœ‰æ•°æ®ã€‚ç›¸åï¼Œä»–ä»¬éœ€è¦åœ¨ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºäº¤äº’æ—¶è·å–å¤–éƒ¨æ•°æ®ã€‚æˆ‘ä»¬åˆšåˆšçœ‹åˆ°äº†å›è°ƒå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä½ â€œå»¶è¿Ÿä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œç›´åˆ°ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´â€ã€‚ä¸éš¾æƒ³è±¡ï¼Œæˆ‘ä»¬å¦‚ä½•å°†è¿™å¥è¯åº”ç”¨äºæ•°æ®è·å–ã€‚æˆ‘ä»¬å¯ä»¥å»¶è¿Ÿä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œ*ç›´åˆ°æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®*ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œç›´åˆ°*ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´*ã€‚è¿™å¯èƒ½æ˜¯æœ€æµè¡Œçš„ä¾‹å­ï¼ŒjQuery çš„`getJSON`æ–¹æ³•ã€‚

```
// updateUI and showError are irrelevant.
// Pretend they do what they sound like.

const id = 'tylermcginnis'

$.getJSON({
  url: `https://api.github.com/users/${id}`,
  success: updateUI,
  error: showError,
}) 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨è·å¾—ç”¨æˆ·æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬æ— æ³•æ›´æ–°åº”ç”¨ç¨‹åºçš„ UIã€‚é‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬è¯´ï¼Œâ€œå˜¿ï¼Œè¿™æœ‰ä¸ªä¸œè¥¿ã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œç»§ç»­è°ƒç”¨`success`ä¼ é€’ç”¨æˆ·æ•°æ®ã€‚å¦‚æœæ²¡æœ‰ï¼Œç»§ç»­è°ƒç”¨`error`å¹¶å‘å…¶ä¼ é€’é”™è¯¯å¯¹è±¡ã€‚æ‚¨ä¸éœ€è¦æ‹…å¿ƒæ¯ä¸ªæ–¹æ³•åšä»€ä¹ˆï¼Œåªè¦ç¡®ä¿åœ¨åº”è¯¥è°ƒç”¨å®ƒä»¬çš„æ—¶å€™è°ƒç”¨å®ƒä»¬å°±è¡Œäº†â€ã€‚è¿™æ˜¯å¯¹å¼‚æ­¥è¯·æ±‚ä½¿ç”¨å›è°ƒçš„å®Œç¾æ¼”ç¤ºã€‚

* * *

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä»€ä¹ˆæ˜¯å›è°ƒï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•åœ¨åŒæ­¥å’Œå¼‚æ­¥ä»£ç ä¸­å‘æŒ¥ä½œç”¨ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰è°ˆåˆ°çš„æ˜¯å›è°ƒçš„é˜´æš—é¢ã€‚çœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚ä½ èƒ½çœ‹å‡ºå‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ

```
// updateUI, showError, and getLocationURL are irrelevant.
// Pretend they do what they sound like.

const id = 'tylermcginnis'

$("#btn").on("click", () => {
  $.getJSON({
    url: `https://api.github.com/users/${id}`,
    success: (user) => {
      $.getJSON({
        url: getLocationURL(user.location.split(',')),
        success (weather) {
          updateUI({
            user,
            weather: weather.query.results
          })
        },
        error: showError,
      })
    },
    error: showError
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæœ‰å¸®åŠ©çš„è¯ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œç©ä¸€ä¸‹[ç°åœºç‰ˆ](https://codesandbox.io/s/v06mmo3j7l)ã€‚

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¢åŠ äº†å‡ å±‚å›è°ƒã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¯´åœ¨ç‚¹å‡» id ä¸º`btn`çš„å…ƒç´ ä¹‹å‰ï¼Œä¸è¦è¿è¡Œåˆå§‹ AJAX è¯·æ±‚ã€‚ä¸€æ—¦æŒ‰é’®è¢«ç‚¹å‡»ï¼Œæˆ‘ä»¬å°±å‘å‡ºç¬¬ä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœè¯¥è¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬ä¼šå‘å‡ºç¬¬äºŒä¸ªè¯·æ±‚ã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬è°ƒç”¨`updateUI`æ–¹æ³•ï¼Œå°†ä»ä¸¤ä¸ªè¯·æ±‚ä¸­è·å¾—çš„æ•°æ®ä¼ é€’ç»™å®ƒã€‚ä¸ç®¡ä½ ç¬¬ä¸€çœ¼æ˜¯å¦ç†è§£äº†ä»£ç ï¼Œå®¢è§‚åœ°è¯´ï¼Œå®ƒæ¯”ä¹‹å‰çš„ä»£ç è¦éš¾è¯»å¾—å¤šã€‚è¿™å°±æŠŠæˆ‘ä»¬å¸¦åˆ°äº†â€œå›è°ƒåœ°ç‹±â€è¿™ä¸ªè¯é¢˜ã€‚

ä½œä¸ºäººç±»ï¼Œæˆ‘ä»¬è‡ªç„¶ä¼šæŒ‰é¡ºåºæ€è€ƒã€‚å½“ä½ åœ¨åµŒå¥—çš„å›è°ƒå‡½æ•°ä¸­åµŒå¥—äº†å›è°ƒå‡½æ•°æ—¶ï¼Œå®ƒä¼šè¿«ä½¿ä½ è„±ç¦»è‡ªç„¶çš„æ€ç»´æ–¹å¼ã€‚å½“ä½ çš„è½¯ä»¶è¢«é˜…è¯»çš„æ–¹å¼å’Œä½ çš„è‡ªç„¶æ€ç»´æ–¹å¼ä¸ä¸€è‡´æ—¶ï¼Œé”™è¯¯å°±å‘ç”Ÿäº†ã€‚

åƒå¤§å¤šæ•°è½¯ä»¶é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸€æ ·ï¼Œè®©â€œå›è°ƒåœ°ç‹±â€å˜å¾—æ›´å®¹æ˜“ä½¿ç”¨çš„ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•æ˜¯æ¨¡å—åŒ–æ‚¨çš„ä»£ç ã€‚

```
function getUser(id, onSuccess, onFailure) {
  $.getJSON({
    url: `https://api.github.com/users/${id}`,
    success: onSuccess,
    error: onFailure
  })
}

function getWeather(user, onSuccess, onFailure) {
  $.getJSON({
    url: getLocationURL(user.location.split(',')),
    success: onSuccess,
    error: onFailure,
  })
}

$("#btn").on("click", () => {
  getUser("tylermcginnis", (user) => {
    getWeather(user, (weather) => {
      updateUI({
        user,
        weather: weather.query.results
      })
    }, showError)
  }, showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæœ‰å¸®åŠ©çš„è¯ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œç©ä¸€ä¸‹[ç°åœºç‰ˆ](https://codesandbox.io/s/m587rq0lox)ã€‚

å¥½å§ï¼Œå‡½æ•°åæœ‰åŠ©äºæˆ‘ä»¬ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯å®ƒåœ¨å®¢è§‚ä¸Šâ€œæ›´å¥½â€å—ï¼Ÿå·®ä¸äº†å¤šå°‘ã€‚æˆ‘ä»¬å·²ç»åœ¨å›è°ƒåœ°ç‹±çš„å¯è¯»æ€§é—®é¢˜ä¸Šè´´äº†ä¸€ä¸ªåˆ›å¯è´´ã€‚é—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œæˆ‘ä»¬è‡ªç„¶åœ°é¡ºåºæ€è€ƒï¼Œå³ä½¿æœ‰äº†é¢å¤–çš„å‡½æ•°ï¼ŒåµŒå¥—å›è°ƒä¹Ÿæ‰“ç ´äº†é¡ºåºæ€è€ƒçš„æ–¹å¼ã€‚

* * *

å›è°ƒçš„ä¸‹ä¸€ä¸ªé—®é¢˜ä¸æ§åˆ¶åè½¬æœ‰å…³ã€‚å½“ä½ å†™ä¸€ä¸ªå›è°ƒå‡½æ•°æ—¶ï¼Œä½ å‡è®¾ä½ è¦å›è°ƒçš„ç¨‹åºæ˜¯è´Ÿè´£ä»»çš„ï¼Œå¹¶ä¸”ä¼šåœ¨åº”è¯¥è°ƒç”¨å®ƒçš„æ—¶å€™è°ƒç”¨å®ƒã€‚ä½ å®é™…ä¸Šæ˜¯æŠŠä½ çš„ç¨‹åºçš„æ§åˆ¶æƒè½¬äº¤ç»™å¦ä¸€ä¸ªç¨‹åºã€‚å½“æ‚¨å¤„ç†åƒ jQueryã€lodash ç”šè‡³æ™®é€š JavaScript è¿™æ ·çš„åº“æ—¶ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‡è®¾å›è°ƒå‡½æ•°å°†åœ¨æ­£ç¡®çš„æ—¶é—´ä½¿ç”¨æ­£ç¡®çš„å‚æ•°è¢«è°ƒç”¨ã€‚ç„¶è€Œï¼Œå¯¹äºè®¸å¤šç¬¬ä¸‰æ–¹åº“æ¥è¯´ï¼Œå›è°ƒå‡½æ•°æ˜¯ä½ ä¸å®ƒä»¬äº¤äº’çš„æ¥å£ã€‚å®Œå…¨æœ‰å¯èƒ½çš„æ˜¯ï¼Œç¬¬ä¸‰æ–¹åº“å¯èƒ½ä¼šæœ‰æ„æˆ–æ— æ„åœ°ç ´åå®ƒä»¬ä¸æ‚¨çš„å›è°ƒçš„äº¤äº’æ–¹å¼ã€‚

```
function criticalFunction () {
  // It's critical that this function
  // gets called and with the correct
  // arguments.
}

thirdPartyLib(criticalFunction) 
```

Enter fullscreen mode Exit fullscreen mode

å› ä¸ºæ‚¨ä¸æ˜¯è°ƒç”¨`criticalFunction`çš„äººï¼Œæ‰€ä»¥æ‚¨æ— æ³•æ§åˆ¶è°ƒç”¨å®ƒçš„æ—¶é—´å’Œå‚æ•°ã€‚*å¤§å¤šæ•°æƒ…å†µä¸‹*è¿™ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½†ä¸€æ—¦å‡ºç°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚

* * *

### æ‰¿è¯º

ä½ æ›¾ç»æ²¡æœ‰é¢„çº¦å°±å»ä¸€å®¶ç¹å¿™çš„é¤é¦†å—ï¼Ÿå½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œé¤é¦†éœ€è¦ä¸€ç§æ–¹æ³•åœ¨æ¡Œå­ç©ºå‡ºæ¥æ—¶ä¸ä½ è”ç³»ã€‚å†å²ä¸Šï¼Œå½“ä½ çš„æ¡Œå­å‡†å¤‡å¥½äº†ï¼Œä»–ä»¬ä¼šå«ä½ çš„åå­—å¹¶å¤§å£°å–Šå‡ºæ¥ã€‚ç„¶åï¼Œè‡ªç„¶è€Œç„¶åœ°ï¼Œä»–ä»¬å†³å®šå¼€å§‹å˜å¾—æ–°å¥‡èµ·æ¥ã€‚ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯ï¼Œä»–ä»¬ä¸ä¼šè®°ä¸‹ä½ çš„åå­—ï¼Œè€Œæ˜¯è®°ä¸‹ä½ çš„ç”µè¯å·ç ï¼Œä¸€æ—¦æœ‰ç©ºæ¡Œå°±å‘çŸ­ä¿¡ç»™ä½ ã€‚è¿™è®©ä½ ä¸åœ¨å¤§å–Šå¤§å«çš„èŒƒå›´å†…ï¼Œä½†æ›´é‡è¦çš„æ˜¯ï¼Œè¿™è®©ä»–ä»¬å¯ä»¥éšæ—¶åœ¨ä½ çš„æ‰‹æœºä¸ŠæŠ•æ”¾å¹¿å‘Šã€‚å¬èµ·æ¥ç†Ÿæ‚‰å—ï¼Ÿåº”è¯¥çš„ï¼å¥½å§ï¼Œä¹Ÿè®¸ä¸åº”è¯¥ã€‚æ˜¯æš—å–»å›è°ƒï¼æŠŠä½ çš„å·ç ç»™é¤é¦†å°±åƒç»™ç¬¬ä¸‰æ–¹æœåŠ¡ä¸€ä¸ªå›æ‹¨åŠŸèƒ½ã€‚ä½ *æœŸæœ›*é¤é¦†åœ¨æœ‰ç©ºä½æ—¶ç»™ä½ å‘çŸ­ä¿¡ï¼Œå°±åƒä½ *æœŸæœ›*ç¬¬ä¸‰æ–¹æœåŠ¡åœ¨ä»–ä»¬è¯´çš„æ—¶é—´å’Œæ–¹å¼è°ƒç”¨ä½ çš„åŠŸèƒ½ä¸€æ ·ã€‚ä¸€æ—¦ä½ çš„å·ç æˆ–å›æ‹¨åŠŸèƒ½è½å…¥ä»–ä»¬æ‰‹ä¸­ï¼Œä½ å°±å¤±å»äº†æ‰€æœ‰çš„æ§åˆ¶æƒã€‚

è°¢å¤©è°¢åœ°ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡è®¾è®¡ï¼Œå®ƒå…è®¸æ‚¨ä¿æŒæ‰€æœ‰çš„æ§åˆ¶ã€‚ä½ å¯èƒ½ä»¥å‰ä¹Ÿç»å†è¿‡â€”â€”å°±æ˜¯ä»–ä»¬ç»™ä½ çš„é‚£ä¸ªå°èœ‚é¸£å™¨ã€‚ä½ çŸ¥é“ï¼Œè¿™ä¸ªã€‚

[![Restaurant Buzzer](img/3b595007dc80ed4b11d7781399cdb623.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--rBmecrKO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://tylermcginnis.cimg/posts/advanced-javascript/buzzy.png)

å¦‚æœä½ ä»¥å‰ä»æœªç”¨è¿‡ï¼Œè¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ã€‚ä»–ä»¬æ²¡æœ‰è®°ä¸‹ä½ çš„åå­—æˆ–å·ç ï¼Œè€Œæ˜¯ç»™äº†ä½ è¿™ä¸ªè£…ç½®ã€‚å½“è®¾å¤‡å¼€å§‹å‘å‡ºå—¡å—¡å£°å¹¶å‘å…‰æ—¶ï¼Œæ‚¨çš„æ¡Œå­å°±å‡†å¤‡å¥½äº†ã€‚ä½ ä»ç„¶å¯ä»¥åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼Œå› ä¸ºä½ åœ¨ç­‰å¾…ä½ çš„æ¡Œå­ç©ºå‡ºæ¥ï¼Œä½†æ˜¯ç°åœ¨ä½ ä¸å¿…æ”¾å¼ƒä»»ä½•ä¸œè¥¿ã€‚å…¶å®æ°æ°ç›¸åã€‚ä»–ä»¬å¿…é¡»ç»™**ä½ **ä¸€äº›ä¸œè¥¿ã€‚æ²¡æœ‰æ§åˆ¶åè½¬ã€‚

èœ‚é¸£å™¨å°†å§‹ç»ˆå¤„äºä¸‰ç§ä¸åŒçŠ¶æ€ä¹‹ä¸€- `pending`ã€`fulfilled`æˆ–`rejected`ã€‚

`pending`æ˜¯é»˜è®¤çš„åˆå§‹çŠ¶æ€ã€‚å½“ä»–ä»¬ç»™ä½ èœ‚é¸£å™¨çš„æ—¶å€™ï¼Œå®ƒå°±åœ¨è¿™ä¸ªçŠ¶æ€ã€‚

å½“èœ‚é¸£å™¨é—ªçƒæ—¶ï¼Œè¡¨ç¤ºæ‚¨çš„æ¡Œå­å‡†å¤‡å¥½äº†ã€‚

`rejected`å‡ºç°æ•…éšœæ—¶èœ‚é¸£å™¨æ‰€å¤„çš„çŠ¶æ€ã€‚ä¹Ÿè®¸é¤å…å°±è¦æ‰“çƒŠäº†ï¼Œæˆ–è€…ä»–ä»¬å¿˜äº†æœ‰äººæŠŠé¤å…ç§Ÿå‡ºå»è¿‡å¤œäº†ã€‚

å†æ¬¡å¼ºè°ƒï¼Œé‡è¦çš„æ˜¯è¦è®°ä½ï¼Œä½ ï¼Œèœ‚é¸£å™¨çš„æ¥æ”¶è€…ï¼Œæ‹¥æœ‰æ‰€æœ‰çš„æ§åˆ¶æƒã€‚å¦‚æœèœ‚é¸£å™¨è¿›å…¥`fulfilled`ï¼Œä½ å¯ä»¥å›åˆ°ä½ çš„æ¡Œå­ã€‚å¦‚æœå®ƒè¢«æ”¾å…¥`fulfilled`ä¸­ï¼Œè€Œä½ æƒ³å¿½ç•¥å®ƒï¼Œé…·ï¼Œä½ ä¹Ÿå¯ä»¥è¿™æ ·åšã€‚å¦‚æœå®ƒè¢«æ”¾è¿›`rejected`ï¼Œé‚£å°±ç³Ÿäº†ï¼Œä½†æ˜¯ä½ å¯ä»¥å»åˆ«çš„åœ°æ–¹åƒã€‚å¦‚æœä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Œå¹¶ä¸”åœç•™åœ¨`pending`ï¼Œä½ æ°¸è¿œä¹Ÿä¸ä¼šåƒä¸œè¥¿ï¼Œä½†æ˜¯ä½ å®é™…ä¸Šä»€ä¹ˆä¹Ÿæ²¡åƒã€‚

ç°åœ¨ä½ æ˜¯é¤å…èœ‚é¸£å™¨çš„å¤§å¸ˆäº†ï¼Œè®©æˆ‘ä»¬æŠŠè¿™äº›çŸ¥è¯†åº”ç”¨åˆ°é‡è¦çš„äº‹æƒ…ä¸Šã€‚

å¦‚æœç»™é¤é¦†ä½ çš„å·ç å°±åƒç»™ä»–ä»¬ä¸€ä¸ªå›æ‹¨åŠŸèƒ½ï¼Œé‚£ä¹ˆæ”¶åˆ°è¿™ä¸ªå°ç©æ„å„¿å°±åƒæ”¶åˆ°æ‰€è°“çš„â€œæ‰¿è¯ºâ€ã€‚

ä¸€å¦‚æ—¢å¾€ï¼Œè®©æˆ‘ä»¬ä»**ä¸ºä»€ä¹ˆ**è¯´èµ·ã€‚æ‰¿è¯ºä¸ºä»€ä¹ˆå­˜åœ¨ï¼Ÿå®ƒä»¬çš„å­˜åœ¨æ˜¯ä¸ºäº†ä½¿å¼‚æ­¥è¯·æ±‚çš„å¤æ‚æ€§æ›´æ˜“äºç®¡ç†ã€‚å°±åƒèœ‚é¸£å™¨ä¸€æ ·ï¼Œ`Promise`å¯ä»¥å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼Œ`pending`ã€`fulfilled`æˆ–`rejected`ã€‚ä¸èœ‚é¸£å™¨ä¸åŒçš„æ˜¯ï¼Œè¿™äº›çŠ¶æ€ä»£è¡¨çš„ä¸æ˜¯é¤å…é¤æ¡Œçš„çŠ¶æ€ï¼Œè€Œæ˜¯å¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€ã€‚

å¦‚æœå¼‚æ­¥è¯·æ±‚ä»åœ¨è¿›è¡Œä¸­ï¼Œ`Promise`çš„çŠ¶æ€å°†ä¸º`pending`ã€‚å¦‚æœå¼‚æ­¥è¯·æ±‚æˆåŠŸå®Œæˆï¼Œ`Promise`å°†å˜ä¸º`fulfilled`çŠ¶æ€ã€‚å¦‚æœå¼‚æ­¥è¯·æ±‚å¤±è´¥ï¼Œ`Promise`å°†å˜ä¸º`rejected`çŠ¶æ€ã€‚èœ‚é¸£å™¨çš„æ¯”å–»éå¸¸å‡†ç¡®ï¼Œå¯¹å§ï¼Ÿ

æ—¢ç„¶ä½ å·²ç»ç†è§£äº†æ‰¿è¯ºå­˜åœ¨çš„åŸå› ä»¥åŠå®ƒä»¬å¯èƒ½å¤„äºçš„ä¸åŒçŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ã€‚

1)ä½ å¦‚ä½•åˆ›é€ æ‰¿è¯ºï¼Ÿå¦‚ä½•æ”¹å˜æ‰¿è¯ºçš„çŠ¶æ€ï¼Ÿ
3)å½“æ‰¿è¯ºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½ å¦‚ä½•å€¾å¬ï¼Ÿ

##### 1)ä½ å¦‚ä½•åˆ›é€ æ‰¿è¯ºï¼Ÿ

è¿™ä¸ªå¾ˆç®€å•ã€‚æ‚¨åˆ›å»ºäº†ä¸€ä¸ª`Promise`çš„`new`å®ä¾‹ã€‚

```
const promise = new Promise() 
```

Enter fullscreen mode Exit fullscreen mode

##### 2)å¦‚ä½•æ”¹å˜æ‰¿è¯ºçš„çŠ¶æ€ï¼Ÿ

`Promise`æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ª(å›è°ƒ)å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†è¢«ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œ`resolve`å’Œ`reject`ã€‚

`resolve` -å…è®¸æ‚¨å°†æ‰¿è¯ºçŠ¶æ€æ›´æ”¹ä¸º`fulfilled`çš„åŠŸèƒ½

`reject` -å…è®¸æ‚¨å°†æ‰¿è¯ºçŠ¶æ€æ›´æ”¹ä¸º`rejected`çš„åŠŸèƒ½ã€‚

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`setTimeout`ç­‰å¾… 2 ç§’é’Ÿï¼Œç„¶åè°ƒç”¨`resolve`ã€‚è¿™å°†æŠŠæ‰¿è¯ºçš„çŠ¶æ€æ›´æ”¹ä¸º`fulfilled`ã€‚

```
const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve() // Change status to 'fulfilled'
  }, 2000)
}) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åˆ›å»ºæ‰¿è¯ºåç«‹å³è®°å½•å®ƒï¼Œç„¶ååœ¨è°ƒç”¨`resolve`åå¤§çº¦ 2 ç§’é’Ÿåå†æ¬¡è®°å½•æ¥çœ‹åˆ°è¿™ç§å˜åŒ–ã€‚

[![Use resolve to change the status of a promise to fulfilled](img/c02df26014e8dcffc837cca4400b69e9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--z0kgJ4o1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://tylermcginnis.cimg/posts/advanced-javascript/resolve.gif)

æ³¨æ„æ‰¿è¯ºä»`<pending>`åˆ°`<resolved>`ã€‚

#### å½“æ‰¿è¯ºçš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œä½ å¦‚ä½•å€¾å¬ï¼Ÿ

åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯æœ€é‡è¦çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“å¦‚ä½•åˆ›å»ºæ‰¿è¯ºå¹¶æ”¹å˜å…¶çŠ¶æ€ï¼Œè¿™å¾ˆé…·ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“åœ¨çŠ¶æ€æ”¹å˜åå¦‚ä½•åšä»»ä½•äº‹æƒ…ï¼Œè¿™å°±æ¯«æ— ä»·å€¼äº†ã€‚

æˆ‘ä»¬è¿˜æ²¡æœ‰è°ˆåˆ°çš„ä¸€ä»¶äº‹æ˜¯æ‰¿è¯ºåˆ°åº•æ˜¯ä»€ä¹ˆã€‚å½“æ‚¨åˆ›å»ºä¸€ä¸ª`new Promise`æ—¶ï¼Œæ‚¨å®é™…ä¸Šåªæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ—§ JavaScript å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œ`then`å’Œ`catch`ã€‚è¿™æ˜¯é’¥åŒ™ã€‚å½“æ‰¿è¯ºçš„çŠ¶æ€å˜ä¸º`fulfilled`æ—¶ï¼Œä¼ é€’ç»™`.then`çš„åŠŸèƒ½å°†è¢«è°ƒç”¨ã€‚å½“æ‰¿è¯ºçš„çŠ¶æ€å˜ä¸º`rejected`æ—¶ï¼Œä¼ é€’ç»™`.catch`çš„åŠŸèƒ½å°†è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ä½ åˆ›å»ºäº†ä¸€ä¸ªæ‰¿è¯ºï¼Œå¦‚æœå¼‚æ­¥è¯·æ±‚æˆåŠŸï¼Œä½ å°†æŠŠä½ æƒ³è¦è¿è¡Œçš„å‡½æ•°ä¼ é€’ç»™`.then`ã€‚å¦‚æœå¼‚æ­¥è¯·æ±‚å¤±è´¥ï¼Œæ‚¨å°†ä¼ é€’æƒ³è¦è¿è¡Œçš„å‡½æ•°åˆ°`.catch`ã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨`setTimeout`åœ¨ä¸¤ç§’é’Ÿ(2000 æ¯«ç§’)åå°†æ‰¿è¯ºçš„çŠ¶æ€æ›´æ”¹ä¸º`fulfilled`ã€‚

```
function onSuccess () {
  console.log('Success!')
}

function onError () {
  console.log('ğŸ’©')
}

const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve()
  }, 2000)
})

promise.then(onSuccess)
promise.catch(onError) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæ‚¨è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å¤§çº¦ 2 ç§’é’Ÿåï¼Œæ‚¨ä¼šçœ‹åˆ°â€œæˆåŠŸï¼â€åœ¨æ§åˆ¶å°é‡Œã€‚å†æ¬¡è¯´æ˜ï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› æœ‰ä¸¤ä¸ªã€‚é¦–å…ˆï¼Œå½“æˆ‘ä»¬åˆ›å»ºæ‰¿è¯ºæ—¶ï¼Œæˆ‘ä»¬åœ¨å¤§çº¦ 2000 æ¯«ç§’åè°ƒç”¨äº†`resolve`â€”â€”è¿™å°†æ‰¿è¯ºçš„çŠ¶æ€æ›´æ”¹ä¸º`fulfilled`ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å°†`onSuccess`å‡½æ•°ä¼ é€’ç»™äº† promises çš„`.then`æ–¹æ³•ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å‘Šè¯‰æ‰¿è¯ºåœ¨æ‰¿è¯ºçš„çŠ¶æ€å˜ä¸º`fulfilled`æ—¶è°ƒç”¨`onSuccess`ï¼Œè¿™åœ¨å¤§çº¦ 2000 æ¯«ç§’åå‘ç”Ÿäº†ã€‚

ç°åœ¨è®©æˆ‘ä»¬å‡è®¾å‘ç”Ÿäº†ä¸å¥½çš„äº‹æƒ…ï¼Œæˆ‘ä»¬æƒ³å°†æ‰¿è¯ºçš„çŠ¶æ€æ›´æ”¹ä¸º`rejected`ã€‚æˆ‘ä»¬ä¸å«`resolve`ï¼Œè€Œæ˜¯å«`reject`ã€‚

```
function onSuccess () {
  console.log('Success!')
}

function onError () {
  console.log('ğŸ’©')
}

const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    reject()
  }, 2000)
})

promise.then(onSuccess)
promise.catch(onError) 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ¬¡ä¸æ˜¯è°ƒç”¨`onSuccess`å‡½æ•°ï¼Œè€Œæ˜¯è°ƒç”¨`onError`å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬è°ƒç”¨äº†`reject`ã€‚

* * *

ç°åœ¨æ‚¨å·²ç»äº†è§£äº† Promise APIï¼Œè®©æˆ‘ä»¬å¼€å§‹çœ‹ä¸€äº›çœŸæ­£çš„ä»£ç ã€‚

è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æœ€åä¸€ä¸ªå¼‚æ­¥å›è°ƒä¾‹å­å—ï¼Ÿ

```
function getUser(id, onSuccess, onFailure) {
  $.getJSON({
    url: `https://api.github.com/users/${id}`,
    success: onSuccess,
    error: onFailure
  })
}

function getWeather(user, onSuccess, onFailure) {
  $.getJSON({
    url: getLocationURL(user.location.split(',')),
    success: onSuccess,
    error: onFailure,
  })
}

$("#btn").on("click", () => {
  getUser("tylermcginnis", (user) => {
    getWeather(user, (weather) => {
      updateUI({
        user,
        weather: weather.query.results
      })
    }, showError)
  }, showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ Promise API æ¥ä»£æ›¿å›è°ƒï¼Ÿå¦‚æœæˆ‘ä»¬å°† AJAX è¯·æ±‚åŒ…è£…åœ¨æ‰¿è¯ºä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿç„¶åæˆ‘ä»¬å¯ä»¥æ ¹æ®è¯·æ±‚çš„è¿›å±•ç®€å•åœ°é€‰æ‹©`resolve`æˆ–`reject`ã€‚è®©æˆ‘ä»¬ä»`getUser`å¼€å§‹ã€‚

```
function getUser(id) {
  return new Promise((resolve, reject) => {
    $.getJSON({
      url: `https://api.github.com/users/${id}`,
      success: resolve,
      error: reject
    })
  })
} 
```

Enter fullscreen mode Exit fullscreen mode

å¾ˆå¥½ã€‚æ³¨æ„`getUser`çš„å‚æ•°å·²ç»æ”¹å˜ã€‚å®ƒä¸æ¥æ”¶`id`ã€`onSuccess`ã€`onFailure`ï¼Œåªæ¥æ”¶`id`ã€‚ä¸å†éœ€è¦å¦å¤–ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†åè½¬æ§åˆ¶ã€‚ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨ Promise çš„`resolve`å’Œ`reject`å‡½æ•°ã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå°†è°ƒç”¨`resolve`ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œå°†è°ƒç”¨`reject`ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬é‡æ„`getWeather`ã€‚æˆ‘ä»¬å°†éµå¾ªåŒæ ·çš„ç­–ç•¥ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`resolve`å’Œ`reject`ï¼Œè€Œä¸æ˜¯ä½¿ç”¨`onSuccess`å’Œ`onFailure`å›è°ƒå‡½æ•°ã€‚

```
function getWeather(user) {
  return new Promise((resolve, reject) => {
    $.getJSON({
      url: getLocationURL(user.location.split(',')),
      success: resolve,
      error: reject,
    })
  })
} 
```

Enter fullscreen mode Exit fullscreen mode

çœ‹èµ·æ¥ä¸é”™ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°çš„æœ€åä¸€ä»¶äº‹æ˜¯æˆ‘ä»¬çš„ç‚¹å‡»å¤„ç†ç¨‹åºã€‚è®°ä½ï¼Œè¿™æ˜¯æˆ‘ä»¬æƒ³è¦çš„æµç¨‹ã€‚

1)ä» Github API è·å–ç”¨æˆ·çš„ä¿¡æ¯ã€‚2)ä½¿ç”¨ç”¨æˆ·çš„ä½ç½®ä»é›…è™å¤©æ°” API è·å–å¤©æ°”ä¿¡æ¯ã€‚3)ç”¨ç”¨æˆ·ä¿¡æ¯å’Œä»–ä»¬çš„å¤©æ°”æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚

è®©æˆ‘ä»¬ä»#1 å¼€å§‹â€”â€”ä» Github API è·å–ç”¨æˆ·ä¿¡æ¯ã€‚

```
$("#btn").on("click", () => {
  const userPromise = getUser('tylermcginnis')

  userPromise.then((user) => {

  })

  userPromise.catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

æ³¨æ„ï¼Œç°åœ¨ä¸æ˜¯`getUser`æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯å®ƒè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªå¯ä»¥è°ƒç”¨`.then`å’Œ`.catch`çš„æ‰¿è¯ºã€‚å¦‚æœ`.then`è¢«è°ƒç”¨ï¼Œå®ƒå°†è¢«ç”¨æˆ·çš„ä¿¡æ¯è°ƒç”¨ã€‚å¦‚æœ`.catch`è¢«è°ƒç”¨ï¼Œå®ƒå°†è¢«é”™è¯¯è°ƒç”¨ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åš#2 -ä½¿ç”¨ç”¨æˆ·çš„ä½ç½®æ¥è·å–ä»–ä»¬çš„å¤©æ°”ã€‚

```
$("#btn").on("click", () => {
  const userPromise = getUser('tylermcginnis')

  userPromise.then((user) => {
    const weatherPromise = getWeather(user)
    weatherPromise.then((weather) => {

    })

    weatherPromise.catch(showError)
  })

  userPromise.catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

æ³¨æ„ï¼Œæˆ‘ä»¬éµå¾ªäº†ä¸#1 ä¸­å®Œå…¨ç›¸åŒçš„æ¨¡å¼ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è°ƒç”¨äº†`getWeather`,å°†ä»`userPromise`è·å¾—çš„`user`å¯¹è±¡ä¼ é€’ç»™å®ƒã€‚

æœ€åï¼Œ#3 -ç”¨ç”¨æˆ·ä¿¡æ¯å’Œä»–ä»¬çš„å¤©æ°”æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚

```
$("#btn").on("click", () => {
  const userPromise = getUser('tylermcginnis')

  userPromise.then((user) => {
    const weatherPromise = getWeather(user)
    weatherPromise.then((weather) => {
      updateUI({
        user,
        weather: weather.query.results
      })
    })

    weatherPromise.catch(showError)
  })

  userPromise.catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œæ˜¯å®Œæ•´çš„ä»£ç ï¼Œä½ å¯ä»¥éšæ„ä½¿ç”¨ã€‚

æˆ‘ä»¬çš„æ–°ä»£ç æ˜¯*æ›´å¥½çš„*ï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸€äº›æˆ‘ä»¬å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚åœ¨æˆ‘ä»¬åšå‡ºè¿™äº›æ”¹è¿›ä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£æ‰¿è¯ºçš„å¦å¤–ä¸¤ä¸ªç‰¹æ€§ï¼Œå°†å‚æ•°ä»`resolve`é“¾æ¥å’Œä¼ é€’åˆ°`then`ã€‚

#### é“¾æ¥

`.then`å’Œ`.catch`éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ‰¿è¯ºã€‚è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå°ç»†èŠ‚ï¼Œä½†å®ƒå¾ˆé‡è¦ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ‰¿è¯ºå¯ä»¥è¢«é”ä½ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨`getPromise`,å®ƒè¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¿™ä¸ªæ‰¿è¯ºå°†åœ¨è‡³å°‘ 2000 æ¯«ç§’å†…è§£å†³ã€‚ä»é‚£é‡Œï¼Œå› ä¸º`.then`å°†è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å°†æˆ‘ä»¬çš„`.then`é“¾æ¥åœ¨ä¸€èµ·ï¼Œç›´åˆ°æˆ‘ä»¬æŠ›å‡ºä¸€ä¸ª`new Error`ï¼Œå®ƒè¢«`.catch`æ–¹æ³•æ•è·ã€‚

```
function getPromise () {
  return new Promise((resolve) => {
    setTimeout(resolve, 2000)
  })
}

function logA () {
  console.log('A')
}

function logB () {
  console.log('B')
}

function logCAndThrow () {
  console.log('C')

  throw new Error()
}

function catchError () {
  console.log('Error!')
}

getPromise()
  .then(logA) // A
  .then(logB) // B
  .then(logCAndThrow) // C
  .catch(catchError) // Error! 
```

Enter fullscreen mode Exit fullscreen mode

é…·ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦å‘¢ï¼Ÿè¿˜è®°å¾—åœ¨å›æ‹¨éƒ¨åˆ†ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†å›æ‹¨çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå®ƒä»¬è¿«ä½¿ä½ è„±ç¦»è‡ªç„¶çš„ã€é¡ºåºçš„æ€ç»´æ–¹å¼ã€‚å½“ä½ æŠŠæ‰¿è¯ºä¸²è”èµ·æ¥æ—¶ï¼Œå®ƒä¸ä¼šå¼ºè¿«ä½ è„±ç¦»è‡ªç„¶çš„æ€ç»´æ–¹å¼ï¼Œå› ä¸ºä¸²è”èµ·æ¥çš„æ‰¿è¯ºæ˜¯è¿ç»­çš„ã€‚`getPromise runs then logA runs then logB runs then...`ã€‚

ä¸ºäº†è®©ä½ èƒ½çœ‹åˆ°æ›´å¤šçš„ä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå½“ä½ ä½¿ç”¨`fetch` API æ—¶çš„å¸¸è§ç”¨ä¾‹ã€‚`fetch`å°†è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¯¥æ‰¿è¯ºå°†é€šè¿‡ HTTP å“åº”æ¥è§£å†³ã€‚è¦è·å¾—å®é™…çš„ JSONï¼Œæ‚¨éœ€è¦è°ƒç”¨`.json`ã€‚å› ä¸ºæœ‰äº†é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰é¡ºåºæ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚

```
fetch('/api/user.json')
  .then((response) => response.json())
  .then((user) => {
    // user is now ready to go.
  }) 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†é“¾æ¥ï¼Œè®©æˆ‘ä»¬é‡æ„å‰é¢çš„`getUser` / `getWeather`ä»£ç æ¥ä½¿ç”¨å®ƒã€‚

```
function getUser(id) {
  return new Promise((resolve, reject) => {
    $.getJSON({
      url: `https://api.github.com/users/${id}`,
      success: resolve,
      error: reject
    })
  })
}

function getWeather(user) {
  return new Promise((resolve, reject) => {
    $.getJSON({
      url: getLocationURL(user.location.split(',')),
      success: resolve,
      error: reject,
    })
  })
}

$("#btn").on("click", () => {
  getUser("tylermcginnis")
    .then(getWeather)
    .then((weather) => {
      // We need both the user and the weather here.
      // Right now we just have the weather
      updateUI() // ????
    })
    .catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

çœ‹èµ·æ¥å¥½å¤šäº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ã€‚ä½ èƒ½å‘ç°å®ƒå—ï¼Ÿåœ¨ç¬¬äºŒä¸ª`.then`ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦è°ƒç”¨`updateUI`ã€‚é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡ T2ã€T3 å’Œ T4ã€‚ç›®å‰æˆ‘ä»¬æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Œæˆ‘ä»¬åªæ¥æ”¶åˆ°`weather`ï¼Œè€Œä¸æ˜¯`user`ã€‚æˆ‘ä»¬éœ€è¦æƒ³å‡ºä¸€ç§æ–¹æ³•æ¥å®ç°å®ƒï¼Œè¿™æ ·`getWeather`è¿”å›çš„æ‰¿è¯ºå°±å¯ä»¥é€šè¿‡`user`å’Œ`weather`æ¥è§£å†³ã€‚

è¿™æ˜¯é’¥åŒ™ã€‚`resolve`åªæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ‚¨ä¼ é€’ç»™å®ƒçš„ä»»ä½•å‚æ•°éƒ½å°†è¢«ä¼ é€’ç»™èµ‹äºˆ`.then`çš„å‡½æ•°ã€‚è¿™æ„å‘³ç€åœ¨`getWeather`å†…éƒ¨ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±è°ƒç”¨`resolve`ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™å®ƒ`weather`å’Œ`user`ã€‚ç„¶åï¼Œæˆ‘ä»¬é“¾ä¸­çš„ç¬¬äºŒä¸ª`.then`æ–¹æ³•å°†æ¥æ”¶`user`å’Œ`weather`ä½œä¸ºå‚æ•°ã€‚

```
function getWeather(user) {
  return new Promise((resolve, reject) => {
    $.getJSON({
      url: getLocationURL(user.location.split(',')),
      success(weather) {
        resolve({ user, weather: weather.query.results })
      },
      error: reject,
    })
  })
}

$("#btn").on("click", () => {
  getUser("tylermcginnis")
    .then(getWeather)
    .then((data) => {
      // Now, data is an object with a
      // "weather" property and a "user" property.

      updateUI(data)
    })
    .catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

> ä½ å¯ä»¥åœ¨è¿™é‡Œç©[æœ€ç»ˆä»£ç ](https://codesandbox.io/s/9lkl75vqxw)

åœ¨æˆ‘ä»¬çš„ç‚¹å‡»å¤„ç†ç¨‹åºä¸­ï¼Œä½ ä¼šçœŸæ­£çœ‹åˆ°æ‰¿è¯ºçš„åŠ›é‡æ¯”å›è°ƒæ›´å¤§ã€‚

```
// Callbacks ğŸš«
getUser("tylermcginnis", (user) => {
  getWeather(user, (weather) => {
    updateUI({
      user,
      weather: weather.query.results
    })
  }, showError)
}, showError)

// Promises âœ…
getUser("tylermcginnis")
  .then(getWeather)
  .then((data) => updateUI(data))
  .catch(showError); 
```

Enter fullscreen mode Exit fullscreen mode

éµå¾ªè¿™ç§é€»è¾‘æ„Ÿè§‰å¾ˆè‡ªç„¶ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬ä¹ æƒ¯çš„æ€ç»´æ–¹å¼ã€‚`getUser then getWeather then update the UI with the data`ã€‚

* * *

ç°åœ¨å¾ˆæ˜æ˜¾ï¼Œæ‰¿è¯ºæå¤§åœ°å¢åŠ äº†æˆ‘ä»¬å¼‚æ­¥ä»£ç çš„å¯è¯»æ€§ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©å®ƒå˜å¾—æ›´å¥½å‘¢ï¼Ÿå‡è®¾æ‚¨æ˜¯ TC39 å§”å‘˜ä¼šçš„æˆå‘˜ï¼Œå¹¶ä¸”æ‚¨æœ‰æƒä¸º JavaScript è¯­è¨€æ·»åŠ æ–°ç‰¹æ€§ã€‚å¦‚æœæœ‰çš„è¯ï¼Œä½ ä¼šé‡‡å–ä»€ä¹ˆæ­¥éª¤æ¥æ”¹è¿›è¿™äº›ä»£ç ï¼Ÿ

```
$("#btn").on("click", () => {
  getUser("tylermcginnis")
    .then(getWeather)
    .then((data) => updateUI(data))
    .catch(showError)
}) 
```

Enter fullscreen mode Exit fullscreen mode

æ­£å¦‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡çš„ï¼Œä»£ç è¯»èµ·æ¥éå¸¸å¥½ã€‚å°±åƒæˆ‘ä»¬çš„å¤§è„‘å·¥ä½œä¸€æ ·ï¼Œå®ƒæ˜¯æœ‰é¡ºåºçš„ã€‚æˆ‘ä»¬é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®(`users`)ä»ç¬¬ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ä¸€ç›´çº¿ç¨‹åŒ–åˆ°æœ€åä¸€ä¸ª`.then`ã€‚è¿™æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½†æ˜¯å®ƒè®©æˆ‘ä»¬æ”¹å˜äº†æˆ‘ä»¬çš„`getWeather`å‡½æ•°ï¼Œä¹Ÿä¼ é€’äº†`users`ã€‚å¦‚æœæˆ‘ä»¬ç”¨ç¼–å†™åŒæ­¥ä»£ç çš„æ–¹å¼æ¥ç¼–å†™å¼‚æ­¥ä»£ç ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼Œè¿™ä¸ªé—®é¢˜å°†å®Œå…¨æ¶ˆå¤±ï¼Œå®ƒä»ç„¶ä¼šæŒ‰é¡ºåºè¯»å–ã€‚æˆ‘æœ‰ä¸ªæƒ³æ³•ã€‚

```
$("#btn").on("click", () => {
  const user = getUser('tylermcginnis')
  const weather = getWeather(user)

  updateUI({
    user,
    weather,
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

é‚£å¤ªå¥½äº†ã€‚æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥å’ŒåŒæ­¥ä»£ç ä¸€æ¨¡ä¸€æ ·ã€‚æˆ‘ä»¬çš„å¤§è„‘ä¸éœ€è¦é‡‡å–é¢å¤–çš„æ­¥éª¤ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»éå¸¸ç†Ÿæ‚‰è¿™ç§æ€ç»´æ–¹å¼ã€‚å¯æ‚²çš„æ˜¯ï¼Œè¿™æ˜¾ç„¶è¡Œä¸é€šã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œ`user`å’Œ`weather`éƒ½åªæ˜¯æ‰¿è¯ºï¼Œå› ä¸ºé‚£æ˜¯`getUser`å’Œ`getWeather`è¿”å›çš„ã€‚ä½†æ˜¯è®°ä½ï¼Œæˆ‘ä»¬åœ¨ TC39 ä¸Šã€‚æˆ‘ä»¬å®Œå…¨æœ‰èƒ½åŠ›ç»™æˆ‘ä»¬æƒ³è¦çš„è¯­è¨€æ·»åŠ ä»»ä½•ç‰¹æ€§ã€‚ç…§è¿™æ ·ï¼Œè¿™æ®µä»£ç å¾ˆéš¾è¿è¡Œã€‚æˆ‘ä»¬å¿…é¡»ä»¥æŸç§æ–¹å¼æ•™ä¼š JavaScript å¼•æ“äº†è§£å¼‚æ­¥å‡½æ•°è°ƒç”¨å’Œå¸¸è§„åŒæ­¥å‡½æ•°è°ƒç”¨ä¹‹é—´çš„åŒºåˆ«ã€‚è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ å‡ ä¸ªå…³é”®å­—ï¼Œä½¿å®ƒåœ¨å¼•æ“ä¸Šæ›´å®¹æ˜“ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ä¸»å‡½æ•°æœ¬èº«æ·»åŠ ä¸€ä¸ªå…³é”®å­—ã€‚è¿™å¯èƒ½ä¼šæç¤ºå¼•æ“ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å°†ä¼šæœ‰ä¸€äº›å¼‚æ­¥å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªå°±ç”¨`async`å§ã€‚

```
$("#btn").on("click", async () => {
  const user = getUser('tylermcginnis')
  const weather = getWeather(user)

  updateUI({
    user,
    weather,
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

é…·æ¯™äº†ã€‚é‚£ä¼¼ä¹æ˜¯åˆç†çš„ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªå…³é”®å­—ï¼Œè®©å¼•æ“ç¡®åˆ‡åœ°çŸ¥é“ä½•æ—¶è¢«è°ƒç”¨çš„å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å°†è¿”å›ä¸€ä¸ªæ‰¿è¯ºã€‚è¿˜æ˜¯ç”¨`await`å§ã€‚æ¯”å¦‚"å˜¿ï¼Œå¼•æ“ã€‚è¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œè¿”å›ä¸€ä¸ªæ‰¿è¯ºã€‚ä¸è¦åƒä½ é€šå¸¸åšçš„é‚£æ ·ç»§ç»­ä¸‹å»ï¼Œè€Œæ˜¯ç»§ç»­ä¸‹å»ï¼Œç­‰å¾…æ‰¿è¯ºçš„æœ€ç»ˆä»·å€¼ï¼Œå¹¶åœ¨ç»§ç»­ä¸‹å»ä¹‹å‰å½’è¿˜å®ƒã€‚éšç€æˆ‘ä»¬æ–°çš„`async`å’Œ`await`å…³é”®å­—çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬çš„æ–°ä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºã€‚

```
$("#btn").on("click", async () => {
  const user = await getUser('tylermcginnis')
  const weather = await getWeather(user.location)

  updateUI({
    user,
    weather,
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

ç›¸å½“ç‹¡çŒ¾ã€‚æˆ‘ä»¬å·²ç»å‘æ˜äº†ä¸€ç§åˆç†çš„æ–¹æ³•ï¼Œè®©æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥å’Œè¡Œä¸ºèµ·æ¥å°±åƒæ˜¯åŒæ­¥çš„ã€‚ç°åœ¨ä¸‹ä¸€æ­¥æ˜¯è®© TC39 ä¸Šçš„äººç›¸ä¿¡è¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ­£å¦‚ä½ ç°åœ¨å¯èƒ½å·²ç»çŒœåˆ°çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»»ä½•ä»¤äººä¿¡æœçš„äº‹æƒ…ï¼Œå› ä¸ºè¿™ä¸ªç‰¹æ€§å·²ç»æ˜¯ JavaScript çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¢«ç§°ä¸º`Async/Await`ã€‚

ä¸ç›¸ä¿¡æˆ‘ï¼Ÿ[è¿™æ˜¯æˆ‘ä»¬æ·»åŠ äº† Async/Await çš„å®æ—¶ä»£ç ](https://codesandbox.io/s/00w10o19xn)ã€‚ä½ å¯ä»¥éšæ„æ‘†å¼„å®ƒã€‚

* * *

#### å¼‚æ­¥å‡½æ•°è¿”å›æ‰¿è¯º

ç°åœ¨æ‚¨å·²ç»çœ‹åˆ°äº† Async/Await çš„å¥½å¤„ï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€äº›é‡è¦çš„å°ç»†èŠ‚ã€‚é¦–å…ˆï¼Œä»»ä½•æ—¶å€™ä½ æ·»åŠ `async`åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†éšå¼è¿”å›ä¸€ä¸ªæ‰¿è¯ºã€‚

```
async function getPromise(){}

const promise = getPromise() 
```

Enter fullscreen mode Exit fullscreen mode

å³ä½¿`getPromise`å®é™…ä¸Šæ˜¯ç©ºçš„ï¼Œå®ƒä»ç„¶ä¼šè¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª`async`å‡½æ•°ã€‚

å¦‚æœ`async`å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼ä¹Ÿå°†è¢«åŒ…è£…åœ¨ä¸€ä¸ªæ‰¿è¯ºä¸­ã€‚è¿™æ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨`.then`æ¥è®¿é—®å®ƒã€‚

```
async function add (x, y) {
  return x + y
}

add(2,3).then((result) => {
  console.log(result) // 5
}) 
```

Enter fullscreen mode Exit fullscreen mode

* * *

#### æ— å¼‚æ­¥ç­‰å¾…ä¸å¥½

å¦‚æœä½ è¯•å›¾åœ¨ä¸€ä¸ªä¸æ˜¯`async`çš„å‡½æ•°ä¸­ä½¿ç”¨`await`å…³é”®å­—ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚

```
$("#btn").on("click", () => {
  const user = await getUser('tylermcginnis') // SyntaxError: await is a reserved word
  const weather = await getWeather(user.location) // SyntaxError: await is a reserved word

  updateUI({
    user,
    weather,
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘æ˜¯è¿™æ ·æƒ³çš„ã€‚å½“ä½ ç»™ä¸€ä¸ªå‡½æ•°æ·»åŠ `async`æ—¶ï¼Œå®ƒåšä¸¤ä»¶äº‹ã€‚å®ƒä½¿å¾—å‡½æ•°æœ¬èº«è¿”å›(æˆ–åŒ…è£…è¿”å›çš„å†…å®¹)ä¸€ä¸ªæ‰¿è¯ºï¼Œå¹¶ä½¿å¾—æ‚¨å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨`await`ã€‚

* * *

#### é”™è¯¯å¤„ç†

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬æœ‰ä¸€ç‚¹ä½œå¼Šã€‚åœ¨æˆ‘ä»¬çš„åŸå§‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ‰åŠæ³•ä½¿ç”¨`.catch`æ¥æ•æ‰ä»»ä½•é”™è¯¯ã€‚å½“æˆ‘ä»¬åˆ‡æ¢åˆ° Async/Await æ—¶ï¼Œæˆ‘ä»¬åˆ é™¤äº†è¿™æ®µä»£ç ã€‚å¯¹äº Async/Awaitï¼Œæœ€å¸¸è§çš„æ–¹æ³•æ˜¯å°†ä»£ç å°è£…åœ¨ä¸€ä¸ª`try/catch`å—ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ•æ‰é”™è¯¯ã€‚

```
$("#btn").on("click", async () => {
  try {
    const user = await getUser('tylermcginnis')
    const weather = await getWeather(user.location)

    updateUI({
      user,
      weather,
    })
  } catch (e) {
    showError(e)
  }
}) 
```

Enter fullscreen mode Exit fullscreen mode

* * *

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨ TylerMcGinnis.com å¤§å­¦ï¼Œæ˜¯ä»–ä»¬åœ¨ T2 å¤§å­¦é«˜çº§ JavaScript è¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚