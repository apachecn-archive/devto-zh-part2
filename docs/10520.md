# 更多协作拉取请求

> 原文:[https://dev . to/vora HSA/more-collaborative-pull-requests-43ng](https://dev.to/vorahsa/more-collaborative-pull-requests-43ng)

基于特性分支和拉请求的[软件开发工作流](https://www.atlassian.com/git/tutorials/making-a-pull-request)非常流行，版本控制系统支持容易的分支和合并，拉请求作为一个特性存在于常用的源代码库中。拉请求为团队提供了一种异步协作处理代码的方式，不需要同时关注更多的人，并且这种方式对于同处一地的团队和分布式团队都是一样的。但是我经常看到的拉请求的使用方式对我来说更像是抑制协作，而不是促进协作。这篇文章是关于我所看到的使用拉请求的不好的方法，以及我们开发人员可以做些什么来改善这种情况。

我的经验来自于企业界，在那里有一个定义明确的团队全职(或者大部分时间)开发软件并获得报酬，拉式请求被用作改进代码和传播相关知识的协作工具。在开源世界中，通常有一个核心的维护者群体，他们接受来自外部的贡献，社会动态是不同的，并不是下面的一切都适用。

### 术语

第一个问题已经存在于术语中，“拉式请求”、“审阅者”、“批准”。这听起来更像是拉式请求作者请求权威机构接受他们的提交，而不是合作伙伴之间的会议。我不知道什么是最好的术语，但是像“合并建议”、“合作者”、“想要合并”这样的术语似乎更好地强调了参与拉请求的开发人员没有不同的角色，而是一起合作改进软件。

当考虑到权力关系时，整个事情变得更成问题。在大多数开发团队中，权力大的人多，权力小的人少。他们可能被正式称为“高级”和“初级”，他们可能来自不同层次的代码库知识，或者他们可能只是从个性中出现。无论如何，除非环境在心理上是安全的，否则权力较小的人可能会害怕“审查”权力较大的开发人员的代码，而权力较大的开发人员可能会无意中或有意地通过听起来严格和要求来欺负权力较小的人。

### 对抗性交流

拉请求评论并不总是最有趣的地方。这可能是上一点的延伸，即如何看待拉请求，但是考虑到每个人都应该在同一个团队中为相同的目标而努力，评论可能会变得令人惊讶地充满敌意。当然，拉请求的提交者可能以错误的方式使用了一个接口或者引入了一个 bug，但是每个人都会犯错误，进行代码评审的全部目的就是在这些错误进入发布代码之前发现它们。没有理由说脏话或从个别错误中推断出一般特征。

我在代码评审中特别看到一种敌对心态的情况是当拉请求“触及评审者的代码”时。一些开发人员非常执着于他们编写的代码应该是什么样子以及如何使用的准确愿景，如果其他人不完全按照他们的方式看问题，他们就会采取防御措施，这可能会导致非常敌对的评论。我是[集体代码所有权](https://martinfowler.com/bliki/CodeOwnership.html)的忠实粉丝，在这种情况下，整个团队集体负责所有代码，没有任何部分的个人所有者。自然地，模块和类似的东西通常有更了解它们的人，获得他们的输入对于避免错误是有价值的，但是这并不意味着这些人获得了这些部分的实际所有权。

有了这样的环境，毫不奇怪，当有能力选择评审者时，开发人员通常会选择那些容易批准而没有通常的苛刻评论的人，这又减少了正在进行的真正合作的数量。

### 守门

我所熟悉的拉式请求系统支持拉式请求过程的执行。通常，这是通过阻止对主开发分支的直接推送，而是要求拉取请求来实现的。然后，在允许合并之前，拉请求被配置为需要特定人或特定组中一定数量的人的批准。这样做的原因通常是为了确保所有代码都被不止一个人看到，并且最熟悉代码库的人也在其中。

根据我的经验，团队很少会自己决定开启这些把关测量。看到协作开发代码的价值的团队对协作如何发生有一个协议，通常这可能意味着通过拉请求提交代码的协议。但是打开执行部分通常是管理人员的权限。即使一些过程是有益的，由外部机构强加给团队也不利于团队士气，在这种情况下，它会导致团队成员不再关心代码审查，只是半自动地添加他们的批准标记以确保所有障碍都被清除。

### 改善我的行为

我至少犯了上述一些罪，但我正在努力改进。在我的行为中，我观察到的最重要的问题是过于教条和武断，尤其是对经验比我少的开发人员，而且直到最近[我才开始发现我的沟通方式有问题](https://blog.techinclusion.co/tech-has-a-toxic-tone-problem-lets-fix-it-37bb3517ab97)。这些是我正在尝试做的一些事情，我觉得它们对团队有积极的影响，也让我成为一个其他人不怕遇到问题的人。

如果我看到在我看来是错误的东西(不是“错误”，我正试图摆脱对代码的绝对主义观点)，我不会去要求改变。通常，其他开发人员做他们所做的事情是有原因的，所以我要求他们给出他们的理由。在这一点上，甚至提及为什么我认为这看起来是错误的可能会适得其反，因为其他开发人员可能会觉得我在要求他们改变代码，不管消息是如何措辞的。即使是“实际上错误的”事情也经常是由于缺少代码的上下文而导致的，这更多地指向了糟糕的互连文档，而不是其他开发人员的能力。

当我在代码库方面比其他开发人员更有经验时，我通常知道它所具有的有用的功能。因此，如果他们写了一些我们已经制作成它自己的功能的代码，我再次不采用要求他们改变它的语气，而是试图以一种更有帮助的方式指出他们可能不知道的东西。

当我看到好的东西时，我也会试着给予表扬。如果另一个开发人员发现了一些棘手的问题，巧妙地重构了一些代码，或者只是以一种干净的方式做了一些事情，我真的应该留下一个好的评论。否则,“拉”请求注释可能变成消极的练习，只对问题进行注释，而不是旨在改进软件和代码的协作。

我反对守门。如果我一直在管理一个存储库，我没有启用任何守门特性，更喜欢依赖团队的判断来决定什么时候拉请求是合适的，谁应该检查它，并允许开发人员在足够自信的情况下直接推送到分支。这是[通过含蓄地信任人们来让他们值得信任的正常方法](https://futurice.com/blog/on-trust)。不幸的是，在这个问题上，我经常最终被否决。我试图问为什么执行这些把关策略是必要的，但是从来没有人回答这个问题，我只是被告知为什么进行代码审查是有用的。对一些组织来说，信任员工似乎是一个完全陌生的概念。

### 经历

我仍然记得我第一次在拉请求评审中对一段代码给出肯定的评论。我可能没有说得那么清楚，因为另一个开发人员显然明白注释意味着问题，他修改了我认为我已经表扬过的代码。这确实暴露了我的心态，我也曾经对拉式请求感到内疚。做出这些决定的原因是为了在代码中发现问题，而不是与团队的其他成员合作。

我越来越注重问问题而不是提要求，这也没有起到应有的作用。我真诚地希望得到我的问题的答案，如果需要的话，把它们作为讨论改变的跳板。但是在这里，一个评论经常被看作是对改变的需求，所以不是对我的问题的回答或对设计决策的讨论，我只是得到一个简洁的评论“修正”,一些东西被改变了，即使它是不必要的。

我认为，为了在协作而不是对抗的代码审查方面取得更好的进展，需要从一开始就建立团队实践。确保每个人都理解集体代码所有权的概念，当接近代码评审时，每个人都同意抛开自我(与通常建议的不同，这适用于评审者，也适用于代码被评审的人)。即使你没有参与，也要阅读关于拉式请求的评论，并尝试指出有害和敌对的沟通(有时在公共场合，有时私下对人，这取决于情况)。如果不良行为在团队中扎根，它很容易成为规范，并且很难根除，因此对整个团队来说，确保它不会成为“这里的做事方式”非常重要。