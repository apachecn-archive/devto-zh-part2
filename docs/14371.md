# åœ¨çª—å£ä¸­ç»˜åˆ¶ä½å›¾(å¶-SDL #2)

> åŸæ–‡:[https://dev . to/mortoray/drawing-a-bitmap-in-the-window-leaf-SDL-2-5d fk](https://dev.to/mortoray/drawing-a-bitmap-in-the-window-leaf-sdl-2--5dfk)

[https://www.youtube.com/embed/0N-qs8qv2dk](https://www.youtube.com/embed/0N-qs8qv2dk)

> é˜…è¯»[æ›´æ–°#1](https://mortoray.com/2018/02/28/new-game-a-quest-for-graphics-leaf-sdl-1/)

## [](#syntax-error)è¯­æ³•é”™è¯¯

è‡ªä»ä¸Šæ¬¡æ›´æ–°ä»¥æ¥ï¼Œæˆ‘è§£å†³äº†ä¸¤ä¸ªé—®é¢˜:ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯å’Œä¸€ä¸ªå›¾åƒåŠ è½½é”™è¯¯ã€‚

å½“åœ¨ç±»å‹ä¸­ä½¿ç”¨æœªçŸ¥ç¬¦å·æ—¶ï¼Œä¼šè§¦å‘é”™è¯¯æ¶ˆæ¯ï¼Œä¾‹å¦‚:

```
var a : wacky 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ—¥å¿—è®°å½•ç³»ç»Ÿå·²ç»å¯ä»¥å¤„ç†ç¬¦å·ï¼Œä½†æ˜¯è¿™ä¸ªè½¬æ¢ä»£ç æ²¡æœ‰æ­£ç¡®åœ°ä¼ é€’å€¼ã€‚ç»è¿‡ä¸€ç‚¹æµ‹è¯•åï¼Œæˆ‘è®©å®ƒåœ¨æ—¥å¿—ä¸­æ­£ç¡®åœ°äº§ç”Ÿä¸€ä¸ªæ–°çš„é”™è¯¯ä¿¡æ¯ã€‚

```
Unknown identifier `wacky` 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#image-loading-and-raw-asabiptr-endraw-)å›¾åƒåŠ è½½å’Œ`as_abi_ptr`

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`sdl_blit_surface`çš„`check_sdl`æŠ¥å‘Šäº†ä¸€ä¸ªé”™è¯¯:

```
var image = sdl_load_bmp_rw( f, 1 )
//TODO: Check null `image`

q = sdl_blit_surface( image, 0, surface, 0 )
check_sdl( "sdl_blit_surface", q ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æš‚æ—¶å¿½ç•¥é‚£ä¸ª`TODO`...æˆ‘æ·»åŠ äº†ä»£ç æ¥æ‰“å° SDL é”™è¯¯æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸€ä¸ªåº“å·¥å…·æ¥æ‰“å°æˆ–è½¬æ¢ ABI ç©ºç»ˆæ­¢å­—ç¬¦ä¸²ï¼›å¿«é€Ÿå¾ªç¯å°±è¡Œ:

```
defn print_sdl_error = -> {
    var sx = sdl_get_error()
    var i = 0
    while sx#i != 0 {
        std.print( char_val(sx#i) )
        i += 1
    }
    std.println([])
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é”™è¯¯æ˜¯`SDL_UpperBlit: passed a NULL surface`ã€‚ä»£ç çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘è®¤ä¸ºå€¼æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠæ³•æµ‹è¯•å®ƒä»¬ã€‚è¿™å°±æ˜¯`TODO`çš„æ„æ€ã€‚å½“æ‰“ç”µè¯ç»™`sdl_load_bmp_rw`æ—¶ï¼Œæˆ‘æ— æ³•æ£€æŸ¥ç»“æœã€‚ä¸ºäº†æŸ¥çœ‹å®ƒæ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘å°è¯•æ‰“å°å›¾åƒçš„å¤§å°:

```
std.println(["image ", image.w, "x", image.h]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç»™å‡ºäº†ä¸€ä¸ª segfaultï¼Œè¡¨æ˜`image`è‚¯å®šæ˜¯æ— æ•ˆçš„ã€‚

ä¸ºäº†æµ‹è¯•`null`,æˆ‘éœ€è¦ä¸€ç§æ–¹æ³•æ¥æŸ¥çœ‹è¿™ä¸ªå€¼ã€‚åœ¨ Leaf ä¸­ï¼Œa `value_ptr`æ˜¯ä¸€ä¸ªå¤–éƒ¨å±æ€§ï¼Œä¸å…è®¸ä»»ä½•ç±»å‹çš„ç›´æ¥æ“ä½œ(æ¯”å¦‚æ¯”è¾ƒ)ã€‚

æˆ‘å¼•å…¥äº†`as_abi_ptr`å†…ç½®å‡½æ•°æ¥å°†ä¸€ä¸ª`value_ptr`è½¬æ¢æˆä¸€ä¸ª`abi_ptr`ï¼Œè¿™æ˜¯ä¸€ä¸ª`binary`ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒè¿™äº›ï¼Œä»è€Œå¯ç”¨è¿™ä¸ªåŠŸèƒ½:

```
defn check_sdl_ptr = ( where : arrayï½¢charï½£, item : abi_ptr ) -> {
    item != 0 then return
    std.println([where, " failed"])
    print_sdl_error()
    fail string_tag( "sdl-fail" )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§°ä¸º:

```
var image = sdl_load_bmp_rw( f, 1 )
check_sdl_ptr( "sdl_load_bmp_rw", as_abi_ptr(image) ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ç°åœ¨å¯ä»¥çœ‹åˆ°ç¥ç§˜çš„é”™è¯¯ã€‚æˆ‘åœ¨ Gimp ä¸­é‡æ–°ä¿å­˜äº†è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒå°±æ¶ˆå¤±äº†ï¼Œç•™ç»™æˆ‘ä»¬çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚

[![Screenshot](../Images/66baf49111305a9261ddbaa0d2cc86c4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7CtEQ299--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://mortoray.files.wordpress.com/2018/03/screenshot_20180309_105012.png)

å¸Œæœ›ä¸‹ä¸€æ¬¡æˆ‘èƒ½ç”»æ›´å¤šçš„çŸ©å½¢ã€‚

> æ¥çœ‹çœ‹[çš„](http://leaflang.org) [SDL åˆ†åº—](https://code.launchpad.net/~eda-qa/leaflang/sdl)å’Œçš„å¶å­å§ã€‚æ¼”ç¤ºä»£ç æ˜¯ github ä¸Šçš„[ï¼Œè™½ç„¶æˆ‘ä¸èƒ½ä¿è¯å½“å‰çŠ¶æ€æ˜¯ä»€ä¹ˆğŸ™ˆã€‚ä¸€å®šè¦è·Ÿç€æˆ‘ä¸€èµ·è·³](https://github.com/mortoray/leaf-algorithms/tree/master/sdl) [Twitch](https://www.twitch.tv/mortoray) ã€‚