# 处理“额外”功能

> 原文:[https://dev . to/stefandorresteijn/processing-with-extra-functionality-38 B3](https://dev.to/stefandorresteijn/dealing-with-extra-functionality-38b3)

每个应用程序都处理不属于其核心范围的功能。待办事项应用程序需要发送提醒，打车应用程序需要邮寄收据，评论应用程序需要更新平均分数。这些都不属于应用程序的核心功能，但却是改善用户体验所必需的。那么，如何处理这种功能蠕变呢？

#### [](#singlefunctionality-functions)单功能函数

在 Sjauf，我们致力于单一功能解析器功能。这意味着每个请求只做一件事，保持解析器干净简单。每当我们的应用程序想要完成另一个动作时，它需要发送另一个请求。对于大多数功能来说，这很有意义。你不希望你的请求产生意想不到的后果。不幸的是，有时候单一的功能是不够的。我们将以旅行预订功能为例。

当用户预订旅行时，我们必须采取以下步骤:

1.  验证用户输入
2.  计算价格
3.  将旅行保存在我们的数据库中
4.  向用户发送确认电子邮件
5.  向我们的司机发送通知
6.  向我们的用户发送聊天消息
7.  给我们的计划部门发一封电子邮件

虽然第 1 步到第 3 步都是这个请求的核心职责，但是其他任何事情都可以被认为是额外的并且应该——在我们的设计理念中——从这个函数/解析器中移除。那么这些函数放在哪里，我们如何调用它们呢？

#### [](#can-we-fix-it-yes-we-can)我们能修好吗？是的，我们可以！

我们可以想出一些解决方案。

**让我们的理念见鬼去吧，在一个地方完成所有工作！**
如果我们忽略我们的哲学，我们可以简单地把这个*额外的*功能放到我们写的解析器函数中。通过在应用程序的其余部分进行适当的功能分离，很容易为每个步骤创建一个函数，并在后台线程上简单地调用这些函数，以确保您的解析器不会出现不必要的延迟。

不幸的是，我不相信忽视我努力发展和实现的哲学。当然，打破一次你自己的规则似乎很容易，但这树立了一个先例，导致更多的规则被打破。那是一条不归路，所以要小心行事！

**数据库监听器**
使用数据库监听器，您可以在数据库发生变化时执行功能。对于预订流程，我们将听取新的旅行正在创建。这样做的一个好处是，您可以将这个解决方案与所有其他功能完全分开。您甚至可以在一个完全独立的应用程序中运行它，只要它连接到您的数据库。当它发生时，您还可以访问刚刚创建/更新的整行。作为已经相当不错的蛋糕上的最后一颗樱桃，即使当您手动或通过管理面板或其他应用程序更新数据库时，这些侦听器也会被触发。

这种做事方式有一个巨大的缺点。因为数据库侦听器总是会触发，所以您无法控制会发生什么。无处不在不可控不可预见的后果！此外，因为您的代码大部分时间不在与核心功能相同的文件中，所以很难理解您的数据流。

**函数挂钩**
挂钩是截取一个函数以改变其功能的行为。就我们的目的而言，我们将在旅行被预订后挂钩预订功能来执行我们的*额外*功能。为了清晰起见，您最有可能将这些钩子保存在同一个文件中。你把所有的功能放在它应该在的地方，而不会忘记你的代码在哪里。

同样，这也有不利的一面。不是每种语言都有挂钩功能，这意味着您可能需要自己实现一个版本。此外，因为您正在分离功能，您将需要完美地记录您的 after_function 回调，或者创建一个不需要记录的模式。我把那个留给你。

#### [](#conclusions)结论

您对这个问题的解决方案将取决于您的特定堆栈和文档能力。我总是建议不要把所有的功能都塞进一个函数里，然后就收工了。它很快，但是它也创建了不止做一件事的函数，这是一个坏主意。数据库监听器可能会导致意想不到的后果，但至少代码是分开的。函数挂钩似乎是最好的方法。它们允许你分离你的代码，同时保持某种形式的清晰。不幸的是，这种模式需要文档和相当多的纪律，这可能很棘手。

最后，这是一个设计选择，由你来解决。你喜欢什么解决方案？