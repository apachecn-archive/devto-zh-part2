# åœ¨å¾®è½¯åº”ç”¨ä¸­å¿ƒç­¾ç½² React åŸç”Ÿ Android APKs

> åŸæ–‡:[https://dev . to/fabrik 42/signing-react-native-Android-apks-on-Microsoft-app-center-33 F6](https://dev.to/fabrik42/signing-react-native-android-apks-on-microsoft-app-center-33f6)

**TLï¼›**åšå£«ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ APK ç­¾çº¦å¦‚ä½•è¿›è¡Œ:

*   å­˜å‚¨åº“ä¸­æ²¡æœ‰å‡­æ®/å¯†é’¥åº“ã€‚
*   ä½œä¸ºä¸€èˆ¬æ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨ keystore(æœªç­¾å…¥ç‰ˆæœ¬æ§åˆ¶)å’Œä½¿ç”¨**ç¯å¢ƒå˜é‡**çš„é…ç½®åœ¨æœ¬åœ°æ„å»ºå¹¶ç­¾åå®ƒã€‚
*   ä½¿ç”¨ä»–ä»¬çš„[åˆ†æ”¯é…ç½®](https://docs.microsoft.com/en-us/appcenter/build/android/code-signing#setting-up-code-signing)åœ¨ **MS App Center** ä¸Šæ„å»ºå®ƒï¼Œç”¨äºå¯†é’¥åº“ä¸Šä¼ å’Œé…ç½®ã€‚

æˆ‘æŒ‰ç…§å®˜æ–¹çš„ React æœ¬æœºæŒ‡ä»¤åˆ›å»ºäº†ä¸€ä¸ª keystore æ–‡ä»¶ã€‚

ç„¶è€Œï¼Œæˆ‘ä¸æƒ³åœ¨æˆ‘çš„ä¸»ç›®å½•ä¸­ç®¡ç†ä¸€ä¸ªå…¨å±€ gradle é…ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨æ™®é€šçš„*ç¯å¢ƒå˜é‡*ã€‚

#### [](#what-will-happen)ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

å°†æ•æ„Ÿæ•°æ®ä¸Šä¼ åˆ°å­˜å‚¨åº“æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥å”¯ä¸€çš„å¯èƒ½æ˜¯ä½¿ç”¨[åˆ†æ”¯é…ç½®](https://docs.microsoft.com/en-us/appcenter/build/android/code-signing#setting-up-code-signing)çš„ä¸Šä¼ ç‰¹æ€§ã€‚

è¯¥è®¾ç½®å°†ä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨

`./gradlew assembleRelease`åœ¨æœ¬åœ°æ„å»ºç­¾åçš„ apkã€‚

å¦‚æœæ²¡æœ‰åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®å¯†é’¥åº“è·¯å¾„ï¼Œå®ƒå°†ä¸ä¼šå°è¯•å¯¹ APK è¿›è¡Œç­¾åï¼Œè€Œæ˜¯æ‰“å°ä¸€æ¡è­¦å‘Šã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºåœ¨æ„å»ºä¹‹åï¼ŒMS App Center å°†åœ¨ç¬¬äºŒæ­¥ä¸­ä½¿ç”¨æ‚¨åœ¨åˆ†æ”¯é…ç½®ä¸­è®¾ç½®çš„å¯†é’¥åº“å’Œå‡­æ®å¯¹ APK è¿›è¡Œç­¾åã€‚

æˆ‘çœŸçš„æ²¡æœ‰å¾—åˆ°æè¿°å¦‚ä½•åœ¨ App Center ä¸Šç­¾ç½² APK çš„ä¸åŒæ–¹å¼çš„æ–‡æ¡£ï¼Œæˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´æ‰å¼„æ˜ç™½è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

#### [](#setting-environment-variables)**è®¾ç½®ç¯å¢ƒå˜é‡**

å‡è®¾æ‚¨çš„å¯†é’¥åº“æ–‡ä»¶ä½äº React æœ¬åœ°é¡¹ç›®ä¸­:

`android/app/myapp-dev.keystore`

æ‚¨éœ€è¦è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡:

```
ORG_GRADLE_PROJECT_MYAPP_RELEASE_STORE_FILE=myapp-dev.keystore
ORG_GRADLE_PROJECT_MYAPP_RELEASE_KEY_ALIAS=myapp-alias
ORG_GRADLE_PROJECT_MYAPP_RELEASE_STORE_PASSWORD=your-password
ORG_GRADLE_PROJECT_MYAPP_RELEASE_KEY_PASSWORD=your-password 
```

æˆ‘é€šå¸¸ç”¨ direnv æ¥åšè¿™ä¸ªã€‚

`ORG_GRADLE_PROJECT_`æ˜¯ä¸€ä¸ªå‰ç¼€ï¼Œå®ƒå°†å‘Šè¯‰ grade å°†è¿™äº›ç¯å¢ƒå˜é‡ä½œä¸ºå±æ€§åŒ…æ‹¬åœ¨å†…ï¼Œè¯¥å‰ç¼€å°†åœ¨æ­¤è¿‡ç¨‹ä¸­è¢«å»é™¤ã€‚

#### [](#configure-gradle)é…ç½®æ¢¯åº¦

ç¼–è¾‘`android/app/build.gradle`ä»¥åŒ…å«ç­¾åï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
signingConfigs {
    release {
      if (project.hasProperty('MYAPP_RELEASE_STORE_FILE')) {
        storeFile rootProject.file("app/" + project.findProperty('MYAPP_RELEASE_STORE_FILE') ?: "ANDROID_STORE_FILE_NOT_SET")
        storePassword project.findProperty('MYAPP_RELEASE_STORE_PASSWORD') ?: "ANDROID_STORE_PASSWORD_NOT_SET"
        keyAlias project.findProperty('MYAPP_RELEASE_KEY_ALIAS') ?: "ANDROID_KEY_ALIAS_NOT_SET"
        keyPassword project.findProperty('MYAPP_RELEASE_KEY_PASSWORD') ?: "ANDROID_KEY_PASSWORD_NOT_SET"
      }
    }
} 
```

ä»¥åŠå‘å¸ƒæ„å»ºç±»å‹ä¸­çš„è°ƒç”¨:

```
buildTypes {
    release {
        //...

        if (project.hasProperty('MYAPP_RELEASE_STORE_FILE')) {
          signingConfig signingConfigs.release
        } else {
          println '-------------------------------------------------'
          println 'The MYAPP_RELEASE_STORE_FILE property was not set!'
          println 'This release will not be signed by gradle!'
          println '-------------------------------------------------'
        }
    }
} 
```

#### [](#configure-app-center)é…ç½®åº”ç”¨ä¸­å¿ƒ

[![](../Images/99c52e6791ae98640355f61c8b4e7dbb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--28pbZKBK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AZ7uXMRe4vh4pq2FCV1P7Nw.png) 

<figcaption>ä¸Šä¼ æ‚¨çš„å¯†é’¥åº“å¹¶å­˜å‚¨å‡­è¯</figcaption>

#### [](#thats-it)å°±æ˜¯è¿™æ ·ï¼

[![](../Images/e1446f8b71e75bc9ba008dd2f10157d2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Z9k39fKP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/842/1%2A4q8GT3lWSbJnTnWUuj57zA.png) 

<figcaption>ç»ˆäºæ‰“é€ æˆåŠŸäº†ï¼</figcaption>

éå¸¸æ„Ÿè°¢:[å¤æ–¯å¡”å¤«](https://twitter.com/gkarlsson86)ï¼Œ[ç©†å°¼å¸ƒ](https://twitter.com/muneikh)å’Œå¾®è½¯æŠ€æœ¯æ”¯æŒéƒ¨é—¨çš„å‹å¥½æŠ€æœ¯æ”¯æŒï¼Œæ„Ÿè°¢ä»–ä»¬çš„æç¤ºå’Œè€å¿ƒï¼ğŸ™