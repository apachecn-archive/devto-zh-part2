# Winds 2.0 堆栈

> 原文：<https://dev.to/nickparsons/the-winds-20-stack-3ck4>

[Winds](https://getstream.io/winds) 最初是作为 [Stream](https://getstream.io) 的一个简单的示例应用程序，但是由于来自我们令人敬畏的社区的大量支持，我们决定将更多的时间和精力放在这个项目上。围绕 Winds 2.0 的最初反应超出了我们所有人的预期。自 5 月中旬推出以来，该应用在黑客新闻上连续一天排名第一，在 Github 上拥有 5500 颗星(还在增加)，并成为产品搜索上的热门应用。

进入其中，没有办法预测 Winds 2.0 会变得多么流行——它会是绝对的成功还是史诗般的失败和时间的浪费？？该团队喜欢构建示例应用程序，所以我知道这不会是一个完全的损失，看到这个新的迭代在发布后的第一个月被如此广泛地使用是值得的。

风力发电的技术和蒸汽发电完全不同。你可能已经看过 StackShare 写的博文，讲述了 Stream 如何为使用 Go、RocksDB 和 Raft 的 3 亿用户提供活动提要。然而，Winds 基于 Node.js、MongoDB Atlas、Express、PM2、Bull、Babel 和 React。

要开始使用 Winds 2.0，您可以尝试网页版或在这里下载应用程序，或者如果您更喜欢冒险，可以去 GitHub 并在本地运行它。接下来，让我们来谈谈 Winds 2.0 堆栈，以及我们为什么选择使用我们所采用的技术(以及我们为什么首先选择构建 Winds！).

## RSS 是个破体验😭

我们意识到许多 RSS 高级用户是开发人员、设计人员和记者。我们对 Winds 的目标之一是回答我们一直在问自己的问题:如果一个开发者和设计者的社区可以创建一个简单而完美的 RSS 体验会怎么样？这能扭转越来越少的用户利用这项技术，越来越多的出版物放弃支持的恶性循环吗？

RSS 的未来是不确定的。我们希望这个项目能为# ReviveRSS 做出贡献。

## 为什么 JavaScript/Node…？🤔

Winds 的另一个核心目标是让更多的开发者参与进来。我们希望任何人都能够很容易地注意到他们对 RSS/Podcast 体验不满意的地方，并轻松地提交带有修复或添加的 pull 请求。

如果你有足够的勇气探索代码库，你可能会注意到我们在任何事情上都使用 JavaScript 包括前端和后端。我们团队的大多数人都有使用 Go 和 Python 的经验，所以 Node 不是这个示例应用程序的明显选择。关于 JavaScript 有趣的是有多少人抱怨它是一种不合适的语言。当然，它有自己的怪癖——单线程、回调地狱等。–但是我们相信用任何语言都有可能开发出优秀的软件。

对于 Winds 来说，JavaScript 是围绕项目培养社区的一个很好的选择。更重要的是，随着 Async/Await 语法支持的增加，JavaScript 的成熟度开始显现。

当然……会有反对者拒绝承认 JavaScript 有任何积极的一面(黑客新闻上甚至有关于 Node.js 的咆哮)。然而，如果没有完全用 JavaScript 编写，我们就不会看到我们所做的结果。下面是我们选择 JavaScript 的一些原因的快速分类:

*   几乎每个开发人员都知道或者至少能够阅读 JavaScript
*   有了 ES6 和 Node.js v10.x.x，它已经成为一种非常强大的语言
*   Async/Await 功能强大且易于使用(Async/Await vs Promises)
*   Babel 允许我们试验下一代 JavaScript(官方 JavaScript 规范中还没有的特性)

Yarn 允许我们快速一致地安装软件包(并且充满了大量的新技巧)

## 🖥️

你很少听说公司是如何部署和管理代码的。由于 Winds 2.0 是开源的，所以我们想分享一些工具来完成将代码从机器上传到服务器的工作。

Winds 的网页版静态托管在 S3 的 CloudFront 上。总的来说，我们每个月只需花费几美元就可以举办。该应用程序的每个桌面版本都部署在 Electron 内部，使我们能够在 web 和桌面之间架起一座桥梁。

至于后端 API，那就是后话了。我们有一个相当不错的部署流程来确保稳定性和可维护性。以下是概要:

*   所有代码都存储在 GitHub 上
*   我们使用 Fabric 和 Boto 的组合在 AWS 上手动启动构建
*   CloudFormation 创建一个全新的 Winds 环境，包括 EC2 实例、Auto * Scaling 组(ASG)、应用负载平衡器(ELB)和 Redis 实例
*   AWS CCM 存储并检索启动时所需的各种配置(例如，当前版本等。)
*   Dotenv &环境变量存储在 Puppet 和 CCM 中
*   一旦所有 EC2 实例都可用了，就会运行一个傀儡脚本，并在所有实时实例上应用配置(在应用模式下)
*   PM2 启动，自动启动我们需要的各种 Node.js 进程来保持我们的应用程序(API 和 Workers)

对于日志度量，我们使用 StatsD + Graphite + Grafana 的组合。

## 了解电子⚡

我们想尝试构建一个电子应用程序，除了 web 之外，还可以下载到每个 Linux 发行版、macOS 和 Windows。从根本上来说，这似乎很容易:我们编写代码，将它包装在电子层中，然后发布到我们想要的操作系统中……结果证明我们错了。

电子虽然强大，却比我们预想的要大得多。构建不同的发行版尤其困难，即使是使用 electronic-builder 也是如此(当然，我们运气不好，需要修补 electronic-builder(这个错误已经被修复了)，但这只是我们遇到的一些棘手问题)。macOS 菜单栏必须恰到好处，才能让 macOS 商店接受我们的应用程序，而用电子 API 执行小任务，比如在外部浏览器中打开链接，结果证明是相当困难的。尽管困难重重，我们的团队还是开发了一些定制工具(在 GitHub 上都是可见的和开源的),我们不仅发布给了所有的发布目标，也发布到了网络上。

## 在 JavaScript 🗳️中测试

在某种程度上，JavaScript 仍然是蛮荒的西部。这是相当不自以为是的，特别是如果你使用 Express，所以我们必须推出我们自己的测试框架来完成这项工作。我们的 API 是用 Express 构建的，使用了各种 Node.js 模块的组合。以下是我们用于测试的工具列表:

*   作为测试框架的 Mocha
*   柴作为一个断言库
*   西农是我们嘲笑的图书馆
*   Nock 作为 HTTP 模仿库
*   mock——需要一个模块模仿库
*   伊斯坦布尔作为我们的测试覆盖工具

测试模块的组合我们选择我们的团队快速地与多个开发人员一起同时处理不同的特性集，而不会降低 API。

## 前端🛠️

React 是一个非凡的框架，在我们看来，它已经战胜了 Angular 和 Ember 等其他框架。鉴于其更新的麻省理工学院许可证，它非常适合 Winds 2.0 项目。

我们在 Winds 2.0 中使用的主要堆栈非常简单:

### 主栈:

*   创建-反应-应用
*   反应
*   Redux(反应-还原)
*   反应路由器
*   电子

现在我们来聊聊我们用来实现 Winds 2.0 的一些前端模块。

### 有趣的模块:

*   React-audio-player 是核心音频元素 API 的一个很好的 React 接口
*   react-用于处理自动分页的滚动事件的航路点
*   React-dropzone 可轻松导入 OPML 文件
*   React-image 在我们没有存储图像的情况下提供完美的图像备份

## 后端

当您构建一个大型应用程序时，您通常依赖许多库和工具来提高代码质量、缩短上市时间等。也就是说，Winds 也依赖于许多库和工具。下面是我们使用的几种，但不是全部:

### FeedParser

FeedParser 是一个相当复杂的 Node.js 模块，在我们看来，它是该项目的主干。它处理 RSS 提要中的大部分不一致之处，并给出提要的“净化”版本。如果没有这个模块，我们将会写很多 if/else 语句……这一点也不好玩。

### 法郎-分

Franc-Min 是一个语言检测模块，我们利用它来确定提要的语言。这听起来像是一个小任务；然而，事实上，它是我们个性化引擎的很大一部分。例如，我们只向说英语的用户推荐英文提要。其他语言也一样。

### 公牛

在 Redis 的帮助下，Bull 有助于保持 Winds 2.0 队列在结构上的合理性。它附带了一个超级简单的 API，并支持多个队列，这非常适合我们的用例。此外，他们的 GitHub 页面上有几个开源监控工具，可以洞察幕后发生的事情。

### ES6

JavaScript w/ ES6 使我们的团队能够为各种各样的人编写极简代码。Winds 2.0 中的所有代码都是 100%的 JavaScript(除了少数用于帮助部署工作流的 bash 脚本)。该团队目前正在迁移代码库中的大部分功能，以利用 Async/Await 来减少代码行数。

### 纱线

纱绝对惊艳。这是一个非常快速的专门为 JavaScript 构建的包管理器。最重要的是，由于它的缓存机制，它是 100%开源的，几乎总是可用的。我们过去使用过 npm，虽然它工作得很好，但 Stream 的团队更喜欢 Yarn。

### Axios

Axios 是一个基于 Promise 的 HTTP 客户端，用于浏览器和 Node.js。我们实际上在各种任务的前端和后端都使用它。例如，所有前端 HTTP 请求都通过一个包装器流向 Axios。对于后端，我们利用 Axios 来检查文件的大小，然后将其发送到解析流程，然后发送到数据库进行存储，这确保了大文件不会影响我们的工作进程。如果你还没有看过 Axios，你一定要看看。

### 指挥官

Commander 是另一个 Node.js 模块，这次提供了对构建命令行界面的全面支持。是的，没错，Winds 有一个 CLI，我们用它来完成各种任务，比如测试提要、删除 RSS 提要等等！

### 通天塔

Babel“让我们今天就可以使用下一代 JavaScript”。本质上，如果某个特性，比如 imports，在特定的 JavaScript(前端和/或后端)中不可用，我们仍然可以通过利用 Babel 来使用它。

### 快递

Express 用于驱动我们的 API。与其他框架相比，它在压力下确实会大放异彩。老实说，我们的团队拥有大多数 JavaScript 框架的经验，我们发现 Express 是最容易使用的。定期维护，有开源组件，很牛逼。😎

### 哨兵

Sentry 允许我们的后端和前端进行实时崩溃报告。让我们震惊的是你可以用 Sentry 得到的粒度。它们的特性帮助我们识别和调试错误，并让我们了解何时修复或回滚。说到救火，这个工具绝对赢得市场。

### [阿尔及利亚](#algolia)

Algolia 为我们的应用程序提供了快如闪电的搜索。在不到 2 毫秒的时间内，我们的用户可以发现 RSS 源和播客，以供阅读或收听。他们甚至有 React 和 Angular 这样的框架组件来使集成更好。这是迄今为止我们最喜欢的一个；但是，我们都喜欢。😛

### 流

Stream 是 Winds 2.0 的关键资源，因为它为我们的用户提供新闻提要和活动流，甚至基于机器学习的个性化。如果没有 Stream，我们将无法像现在这样为用户提供建议内容。

### 蒙戈布地图集

MongoDB Atlas 是一个非凡的 DBaaS，允许我们担心获取用户，而 MongoDB 则担心正常运行时间。这与托管您自己的集群是一样的，只是 MongoDB 为您提供了一个仪表板和一个 URI 来连接。有了 MongoDB Atlas，再也不用担心集群健康、监控等问题了。

### 獴

Mongoose 是一个强大的 ODM，它允许我们在 MongoDB 环境中定义丰富的模型。一般来说，NoSQL 数据库是无模式的(意味着它们没有或不需要任何形式)；然而，使用 MongoDB，指定一个模式总是一个好主意，这样您就可以正确地索引和组织您的数据。这允许容易的更新和有效的查询。

### PM2

PM2 是 Node.js 流程经理。它使我们能够确保正常运行时间，并根据需要扩展流程。该项目的 CLI 非常简单，这使得我们的团队可以随时使用它。

## 最后的想法😁

要开始使用 Winds 2.0，您可以尝试网页版或在此下载应用程序。如果你想更有冒险精神，那就去 https://github.com/getstream/winds 吧。

RSS 陷入了恶性循环。Winds 是一个帮助扭转潮流和# ReviveRSS 的社区努力。捐款总是很受欢迎。

如果你想知道更多关于 Stream 和我们的 API 是如何工作的，我们有一个简单的 [5 分钟 API 之旅](https://getstream.io/try-the-api-2)，它将带你完成构建可扩展活动提要的过程。