# å»ç¥ç§˜åŒ–çš„ Node.js é”™è¯¯å¤„ç†æ¨¡å¼(æœ‰ä¾‹å­)

> åŸæ–‡:[https://dev . to/full stack cafe/nodejs-é”™è¯¯å¤„ç†-å»ç¥ç§˜åŒ–-2nbo](https://dev.to/fullstackcafe/nodejs-error-handling-demystified-2nbo)

[![Node.js Error Handling Demystified](../Images/8c2fa2c3ed9ad65fd4b881bc73c5981f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--TePiqW55--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.pexels.com/photos/620335/pexels-photo-620335.jpeg%3Fauto%3Dcompress%26cs%3Dtinysrgb%26h%3D350)

å¼‚æ­¥è¯­è¨€ä¸­çš„é”™è¯¯å¤„ç†ä»¥ä¸€ç§ç‹¬ç‰¹çš„æ–¹å¼å·¥ä½œï¼Œå¹¶å¸¦æ¥è®¸å¤šæŒ‘æˆ˜ï¼Œæœ‰äº›æ˜¯æ„æƒ³ä¸åˆ°çš„ã€‚Node.js ä¸­æœ‰ä¸ƒç§ä¸»è¦çš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°æ£€æŸ¥ä¸€ä¸‹ã€‚

> æœ€åˆå‘è¡¨äº [FullStackã€‚æ°¸è¿œä¸è¦å†é”™è¿‡ä½ çš„æŠ€æœ¯é¢è¯•](https://www.fullstack.cafe)

## [](#error-return-value)**é”™è¯¯è¿”å›å€¼**

ä¸å¼‚æ­¥å·¥ä½œçš„æœ€ç®€å•æ¨¡å¼ã€‚è€ƒè™‘:

```
var validateObject = function (obj) {
    if (typeof obj !== 'object') {
        return new Error('Invalid object');
    }
}; 
```

## [](#error-throwing)**é”™è¯¯æŠ•æ·**

å»ºç«‹è‰¯å¥½çš„æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå‡½æ•°åšå®ƒè¯¥åšçš„äº‹æƒ…ï¼Œå¦‚æœå‡ºç°é”™è¯¯æƒ…å†µï¼Œå®ƒåªæ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ä¼šè®©ä½ å¤„äºä¸ç¨³å®šçŠ¶æ€ã€‚æŠ“ä½å®ƒä»¬éœ€è¦é¢å¤–çš„å·¥ä½œã€‚æ­¤å¤–ï¼Œå°†å¼‚æ­¥è°ƒç”¨åŒ…è£…åœ¨ try/catch ä¸­ä¹Ÿæ— æµäºäº‹ï¼Œå› ä¸ºé”™è¯¯æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦*åŸŸ*ã€‚åŸŸæä¾›äº†å¼‚æ­¥å°è¯•...æ¥ä½ã€‚

```
var validateObject = function (obj) {
    if (typeof obj !== 'object') {
        throw new Error('Invalid object');
    }
};

try {
    validateObject('123');
}
catch (err) {
    console.log('Thrown: ' + err.message);
} 
```

## [](#error-callback)**é”™è¯¯å›è°ƒ**

é€šè¿‡å›è°ƒè¿”å›é”™è¯¯æ˜¯ Node.js ä¸­æœ€å¸¸è§çš„é”™è¯¯å¤„ç†æ¨¡å¼ã€‚å¤„ç†é”™è¯¯å›è°ƒå¯èƒ½ä¼šå˜å¾—ä¸€å›¢ç³Ÿ(å›è°ƒåœ°ç‹±æˆ–æœ«æ—¥é‡‘å­—å¡”)ã€‚

```
var validateObject = function (obj, callback) {
    if (typeof obj !== 'object') {
        return callback(new Error('Invalid object'));
    }
    return callback();
};

validateObject('123', function (err) {
    console.log('Callback: ' + err.message);
}); 
```

## [](#error-emitting)**é”™è¯¯å‘å°„**

å½“å‘å‡ºé”™è¯¯æ—¶ï¼Œé”™è¯¯è¢«å¹¿æ’­ç»™ä»»ä½•æ„Ÿå…´è¶£çš„è®¢é˜…è€…ï¼Œå¹¶æŒ‰ç…§è®¢é˜…çš„é¡ºåºåœ¨åŒä¸€ä¸ªè¿›ç¨‹èŠ‚æ‹å†…å¤„ç†ã€‚

```
var Events = require('events');
var emitter = new Events.EventEmitter();

var validateObject = function (a) {
    if (typeof a !== 'object') {
        emitter.emit('error', new Error('Invalid object'));
    }
};

emitter.on('error', function (err) {
    console.log('Emitted: ' + err.message);
});

validateObject('123'); 
```

## [](#promises)**æ‰¿è¯º**

ç”¨äºå¼‚æ­¥é”™è¯¯å¤„ç†çš„æ‰¿è¯ºã€‚è€ƒè™‘:

```
doWork()
.then(doWork)
.then(doError)
.then(doWork)
.catch(errorHandler)
.then(verify); 
```

## [](#trycatch-with-asyncawait)**è¯•è¯•...å¼‚æ­¥æ•æ‰/ç­‰å¾…**

ES7 Async/await å…è®¸æˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜ç¼–å†™çœ‹èµ·æ¥åŒæ­¥çš„å¼‚æ­¥ JS ä»£ç ã€‚

```
async function f() {

  try {
    let response = await fetch('http://no-such-url');
  } catch(err) {
    alert(err); // TypeError: failed to fetch
  }
}

f(); 
```

## **wait-to-js åº“**

Javascript ä¸­ä¸å¸¦ try-catch å—çš„ async/await çš„å˜ä½“ã€‚è€ƒè™‘:

```
import to from 'await-to-js';

async function main(callback) {
    const [err,quote] = await to(getQuote());
    if(err || !quote) return callback(new Error('No Quote found');
    callback(null,quote);
} 
```

ğŸ”—**æ¥æº:**ã€gist.github.comã€‘T2

> è°¢è°¢ğŸ™Œé˜…è¯»ï¼Œç¥ä½ é¢è¯•å¥½è¿ï¼
> *æŸ¥çœ‹æ›´å¤š FullStack é¢è¯•é—®é¢˜&ç­”æ¡ˆä¸ŠğŸ‘‰ [www.fullstack.cafe](https://www.fullstack.cafe)*