# 那天每个人都变成了迈克尔·约翰逊。F5 的一课。

> 原文:[https://dev . to/_ Adam _ Barker/the-day-every one-turned-to-a-lesson-in-F5-7dj](https://dev.to/_adam_barker/the-day-everyone-turned-into-michael-johnson-a-lesson-in-f5-7dj)

这篇文章没有真正的意义——它不是我通常擅长的演讲之一，也没有关键的要点或行动号召。

只是最近想起来的很多年前发生的一件很搞笑的事。

我想那是 2002 年，我加入了英国的一家小公司，做软件开发员。(这是在新公司被称为创业公司之前，在加入新公司很酷之前)。该公司设计了一种电信产品，以低廉的月费向企业提供无限通话。

在当时，这是一个革命性的想法，我们很快赢得了许多客户。我们开发了计费系统，进行业务开发，我们有一个小小的呼叫中心，应有尽有。

### [](#classic-asp)经典 ASP

我们的技术主要基于微软。我们有一个经典的 ASP 网站，运行在 SQL Server 上。一切运行良好，但我们缺乏的是任何形式的偶然性。我们发展得如此之快，以至于没有人有时间考虑灾难恢复、数据库备份甚至源代码控制。

单元测试和集成测试不存在，异常处理很少，问题在生产中被发现就被解决了。

你可以看到这是怎么回事。

### [](#the-billing-run)计费运行

对我们来说，每月最重要的一件事就是结账。这基本上包括运行一个作业，该作业将计算每个客户的账单并生成一个文档，该文档将通过电子方式发送到一个异地打印位置。从那里，钞票将被包装成品牌信纸并邮寄给顾客。一旦账单生成，它将被保存到一个在线位置，这样我们就有一个创建的 PDF 副本供参考。

结账的时候总是压力很大。因为在这项工作开始运行后，我们基本上不再插手，我们总是担心账单是否准确，以及我们是否正确地计算了一切。(在内心深处，我们知道总会出问题，因为我们仓促行事)。

### [](#bob)摇头晃脑

我当时的同事是个很棒的小伙子。在我们相遇后，我们成了亲密的朋友，因此他不会介意我说，尽管他是一名软件开发人员，但软件开发并不是他的强项。我会很荣幸地保护他的身份，叫他鲍勃。(他的名字其实是鲍勃)。

鲍勃有非凡的能力…比如说，打破东西。我不确定他是否真的想要造成如此大的破坏，但他有一个很好的记录，删除东西，丢失东西，丢失数据库和表格，上班迟到，忘记下班回家，忘记办公室在哪里。这个清单是无穷无尽的。

### [](#update-dbocustomers)更新 dbo.customers...

一天，我们接到一个来自呼叫中心的请求。一个客户的名字有一个错别字，需要更正。顾客很不高兴。呼叫中心的操作员无法更改名称，因为系统有问题。很自然。

我们都相当紧张，因为我们正处于开票过程中。一般来说，在计费运行过程中改变任何东西都被认为是一个坏主意。我们甚至害怕在结账的时候接电话。

无论如何，Bob 接了电话，听到了关于 Michael Jonson 是如何漏掉一个 H 的故事，并兴奋地意识到他可能可以用最小的影响来解决这个问题。简单的数据库更新。毕竟，他并不需要修改代码和重新部署。

熟悉大多数 SQL 工具的人都知道，虽然您可以编写大型脚本或过程，但也有可能突出显示脚本的一部分并孤立地执行它。

这种功能是 Bob 那天的败笔，因为 Bob 写了这样一个声明:

 `UPDATE dbo.customers SET firstName=‘Michael’, lastName=‘Johnson’
WHERE id = 187222;` 

(精明的管理员会奇怪为什么我们的表在 dbo 模式中。我的回答是:说得好。

其次，我需要指出，187222 是一个任意的数字，丝毫不能表明我们的客户数量。

Bob 接着用鼠标突出显示该语句，并按 F5 键，立即执行该语句。只是他没有突出两行，只突出了第一行。

此时，我们的生产客户表中的每个人都有相同的名字。

这些天来，我对错误的反应更加专业，但当时我突然大笑起来。这是如此…鲍勃。

短短几分钟后，我们接到了异地打印位置的电话，通知我们每个人的账单突然有了相同的名称。我们需要重新运行计费程序。

显然，我们没有生产数据库的最新备份，Bob 在接下来的几个小时里找到了它，恢复了它，并更正了所有客户的姓名。

到我们可以重新运行计费运行时，计费周期已经稍微过了，这意味着我们需要在每个人的计费中包含一封信，告诉他们发生了什么。

这里有许多教训要吸取。鲍勃没有学习任何一门课程，他立即被解雇了。这当然是个笑话，在英国你不能解雇任何人。但是事情已经发生了变化，值得庆幸的是开发方法和通用 DevOps 已经有了很多安全措施。

尽管如此，当我按下 F5 键时，我总是会想起迈克尔·约翰逊。