# 微服务是你成长的过程，而不是一开始就有的

> 原文:[https://dev . to/nickjj/microservice-is-something-you-grow-into-not-begin-with-2lj](https://dev.to/nickjj/microservices-are-something-you-grow-into-not-begin-with-2llj)

**本文最初发布于 2018 年 8 月 21 日:[https://nickjanetakis . com/blog/microservice-is-something-you-grow-into-not-begin-with](https://nickjanetakis.com/blog/microservices-are-something-you-grow-into-not-begin-with)T3】**

* * *

作为软件开发人员，我们有一个非常有趣的职业。有一天，我们可能正在愉快地编码，然后读了一篇关于某事的文章，突然你开始质疑你的整个编程相关的存在，因为网飞说 XYZ。

就像这样，从一个个人或公司的观点出发，你开始质疑你多年来所做的一切，即使它对你来说一直很好。

## 你不是谷歌(除非你是谷歌)

当我们浏览 HackerNews 和其他编程新闻网站时，我们经常会看到来自谷歌、网飞、亚马逊和脸书的技术帖子，他们喜欢谈论他们运营的成百上千的服务，以及按照他们的方式做事的好处。这是过去几年的趋势。

但是让我们面对现实吧。你可能没有 1000 名开发人员在一个有着 10 多年历史的大型项目上工作。

仅仅因为谷歌这么做，并不意味着你也应该这么做。

我们在一个完全不同的星系中运作。谷歌面临着我们可能永远不会面临的问题，但同时我们可以做谷歌做不到的事情。

## 大多数软件项目是如何开始的？

很多项目都是从一个人开始做所有的编程工作。有一百万个例子，但是让我们看看 Shopify。Shopify 最初是由 Tobias Lütke 编写的(它基于 Ruby on Rails，顺便说一下，现在仍然是)。

你认为 Tobias 会坐在那里犹豫不决吗？在他写一行代码之前，他曾煞费苦心地试图创建一个完美的基于微服务的架构。

当然不是。当他开发 Shopify 的第一个版本时，我不在那里，Shopify 最初只是一个滑雪板设备的电子商务商店，但如果他和我一样(一个典型的开发人员)，它可能是这样的:

1.  在构建你的初始产品时学习一项新技术
2.  写一些非常不习惯/蹩脚但完全有效的代码
3.  看到它开始走到一起，并感到兴奋
4.  重构“用火杀死它！”一旦它成为一个问题，编码成更好的代码
5.  在添加新功能和在生产中运行时，不断重复这个循环

这似乎是一个非常简单的循环，但是我花了大约 20 年的编程时间才真正理解这个循环有多深远。

作为一名程序员，在你写一行代码之前，你不会因为理论上精心设计的最佳设置而变得更好。

一旦你开始亲身经历真正的问题，你会通过写大量代码变得更好，并且绝对地、完全地用更好的代码替换你写的几乎所有东西。

您重写的初始代码不会浪费时间或精力。随着时间的推移，你变得越来越好，这是很重要的原因。这是秘制酱。

## 让我们来谈谈代码抽象

作为开发人员，我们都听说过这句话*“干:不要重复自己”*，一般来说，这是一个合理的指南，但通常情况下，重复自己是非常值得的。

重复你自己是值得的，因为如果你试图抽象一些东西而没有真正理解你正在抽象的东西，那么你就创造了一个叫做[漏抽象](https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/)的东西。

在我考虑重构一些代码来删除重复之前，我通常会重复 3 次。直到第四次或第五次，我才真正采取行动。

这是因为你真的需要看看你是如何在不同的情况下复制代码几次，然后你才知道什么需要变成变量，什么需要从你最初内联它的地方移走。

##### 抽象层次，从内联代码到外部库:

1.  编写内联代码
2.  在不同的地方重复几次代码
3.  将重复代码提取到函数/等中。
4.  暂时使用你的抽象概念
5.  查看该代码如何与其他代码交互
6.  将常用功能提取到内部库中
7.  长时间使用内部库
8.  真正理解所有的部分是如何组合在一起的
9.  创建外部库(开源等。)如果有意义的话

而这恰恰是你无法“发明”出一个好的库或者框架的地方。我们今天使用的几乎所有非常成功的工具都来自真实世界的项目，我们喜欢的工具是从真实的内部用例中提取出来的。

Rails 就是一个很好的例子。DHH(Rails 的作者)不是某天醒来说*“哎呀！是时候制作模型/控制器/和视图/目录了！”。*

没有。他开发了 Basecamp(一个真实的产品),某些模式出现了，这些模式被一般化，然后从 Basecamp 提升到 Rails。这个过程一直延续到今天，这也是 Rails 一直如此成功的唯一原因。

这是一场完美的风暴，由经过充分测试的(阅读:不是理论上精心制作的)抽象组成，并结合了一种编程语言，使您能够编写视觉上吸引人的代码。这也是为什么几乎所有“用 XYZ 语言编写的 Rails”框架都失败了。他们跳过了抽象链的关键组件，认为他们可以复制 Rails 所做的。

## 将代码抽象与微服务联系起来

对我来说，微服务只是另一个抽象层次。我不一定会说这是上面列表中的第 10 步，因为不是所有的库都是微服务，但在概念层面上是相似的。

微服务不是你从第一天开始就要做的事情，就像你不会在第一天写一行代码之前就试图创建一个完美的开源外部库一样。那时你甚至不知道你在做什么。

随着时间的推移，当你在处理代码库时遇到真正的问题时，你可能会逐渐适应基于微服务的架构。

你可能永远也不会遇到这些问题，而且很多这些问题也可以通过其他方式解决。看看 Basecamp 和 Shopify。它们都是做得非常好的单片应用程序。

我想没有人会管它们叫小应用。当然，他们的运营规模没有谷歌大，但让我们来看一下这个问题。

#### Shopify 凭借一款独一无二的应用每月收入 1700 多万美元

截至 2018 年年中，Shopify 公开宣布，他们的平台上有 [600，000+家企业在运营在线商店](https://stackshare.io/shopify/e-commerce-at-scale-inside-shopifys-tech-stack)。

Shopify 是一个 SAAS 应用程序，其最便宜的计划是每月 29 美元，我感觉很多企业都在使用每月 79 美元的计划。在任何情况下，即使 60 万人使用他们最便宜的每月 29 美元的计划，仅从他们业务的 SAAS 方面每月就有 1740 万美元的收入。

Basecamp 是另一个非常大的单片应用程序。关于 Basecamp 有趣的是，他们只有大约 50 名员工，其中只有一小部分是从事主要产品的软件工程师。

我的观点是，你可以在不陷入微服务的兔子洞的情况下走得很远。微服务应该基于需要知道的基础。

## 什么时候应该使用微服务？

这真的取决于你和你的团队的决定。这是其中的一件事，如果你处于微服务有意义的情况下，你不会在谷歌上搜索“微服务与整体服务”。你已经知道了。

但是有一种情况可能是，如果你有一大堆最适合开发应用程序的单个子部分的开发人员。让几十个团队独立地开发一个产品的不同组件是微服务的一个合理用例。

请记住，您可能有一个非常小的团队，随着时间的推移慢慢增长，所以您可能会从 1 或 2 个微服务开始，并从那里继续发展。你可能不会最终全力以赴，立刻将一个整体转变成 100 个服务。

#### 果汁值得榨吗？

另外值得一提的是，过渡到微服务会带来一系列挑战和问题。你在用一个问题交换另一个问题，所以你需要权衡利弊，看它对你的项目是否值得。

最大的问题之一是监控。突然之间，你有了一堆服务，它们可以用不同的技术栈编写，运行在多台机器上，你需要一种方法来窥探一切的细节。

这是一项艰巨的任务，因为理想情况下，您会希望所有这些服务使用一个统一的服务来收集和显示这些指标。

你可能不想为此开发自己的工具，因为这可能是一份全职工作，这也是像 [LightStep](https://lightstep.com/) 这样的公司如此成功的部分原因。它们是我在旅行中遇到的最有趣的监控服务之一。

他们的产品更多的是针对大规模的应用(有充分的理由)，但它也可以用于小规模的项目。自从他们在第四天的[云场展示后，我最近才听说他们。](https://nickjanetakis.com/blog/coming-back-to-cloud-field-day-for-the-second-time)

不管怎样，监控只是众多挑战中的一个，但是我想我应该提出来，因为它是更令人痛苦的问题之一。

## 最后的想法

我写这篇文章主要有两个原因:

**首先是**，两周前我参加了[云场第四天](https://nickjanetakis.com/blog/coming-back-to-cloud-field-day-for-the-second-time)，碰巧做了一个相关主题的群组播客。这应该在几个月后出来(我会更新这篇文章的链接)，但我想在这里详细阐述我的一些观点。

**其次**，作为一个创建[在线课程](https://nickjanetakis.com/courses/)的人，我经常收到很多人关于如何设计他们的应用程序的问题。

我看到的一个普遍趋势是，许多人甚至在编写一行代码之前，就开始试图将他们的应用程序分解成独立的服务。甚至想从一开始就把应用程序的组件分解成多个数据库。

这是阻碍他们前进的东西，作为一名开发人员，我知道陷入优柔寡断的循环是多么令人沮丧(我也有过这样的经历！).

**顺便说一下**，我目前正在开发一个相当大的 SAAS 应用程序，这是一个定制的课程托管平台。现在只有我在这个项目上工作，你可以肯定我在第一天就打开了代码编辑器，开始写代码。

我全心全意地保持它作为一个宏伟的整体，直到它不再有意义，但我的蜘蛛侠感觉告诉我，我永远不会达到这一点。

**你怎么看待这个话题？下面让我知道。**