# ç”¨ Kafka å’Œ Python æ„å»ºæµåª’ä½“æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ

> åŸæ–‡:[https://dev . to/florimondmanca/building-a-streaming-fraud-detection-system-with-Kafka-and-python-neg](https://dev.to/florimondmanca/building-a-streaming-fraud-detection-system-with-kafka-and-python-neg)

è¿™æ˜¯æˆ‘å…³äºç”¨ Apache Kafka æ„å»ºæµåº”ç”¨ç¨‹åºçš„ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ã€‚å¦‚æœä½ é”™è¿‡äº†ï¼Œä½ å¯ä»¥è¯»è¯»[çš„å¼€åœº](https://dev.to/florimondmanca/streaming-applications-with-apache-kafka-the-opening-58f0)ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¸ªç³»åˆ—ä¼šå­˜åœ¨ï¼Œä¼šæœ‰ä»€ä¹ˆæœŸå¾…ã€‚

è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†äº²è‡ªåŠ¨æ‰‹ï¼Œä½¿ç”¨ Python å®¢æˆ·æœºåˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç”± Apache Kafka æ”¯æŒçš„æµåº”ç”¨ç¨‹åºã€‚æˆ‘ä¼šè¯•ç€è®©å®ƒå°½å¯èƒ½æ¥è¿‘**ç°å®ä¸–ç•Œ**çš„å¡å¤«å¡åº”ç”¨ã€‚

æˆ‘å†™è¿™ç¯‡åšæ–‡æ˜¯ä½œä¸º**æ•™ç¨‹**ã€‚ä½ ä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºæµå¤„ç†å’Œ Apache Kafka çš„çŸ¥è¯†â€”â€”æˆ‘ä¼šè¾¹èµ°è¾¹è§£é‡Šæ¦‚å¿µå’Œæœ¯è¯­â€”â€”ä½ å°†èƒ½å¤Ÿç†è§£æˆ‘ä»¬æ„å»ºç³»ç»Ÿçš„è¿‡ç¨‹ã€‚

æˆ‘ä»¬è¦å»ºç«‹çš„æ˜¯ä¸€ä¸ªå®æ—¶æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿã€‚æˆ‘ä»¬å°†ä»å¤´å¼€å§‹åš**ã€‚æˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªäº¤æ˜“æµï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œä»¥æ£€æµ‹å“ªäº›äº¤æ˜“æ˜¯æ½œåœ¨çš„æ¬ºè¯ˆã€‚**

 **å¬èµ·æ¥å¾ˆåˆºæ¿€ï¼Ÿå¸Œæœ›å¦‚æ­¤ï¼

ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æ”¯æŒè¿™ç¯‡åšæ–‡çš„å®Œæ•´ä»£ç ã€‚

## å…ˆå†³æ¡ä»¶

æˆ‘å†™äº†è¿™ç¯‡æ–‡ç« ï¼Œè¿™æ ·ä½ å°±å¯ä»¥**è·Ÿç€**ä¸€èµ·å¼€å‘å„ç§åº”ç”¨ã€‚ä½†æ˜¯ï¼Œä¼šæœ‰ä¸€äº›å‰ææ¡ä»¶ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ª Kafka é›†ç¾¤ã€‚è¿™é€šå¸¸ä¸ä¼šå ç”¨å¤ªå¤šèµ„æºï¼Œä½†æ˜¯æ‚¨å¯èƒ½éœ€è¦ä¸€å°åƒæ ·çš„å¼€å‘æœºå™¨ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Docker Compose** è¿è¡Œé›†ç¾¤ï¼Œå› ä¸ºè¿™å°†ä½¿æˆ‘ä»¬å°½å¯èƒ½åœ°æ¥è¿‘ç”Ÿäº§ç³»ç»Ÿâ€”â€”çœŸå®ä¸–ç•Œçš„*ã€‚æ‰€ä»¥ç¡®ä¿ä½ å·²ç»å®‰è£…äº† [Docker](https://docs.docker.com/install/) å’Œ [Docker Compose](https://docs.docker.com/compose/) ã€‚*

æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä¹ŸæœŸæœ›ä½ æœ‰**ä¸€äº› Docker å’Œ Docker Compose** çš„çŸ¥è¯†ã€‚è™½ç„¶æˆ‘å°†è§£é‡Šæ›´è¯¦ç»†çš„ç»†èŠ‚ï¼Œä½†æ‚¨è‡³å°‘åº”è¯¥çŸ¥é“å¦‚ä½•è¯»å–ä¸€ä¸ª`Dockerfile`å’Œä¸€ä¸ª`docker-compose.yml`æ–‡ä»¶ã€‚

æœ€åï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨ **Python** æ„å»ºåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æœ€åçš„å…ˆå†³æ¡ä»¶æ˜¯å¯¹ Python è¯­è¨€å’Œç”Ÿæ€ç³»ç»Ÿæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚

å·®ä¸å¤šå°±è¿™äº›äº†ï¼Œè®©æˆ‘ä»¬è¨€å½’æ­£ä¼ å§ï¼

## ç‚¹ç‡ƒäº†å½“åœ°çš„å¡å¤«å¡é›†ç¾¤

Apache Kafka æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå’Œæ‰€æœ‰è½¯ä»¶ä¸€æ ·ï¼Œå®ƒè¿è¡Œåœ¨çœŸå®çš„è®¡ç®—æœºä¸Šï¼Œä¹Ÿå°±æ˜¯ä½ è‡ªå·±çš„è®¡ç®—æœºä¸Šã€‚

é¦–å…ˆï¼Œè®²ä¸€ç‚¹**æœ¯è¯­**ã€‚Kafka æ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼Œå®ƒåœ¨ä¸€ä¸ª**é›†ç¾¤**ä¸­è¿è¡Œï¼Œå³å¤šä¸ªè®¡ç®—æœº(ä¹Ÿç§°ä¸º**èŠ‚ç‚¹**)ç›¸äº’é€šä¿¡ã€‚åœ¨å¡å¤«å¡çš„è¡Œè¯ä¸­ï¼ŒèŠ‚ç‚¹è¢«ç§°ä¸º**ç»çºªäºº**ã€‚ä½ çš„ç”µè„‘å°†æ˜¯è¿™é‡Œå”¯ä¸€çš„ä»£ç†ã€‚

å¡å¤«å¡éœ€è¦ä»€ä¹ˆæ‰èƒ½å¥”è·‘ï¼Ÿå®é™…ä¸Šï¼Œå®ƒåªéœ€è¦ä¸¤æ ·ä¸œè¥¿â€”â€”ä¸€ä¸ª Kafka broker å’Œä¸€ä¸ªåŠ¨ç‰©å›­ç®¡ç†å‘˜å®ä¾‹ã€‚

â€œä»€ä¹ˆæ˜¯åŠ¨ç‰©å›­ç®¡ç†å‘˜ï¼Ÿ!"

ä¿æŒå†·é™â€”â€”ä½ çœŸçš„ä¸éœ€è¦çŸ¥é“é‚£æ˜¯ä»€ä¹ˆã€‚ä½†ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåè°ƒè½¯ä»¶ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼ŒApache Kafka ä½¿ç”¨å®ƒæ¥è·Ÿè¸ªé›†ç¾¤çŠ¶æ€å’Œæˆå‘˜ã€‚å®ƒæ˜¯ä»»ä½• Kafka é›†ç¾¤çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬ä¸ä¼šè°ˆè®ºæ›´å¤šã€‚

åœ¨ä»‹ç»ä¸­ï¼Œæˆ‘æåˆ°æˆ‘ä»¬å°†ä½¿ç”¨ **Docker Compose** æ¥è¿è¡Œé›†ç¾¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ç»“æœå¦‚ä½•ã€‚

#### åç«™å¤åˆé…ç½®

è¿™æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„`docker-compose.yml`æ–‡ä»¶ã€‚å®ƒä½¿ç”¨äº†æ¥è‡ª[æ±‡åˆå¹³å°](https://www.confluent.io/product/confluent-platform/) â€” [æ±‡åˆå¹³å°](https://www.confluent.io)çš„ Docker å›¾åƒï¼Œè¯¥å¹³å°æ˜¯é˜¿å¸•å¥‡å¡å¤«å¡ç¤¾åŒºçš„ä¸»è¦å‚ä¸è€…ï¼Œå…¶çµæ„Ÿæ¥è‡ªä»–ä»¬çš„[å¡å¤«å¡å•èŠ‚ç‚¹ç¤ºä¾‹](https://github.com/confluentinc/cp-docker-images/blob/5.0.0-post/examples/kafka-single-node/docker-compose.yml)ã€‚

å®ƒæœ‰ä¸¤ä¸ªæœåŠ¡:ä¸€ä¸ªç”¨äº Kafka ä»£ç†ï¼Œä¸€ä¸ªç”¨äº Zookeeper å®ä¾‹ã€‚

```
version: '3'

services:

  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000

  broker:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘å°†è¯¦ç»†è¯´æ˜è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆâ€”ä½†æ˜¯å¦‚æœæ‚¨åªæ˜¯æƒ³è¿è¡Œå®ƒï¼Œæ‚¨ä¹Ÿå¯ä»¥è·³åˆ°ä¸‹ä¸€éƒ¨åˆ†ã€‚

ä¸º**åŠ¨ç‰©å›­ç®¡ç†å‘˜**å‡†å¤‡çš„`zookeeper`æœåŠ¡ã€‚å®ƒä½¿ç”¨èåˆå¹³å°çš„ Docker é•œåƒï¼Œ`cp-zookeeper`ã€‚è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å®šä¹‰äº† Zookeeper å¯ä»¥åœ¨å“ªä¸ªç«¯å£ä¸Šè®¿é—®(æˆ‘ä»¬å°†æŠŠè¿™ä¸ªç«¯å£ä¼ é€’ç»™ä»£ç†)ï¼Œä»¥åŠå®ƒçš„åŸºæœ¬æ—¶é—´å•ä½(ä¸€ä¸ªå¿…éœ€çš„é…ç½®ç»†èŠ‚)ã€‚

ç¬¬äºŒï¼Œ`kafka`æœåŠ¡æ˜¯æˆ‘ä»¬çš„**å¡å¤«å¡ç»çºªäºº**ã€‚åœ¨ä¸ºæ•°ä¸å¤šçš„ç¯å¢ƒå˜é‡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…³å¿ƒçš„ä¸¤ä¸ªæ˜¯`KAFKA_ZOOKEEPER_CONNECT`ï¼Œå®ƒå‘Šè¯‰ä»£ç†åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ° Zookeeperï¼Œä»¥åŠ`KAFKA_ADVERTISED_LISTENERS`ï¼Œå®ƒå®šä¹‰äº†æˆ‘ä»¬åœ¨å“ªé‡Œå¯ä»¥ä»å…¶ä»–åº”ç”¨ç¨‹åºè¿æ¥åˆ°ä»£ç†ã€‚ä½ ä¸éœ€è¦å…³å¿ƒå¤åˆ¶å› å­ï¼›æˆ‘åªæƒ³å‘Šè¯‰æ‚¨ï¼Œå®ƒè¢«è®¾ç½®ä¸º 1ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªä»£ç†ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†é›†ç¾¤çš„ Docker ç»„åˆé…ç½®ï¼Œè®©æˆ‘ä»¬â€¦

#### æ—‹è½¬èµ·é›†ç¾¤ï¼

ç°åœ¨æ˜¯æ—¶å€™**å¯åŠ¨æˆ‘ä»¬å½“åœ°çš„å¡å¤«å¡é›†ç¾¤**äº†ã€‚æ€ä¹ˆä¼šï¼Ÿå¦‚æœä½ äº†è§£ Docker Composeï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚åªéœ€è½¬åˆ°æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•(`docker-compose.yml`æ‰€åœ¨çš„ä½ç½®)å¹¶è¿è¡Œ:

```
$ docker-compose up 
```

Enter fullscreen mode Exit fullscreen mode

æ‚¨å°†åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä¸€å¤§å †æ—¥å¿—â€”â€”åˆ«æ‹…å¿ƒï¼è¿™å¾ˆæ­£å¸¸ã€‚å¡å¤«å¡å’ŒåŠ¨ç‰©å›­ç®¡ç†å‘˜åœ¨å¯åŠ¨æ—¶éƒ½ç›¸å½“å•°å—¦ã€‚è¦çŸ¥é“å®ƒä»¬ä½•æ—¶å®Œæˆåˆå§‹åŒ–ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„ç»ˆç«¯ä¸­è¿è¡Œã€‚å®ƒç­‰å¾…`broker`æœåŠ¡è¾“å‡ºä¸€ä¸ªâ€œstartedâ€æ¶ˆæ¯ã€‚

```
$ docker-compose logs -f broker | grep started
broker_1 | INFO [KafkaServer id=1] started (kafka.server.KafkaServer) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœçœŸçš„å‘ç”Ÿäº†ï¼Œæ­å–œä½ ï¼ç°åœ¨ï¼Œæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªå¯åŠ¨å¹¶è¿è¡Œçš„å•èŠ‚ç‚¹ Kafka é›†ç¾¤ã€‚å®ƒæœ¬èº«å¯èƒ½æ²¡ä»€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¼€å§‹ä¼ è¾“ä¸€äº›æ•°æ®æ€ä¹ˆæ ·ï¼Ÿ

## è¿›å…¥:æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ

æ²¡é”™â€”â€”ç°åœ¨æ˜¯æˆ‘ä»¬å¼€å§‹å»ºé€ ä¸œè¥¿çš„æ—¶å€™äº†ï¼ğŸ‰

æˆ‘æœ¬å¯ä»¥ç»å†ä¸€ä¸ªâ€œä½ å¥½ï¼Œä¸–ç•Œï¼â€æµåº”ç”¨ç¨‹åºï¼Œä½ åœ¨ä¸€ç«¯(ç”Ÿäº§è€…)è¾“å…¥ä¸€äº›æ¶ˆæ¯ï¼Œåœ¨å¦ä¸€ç«¯(æ¶ˆè´¹è€…)å®æ—¶æ¥æ”¶å®ƒä»¬ã€‚ä½†æ˜¯åœ¨ [Confluent çš„ Docker Quickstart](https://docs.confluent.io/current/quickstart/cos-docker-quickstart.html#cos-docker-quickstart) å’Œå…¶ä»–åœ°æ–¹å·²ç»æœ‰äº†è¿™ä¸ªæ•™ç¨‹ã€‚

ç›¸åï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬å»ºç«‹ä¸€ä¸ª**çœŸå®ç³»ç»Ÿ**æ¥è§£å†³ä¸€ä¸ª**å®é™…ä¸šåŠ¡ç”¨ä¾‹**ã€‚æ§åˆ¶æ–‡ç« çš„èŒƒå›´å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒæ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚

æˆ‘ä»¬å°†æ„å»ºçš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªç®€å•çš„**æ¬ºè¯ˆæ£€æµ‹æœºåˆ¶**â€”â€”ä½ å¯èƒ½ä¼šåœ¨é“¶è¡Œå’Œäº¤æ˜“ç›‘æ§ç³»ç»Ÿä¸­é‡åˆ°åŒæ ·çš„æœºåˆ¶ã€‚

æˆ‘ä»¬å°†åœ¨ä¸€ç«¯ç”Ÿæˆè™šå‡äº¤æ˜“ï¼Œåœ¨å¦ä¸€ç«¯è¿‡æ»¤å¹¶è®°å½•é‚£äº›çœ‹èµ·æ¥å¯ç–‘çš„äº¤æ˜“ã€‚è¿™å°†æ¶‰åŠä¸€ä¸ª**äº¤æ˜“ç”Ÿæˆå™¨**(ä»…ä»…å› ä¸ºæˆ‘ä»¬éœ€è¦å¤„ç†ææ–™)å’Œä¸€ä¸ª**æ¬ºè¯ˆæ£€æµ‹å™¨**ã€‚è¿™ä¸¤ä¸ªåº”ç”¨ç¨‹åºéƒ½å°†åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œï¼Œå¹¶ä¸æˆ‘ä»¬çš„ Kafka é›†ç¾¤äº¤äº’ã€‚

<figure>

[![](../Images/e21da2e79c2524dce347072ebb066636.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8FZUJGTq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/d37ac6ca-64e7-4f26-9f51-baccd9022544.png)

<figcaption>Block diagram of the fraud detection system.</figcaption>

</figure>

ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¿™ä¸ªç³»ç»ŸèƒŒåçš„åŸºæœ¬æ€æƒ³ï¼Œè®©æˆ‘ä»¬å¼€å§‹å†™ä¸€äº›ä»£ç ï¼Œå¥½å—ï¼Ÿ

## åˆ›å»ºåº”ç”¨æ¡†æ¶

æˆ‘ä»¬å°†é¦–å…ˆä¸ºäº¤æ˜“ç”Ÿæˆå™¨å’Œæ¬ºè¯ˆæ£€æµ‹å™¨åˆ›å»ºé›†è£…ç®±åŒ–çš„æ¡†æ¶ã€‚å®ƒä»¬å°†æ˜¯ç›´æ¥çš„ Python åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨ä¸¤ç§æƒ…å†µä¸‹ä½¿ç”¨ç›¸åŒçš„`Dockerfile`:T1

```
# Dockerfile
FROM python:3.6

WORKDIR /usr/app

ADD ./requirements.txt ./
RUN pip install -r requirements.txt
ADD ./ ./

CMD ["python", "app.py"] 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªåŒ…å«è¿™ä¸ª`Dockerfile`çš„æ–‡ä»¶å¤¹:ä¸€ä¸ªç”¨äºäº¤æ˜“ç”Ÿæˆå™¨ï¼Œä¸€ä¸ªç”¨äºæ¬ºè¯ˆæ£€æµ‹å™¨ã€‚

æˆ‘ä»¬è¿˜å°†æœ‰ä¸€ä¸ª Python ä¾èµ–é¡¹â€” [Kafka Python](https://github.com/dpkp/kafka-python) ï¼ŒKafka çš„ä¸€ä¸ª Python å®¢æˆ·ç«¯(ä»¥åŠå…¶ä»–)ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥æ„å»ºä¸ Kafka é›†ç¾¤äº¤äº’çš„åº”ç”¨ç¨‹åºã€‚

```
# requirements.txt
kafka-python 
```

Enter fullscreen mode Exit fullscreen mode

å®é™…çš„ Python ä»£ç å°†ä¿å­˜åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºçš„`app.py`æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„æ–‡ä»¶å¤¹ç»“æ„:

```
.
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ detector
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ app.py
â”‚   â””â”€â”€ requirements.txt
â””â”€â”€ generator
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ app.py
    â””â”€â”€ requirements.txt 
```

Enter fullscreen mode Exit fullscreen mode

ç¨åï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›æœåŠ¡é›†æˆåˆ°æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒä¸­ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘å¸¦æ‚¨çœ‹ä¸€ä¸‹å°† Kafka æ”¾å…¥å…¶è‡ªå·±çš„ Docker Compose çš„è¿‡ç¨‹ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬åƒä½¿ç”¨å®é™…çš„ç”Ÿäº§é›†ç¾¤ä¸€æ ·ä½¿ç”¨å®ƒã€‚

## å­¤ç«‹å¡å¤«å¡é›†ç¾¤

åœ¨åˆ¶ä½œä¸­ï¼Œ**å¡å¤«å¡æ€»æ˜¯ä½œä¸ºä¸€ç§æœåŠ¡**ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œé›†ç¾¤ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„åº”ç”¨ç¨‹åºè¿è¡Œ**ã€‚åè€…åªéœ€**å°†**è¿æ¥åˆ°é›†ç¾¤ï¼Œä»¥ä»é›†ç¾¤å‘å¸ƒæˆ–è¯»å–äº‹ä»¶ã€‚**

æˆ‘ä»¬æ­£è¯•å›¾æ„å»ºä¸€ä¸ªçœŸå®ä¸–ç•Œçš„ç³»ç»Ÿï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹Ÿä¸ä¸€ä¸ªç‹¬ç«‹çš„ã€ç±»ä¼¼ç”Ÿäº§çš„ Kafka é›†ç¾¤äº¤äº’æ€ä¹ˆæ ·ï¼Ÿ

ä¸ºäº†åœ¨æœ¬åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„`zookeeper`å’Œ`broker`æœåŠ¡è½¬ç§»åˆ°ä¸€ä¸ª**å•ç‹¬çš„ Docker ç»„åˆé…ç½®**ã€‚è®©æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ª`docker-compose.kafka.yml`æ–‡ä»¶é‡Œã€‚ç¨åï¼Œæˆ‘ä»¬å°†åªå¯¹æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡ä½¿ç”¨å¸¸è§„çš„`docker-compose.yml`ã€‚

```
# docker-compose.kafka.yml
version: '3'

services:
    # ... zookeeper and broker as before ... 
```

Enter fullscreen mode Exit fullscreen mode

è™½ç„¶ä½ å¯èƒ½è®¤ä¸ºè¿™å·²ç»è¶³å¤Ÿäº†ï¼Œä½†è¿˜ç¼ºå°‘ä¸€äº›ä¸œè¥¿ã€‚ä¸ºäº†å…è®¸ä¸¤ä¸ªç»„åˆè®¿é—®**ç›¸åŒçš„ç½‘ç»œ**(è®°ä½æ¯ä¸ª Docker ç»„åˆæ–‡ä»¶é»˜è®¤ä½¿ç”¨å®ƒä»¬è‡ªå·±çš„ç§æœ‰ç½‘ç»œ)ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª**å¤–éƒ¨ Docker ç½‘ç»œ**ã€‚æˆ‘ä»¬å°±å«å®ƒ`kafka-network`ã€‚ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºç½‘ç»œ:

```
$ docker network create kafka-network
85351a30f253b0fb8ae197ea07ddeddd0412c8a789e910dd4a3f424057122d30 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨`docker-compose.kafka.yml` :
ä¸­æ·»åŠ `networks`éƒ¨åˆ†

```
# docker-compose.kafka.yml
version: '3'

services:
    # ... zookeeper and broker as before ...

# NEW
networks:
  default:
    external:
      name: kafka-network 
```

Enter fullscreen mode Exit fullscreen mode

(å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥åœ¨ Docker Compose ä¸­é˜…è¯»æ›´å¤šå…³äº[ç½‘ç»œçš„å†…å®¹)ã€‚](https://docs.docker.com/compose/networking/)

é…·ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå•ç‹¬çš„ Docker Compose é…ç½®çš„ Kafka é›†ç¾¤ã€‚*é‚£åˆæ€æ ·ï¼Ÿ*

å—¯ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†èƒ½å¤ŸæŠŠé›†ç¾¤è§†ä¸ºä¸€ä¸ª**å®Œå…¨éš”ç¦»çš„ç³»ç»Ÿ**ã€‚æ‚¨å¯ä»¥ç‹¬ç«‹äº Docker åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†æ¥æ—‹è½¬æˆ–æ‹†å¸å®ƒâ€”â€”å°±åƒç°å®ä¸–ç•Œä¸­å‘ç”Ÿçš„ä¸€æ ·ã€‚

å®é™…ä¸Šï¼Œæ“ä½œè¿™ä¸ª Docker ç»„åˆéœ€è¦æˆ‘ä»¬ä½¿ç”¨`-f`æ ‡å¿—æ¥æŒ‡å®šæˆ‘ä»¬ä½¿ç”¨å“ªä¸ªé…ç½®ã€‚

ä¾‹å¦‚ï¼Œè¦åŠ é€Ÿ Kafka é›†ç¾¤ï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨:

```
docker-compose -f docker-compose.kafka.yml up 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœä½ æƒ³è®¿é—®æ—¥å¿—:

```
docker-compose -f docker-compose.kafka.yml logs broker 
```

Enter fullscreen mode Exit fullscreen mode

ä½ æ˜ç™½è¦ç‚¹äº†ã€‚

ç°åœ¨å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰ç›¸åŒç½‘ç»œé…ç½®çš„ç©ºçš„`docker-compose.yml`ï¼Œç¨åæˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ äº‹åŠ¡ç”Ÿæˆå™¨å’Œæ¬ºè¯ˆæ£€æµ‹æœåŠ¡:

```
# docker-compose.yml
version: '3'

services:
    # TODO: generator and detector coming soon

# Give this composition access to the Kafka network
networks:
  default:
    external:
      name: kafka-network 
```

Enter fullscreen mode Exit fullscreen mode

è½¬ç§»æ³¨æ„åŠ›åˆ°æ­¤ä¸ºæ­¢â€”â€”æˆ‘æƒ³æˆ‘ä»¬éƒ½å‡†å¤‡å¥½äº†ï¼è®©æˆ‘ä»¬å¼€å§‹æ„å»º**æµå¼æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ**ã€‚

## æ„å»ºäº¤æ˜“ç”Ÿæˆå™¨

è¦è¿›è¡Œæµå¤„ç†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæµã€‚è¿™å°±æ˜¯äº‹åŠ¡ç”Ÿæˆå™¨å‘æŒ¥ä½œç”¨çš„æ—¶å€™äº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ª**äº‹åŠ¡æµ**ã€‚

åœ¨ Kafka ä¸­ï¼Œæ‚¨å¯ä»¥æ„å»ºä¸€äº›ä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºã€‚ä¸€ç±»åº”ç”¨æ˜¯**ç”Ÿäº§è€…**ã€‚

åˆ¶ç‰‡äººåšçš„æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„â€”â€”ä»–ä»¬**å‘å¡å¤«å¡é›†ç¾¤å‘å¸ƒæ¶ˆæ¯**ã€‚è¿™äº›æ¶ˆæ¯å°†å­˜å‚¨åœ¨æˆ‘ä»¬çš„ä»£ç†ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**ä¸»é¢˜**â€”â€”ä¸€ä¸ªå‘½åçš„æ¶ˆæ¯ç£ç›˜å­˜å‚¨ã€‚

<figure>

[![](../Images/a9fddde70938ac76473395e79fe8cc10.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nlsL6MOI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/b51601f8-0fd0-4acc-bc94-14ec01e507fe.png)

<figcaption>How a Kafka producer works. Simple, right?</figcaption>

</figure>

ç°åœ¨ï¼Œæˆ‘æœ‰ä¸€äº›å¥½æ¶ˆæ¯ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ Python å®¢æˆ·ç«¯(Kafka Python)å…è®¸æˆ‘ä»¬æ„å»ºç”Ÿäº§è€…ã€‚ğŸ‰

å› æ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨ [Kafka Python çš„ç”Ÿäº§è€… API](https://github.com/dpkp/kafka-python#kafkaproducer) å°†æ¶ˆæ¯å‘é€åˆ°`transactions`ä¸»é¢˜ä¸­ã€‚

æˆ‘å¾ˆéš¾ä¸åœ¨è¿™é‡Œå¤åˆ¶ç²˜è´´ä¸€äº›ä»£ç ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå…³äº Kafka Python å®¢æˆ·ç«¯çš„æ•™ç¨‹ï¼Œæ‰€ä»¥æˆ‘å°†å¸¦æ‚¨å®Œæˆè¿™äº›æ­¥éª¤ã€‚å¦‚æœä½ æƒ³è¦æ›´å¤šçš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å‚è€ƒ [Kafka Python docs](https://kafka-python.readthedocs.io/en/latest/index.html) ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä» Kafka Python åº“æŠ“å–`KafkaProducer`å¼€å§‹ã€‚

```
from kafka import KafkaProducer 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åæˆ‘ä»¬è·å–æˆ‘ä»¬çš„ä»£ç†çš„ URL(ä»ä¸€ä¸ªç¯å¢ƒå˜é‡ä¸­â€”â€”æœ€ä½³å®è·µä»ç„¶é€‚ç”¨)ã€‚ç”Ÿäº§è€…ä½¿ç”¨è¯¥ URL å¼•å¯¼ä»–ä»¬ä¸ Kafka é›†ç¾¤çš„è¿æ¥ã€‚

```
import os
# ... KAFKA_BROKER_URL = os.environ.get('KAFKA_BROKER_URL') 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–å®é™…çš„ç”Ÿäº§è€…ã€‚å®ƒå…¬å¼€äº†ä¸€ä¸ªç®€å•çš„ API(è¯¦è§[æ–‡æ¡£](https://kafka-python.readthedocs.io/en/latest/apidoc/KafkaProducer.html))å‘ Kafka ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚

```
producer = KafkaProducer(bootstrap_servers=KAFKA_BROKER_URL) 
```

Enter fullscreen mode Exit fullscreen mode

ä¸‹ä¸€æ­¥æ˜¯â€”â€”æˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†åˆ¶ç‰‡äººï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å‘é€ä¿¡æ¯ã€‚ä»€ä¹ˆæ¶ˆæ¯ï¼Ÿå¥½é—®é¢˜ï¼è®©æˆ‘ä»¬æš‚æ—¶è·³è¿‡è¿™ä¸€æ­¥ï¼Œå‡è®¾æˆ‘ä»¬å‘é€ç©ºå­—ç¬¦ä¸²ã€‚

ç°åœ¨ï¼Œäº‹åŠ¡ç”Ÿæˆå™¨çš„ç›®æ ‡æ˜¯*ä¼ªé€ *ä¸€ä¸ª**æ— é™çš„äº‹åŠ¡æµ**æµç»æˆ‘ä»¬çš„ç³»ç»Ÿã€‚æ‰€ä»¥æˆ‘ä»¬å°†ç®€å•åœ°è¿è¡Œä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸ºä¸€ä¸ªä¸»é¢˜ç”Ÿæˆè¿™äº›æ¶ˆæ¯ã€‚

æ—æ³¨â€”â€”æˆ‘å–œæ¬¢ç”¨[å¦‚ä½•ç”»è‡ªè¡Œè½¦æ£š:å¡å¤«å¡ä¸»é¢˜å‘½åæƒ¯ä¾‹](https://medium.com/@criccomini/how-to-paint-a-bike-shed-kafka-topic-naming-conventions-1b7259790073)ä¸­çš„å»ºè®®æ¥å‘½åä¸»é¢˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å°†ä½¿ç”¨`queueing.transactions`ä½œä¸ºäº‹åŠ¡ä¸»é¢˜åç§°ï¼Œå®ƒæœ‰æ•ˆåœ°è¡¨ç¤ºäº†è¦å¤„ç†çš„äº‹åŠ¡é˜Ÿåˆ—ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•å®ç°è¿™æ ·ä¸€ä¸ªå¾ªç¯:

```
from time import sleep
# ... while True:
    message = ''  # TODO
    # Kafka messages are plain bytes => need to `.encode()` the string message
    producer.send('queueing.transactions', value=message.encode())
    sleep(1)  # Sleep for one second before producing the next transaction 
```

Enter fullscreen mode Exit fullscreen mode

æœ€åï¼Œè¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ Python æ–‡ä»¶:

```
# generator/app.py import os
from time import sleep
from kafka import KafkaProducer

KAFKA_BROKER_URL = os.environ.get('KAFKA_BROKER_URL')

if __name__ == '__main__':
    producer = KafkaProducer(bootstrap_servers=KAFKA_BROKER_URL)
    while True:
        message = ''  # TODO
        producer.send('queueing.transactions', value=message.encode())
        sleep(1) 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†`generator`åº”ç”¨æ·»åŠ åˆ°æˆ‘ä»¬çš„`docker-compose.yml`é…ç½®:

```
# docker-compose.yml
services:
  # ...
  generator:
    build: ./generator
    environment:
      KAFKA_BROKER_URL: broker:9092 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨æˆ‘ä»¬å¯åŠ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªä»£è¡¨äº‹åŠ¡çš„**å®é™…å€¼æ¥å¡«å……æ¶ˆæ¯ã€‚**

ä¸ºæ­¤ï¼Œæˆ‘æ„å»ºäº†ä¸€ä¸ªå®ç”¨å‡½æ•°`create_random_transaction()`,æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºéšæœºäº‹åŠ¡ã€‚è¿™äº›è´¦æˆ·å°†æœ‰ä¸€ä¸ª`source`è´¦æˆ·ã€ä¸€ä¸ª`target`è´¦æˆ·ã€ä¸€ä¸ª`amount`è´¦æˆ·å’Œä¸€ä¸ª`currency`ã€‚

è¿™éå¸¸ç®€å•ï¼Œæ‰€ä»¥æˆ‘åªæ˜¯å°†`transactions.py`æ–‡ä»¶å¤åˆ¶ç²˜è´´åˆ°è¿™é‡Œ:

```
# generator/transactions.py from random import choices, randint
from string import ascii_letters, digits

account_chars: str = digits + ascii_letters

def _random_account_id() -> str:
    """Return a random account number made of 12 characters."""
    return ''.join(choices(account_chars, k=12))

def _random_amount() -> float:
    """Return a random amount between 1.00 and 1000.00."""
    return randint(100, 1000000) / 100

def create_random_transaction() -> dict:
    """Create a fake, randomised transaction."""
    return {
        'source': _random_account_id(),
        'target': _random_account_id(),
        'amount': _random_amount(),
        # Keep it simple: it's all euros
        'currency': 'EUR',
    } 
```

Enter fullscreen mode Exit fullscreen mode

ä¸é”™ï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨ä¸€ä¸ªå‡äº¤æ˜“æ¥æ›¿æ¢ç©ºæ¶ˆæ¯:

```
from transactions import create_random_transaction

# ... transaction: dict = create_random_transaction()
message: str = json.dumps(transaction)
producer.send('queueing.transactions', value=message.encode())
# ... 
```

Enter fullscreen mode Exit fullscreen mode

è®©æˆ‘ä»¬é€šè¿‡ä½¿æˆ‘ä»¬çš„`generator`åº”ç”¨ç¨‹åºæ›´åŠ å¯é…ç½®æ¥æ·»åŠ æœ€åçš„æ¶¦è‰²â€”â€”è¿™æ€»æ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚è®©æˆ‘ä»¬:

*   å°†`queueing.transactions`ä¸»é¢˜æå–åˆ°`KAFKA_TRANSACTIONS_TOPIC`ç¯å¢ƒå˜é‡ä¸­
*   é€šè¿‡`TRANSACTIONS_PER_SECOND`ç¯å¢ƒå˜é‡é…ç½®ç¡çœ æ—¶é—´ã€‚
*   åˆ©ç”¨`KafkaProducer`çš„`value_serializer`å‚æ•°è‡ªåŠ¨å°†æ¶ˆæ¯ä» dict åºåˆ—åŒ–ä¸º JSON å­—èŠ‚ã€‚

ä¸‹é¢æ˜¯äº¤æ˜“ç”Ÿæˆå™¨ :
çš„**æœ€ç»ˆç‰ˆæœ¬**

```
# generator/app.py import os
import json
from time import sleep
from kafka import KafkaProducer
from transactions import create_random_transaction

KAFKA_BROKER_URL = os.environ.get('KAFKA_BROKER_URL')
TRANSACTIONS_TOPIC = os.environ.get('TRANSACTIONS_TOPIC')
TRANSACTIONS_PER_SECOND = float(os.environ.get('TRANSACTIONS_PER_SECOND'))
SLEEP_TIME = 1 / TRANSACTIONS_PER_SECOND

if __name__ == '__main__':
    producer = KafkaProducer(
        bootstrap_servers=KAFKA_BROKER_URL,
        # Encode all values as JSON
        value_serializer=lambda value: json.dumps(value).encode(),
    )
    while True:
        transaction: dict = create_random_transaction()
        producer.send(TRANSACTIONS_TOPIC, value=transaction)
        print(transaction)  # DEBUG
        sleep(SLEEP_TIME) 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ˜¯ Docker ç¼–å†™æœåŠ¡çš„æ ·å­:

```
# docker-compose.yml
services:
  generator:
      build: ./generator
      environment:
        KAFKA_BROKER_URL: broker:9092
        TRANSACTIONS_TOPIC: queueing.transactions
        TRANSACTIONS_PER_SECOND: 1000 
```

Enter fullscreen mode Exit fullscreen mode

## è¯•ç”¨äº‹åŠ¡ç”Ÿæˆå™¨

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè®©äº‹æƒ…è¿è½¬èµ·æ¥å¹¶æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦é¡ºåˆ©å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ¯•ç«Ÿï¼Œå¦‚æœä½ è‡ªå·±éƒ½ä¸èƒ½è¯å®ï¼Œæˆ‘åˆæœ‰ä»€ä¹ˆèµ„æ ¼å‘Šè¯‰ä½ è¿™è¡Œå¾—é€šå‘¢ï¼Ÿ

ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬é¦–å…ˆç¡®ä¿æœ¬åœ° Kafka é›†ç¾¤å¯åŠ¨ï¼Œç„¶åå¯åŠ¨ä¸» Docker Compose:

```
$ docker-compose up 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å°†å¯åŠ¨`generator`çš„åˆ¶ä½œäººã€‚

æˆ‘ä»¬çš„ debug `print`å°†æŠŠäº‹åŠ¡ä» Python è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä¿è¯æ¶ˆæ¯è¢«æœ‰æ•ˆåœ°ç”Ÿæˆåˆ°ä¸»é¢˜ã€‚

ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨èåˆå¹³å°ä¸­å†…ç½®çš„ä¸€ä¸ªè„šæœ¬ï¼Œå¹¶æ˜¾ç¤ºåœ¨`confluent/kafka-cp` Docker æ˜ åƒä¸­ã€‚è¿™ä¸ªè„šæœ¬å«åš`kafka-console-consumer`ã€‚å®ƒå…è®¸æ‚¨åœ¨æ§åˆ¶å°ä¸Šè¯»å–å’Œæ‰“å°ä¸»é¢˜çš„å†…å®¹ã€‚

è¯¥å‘½ä»¤éœ€è¦åœ¨`broker`å®¹å™¨ä¸­è¿è¡Œï¼Œè¿™ä½¿å¾—å®ƒæœ‰ç‚¹æ™¦æ¶©ï¼Œä½†æ˜¯å®ƒåœ¨è¿™é‡Œ(æ‚¨éœ€è¦åœ¨ä¸€ä¸ªå•ç‹¬çš„ç»ˆç«¯ä¸­è¿è¡Œ):

```
docker-compose -f docker-compose.kafka.yml exec broker kafka-console-consumer --bootstrap-server localhost:9092 --topic queueing.transactions --from-beginning 
```

Enter fullscreen mode Exit fullscreen mode

`--from-beginning`æ ‡å¿—æ„å‘³ç€è¯¥å‘½ä»¤å°†è¯»å–æ•´ä¸ªä¸»é¢˜ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯»å–æ–°æ¶ˆæ¯ã€‚

ä½ å¯ä»¥è®©å®ƒè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åæŒ‰`Ctrl+C`åœæ­¢`kafka-console-consumer`ï¼Œçœ‹é˜…è¯»æ¶ˆæ¯æ€»æ•°:

```
...
{"source": "Jpe2zq1QDYTn", "target": "lLbLnl0FSr7T", "amount": 254.83, "currency": "EUR"}
{"source": "mfGWAdLKW8jh", "target": "ede8FQpjBeej", "amount": 785.22, "currency": "EUR"}
{"source": "GufdRdi1TElh", "target": "u0ANirFVu76B", "amount": 407.64, "currency": "EUR"}
^C
Processed a total of 4783 messages 
```

Enter fullscreen mode Exit fullscreen mode

ç²¾å½©ï¼å®ƒèµ·ä½œç”¨äº†â€”â€”è™šå‡äº¤æ˜“è¢«æœ‰æ•ˆåœ°äº§ç”Ÿåˆ°ä¸»é¢˜ã€‚

æ‚¨å¯ä»¥æš‚æ—¶åœæ­¢å‘ç”µæœº:`Ctrl+C`æˆ–`$ docker-compose down`ã€‚

é‚£ä¹ˆï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æœ‰ä»€ä¹ˆå‘ç°ï¼Ÿ

*   ä¸€ä¸ªæœ¬åœ° Kafka é›†ç¾¤å¯åŠ¨å¹¶è¿è¡ŒğŸš€
*   ä¸€ä¸ªåŸºäºç”Ÿæˆå™¨çš„åº”ç”¨ç¨‹åºï¼Œå®ƒç”Ÿæˆè™šå‡çš„äº‹åŠ¡å¹¶å°†å®ƒä»¬å‘å¸ƒåˆ° Kafka ä¸»é¢˜ğŸ“

è¿™æ˜¯æ¶æ„å›¾:

<figure>

[![](../Images/20ae4b701faa60f1d111ead2edd6b17b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--N7SIVTIR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/8237aeaa-30d4-4ad8-8f23-6fa637af8ed9.png)

<figcaption>Transaction generator: check!</figcaption>

</figure>

æˆ‘ä»¬åªæ˜¯å¿½ç•¥äº†ä¸€ä»¶äº‹â€”â€”å®é™…çš„**æ¬ºè¯ˆæ£€æµ‹å™¨**å¤„ç†äº¤æ˜“æµå¹¶æ£€æµ‹å¯ç–‘äº¤æ˜“ï¼

## æ„å»ºæ¬ºè¯ˆæ£€æµ‹å™¨

æ¬ºè¯ˆæ£€æµ‹å™¨æ˜¯**æµå¤„ç†åº”ç”¨**çš„å…¸å‹ç¤ºä¾‹ã€‚

å®ƒå°†ä¸€ä¸ªäº¤æ˜“æµä½œä¸ºè¾“å…¥ï¼Œæ‰§è¡ŒæŸç§è¿‡æ»¤ï¼Œç„¶åå°†ç»“æœè¾“å‡ºåˆ°ä¸¤ä¸ªç‹¬ç«‹çš„æµä¸­â€”â€”åˆæ³•çš„å’Œå¯ç–‘çš„ï¼Œè¿™ç§æ“ä½œä¹Ÿè¢«ç§°ä¸º**åˆ†æ”¯**ã€‚

<figure>

[![](../Images/0f7aaa0164983af07b8def339b0c7562.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--gkM6dgTn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/288f76de-ccdb-4be3-83d8-672e0f9dd326.png)

<figcaption>The detector branches out the transaction stream in two separate streams. âœ‚ï¸</figcaption>

</figure>

é™¤äº†å°†æ¶ˆæ¯å‘å¸ƒåˆ°ä¸»é¢˜ä¸­çš„ç”Ÿäº§è€…ä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§ç±»å‹çš„ Kafka åº”ç”¨ç¨‹åºå¯ä»¥ä»ä¸»é¢˜ä¸­è¯»å–æ¶ˆæ¯ã€‚ä»–ä»¬è¢«ç§°ä¸º**æ¶ˆè´¹è€…**ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ä¸Šé¢çš„`kafka-console-consumer`è„šæœ¬ä½¿ç”¨äº†ä¸€ä¸ªï¼

æ¶ˆè´¹è€…å¯ä»¥é˜…è¯»ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜çš„ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œä»–ä»¬**è®¢é˜…è¿™äº›ä¸»é¢˜**ï¼Œå¡å¤«å¡ä¼šåœ¨è¿™äº›ä¸»é¢˜å‘å¸ƒæ—¶å‘ä»–ä»¬å¹¿æ’­ã€‚è¿™æ˜¯ Kafka åˆ¶ä½œçš„æµåª’ä½“åº”ç”¨ç¨‹åºçš„**ååº”æ€§**çš„æ ¸å¿ƒç‰¹å¾ã€‚

å†è¯´ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¾ˆå¹¸è¿ï¼Kafka Python å®¢æˆ·ç«¯å…è®¸æˆ‘ä»¬ç”¨ Python æ„å»ºæ¶ˆè´¹è€…ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Kafka Python çš„æ¶ˆè´¹è€… API](https://github.com/dpkp/kafka-python#kafkaconsumer) ã€‚

ç„¶è€Œï¼Œæ¬ºè¯ˆæ£€æµ‹è€…ä¸ä¼šæ˜¯ä¸€ä¸ªæ™®é€šçš„æ¶ˆè´¹è€…ã€‚æ˜¯ä¸€ä¸ª**æµåº”ç”¨**ã€‚å› æ­¤ï¼Œå®ƒä½¿ç”¨æ¶ˆè´¹è€…æ¥è¯»å–æ¶ˆæ¯ï¼Œç„¶åå¯¹è¿™äº›æ¶ˆæ¯è¿›è¡Œè‡ªå·±çš„å¤„ç†ï¼Œå¹¶å°†æ¶ˆæ¯ç”Ÿæˆå›ä¸¤ä¸ªè¾“å‡ºä¸»é¢˜ä¸­çš„ä¸€ä¸ªã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦**ä¸€ä¸ªæ¶ˆè´¹è€…å’Œä¸€ä¸ªç”Ÿäº§è€…**ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å†™æ¶ˆè´¹è€…éƒ¨åˆ†ã€‚åŒæ ·ï¼Œæˆ‘å°†ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå¹¶æœ€ç»ˆå‘æ‚¨å±•ç¤ºæœ€ç»ˆç»“æœã€‚

è®©æˆ‘ä»¬ä»æŠ“ä½`KafkaConsumer` :
å¼€å§‹

```
# detector/app.py from kafka import KafkaConsumer 
```

Enter fullscreen mode Exit fullscreen mode

è®©æˆ‘ä»¬ä»ç¯å¢ƒå˜é‡ä¸­è·å–ä»£ç† URL å’Œäº‹åŠ¡ä¸»é¢˜:

```
import os
# ... KAFKA_BROKER_URL = os.environ.get('KAFKA_BROKER_URL')
TRANSACTIONS_TOPIC = os.environ.get('TRANSACTIONS_TOPIC') 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬ç°åœ¨å¯ä»¥å®ä¾‹åŒ–æ¶ˆè´¹è€…ã€‚æˆ‘ä»¬çŸ¥é“ transactions ä¸»é¢˜åŒ…å« JSON ç¼–ç çš„å€¼(ç”± transactions generator ç”Ÿæˆ)ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`KafkaConsumer`çš„`value_deserializer`å°†åŸå§‹å­—èŠ‚è‡ªåŠ¨åŠ è½½åˆ° Python dictionnary ä¸­ã€‚è¿™ç±»ä¼¼äºæˆ‘ä»¬ä»¥å‰ç”¨è¿‡çš„`KafkaProducer`çš„`value_serializer`ã€‚

```
import json
# ... consumer = KafkaConsumer(
    TRANSACTIONS_TOPIC,
    bootstrap_servers=KAFKA_BROKER_URL,
    value_deserializer=lambda value: json.loads(value),
) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡è¿­ä»£æ¶ˆè´¹è€…æ¥å¤„ç†æ¶ˆæ¯æµ:

```
for message in consumer:
    transaction: dict = message.value
    # TODO: determine if transaction is suspicious
    # TODO: output transaction in the correct topic (legit or fraud) 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯â€”â€”æˆ‘ä»¬å¦‚ä½•ç¡®å®šä¸€é¡¹äº¤æ˜“æ˜¯å¦æ˜¯æ¬ºè¯ˆï¼Ÿ

æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¸šåŠ¡ç”¨ä¾‹ã€‚

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œ**æ£€æµ‹æ¬ºè¯ˆæ˜¯ä¸€ä¸ªå›°éš¾çš„é—®é¢˜**,å› ä¸ºäº¤æ˜“å¯èƒ½ä»¥å¤šç§æ–¹å¼è¡¨æ˜æ¬ºè¯ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸäººåœ¨ 24 å°æ—¶å†…ä» 50 ä¸ªä¸åŒçš„è´¦æˆ·æ”¶åˆ° 50 ç¬”äº¤æ˜“ï¼Œæ¯ç¬”æ­£å¥½ 1000 æ¬§å…ƒï¼Œè¿™å¯èƒ½æ˜¯å¯ç–‘çš„ã€‚ä½ ç”šè‡³å¯ä»¥è€ƒè™‘æ·»åŠ ä¸€ä¸ªäººå·¥æ™ºèƒ½å±‚æ¥è¿›ä¸€æ­¥æ”¹å–„é¢„æµ‹ã€‚

è™½ç„¶è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†è¿™ç§è§„åˆ™åœ¨å¡å¤«å¡é‚£é‡Œæ¯”æˆ‘ä»¬åœ¨è¿™é‡Œè®¨è®ºçš„æ›´éš¾å®ç°ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ„Ÿå…´è¶£çš„æ˜¯å¡å¤«å¡å¦‚ä½•è¢«ç”¨æ¥**å°†æµå¤„ç†æ–¹æ³•å¸¦å…¥ç”Ÿæ´»**ã€‚

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¿…é¡»ä½œå¼Šä¸€ç‚¹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸ä¸€ä¸ªè™šæ„çš„é“¶è¡Œç³»ç»Ÿæ‰“äº¤é“ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œä¸€æ¬¡æ±‡æ¬¾è¶…è¿‡ 900 æ¬§å…ƒæ˜¯éæ³•çš„ã€‚å› æ­¤ï¼Œä»»ä½•`amount`å¤§äº 900 çš„äº¤æ˜“éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ¬ºè¯ˆã€‚

ä»¥ä¸‹æ˜¯ç¡®å®šäº¤æ˜“æ˜¯å¦å¯ç–‘çš„ç›¸åº”å‡½æ•°:

```
def is_suspicious(transaction: dict) -> bool:
    return transaction['amount'] >= 900 
```

Enter fullscreen mode Exit fullscreen mode

çŒœçŒœçœ‹â€”â€”æˆ‘ä»¬ç°åœ¨æœ‰åŠæ³•å†³å®šå°†äº‹åŠ¡é‡å®šå‘åˆ°å“ªä¸ªä¸»é¢˜äº†ï¼

æˆ‘ä»¬ç°åœ¨å‡†å¤‡å®ç°æ£€æµ‹å™¨çš„ä¸»ä½“ã€‚ä¸ºäº†å°†æ¶ˆæ¯ç”Ÿæˆåˆ°ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`KafkaProducer`ã€‚è®©æˆ‘ä»¬å®ä¾‹åŒ–å®ƒâ€”â€”å°±åƒæˆ‘ä»¬å¯¹äº‹åŠ¡ç”Ÿæˆå™¨æ‰€åšçš„é‚£æ ·ã€‚

```
from kafka import KafkaProducer
# ... producer = KafkaProducer(
    bootstrap_servers=KAFKA_BROKER_URL,
    value_serializer=lambda value: json.dumps(value).encode(),
) 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ©ç”¨`is_suspicious()`å’Œç”Ÿäº§è€…æ¥ç¡®å®šäº‹åŠ¡åº”è¯¥åˆ°è¾¾å“ªä¸ªä¸»é¢˜ï¼Œç„¶åå°†äº‹åŠ¡ç”Ÿæˆåˆ°é‚£ä¸ªä¸»é¢˜:

```
import os
# ... LEGIT_TOPIC = os.environ.get('LEGIT_TOPIC')
FRAUD_TOPIC = os.environ.get('FRAUD_TOPIC')
# ... for message in consumer:
    transaction: dict = message.value
    topic = FRAUD_TOPIC if is_suspicious(transaction) else LEGIT_TOPIC
    producer.send(topic, value=transaction) 
```

Enter fullscreen mode Exit fullscreen mode

å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬æŠŠæ‰€æœ‰çš„éƒ¨ä»¶éƒ½æ’åœ¨ä¸€èµ·äº†ã€‚

åœ¨æˆ‘ä»¬å°è¯•ä¹‹å‰ï¼Œè¿™é‡Œæ˜¯æ¬ºè¯ˆæ£€æµ‹å™¨ :
çš„**æœ€ç»ˆç‰ˆæœ¬**

```
# detector/app.py import os
import json
from kafka import KafkaConsumer, KafkaProducer

KAFKA_BROKER_URL = os.environ.get('KAFKA_BROKER_URL')
TRANSACTIONS_TOPIC = os.environ.get('TRANSACTIONS_TOPIC')
LEGIT_TOPIC = os.environ.get('LEGIT_TOPIC')
FRAUD_TOPIC = os.environ.get('FRAUD_TOPIC')

def is_suspicious(transaction: dict) -> bool:
    """Determine whether a transaction is suspicious."""
    return transaction['amount'] >= 900

if __name__ == '__main__':
    consumer = KafkaConsumer(
        TRANSACTIONS_TOPIC,
        bootstrap_servers=KAFKA_BROKER_URL,
        value_deserializer=lambda value: json.loads(value),
    )
    producer = KafkaProducer(
        bootstrap_servers=KAFKA_BROKER_URL,
        value_serializer=lambda value: json.dumps(value).encode(),
    )
    for message in consumer:
        transaction: dict = message.value
        topic = FRAUD_TOPIC if is_suspicious(transaction) else LEGIT_TOPIC
        producer.send(topic, value=transaction)
        print(topic, transaction)  # DEBUG 
```

Enter fullscreen mode Exit fullscreen mode

ä»¥åŠæˆ‘ä»¬`docker-compose.yml`é…ç½®ä¸­å¯¹åº”çš„æœåŠ¡:

```
# docker-compose.yml
services:
  # ... generator here ...
  detector:
    build: ./detector
    environment:
      KAFKA_BROKER_URL: broker:9092
      TRANSACTIONS_TOPIC: queueing.transactions
      LEGIT_TOPIC: streaming.transactions.legit
      FRAUD_TOPIC: streaming.transactions.fraud 
```

Enter fullscreen mode Exit fullscreen mode

## è¯•ç”¨æ¬ºè¯ˆæ£€æµ‹å™¨

è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹å§ï¼å’Œä»¥å‰ä¸€æ ·ï¼Œè®©æˆ‘ä»¬ä»å¯åŠ¨ Docker Compose å¼€å§‹ï¼Œè¿™ä¸€æ¬¡å°†å¯åŠ¨äº‹åŠ¡ç”Ÿæˆå™¨å’Œæ¬ºè¯ˆæ£€æµ‹å™¨:

```
$ docker-compose up 
```

Enter fullscreen mode Exit fullscreen mode

æ­£å¦‚æˆ‘ä»¬åœ¨æµ‹è¯•ç”Ÿæˆå™¨æ—¶æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨ä¸¤ä¸ª`kafka-console-consumer`æ¥éªŒè¯æ£€æµ‹å™¨æ˜¯å¦æ­£ç¡®åœ°æ¶ˆè´¹ã€å¤„ç†å’Œäº§ç”Ÿäº‹åŠ¡â€”â€”æ¯ä¸ªè¾“å‡ºä¸»é¢˜ä¸€ä¸ªã€‚

ä¸‹é¢æ˜¯è¿™æ ·åšçš„å‘½ä»¤:

```
docker-compose -f docker-compose.kafka.yml exec detector kafka-console-consumer --bootstrap-server localhost:9092 --topic streaming.transactions.legit
docker-compose -f docker-compose.kafka.yml exec detector kafka-console-consumer --bootstrap-server localhost:9092 --topic streaming.transactions.fraud 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬æ¥è€ƒå¯Ÿä¸€ä¸‹è¿™äº›é¢˜ç›®çš„å†…å®¹å§ï¼

*   `streaming.transactions.legit`åŒ…å«åˆæ³•äº¤æ˜“(é‡‘é¢ä½äº 900 æ¬§å…ƒ),å¦‚é¢„æœŸ:

```
...
{"source": "v16xO8Oj7s4u", "target": "QgvC9nMnBQMO", "amount": 231.67, "currency": "EUR"}
{"source": "wqduJdB5focL", "target": "sxKNYdlSQqQl", "amount": 229.57, "currency": "EUR"}
{"source": "VNWKUvsMOOWA", "target": "7wWynSlnuYpP", "amount": 752.4, "currency": "EUR"}
{"source": "bjt8hci7q8Wm", "target": "LobJtJJB3RDt", "amount": 410.42, "currency": "EUR"}
{"source": "E6NpRQcSJ3es", "target": "E9QeU7qfekKB", "amount": 659.23, "currency": "EUR"}
{"source": "IijVKIGtiGrc", "target": "eWVPvLGm8JLi", "amount": 846.07, "currency": "EUR"}
{"source": "yGfZ1Xa6k1r0", "target": "N5RvY7RO5sQF", "amount": 217.46, "currency": "EUR"}
...
^C
Processed a total of 13593 messages 
```

Enter fullscreen mode Exit fullscreen mode

*   `streaming.transactions.fraud`ä¹Ÿä¸å‡ºæ‰€æ–™ï¼ŒåªåŒ…å«å¯ç–‘äº¤æ˜“(é‡‘é¢åœ¨ 900 æ¬§å…ƒä»¥ä¸Š)!

```
...
{"source": "jwRMZyzGAsmG", "target": "i33smnlpnYtd", "amount": 980.05, "currency": "EUR"}
{"source": "WcmydQNdDxya", "target": "ykFPmUSysJuJ", "amount": 914.81, "currency": "EUR"}
{"source": "UuCOtfIqc4oU", "target": "PrD271ASM3mZ", "amount": 911.9, "currency": "EUR"}
{"source": "ZHdwSxcIi1gv", "target": "CNLyxBAHT2lW", "amount": 925.55, "currency": "EUR"}
{"source": "gQUtarjghjWx", "target": "ABKEhcJuYiEo", "amount": 945.14, "currency": "EUR"}
{"source": "NS2HA0HoMQPt", "target": "h989MZ4lcDqg", "amount": 901.25, "currency": "EUR"}
{"source": "0w22LoewVfYW", "target": "bUejK0tbzLT2", "amount": 955.0, "currency": "EUR"}
...
^C
Processed a total of 1519 messages 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æ‚¨æ‰€è§ï¼Œå¤§çº¦ååˆ†ä¹‹ä¸€çš„é‚®ä»¶è¢«æ ‡è®°ä¸ºæ¬ºè¯ˆé‚®ä»¶ã€‚è€ƒè™‘åˆ°äº¤æ˜“èŒƒå›´åœ¨ 0-1000 æ¬§å…ƒä¹‹é—´ï¼Œè§¦å‘ç‚¹ä¸º 900 æ¬§å…ƒï¼Œæˆ‘ä»¬é¢„è®¡ä¸º 10%,å› æ­¤ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆå¥½ï¼

## åé€€ä¸€æ­¥

å°±è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†**ä¸€ä¸ªæœ‰æ•ˆçš„æ¬ºè¯ˆæ£€æµ‹æ¸ é“**:

*   ä¸€ä¸ªæœ¬åœ° Kafka é›†ç¾¤ï¼Œä½œä¸ºä¸€ä¸ªä¸­å¤®æµåª’ä½“å¹³å°ã€‚
*   å‘é›†ç¾¤äº§ç”Ÿäº‹åŠ¡çš„**äº‹åŠ¡ç”Ÿæˆå™¨**ã€‚
*   ä¸€ä¸ª**æ¬ºè¯ˆæ£€æµ‹å™¨**ï¼Œå®ƒå¤„ç†äº¤æ˜“ï¼Œæ£€æµ‹æ½œåœ¨çš„æ¬ºè¯ˆäº¤æ˜“ï¼Œå¹¶åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ä¸»é¢˜ä¸­äº§ç”Ÿç»“æœã€‚

ä½ å¯èƒ½æƒ³çŸ¥é“â€” **ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ**

æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æ”¹è¿›æˆ–æ‰©å±•è¿™ä¸ªç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æƒ³æ³•:

*   å®æ–½æ›´å¥½çš„æ¬ºè¯ˆæ£€æµ‹ç®—æ³•
*   å‘æŸå¤„å‘é€å…³äºæ¬ºè¯ˆäº¤æ˜“çš„è­¦æŠ¥æˆ–æŠ¥å‘Š:ç”µå­é‚®ä»¶ã€é€šçŸ¥ã€Slack bot â€”ä»»ä½•ä¸œè¥¿ï¼

æ‚¨å¯èƒ½ä¹Ÿæƒ³çŸ¥é“â€”â€”é‚£ä¹ˆ**éƒ¨ç½²**å‘¢ï¼Ÿå—¯ï¼Œæˆ‘æ•…æ„è·³è¿‡äº†è¿™ä¸€éƒ¨åˆ†ã€‚è™½ç„¶åœ¨ç”Ÿäº§ä¸­è·å¾—ä¸€ç»„ Kafka åº”ç”¨ç¨‹åºåº”è¯¥ä¸æ‚¨é€šå¸¸çš„å·¥ä½œæµç¨‹æ²¡æœ‰ä»»ä½•ä¸åŒï¼Œä½†å®ƒå¯èƒ½éœ€è¦è‡ªå·±çš„æœ€ä½³å®è·µã€‚å¦ä¸€æ–¹é¢ï¼Œå°† Kafka é›†ç¾¤æŠ•å…¥ç”Ÿäº§æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„è¯é¢˜(åŒå…³è¯­)ã€‚

å°½ç®¡æˆ‘ä»¬å·²ç»å®ç°äº†å»ºç«‹ä¸€ä¸ªæµåª’ä½“ç³»ç»Ÿï¼Œæˆ‘ä»¬ç”šè‡³è¿˜æ²¡æœ‰è§¦åŠåˆ° T2 å¡å¤«å¡ç”Ÿæ€ç³»ç»Ÿçš„çš®æ¯›ã€‚

ä½ ä»¬å½“ä¸­å·²ç»ç†Ÿæ‚‰ Kafka ç”Ÿæ€ç³»ç»Ÿçš„äººå¯èƒ½ä¼šæƒ³:â€œKSQL æ€ä¹ˆæ ·ï¼Ÿâ€ï¼Œâ€œé‚£å¡å¤«å¡æºªæµå‘¢ï¼Ÿâ€ï¼Œâ€œé‚£ä¹ˆæ¨¡å¼æ³¨å†Œä¸­å¿ƒå‘¢ï¼Ÿã€‚å—¯ï¼Œæ˜¯çš„ï¼Œè¿™äº›éƒ½æœ‰ï¼Œæˆ‘ä»¬ä»¥åä¹Ÿè®¸å¯ä»¥ä¸€çª¥ç©¶ç«Ÿã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘æƒ³å‘æ‚¨å±•ç¤ºçš„æ˜¯ Apache Kafka çš„æ ¸å¿ƒéƒ¨åˆ†â€”â€”ä¸»é¢˜ã€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»¥åŠå¦‚ä½•å®‰æ’ä»–ä»¬æ¥æ„å»ºç°å®ä¸–ç•Œçš„æµåª’ä½“åº”ç”¨ç¨‹åºã€‚

## æµå°½ä¸‡ç‰©

å¦‚æœä½ å·²ç»é˜…è¯»å¹¶å’Œæˆ‘ä¸€èµ·å»ºç«‹äº†è¿™ä¸ªæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿï¼Œé‚£ä¹ˆæ­å–œä½ ï¼æ‚¨åˆšåˆšç”¨ Apache Kafka å’Œ Python æ„å»ºäº†**æ‚¨çš„ç¬¬ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„æµåº”ç”¨ç¨‹åºã€‚**

æˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬å–å¾—çš„æˆå°±æ„Ÿåˆ°è‡ªè±ªã€‚æˆ‘ä»¬ç»“åˆäº† Apache Kafkaã€Python å’Œ Docker æ¥è§£å†³ä¸€ä¸ª actuel ä¸šåŠ¡é—®é¢˜ã€‚

è¿™åªæ˜¯ä¸€ä¸ªä»‹ç»æ€§çš„ä¾‹å­ï¼Œä½†æˆ‘å¸Œæœ›ä½ å¼€å§‹æƒ³è±¡**åƒ Apache Kafka è¿™æ ·çš„æµåª’ä½“å¹³å°å¦‚ä½•å®ç°ä¸€ä¸ªå…¨æ–°çš„ç³»ç»Ÿå’Œåº”ç”¨ä¸–ç•Œ**ã€‚åªè¦æƒ³æƒ³ç”¨ REST APIs å’Œè€å¼çš„ HTTP è°ƒç”¨æ¥æ„å»ºè¿™ä¸ªç³»ç»Ÿä¼šæœ‰å¤šéš¾ã€‚æˆ‘çš„çŒœæµ‹æ˜¯:ä¸å¯èƒ½ã€‚

å¦‚æœä½ å¾ˆæƒ³çŸ¥é“æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘æœ‰ä¸ªå¥½æ¶ˆæ¯:æˆ‘ä»¬æ‰åˆšåˆšå¼€å§‹ï¼ğŸ‘Š

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å›åˆ°å¡å¤«å¡çš„æ ¸å¿ƒæ€æƒ³ã€‚æˆ‘ä»¬å°†å°è¯•æ‰§è¡Œ**èŒƒå¼è½¬æ¢**ã€‚é˜¿å¸•å¥‡å¡å¤«å¡éƒ½æ˜¯å…³äº**æµæ•°æ®**ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»åœ¨è¯·æ±‚ä¸­æ€è€ƒè½¬ç§»åˆ°åœ¨äº‹ä»¶ä¸­æ€è€ƒ**ã€‚**

åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥åœ¨ [GitHub](https://github.com/florimondmanca/kafka-fraud-detector) ä¸Šæ‰¾åˆ°å®Œæ•´çš„ä»£ç ï¼Œæ‰€ä»¥è¯·ç»§ç»­ä½¿ç”¨æ¬ºè¯ˆæ£€æµ‹å™¨ï¼Œå¹¶ç»§ç»­å…³æ³¨æ›´å¤šçš„ Kafka èµ„æ–™ï¼ğŸ’»

æ¥ä¸‹æ¥:[çªå‘æ–°é—»:ä¸€åˆ‡éƒ½æ˜¯äº‹ä»¶ï¼(æºªæµã€å¡å¤«å¡å’Œä½ )](https://dev.to/florimondmanca/breaking-news-everything-is-an-event-streams-kafka-and-you-2n9j)

## ä¿æŒè”ç³»ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šæ‰¾åˆ°æˆ‘ï¼Œè·å–æ›´æ–°ã€å…¬å‘Šå’Œæ–°é—»ã€‚ğŸ¤**