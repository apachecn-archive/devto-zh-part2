# Javascript å†…å­˜æ³„æ¼å¹¼å„¿æŒ‡å—

> åŸæ–‡ï¼š<https://dev.to/kepta/a-toddlers-guide-to-memory-leaks-in-javascript-25lf>

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é‡‡ç”¨ä¸€ç§éå¸¸ç®€å•çš„æ–¹æ³•æ¥ç†è§£å†…å­˜æ³„æ¼ï¼Œå¹¶å°è¯•è¯Šæ–­å®ƒä»¬ã€‚

åœ¨å½“ä»Šå†…å­˜ä¸°å¯Œçš„ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘æ‹…å¿ƒå†…å­˜æ³„æ¼ã€‚ä½†æ˜¯æˆ‘ä¸æƒ³å‘Šè¯‰ä½ ï¼Œæˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªçœŸå®çš„ä¸–ç•Œé‡Œï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯å…è´¹çš„ã€‚

### å“å‘€æˆ‘çš„èŠ±å¼å‡½æ•°ç¼–ç¨‹

**æŠ«éœ²:æˆ‘ç»å¯¹çƒ­çˆ±å‡½æ•°å¼ç¼–ç¨‹ã€‚**
å‡½æ•°å¼ç¼–ç¨‹å¾ˆé…·ï¼Œæœ‰äº†æ–°çš„ ES6 è¯­æ³•ï¼Œå®ƒå˜å¾—æ›´é…·äº†ã€‚

```
const arrayAddFirst = (a, b) => [a, ...b]; 
```

Enter fullscreen mode Exit fullscreen mode

ä¸Šé¢è¿™ä¸ªä¾‹å­çœ‹èµ·æ¥è¶…çº§å¥½ã€‚é™¤éä½ å’Œæˆ‘ä¸€èµ·ç¼–ç¨‹ï¼Œè€Œæˆ‘ç›²ç›®åœ°æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªé‡è½½å¾ªç¯ä¸­ğŸ˜ã€‚

```
result = newData.reduce((p,r) => arrayAddFirst(r, p), []); 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä¸å¸Œæœ›ä½ å› ä¸ºä¸Šé¢çš„å‚»é€¼ä»£ç æ¥è¯„åˆ¤æˆ‘ã€‚ **(è™šæ‹Ÿæ‹¥æŠ±å¦‚æœä½ èƒ½çŒœå‡ºå®ƒæ˜¯å¹²ä»€ä¹ˆçš„ğŸ˜)**

```
 for(var i = 0; i < newData.length; i++) {
    for(var j = 0; j < i; i++) {
        // stuff here
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

ä¸Šé¢çš„ä»£ç ç‰‡æ®µæ˜¯æˆ‘ä»¬ç¤ºä¾‹çš„æ—§ç‰ˆæœ¬ã€‚æ³¨æ„ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºå®ƒå°†è¿è¡Œ`n * (n+1) / 2`æ¬¡ï¼Œå…¶ä¸­`n`æ˜¯`newData`çš„é•¿åº¦ã€‚

ç¤ºä¾‹ä»£ç ä¸­çš„ä¸»è¦é—®é¢˜æ˜¯åƒåœ¾æ”¶é›†å™¨å¿…é¡»é¢‘ç¹åœ°ä»‹å…¥ã€‚æ¯æ¬¡åœ¨`.reduce`å¾ªç¯**ä¸­åˆ›å»ºçš„èŠ±å“¨çš„`[a, ...b]`æ•°ç»„éƒ½éœ€è¦ä»å†…å­˜**ä¸­ç§»é™¤ï¼Œå¦åˆ™å®ƒæœ€ç»ˆä¼šè€—å°½æ‰€æœ‰çš„å†…å­˜ã€‚

è¿™ä¸ªä¾‹å­è¯•å›¾é˜æ˜ä¸€ä¸ªé‡è¦çš„äº‹å®:è®°å¿†ä¸æ˜¯ä½ æœ€å¥½çš„æœ‹å‹ã€‚å®ƒåœ¨ 99%çš„æƒ…å†µä¸‹éƒ½å¯¹ä½ æœ‰åˆ©ï¼Œä½†å½“å®ƒå†³å®šåˆºä½ æ—¶ï¼Œå®ƒä¼šç›´æ¥åˆºä½ çš„çœ¼ç›ã€‚

[![stab](img/3cb27bb164c3a99b7e89a2894c7a12e7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--oHgBHPmY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/http://files.explosm.net/comics/Rob/blowdart.jpg)

### å†…å­˜æ³„éœ²â€¦

é€šå¸¸ï¼Œjavascript åº”ç”¨ç¨‹åºä¼šä»¥ä¸¤ç§æ–¹å¼å†»ç»“:

æ— é™å¾ªç¯:ä½ å¯èƒ½ä¸å°å¿ƒå†™äº†ä¸€ä¸ªæ°¸è¿œä¸ä¼šç»ˆæ­¢çš„å¾ªç¯ã€‚

```
var x = 0;
while(x < 5) {
   console.log(x); // Warning! do not try this at home 
} 
```

Enter fullscreen mode Exit fullscreen mode

å†…å­˜ä¸è¶³:æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå ç”¨æ‰€æœ‰çš„å†…å­˜ã€‚

```
var x = [ [1] ];
for(var i = 1; i < 100000; i++) {
    x.push(arrayAddFirst(i, x[i-1])); // Warning! do not try this at home 
} 
```

Enter fullscreen mode Exit fullscreen mode

### å¥½å§ï¼Œä½†æ˜¯å†…å­˜æ³„éœ²æ€ä¹ˆåŠï¼Ÿï¼Ÿ

å½“ç„¶ï¼Œä½ å¯ä»¥é€šè¿‡å°å¿ƒé¿å…è¿™äº›ä¸è‰¯è¡Œä¸ºã€‚ä½†æ˜¯å†…å­˜æ³„æ¼æ˜¯é‚£äº›å®‰é™åœ°åç€çš„ä»¤äººè®¨åŒçš„é­”é¬¼ä¹‹ä¸€ã€‚

è®©æˆ‘ä»¬å®šä¹‰ä¸€å°æ‹¥æœ‰æ— é™èµ„æºçš„è®¡ç®—æœºï¼Œè®©æˆ‘ä»¬ç§°ä¹‹ä¸º`Deep thought`ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ–‡`DT-42`ä¸­å¼•ç”¨`Deep thought`ï¼Œæ‚¨å°†å¾ˆå¿«çœ‹åˆ°æˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨`DT-42`æ¥è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ã€‚

### å†…å­˜æ³„éœ²

ç®€å•æ¥è¯´ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯æ°¸è¿œç­‰å¾…ä½¿ç”¨çš„è¢«é—å¿˜çš„æ•°æ®ã€‚åœ¨æˆ‘ä»¬è·³åˆ°ç§‘å­¦å®šä¹‰ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚

```
 function sayHi() {
    var allNames = [];
    var emoji = 'ğŸ‘‹';
    return name => {
        allNames.push(name);
        return emoji + name;
        }
} 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æˆ‘ä»¬è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±å˜å¾—è¶Šæ¥è¶Šèƒ–ã€‚åƒåœ¾æ”¶é›†å™¨æ— æ³•æ¸…ç†`allNames`ï¼Œå› ä¸ºå‡½æ•°éœ€è¦å®ƒæ¥æ¨é€æ•°æ®ã€‚å®ƒä¸çŸ¥é“æ‰€æœ‰çš„åå­—éƒ½ä¸ä¼šè¢«è¯»å–ï¼Œå› æ­¤åœ¨å†…å­˜ä¸­ç»™å®ƒä»»ä½•ç©ºé—´éƒ½æ˜¯å¾’åŠ³çš„ã€‚

**ç»´åŸºç™¾ç§‘ä¸Šè¯´:**

> **å†…å­˜æ³„æ¼**æ˜¯ä¸€ç§[èµ„æºæ³„æ¼](https://en.wikipedia.org/wiki/Resource_leak)ï¼Œå½“ä¸€ä¸ª[è®¡ç®—æœºç¨‹åº](https://en.wikipedia.org/wiki/Computer_program)é”™è¯¯åœ°ç®¡ç†[å†…å­˜åˆ†é…](https://en.wikipedia.org/wiki/Memory_allocation) [ [1]](https://en.wikipedia.org/wiki/Memory_leak#cite_note-1) ä½¿å¾—ä¸å†éœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾æ—¶å°±ä¼šå‘ç”Ÿã€‚

æˆ‘å‘ç°æŠŠå®ƒçœ‹ä½œä¸€ç§ç—‡çŠ¶ä¼šæ›´å®¹æ˜“ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚ä½ çš„ç¨‹åºæ˜¯ä¸€ä¸ªç—…äººï¼Œä»–å¯¹è®°å¿†çš„çƒ­çˆ±æ— æ­¢å¢ƒåœ°å¢é•¿ã€‚
[![love](img/2767f356ce5c1d2c1cc2a7b6670c513d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7D23QJ9I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://i.pinimg.com/originals/3e/53/d0/3e53d09e86eb0ece8a0351a7f2383f07.gif) 
å¤§å¤šæ•°æ—¶å€™ï¼Œç”µè„‘ **ã€åƒåœ¾æ”¶é›†å™¨ã€‘** è¶³ä»¥å‘ç°å¤§å¤šæ•°ä½ ä¸å†ä½¿ç”¨çš„æ•°æ®ï¼Œå¹¶ä¸ºä½ æ¸…ç†å®ƒä»¬ã€‚ä½†å®ƒå¹¶ä¸å®Œç¾ï¼Œæˆ‘ä»¬è¿˜è¿œæ²¡æœ‰ä¸€ä¸ªæ¯”äººç±»æ›´èªæ˜çš„åƒåœ¾æ”¶é›†å™¨ã€‚ **(å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å†™ä»£ç è€Œä¸æ˜¯æˆ‘ä»¬:P)**

### ç»™æˆ‘ä¸€äº›ç°å®ç”Ÿæ´»ä¸­çš„æ¼æ´

æˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šé‡åˆ°è¿™ç§å¾®ä¸è¶³é“çš„å†…å­˜æ³„æ¼ï¼Œæœ€å¸¸è§çš„æ³„æ¼æ˜¯éšè—åœ¨ä¸€æ®µçœ‹ä¼¼è¿è¡Œè‰¯å¥½çš„ä»£ç  **(çœ‹èµ·æ¥åƒ`arrayAddFirst`**ä¸€æ ·æ— è¾œçš„ä¸œè¥¿)åé¢ã€‚ä¸å…¶æŠ›å‡ºä¸€äº›ç°å®ç”Ÿæ´»ä¸­çš„æ³„æ¼ï¼Œæˆ‘å®æ„¿å‘æ‚¨å±•ç¤ºå¦‚ä½•è¯†åˆ«å†…å­˜æ³„æ¼ã€‚

è®©æˆ‘ä»¬å¯åŠ¨ Chrome æ¥å¸®åŠ©è¯Šæ–­å†…å­˜æ³„æ¼ã€‚

1.  æ‰“å¼€ä¸€ä¸ªç©ºç™½é¡µé¢ã€‚
2.  æ‰“å¼€å¼€å‘é¢æ¿ *(Command+Option+I æˆ– Control+Shift+I)*
3.  å°†æ­¤ç¤ºä¾‹ä»£ç ç²˜è´´åˆ°æ§åˆ¶å°ä¸­ã€‚

```
function sayHi() {
    var allNames = [];
    return name => {
            allNames.push(name);
            return 'ğŸ‘‹ ' + name;
        }
}
var hello = sayHi();
hello('Gandhi'); 
```

Enter fullscreen mode Exit fullscreen mode

å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å¼€å§‹æ³„æ¼å†…å­˜äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ‰“å¼€æˆ‘ä»¬çš„`memory profiler`ã€‚

ä½ åº”è¯¥å¯ä»¥åœ¨å¼€å‘å·¥å…·ä¸­æ‰¾åˆ°è¿™ä¸ªæ ‡ç­¾ã€‚

[![image](img/d828d098381dd0e726f27ec0646b75c0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JtAwqgYU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/6966254/35474233-6264a034-0359-11e8-852a-165687947454.png)

å°±æœ¬æ–‡çš„èŒƒå›´è€Œè¨€ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨`Take Heap Snapshot`ã€‚è¯¥åŠŸèƒ½å¯ä»¥è·å–ç¨‹åºå½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µçš„å¿«ç…§ã€‚

åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

[![image](img/baed4693d14dc923fa553ec757caef46.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--LSUEqYHY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/6966254/35474258-c402b1f0-0359-11e8-8b1d-6a374bc4ea70.png)

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬å°†è¿è¡Œå‡ æ¬¡æ— è¾œçš„å‡½æ•°ã€‚

```
for(var i=0; i<1000000; i++) {
    hello('Gandhi');
} 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæ‚¨æ‹æ‘„å¦ä¸€ä¸ªå¿«ç…§ï¼Œæ‚¨å°†çœ‹åˆ°å†…å­˜ä½¿ç”¨é‡å¢åŠ ã€‚

[![image](img/db5490216dcdc9896fcc2963bf9cd4b1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ay5-iqh5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/6966254/35474314-83a13e00-035a-11e8-815d-835d3b4a0aa2.png)

åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæœ‰ 10 å…†å­—èŠ‚çš„å®Œå…¨**å·®å¼‚ã€‚åœ¨è®¸å¤šå®é™…æƒ…å†µä¸‹ï¼Œå‡ å…†å­—èŠ‚çš„è·³è·ƒå¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½ å¯èƒ½æƒ³è¦åœ¨ä¸€æ®µæ—¶é—´å†…æ‹æ‘„**å¤šä¸ªå¿«ç…§**æ¥æ’é™¤æ³„æ¼ã€‚**

æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»`Summary`ä¸‹æ‹‰èœå•å¹¶åˆ‡æ¢åˆ°`Comparison`æ¥è½»æ¾æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ã€‚

[![image](img/2d59ce940e532c0ca7d9f2b873c0f37a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--vHQQfEeD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://user-images.githubusercontent.com/6966254/35474393-af4e122a-035b-11e8-94cc-6583b4ac01a2.png)

å¦‚æœæ‚¨å°†æ–°å¿«ç…§ä¸ä¹‹å‰æ‹æ‘„çš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å°†`#Delta`è®¾ä¸ºé™åºï¼Œæ‚¨ä¼šå‘ç°`(string)`ä¸­æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°å­—ã€‚è¿™æ˜¯æˆ‘ä»¬çš„å†…å­˜æ³„æ¼çš„åœ°æ–¹ã€‚ç‚¹å‡»å®ƒï¼Œä½ ä¼šçœ‹åˆ°å¾ˆå¤š`Gandhi`

æˆ‘çœŸçš„å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ç†è§£è®°å¿†ã€‚è¿™åªæ˜¯è¯Šæ–­æ³„æ¼çš„å‡ ç§æ–¹æ³•ä¹‹ä¸€ã€‚è¯·æŸ¥çœ‹ä»¥ä¸‹é“¾æ¥ï¼Œäº†è§£æ›´å¤šå…³äºå†…å­˜çš„é«˜çº§çŸ¥è¯†:

*   [å†…å­˜ç®¡ç†](https://blog.sessionstack.com/how-does-javascript-actually-work-part-1-b0bacc073cf)
*   [node . js ä¸­çš„å†…å­˜è†¨èƒ€](https://tech.residebrokerage.com/debugging-node-js-memory-problems-d450787d9253)

å¦‚æœä½ â¤ï¸è¿™ç¯‡æ–‡ç« ï¼Œè¯·åˆ†äº«è¿™ç¯‡æ–‡ç« ä¼ æ’­çš„è¯ã€‚

åœ¨ Twitter ä¸Šè”ç³»æˆ‘ [@kushan2020](https://twitter.com/kushan2020) ã€‚