# Kotlin è§£å†³äº† Java æ³›å‹çš„éš¾é¢˜

> åŸæ–‡:[https://dev . to/rapasoft/pains-of-Java-generics-solved-in-kot Lin-4g4a](https://dev.to/rapasoft/pains-of-java-generics-solved-in-kotlin-4g4a)

## [](#the-problem)é—®é¢˜

> ä¸ºä»€ä¹ˆè¿™åœ¨ Java ä¸­ä¸èƒ½ç¼–è¯‘ï¼Ÿ

```
Optional<Integer> optionalInteger = Optional.of(1);
Optional<Number> optionalNumber = optionalInteger;

int i = optionalNumber.get().intValue(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ Java ä¸­ä½¿ç”¨æ³›å‹æ—¶ï¼Œæˆ‘é€šå¸¸éå¸¸ä¿å®ˆã€‚å½“æˆ‘è¯•å›¾å˜å¾—â€œèªæ˜â€æ—¶ï¼Œæˆ‘é€šå¸¸ä¼šæŠŠäº‹æƒ…æå¾—è¿‡äºå¤æ‚ï¼Œæœ€ç»ˆå¯¼è‡´ä»£ç ä¸­åˆ°å¤„éƒ½æ˜¯æ³¨é‡Šã€‚ç¼–ç¨‹è¯­è¨€åº”è¯¥æ€»æ˜¯æ—¢å®¹æ˜“å†™åˆå®¹æ˜“è¯»ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­è¿›è¡Œé€ å‹å‘¢ï¼Ÿ

æˆ‘å¸Œæœ›ä¸Šè¿°æ–¹æ³•èƒ½å¤Ÿå¥æ•ˆï¼Œå› ä¸º:

*   `Number`æ˜¯ Java ä¸­`Integer`ç±»çš„çˆ¶ç±»
*   `optionalNumber`æ˜¯ç”Ÿäº§`Number`

## Javaâ€œè§£å†³æ–¹æ¡ˆâ€

å¯ä»¥ç”¨`extends` / `super`å…³é”®å­—æŒ‡å®šä¸Šç•Œæ¥è§£å†³ã€‚

```
Optional<? super Integer> optionalInteger = Optional.of(1);
Optional<Number> optionalNumber = (Optional<Number>) optionalInteger;

int i = optionalNumber.get().intValue(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåœ¨ç¬¬äºŒè¡Œå¾—åˆ°`Unchecked cast`è­¦å‘Šï¼Œè¿™*åœ¨ Java æ³›å‹çš„ä¸–ç•Œé‡Œ*æœ‰æ„ä¹‰ï¼Œä½†æ˜¯ä»ç„¶å¾ˆéš¾çœ‹ã€‚å¦å¤–ï¼Œå½“ä½¿ç”¨`<? super Integer>`æ—¶ï¼Œå®ƒå¯¹è¯»è€…è¯´äº†ä»€ä¹ˆï¼Ÿ

## [](#the-kotlin-solution)ç§‘ç‰¹æ—è§£

Kotlin å·²ç»ç”¨ [**å£°æ˜è§£å†³äº†è¿™ä¸ªé—®é¢˜â€”â€”ä½¿ç”¨å…³é”®å­—`in` / `out`çš„ç«™ç‚¹å·®å¼‚**ã€‚å¯¹äºè¿™ä¸ªä¾‹å­:
ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`get()`å‡½æ•°æ¨¡æ‹Ÿ`Optional`ç±»(å› ä¸º Kotlin ä¸­æ²¡æœ‰)](https://kotlinlang.org/docs/reference/generics.html#declaration-site-variance)

```
class Optional<out T>(val t: T) {
    fun get(): T = t
}

val optionalInteger = Optional(1)
val optionalNumber: Optional<Number> = optionalInteger

val i = optionalNumber.get().toInt() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡ç”¨å…³é”®å­—`out`æ³¨é‡Š`T`å‚æ•°ï¼Œæˆ‘ä»¬å°†æŒ‡å®š`T`å°†æ€»æ˜¯è¢«ç”¨ä½œè¾“å‡ºå€¼(ä¾‹å¦‚ï¼Œäº§ç”Ÿçš„)ï¼Œå› æ­¤æ‰§è¡Œä¸Šè¿°è½¬æ¢æ˜¯å®‰å…¨çš„(å› ä¸ºäº§ç”Ÿçš„å€¼å¯ä»¥å®‰å…¨è½¬æ¢)ã€‚åŒæ ·ï¼Œå¦‚æœä½ å°è¯•æ·»åŠ æˆå‘˜å‡½æ•°`fun set(t: T)`ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘å™¨è­¦å‘Šï¼Œå³`T`æ˜¯`out`å‚æ•°ï¼Œä½†å‡ºç°åœ¨`in`ä½ç½®ã€‚å®ƒæ˜“äºä¹¦å†™ã€é˜…è¯»å’Œç†è§£ã€‚

æ­£å¦‚æˆ‘æåˆ°çš„ï¼ŒKotlin æ²¡æœ‰å•ç‹¬çš„`Optional`ç±»ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæœ‰ä¸€äº›å¾ˆé…·çš„è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ä»»ä½•å…¶ä»–ç°ä»£è¯­è¨€ä¸­æ‰¾åˆ°è¿™äº›ç‰¹æ€§:

```
haveReadArticle?.giveItAâ¤ï¸() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ğŸ˜