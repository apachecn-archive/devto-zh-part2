# 保护性能(第四部分)

> 原文:[https://dev.to/joshua/protecting-performance-part-4-2acp](https://dev.to/joshua/protecting-performance-part-4-2acp)

性能对于您的用户、您的业务乃至整个世界都非常重要。我们需要挑选能够反映真实用户体验的好指标——有很多指标可供选择。

因此，现在我们已经选择了我们有意义的指标，和一个工具来衡量它。

现在怎么办？

也许你在想，现在我们实际上需要修正性能。这无疑是真的！不过我们不会在这篇博客中讨论这个问题——有很多专门的资源告诉你应该改进什么。Chrome 开发工具中的审计面板是一个很好的开始资源。

一个自然的后续问题可能是，修复这些性能问题需要多长时间？

这是*而不是*应该问的正确问题。我们是长期的——绩效是我们需要进行的文化变革，而不是我们可以做一次的一次性努力。

# [](#the-planning-phase)计划阶段

通常，当某个功能请求以某种形式出现时，就会发生性能倒退——请求了一个会降低性能的功能，但要逆转已经太晚了。在这一点上，改变事情已经太晚了——我们需要一种比这更早影响规划的方法，我们需要一种结构化的方法来确保这种关于绩效的对话在规划阶段更早发生。

# [](#performance-budgets)绩效预算

[![Piggy bank](../Images/ba8110c057e0fe924195b90b1cdc2404.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--JBzQHhvp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qtnjhz8edklff2hj063o.jpg)

[绩效预算](https://speedcurve.com/blog/performance-budgets-in-action/)是以结构化的方式进行这种对话的好方法。关键步骤是:

## [](#1-choose-the-right-metrics)1。选择正确的指标

在上一部分中，我们讨论了选择正确的指标——这样做很重要，这样我们就可以专注于有意义的指标进行改进。

## [](#2-get-everyone-to-agree-on-a-limit)2。让每个人都同意一个限制

无论是谁做计划决策，都需要同意您为预算选择的指标(和限制)是一个好目标。

## [](#3-bring-it-up-during-planning)3。在计划时提出来

当工程参与规划决策时，这个目标需要牢记在心并进行讨论。当谈论的事情会影响绩效预算时，需要提出来。

## [](#4-figure-out-how-to-stay-in-budget)4。想办法不超出预算

在这个规划阶段，可以寻求妥协。可能是特性本身可以被改变以获得更好的性能，或者可能是可以进行一些其他的性能改进以保持总体预算。

## [](#choosing-a-limit)选择一个极限

[![A picture of a speed limit sign](../Images/b82db2fda376186464258dcd4c25c159.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--RCMyByyF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kcpk1xtssgrn8iaikqc3.png)

为限制选择一个精确的数字是困难的，但是要记住以下几点:

0.1 秒-任务被认为是**“即时”**，因为用户感觉不到延迟(例如第一次输入延迟的良好目标)
1.0 秒- **思维流**贯穿整个任务(后续响应时间的良好目标)
10 秒- **任务切换**在此之后发生(在任何指标上绝对不要超过此目标)

要问的其他问题可能是:

> 目前是什么状态？

或者

> 你的竞争对手在做什么？

这些问题中的任何一个都可以产生一个应该很容易同意的限制——如果你的竞争对手正在击败你，一个明智的目标可能是击败你的竞争对手！

[performancebudget.io](//performancebudget.io) 是一个根据页面加载时间选择包大小指标的有用工具——但请记住，从上一篇文章来看，如果发生缓存或代码分割，包的总大小可能与实际用户体验不相关。衡量真实的用户体验也很重要，根据类似的指标来选择预算也很好。

# [](#apdex)Apdex

[![Apdex logo](../Images/510686fff5c2276686d6389b578a9d9b.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--6L5FQsm1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/7l5kexqiuxhl7bbqirln.jpg)

Apdex 是另一个有用的“元指标”,可用于保护您的绩效并对其进行高水平的衡量。

然而，在有意义的度量的上下文中，在 Apdex 的使用中有两件事我要提出警告。

## 小心挑选你的 t 值

Apdex 通过选择一个“t”值来工作，该值代表用户认为“可容忍”的页面负载。任何小于 t 的都被认为是“满意的”，任何小于`t*4`的都被认为是“可容忍的”

选择任何大于 1s 的 t 值都会导致误导性的度量。考虑一个 t 值`t=2`。少于 8 秒的页面加载将被认为是“可容忍的”，这非常接近用户切换任务之前的限制。在很多用例中，在 8 秒内加载页面的用户可能会不满意，在这种情况下，Apdex 指标不能很好地反映这一点。

## [](#pick-your-load-metric-carefully)仔细挑选您的“负载”指标

Apdex 还需要一个“加载时间”本身的概念。如果您插入一个不正确的加载时间(也许您会使用 DOMContentLoaded 而不是 Time to interactive)，那么您的 Apdex 也将是不正确的。

考虑到这一点，Apdex 可以成为保护性能的有用工具。它可用于将指标标准化为一个简单的数字，这可能有助于聚合 Apdexes。然而，如果没有共同的 t 值，就很难比较不同的 Apdex 数，也很难将它们的值联系起来。以秒计算的预算或目标更容易联系和比较。

* * *

在这个博客系列的过程中，我们已经学会了测量*真实的*用户体验，并选择正确的度量标准。快速检查您选择的指标是否在有意义的状态下被触发。

最终，对我来说，美元并不鼓舞人心——但让互联网更好地为每个人服务，让世界能够公开交换信息，是一个鼓舞人心的目标。有意义的度量是实现这一目标的重要一步。让我们让互联网对每个人都更好！✨