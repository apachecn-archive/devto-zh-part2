# é«˜é˜¶ç»„ä»¶(HOC)ååº”æ¨¡å¼

> åŸæ–‡:[https://dev . to/superkarolis/higher-order-components-hoc-react-pattern-5ejp](https://dev.to/superkarolis/higher-order-components-hoc-react-pattern-5ejp)

ä»Šå¤©æˆ‘å†³å®šæ›´ç†Ÿæ‚‰ä¸€äº›åº“ä¸­å¸¸ç”¨çš„é«˜é˜¶ç»„ä»¶(HOC)ï¼Œæ¯”å¦‚ Redux ( `connect`)ã€react-i18next ( `translate`)æˆ– react-router ( `withRouter`)ã€‚æˆ‘ç»å¸¸å°†å®ƒä»¬ä½œä¸ºä¸Šè¿°åº“çš„ä¸€éƒ¨åˆ†ä½¿ç”¨ï¼Œä½†ä»æœªå®Œå…¨æŒæ¡å®ƒä»¬çš„é­”åŠ›ã€‚ä»Šå¤©æ˜¯åˆ°åœ°æ¯¯ä¸‹é¢çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•çœŸæ­£å·¥ä½œçš„æ—¥å­ã€‚

ä½†åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸‹ä»€ä¹ˆæ˜¯é«˜é˜¶åˆ†é‡ã€‚æ ¹æ® [React docs](https://reactjs.org/docs/higher-order-components.html) çš„è¯´æ³•ï¼Œé«˜é˜¶ç»„ä»¶æ˜¯ä¸€ç§é«˜çº§ React æ¨¡å¼ï¼Œç”±ä¸€ä¸ªå‡½æ•°ç»„æˆï¼Œè¯¥å‡½æ•°å°†ä¸€ä¸ªåŸºæœ¬(åŒ…è£…)ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ã€å¢å¼ºçš„ç»„ä»¶ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯å…è®¸ä»¥ä¸€ç§å¹²å‡€çš„ç»„åˆæ–¹å¼é‡ç”¨ç»„ä»¶é€»è¾‘ã€‚

HOC çš„æŠ½è±¡ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹åƒè¿™æ ·:

```
const higherOrderComponent = BaseComponent => {
    // ...
    // create new component from old one and update
    // ...

    return EnhancedComponent
} 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨æ›´å…·ä½“çš„å½¢å¼ä¸­ï¼Œé«˜é˜¶åˆ†é‡æ€»æ˜¯é‡‡ç”¨ç±»ä¼¼äºä¸‹é¢çš„å½¢å¼:

```
import React from 'react';

const higherOrderComponent = BaseComponent => {
    class HOC extends React.Component {
        ...
        enhancements
        ...

        render() {
            return <BaseComponent newProp={newPropValue} {...this.props} />;
        }
    }

    return HOC;
}; 
```

Enter fullscreen mode Exit fullscreen mode

## ç®€å•ä¾‹å­

ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé«˜é˜¶å…ƒä»¶çš„ç®€å•ä¾‹å­ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰å‡ ä¸ªç»„ä»¶ï¼Œæ¯æ¬¡ç»„ä»¶è¢«æ¸²æŸ“æ—¶éƒ½è®¾ç½®éšæœºèƒŒæ™¯å€¼ã€‚

æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªåä¸º`withColor`çš„é«˜é˜¶åˆ†é‡å‡½æ•°ã€‚å®ƒæ¥å—`BaseComponent`ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›å¢å¼ºçš„ç»„ä»¶ã€‚`EnhancedComponent`ç”±ä¸€ä¸ª`getRandomColor`å’Œ`render`æ–¹æ³•ç»„æˆã€‚åœ¨`render`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¿”å›è¢«åˆ†é…äº†ä¸€ä¸ªæ–°çš„`color`é“å…·çš„`BaseComponent`ï¼Œå¹¶ä¸”é€šè¿‡åˆ©ç”¨`{...this.props}`çš„åˆ†è§£ï¼Œ`BaseComponent`è¿˜å¯ä»¥è®¿é—®ä» HOC å¤–éƒ¨ä¼ é€’ç»™`BaseComponent`çš„æ‰€æœ‰é“å…·ã€‚

```
import React from 'react';

const withColor = BaseComponent => {
  class EnhancedComponent extends React.Component {
    getRandomColor() {
      var letters = '0123456789ABCDEF';
      var color = '#';

      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }

      return color;
    }

    render() {
      return <BaseComponent color={this.getRandomColor()} {...this.props} />;
    }
  }

  return EnhancedComponent;
};

export default withColor; 
```

Enter fullscreen mode Exit fullscreen mode

è¦ä½¿ç”¨æ–°åˆ›å»ºçš„ HOCï¼Œæˆ‘ä»¬åªéœ€å¯¼å‡ºå®ƒï¼Œå¹¶å°†æˆ‘ä»¬çš„åŸºæœ¬ç»„ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

```
import React from 'react';
import withColor from './withColor';

const ColoredComponent = props => {
  return <div style={{ background: props.color }}>{props.color}</div>; };

export default withColor(ColoredComponent); 
```

Enter fullscreen mode Exit fullscreen mode

æœ€åï¼Œæˆ‘ä»¬ä»¥ä¸å‘ˆç°å¸¸è§„ç»„ä»¶ç›¸åŒçš„æ–¹å¼å‘ˆç°æ–°çš„å¢å¼ºç»„ä»¶ã€‚

```
import React, { Component } from 'react';
import ColoredComponent from './ColoredComponent';

class App extends Component {
  render() {
    return (
      <div>
        <ColoredComponent someProp="Prop 1" />
        <ColoredComponent someProp="Prop 2" />
        <ColoredComponent someProp="Prop 3" />
      </div>
    );
  }
}

export default App; 
```

Enter fullscreen mode Exit fullscreen mode

è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸€çº§å®šä¹‰çš„æ‰€æœ‰å±æ€§(å¦‚`someProp`)å°†é€šè¿‡`{...this.props}`è¿›ä¸€æ­¥å‘ä¸‹ä¼ é€’ï¼Œè€Œä¸Šé¢ç¤ºä¾‹ä¸­çš„æ–°å±æ€§(å¦‚`color`)æ˜¯åœ¨ç‰¹è®¾ä¸­æ˜ç¡®å®šä¹‰çš„ã€‚

## å®é™…ä¾‹å­

å‰é¢çš„ä¾‹å­æœ‰ç‚¹åšä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç”Ÿæˆéšæœºé¢œè‰²çš„æ•ˆç”¨å‡½æ•°ï¼Œç„¶ååœ¨æ¯ä¸ªç»„ä»¶ä¸­è°ƒç”¨å®ƒã€‚ä½¿ç”¨æ›´å°‘çš„ä»£ç ï¼Œæœ€ç»ˆç»“æœå°†æ˜¯ç›¸åŒçš„ã€‚è®©æˆ‘ä»¬æ›´å¥½åœ°çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…¶ä¸­é«˜é˜¶ç»„ä»¶æ¨¡å¼ç¡®å®æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å‘ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒæ¥å—`BaseComponent`å’Œ API URL æ¥è·å–å®ƒéœ€è¦çš„æ•°æ®ã€‚å½“æ•°æ®è¢«åŠ è½½æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºä¸€ä¸ªåŠ è½½çŠ¶æ€ï¼Œä¸€æ—¦æ•°æ®è¢«åŠ è½½ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºä»»ä½•åŸºäºæ•°æ®çš„`BaseComponent`æ¸²æŸ“ã€‚æœ€ç»ˆç»“æœå°†å¦‚ä¸‹æ‰€ç¤ºã€‚

[![HOC example](../Images/d992330e38790beb3550302055b919e7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5CAapSJ2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://www.karolisram.com/content/images/2018/07/loading_gif.gif)

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶å‡½æ•°ã€‚æˆ‘ä»¬ç§°å®ƒä¸º`withLoader`,å¹¶ä¸”æœ€åˆå°†ç»„ä»¶çŠ¶æ€çš„`data`å±æ€§è®¾ç½®ä¸º`null`ã€‚ä¸€æ—¦ç»„ä»¶å·²ç»å®‰è£…ï¼Œæˆ‘ä»¬å°†å¼€å§‹è·å–æ•°æ®ï¼Œå½“å®Œæˆåï¼Œå°†`data`å±æ€§è®¾ç½®ä¸ºè¿”å›çš„å“åº”ã€‚

å¦‚å‰æ‰€è¿°ï¼Œå½“çŠ¶æ€ä¸º`null`æ—¶ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºåŠ è½½çŠ¶æ€ã€‚ä¸€æ—¦æˆ‘ä»¬è·å–äº†æ•°æ®ï¼Œæˆ‘ä»¬å°†è¿”å›`BaseComponent`,ä½œä¸ºå›æŠ¥ï¼Œå®ƒå°†åŸºäºè¿”å›çš„æ•°æ®å‘ˆç°æ ‡è®°ã€‚é«˜é˜¶åˆ†é‡å‡½æ•°çœ‹èµ·æ¥å¦‚ä¸‹:

```
import React from 'react';

const withLoader = (BaseComponent, apiUrl) => {
  class EnhancedComponent extends React.Component {
    state = {
      data: null,
    };

    componentDidMount() {
      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          this.setState({ data });
        });
    }

    render() {
      if (!this.state.data) {
        return <div>Loading ...</div>;
      }

      return <BaseComponent data={this.state.data} {...this.props} />;
    }
  }

  return EnhancedComponent;
};

export default withLoader; 
```

Enter fullscreen mode Exit fullscreen mode

ä½¿ç”¨è¿™ä¸ªç‰¹è®¾çš„ç»„ä»¶ç›¸å½“ç®€å•ã€‚æˆ‘ä»¬åªéœ€ä»`props`è·å–æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨å®ƒã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°æ®æ¥æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ã€‚

åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¼å…¥é«˜é˜¶ç»„ä»¶å‡½æ•°ï¼Œå¹¶å°†ç»„ä»¶ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼ é€’ä»ä¸­è·å–æ•°æ®çš„ API URLã€‚å‚è§ä¸‹é¢çš„åŸºæœ¬ç»„ä»¶ä»£ç :

```
import React from 'react';
import withLoader from './withLoader';

const Users = props => {
  return (
    <div>
      <h1>Users:</h1>
      <ul>{props.data.map(user => <li key={user.id}>{user.name}</li>)}</ul>
    </div>
  );
};

export default withLoader(Users, 'https://jsonplaceholder.typicode.com/users'); 
```

Enter fullscreen mode Exit fullscreen mode

ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦ä¸€ä¸ªç»„ä»¶æ¥æ˜¾ç¤ºå¸–å­åˆ—è¡¨ã€‚é™¤äº†ç»„ä»¶åå’Œ API URL ä¹‹å¤–ï¼Œä»£ç åŸºæœ¬ç›¸åŒã€‚

```
import React from 'react';
import withLoader from './withLoader';

const Posts = props => {
  return (
    <div>
      <h1>Posts:</h1>
      <ul>{props.data.map(post => <li key={post.title}>{post.title}</li>)}</ul>
    </div>
  );
};

export default withLoader(Posts, 'https://jsonplaceholder.typicode.com/posts/'); 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨å‰©ä¸‹çš„å°±æ˜¯æ¸²æŸ“ç»„ä»¶äº†ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»»ä½•ç‰¹åˆ«çš„äº‹æƒ…ã€‚åªéœ€åƒå¾€å¸¸ä¸€æ ·å¯¼å…¥ç»„ä»¶å¹¶åœ¨éœ€è¦çš„åœ°æ–¹æ¸²æŸ“å®ƒä»¬ã€‚å°±è¿™æ ·ğŸ˜ƒ

```
import React, { Component } from 'react';
import Users from './Users';
import Posts from './Posts';

class App extends Component {
  render() {
    return (
      <div>
        <Users />
        <Posts />
      </div>
    );
  }
}

export default App; 
```

Enter fullscreen mode Exit fullscreen mode

## ç‰¹è®¾è¯´æ˜ğŸ¤”

*   HOC åº”è¯¥æ€»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚è¿™æ„å‘³ç€ç›¸åŒçš„å¢å¼ºç»„ä»¶åº”è¯¥æ€»æ˜¯ä¸ä½œä¸ºå‚æ•°ä¼ é€’çš„ç›¸åŒçš„åŸºæœ¬ç»„ä»¶ä¸€èµ·è¿”å›ã€‚
*   ä¸è¦åœ¨ render æ–¹æ³•ä¸­ä½¿ç”¨ hocã€‚è¿™ä½¿å¾— React çš„åè°ƒç®—æ³•è®¤ä¸ºåœ¨æ¯ä¸ªæ¸²æŸ“ä¸­é‡æ–°å£°æ˜äº†ä¸€ä¸ªæ–°ç»„ä»¶ï¼Œå¯¼è‡´æ•´ä¸ªå­æ ‘è¢«å¸è½½ï¼Œè€Œä¸ä»…ä»…æ˜¯æ£€æŸ¥å·®å¼‚ã€‚
*   é™æ€æ–¹æ³•ä¸ä¼šè¢«éšå¼å¤åˆ¶ã€‚è¿™éœ€è¦æ˜ç¡®åœ°å®Œæˆã€‚ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨`hoist-non-react-statics`åŒ…ã€‚
*   è£åˆ¤ä¸ä¼šè¢«æ”¾è¡Œã€‚

## æ€»ç»“ğŸ”¥ğŸ”¥ğŸ”¥

é«˜é˜¶ç»„ä»¶å¯ä»¥è®¿é—®æ‰€æœ‰é»˜è®¤çš„ React APIï¼ŒåŒ…æ‹¬çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™å…è®¸ä»¥ä¸€ç§éå¸¸æœ‰æ„è¯†çš„æ–¹å¼é‡ç”¨é€»è¾‘ï¼Œå¹¶ä½¿æ‚¨çš„ä»£ç æ›´åŠ ä¼˜é›…ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå®ƒå¯ä»¥ç”¨äºå„ç§ç”¨ä¾‹ï¼Œä½†æœ‰æ—¶å®ƒä¸æ˜¯æœ€æ˜æ™ºçš„è§£å†³æ–¹æ¡ˆã€‚æœ‰æ—¶ï¼Œä¸€ä¸ªç®€å•çš„å®ç”¨å‡½æ•°æˆ–ä¸€ä¸ªæ™ºèƒ½çˆ¶ç»„ä»¶å°±è¶³å¤Ÿäº†ã€‚å› æ­¤ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„æœ€ä½³åˆ¤æ–­ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œä¸è¦åœ¨ä¸éœ€è¦çš„åœ°æ–¹è¿‡åº¦è®¾è®¡ğŸ˜Š