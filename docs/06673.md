# ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶å¯¹è§†å›¾åˆ‡æ¢åšå‡ºååº”

> åŽŸæ–‡:[https://dev . to/stevebrownlee/react-view-switching-with-custom-events-270j](https://dev.to/stevebrownlee/react-view-switching-with-custom-events-270j)

*æœ€åˆå‘è¡¨äºŽ[stevebrownlee.com](https://stevebrownlee.com/react-view-switching-custom-events/)ã€‚*

åœ¨æˆ‘ä¸Žçº³ä»€ç»´å°”ç¤¾åŒºçš„äººè®¨è®ºæ—¶ï¼Œæˆ‘å‘çŽ°å¤§å¤šæ•°å›¢é˜Ÿéƒ½ä½¿ç”¨æŸç§å½¢å¼çš„è·¯ç”±åŒ…æ¥ç›‘å¬ URL çš„å˜åŒ–ä»¥è§¦å‘è§†å›¾å‘ˆçŽ°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å‘å­¦ç”Ÿå±•ç¤ºå¦‚ä½•ä½¿ç”¨ [react-router-dom](https://www.npmjs.com/package/react-router-dom) åŒ…è¿›è¡Œè§†å›¾åˆ‡æ¢ã€‚

æœ‰äº›ä¸ä½¿ç”¨ URL è·¯ç”±ã€‚ä¸æ˜¯æ¯ä¸ªé¡µé¢åº”ç”¨ç¨‹åºéƒ½éœ€è¦å®ƒã€‚

è™½ç„¶æˆ‘ä¸€ç›´åœ¨çŽ© Reactï¼Œæ…¢æ…¢åœ°ä¸ºçº³ä»€ç»´å°”è½¯ä»¶å­¦æ ¡çš„å­¦ç”Ÿå»ºç«‹é€‚å½“çš„æ•™å­¦æŠ€æœ¯ï¼Œä½†æˆ‘å·²ç»å°è¯•äº†å‡ ç§ä¸åŒçš„è§†å›¾åˆ‡æ¢æœºåˆ¶ã€‚æ˜¨æ™šï¼Œå½“æˆ‘åœ¨å¦ä¸€ä¸ª JavaScript é¡¹ç›®ä¸­ä½¿ç”¨`CustomEvent()`æž„é€ å‡½æ•°æ—¶ï¼Œä¸€ä¸ªðŸ’¡èµ°ç«äº†ã€‚

ä¸Žå…¶åœ¨ **Matriarch** ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•°(è¿™æ˜¯æˆ‘åœ¨æ¯ä¸ªç»´æŠ¤åº”ç”¨ç¨‹åºçŠ¶æ€çš„åº”ç”¨ç¨‹åºä¸­å¯¹ç»„ä»¶çš„ç§°å‘¼),å®ƒçš„å¼•ç”¨è¢«ä¼ é€’ï¼Œä¸ºä»€ä¹ˆä¸åªæ˜¯ç›‘å¬ä¸€ä¸ªäº‹ä»¶å‘¢ï¼Ÿç„¶åŽï¼Œä»»ä½•éœ€è¦åŸºäºŽç”¨æˆ·æ‰‹åŠ¿æˆ–å…¶ä»–äº‹ä»¶åˆ‡æ¢è§†å›¾çš„ç»„ä»¶éƒ½å¯ä»¥ç®€å•åœ°åˆ†æ´¾ä¸€ä¸ªå¸¦æœ‰æ•°æ®æœ‰æ•ˆè´Ÿè½½çš„äº‹ä»¶ã€‚æœ‰æ•ˆè´Ÿè½½æ˜¯å¯é€‰çš„ï¼ŒåŒ…å«ä¸‹ä¸€ä¸ªè§†å›¾å®Œæˆå·¥ä½œå¯èƒ½éœ€è¦çš„ä»»ä½•æ•°æ®ã€‚

## è§†å›¾ç®¡ç†å™¨

æˆ‘åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œå®ƒçš„[èŒè´£](https://code.tutsplus.com/tutorials/solid-part-1-the-single-responsibility-principle--net-36074)æ˜¯åŒé‡çš„â€”â€”åœ¨ DOM å…ƒç´ ä¸Šè®¾ç½®ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶æä¾›è°ƒåº¦è‡ªå®šä¹‰äº‹ä»¶çš„èƒ½åŠ›ã€‚

> src/modules/ViewManager.js

```
const ViewManager = Object.create(null, {
    init: {
        value: function (selector, eventName, fn) {
            this.eventName = eventName
            this.element = document.querySelector(selector)
            this.element.addEventListener(this.eventName, fn)
        }
    },
    broadcast: {
        value: function (view, payload) {
            this.element.dispatchEvent(
                new CustomEvent(this.eventName, {
                    detail: {
                        view: view,
                        payload: payload
                    }
                })
            )
        }
    }
})

export default ViewManager 
```

Enter fullscreen mode Exit fullscreen mode

## ä¸»è¦åº”ç”¨

åœ¨ React ä¸­ï¼Œä½¿ç”¨`create-react-app`æ—¶ä¸»ç»„ä»¶é»˜è®¤ä¸º`App.js`ã€‚ä½ çš„ä¸»è¦æˆåˆ†å¯èƒ½æ˜¯åˆ«çš„ã€‚

åœ¨æž„é€ å‡½æ•°ä¸­ï¼Œè§†å›¾ç®¡ç†å™¨ç”±ä¸‰éƒ¨åˆ†åˆå§‹åŒ–:

1.  å°†é™„åŠ äº‹ä»¶ä¾¦å¬å™¨çš„ DOM å…ƒç´ ã€‚
2.  å°†è¦å¹¿æ’­çš„è‡ªå®šä¹‰äº‹ä»¶çš„åç§°ã€‚
3.  å¤„ç†äº‹ä»¶çš„æœ¬åœ°å‡½æ•°å¼•ç”¨ã€‚

> src/App.js

```
import React, { Component } from "react"
import ViewManager from "./modules/ViewManager"

class App extends Component {
    constructor(props) {
        super(props)

        // Initialize ViewManager for switching main view
        ViewManager.init("#root", "changeView", this.switch)
    }

    switch = event => {
        const _viewProps = Object.assign({
            notifications: notes,
            exampleAdditionalInfo: localStorage.getItem("preferences")
        }, event.detail.payload)

        // Update state to trigger the view change
        this.setState({
            currentView: event.detail.view,
            viewProps: _viewProps
        })
    }

    ...

    // Returns a component to be rendered in the JSX below
    ShowView = () => {
        switch (this.state.currentView) {
            case "profile":
                return <Profile {...this.state.viewProps} />
            case "results":
                return <SearchResults {...this.state.viewProps} />
            case "home":
            default:
                return <Home {...this.state.viewProps} />
        }
    }

    render() {
        return (
            <React.Fragment>
                <NavBar {...this.state.viewProps} />

                {this.ShowView()}
            </React.Fragment>
        )
    }
} 
```

Enter fullscreen mode Exit fullscreen mode

## ä»»ä½•ç»„ä»¶

ä»»ä½•ç»„ä»¶çŽ°åœ¨éƒ½å¯ä»¥å¯¼å…¥ **`ViewManager`** ï¼Œå¹¶ä½¿ç”¨`broadcast()`æ–¹æ³•æ¥è§¦å‘è§†å›¾æ›´æ”¹ã€‚åœ¨è¿™ä¸ªç²¾ç®€çš„ç»„ä»¶ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ª*è§†å›¾æ¦‚è¦æ–‡ä»¶*è¶…é“¾æŽ¥æ—¶ï¼Œä¸€ä¸ªå®šåˆ¶äº‹ä»¶è¢«è°ƒåº¦ï¼Œå¹¶ä¸” **`App`** ç»„ä»¶çš„ç›‘å¬å™¨è§¦å‘å¹¶åˆ‡æ¢è§†å›¾ã€‚

> src/search/SearchResults.js

```
import React, { Component } from "react"
import ViewManager from "../modules/ViewManager"

export default (props) => (
    <div className="searchResults">
        props.foundItems.users.map(user =>
            <a href="#" 
                className="btn btn-outline-success"
                onClick={() => {
                    // Switch to profile view with a data payload
                    ViewManager.broadcast("profile", {userId: user.id})
                }}
                >View profile</a>
        )
    </div>
) 
```

Enter fullscreen mode Exit fullscreen mode