# ç®€ä»‹:æµ“ç¼©å’–å•¡æµ‹è¯•

> åŸæ–‡:[https://dev.to/apium_hub/introduction-espresso-testing-2b4b](https://dev.to/apium_hub/introduction-espresso-testing-2b4b)

ä½œä¸ºç§»åŠ¨å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åˆ›å»ºæ–°çš„å±å¹•æˆ–è€…æ”¹å˜å·²ç»å­˜åœ¨çš„å±å¹•ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»£ç æ˜¯å¦æœ‰æ•ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å·¥å…·æ¥éªŒè¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç»§ç»­æŒ‰é¢„æœŸå·¥ä½œï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å¼€å‘ç¬¦åˆç”¨æˆ·æ•…äº‹æ‰€æœŸæœ›çš„äº§å“è´¨é‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæµ“ç¼©å’–å•¡æµ‹è¯•ã€‚

ç¡®ä¿:

*   å½“ UI è¢«åŠ è½½æ—¶ï¼Œæˆ‘ä»¬å‘ç”¨æˆ·æ˜¾ç¤ºæ­£ç¡®çš„ä¿¡æ¯
*   å½“ç”¨æˆ·æ‰§è¡Œæ“ä½œæ—¶ï¼Œæ˜¾ç¤ºæ‰€éœ€çš„æ¶ˆæ¯æˆ–å±å¹•

ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œæœ‰å‡ ç§ç±»å‹çš„ ui æµ‹è¯•:

*   ç»å…¸ ui æµ‹è¯•->å…³æ³¨è§†å›¾åŠå…¶äº¤äº’ã€‚
*   å¿«ç…§æµ‹è¯•->ä¿è¯å®Œç¾çš„è®¾è®¡ï¼ŒæŠŠäº¤äº’æ”¾åœ¨ä¸€è¾¹ã€‚

## ä»€ä¹ˆæ˜¯ Espresso æµ‹è¯•ï¼Ÿå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

Espresso æ˜¯ Google ä¸º Android åˆ›å»ºçš„ä¸€ä¸ªæ¡†æ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç”¨æˆ·ç•Œé¢ä¸Šç¼–å†™æµ‹è¯•ã€‚å®ƒæœ‰ä¸€ä¸ªç®€å•çš„ APIï¼Œå¾ˆå®¹æ˜“é€‚åº”æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¹¶æ¶ˆé™¤äº†ç®¡ç†ä¸åŒçº¿ç¨‹çš„å¤æ‚æ€§ã€‚

æµ“ç¼©å’–å•¡æµ‹è¯•åŸºæœ¬ä¸Šåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:

*   *è§†å›¾åŒ¹é…å™¨*â€“å…è®¸æ‚¨åœ¨è§†å›¾ä¸­æŸ¥æ‰¾é¡¹ç›®
*   *view actions*â€“å…è®¸å¯¹å…ƒç´ æ‰§è¡Œæ“ä½œ
*   *è§†å›¾æ–­è¨€*â€“éªŒè¯è§†å›¾çŠ¶æ€

å¤„ç†æµ“ç¼©å’–å•¡æ—¶ï¼Œå»ºè®®å°†è¿™å¼ çº¸æ”¾åœ¨èº«è¾¹ã€‚

**é…ç½®**

ä¸ºäº†åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­è¿›è¡Œ Espresso æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„â€œapp / build.gradleâ€æ–‡ä»¶å’Œä¸€ä¸ªç‰©ç†æˆ–è™šæ‹Ÿè®¾å¤‡ä¸­æ·»åŠ ä¾èµ–é¡¹ã€‚

```
 dependencies {
 implementation fileTree(dir: 'libs', include: ['*.jar'])
 testImplementation 'junit:junit:4.12'

   // Android runner and rules support
 androidTestImplementation 'com.android.support.testğŸƒ1.0.2'
 androidTestImplementation 'com.android.support.test:rules:1.0.2'

   // Espresso
 androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
} 
```

å»ºè®®å…³é—­æˆ‘ä»¬çš„ android è®¾å¤‡çš„åŠ¨ç”»ï¼Œæˆ‘ä»¬å°†åœ¨å¼€å‘è€…é€‰é¡¹ä¸­ä½¿ç”¨è¿™äº›åŠ¨ç”»è¿›è¡Œæµ‹è¯•ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä»ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```
 adb shell settings put global window_animation_scale 0.0 
adb shell settings put global transition_animation_scale 0.0 
adb shell settings put global animator_duration_scale 0.0 
```

**å®æ–½**

ä½œä¸ºä¸€ä¸ªå°çš„å®è·µç»ƒä¹ ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªæ–‡æœ¬è§†å›¾å’Œä¸€ä¸ªæŒ‰é’®çš„è§†å›¾ï¼Œæˆ‘ä»¬æƒ³è¦è¯„ä¼°å½“æˆ‘ä»¬æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œä¸€ä¸ªæ–‡æœ¬è§†å›¾è¢«éšè—ï¼Œå¦ä¸€ä¸ªè¢«æ˜¾ç¤ºã€‚

[![espresso android](../Images/1811f025d10f0769550cfb37244aca65.png)T2ã€‘](https://apiumhub.com/wp-content/uploads/2018/11/Screenshot-2018-11-15-at-17.19.34.png)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ espresso record å·¥å…·æ‰‹åŠ¨æˆ–è‡ªåŠ¨åˆ›å»ºæˆ‘ä»¬çš„ ui æµ‹è¯•ã€‚

*   **å½•åˆ¶æµ“ç¼©å’–å•¡**

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ Android studio çš„é€‰é¡¹æ ä¸­è¿›å…¥**è¿è¡Œ- >è®°å½•æµ“ç¼©å’–å•¡æµ‹è¯•**

ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªå±å¹•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‚£é‡Œåšå‡ºæ–­è¨€ã€‚

[![espresso](../Images/68531160b2640b1ac15eb674d7c7a452.png)T2ã€‘](https://apiumhub.com/wp-content/uploads/2018/11/Screenshot-2018-11-15-at-17.29.15.png)

æœ€åï¼Œæˆ‘ä»¬å°†ç”Ÿæˆæµ‹è¯•ä»£ç :

```
 @LargeTest
@RunWith(AndroidJUnit4.class)
public class RecordedTextViewToggleVisibilityTest {

  @Rule
  public ActivityTestRule mActivityTestRule = new ActivityTestRule<>(MainActivity.class);

  @Test
  public void textViewToggleVisibilityTest() {
    ViewInteraction textView = onView(
        allOf(withId(R.id.tv_hello), withText("Hello buddy!"),
            childAtPosition(
                childAtPosition(
                    withId(android.R.id.content),
                    0),
                0),
            isDisplayed()));
    textView.check(matches(withText("Hello buddy!")));

    ViewInteraction appCompatButton = onView(
        allOf(withId(R.id.button), withText("click me"),
            childAtPosition(
                childAtPosition(
                    withId(android.R.id.content),
                    0),
                2),
            isDisplayed()));
    appCompatButton.perform(click());

    ViewInteraction textView2 = onView(
        allOf(withId(R.id.tv_see_you), withText("See you"),
            childAtPosition(
                childAtPosition(
                    withId(android.R.id.content),
                    0),
                1),
            isDisplayed()));
    textView2.check(matches(isDisplayed()));
  }

  private static Matcher childAtPosition(
      final Matcher parentMatcher, final int position) {

    return new TypeSafeMatcher() {
      @Override
      public void describeTo(Description description) {
        description.appendText("Child at position " + position + " in parent ");
        parentMatcher.describeTo(description);
      }

      @Override
      public boolean matchesSafely(View view) {
        ViewParent parent = view.getParent();
        return parent instanceof ViewGroup && parentMatcher.matches(parent)
            && view.equals(((ViewGroup) parent).getChildAt(position));
      }
    };
  }
} 
```

*   **æ‰‹åŠ¨è¡¨å•**

```
 @LargeTest
@RunWith(AndroidJUnit4.class)
public class ManualTextViewToggleVisibilityTest {

  @Rule
  public ActivityTestRule mActivityTestRule = new ActivityTestRule<>(MainActivity.class);

  @Test
  public void textViewToggleVisibilityTest() {

    // here we are going to look in the view tree
    // we use allOff from hamcrest library to combine matchers
    ViewInteraction tvHello = onView(allOf(withId(R.id.tv_hello),withText(R.String.hello_buddy)));

    ViewInteraction tvSeeYou = onView(allOf(withId(R.id.tv_see_you),withText(R.String.see_you)));

    // assert that textView with text 'Hello buddy!' is display
    tvHello.check(matches(isDisplayed()));

    // assert that textView with text 'See you' has visibility gone
tvSeeYou.check(matches(withEffectiveVisibility(ViewMatchers.Visibility.GONE)));

    // find button with given id and click
    onView(withId(R.id.button)).perform(click());

    // assert see you is visible and hello buddy is not. tvHello.check(matches(withEffectiveVisibility(ViewMatchers.Visibility.GONE)));
    tvSeeYou.check(matches(isDisplayed()));
  }
} 
```

æˆ‘ä»¬å¯ä»¥éªŒè¯ Espresso è‡ªåŠ¨ç”Ÿæˆäº†æ›´å¤šçš„ä»£ç ï¼Œè¿™äº›ä»£ç å¾ˆå®¹æ˜“è¢«ç ´è§£ï¼Œéœ€è¦æ›´å¤šçš„ç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–‡å­—å­—ç¬¦ä¸²æ¥æŸ¥æ‰¾è§†å›¾ï¼Œå¦‚æœæ›´æ”¹è®¾å¤‡çš„è¯­è¨€ï¼Œæµ‹è¯•å°†ä¼šå¤±è´¥ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨å­—ç¬¦ä¸²èµ„æºçš„ idï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ å°½å¯èƒ½å¤šçš„åŒ¹é…å™¨ã€‚

ä½¿ç”¨åŒ¹é…å™¨æ—¶ï¼Œè¿™ä»½ [hamcrest å‚è€ƒæŒ‡å—](https://www.marcphilipp.de/downloads/posts/2013-01-02-hamcrest-quick-reference/Hamcrest-1.3.pdf)ä¼šå¾ˆæœ‰ç”¨ã€‚

**ç»“è®º:æµ“ç¼©å’–å•¡æµ‹è¯•**

ä½œä¸ºäººç±»ï¼Œæˆ‘ä»¬å®¹æ˜“çŠ¯é”™è¯¯ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„è½¯ä»¶å®¹æ˜“å‡ºç°é”™è¯¯å’Œç¼ºé™·ã€‚Espresso å¸®åŠ©æˆ‘ä»¬å‘ç°å¼€å‘ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œç¡®ä¿å®¢æˆ·çš„å¯é æ€§å’Œä»–å¯¹åº”ç”¨ç¨‹åºçš„æ»¡æ„åº¦ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å°† Espresso æ·»åŠ åˆ°æ‚¨çš„å¼€å‘å·¥å…·ä¸­ï¼Œè¯·è€ƒè™‘ä¸€ä¸‹é‚£äº›å¿…é¡»æ‰‹åŠ¨æµ‹è¯•åº”ç”¨ç¨‹åºçš„äººã€‚

å¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šå…³äºæµ“ç¼©å’–å•¡æµ‹è¯•çš„çŸ¥è¯†ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ç‚¹å‡»[è¿™é‡Œ](http://eepurl.com/cC96MY)è®¢é˜…æˆ‘ä»¬çš„æ¯æœˆç®€è®¯ã€‚

## å¦‚æœä½ è§‰å¾—è¿™ç¯‡å…³äºæµ“ç¼©å’–å•¡æµ‹è¯•çš„æ–‡ç« å¾ˆæœ‰è¶£ï¼Œä½ å¯èƒ½ä¼šå–œæ¬¢â€¦

[åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨ kot Lin](https://steelkiwi.com/blog/using-kotlin-your-android-production-code/)

[iOS Objective-C app:æˆåŠŸæ¡ˆä¾‹ç ”ç©¶](https://dev.to/apium_hub/protected-ios-objective-c-app-cornerjob-successfull-case-study-89e)

[å¹´åº¦ç§»åŠ¨åº”ç”¨å¼€å‘è¶‹åŠ¿](https://dev.to/apium_hub/mobile-app-development-trends-of-the-year)

[Banco Falabella å¯ç©¿æˆ´è®¾å¤‡æ¡ˆä¾‹ç ”ç©¶](https://apiumhub.com/tech-blog-barcelona/banco-falabella-wearable-ios-android/)

[ç§»åŠ¨å¼€å‘é¡¹ç›®](https://apiumhub.com/software-projects-barcelona/)

[é¢å‘ iOS åº”ç”¨çš„ Viper æ¶æ„ä¼˜åŠ¿](https://apiumhub.com/tech-blog-barcelona/viper-architecture/)

[ä¸ºä»€ä¹ˆæ˜¯ç§‘ç‰¹æ—ï¼Ÿ](https://dev.to/apium_hub/why-kotlin-language-android-why-did-google-choose-kotlin--639)

[è½¯ä»¶æ¶æ„ä¼šè®®](https://dev.to/apium_hub/apiumhub-software-architecture-meetups-in-barcelona-31df)

[å®‰å“çº¯ MVP](https://dev.to/apium_hub/pure-model-view-presenter-in-android-1736)

å¸–å­[ç®€ä»‹:æµ“ç¼©å’–å•¡æµ‹è¯•](https://apiumhub.com/tech-blog-barcelona/introduction-espresso-testing/)æœ€æ—©å‡ºç°åœ¨ [Apiumhub](https://apiumhub.com) ä¸Šã€‚