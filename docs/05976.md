# åœ¨ VPC å†…ç¼©æ”¾å…°å§†è¾¾æ–¯

> åŸæ–‡:[https://dev.to/paulswail/scaling-lambdas-inside-a-vpc-3fik](https://dev.to/paulswail/scaling-lambdas-inside-a-vpc-3fik)

å› æ­¤ï¼Œæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ª Lambda å‡½æ•°ï¼Œæ‚¨éœ€è¦å®ƒä¸ VPC å†…éƒ¨çš„èµ„æºè¿›è¡Œå¯¹è¯ï¼Œå¯èƒ½æ˜¯ RDS æ•°æ®åº“æˆ– Redis Elasticacheã€‚

ä½ å¬è¯´è¿‡ VPC Lambda å‡½æ•°æ¯”æ ‡å‡†å‡½æ•°æ›´å¤æ‚ï¼Œå¹¶ä¸”å‘ç°å¾ˆéš¾ä» AWS æ–‡æ¡£ä¸­è·å¾—å®Œæ•´çš„æè¿°ã€‚å½“ç›¸å…³æ–‡æ¡£åˆ†å¸ƒåœ¨å¦‚æ­¤å¤šçš„é¡µé¢ä¸Šæ—¶ï¼Œå¾ˆéš¾çŸ¥é“ä½ ä¸çŸ¥é“ä»€ä¹ˆã€‚

ç„¶è€Œï¼Œä½ *ç¡®å®*çŸ¥é“ä½ éœ€è¦å›ç­”çš„é—®é¢˜ï¼Œä»¥ä¾¿ç¡®ä¿¡ä½ çš„èŒèƒ½å°†å¤§è§„æ¨¡æ‰§è¡Œ:

*   å®ƒèƒ½å¤Ÿå¤„ç†æˆ‘çš„æœ€å¤§é¢„è®¡ååé‡å—ï¼Ÿ
*   æœ‰ä¸Šå‡é™åˆ¶å—ï¼Ÿ
*   å¦‚æœå®é™…ä½¿ç”¨é‡è¶…è¿‡è¿™äº›é™åˆ¶ï¼Œæˆ‘çš„åº”ç”¨ä¼šå—åˆ°ä»€ä¹ˆå½±å“ï¼Ÿ
*   åœ¨è´Ÿè½½ä¸‹ï¼Œå†·å¯åŠ¨å¦‚ä½•å½±å“æˆ‘çš„ Lambda å‡½æ•°ï¼Ÿ

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å›ç­”æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œå¹¶å¸®åŠ©æ‚¨**ç¡®ä¿æ‚¨çš„æ”¯æŒ VPC çš„åŠŸèƒ½é’ˆå¯¹å¯ä¼¸ç¼©æ€§è¿›è¡Œäº†ä¼˜åŒ–é…ç½®**ã€‚

ä¸åœ¨ä¹ç†è§£â€œä¸ºä»€ä¹ˆâ€ï¼Œåªæƒ³çŸ¥é“â€œå¦‚ä½•â€ï¼Ÿç›´æ¥è·³åˆ°æ–‡ç« åº•éƒ¨çš„**è¡ŒåŠ¨è®¡åˆ’**éƒ¨åˆ†ã€‚ğŸ‘‡

## Î»ç¼©æ”¾æ¦‚è¿°

è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Î»å‡½æ•°çš„[ç¼©æ”¾è¡Œä¸º:](https://docs.aws.amazon.com/lambda/latest/dg/scaling.html)

> AWS Lambda å°†æ ¹æ®æ‚¨å¸æˆ·çš„å¸æˆ·çº§å¹¶å‘æ‰§è¡Œé™åˆ¶ï¼ŒåŠ¨æ€æ‰©å±•å®¹é‡ä»¥åº”å¯¹æµé‡çš„å¢åŠ ã€‚ä¸ºäº†å¤„ç†ä»»ä½•æµé‡çš„çªå‘ï¼ŒLambda ä¼šç«‹å³å¢åŠ ä½ çš„å¹¶å‘æ‰§è¡Œå‡½æ•°ä¸€ä¸ªé¢„å®šçš„æ•°é‡ï¼Œè¿™å–å†³äºå®ƒæ‰§è¡Œçš„åŒºåŸŸã€‚

ä¸ºäº†è¯¦ç»†è¯´æ˜â€œæ‰©å±•å®¹é‡â€çš„å«ä¹‰ï¼Œæ¯ä¸ª Lambda å‡½æ•°éƒ½æ˜¯åœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„(æƒ³æƒ³ Docker)ã€‚åœ¨ Lambda æœ€ç»ˆå¤„ç†é¡ºåºè¯·æ±‚ä¹‹å‰ï¼Œä¸€ä¸ªå®¹å™¨å¯ä»¥å¤„ç†å‡ ä¸ªå°æ—¶ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ä¸€ä¸ªè¯·æ±‚æ­£åœ¨è¿›è¡Œæ—¶æœ‰å¦ä¸€ä¸ªè¯·æ±‚è¿›æ¥ï¼Œå°±éœ€è¦ä¸€ä¸ªæ–°çš„å®¹å™¨æ¥å¤„ç†å®ƒã€‚

[å¸æˆ·çº§åˆ«å¹¶å‘æ‰§è¡Œé™åˆ¶](https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html#concurrent-execution-safety-limit)è¢«è®¾ç½®ä¸ºæ¯ä¸ªåœ°åŒº 1000(å°½ç®¡å¯ä»¥é€šè¿‡è”ç³» AWS æ”¯æŒæ¥å¢åŠ )ã€‚
è¿™æ„å‘³ç€æ‚¨å¸æˆ·ä¸­æ‰€æœ‰ Lambda å‡½æ•°çš„ååé‡ä¸Šé™å¯ä»¥è®¡ç®—å¦‚ä¸‹:

`max_requests_per_second = 1000 / function_duration_seconds`

å› æ­¤ï¼Œå¯¹äºä¸€ä¸ªå¹³å‡éœ€è¦ 0.5 ç§’å®Œæˆçš„å‡½æ•°ï¼Œæ‚¨å¯ä»¥å®ç°çš„ç»å¯¹æœ€å¤§ååé‡æ˜¯æ¯ç§’`1000 / 0.5 = 2000`ä¸ªè¯·æ±‚ã€‚(ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„å¸æˆ·ä¸­æœ‰å…¶ä»–åŠŸèƒ½ä¹Ÿåœ¨æ­¤æœŸé—´æ‰§è¡Œï¼Œæ­¤é™åˆ¶å°†ä¼šé™ä½)ã€‚

## [](#adding-a-vpc-into-the-mix)å‘æ··åˆç‰©ä¸­åŠ å…¥ VPC

å½“æ‚¨[å°† Lambda å‡½æ•°è¿æ¥åˆ° VPC](https://docs.aws.amazon.com/lambda/latest/dg/vpc.html) æ—¶ï¼Œå¯ä¼¸ç¼©æ€§å˜å¾—æ›´åŠ å¤æ‚:

> é»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS Lambda åœ¨ VPC ä¸­å®‰å…¨åœ°è¿è¡Œæ‚¨çš„å‡½æ•°ä»£ç ã€‚ç„¶è€Œï¼Œè¦ä½¿æ‚¨çš„ Lambda å‡½æ•°èƒ½å¤Ÿè®¿é—®æ‚¨çš„ç§æœ‰ VPC å†…éƒ¨çš„èµ„æºï¼Œæ‚¨å¿…é¡»æä¾›é¢å¤–çš„ç‰¹å®šäº VPC çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ VPC å­ç½‘ id å’Œå®‰å…¨ç»„ idã€‚ **AWS Lambda ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥è®¾ç½®å¼¹æ€§ç½‘ç»œæ¥å£(ENIs ),ä½¿æ‚¨çš„åŠŸèƒ½èƒ½å¤Ÿå®‰å…¨åœ°è¿æ¥åˆ°æ‚¨çš„ä¸“ç”¨ VPC å†…çš„å…¶ä»–èµ„æºã€‚**

[![Lambda functions connecting to a VPC via an ENI](../Images/8b30254444fda5905b6ac29ec5b31dd8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--W-DncP__--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://winterwindsoftware.com/img/blog-images/lambda-vpc-eni.png)

åœ¨æ¯ä¸ªå‡½æ•°å®¹å™¨å’Œ VPC ä¹‹é—´å»ºç«‹ ENI çš„è¦æ±‚ä» 3 ä¸ªæ–¹é¢é™åˆ¶äº† Lambda å‡½æ•°çš„å¯ä¼¸ç¼©æ€§:

1.  å¯ä»¥åˆ›å»ºçš„ ENI æ•°é‡æœ‰ä¸Šé™(ENI å®¹é‡)ï¼Œå› æ­¤é™åˆ¶äº†æ¯ç§’å¯å®ç°çš„æœ€å¤§è¯·æ±‚æ•°
2.  å†·å¯åŠ¨å¼€é”€æ›´å¤§
3.  ä¸Šå‡ç‡æœ‰ä¸Šé™

### [](#constraint-1-eni-capacity)çº¦æŸ#1: ENI äº§èƒ½

åŒ»ç”Ÿå»ºè®®:

> å¦‚æœæ‚¨çš„ Lambda å‡½æ•°è®¿é—® VPCï¼Œæ‚¨å¿…é¡»ç¡®ä¿æ‚¨çš„ VPC æœ‰è¶³å¤Ÿçš„ ENI å®¹é‡æ¥æ”¯æŒæ‚¨çš„ Lambda å‡½æ•°çš„æ¯”ä¾‹è¦æ±‚ã€‚

...ä»–ä»¬æä¾›äº†ä¸‹é¢çš„å…¬å¼æ¥å‘Šè¯‰ä½ ä½ çš„å‡½æ•°éœ€è¦å¤šå°‘ä¸ª Eni:

`ENI Capacity = Projected peak concurrent executions * (Memory in GB / 3GB)`

å› æ­¤ï¼Œå¦‚æœæ‚¨çš„é¢„è®¡å³°å€¼è´Ÿè½½ä¸º 1ï¼Œ000ï¼Œ000 ä¸ªè¯·æ±‚/å°æ—¶ï¼Œæ‚¨çš„å¹³å‡åŠŸèƒ½æŒç»­æ—¶é—´ä¸º 0.5 ç§’ï¼Œå¹¶ä¸”åˆ†é…äº† 1GB çš„å†…å­˜ï¼Œåˆ™ ENI å®¹é‡å¯ä»¥è®¡ç®—å¦‚ä¸‹:

`Peak concurrent executions = 1000000/(60*60) * 0.5 = 139`

`ENI Capacity = 139 * (1GB / 3GB) = 47`

#### [](#calculating-your-actual-eni-capacity)è®¡ç®—ä½ çš„å®é™… ENI å®¹é‡

ä½†æ˜¯è¿™ä¸ªå…¬å¼æ²¡æœ‰å‘Šè¯‰ä½ åœ¨ä½ çš„ VPC ä¸­ä½ å½“å‰æœ‰å¤šå°‘ ENI å®¹é‡*å¯ç”¨*ï¼Œåªå‘Šè¯‰ä½ çš„åŠŸèƒ½*éœ€è¦å¤šå°‘*æ¥è¾¾åˆ°ä½ çš„é¢„è®¡å³°å€¼è´Ÿè½½ã€‚ä»ä¸è¯¥åŠŸèƒ½ç›¸è¿çš„å­ç½‘å†…çš„ IP åœ°å€èŒƒå›´ä¸­ï¼Œä¸ºæ¯ä¸ª ENI åˆ†é…ä¸€ä¸ªä¸“ç”¨ IP åœ°å€ã€‚å› æ­¤ï¼Œä¸ºäº†è®¡ç®— ENI å®¹é‡ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—æ‰€æœ‰å­ç½‘ä¸­å¯ç”¨ IP åœ°å€çš„æ€»æ•°ã€‚

ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [VPC æ§åˆ¶å°](https://console.aws.amazon.com/vpc/home#subnets:sort=SubnetId)åˆ—å‡ºæ‚¨çš„ VPC ä¸­çš„æ‰€æœ‰å­ç½‘ã€‚ç„¶åè·å–`IPv4 CIDR`åˆ—çš„å€¼ï¼Œå¹¶å°†å…¶æ’å…¥ [IP CIDR è®¡ç®—å™¨](https://mxtoolbox.com/subnetcalculator.aspx)ï¼Œä»¥è·å¾—è¯¥èŒƒå›´å†…å¯ç”¨ IP åœ°å€çš„æ•°é‡ã€‚å¯¹è¿æ¥åˆ°æ‚¨çš„å‡½æ•°çš„æ¯ä¸ªå­ç½‘æ‰§è¡Œæ­¤æ“ä½œï¼Œå¹¶å°†è¿™äº›å€¼ç›¸åŠ ï¼Œå¾—åˆ°æ‚¨çš„æ€»å®é™… ENI å®¹é‡ã€‚

### [](#constraint-2-cold-start-overhead)çº¦æŸ#2:å†·å¯åŠ¨å¼€é”€

æ‰€æœ‰ Lambda å‡½æ•°éƒ½ä¼šå¯¼è‡´â€œå†·å¯åŠ¨â€ï¼Œè¿™æ˜¯ AWS æä¾›ä¸€ä¸ªå®¹å™¨æ¥æœåŠ¡ä¸€ä¸ªå‡½æ•°è¯·æ±‚æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œè¿™ç§å½±å“[å¯¹äºå¯ç”¨ VPC çš„ Lambda å‡½æ•°](https://docs.aws.amazon.com/lambda/latest/dg/vpc.html#vpc-configuring)æ›´å¤§:

> å½“ Lambda å‡½æ•°è¢«é…ç½®ä¸ºåœ¨ VPC å†…è¿è¡Œæ—¶ï¼Œå®ƒä¼šå¯¼è‡´é¢å¤–çš„ ENI å¯åŠ¨æŸå¤±ã€‚è¿™æ„å‘³ç€å½“å°è¯•è¿æ¥åˆ°ç½‘ç»œèµ„æºæ—¶ï¼Œåœ°å€è§£æå¯èƒ½ä¼šå»¶è¿Ÿã€‚

é™¤äº†å½±å“å¯¼è‡´å†·å¯åŠ¨çš„å•ä¸ªè¯·æ±‚ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šå½±å“æ‚¨çš„ä¸Šå‡é€Ÿç‡ï¼Œå› ä¸ºå®ƒä¼šæœ‰æ•ˆåœ°å¢åŠ ä¸Šå‡æœŸé—´çš„å¹³å‡åŠŸèƒ½æŒç»­æ—¶é—´ã€‚

### [](#constraint-3-rampup-rate)çº¦æŸ#3:ä¸Šå‡é€Ÿç‡

Ramp-up rate æ˜¯ Lambda æä¾›æ–°çš„å‡½æ•°å®¹å™¨æ¥æ»¡è¶³å‡½æ•°è¯·æ±‚å¢é•¿çš„é€Ÿç‡ã€‚[æ–‡ä»¶](https://docs.aws.amazon.com/lambda/latest/dg/scaling.html#scaling-behavior)æè¿°äº†å¦‚ä¸‹çš„ä¸Šå‡è¡Œä¸º:

> ä¸ºäº†å¤„ç†ä»»ä½•æµé‡çš„çªå‘ï¼ŒLambda ä¼šç«‹å³å¢åŠ ä½ çš„å¹¶å‘æ‰§è¡Œå‡½æ•°ä¸€ä¸ªé¢„å®šçš„æ•°é‡ï¼Œè¿™å–å†³äºå®ƒæ‰§è¡Œçš„åŒºåŸŸã€‚
> å¦‚æœé»˜è®¤çš„å³æ—¶å¹¶å‘å¢åŠ å€¼ä¸è¶³ä»¥é€‚åº”æµé‡æ¿€å¢ï¼ŒAWS Lambda å°†ç»§ç»­ä»¥æ¯åˆ†é’Ÿ 500 æ¬¡çš„é€Ÿåº¦å¢åŠ å¹¶å‘å‡½æ•°æ‰§è¡Œçš„æ•°é‡ï¼Œç›´åˆ°è¾¾åˆ°æ‚¨çš„å¸æˆ·å®‰å…¨é™åˆ¶æˆ–å¹¶å‘æ‰§è¡Œå‡½æ•°çš„æ•°é‡è¶³ä»¥æˆåŠŸå¤„ç†å¢åŠ çš„è´Ÿè½½ã€‚

â€œå³æ—¶å¹¶å‘å¢åŠ â€å€¼å¯¹äºæ¯ä¸ªåŒºåŸŸæ˜¯ä¸åŒçš„[ã€‚å¯¹äºç¾å›½ä¸œéƒ¨(N.Virginia ),æ˜¯ 3000ã€‚](https://docs.aws.amazon.com/lambda/latest/dg/limits.html)

ä½†æ˜¯ï¼Œå¯¹äº VPC åŠŸèƒ½:

> å› ä¸º Lambda ä¾èµ– Amazon EC2 ä¸ºæ”¯æŒ VPC çš„ Lambda å‡½æ•°æä¾›å¼¹æ€§ç½‘ç»œæ¥å£ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°åœ¨æ‰©å±•æ—¶ä¹Ÿä¼šå—åˆ° Amazon EC2 çš„é€Ÿç‡é™åˆ¶ã€‚

ä½ éœ€è¦ä½¿ç”¨ EC2 æ§åˆ¶å°[æ£€æŸ¥ä½ çš„è´¦æˆ·](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-resource-limits.html)çš„ EC2 é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯â€œæ¯ä¸ªåœ°åŒºçš„ç½‘ç»œæ¥å£â€é™åˆ¶ï¼Œé»˜è®¤ä¸º 350ã€‚å¦‚æœè¿™ä¸ªå€¼å°äºæ‚¨çš„å‡½æ•°çš„â€œå³°å€¼å¹¶å‘æ‰§è¡Œâ€æ•°ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦è¯·æ±‚å¢åŠ è¿™ä¸ªé™åˆ¶ã€‚

## [](#what-happens-when-the-concurrency-limit-is-hit)è¾¾åˆ°å¹¶å‘é™åˆ¶ä¼šæ€æ ·ï¼Ÿ

å¦‚æœæ‚¨çš„å‡½æ•°è¾¾åˆ°äº†å®ƒçš„å¹¶å‘é™åˆ¶ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„ä»»ä½•è¿›ä¸€æ­¥è°ƒç”¨éƒ½ä¼šè¢«æŠ‘åˆ¶ã€‚Lambda åº”ç”¨çš„[èŠ‚æµè¡Œä¸º](https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html#throttling-behavior)æ˜¯ä¸åŒçš„ï¼Œè¿™å–å†³äºäº‹ä»¶æºæ˜¯å¦åŸºäºæµï¼Œä»¥åŠå®ƒæ˜¯åŒæ­¥è°ƒç”¨è¿˜æ˜¯å¼‚æ­¥è°ƒç”¨ã€‚å¯¹äºåŒæ­¥è°ƒç”¨çš„éåŸºäºæµçš„äº‹ä»¶æºï¼Œè¡Œä¸ºæ˜¯:

> Lambda è¿”å› 429 é”™è¯¯ï¼Œè°ƒç”¨æœåŠ¡è´Ÿè´£é‡è¯•ã€‚ThrottledReason é”™è¯¯ä»£ç è§£é‡Šäº†æ‚¨é‡åˆ°çš„æ˜¯å‡½æ•°çº§é™åˆ¶(å¦‚æœæŒ‡å®š)è¿˜æ˜¯å¸æˆ·çº§é™åˆ¶ã€‚æ¯ä¸ªæœåŠ¡å¯èƒ½æœ‰è‡ªå·±çš„é‡è¯•ç­–ç•¥ã€‚æ¯ä¸ªèŠ‚æµè°ƒç”¨éƒ½ä¼šå¢åŠ  Amazon CloudWatch å‡½æ•°çš„èŠ‚æµæŒ‡æ ‡ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨ API ç½‘å…³åé¢æœ‰ä¸€ä¸ª Lambda å‡½æ•°ï¼Œæ‚¨çš„ web API å®¢æˆ·ç«¯å°†ä¼šæ”¶åˆ°ä¸€ä¸ª 429 é”™è¯¯ã€‚

å¦ä¸€ä¸ª[éœ€è¦æ³¨æ„çš„äº‹é¡¹](https://docs.aws.amazon.com/lambda/latest/dg/vpc.html#vpc-setup-guidelines)æ˜¯:

> å¦‚æœæ‚¨çš„ VPC æ²¡æœ‰è¶³å¤Ÿçš„ Eni æˆ–å­ç½‘ IPï¼Œæ‚¨çš„ Lambda å‡½æ•°å°†ä¸ä¼šéšç€è¯·æ±‚çš„å¢åŠ è€Œæ‰©å±•ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°å‡½æ•°æ•…éšœçš„å¢åŠ ã€‚ **AWS Lambda ç›®å‰ä¸ä¼šå°†ç”± Eni æˆ– IP åœ°å€ä¸è¶³å¯¼è‡´çš„é”™è¯¯è®°å½•åˆ° CloudWatch æ—¥å¿—ä¸­ã€‚**

æ²¡æœ‰ä¸€ä¸ªæ—¥å¿—æ¡ç›®æ¥æè¿°ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ä¸ªé”™è¯¯å°†æ˜¯ä¸€ä¸ªå¾ˆéš¾è¯Šæ–­çš„é—®é¢˜ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿçš„å”¯ä¸€æ ‡å¿—æ˜¯ [`Invocation Errors`](https://docs.aws.amazon.com/lambda/latest/dg/monitoring-functions-metrics.html) CloudWatch æŒ‡æ ‡å¢åŠ ã€‚

## [](#your-action-plan)ä½ çš„è¡ŒåŠ¨è®¡åˆ’

ç°åœ¨ä½ çŸ¥é“ Lambda å¦‚ä½•æ‰©å±•ä½ çš„æ”¯æŒ VPC çš„ Lambda å‡½æ•°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†æ­¥æŒ‡å—ï¼Œç¡®ä¿ä½ çš„å‡½æ•°ä¸ºå¯ä¼¸ç¼©æ€§è¿›è¡Œäº†ä¼˜åŒ–é…ç½®:

1.  ç”¨è¿™ä¸ªå…¬å¼è®¡ç®—ä½ çš„`Peak Concurrent Executions`:`Peak Concurrent Executions = Peak Requests per Second * Average Function Duration (in seconds)`
2.  ç°åœ¨è®¡ç®—ä½ çš„`Required ENI Capacity` : `Required ENI Capacity = Projected peak concurrent executions * (Function Memory Allocation in GB / 3GB)`
3.  å¦‚æœ`Peak Concurrent Executions` > `Account Level Concurrent Execution Limit`(é»˜è®¤= 1000)ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦[è¦æ±‚ AWS å¢åŠ è¿™ä¸ªé™åˆ¶](https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html#concurrent-execution-safety-limit)ã€‚
4.  å°†æ‚¨çš„å‡½æ•°é…ç½®ä¸ºä½¿ç”¨ VPC å†…éƒ¨æ‰€æœ‰å¯ç”¨çš„å­ç½‘ï¼Œè¿™äº›å­ç½‘å¯ä»¥è®¿é—®æ‚¨çš„å‡½æ•°éœ€è¦è¿æ¥çš„èµ„æºã€‚è¿™æ—¢æœ€å¤§åŒ–äº†`Actual ENI Capacity`ï¼Œåˆæä¾›äº†æ›´é«˜çš„å¯ç”¨æ€§(å‡è®¾å­ç½‘åˆ†å¸ƒåœ¨ 2 ä¸ªä»¥ä¸Šçš„å¯ç”¨æ€§åŒºåŸŸ)ã€‚
5.  ä½¿ç”¨ä¸Šé¢â€œå®é™… ENI å®¹é‡â€ä¸€èŠ‚ä¸­æè¿°çš„æ­¥éª¤è®¡ç®—æ‚¨çš„`Actual ENI Capacity`ã€‚
6.  å¦‚æœ`Required ENI Capacity` > `Actual ENI Capacity`ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹æ“ä½œ:
    *   å‡å°‘ä½ çš„å‡½æ•°çš„å†…å­˜åˆ†é…æ¥å‡å°‘ä½ çš„`Required ENI Capacity`ã€‚
    *   å°†ä»»ä½•ä¸éœ€è¦ VPC è®¿é—®çš„è€—æ—¶ä»£ç é‡æ„åˆ°å•ç‹¬çš„ Lambda å‡½æ•°ä¸­ã€‚
    *   åœ¨æ‚¨çš„åº”ç”¨ä¸­å®ç°èŠ‚æµå¤„ç†é€»è¾‘(ä¾‹å¦‚ï¼Œåœ¨å®¢æˆ·ç«¯ä¸­å†…ç½®é‡è¯•åŠŸèƒ½)ã€‚
7.  å¦‚æœ`Required ENI Capacity` >æ‚¨çš„ EC2 [`Network Interfaces per region`](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-resource-limits.html) è´¦æˆ·é™é¢ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦[è¯·æ±‚ AWS å¢åŠ è¯¥é™é¢](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-resource-limits.html#request-increase)ã€‚
8.  è€ƒè™‘[é…ç½®ä¸€ä¸ªå‡½æ•°çº§å¹¶å‘é™åˆ¶](https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html#per-function-concurrency)ä»¥ç¡®ä¿æ‚¨çš„å‡½æ•°ä¸ä¼šè¾¾åˆ° ENI å®¹é‡é™åˆ¶ï¼Œå¹¶ä¸”å¦‚æœæ‚¨å¸Œæœ›ç”±äºä¸‹æ¸¸æ¶æ„é™åˆ¶è€Œå¼ºåˆ¶é™åˆ¶åœ¨æŸä¸ªé™åˆ¶ã€‚
9.  [ä½¿ç”¨ CloudWatch æŒ‡æ ‡ç›‘æ§ç”Ÿäº§ä¸­å‡½æ•°çš„å¹¶å‘çº§åˆ«](https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html#monitoring-concurrent-usage),è¿™æ ·æ‚¨å°±å¯ä»¥çŸ¥é“è°ƒç”¨æ˜¯å¦ç”±äº ENI å®¹é‡ä¸è¶³è€Œè¢«æŠ‘åˆ¶æˆ–å‡ºé”™ã€‚

ğŸ”¢å¦‚æœæ‚¨çš„ AWS å¸æˆ·ä¸­è¿è¡Œäº†å¤§é‡ Lambda å‡½æ•°ï¼Œæ‚¨åº”è¯¥å°è¯•ä½¿ç”¨ [Lambda ç¼©æ”¾è®¡ç®—å™¨](https://winterwindsoftware.com/lambda-scaling-calculator/)æ¥è·å¾—ä¸€ä¸ªäº¤äº’å¼è§†å›¾ï¼Œäº†è§£ä¸åŒçš„å‡½æ•°é…ç½®æ–‡ä»¶åœ¨è´Ÿè½½ä¸‹å°†å¦‚ä½•ç¼©æ”¾ï¼Œä»¥åŠä½•æ—¶å°†è¾¾åˆ°å®¹é‡ã€‚

ğŸ’Œ ***å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥æ³¨å†Œ[åˆ°æˆ‘å…³äºåœ¨ AWS](https://winterwindsoftware.com/newsletter/) ä¸­æ„å»ºæ— æœåŠ¡å™¨åº”ç”¨çš„æ¯å‘¨æ—¶äº‹é€šè®¯ã€‚***