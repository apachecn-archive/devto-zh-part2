# 什么是 DNS？

> 原文:[https://dev.to/gabeguz/whats-dns-13c3](https://dev.to/gabeguz/whats-dns-13c3)

DNS 基本上就是互联网的通讯录。当你在浏览器中输入[www.duckduckgo.com](http://www.duckduckgo.com)时，计算机需要想出如何将你的请求发送到正确的服务器。互联网上的路由通过 IP 地址工作，所以要到达 www.duckduckgo.com 的，你首先需要弄清楚它的 IP 地址是什么。

这就是域名系统 DNS 的用武之地。概括地说，当您在浏览器的地址栏中按 enter 时，浏览器会进行 DNS 查找，尝试找到您输入的服务器名称的 IP 地址。DNS 查找包括调用名为`gethostbyname()`的操作系统函数(syscall)。这个函数接受一个字符串，比如“[www.duckduckgo.com](http://www.duckduckgo.com)”，并返回一个包含主机 IP 地址和其他信息的结构。在我的系统上，这个结构看起来像这样 <sup id="fnref1">[1](#fn1)</sup> :

```
struct  hostent { 
    char    *h_name;    /* official name of host */ 
    char    **h_aliases;    /* alias list */ 
    int h_addrtype; /* host address type */ 
    int h_length;   /* length of address */ 
    char    **h_addr_list;  /* list of returned addresses */ 
}; 
```

Enter fullscreen mode Exit fullscreen mode

`gethostbyname()`怎么知道[www.duckduckgo.com](http://www.duckduckgo.com)的 IP 地址是什么？类似 Unix 的计算机(包括 MAC)有一个名为`/etc/resolv.conf`的文件，它告诉操作系统应该在哪里查找名称到地址的查找，你可以在你的终端程序中键入`cat /etc/resolv.conf`来检查你的。

我的长这样:

```
$ cat /etc/resolv.conf
# Generated by iwm0 dhclient
nameserver 192.168.0.1
lookup file bind 
```

Enter fullscreen mode Exit fullscreen mode

这告诉了我一些事情:

1.  `#Generated by iwm0 dhclient`这告诉我文件本身是由`dhclient`程序生成的。`dhclient`是通过 DHCP(动态主机配置协议)向请求 IP 地址的计算机分发 IP 地址的程序
2.  这告诉我一个服务器的 IP 地址，我可以用它来查找我还不知道的名字。这很快就会变得重要。
3.  `lookup file bind`这告诉计算机应该使用什么数据库来“查找”IP 地址，“文件”告诉计算机首先检查`/etc/hosts`文件，“绑定”告诉计算机向 DNS 请求 IP 地址。

如果您是一名 web 开发人员，您可能会使用`/etc/hosts`文件让一个 web 地址临时指向您的计算机以进行测试。如果没有，没关系，我们现在就来谈谈。

如果你在`/etc/hosts`中查找，你会看到看起来有点像这样的东西:

```
$ cat /etc/hosts
127.0.0.1       localhost
::1             localhost 
```

Enter fullscreen mode Exit fullscreen mode

这是 IP 地址、主机名和别名的映射。在上面的例子中，没有定义别名。如果我想恶作剧，我可以这样做:

```
$ cat /etc/hosts
127.0.0.1       localhost
::1             localhost
127.0.0.1       www.duckduckgo.com 
```

Enter fullscreen mode Exit fullscreen mode

现在，当我试图浏览到[https://www.duckduckgo.com/](https://www.duckduckgo.com/)时，我得到一个错误，因为`gethostbyname("www.duckduckgo.com")`正在返回 127.0.0.1，这是我本地计算机的 IP 地址，而不是[www.duckduckgo.com](http://www.duckduckgo.com)的地址。如果我知道[www.duckduckgo.com](http://www.duckduckgo.com)的 IP 地址，我可以把它放在这里，一切都会工作，至少直到[www.duckduckgo.com](http://www.duckduckgo.com)的 IP 地址改变。

很久很久以前，没有域名系统，只有一堆电脑和一群人手工向`/etc/hosts`文件添加条目，或者从斯坦福 <sup id="fnref2">[2](#fn2)</sup> 分发的文件中复制粘贴。最终这变得太麻烦，有人决定写一些代码，因此 DNS 诞生了。

现在我们来看一下`resolv.conf`示例中的第二个选项，`bind.`如果`gethostbyname()`在`/etc/hosts`中找不到条目，那么它会查询在`/etc/resolv.conf`的`nameserver`部分中指定的 DNS 服务器。这是您的 DNS 服务器。

因此，操作系统向 192.168.0.1 发送一个查询，询问“[www.duckduckgo.com](http://www.duckduckgo.com)服务器的 IP 地址。如果 192.168.0.1 知道 IP 地址，它会返回给你，如果不知道...然后它会询问它的 DNS 服务器(也在`/etc/resolv.conf`文件中定义，但是现在在你的 DNS 服务器上)www.duckduckgo.com 的地址是什么。“如果*那个*服务器知道 IP 地址，它将返回它，如果不知道，它将再次询问它的 DNS 服务器是否*那个*服务器知道“[www.duckduckgo.com](http://www.duckduckgo.com)的 IP 地址”等等...直到两件事之一发生:

1.  没有人知道[www.duckduckgo.com](http://www.duckduckgo.com)的 IP 地址——在这种情况下，你会得到一个错误，必须有人去修复该网站的 DNS 记录。
2.  最终有人会说“哦，是的...我认识那个人，这是他的地址”——在这种情况下，你将向刚刚找到的 IP 地址发出一个 TCP 请求(那里至少还有一篇完整的博文)，并向服务器请求一个网页。

简而言之，这就是 DNS 的基本工作方式。但是，但是但是，我听到你问...最终响应的 DNS 服务器如何知道“[www.duckduckgo.com”的 IP 地址是什么？](http://www.duckduckgo.com?)“好问题。基本上，管理员或 devops 团队，或开发人员(现在一切都已编排好并在代码中定义了)会告诉域的“权威”名称服务器“嘿，我刚刚设置了这个服务器，它将托管网页，它的名称是'【www.duckduckgo.com】T3 '，它的 IP 地址是' 184.72.104.138 '。”

你可以在一个叫做[的区域文件](https://en.wikipedia.org/wiki/Zone_file)中这样做。

您可以使用`dig`命令:
自己处理 DNS 查询

```
$ dig www.duckduckgo.com

; <<>> DiG 9.4.2-P2 <<>> www.duckduckgo.com
;; global options:  printcmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57389
;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.duckduckgo.com.            IN      A

;; ANSWER SECTION:23.21.193.169
www.duckduckgo.com.     123     IN      CNAME   duckduckgo.com.
duckduckgo.com.         59      IN      A       23.21.193.169
duckduckgo.com.         59      IN      A       107.20.240.232
duckduckgo.com.         59      IN      A       184.72.104.138

;; Query time: 51 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Wed Apr 25 17:41:15 2018
;; MSG SIZE  rcvd: 98 
```

Enter fullscreen mode Exit fullscreen mode

你现在可以忽略大部分内容，有趣的是`QUESTION SECTION`，它基本上只是为你重复你的查询，而`ANSWER SECTION`在这种情况下告诉我们“【www.duckduckgo.com】[是一个](http://www.duckduckgo.com)[【CNAME】](https://en.wikipedia.org/wiki/CNAME_record)(规范名称)
，有点像“duckduckgo.com”的别名，它有三个 IP 地址:23.21.193.169、107.20.240.232 和 184.72.104.138。通过将它们复制粘贴到您的浏览器中，您应该能够确认其中任何一个会转到 duckduckgo.com 网站(这并不总是有效，因为您可以在同一 IP 地址的同一服务器上运行多个网站)。

关于那件事，我要说的就是这些。
问题，反馈？留言评论！

* * *

1.  [https://man.openbsd.org/gethostbyname#DESCRIPTION](https://man.openbsd.org/gethostbyname#DESCRIPTION)T2】↩

2.  [https://en . Wikipedia . org/wiki/hosts _(file)](https://en.wikipedia.org/wiki/Hosts_(file))T2】↩