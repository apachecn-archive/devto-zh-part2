# 宁静的安全:堵塞漏洞！

> 原文:[https://dev.to/dshearer/restful-security-plug-the-leaks-npa](https://dev.to/dshearer/restful-security-plug-the-leaks-npa)

TL；DR:不要通过 HTTP 错误码泄露信息。

这里有一个可能的漏洞，可能不是很严重，但容易被忽略。假设我们受雇重做一家当地银行的网站。作为时髦的程序员，我们决定做一个好的 RESTful API。

我们的 API 操作之一如下:

```
GET /api/accounts/{acctId} 
```

Enter fullscreen mode Exit fullscreen mode

当然，只有当 ID 为`acctID`的帐户存在并且请求包含拥有该帐户的客户的有效凭证时，该操作才会成功。如果其中一个条件不成立，我们将返回一个适当的 HTTP 错误代码。

错误代码应该是什么？我们知道 RESTful APIs 返回最适合这种情况的状态代码。因此，当帐户不存在时返回 404，当帐户存在但用户未经身份验证或不是其所有者时返回 401 似乎是有意义的。

但是这可能不是一个好主意，因为一个未经认证的用户现在可以做这样的事情:

```
$ for i in `seq 300 305`; do curl -sI https://exammple.com/api/accounts/${i} | head -n 1; done
HTTP/1.1 404 Not Found
HTTP/1.1 401 Unauthorized
HTTP/1.1 401 Unauthorized
HTTP/1.1 404 Not Found
HTTP/1.1 401 Unauthorized
HTTP/1.1 404 Not Found 
```

Enter fullscreen mode Exit fullscreen mode

这个未经身份验证的用户现在已经知道了一些事情:没有 id 为 300、303 和 305 的帐户，但是有 id 为 301、302 和 304 的帐户。当然，使用更大范围的 id 运行这个命令会揭示更多的信息。

这有多糟糕？这取决于很多其他因素。在这一点上，我们最多只能说，它并没有明显的可怕。但是，这仍然可以用来学习其他东西——例如，新帐户创建的速度，这可能会引起竞争对手的兴趣。

重要的一点是，这个 API 会将信息泄露给没有合法理由获取这些信息的用户。这很容易解决:即使账户确实存在，我们也应该返回 404。

## 结论

当我们关注显而易见的安全问题——保持帐户余额的秘密，防止未经授权的交易——时，很容易忽略我们的系统行为是如何泄漏敏感信息的。

攻击者的目标是通过观察我们系统的行为来获得关于系统状态的信息。因此，我们的工作是确保系统的行为(从攻击者的角度来看)一致，而不管其状态如何。请记住:未经身份验证的用户不是唯一的潜在攻击者。即使是已登录的客户，对他们不拥有的帐户的请求也会得到 404 响应。