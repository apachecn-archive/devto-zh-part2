# åœ¨ Python ä¸­åè°ƒæ•°æ®ç±»å’Œå±æ€§

> åŸæ–‡:[https://dev . to/florimondmanca/reconciling-data classes-and-properties-in-python-4 OGC](https://dev.to/florimondmanca/reconciling-dataclasses-and-properties-in-python-4ogc)

<small>*åŸè½½äº 2018 å¹´ 10 æœˆ 6 æ—¥ blog.florimondmanca.comã€‚*</small>

*å¦‚æœç­‰ä¸åŠ TLï¼›åšå£«ï¼Œè·³åˆ°æœ¬æ–‡æœ«å°¾çš„[ç»éªŒæ•™è®­](#lessons-learned)ã€‚*

æˆ‘ä¸€ç›´åœ¨ç© Python 3.7 çš„[æ•°æ®ç±»](https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass)â€”â€”åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä»¬è¶…çº§æ£’ã€‚åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œå®ƒä»¬éå¸¸ç›´è§‚ï¼Œæ˜“äºä½¿ç”¨å’Œå®šåˆ¶ã€‚

ç„¶è€Œï¼Œæœ‰ä¸€ä»¶äº‹æˆ‘ä¸€ç›´åœ¨çº ç»“ï¼Œå´æ‰¾ä¸åˆ°åœ¨çº¿å¸®åŠ©ï¼Œé‚£å°±æ˜¯**åœ¨ dataclasses** ä¸Šå®ç° Python å±æ€§ã€‚å¾ˆæœ‰å¯èƒ½â€”â€”æˆ‘å¹¶ä¸å­¤å•ã€‚

æ‰€ä»¥æˆ‘æ‰å†³å®šä¸€åŠ³æ°¸é€¸çš„è§£å†³é—®é¢˜ã€‚æˆ‘æƒ³å¼„æ¸…æ¥šå¦‚ä½•åè°ƒæ•°æ®ç±»å’Œå±æ€§ã€‚

å› æ­¤ï¼Œæˆ‘åœ¨ç”µè„‘å‰åä¸‹ï¼Œå¯åŠ¨äº†ä¸€ä¸ªç¿»è¯‘ç¨‹åºï¼Œå†™ä¸‹äº†æˆ‘å¯»æ‰¾è§£å†³æ–¹æ¡ˆçš„è¿‡ç¨‹ã€‚ç»è¿‡ä¸€å¤œçš„åå¤è¯•éªŒå’Œä¸€äº›æªè¾ä¸Šçš„æ”¹è¿›ï¼Œç»“æœå°±æ˜¯è¿™ç¯‡åšæ–‡ï¼

ä½œä¸ºä¸€ä¸ªä»¤äººæ„‰å¿«çš„å‰¯ä½œç”¨ï¼Œæ‚¨å°†åœ¨ä¸­çœ‹åˆ° dataclasses çš„è®¸å¤šåŠŸèƒ½ã€‚æˆ‘å°†ä»å¿«é€Ÿæ¦‚è¿°æ•°æ®ç±»å¼€å§‹ï¼Œç„¶åæˆ‘ä»¬å°†è®¨è®ºä»£ç ã€‚

å½“ç„¶ï¼Œä½ ä¼šåœ¨ [GitHub](https://github.com/florimondmanca/dataclasses-properties) ä¸Šæ‰¾åˆ°æ”¯æŒè¿™ç¯‡æ–‡ç« çš„æ‰€æœ‰ä»£ç ã€‚

## [](#dataclasses-a-10000ft-overview)æ•°æ®ç±»:ä¸€ä¸‡è‹±å°ºçš„æ¦‚è¿°

ç®€å•åœ°è¯´ï¼Œæ•°æ®ç±»æ˜¯ç”¨æ¥ä¿å­˜æ•°æ®çš„**ç±»ã€‚ä»–ä»¬åœ¨ [PEP-557](https://www.python.org/dev/peps/pep-0557/#rationale) ä¸­çš„è§„èŒƒæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®:æˆ‘ä»¬ç¼–å†™çš„è®¸å¤šç±»ä»…ä»…è¢«ç”¨ä½œå¯ç¼–è¾‘çš„æ•°æ®å®¹å™¨ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ä¼šèŠ±æ—¶é—´ç¼–å†™æ ·æ¿ä»£ç ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä¸€ä¸ªä¸‘é™‹çš„`__init__()`æ–¹æ³•ï¼Œå®ƒæœ‰å¤§é‡çš„å‚æ•°å’ŒåŒæ ·å¤šçš„è¡Œæ¥å­˜å‚¨å®ƒä»¬ä½œä¸ºå±æ€§â€”â€”æ›´ä¸ç”¨è¯´å¤„ç†[é»˜è®¤å‚æ•°](https://dev.to/florimondmanca/python-mutable-defaults-are-the-source-of-all-evil-6kk) â€¦**

<figure>

[![](../Images/e9d48b066cfb4a92a0009010f82917e9.png)T2ã€‘](https://i.giphy.com/media/3scoQYue48MeZL2bBi/giphy.gif)

<figcaption>Dataclasses, featuring Raymond Hettinger in a GIF.</figcaption>

</figure>

è€Œä¸”æœ‰ï¼ç­”æ¡ˆæ˜¯: **dataclasses** ã€‚ğŸ‰

Python åœ¨åå‰¯å…¶å®çš„[æ•°æ®ç±»](https://docs.python.org/3/library/dataclasses.html)æ¨¡å—ä¸­å®ç°äº†æ•°æ®ç±»ï¼Œå…¶è¶…çº§æ˜æ˜Ÿæ˜¯`@dataclass`è£…é¥°å™¨ã€‚è¿™ä¸ªè£…é¥°å™¨å®é™…ä¸Šåªæ˜¯ä¸€ä¸ª**ä»£ç ç”Ÿæˆå™¨**ã€‚å®ƒåˆ©ç”¨ Python çš„ç±»å‹æ³¨é‡Š(å¦‚æœä½ ä»ç„¶ä¸ä½¿ç”¨å®ƒä»¬ï¼Œ[ä½ çœŸçš„åº”è¯¥](https://dev.to/florimondmanca/why-i-started-using-python-type-annotations--and-why-you-should-too-2a3m))æ¥**è‡ªåŠ¨ç”Ÿæˆæ ·æ¿ä»£ç **å¦åˆ™ä½ å¿…é¡»è‡ªå·±æœºæ¢°åœ°é”®å…¥ã€‚

ä½œä¸ºæ¯”è¾ƒï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨å¸¸è§„çš„ç±»å£°æ˜
åˆ›å»ºä¸€ä¸ªå¸¦æœ‰`wheels`å±æ€§çš„`Vehicle`ç±»

```
class Vehicle:
    def __init__(self, wheels: int):
        self.wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼ŒçœŸçš„ã€‚ç°åœ¨ï¼Œ`@dataclass`ç‰ˆæœ¬:

```
# 0_initial.py from dataclasses import dataclass

@dataclass
class Vehicle:
    wheels: int 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¿¡ä¸ä¿¡ç”±ä½ â€”â€”è¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µæ˜¯ä¸¥æ ¼ç­‰ä»·çš„ï¼è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªèƒœåˆ©ï¼Œå› ä¸ºé™¤äº†`__init__()`ï¼Œ`@dataclass`å…è´¹äº§ç”Ÿäº†ä¸€å †é¢å¤–çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬ä¸€ä¸ªè‹±ä¿Šçš„`__repr__()` :

```
>>> car = Vehicle(wheels=4)
>>> car
Vehicle(wheels=4) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç®€è€Œè¨€ä¹‹ï¼Œdataclasses æ˜¯ä¸€ç§ç®€å•ã€ä¼˜é›…ã€Pythonic å¼çš„åˆ›å»ºä¿å­˜æ•°æ®çš„ç±»çš„æ–¹æ³•ã€‚ğŸ

ä½†æ˜¯â€¦

## [](#the-problem)é—®é¢˜

å½“è·å–/è®¾ç½®å±æ€§æ—¶ï¼Œæˆ‘æœ‰æ—¶æ±‚åŠ©äº`@property`è£…é¥°å™¨æ¥å®ç°ç‰¹å®šçš„é€»è¾‘ã€‚è¿™å°±æ˜¯ Pythonic å®ç° getters å’Œ setters çš„æ–¹å¼ã€‚

åŸºäºå‰é¢çš„`Vehicle`ç±»ï¼Œæˆ‘å°†æŠŠ`wheels`å±æ€§è®¾ä¸ºç§æœ‰ï¼Œå¹¶åœ¨å®ƒä¸Šé¢æ”¾ä¸€ä¸ª`@property`:

```
class Vehicle:

    def __init__(self, wheels: int):
        self._wheels = wheels
        # note the underscore â€” it's now private! ğŸ‘» 
    @property
    def wheels(self) -> int:
        print('getting wheels')
        return self._wheels

    @wheels.setter
    def wheels(self, wheels: int):
        print('setting wheels to', wheels)
        self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹é¢æ˜¯å®ƒçš„æ ·å­:

```
>>> car = Vehicle(wheels=4)
>>> car.wheels = 3
setting wheels to 3
>>> car.wheels
getting wheels
3
>>> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨æ•°æ®ç±»ä¸Šå®ç°è¿™æ ·çš„å±æ€§ï¼Ÿ

## [](#wait-so-this-is-the-problem)ç­‰ç­‰ï¼Œé‚£ä¹ˆ*è¿™ä¸ª*æ˜¯é—®é¢˜å—ï¼Ÿ

ä½ å¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾®ä¸è¶³é“çš„é—®é¢˜ã€‚è¯·æ³¨æ„ï¼Œ**è¿™å¯ä¸æ˜¯å°äº‹**ã€‚

æ•°æ®ç±»ä¸ºæ‚¨ç”Ÿæˆäº†`__init__()`æ–¹æ³•â€”â€”è¿™å¾ˆå¥½ã€‚ä»–ä»¬ç”šè‡³æä¾›äº†ä¸€ä¸ª`__post_init__()`é’©å­æ–¹æ³•ï¼Œä»¥é˜²ä½ æƒ³åšæ›´å¤šçš„åˆå§‹åŒ–å·¥ä½œ(å‚è§[ååˆå§‹åŒ–å¤„ç†](https://docs.python.org/3/library/dataclasses.html#post-init-processing))ã€‚

ç„¶è€Œï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½åƒæ™®é€šç±»ä¸€æ ·åšåŒæ ·çš„äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠä¸€ä¸ªå…¬å…±çš„å‚æ•°(ä¾‹å¦‚`wheels`)å­˜å‚¨åˆ°ä¸€ä¸ªç§æœ‰çš„å±æ€§(`_wheels`)ä¸­ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ„å»ºä¸€ä¸ª`@property`ã€‚

è¿™å°±æ˜¯é—®é¢˜çš„æ¥æºã€‚è€å®è¯´ï¼Œè¿™è®©æˆ‘æœ‰ç‚¹å¤´ç–¼ã€‚

å› ä¸ºæˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜çš„è§£å†³å¾ˆæœ‰è¶£ï¼Œæ‰€ä»¥æˆ‘å°†å¸¦æ‚¨è¿ç»­å°è¯• 5 æ¬¡ï¼Œä»¥æ­£ç¡®åœ°åœ¨`Vehicle`ç±»çš„ dataclass ç‰ˆæœ¬ä¸Šå®ç°è¯¥å±æ€§ã€‚

## [](#attempt-1-declaring-a-private-field)å°è¯• 1:å£°æ˜ç§æœ‰å­—æ®µ

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¿æŒç®€å•ã€‚æˆ‘ä»¬å¸Œæœ›å°†`wheels`å­˜å‚¨åœ¨ç§æœ‰å­—æ®µä¸­ï¼Œå¹¶åœ¨`@property`ä¸­ä½¿ç”¨å®ƒï¼Œå¯¹å—ï¼Ÿé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç®€å•åœ°åœ¨æ•°æ®ç±»ä¸Šå£°æ˜ä¸€ä¸ª`_wheels`å­—æ®µå‘¢ï¼Ÿ

```
# 1_private_field.py from dataclasses import dataclass

@dataclass
class Vehicle:
    _wheels: int

    # wheels @property as before 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸èµ·ä½œç”¨â€”â€”å¦åˆ™è¿™ç¯‡åšæ–‡å°±æ²¡ä»€ä¹ˆç”¨äº†ï¼ğŸ˜™

åŸå› æ˜¯å› ä¸ºæ„é€ å‡½æ•°ç°åœ¨éœ€è¦ä¸€ä¸ª`_wheels`å‚æ•°ï¼Œè€Œä¸æ˜¯`wheels`ã€‚

```
>>> car = Vehicle(wheels=4)
Traceback (most recent call last)
<ipython-input-3-9c9de8fb1422> in <module>()
----> 1 car = Vehicle(wheels=4)
TypeError: __init__() got an unexpected keyword argument 'wheels' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…¬å¹³åœ°è¯´ï¼Œè¿™åªæ˜¯åœ¨åšå®ƒçš„å·¥ä½œã€‚ç„¶è€Œï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

## [](#attempt-2-make-use-of-raw-initvar-endraw-)å°è¯•äºŒ:åˆ©ç”¨`InitVar`

å¦‚æœæ‚¨é€šè¯»æ–‡æ¡£ï¼Œæ‚¨å°†äº†è§£åˆ°`InitVar`å…è®¸æ‚¨å®ç°[ä»…åˆå§‹åŒ–å˜é‡](https://docs.python.org/3/library/dataclasses.html#init-only-variables)ã€‚è¿™äº›å˜é‡å¯ä»¥ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œä½†ä¸ä¼šå­˜å‚¨åœ¨ç±»çš„å±æ€§ä¸­ã€‚ç›¸åï¼Œå˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™`__post_init__()`ã€‚

ä¸ºä»€ä¹ˆä¸ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ª init ä¸“ç”¨çš„`wheels`å˜é‡ï¼Œå¹¶å°†å®ƒå­˜å‚¨åœ¨ä¸€ä¸ª`_wheels`å­—æ®µä¸­å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç»™åè€…ä¸€ä¸ªç¼ºçœå€¼(ä¾‹å¦‚`None`ï¼Œè¿™æ ·å®ƒå°±ä¸æ˜¯æ„é€ å‡½æ•°æ‰€éœ€è¦çš„:

```
# 2_initvar.py from dataclasses import dataclass, InitVar

@dataclass
class Vehicle:

    wheels: InitVar[int]
    _wheels: int = None  # default given => not required in __init__() 
    def __post_init__(self, wheels: int):
        self._wheels = wheels

    # wheels @property as before 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å½“ç„¶ï¼Œ`__init__()`ç°åœ¨éœ€è¦ä¸€ä¸ª`wheels`å‚æ•°è€Œä¸æ˜¯`_wheels`ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

ç„¶è€Œï¼Œ`@dataclass`ç°åœ¨ä½¿ç”¨`_wheels`ç”Ÿæˆå…¶ä»–æ ·æ¿ä»£ç å’Œé­”æœ¯æ–¹æ³•ï¼Œè¿™æ˜¯æœ‰é—®é¢˜çš„ã€‚

```
>>> car = Vehicle(wheels=4)
setting wheels to 4
>>> car
Vehicle(_wheels=4)  # ğŸ˜• 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#attempt-3-make-use-of-raw-field-endraw-)å°è¯•ä¸‰:åˆ©ç”¨`field()`

æ·±å…¥ç ”ç©¶æ–‡æ¡£ï¼Œæˆ‘å‘ç°å¯ä»¥ä½¿ç”¨ [field()](https://docs.python.org/3/library/dataclasses.html#dataclasses.field) å‡½æ•°å¾®è°ƒå­—æ®µç”Ÿæˆè¡Œä¸ºã€‚æ‚¨å¯ä»¥å‘å®ƒä¼ é€’ä¸€ä¸ª`default`å€¼ï¼Œå®ƒæ¥å—ä¸€ä¸ª`repr`å‚æ•°æ¥æ§åˆ¶è¯¥å­—æ®µæ˜¯å¦åº”è¯¥åŒ…å«åœ¨ç”Ÿæˆçš„`__repr__()`ä¸­ã€‚ä¸‹é¢æ˜¯å®ƒåœ¨`_wheels` :
ä¸Šä½¿ç”¨æ—¶çš„æ ·å­

```
# 3_field.py from dataclasses import dataclass, field

@dataclass
class Vehicle:

    wheels: InitVar[int]
    _wheels: int = field(default=None, repr=False)

    # __post_init__() as before
    # wheels @property as before 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¾ˆå¥½â€”â€”æˆ‘ä»¬ä¸å†å°†`_wheels`åŒ…å«åœ¨`__repr__()`ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ²¡æœ‰`wheels`ï¼

```
>>> car = Vehicle(wheels=4)
setting wheels to 4
>>> car
Vehicle()  # Where is `wheels=4`? ğŸ˜•ğŸ˜•ğŸ˜• 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#attempt-4-make-raw-wheels-endraw-a-proper-field)å°è¯•å››:å°†`wheels`åšæˆåˆé€‚çš„å­—æ®µ

åœ¨ä¹‹å‰çš„å°è¯•ä¸­ï¼Œ`wheels`æ˜¯ä¸€ä¸ª`InitVar` â€”è€Œä¸æ˜¯ä¸€ä¸ªå­—æ®µã€‚è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬å°†å®ƒå£°æ˜ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å­—æ®µã€‚åœ¨æ„é€ å‡½æ•°ä¸­ä¼ é€’å®ƒæ˜¯å¯èƒ½çš„ï¼Œè¿™ä¸€æ¬¡å®ƒåº”è¯¥åŒ…å«åœ¨`__repr__()`ä¸­ã€‚

å¥½çš„ä¸€é¢æ˜¯ï¼Œç¨ååœ¨ç±»ä¸­å£°æ˜çš„`wheels`çš„`@property`å®šä¹‰ä¸ä¼šå¹²æ‰°`@dataclass`çš„ç”Ÿæˆè¿‡ç¨‹â€” *ï¼Œå› ä¸ºå®ƒä¸æ˜¯ç±»å‹æ³¨é‡Š*ï¼Œè€Œè¿™æ­£æ˜¯`@dataclass`ç”Ÿæˆå­—æ®µæ‰€ä¾èµ–çš„ã€‚

è¿™å¯èƒ½å¼€å§‹æœ‰ç‚¹å¤æ‚ï¼Œæ‰€ä»¥è®©æˆ‘ç»™ä½ çœ‹ä¸€äº›ä»£ç ã€‚è¿™æ¬¡æˆ‘å°†ä¸º`wheels`å®Œæ•´å†ç°`@property`:

```
# 4_wheels_field.py from dataclasses import dataclass, field

@dataclass
class Vehicle:

    wheels: int  # Now a regular dataclass field 
    # The rest just as before: 
    _wheels: int = field(default=None, repr=False)

    def __post_init__(self):
        # Note: wheels is not passed as an argument
        # here anymore, because it is not an
        # `InitVar` anymore.
        self._wheels = self.wheels  # (1) 
    @property
    def wheels(self) -> int:
        print('getting wheels')
        return self._wheels

    @wheels.setter
    def wheels(self, wheels: int):
        print('setting wheels to', wheels)
        self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹èµ·æ¥æˆ‘ä»¬æ­£åœ¨åˆ°è¾¾é‚£é‡Œï¼Œä¸æ˜¯å—ï¼Ÿ

ä¸å¹¸çš„æ˜¯ï¼Œä¸å°½ç„¶ã€‚ğŸ˜è¿™ä¸ªå®ç°ä¸­æœ‰ä¸€ä¸ªé—®é¢˜ã€‚

å®é™…ä¸Šï¼Œæ‚¨å¯èƒ½è®¤ä¸ºç¬¬`(1)`è¡Œå°†èµ‹äºˆæ„é€ å‡½æ•°çš„`wheels`çš„å€¼(å­˜å‚¨åœ¨`self.wheels`ä¸­)æ”¾å…¥`_wheels`ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨`Vehicle(wheels=4)`ä¼šå¾—åˆ°`_wheels == 4`ã€‚å¯æ‚²çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ï¼

åŸå› å¦‚ä¸‹:æ‰§è¡Œ`__post_init__()`æ—¶ï¼Œ`self.wheels`æ˜¯`wheels`å±æ€§çš„ getter è¿”å›çš„å€¼â€” *è€Œä¸æ˜¯*åœ¨`__init__()`æœŸé—´æœ€åˆå­˜å‚¨çš„å€¼ï¼è€Œé‚£ä¸ª getter è¿”å›`self._wheels`ï¼Œé»˜è®¤æ˜¯`None`ã€‚

æˆ‘çŸ¥é“ï¼Œç°åœ¨ä¸€åˆ‡éƒ½ä¹±äº†å¥—ï¼Œä½†è¯·å¿è€ä¸€ä¸‹

```
>>> car = Vehicle(wheels=4)
setting wheels to 4
getting wheels  # hint: this is (1) being executed >>> print(car.wheels)
getting wheels
None  # nope, nothing in thereâ€¦ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ ä»”ç»†æƒ³æƒ³ï¼Œæˆ‘ä»¬åœ¨(1)ä¸­æ‰€åšçš„åªæ˜¯ç”¨å®ƒè‡ªå·±çš„å€¼æ›¿æ¢`_wheels`ã€‚å¦‚æœä½ é—®æˆ‘ï¼Œæˆ‘ä¼šè¯´è¿™æ¯«æ— ç”¨å¤„ã€‚å¦‚æœæˆ‘ä»¬ç”šè‡³æ²¡æœ‰å®ç°`__post_init__()`ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœã€‚

å’„ï¼é‚£ä¹ˆæˆ‘ä»¬èƒ½åšä»€ä¹ˆå‘¢ï¼ŸğŸ˜©

è¿˜å¥½æœ‰å¸Œæœ›ï¼

## [](#attempt-5-exclude-raw-wheels-endraw-from-the-constructor)å°è¯• 5:ä»æ„é€ å‡½æ•°ä¸­æ’é™¤`_wheels`

è®©æˆ‘è­¦å‘Šä½ â€”â€”è¿™ç¬¬äº”æ¬¡ä¹Ÿæ˜¯æœ€åä¸€æ¬¡å°è¯•ä¼šæˆåŠŸï¼Œæˆ‘é©¬ä¸Šä¼šè§£é‡Šä¸ºä»€ä¹ˆä¼šæˆåŠŸçš„åŸå› ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ æ„Ÿåˆ°æ‚²ä¼¤æ˜¯å¯¹çš„â€”â€”æˆ‘è‡ªå·±ä¹Ÿæ„Ÿåˆ°æ‚²ä¼¤ã€‚ä½†æ˜¯ä¸è¦å®³æ€•ï¼æ–‡æ¡£ä¸­æœ‰ä¸€æ ·ä¸œè¥¿æˆ‘ä»¬è¿˜æ²¡æœ‰å°è¯•è¿‡ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»ä½¿ç”¨`field(default=None, repr=False)`å£°æ˜äº†`_wheels`å±æ€§ã€‚åœ¨è¿™é‡Œä½¿ç”¨`default=None`æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿçœç•¥åœ¨æ„é€ å‡½æ•°ä¸­ä¸º`_wheels`ä¼ é€’ä¸€ä¸ªå€¼â€”â€”åœ¨`__init__()`æœŸé—´å®ƒå°†è¢«èµ‹äºˆ`None`çš„å€¼ã€‚ä½†æ˜¯ï¼Œä»ç„¶å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ç»™å®ƒä¸€ä¸ªå€¼ï¼Œä¸€åˆ‡éƒ½ä¼šæŒ‰é¢„æœŸè¿›è¡Œ:

```
>>> car = Vehicle(wheels=4, _wheels=3)
setting wheels to 4
getting wheels
>>> car.wheels
getting wheels
3 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‚£ä¹ˆï¼Œæˆ‘ä»¬æƒ³åŠæ³•ä»æ„é€ å‡½æ•°ä¸­ç§»é™¤`_wheels`å‚æ•°æ€ä¹ˆæ ·ï¼Ÿè¿™èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜å—ï¼Ÿ(*å‰§é€é¢„è­¦:ä¼šçš„ã€‚*

æ‚¨çŒœæ€ä¹ˆç€:`field()`æ¥å—äº†ä¸€ä¸ª`init`å‚æ•°æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚`field()`ä¸Šçš„æ–‡ä»¶å†™é“:

> `init`:å¦‚æœä¸ºçœŸ(é»˜è®¤)ï¼Œè¯¥å­—æ®µä½œä¸ºå‚æ•°åŒ…å«åœ¨ç”Ÿæˆçš„`__init__`æ–¹æ³•ä¸­ã€‚

å¬èµ·æ¥å¾®ä¸è¶³é“ï¼Œå¯¹å—ï¼Ÿå¥½å§ï¼Œè®©æˆ‘ä»¬è¯•ç€åœ¨`_wheels`ä¸Šä½¿ç”¨å®ƒ(æˆ‘å»æ‰äº†`__post_init__()`é’©å­ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²ç»è¡¨æ˜å®ƒå®é™…ä¸Šæ˜¯æ²¡ç”¨çš„):

```
# 5_init_false.py from dataclasses import dataclass, field

@dataclass
class Vehicle:

    wheels: int
    _wheels: int = field(init=False, repr=False)

    @property
    def wheels(self) -> int:
        print('getting wheels')
        return self._wheels

    @wheels.setter
    def wheels(self, wheels: int):
        print('setting wheels to', wheels)
        self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ çŒœæ€ä¹ˆç€ï¼Ÿè¿™åˆšåˆšè§£å†³äº†æˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜ã€‚

å› ä¸ºæˆ‘ä»¬ç”¨äº†`init=False`ï¼Œæ‰€ä»¥`@dataclass`ç”Ÿæˆçš„æ„é€ å‡½æ•°æ ¹æœ¬ä¸ä¼šåˆå§‹åŒ–`_wheels`ã€‚

**ç„¶è€Œ**ï¼Œå®ƒ*ä¼š*ç”¨ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å€¼åˆå§‹åŒ–`wheels`ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæå–ç”Ÿæˆçš„ä»£ç ï¼Œé‚£ä¹ˆ`__init__()`ä¸­çš„ä¸€æ¡æŒ‡ä»¤åº”è¯¥æ˜¯è¿™æ ·çš„:

```
self.wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œä½ å‘Šè¯‰æˆ‘â€”â€”è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

æ˜¯çš„ï¼Œæ²¡é”™ã€‚å®ƒå°†æ‰§è¡Œ setterï¼ğŸ™€

çœ‹å•Šï¼å®é™…ä¸Šï¼Œä»ç¬¬ 4 æ¬¡å°è¯•å¼€å§‹ï¼Œæˆ‘ä»¬å°±åœ¨ setter ä¸­çœ‹åˆ°äº† print è¯­å¥ï¼

```
>>> car = Vehicle(wheels=4)
setting wheels to 4  # the `wheels` setter being called 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘æé†’ä½ ä¸€ä¸‹é‚£ä¸ª setter çš„ä»£ç :

```
@wheels.setter
def wheels(self, wheels: int):
    print('setting wheels to', wheels)
    self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒè®¾ç½®äº†`_wheels`çš„å€¼ï¼

å› æ­¤ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ä¼ é€’çš„`wheels`çš„å€¼è¢«æ”¾å…¥`_wheels`ä¸­ï¼Œè€Œä¸æ˜¯å…¶ä»–åœ°æ–¹ï¼Œå› ä¸ºåœ¨ç”Ÿæˆç±»ä¹‹åï¼Œ`wheels`åªå¼•ç”¨`@property`ï¼Œè€Œä¸æ˜¯ dataclass ä¸Šçš„å­—æ®µã€‚

ä»”ç»†æƒ³æƒ³ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬åœ¨å¥½çš„å¸¸è§„ç±»ä¸Šå®ç°å±æ€§æ—¶æ‰€åšçš„äº‹æƒ…ã€‚è®°å¾—å—ï¼Ÿ

```
class Vehicle:

    def __init__(self, wheels: int):
        self._wheels = wheels
        # This is equivalent to calling:
        # `self.wheels = wheels`
        # which *is* what the __init__() method
        # now generated by @dataclass actually does. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è­¦å‘Š:**è¿™ç§æ–¹æ³•åªé€‚ç”¨äºå±æ€§çš„ setter è¢«å®ç°çš„æƒ…å†µ**ã€‚å¦‚æœæˆ‘ä»¬åªå®ç°äº†ä¸€ä¸ª getter(å³åˆ›å»ºä¸€ä¸ªåªè¯»å­—æ®µ)ï¼Œ`__init__()`æ–¹æ³•å°†ä¸èƒ½åˆ†é…å±æ€§ï¼Œå¹¶ä¸”ä¼šå´©æºƒã€‚è¿™æ˜¯æœ‰æ„çš„è¡Œä¸ºï¼Œå› ä¸º**æ•°æ®ç±»è¢«è®¾è®¡æˆå¯ç¼–è¾‘çš„æ•°æ®å®¹å™¨**ã€‚å¦‚æœä½ çœŸçš„éœ€è¦åªè¯»å­—æ®µï¼Œä½ é¦–å…ˆå°±ä¸åº”è¯¥æ±‚åŠ©äºæ•°æ®ç±»ã€‚ä¹Ÿè®¸`NamedTuple` s æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©â€”â€”å®ƒä»¬æ˜¯æ•°æ®ç±»çš„åªè¯»ç­‰ä»·ç‰©ã€‚

æ€»ä¹‹ï¼Œé•¿è¯çŸ­è¯´â€¦

## [](#success)æˆåŠŸï¼

æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å®ç°äº†æ•°æ®ç±»çš„å±æ€§ã€‚ğŸ‰

<figure>

[![](../Images/d2cf0e3f7d2a15008aee4f36a7c5df44.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iwzxCcjO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgflip.com/2jhkbw.jpg)

<figcaption>Memes will never let you down.</figcaption>

</figure>

è€å®è¯´ï¼Œ**å‡ºä¹æ„æ–™çš„ä¸å®¹æ˜“**ã€‚æˆ‘ä»¬å·²ç»è¿›è¡Œäº†äº”æ¬¡ä¸åŒçš„å°è¯•ï¼Œæµè§ˆäº†æ–‡æ¡£ï¼Œå¹¶ç…è´¹è‹¦å¿ƒåœ°ç¼–å†™äº†é€šå‘æ•°æ®ç±»å±æ€§çš„ä»£ç ã€‚

é‚£ä¹ˆåœ¨æ‰€æœ‰è¿™äº›äº‰è®ºä¹‹åï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥è‡³å°‘æ¨å¯¼å‡ºä¸€ä¸ªåœ¨æ•°æ®ç±»ä¸Šå®ç°å±æ€§çš„å¿«é€Ÿæ–¹æ³•ï¼Ÿ

ç­”æ¡ˆæ˜¯:æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ã€‚âœŒï¸

## [](#lessons-learned)å¸å–æ•™è®­

æ‚¨æ˜¯å¦æ³¨æ„åˆ°äº†åœ¨å¸¸è§„ç±»å’Œæ•°æ®ç±»ä¸Šä½¿ç”¨`@property`çš„æ¨¡å¼ï¼Ÿ

çœ‹ï¼Œè¿™é‡Œæ˜¯å¸¸è§„ç±»ç‰ˆæœ¬:

```
class Vehicle:

    def __init__(self, wheels: int):
        self._wheels = wheels

    @property
    def wheels(self) -> int:
        return self._wheels

    @wheels.setter
    def wheels(self, wheels: int):
        self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å’Œ dataclass ç‰ˆæœ¬ï¼Œä½¿ç”¨ diff è¯­æ³•æ¥çªå‡ºå·®å¼‚:

```
+ from dataclasses import dataclass, field 
+ @dataclass
  class Vehicle:

+     wheels: int
+     _wheels: field(init=False, repr=False) 
-     def __init__(self, wheels: int):
-         self._wheels = wheels 
      @property
      def wheels(self) -> int:
          return self._wheels

      @wheels.setter
      def wheels(self, wheels: int):
          self._wheels = wheels 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”¨ç®€å•çš„è¯­è¨€å†™ç»™ä½ ä»¬è¿™äº›æ–‡å­¦æ€ªèƒ:

> **å¦‚ä½•åœ¨æ•°æ®ç±»ä¸Šå®ç°å±æ€§:**
> 
> 1.  ç§»é™¤`__init__()`
> 2.  å°†å±æ€§å£°æ˜ä¸ºå­—æ®µ
> 3.  ä½¿ç”¨`field(init=False, repr=False)`æ·»åŠ ç›¸å…³çš„ç§æœ‰å˜é‡ã€‚

## [](#way-to-go)å†¤å®¶è·¯çª„ï¼

å¦‚æœä½ è®¾æ³•è¯»åˆ°è¿™é‡Œï¼Œæ­å–œä½ ï¼è¿™ç¯‡åšå®¢æ–‡ç« æ¶‰åŠäº†ä¸€ä¸ªéå¸¸å…·ä½“å’ŒæŠ€æœ¯æ€§çš„è¯é¢˜ï¼Œä½†æ˜¯æˆ‘åœ¨æ’°å†™è¿™ç¯‡æ–‡ç« å’Œå¼„æ¸…æ¥šå¦‚ä½•å®ç°æ•°æ®ç±»å±æ€§æ—¶è·å¾—äº†å¾ˆå¤šä¹è¶£ã€‚

å¯¹äºé‚£äº›æƒ³çŸ¥é“â€”â€”é˜¿å¸•å¥‡å¡å¤«å¡ç³»åˆ—ä»åœ¨ç»§ç»­ï¼æˆ‘è§‰å¾—å°å°çš„ä¼‘æ¯ä¸€ä¸‹ä¸ä¼šæœ‰ä»€ä¹ˆåå¤„ï¼Œæˆ‘è§‰å¾—è¿™ç»™äº†æˆ‘ä¸€ä¸ªæœºä¼šå»å†™ä¸€äº›è‡ªå‘çš„ä¸œè¥¿ã€‚

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæ­£å¦‚åœ¨ç®€ä»‹ä¸­æåˆ°çš„ï¼Œä½ å¯ä»¥åœ¨ [GitHub](https://github.com/florimondmanca/dataclasses-properties) ä¸Šæ‰¾åˆ°æ‰€æœ‰ä»£ç ã€‚ä¸‹æ¬¡è§ï¼ğŸ’»

## [](#stay-in-touch)ä¿æŒè”ç³»ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šæ‰¾åˆ°æˆ‘ï¼Œè·å–æ›´æ–°ã€å…¬å‘Šå’Œæ–°é—»ã€‚ğŸ¤