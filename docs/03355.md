# åœ¨ Gatsby ç«™ç‚¹ä¸Šå®ç° i18n

> åŸæ–‡:[https://dev.to/smakosh/implement-i18n-to-a-gatsby-site-5ala](https://dev.to/smakosh/implement-i18n-to-a-gatsby-site-5ala)

> è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨ [Obytes åšå®¢](https://www.obytes.com/blog/2018/implement-i18n-to-gatsby/)ä¸Šã€‚

[![i18n on gatsby](../Images/23d2f1349c47f7e49092bacad0b0d38c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2B4YEeMg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://d33wubrfki0l68.cloudfront.net/f5e077cd6bfbfc8c5f1d97953f0ea318ca0943ff/70e5e/assets/images/blog/i18n-gatsby/i18n.png)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ react-intl å’Œ [React context API](https://reactjs.org/docs/context.html) å¯¹ä¸€ä¸ª [Gatsby](https://gatsbyjs.org) ç«™ç‚¹å®ç° i18n(å›½é™…åŒ–),åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åªæ¶‰åŠè‹±è¯­å’Œé˜¿æ‹‰ä¼¯è¯­ï¼Œä½†æ˜¯å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æ·»åŠ æ›´å¤šçš„è¯­è¨€ï¼Œåœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆè®¡åˆ’æˆ‘ä»¬æƒ³è¦å¦‚ä½•å®ç°å®ƒã€‚

1-æ£€æµ‹ç”¨æˆ·çš„é»˜è®¤è¯­è¨€

2-æ ¹æ®ç”¨æˆ·çš„é»˜è®¤è¯­è¨€è‡ªåŠ¨åˆ‡æ¢è¯­è¨€ã€å†…å®¹æ–¹å‘å’Œå­—ä½“ç³»åˆ—

3-ç”¨æˆ·ä»ç„¶å¯ä»¥é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„è¯­è¨€

è®©æˆ‘ä»¬ä»ä½¿ç”¨ä»–ä»¬çš„ CLI å·¥å…·
ç”Ÿæˆä¸€ä¸ªæ–°çš„ Gatsby ç«™ç‚¹å¼€å§‹

```
gatsby new gatsby-i18n-example && cd gatsby-i18n-example/ 
```

ç„¶åæˆ‘ä»¬å°†å®‰è£…æˆ‘ä»¬éœ€è¦çš„åº“(æˆ‘ä½¿ç”¨çš„æ˜¯`yarn`ï¼Œä½†ä¹Ÿå¯ä»¥éšæ„ä½¿ç”¨`npm`)

> æˆ‘æ­£åœ¨å®‰è£…[é‡æ–°ç»„åˆ](https://github.com/acdlite/recompose)æ¥å°†é€»è¾‘ä»ç»„ä»¶ä¸­åˆ†ç¦»å‡ºæ¥å¹¶ä¿æŒä»£ç çš„æ•´æ´(å¯ä»¥ä¸ç”¨å®ƒï¼Œä½†æˆ‘ä»¬å¼ºçƒˆæ¨èå®ƒ)ï¼Œä»¥åŠ[æ ·å¼ç»„ä»¶](https://www.styled-components.com/) beta v4 æ¥å¤„ç† js ä¸­çš„ css(å¯ä»¥ä¸ç”¨å®ƒï¼Œä½†æˆ‘ä»¬å¼ºçƒˆæ¨èå®ƒ)å’Œä¸€ä¸ªç®€å•çš„ google fonts gatsby æ’ä»¶`gatsby-plugin-google-fonts`

```
yarn add react-intl recompose styled-components@next babel-plugin-styled-components gatsby-plugin-styled-components gatsby-plugin-google-fonts 
```

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç”¨ä¸€ç§æ›´å¥½çš„æ–¹å¼æ¥ç»„ç»‡æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

```
.
+-- src
    +-- components
    |   |
    |   +-- common
    |   |   +-- Head
    |   |   |   |
    |   |   |   +-- index.jsx
    |   |   +-- Container
    |   |   |   |
    |   |   |   +-- index.jsx
    |   |   +-- Context
    |   |   |   |
    |   |   |   +-- index.jsx
    |   |   +-- Layout
    |   |   |   |
    |   |   |   +-- index.jsx
    |   |   |   +-- Provider.jsx
    |   |   |   +-- layout.css
    |   |   +-- Trigger
    |   |   |   |
    |   |   |   +-- index.jsx
    |   |   +-- index.js
    |   +-- theme
    |   |   +-- Header
    |   |   |   |
    |   |   |   +-- index.jsx
    +-- messages
    |   |
    |   +-- ar.json
    |   +-- en.json
    +-- pages
        |
        +-- index.js
        +-- 404.js
        +-- about.js 
```

è®©æˆ‘ä»¬ä»åœ¨ä¸Šä¸‹æ–‡ç»„ä»¶ä¸­åˆ›å»ºä¸Šä¸‹æ–‡å¼€å§‹ï¼Œå¹¶å°†`en`ä½œä¸ºé»˜è®¤å€¼ã€‚

```
import React from 'react'

export const Context = React.createContext('en') 
```

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹å°†å…¨å±€çŠ¶æ€ä¼ é€’ç»™æ¶ˆè´¹è€…çš„æä¾›è€…ç»„ä»¶ï¼Œæ¶ˆè´¹è€…æ˜¯å®ƒçš„åä»£ã€‚

> [Provider](https://reactjs.org/docs/context.html#provider) æ˜¯ä¸€ä¸ª React ç»„ä»¶ï¼Œå…è®¸æ¶ˆè´¹è€…è®¢é˜…ä¸Šä¸‹æ–‡å˜åŒ–ã€‚

```
import React from 'react'
import { compose, withState, withHandlers, lifecycle } from 'recompose'
import { Context } from '../Context'

const Provider = ({ children, lang, toggleLanguage }) => (
    <Context.Provider value={
        { lang, toggleLanguage: () => toggleLanguage() }
    }>
        {children}
    </Context.Provider>
)

const enhance = compose(
    withState('lang', 'handleLanguage', 'en'),
    withHandlers({
        toggleLanguage: ({ lang, handleLanguage }) => () => {
            if (lang === 'ar') {
                handleLanguage('en')
                localStorage.setItem('lang', 'en')
            } else {
                handleLanguage('ar')
                localStorage.setItem('lang', 'ar')
            }
        }
    }),
    lifecycle({
        componentDidMount() {
            const localLang = localStorage.getItem('lang')
            if (localLang) {
                this.props.handleLanguage(localLang)
            } else {
                this.props.handleLanguage(navigator.language.split('-')[0])
            }
        }
    })
)

export default enhance(Provider) 
```

è¿™å°†åŒ…è£…æˆ‘ä»¬æ‰€æœ‰çš„ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åŒ…å«`lang`çš„å€¼å’Œä¸€ä¸ªåˆ‡æ¢è¯­è¨€çš„å‡½æ•°`toggleLanguage`ï¼Œç»„ä»¶ä¸‹é¢æ˜¯é€»è¾‘ã€‚

æˆ‘ä»¬ç”¨é»˜è®¤å€¼`en`åˆå§‹åŒ–`lang`ï¼Œä½†æ˜¯å½“ç»„ä»¶æŒ‚è½½æ—¶ï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¼šæ”¹å˜ï¼Œæˆ‘ä»¬æ£€æŸ¥ localStorage æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœä¸ºçœŸ:æˆ‘ä»¬å°†å…¶å€¼èµ‹ç»™`lang`çŠ¶æ€ï¼Œå¦åˆ™:æˆ‘ä»¬æ£€æµ‹ç”¨æˆ·æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€ï¼Œå¹¶æ‹†åˆ†è¯¥å€¼ä»¥è·å¾—åŒ…å«è¯¥è¯­è¨€çš„ç¬¬ä¸€é¡¹ã€‚

ç°åœ¨è½¬åˆ°`Layout`ç»„ä»¶ï¼Œå…¶ä¸­:

*   æˆ‘ä»¬å°†å¯¼å…¥è‹±è¯­å’Œé˜¿æ‹‰ä¼¯è¯­çš„ json æ•°æ®
*   å’Œ`IntlProvider`ä¸€èµ·åŒ…è£…æˆ‘ä»¬å°†ä½¿ç”¨`react-intl`å†…ç½®ç»„ä»¶çš„å†…å®¹
*   ä»¥åŠå¯¼å…¥`Context`å¹¶ç”¨å®ƒçš„æ¶ˆè´¹è€…åŒ…è£…æˆ‘ä»¬çš„å†…å®¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®å…¨å±€çŠ¶æ€
*   æœ€åï¼Œæˆ‘ä»¬ç”¨ä¸Šé¢åˆ›å»ºçš„`Provider`åŒ…è£…æ‰€æœ‰ä¸œè¥¿ã€‚

```
import React from 'react'
import styled from 'styled-components'
import ar from 'react-intl/locale-data/ar'
import en from 'react-intl/locale-data/en'
import { addLocaleData, IntlProvider } from 'react-intl'
import localEng from '../../../messages/en.json'
import localAr from '../../../messages/ar.json'
import { Context } from '../Context'
import Provider from './Provider'
import Header from '../../theme/Header'
import './layout.css'

addLocaleData(ar, en)

const Layout = ({ children }) => (
    <Provider>
        <Context.Consumer>
            {({ lang }) => (
                <IntlProvider locale={lang} messages={lang === 'en' ? localEng : localAr}>
                    <Global lang={lang}>
                        <Header />
                        {children}
                    </Global>
                </IntlProvider>
            )}
        </Context.Consumer>
    </Provider>
)

const Global = styled.div`
    font-family: 'Roboto', sans-serif; ${({ lang }) => lang === 'ar' && `
        font-family: 'Cairo', sans-serif;    
    `} `

export { Layout } 
```

æˆ‘ä»¬å¿˜äº†è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`Global`ç»„ä»¶æ¥å¤„ç†å­—ä½“å˜åŒ–ï¼Œæ‰€ä»¥å½“è¯­è¨€è®¾ç½®ä¸ºè‹±è¯­æ—¶ï¼Œå®ƒå°†æ˜¯`Roboto`,å½“è®¾ç½®ä¸ºé˜¿æ‹‰ä¼¯è¯­æ—¶ï¼Œå®ƒå°†æ˜¯`Cairo`ã€‚

ç°åœ¨ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ï¼Œè®©æˆ‘ä»¬ç»™æ ‡é¢˜æ·»åŠ ä¸€ä¸ªæŒ‰é’®æ¥åˆ‡æ¢è¯­è¨€

```
import React from 'react'
import styled from 'styled-components'
import { Link } from 'gatsby'
import { FormattedMessage } from 'react-intl'
import { Trigger, Container } from '../../common'

const Header = () => (
    <StyledHeader>
        <Navbar as={Container}>
            <Link to="/">
                <FormattedMessage id="logo_text" />
            </Link>
            <Links>
                <Link to="/">
                    <FormattedMessage id="home" />
                </Link>
                <Link to="/about">
                    <FormattedMessage id="about" />
                </Link>
                <Trigger />
            </Links>
        </Navbar>
    </StyledHeader>
)

// Feel free to move these to a separated styles.js file and import them above

const StyledHeader = styled.div`
    padding: 1rem 0;
    background: #00BCD4;
`
const Navbar = styled.div`
    display: flex;
    align-items: center;
    justify-content: space-between;
    a {
        color: #fff;
        text-decoration: none;
    }
`
const Links = styled.div`
    display: flex;
    align-items: center;
    a {
        margin: 0 1rem;
    }
`

export default Header 
```

æˆ‘ä»¬æŠŠæ”¹å˜è¯­è¨€çš„æŒ‰é’®å•ç‹¬åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¾ˆå¥½åœ°ç†è§£å®ƒ

```
import React from 'react'
import styled from 'styled-components'
import { FormattedMessage } from 'react-intl'
import { Context } from '../Context'

const Trigger = () => (
    <Context.Consumer>
        {({ toggleLanguage }) => (
            <Button type="button" onClick={toggleLanguage}>
                <FormattedMessage id="language" />
            </Button>
        )}
    </Context.Consumer>
)

// We recommend moving the style down below to a separate file

const Button = styled.button`
    color: #fff;
    padding: .3rem 1rem;
    box-shadow: 0 4px 6px rgba(50,50,93,.11), 0 1px 3px rgba(0,0,0,.08);
    background: #3F51B5;
    border-radius: 4px;
    font-size: 15px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .025em;
    text-decoration: none;
    cursor: pointer;
    &:focus {
        outline: none;
    }
`

export { Trigger } 
```

æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†æ¬¡å¯¼å…¥äº†`Context`,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒçš„`Consumer`,ä»è€Œè·å¾—å…¨å±€çŠ¶æ€ã€‚ç°åœ¨ï¼Œå½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ`toggleLanguage`åŠŸèƒ½ä¼šæ”¹å˜`lang`å€¼ã€‚

åœ¨è·å– Gatsby é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä»ä¸Šä¸‹æ–‡çš„æ¶ˆè´¹è€…é‚£é‡Œè®¿é—®`lang`å€¼æ¥å¤„ç†å†…å®¹çš„æ–¹å‘ï¼Œå¹¶æœ‰æ¡ä»¶åœ°æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é˜¿æ‹‰ä¼¯è¯­ï¼Œå¦‚æœæ˜¯ï¼Œæ–¹å‘å¿…é¡»å˜æˆ`rtl`ï¼Œå¦åˆ™å˜æˆ`lrt`ã€‚

```
import React from 'react'
import { Helmet } from 'react-helmet'
import { injectIntl } from 'react-intl'
import { Context } from '../Context'

const Head = ({ title, intl: { formatMessage } }) => (
    <Context.Consumer>
        {({ lang }) => (
            <Helmet>
                <html lang={lang} dir={lang === 'ar' ? 'rtl' : 'ltr'} />
                <title>
                    ${formatMessage({ id: title })}
                </title>
            </Helmet>
        )}
    </Context.Consumer>
)

export default injectIntl(Head) 
```

> ä½ å¯ä»¥åœ¨è¿™ä¸ª`Head`ç»„ä»¶ä¸­åŒ…å«æ‰€æœ‰çš„å…ƒæ ‡ç­¾ã€opengraphã€ç»“æ„åŒ–æ•°æ®å’Œ Twitter æ ‡ç­¾ï¼Œå°±åƒæˆ‘åœ¨ [gatsby-i18n-starter](https://github.com/smakosh/gatsby-starter-i18n/blob/master/src/components/common/SEO/index.jsx) ä¸­åšçš„é‚£æ ·

æœ€åï¼Œè®©æˆ‘ä»¬å°†æ­£åœ¨ä½¿ç”¨çš„æ’ä»¶åŒ…å«åˆ°`gatsby-config.js`æ–‡ä»¶ä¸­ï¼Œå¹¶å‡†å¤‡ä¸€äº›åŒ…å«æ”¯æŒ i18n çš„æ¶ˆæ¯çš„è™šæ‹Ÿé¡µé¢ã€‚

```
module.exports = {
    siteMetadata: {
        title: 'Gatsby i18n Example',
    },
    plugins: [
        'gatsby-plugin-react-helmet',
        'gatsby-plugin-styled-components',
        {
            resolve: 'gatsby-plugin-google-fonts',
            options: {
                fonts: [
                    'Cairo',
                    'Roboto'
                ]
            }
        },
        {
            resolve: 'gatsby-plugin-manifest',
            options: {
                name: 'gatsby-starter-default',
                short_name: 'starter',
                start_url: '/',
                background_color: '#663399',
                theme_color: '#663399',
                display: 'minimal-ui',
                icon: 'src/images/gatsby-icon.png',
            },
        },
        'gatsby-plugin-offline',
    ],
} 
```

*   ä¸»é¡µ

```
import React from 'react'
import { FormattedMessage } from 'react-intl'
import { Layout, Container } from '../components/common'
import Head from '../components/common/Head'

const IndexPage = () => (
    <Layout>
        <>
            <Head title="welcome" />
            <Container>
                <h2>
                    <FormattedMessage id="welcome" />
                </h2>
            </Container>
        </>
    </Layout>
)

export default IndexPage 
```

*   å…³äºé¡µé¢

```
import React from 'react'
import { FormattedMessage } from 'react-intl'
import { Layout, Container } from '../components/common'
import Head from '../components/common/Head'

const AboutPage = () => (
    <Layout>
        <>
            <Head title="about" />
            <Container>
                <h2>
                    <FormattedMessage id="about" />
                </h2>
            </Container>
        </>
    </Layout>
)

export default AboutPage 
```

è¿™é‡Œæ˜¯åŒ…å«æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çš„æ¶ˆæ¯çš„ä¸¤ä¸ª json æ–‡ä»¶:

```
{
    "language": "Ø¹Ø±Ø¨ÙŠ",
    "welcome": "Welcome",
    "Logo_text": "Logo",
    "Home": "Home",
    "About": "About",
    "not_found": "404 - Page Not Found"
} 
```

```
{
    "language": "English",
    "welcome": "Ø£Ù‡Ù„Ø§ Ø¨Ùƒ",
    "Logo_text": "Ø´Ø¹Ø§Ø±",
    "Home": "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
    "About": "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§",
    "not_found": "Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© - 404"
} 
```

è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œ
æ¥æµ‹è¯•ä¸€ä¸‹

```
yarn develop 
```

è¿™ä¼¼ä¹å¾ˆæœ‰æ•ˆğŸ‰ï¼Œ[æŸ¥çœ‹æ¼”ç¤º](https://i18n.netlify.com/)ï¼Œè¿™é‡Œæ˜¯[åˆ°èµ„æºåº“](https://github.com/obytes/gatsby-i18n-example/)çš„é“¾æ¥ï¼Œä»¥é˜²æ‚¨æ— æ³•è·Ÿè¿›ï¼Œæœ‰é—®é¢˜å—ï¼Ÿè¯·åœ¨è¯„è®ºä¸­ç•™è¨€ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤ã€‚

> è¯·éšæ„ä½¿ç”¨æˆ‘è‡ªå·±çš„ [gatsby-i18n-starter](https://github.com/smakosh/gatsby-starter-i18n) æ¥è½»æ¾å¼€å§‹ä½¿ç”¨å…¶ä»–ä¸€äº›ä¼Ÿå¤§çš„åŠŸèƒ½ã€‚