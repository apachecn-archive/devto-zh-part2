# 重写与重构之争:你需要知道的 8 件事

> 原文：<https://dev.to/bosepchuk/the-rewrite-vs-refactor-debate-8-things-you-need-to-know-2hi4>

所以，如果你正在读这篇文章，这意味着你正参与一个一团糟的软件项目，你想探索你的选择。不要不好意思。这是一个安全的地方；我们都曾在谷歌上搜索过“重写 vs 重构”。

问题是，对于如何处理陷入困境的项目，我们的职业是意见多，证据少。我们的观点无处不在。所以，很难知道你应该相信什么。

在这篇文章中，我将为你简化事情，并帮助你在重写和重构的争论中导航。

让我们开始吧。

### 1。都是观点。“重写与重构”的顶级结果都不是同行评审的研究

很容易被一个好故事所迷惑。**但轶事不等于证据**。

[![blind people trying to describe an elephant by touch](../Images/517e16b40bd304f1759816dc1bc974a6.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--1ytn55sc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/f5qo4lrkan3je8aps0ku.png)

想一想:对于你所阅读的东西的作者，你真的了解他的专业知识吗？在网上发表一篇博文的门槛极低。如果你知道你读的文章是你见过的最差的程序员写的，你会有什么感觉？经验不足一年的人怎么样？曾经只在一个系统上工作过的人呢？

反之亦然。你会因为 Martin Fowler 很有名并且写了一本关于重构的书(顺便说一下，也没有经过同行评审)就自然而然地相信他所说的话吗？罗伯特·c·马丁(Robert C. Martin)是如何写下这句话的呢？这似乎很武断。没有例外？从来没有？

### 2。重写和重构是错误的二分法

重写、重构或继续照常运营是 ***而不是*** 你唯一的选择。你有一系列的选择。

即使在一个系统中，不同部分的最佳解决方案也可能不同。

### 3。重写和重构不是精确定义的术语

当你阅读关于重写和重构软件的博客文章时，你会一遍又一遍地看到这一点。“重写”、“重组”、“重新设计”、“重新架构”、“解开”、“移植”等等。都是定义不清的术语。他们的意思是作者决定他们的意思。如果你幸运的话，作者会告诉你那是什么，但那很少。所以，**一个人的重构可以而且经常是另一个人的重写**。

这导致了在评论区无益的争论，人们在争论，因为他们甚至没有谈论同样的事情。

### 4。你的项目存在于一个环境中

如果你只关注技术上的考虑，你可能会得出一个与你的大环境完全不可接受的结论。也许你的雇主有你不知道的优先权、义务或计划。

例如，您的公司可能更喜欢一种更可预测的方法来改进您的软件，即使每个人都认为重写可能会更快。他们可能已经对客户做出了关于你的软件未来特性的秘密承诺。他们可能指望从另一个项目中获得现金来使企业免于破产，而你不能一边做那个项目，一边重写或重构。

我知道程序员通常讨厌政治，但是你的决定并不存在于真空中。考虑重写或重构一个重要的项目将会引起人们的注意，你可以打赌这将会变得政治化。

### 5。规模和复杂性很重要

不言而喻，重写一个调用 ImageMagick 并调整目录中图像大小的简短脚本与重写 F-22 Raptor 中的所有软件完全不同*。虽然这是一个极端的例子，但是即使是表面上相似的项目，内部也可能有很大的不同，需要不同的方法来保持它们的可行性。*

 *### 6。你如何定义成功？

这是定义松散的术语的另一个问题。人们写下类似“我们在三个月内成功地从头重写了我们的软件，而重构它需要更长的时间”。这到底是什么意思？成功的定义是什么？10%的投资回报率？15%?该项目在扣除利息、折旧和税之前的净现值为正？说真的什么？细节很重要。

让我们不要不加分析就接受这种说法的另一部分。他们怎么知道重构会花费更长的时间呢？他们能够确定的唯一方法是他们是否同时进行了重写和重构，我保证这不会发生。

另一个问题:那个成功的项目会不会只是用一组问题换来了另一组同样或更丑陋的问题？

最后，项目对所有利益相关者都是成功的吗？我可以想象一个场景，开发人员可以看到项目是成功的，因为他们可以摆脱一些技术债务。但业务人员可能处于神经崩溃的边缘，因为市场发生了变化，他们的竞争对手偷走了大部分业务客户，而开发人员正忙于完成他们的“成功”重写。

### 7。你如何定义完成？

软件什么时候‘完成’？让我们来看看一个“成功的”重写，看看我们是否能就何时完成达成一致。

是今天吗:

*   你部署了吗？
*   它和现有的软件有完全一样的功能？
*   足够多的新缺陷被修复，客户可以使用它而不用诅咒你出生的那一天？
*   所有的缺陷都修复了？
*   钱花光了，客户就只能用你给他们的东西，即使它比你要更换的版本更糟糕，功能更少？

这些事情中的任何一件都可以被认为是“完成了”，对吗？你所阅读的博文的作者使用和你一样的“完成”定义的可能性有多大？

### 8。那么，你如何决定做什么呢？

大多数人都想重写。从头开始很有号召力。然而，人们经常认为试图改进现有系统是通向更好软件的漫长、艰难、丑陋的道路。所以， ***你要做的第一件事就是确定重写是否可行*** 。

首先要承认大型软件重写是有风险的。许多人失败了，有些人严重伤害了公司，有些人彻底毁掉了公司。但是技术债务和过时本身也同样危险。

有时你无法控制的因素会迫使你重写。例如，您可能需要改变一个系统的行为，而您只有这个系统的二进制代码，而没有源代码。或者软件与古老的硬件紧密结合，无法可靠地继续使用。

无论是哪种情况， ***如果你已经达到了技术债务或过时的临界点，你所做的一切都将充满风险，包括继续照常营业*** 。在那一点上没有好的选择。这就是为什么你应该尽你所能不让你的项目变得那么糟糕。

#### 考虑重写的最低要求

在你考虑重写之前，某些东西需要到位。Max Kanat-Alexander 在他的书 *Code Simplicity* 中写到了这一点。

> ...有些情况下重写是可以接受的。然而，它们非常罕见。只有当以下所有 都为真时，才应该重写:

这是一个很长的列表，所以我要转述马克斯的话:

*   你已经开发了一个准确的估计，表明重写系统将比重新设计现有系统更有效地利用时间。
*   你有大量的时间来创建一个新系统。
*   你在某种程度上是一个比原来系统的设计师更好的设计师。
*   你完全打算用一系列简单的步骤来设计这个新系统，并且让用户在设计的每一步都能给你反馈。
*   您有足够的资源来同时维护现有系统和设计新系统。

但这些只是 ***的最低要求，要考虑重写*** 。下一节会更深入一些。

#### 在你提议重写之前要考虑的事情

你和你的利益相关者能就这些问题的答案达成一致吗？

#### 我有一些关于重写的问题

*   与维护和扩展系统相比，从头重写需要不同的技能。你有什么证据证明你的人能成功完成这种项目？他们最后一次做是什么时候？你有什么保证你不会以一个和旧系统一样多问题的新系统告终？
*   您想要重写的系统很复杂，难以理解，难以更改，充满了不一致和缺陷，测试覆盖率低，文档质量低，如果有文档的话。正确吗？没有人完全了解现有的系统，这样说公平吗？如果是这样的话，**您将如何在合理的时间内搞清楚现有系统的所有功能，并将其转化为新系统的一系列明确需求？你甚至能合理准确地估计出新系统会有多少需求吗？大概不会。那么，如何估计重写的实现工作量呢？**
*   从头开始的大规模重写看起来不像一个巨大的瀑布项目吗？我们采用敏捷和增量的特性交付不是因为瀑布式和大的预先设计太冒险了吗？
*   我反对同步特性开发，因为延迟特性发布会增加成本。重写难道不是这种情况的极端版本吗？
*   你确定重写是最能利用你的人的时间的方式吗？在微小的重构和从头重写之间有一整套选择，重写是最危险和最极端的。有没有可能一个不那么极端的计划可能更可取？

#### 你已经回答了前面所有的问题，但仍想重写。现在怎么办？

彻底重写一个重要的系统是一项具有重大风险的重大任务。但是如果你决定继续重写，最好睁大你的眼睛去做，因为你可能会提出软件世界的牙买加试图征服俄罗斯。经由北极！冬天！T3】

[![overwhelmed by the scale of the task](../Images/c32edea2eddccaf48cee519b81f79a20.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--YlzSTskj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/w52qrrjadw65gj5etjvn.jpg)

成功不是自动不可能的，但它不会很容易。如果没有适当的计划、整个组织的支持和足够的资源，你可能会让自己和你的团队自愿参加死亡行军。所以，**在你让你的团队重写之前，确保你有一个可行的计划。**

### 外卖

重写与重构之争主要是以下因素造成的:

*   缺乏质量研究支持的证据
*   软件开发中缺乏标准化的工程方法
*   程序员避免糟糕代码的愿望
*   软件开发人员相信(通常很天真)如果他们从零开始，他们可以产生一个更好的系统
*   定义模糊的术语
*   对复杂性的过度简化和对轶事证据的接受
*   失败重写的清晰记录
*   和对技术问题的狭隘关注

虽然很吸引人，但从头重写一个重要的系统是有风险的。许多人建议，除了在最糟糕的情况下，不要这样做。

但是在某些情况下，重写是你最好或者唯一的选择([例子](https://jacquesmattheij.com/e-stop-and-fuel))。在这种情况下，你需要一个好的计划来最大化你成功的机会。

所以，现在我们已经确定并澄清了其中的一些问题，你应该能够逻辑地思考你所读到的内容，它在多大程度上适用于你的情况，并看到重写与重构的争论到底是什么。

祝你的决定好运。

*同意还是不同意？我很想在评论区听到你的想法。*

喜欢这篇文章吗？请在下面“点赞”。

### 附加资源:

*   这场辩论的精彩概述:[https://techbeacon . com/17-opinions-resources-rewrites-vs-refactoring](https://techbeacon.com/17-opinions-resources-rewrites-vs-refactoring)
*   重写生存技巧:[https://Tim Ross . WordPress . com/2010/03/15/if-you-must-rewrite/](https://timross.wordpress.com/2010/03/15/if-you-must-rewrite/)
*   关于重写的争论(我不同意这里的一切):[https://software engineering . stack exchange . com/questions/6268/when-is-a-big-rewrite-the-answer](https://softwareengineering.stackexchange.com/questions/6268/when-is-a-big-rewrite-the-answer)*