# æˆ‘åº”è¯¥å°†è§†å›¾ä¼ é€’ç»™æ¼”ç¤ºè€…çš„æ„é€ å‡½æ•°å—ï¼Ÿ

> åŸæ–‡:[https://dev . to/chrisvasqm/should-I-pass-a-view-to-a-presenters-constructor-4n 45](https://dev.to/chrisvasqm/should-i-pass-a-view-to-a-presenters-constructor-4n45)

<center>Cover image by [Ben White](https://unsplash.com/@benwhitephotography) from [Unsplash](https://unsplash.com)</center>

* * *

æˆ‘å·²ç»çœ‹åˆ°äº†å¦‚ä½•åœ¨ Android ä¸Šå®ç° MVP(æ¨¡å‹-è§†å›¾-æ¼”ç¤ºè€…)æ¨¡å¼çš„å¤šç§å˜åŒ–ï¼Œå…¶ä¸­ä¸€ä»¶å¼•èµ·æˆ‘æ³¨æ„çš„äº‹æƒ…æ˜¯æ¼”ç¤ºè€…è§†å›¾çš„è®¾ç½®æˆ–åˆå§‹åŒ–æ–¹å¼å› ä½œè€…è€Œå¼‚ã€‚

ä»¥ä¸‹æ˜¯æˆ‘æ‰€è¯´çš„ä¸€ä¸ªä¾‹å­:

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª`LoginActivity`ã€‚åœ¨å®ƒçš„`onCreate`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†å¿…é¡»è®¾ç½®å‘ˆç°è€…ï¼Œå¹¶ä¼ å…¥å¯¹`LoginActivity`çš„å¼•ç”¨ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æ“çºµå®ƒã€‚

ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥è®©æˆ‘ä»¬çš„`LoginActivity`å®ç°ä¸€ä¸ªæ¥å£ï¼Œå§‘ä¸”ç§°ä¹‹ä¸º`LoginView`ï¼Œå®ƒå°†æ˜¯æˆ‘ä»¬çš„`LoginPresenter`å°†è¦ä½¿ç”¨çš„å¯¹è±¡çš„ç±»å‹ã€‚

## [](#presenter-example-1)æ¼”ç¤ºè€…ç¤ºä¾‹ 1

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ presenter æ¥å£ï¼Œå®ƒå°†è¢«å…¶ä»–ç‰¹å®šçš„ presenter ç±»ä½¿ç”¨:

```
interface Presenter<V> {
    fun attach(view: V)
    fun detach()
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„`LoginPresenter` :
ä¸­å®ç°å®ƒ

```
class LoginPresenter : Presenter<LoginView> {

    private var view: LoginView? = null

    override fun attach(view: LoginView) {
        this.view = view
    }

    override fun detach() {
        view = null
    }

    // ...

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±çš„`attach()`å’Œ`detach()`æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„`LoginActivity`åº”è¯¥æ˜¯è¿™æ ·çš„:

```
 class LoginActivity : AppCompatActivity(), LoginView {

    private lateinit var presenter: Presenter<LoginView>

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        presenter = LoginPresenter()
        presenter.attach(this)
    }

    override fun onDestroy() {
        super.onDestroy()
        presenter.detach()
    }

    // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå› ä¸ºæˆ‘åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº† Kotlinï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`apply`æ–¹æ³•ï¼Œè®©å®ƒä»è¿™ä¸ª:

```
presenter = LoginPresenter()
presenter.attach(this) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡´:

```
presenter = LoginPresenter().apply { attach(this@LoginActivity) } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å¾ˆæœ‰å¸®åŠ©ï¼Œä½†æ˜¯...

æˆ‘å¯¹è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœå‡ºäºæŸç§åŸå› ï¼Œå¼€å‘äººå‘˜å¿˜è®°ä½¿ç”¨`attach()`æ–¹æ³•ï¼Œå°†ä¼šé¢ä¸´æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä»¤äººæ²®ä¸§çš„å‡ åˆ†é’Ÿ/å‡ å°æ—¶è¯•å›¾æ‰¾åˆ° bugã€‚

å¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯å‡ å¤©å‰çš„æˆ‘ğŸ˜…

å› æ­¤ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæˆ‘è®¤ä¸ºæœ€å¥½é‡‡å–ä»¥ä¸‹æªæ–½:

## [](#presenter-example-2)æ¼”ç¤ºè€…ç¤ºä¾‹ 2

æˆ‘ä»¬å¯ä»¥ä»`Presenter`æ¥å£ä¸­ç§»é™¤`attach()`æ–¹æ³•ï¼Œè¿™å°†ç•™ç»™æˆ‘ä»¬:

```
interface Presenter<V> {
    fun detach()
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”±äº`V`æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ é™¤å®ƒã€‚

```
interface Presenter {
    fun detach()
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘æƒ³ç”¨`-able`å‘½åçº¦å®šæ¥é‡å‘½åè¿™ä¸ªæ¥å£ï¼Œå‘½åçº¦å®šæ˜¯:

```
interface Detachable {
    fun detach()
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨è¿™ç§å‘½åçº¦å®šçš„æ¥å£ç¤ºä¾‹æœ‰:`Runnable`ã€`Serializable`ã€`Readable`å’Œ`Parceable`ã€‚

è¿™ç§å˜åŒ–ä¹Ÿè¦æ±‚æˆ‘ä»¬å°†
æ”¹ä¸º`LoginPresenter`

```
class LoginPresenter : Presenter<LoginView> {

    private var view: LoginView? = null

    override fun attach(view: LoginView) {
        this.view = view
    }

    override fun detach() {
        view = null
    }

    // ...

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡´:

```
class LoginPresenter(private var view: LoginView?) : Detachable {

    override fun detach() {
        this.view = null
    }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å‰©ä¸‹è¦åšçš„å°±æ˜¯ä¿®æ”¹æˆ‘ä»¬çš„`LoginActivity`ä»£ç 

```
presenter = LoginPresenter()
presenter.attach(this) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿˜æ˜¯è¿™ä¸ª:

```
presenter = LoginPresenter().apply { attach(this@LoginActivity) } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è‡´:

```
presenter = LoginPresenter(this) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥æˆ‘ä»¬æ•´ä¸ª`LoginActivity`ç±»åº”è¯¥æ˜¯:

```
class LoginActivity : AppCompatActivity(), LoginView {

    private lateinit var presenter: LoginPresenter

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        presenter = LoginPresenter(this)
    }

    override fun onDestroy() {
        super.onDestroy()
        presenter.detach()
    }

    // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºé‚£äº›ä¸å–œæ¬¢`lateinit`å±æ€§çš„äºº:

```
class LoginActivity : AppCompatActivity(), LoginView {

    private val presenter = LoginPresenter(this)

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
    }

    override fun onDestroy() {
        super.onDestroy()
        presenter.detach()
    }

    // ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ä½ æˆ‘éƒ½å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„`LoginPresenter`åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ€»æ˜¯å¤„äº*æœ‰æ•ˆçŠ¶æ€*ã€‚

* * *

æˆ‘å¯èƒ½å¿½ç•¥äº†ç¤ºä¾‹ 2 æ–¹æ³•ä¸­çš„ä¸€äº›ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æƒ³çŸ¥é“æ‚¨çš„æƒ³æ³•:)