# 为什么要学 PL/SQL(或者 T-SQL 或者 PL/pgSQL)，应该怎么学？

> 原文：<https://dev.to/katiekodes/why-and-how-should-i-learn-plsql-or-t-sql-or-plpgsql-4g2>

如果您需要在代码中执行比 SQL 编程语言所允许的更复杂的循环或条件，该怎么办？这就是为什么大多数主流数据库品牌*也能够理解用“过程化”编程语言编写的命令。Oracle 称他们的为“PL/SQL”，Microsoft SQL Server 称他们的为“T-SQL”，PostgreSQL 称他们的为“PL/pgSQL”，等等。让我们探索一下**你**是否需要学习这些语言中的一种。*

*( [本文也有法文](https://dev.to/katiekodes/pourquoi---et-comment---apprendre-plsql-t-sqlplpgsql-4bhj) )*

## 这些语言为什么会存在？

SQL 是一种“声明性”编程语言，大多数主要数据库都附带这种语言，它允许您:

1.  配置数据库
2.  用数据填充它
3.  执行简单的“查询”来检索您的数据

SQL 应该是简单的，非程序员也可以使用。这是相对万无一失的。

换句话说，尽管它丰富、复杂、强大，但在编程的大计划中，它还有很多不能做的事情。

当您想要对数据集中的行编写复杂的条件逻辑或专门的循环时，可能会超出 SQL 的限制。

像 PL/SQL 这样的语言允许你这样做。

在大多数数据库中，它们也是用来编写数据库“触发器”的。

## 我需要了解 PL/SQL 吗？

这取决于你要做什么。

大多数数据库管理员不会让像您这样的普通最终用户将您的 PL/SQL 程序作为“触发器”、“函数”或“存储过程”保存到数据库中

一些数据库管理员将:

1.  让你尝试起草这样的计划
2.  校对它们以确保你做得很好
3.  为您将它们保存到数据库中

但在大多数情况下，你可能不被允许帮助你的公司写“触发器”，“函数”，或“存储过程”。你可能只限于写“匿名块”。让我们来看看每一个。

### 触发器

触发器是保存在数据库中的代码，每当有人试图插入、更新或删除满足特定标准*(例如，存储在特定表中)*的记录时，数据库被告知执行该代码。

他们通常习惯于:

*   提供比数据库的本机权限设置所允许的更高级的记录编辑权限
*   “虚拟检查”并阻止/修复/增强最终用户的数据输入
*   等等。

### 功能

函数是保存在数据库中的代码，它成为 SQL 语言*(对于有权限执行函数的用户)*的扩展。

例如，在 Oracle 中，`NVL(SomeColumn,SomeValue)`是一个*函数*，它预装在 Oracle 版本的 SQL 中，意思是“如果`SomeColumn`中的值为空，则替换为`SomeValue`”

将“函数”存储在数据库中可以让您添加自己的`CleverName(...)`操作，供最终用户在他们的 SQL 脚本中使用。

例如，我工作的大学在数据库中保存了 3 个函数，名为:

1.  `Current_Semester_Code()`
2.  `Previous_Semester_Code()`
3.  `Next_Semester_Code()`

这些将“今天的日期”*(由数据库计算机的时钟计算)*转化为有用的信息，使查询更加简洁，例如:

*   这学期谁注册了？
*   谁已经毕业了？

### 存储过程

假设一家公司的 web 开发人员正在为客户编写一个自助服务门户，该门户从您的数据库中检索数据，并在屏幕上显示给这些客户。

至少会有一个对数据库的 SQL 查询，因为至少，你必须告诉数据库*网站需要显示谁的*数据。

因此，您的 web 开发人员可能会编写一个 SQL 查询，比如:

```
select *
from customer_info
where customer_email='test@example.com' 
```

看到那个`test@example.com`了吗？

`test@example.com`从何而来？

网上某个陌生人声称那是他们的邮箱地址？

**如果他们撒谎**并把*更多的* SQL 代码——删除你数据库中所有表格的代码——放入“你的电子邮件地址是什么？”盒子？

这种攻击被称为“ **SQL 注入**”，非常危险*(参见[“鲍比表格”](http://bobby-tables.com/)了解更多关于预防 SQL 注入的信息)。)*

你可以让你的网站开发者来检查这个“电子邮件地址”是否真的只是一个普通的电子邮件地址，但是如果她忘记了呢？如果她去度假，而一个初级 web 开发人员不小心退格删除了检查“电子邮件地址”质量的代码部分，该怎么办

从数据库管理员的角度来看，防止用户名直接对数据库执行任何 SQL 查询被认为是最佳实践，在该用户名下，面向“公共”的代码(如客户自助服务门户)运行。

相反，该公司的数据库程序员将把“**存储过程**”保存到数据库中，并只给“web”代码调用这些过程的权限。这样的过程就像一个 API，web 程序员可以安全地调用它。例如，可能有一个存储过程叫做:

`fetch_cust_by_em(email_address_here)`

然后是*那些*程序，保存在数据库中的*，负责确保`email_address_here`是一个真实的电子邮件地址，如果不是，安全地拒绝满足请求。*

web 程序员不必再为“净化”他们的“输入”而失眠了。

> 如果你渴望**成为**为你的公司编写“触发器”、“函数”或“存储过程”的人之一，你**必须**学习一门“过程化”的数据库编程语言，如 Oracle PL/SQL、Microsoft SQL Server T-SQL 或 PostgreSQL PL/pgSQL。
> 
> 它们都有些相似，所以你可以自由选择对你来说最有意义的一个。

### 匿名块

如果您被允许对您的数据库执行 SQL，您*可以*编写并运行名为“**匿名块**”的“程序性”代码片段

(假设你的代码不会对数据库做任何你手工输入 SQL 时不会被允许做的事情。)

作为一个最终用户，我通常可以用 SQL 做任何我需要做的事情。但是有一两次，我发现自己需要做一些有点“花哨”的事情，其中“PL/SQL 匿名块”为我提供了额外的计算能力提升。

**然而……**

如果您已经在另一种编程语言(如 Java 或 Python)中使用 SQL 获取的数据，您可能会发现您的“主程序”语言足以完成“一点点额外的处理”

我的建议是:选择最适合您业务需求(包括安全性)的方法。

## 如何学习 PL/SQL

1.  *[PL/SQL 入门:从新手到专业](https://www.worldcat.org/search?q=bales+Beginning+PL%2FSQL%3A++From+Novice+to+Professional&&dblist=638&fq=#x0%253Abook-%2C%2528x0%253Abook%2Bx4%253Adigital%2529%2C%2528x0%253Abook%2Bx4%253Aprintbook%2529format)* 作者 Donald J. Bales。这是一本轻松、易读的书，它抓住你的手，用幽默来增加记忆，并在“如何”之前呈现“为什么”
    *   如果您已经知道一些 PL/SQL，但是想确保您理解最佳实践，那么它已经写得足够好了，您不需要停下来做练习。
    *   如果你是一个完全的初学者，它有很大的编程练习。
2.  *[《1z 0-144 甲骨文认证预备学习指南:甲骨文数据库 11g:PL/SQL](https://www.worldcat.org/title/oracle-certification-prep-study-guide-for-1z0-144-oracle-database-11g-program-with-plsql/oclc/949792272&referer=brief_results)T3 编程》作者 Matthew Morris。这是一篇相对较短的“闪电评论”，如果你已经是一名计算机程序员，它会成为唐纳德·贝尔斯的书的好伴侣，帮助你更快地“出发”。它让您直接进入游泳池的深水区，立即让您练习条件逻辑、循环和使用变量，但也涵盖了“最佳实践”这是一个过时版本的甲骨文，但基本面没有改变到足以避免阅读一本写得很好的书。*
3.  *[数据库 PL/SQL 语言参考](https://docs.oracle.com/en/database/oracle/oracle-database/18/books.html)* 通过 Oracle。这是参考手册，不是新手教程。如果你是一个高级程序员，却在某一点上卡住了，这是值得了解的。

抱歉，我不熟悉 T-SQL 或其他 PL/SQL 竞争对手的初学者教程。如果你有任何意见，请在评论中告诉我！