# å…±äº«ä¸»æœºä¸Šçš„ Laravel é˜Ÿåˆ—å¤„ç†

> åŸæ–‡:[https://dev . to/orobogenius/laravel-queue-processing-on-shared-hosting-1p9h](https://dev.to/orobogenius/laravel-queue-processing-on-shared-hosting-1p9h)

#### [](#a-guide-to-setting-up-laravel-queue-processing-on-shared-servers)åœ¨å…±äº«æœåŠ¡å™¨ä¸Šè®¾ç½® Laravel é˜Ÿåˆ—å¤„ç†çš„æŒ‡å—

[![](../Images/9171fb9bca1bd4121653e3672ec0f4dd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--nerD7orJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2Ao_VTrskPWb_7VCP0JUNf2w.jpeg) 

<figcaption>ç…§ç‰‡ç”±[ÃÂ·é˜¿å°”ç“¦ç½—Â·å¡æ‹‰è¯º](https://unsplash.com/photos/YsvAZFxDZ_8?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)äº [Unsplash](https://unsplash.com/search/photos/efficiency?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)</figcaption>

å·²ç»æœ‰å¾ˆå¤šå…³äºå¦‚ä½•åœ¨å…±äº«ä¸»æœºä¸Šè®¾ç½® laravel é˜Ÿåˆ—çš„æŒ‡å—ï¼Œæ‰€ä»¥ä½ å¯èƒ½å·²ç»çœ‹è¿‡æˆ–è€…å·²ç»æœ‰äº†åœ¨å…±äº«ä¸»æœºä¸Šä½¿ç”¨é˜Ÿåˆ—çš„æ–¹æ³•ã€‚å¦‚æœä½ æœ‰ï¼Œè¿™ä¸ªæŒ‡å—éµå¾ªåŒæ ·çš„æ€è·¯ï¼Œä½†æœ‰ä¸€ä¸ªæ›´ä¸ªæ€§åŒ–çš„è§‚ç‚¹ã€‚

å¯¹äºé‚£äº›çœ‹åˆ°â€œLaravelâ€å’Œâ€œå…±äº«ä¸»æœºâ€è¿™ä¸¤ä¸ªè¯å‡ºç°åœ¨åŒä¸€ä¸ªå¥å­ä¸­è€Œæ„Ÿåˆ°ä¸å®‰çš„äººæ¥è¯´ï¼Œè¿™å¯èƒ½ä¸é€‚åˆä½ ï¼Œé™¤éå®ƒé€‚åˆä½ ã€‚

[![You just might find yourself there.](../Images/f427135dcd0a8a5ac260dd0ba5cdfee2.png)T2ã€‘](https://i.giphy.com/media/dOxMHecx24CY/giphy.gif)

### **TLï¼›WR**

è¿™ä¸ªæŒ‡å—æœ‰ç‚¹åƒä¸€ä¸ªæ•…äº‹ï¼Œå¦‚æœä½ æ‡’å¾—å»éµå¾ªè¿™ç¯‡æ–‡ç« çš„æ€è·¯ï¼Œä½ å¯ä»¥å¿«é€Ÿè·³è¿‡æ‰€æœ‰å†…å®¹ï¼Œç›´æ¥è¿›å…¥é¡µé¢åº•éƒ¨çš„è§£å†³æ–¹æ¡ˆã€‚

### [](#train-of-thought)æ€è·¯

å› æ­¤ï¼Œæˆ‘å‘ç°è‡ªå·±åœ¨å…±äº«ä¸»æœºä¸Šæ‰˜ç®¡äº†ä¸€ä¸ª laravel åº”ç”¨ç¨‹åºï¼Œæ­£å¦‚æˆ‘åœ¨å…±äº«æœåŠ¡å™¨ä¸Šæ‰˜ç®¡ laravel åº”ç”¨ç¨‹åºæ—¶æ³¨æ„åˆ°çš„è®¸å¤šäº‹æƒ…ä¸€æ ·ï¼Œæœ‰æ•ˆåœ°è®¾ç½®é˜Ÿåˆ—å¤„ç†å¯èƒ½æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…ã€‚æˆ‘çš„åº”ç”¨ç¨‹åºå·²ç»å®Œæˆå¹¶å‡†å¤‡æŠ•å…¥ç”Ÿäº§ï¼Œä½†æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„ä½œä¸šã€‚æˆ‘ä¸å¯èƒ½åœ¨æˆ‘çš„é‚®ä»¶ä¸Šä½¿ç”¨åŒæ­¥é©±åŠ¨ç¨‹åºæˆ–ä½¿ç”¨ sendmethod è€Œä¸æ˜¯ queue æ–¹æ³•ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œæˆ‘çš„ä½œä¸šå°†è¢«åŒæ­¥å¤„ç†ï¼Œæˆ‘ä¸å¿…å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆè¿™å¯¹ä¸šåŠ¡ä¸åˆ©ã€‚

æˆ‘è¿˜æœ‰ä¸€ä¸ªé€‰æ‹©ï¼Œè®¾ç½®é˜Ÿåˆ—å¤„ç†ã€‚æˆ‘å¾ˆå¿«è°·æ­Œäº†å¦‚ä½•åœ¨å…±äº«ä¸»æœºä¸Šè®¾ç½® laravel é˜Ÿåˆ—ï¼Œå› ä¸ºæˆ‘å°è¯•çš„æ‰€æœ‰é€‰é¡¹éƒ½æ²¡æœ‰æˆåŠŸã€‚æœ‰ä¸€äº›ç‚¹å‡»ï¼Œè¿™ä¸ªç‰¹åˆ«çš„æŒ‡å—([åœ¨å…±äº«ä¸»æœºä¸Šä½¿ç”¨ laravel é˜Ÿåˆ—](https://medium.com/@sdkcodes/using-laravel-queues-on-shared-hosting-a-simple-guide-9f976ccf99f3))çœ‹èµ·æ¥å¾ˆæœ‰å¸Œæœ›ï¼Œæ‰€ä»¥æˆ‘å†³å®šå®ç°å®ƒã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæŒ‡å—æŒ‡ç¤ºæ·»åŠ  laravel scheduler ä½œä¸ºæ¯åˆ†é’Ÿè¿è¡Œçš„ cron æ¡ç›®ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªæ­»èƒ¡åŒï¼Œæˆ‘çš„å…±äº«ä¸»æœºæä¾›å•†é™åˆ¶ cron ä½œä¸šæ¯ 15 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ã€‚å“å“Ÿï¼å¦‚æœæ‚¨è¿è¡Œ laravel è°ƒåº¦ç¨‹åºï¼Œè€Œä¸æ˜¯æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œæ‚¨ä¼šå¾—åˆ°â€œæ²¡æœ‰è°ƒåº¦çš„å‘½ä»¤å‡†å¤‡è¿è¡Œâ€çš„æ¶ˆæ¯ã€‚

è¯¥è§£å†³æ–¹æ¡ˆçš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒä¼šä¸æ–­åœ¨å†…å­˜ä¸­æ·»åŠ æ–°çš„é˜Ÿåˆ—å·¥ä½œå™¨ï¼Œé˜Ÿåˆ—å·¥ä½œå™¨æ˜¯é•¿å¯¿å‘½çš„è¿›ç¨‹ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒä»¬ä¼šå¼€å§‹å †ç§¯å¹¶å µå¡æ‚¨çš„å†…å­˜ã€‚å½“æˆ‘å†³å®šç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ã€‚æˆ‘åˆšåˆšæ·»åŠ äº†ä¸€ä¸ªæ¯ 15 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡çš„ cron æ¡ç›®ğŸ˜å¤„ç†æˆ‘çš„é˜Ÿåˆ—:

```
\*/15 \* \* \* \* \* /path/to/php /path/to/artisan queue:work --tries=3 
```

å—¯ï¼ŒçœŸä»¤äººå¤±æœ›ï¼Œå°±åœ¨æˆ‘ä»¥ä¸ºæˆ‘æœ‰äº†çªç ´çš„æ—¶å€™ã€‚è™½ç„¶æˆ‘ä¸æ‰“ç®—æ”¾å¼ƒï¼Œä½†æ˜¯ä»»ä½•äº‹æƒ…éƒ½æ¯”è¿è¡ŒåŒæ­¥é˜Ÿåˆ—å¤„ç†è¦å¥½ã€‚æˆ‘çš„ä¸‹ä¸€ä¸ªåŠªåŠ›æ˜¯å¾—åˆ°[ä¸»ç®¡](http://supervisord.org/)ã€‚åœ¨å…±äº«ä¸»æœºä¸Šè®¾ç½®ç®¡ç†å‘˜å¹¶ä¸å®¹æ˜“ï¼Œæˆ‘éœ€è¦ root æƒé™ï¼Œä½†æˆ‘æ²¡æœ‰ã€‚æˆ‘å››å¤„çœ‹äº†çœ‹ï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆæ£’çš„å…³äºå…±äº«ä¸»æœºçš„[è®¾ç½®ä¸»ç®¡æŒ‡å—ã€‚è¿™ä¸ªè¿‡ç¨‹å®è´¨ä¸Šæ˜¯è®©æ‚¨å°† supervisor å®‰è£…åˆ°ä¸€ä¸ªç›®å½•ä¸­ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œæ‚¨æœ‰å®Œå…¨çš„è®¿é—®æƒé™ï¼Œå¦‚æœæ‚¨æ„¿æ„çš„è¯ï¼Œè¿™æ˜¯æ‚¨çš„æƒé™èŒƒå›´ã€‚æ‚¨å¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸­å®‰è£… supervisorï¼Œå¹¶ä»é‚£é‡Œè¿è¡Œå®ƒã€‚](https://medium.com/@RealPete01/setting-up-supervisor-on-a-shared-hosting-without-root-access-1d564e535d08)

æœ€åï¼Œæˆ‘ç»ˆäºè‡ªç”±äº†ï¼Œæˆ‘ç»ˆäºå¯ä»¥é…ç½® supervisorï¼Œè®©å®ƒå¤„ç†æˆ‘çš„é˜Ÿåˆ—å·¥ä½œç¨‹åºçš„é‡å¯ã€‚å“¦ï¼Œç­‰ç­‰ï¼Œæˆ‘çš„å…±äº«æœåŠ¡å™¨æ²¡æœ‰ **easy_install** python æ¨¡å—ï¼Œè¿è¡Œ python setup.py install å‘½ä»¤ä¹Ÿä¸èµ·ä½œç”¨ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºæˆ‘å·²ç»é€ƒè„±äº†æ‰€è¯´çš„æƒé™é—®é¢˜ã€‚ä¸è¿‡ï¼Œæˆ‘å¹¶æ²¡æœ‰ä»è¯¥æŒ‡å—ä¸­è·ç›Šï¼Œè¿™æ˜¯åœ¨å…±äº«æœåŠ¡å™¨ä¸Šå®‰è£… supervisor çš„ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ï¼Œå®ƒè¿˜è®©æˆ‘äº†è§£äº†å¦‚ä½•å°†è½¯ä»¶åŒ…å®‰è£…åˆ°æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™çš„ç›®å½•ä¸­(å¦ä¸€ä¸ªå†’é™©)ã€‚è¯•è¯•çœ‹ï¼Œå®ƒå¯èƒ½å¯¹ä½ æœ‰ç”¨ã€‚

å¥½å§ï¼Œæ‰€ä»¥åœ¨æˆ‘å¶ç„¶å‘ç° Laravel çš„é˜Ÿåˆ—æä¾›çš„ **â€” once** é€‰é¡¹ä¹‹å‰ï¼Œæˆ‘å·²ç»ç”¨å°½äº†é€‰é¡¹:å·¥ä½œå‘½ä»¤[è§æ–‡æ¡£](https://laravel.com/docs/5.6/queues#running-the-queue-worker)ã€‚æˆ‘å¾ˆå¿«å°±æ¥å—äº†å®ƒï¼Œæ˜¯çš„ï¼Œå®ƒèµ·ä½œç”¨äº†ï¼Œæˆ‘åªéœ€å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æˆ‘çš„ crontab ä¸­ï¼Œæˆ‘çš„ä½œä¸šå°±èƒ½å¾—åˆ°å¤„ç†ï¼Œä¸ä¼šè®©å·¥ä½œäººå‘˜é˜»å¡æˆ‘å®è´µçš„å†…å­˜:

```
\*/15 \* \* \* \* \* /path/to/php /path/to/artisan queue:work --tries=3 --once 
```

ç°åœ¨æˆ‘çš„ä»»åŠ¡æ­£åœ¨è¢«å¤„ç†ï¼Œé™¤äº†**â€”â€”once**é€‰é¡¹ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚çœŸæ‰«å…´ã€‚é€šå¸¸ï¼Œæ‚¨ä¼šå¸Œæœ›é˜Ÿåˆ—å·¥ä½œå™¨å¤„ç†é˜Ÿåˆ—ä¸­æ‰€æœ‰å¯ç”¨çš„ä½œä¸šï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰ä½œä¸šé•¿æ—¶é—´é—²ç½®ã€‚æ¯”æ–¹è¯´ï¼Œå¥‡è¿¹å‘ç”Ÿäº†ï¼Œä½ çš„é˜Ÿåˆ—ä¸­æœ‰ 1000 ä¸ªä½œä¸šï¼Œæ˜¯çš„ï¼Œæˆ‘çŸ¥é“ï¼Œå¦‚æœä½ åœ¨ 15 åˆ†é’Ÿå†…é˜Ÿåˆ—ä¸­æœ‰ 1000 ä¸ªä½œä¸šï¼Œä½ åœ¨å…±äº«æœåŠ¡å™¨ä¸Šæ‰˜ç®¡åšä»€ä¹ˆï¼Ÿè¿å°±æˆ‘ä¸€ä¸‹ï¼Œè¯´ä½ å¾—åˆ°äº†ä¸€åƒä»½å·¥ä½œã€‚ **â€” once** é€‰é¡¹æ¯ 15 åˆ†é’Ÿåªå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œå³æ¯å°æ—¶ 4 ä¸ªä»»åŠ¡ï¼Œæ¯ 10 å¤© 1000 ä¸ªä»»åŠ¡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæ³¨å†Œä¸€é¡¹æœåŠ¡ï¼Œ10 å¤©åæ”¶åˆ°ä¸€å°æ¬¢è¿é‚®ä»¶ã€‚

[![Awkward!](../Images/dc6f9f7a120d0ec7ad780005d9f9b321.png)T2ã€‘](https://i.giphy.com/media/gOmfNDR45WAb6/giphy.gif)

è¿™ä¿ƒä½¿æˆ‘å¯»æ‰¾ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®©æˆ‘åœ¨æ¯æ¬¡é˜Ÿåˆ—å·¥ä½œå™¨è¿è¡Œæ—¶è¿è¡Œæˆ‘çš„æ‰€æœ‰ä½œä¸šï¼Œä¸ä¼šè®©å·¥ä½œå™¨è¿›ç¨‹è¿è¡Œï¼Œè¿™æ ·å®ƒä»¬å°±ä¼šå¼€å§‹å †ç§¯åœ¨å†…å­˜ä¸­ï¼Œå¹¶è®©æˆ‘æ™šä¸Šç¡ä¸ªå¥½è§‰ã€‚æœ€åä¸€éƒ¨åˆ†å¯¹æˆ‘æ¥è¯´å¾ˆé‡è¦ã€‚ä¸ä¿æŒå·¥ä½œè¿›ç¨‹è¿è¡Œæ„å‘³ç€æˆ‘å¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•ä¸åœ¨å®ˆæŠ¤æ¨¡å¼ä¸‹è¿è¡Œé˜Ÿåˆ—å·¥ä½œè¿›ç¨‹ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œlaravel æ²¡æœ‰æä¾›é‚£ä¸ªé€‰é¡¹ï¼Œè¦ä¹ˆä½ ç”¨**â€”â€”once**é€‰é¡¹è¿è¡Œå®ƒï¼Œè¦ä¹ˆå®ƒä»¥å®ˆæŠ¤æ¨¡å¼è¿è¡Œï¼Œå°±åƒä¸€ä¸ªäºŒè¿›åˆ¶ç‹¬è£è€…ã€‚

ç”±äº laravel çš„å¯æ‰©å±•æ€§ï¼Œæˆ‘å¾ˆå¿«å°±ç¼–å†™äº†ä¸€ä¸ªæ§åˆ¶å°å‘½ä»¤ï¼Œç°åœ¨æˆ‘å·²ç»å°†å®ƒæ‰“åŒ…å¹¶é€šè¿‡ composer([queue worker/sans daemon](https://packagist.org/packages/queueworker/sansdaemon))æä¾›ï¼Œå®ƒæ‰©å±•äº†åŸå§‹çš„ queue:work å‘½ä»¤ã€‚è¿™æ„å‘³ç€åŸæ¥çš„ laravel å‘½ä»¤ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯æœ‰äº†æˆ‘éå¸¸æ¸´æœ›çš„é¢å¤–é€‰é¡¹ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘å¯ä»¥å°†é˜Ÿåˆ—å·¥ä½œå™¨æ·»åŠ åˆ° cron å¹¶è®©å®ƒè¿è¡Œã€‚å®ƒå°†è¿è¡Œæˆ‘çš„æ‰€æœ‰ä½œä¸šå¹¶é€€å‡ºå·¥ä½œè¿›ç¨‹ï¼Œè€Œä¸æ˜¯ä»¥å®ˆæŠ¤æ¨¡å¼è¿è¡Œã€‚è¯¥å‘½ä»¤è¿˜æä¾›äº†ä¸€ä¸ªå¯é€‰çš„ **â€”ä½œä¸š**é€‰é¡¹ï¼Œè¯¥é€‰é¡¹æŒ‡å®šäº†æ¯æ¬¡é˜Ÿåˆ—å·¥ä½œå™¨è¿è¡Œæ—¶å¸Œæœ›è¿è¡Œçš„ä½œä¸šæ•°é‡ã€‚

```
\*/15 \* \* \* \* \* /path/to/php /path/to/artisan queue:work --sansdaemon --tries=3 
```

è¯¥è½¯ä»¶åŒ…å¯åœ¨ GitHubT3 ä¸Šè·å¾—ï¼Œé‚£é‡Œä¹Ÿæä¾›äº†å¦‚ä½•ä½¿ç”¨å®ƒçš„è¯´æ˜ã€‚å¯ä»¥çš„è¯ç•™ä¸‹ä¸€é¢—æ˜Ÿã€‚ğŸ˜‰

PS:å°½é‡é¿å…åœ¨å…±äº«æœåŠ¡å™¨ä¸Šæ‰˜ç®¡ laravel åº”ç”¨ï¼Œç›¸ä¿¡æˆ‘ï¼Œä½ æ™šä¸Šä¼šç¡å¾—æ›´å¥½ã€‚

#### TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

> ä¸‹é¢æä¾›äº†åœ¨å…±äº«æœåŠ¡å™¨ä¸Šå¤„ç† laravel é˜Ÿåˆ—çš„å·¥ä½œè§£å†³æ–¹æ¡ˆã€‚
> 
> 1.  è¿è¡Œ laravel è°ƒåº¦ç¨‹åºï¼Œæ¯åˆ†é’Ÿå¤„ç†æ‚¨çš„é˜Ÿåˆ—ã€‚([åœ¨å…±äº«ä¸»æœºä¸Šä½¿ç”¨ laravel é˜Ÿåˆ—](https://medium.com/@sdkcodes/using-laravel-queues-on-shared-hosting-a-simple-guide-9f976ccf99f3)
>     
>     
> 2.  [åœ¨å…±äº«ä¸»æœºä¸Šè®¾ç½®ç®¡ç†å™¨](https://medium.com/@RealPete01/setting-up-supervisor-on-a-shared-hosting-without-root-access-1d564e535d08)å’Œ[é…ç½®](https://laravel.com/docs/5.6/queues#supervisor-configuration)æ¥ç®¡ç† laravel é˜Ÿåˆ—å·¥äººã€‚
>     
>     
> 3.  å®‰è£…è¿™ä¸ª laravel [**åŒ…**](https://github.com/orobogenius/sansdaemon) ï¼Œå®ƒæ‰©å±•äº† laravel é˜Ÿåˆ—å·¥ä½œå™¨ï¼Œå¹¶æä¾›äº†ä¸€ç§åœ¨ä¸å°†å·¥ä½œå™¨ç½®äºå®ˆæŠ¤æ¨¡å¼çš„æƒ…å†µä¸‹è¿è¡Œé˜Ÿåˆ—çš„æ–¹æ³•ã€‚å®‰è£…å®Œè½¯ä»¶åŒ…åï¼Œåªéœ€å°†ä¸‹é¢çš„ cron ä½œä¸šæ·»åŠ åˆ° cron é€‰é¡¹å¡ä¸­ã€‚
>     
>     
> 
> [cron schedule]/path/to/PHP/path/to/artisan é˜Ÿåˆ—:work - sansdaemon - tries=3