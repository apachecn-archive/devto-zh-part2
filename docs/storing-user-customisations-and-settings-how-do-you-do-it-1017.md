# 存储用户定制和设置。你是怎么做到的？

> 原文：<https://dev.to/imthedeveloper/storing-user-customisations-and-settings-how-do-you-do-it-1017>

我最近开始着手增加一项兼职工作，这需要存储大量用户设置和定制，他们可以将这些设置和定制应用到网络平台上。该产品本质上是白色标签，客户可以改变任何数量的设置，以品牌，打开和关闭许多功能。定制的水平甚至可以下降到显示给用户的文本。

目前，我已经建立了一个供客户试水(有人会为此付费吗？)并将设置/定制存储在 JSON 文件中。这很快也很容易，但现在我希望扩展到一个平台，可以有许多用户，并在团队之间共享。简而言之，平面 JSON 文件不会扩展，我正在考虑在数据库中存储设置/定制。

虽然我可以很容易地查看像 MongoDB 这样的文档存储库，以密切模仿我已经拥有的 JSON 文件的功能，但我也一直在将一些关系问题放入那些 JSON 文件中，实际上，我宁愿将它们放在关系数据库中。我不想增加我的架构中的数据库数量(尽管如果这是答案，为什么不呢！)我对这个问题和可能的选择进行了长时间的认真思考。

经过深思熟虑。我想出了 4 种情况。但首先要了解一些背景的信息:

*   单个文本项，通常用于应用程序名称和标题。
*   项目的数组，通常用于存储许多选定的标签或项目。
*   一个字符串，有默认值，但可以由用户自定义。通常用于命名可以更改的项目或消息文本。
*   数值:通常为应用中的最小和最大限值或确定值而存储。
*   布尔值:通常为要打开/关闭的功能而存储

但我不能忘记的重要一点是，违约总是存在的。如果用户不调整设置，则应使用默认值。这对于屏幕上显示的文本内容以及推送给用户的消息尤其重要。

现在，经过一番头脑风暴，我想出了管理这些设置和定制的方法和场景:

# 单排设置每个客户

在这个使用关系数据库的场景中，我可以将每个用户应用程序所需的所有设置存储在一个表“settings”中，每个设置占一列，每个用户占一行。

虽然这是最简单的开始方法，但我不觉得它有多长时间。我可能需要做的正在进行的更改，以及一些用户基于旧模式可能没有的“默认值”都存在问题。我需要经历大量的处理来更新用户，并确保没有冲突。然而，就查询返回用户设置而言，这提供了真正的简单性。

# JSON 存储

在这种情况下，我可以将现有的 JSON 放入关系数据库(如 Postgres)进行存储。这将减少需要两个数据库(非 sql 与关系数据库)的开销，同时也使我的模型接近我现有的模型。最大的好处是我不需要提前担心我的模式，我可以根据自己的意愿添加和删除设置，而不会给其他用户带来太多问题。

然而，在这种灵活性下，对我的数据进行任何类型的大更新都将是一件痛苦的事情，并且试图进一步处理数据，而不是简单的选择可能会带来一些开销。

# 一种属性包/键值方法

在这种情况下，我可以在数据库中创建一个包含 id、user_id、key、value 的非常简单的表，并确保我可以灵活地轻松存储设置，同时还能够查询 user_id 并一次取回整个设置。

我对这种方法的担心是对标准的坚持，如果任何键变得不一致，我可能会以一点混乱结束。我还认为这会导致我的数据库中出现一些非常臃肿的表。假设每个客户有 200 个设置，那么对于 5000 个用户来说，这很容易变成一百万行。我猜我不应该关心一百万行的查询性能。

# 另类？

我最后的选择，嗯..我觉得在上面的每个场景中，我都试图提到关系数据库。但是我不得不面对事实，每个选项实际上都是在和 nosql 的等价物调情。像 redis 这样的键值存储也是一个选择，尽管持久化和分解一些长值可能有点太不灵活。像 MongoDb/Couch 这样的文档存储将与我当前的模型紧密匹配，为每个用户提供他们自己的设置文档，并轻松地将其拉回。虽然这听起来像一个不错的场景，但这意味着我可能还需要建立一个关系数据库来处理平台的特性，这些特性显然是关系型的。我是否需要额外的基础设施来管理和处理对两个数据源的查询，而不是一个？艰难的选择。

我很想听听其他人是如何处理这个问题的，以及是否有被认为是最佳的实践？虽然我对我的项目的细节很模糊，但我觉得这是其他人以前一定遇到过的事情！