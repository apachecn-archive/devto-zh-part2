# Redux åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®è·å–â€”â€”100%æ­£ç¡®çš„æ–¹æ³•

> åŸæ–‡:[https://dev . to/bnevilleoneill/data-fetch-in-redux-apps-a-100-correct-approach-2e 75](https://dev.to/bnevilleoneill/data-fetching-in-redux-apps-a-100-correct-approach-2e75)

### Redux åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®è·å–â€”100%æ­£ç¡®çš„æ–¹æ³•

[![](../Images/b9d25963f89f1dc726ba0e298e30506c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ghaduNUs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AcwMGXp22EktYENiWyfm1Qw.png)

Redux æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œå®ƒè§£å†³äº† UI æ¡†æ¶çš„ä¸»è¦é—®é¢˜ä¹‹ä¸€:*çŠ¶æ€ç®¡ç†*ã€‚

å®¢æˆ·ç«¯çš„çŠ¶æ€ç®¡ç†å¯èƒ½ä¼šå¾ˆå¿«å˜æˆä¸€åœºå™©æ¢¦ï¼Œè€Œ Redux å®æ–½çš„å•å‘æ•°æ®æµä½¿å¾—ç†è§£äº‹ä»¶å¦‚ä½•æ”¹å˜åº”ç”¨ç¨‹åºçš„çŠ¶æ€å˜å¾—å¾ˆå®¹æ˜“ã€‚

å¤ªå¥½äº†ï¼

é—æ†¾çš„æ˜¯ï¼Œåœ¨æ„å»ºå¥å£®çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒçŠ¶æ€ç®¡ç†åªæ˜¯æ‚¨å¿…é¡»å¤„ç†çš„ä¼—å¤šé—®é¢˜ä¹‹ä¸€ã€‚å¦‚ä½•å¤„ç†å‰¯ä½œç”¨(æ¯”å¦‚æœ€å¸¸è§çš„ç½‘ç»œè¯·æ±‚)ï¼Ÿ

Redux æœ¬èº«å¹¶æ²¡æœ‰æä¾›ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚å¹¸è¿çš„æ˜¯ï¼Œç¤¾åŒºæœ‰å¾ˆå¤šå›¾ä¹¦é¦†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

[![](../Images/d07cf6eaeca12f2c884a95e532b5e78b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BS4Xiosv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AEqq0Y7j1VkQq2SQaziMKNA.png) 

<figcaption>redux-thunkï¼Ÿredux-sagaï¼Ÿredux-observableï¼Ÿredux-promiseï¼Ÿ</figcaption>

ç°åœ¨ï¼Œå“ªä¸€ä¸ªé€‚åˆä½ çš„é¡¹ç›®å‘¢ï¼Ÿ

äº‹å®æ˜¯ï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆéƒ½æ˜¯ç”¨ä¸åŒçš„æ–¹æ³•ã€ç”¨ä¾‹ä»¥åŠå¤´è„‘ä¸­çš„æ€ç»´æ¨¡å‹æ„å»ºçš„ã€‚

å®ƒä»¬å„æœ‰åˆ©å¼Šã€‚

æˆ‘ä¸æ‰“ç®—è®¨è®ºæ‰€æœ‰å¯èƒ½çš„æ–¹æ³•ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºæ¥çœ‹çœ‹ä¸€äº›æœ€å¸¸è§çš„æ¨¡å¼ã€‚

[![](../Images/2063f22e152ef36aa267c13ae9842601.png)T2ã€‘](https://logrocket.com/signup/)

### [](#a-fake-medium-huh-)ä¸€ä¸ªå‡çš„ä»‹è´¨ï¼Œå—¯ï¼Ÿ

[![](../Images/18be240ca78732d795799f03861478da.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--i79ZiDpW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AwTdkQD5secWJOuE0vURqlA.png) 

<figcaption>è¿™æ˜¯æˆ‘å°†å¸¦ä½ æµè§ˆçš„å°åº”ç”¨ç¨‹åºã€‚ [Github å›è´­](https://github.com/ohansemmanuel/fake-medium)</figcaption>

çœ‹ä¸€ä¸‹ä¸Šé¢çš„åº”ç”¨ç¨‹åºæˆªå›¾ã€‚å¯ä»¥è¯´éå¸¸ç®€å•ã€‚å·¦è¾¹æœ‰ä¸€ä¸²æ–‡æœ¬å’Œä¸€ä¸ªä¸­ç­‰æ‹æ‰‹å›¾æ ‡ã€‚**ä½ å¯ä»¥ä¸ºè¿™ä¸ª app æŠ“å–**[**Github å›è´­**](https://github.com/ohansemmanuel/fake-medium) **ã€‚**

è¯·æ³¨æ„ï¼Œä¸­æ‹æ‰‹æ˜¯å¯ç‚¹å‡»çš„ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œä¸‹é¢æ˜¯æˆ‘å¦‚ä½•æ„å»º medium clap å…‹éš†çš„ã€‚

[![](../Images/1eff2c64489573b574ab0b56cf202352.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--znpUQvRN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AfQgSEbxV076FnykmnseC1g.gif) 

<figcaption>å¸¦ç€[çš„ app ä¸­æ‹æ‹å…‹éš†](https://medium.freecodecamp.org/how-i-re-built-the-medium-clap-effect-and-what-i-got-out-of-the-experiment-991672995fdf)</figcaption>

å³ä½¿å¯¹äºè¿™ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨ä¹Ÿå¿…é¡»ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚æ˜¾ç¤ºæ‰€éœ€è§†å›¾æ‰€éœ€çš„ JSON æœ‰æ•ˆè´Ÿè½½å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

```
{
  "numberOfRecommends": 1900,
  "title": "My First Fake Medium Post",
  "subtitle": "and why it makes no intelligible sense",
  "paragraphs": [
    {
      "text": "This is supposed to be an intelligible post about something intelligible."
    },
    {
      "text": "Uh, sorry thereâ€™s nothing here."
    },
    {
      "text": "Itâ€™s just a fake post."
    },
    {
      "text": "Love it?"
    },
    {
      "text": "I bet you do!"
    }
  ]
} 
```

è¯¥åº”ç”¨ç¨‹åºçš„ç»“æ„ç¡®å®å¾ˆç®€å•ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†:æ–‡ç« å’Œé¼“æŒ

[![](../Images/2407945ed2edbbdd5b51d304093ef57c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--feXZPVIK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AtLiHaiLqebLznmC05dzRCg.png)

åœ¨ [components/Article.js](https://github.com/ohansemmanuel/fake-medium/blob/master/src/components/Article.js) ä¸­:

æ–‡ç« ç»„ä»¶æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åŠŸèƒ½ç»„ä»¶ï¼Œå®ƒæ¥å—æ ‡é¢˜ã€å‰¯æ ‡é¢˜å’Œæ®µè½å±æ€§ã€‚æ¸²æŸ“çš„ç»„ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:

```
const Article = ({ title, subtitle, paragraphs }) => {
  return (
    <StyledArticle>
      <h1>{title}</h1>
      <h4>{subtitle}</h4>
      {paragraphs.map(paragraph => <p>{paragraph.text}</p>)}
    </StyledArticle>
  );
}; 
```

å…¶ä¸­ StyledArticle æ˜¯é€šè¿‡ CSS-in-JS è§£å†³æ–¹æ¡ˆæ ·å¼åŒ–çš„å¸¸è§„ div å…ƒç´ ï¼Œ [styled-components](https://github.com/styled-components/styled-components) ã€‚

ä¸ç®¡ä½ æ˜¯å¦ç†Ÿæ‚‰ JS è§£å†³æ–¹æ¡ˆä¸­çš„ CSSã€‚StyledArticle å¯ä»¥é€šè¿‡è‰¯å¥½çš„ ol' CSS æ›¿æ¢ä¸º div æ ·å¼ã€‚

è®©æˆ‘ä»¬æŠŠé‚£ä»¶äº‹åšå®Œï¼Œä¸è¦å¼€å§‹äº‰è®ºğŸ˜‚

åœ¨ [components/Clap.js](https://github.com/ohansemmanuel/fake-medium/blob/master/src/components/Clap.js) ä¸­:

medium clap ç»„ä»¶åœ¨æ­¤ç›®å½•ä¸­å¯¼å‡ºã€‚ä»£ç ç¨å¾®å¤æ‚ä¸€äº›ï¼Œè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥ä»”ç»†é˜…è¯»[æˆ‘æ˜¯å¦‚ä½•æ„å»º medium clap](https://medium.freecodecamp.org/how-i-re-built-the-medium-clap-effect-and-what-i-got-out-of-the-experiment-991672995fdf) çš„â€”â€”è¿™æ˜¯ä¸€ä¸ª 5 åˆ†é’Ÿçš„é˜…è¯»ã€‚

æœ‰äº† Clap å’Œ Article ç»„ä»¶ï¼ŒApp ç»„ä»¶å°±åƒåœ¨ [containers/App.js](https://github.com/ohansemmanuel/fake-medium/blob/master/src/containers/App.js)
ä¸­çœ‹åˆ°çš„é‚£æ ·ç»„åˆäº†ä¸¤ä¸ªç»„ä»¶

```
class App extends Component {
  state = {};
  render() {
    return (
      <StyledApp>
        <aside>
**<Clap />**
        </aside>
        <main>
**<Article />**
        </main>
      </StyledApp>
    );
  }
} 
```

åŒæ ·ï¼Œæ‚¨å¯ä»¥ç”¨å¸¸è§„ div æ›¿æ¢ StyledAppï¼Œå¹¶é€šè¿‡ CSS å¯¹å…¶è¿›è¡Œæ ·å¼åŒ–ã€‚

ç°åœ¨ï¼Œåˆ°äº†è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚

### [](#considering-the-various-alternative-solutions-to-fetching-data)è€ƒè™‘å–æ•°æ®çš„å„ç§å¤‡é€‰æ–¹æ¡ˆã€‚

è®©æˆ‘ä»¬çœ‹çœ‹åœ¨ Redux åº”ç”¨ç¨‹åºä¸­è·å–æ•°æ®çš„ä¸€äº›ä¸åŒæ–¹æ³•ï¼Œå¹¶è€ƒè™‘å®ƒä»¬çš„ä¼˜ç¼ºç‚¹ã€‚

æœ€å—æ¬¢è¿çš„é€‰é¡¹å¯ä»¥è¯´æ˜¯ redux-thunk å’Œ redux-sagaã€‚

å‡†å¤‡å¥½äº†å—ï¼Ÿ

### [](#redux-thunk-and-reduxpromise)Redux Thunk å’Œ Redux-Promise

è¦è®°ä½çš„æœ€é‡è¦çš„äº‹æƒ…ä¹‹ä¸€æ˜¯ï¼Œæ¯ä¸ªç¬¬ä¸‰æ–¹åº“éƒ½æœ‰å…¶å­¦ä¹ æ›²çº¿å’Œæ½œåœ¨çš„å¯ä¼¸ç¼©æ€§é—®é¢˜ã€‚

åœ¨ Redux ä¸­ç®¡ç†å‰¯ä½œç”¨çš„æ‰€æœ‰ç¤¾åŒºåº“ä¸­ï¼Œåƒ Redux-thunk å’Œ Redux-promise è¿™æ ·çš„æ˜¯æœ€å®¹æ˜“ä¸Šæ‰‹çš„ã€‚

å‰æå¾ˆç®€å•ã€‚

å¯¹äº redux-thunkï¼Œæ‚¨ç¼–å†™ä¸€ä¸ªåŠ¨ä½œåˆ›å»ºå™¨ï¼Œå®ƒä¸â€œåˆ›å»ºâ€ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä» Redux è·å¾— getState å’Œ dispatch å‡½æ•°ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å‡åª’ä½“åº”ç”¨ç¨‹åºå¦‚ä½•åˆ©ç”¨ [redux-thunk](https://github.com/reduxjs/redux-thunk) åº“ã€‚

é¦–å…ˆï¼Œå®‰è£… redux-thunk åº“:

```
yarn add redux-thunk 
```

ä¸ºäº†ä½¿åº“æŒ‰é¢„æœŸå·¥ä½œï¼Œå®ƒå¿…é¡»ä½œä¸ºä¸­é—´ä»¶æ¥åº”ç”¨ã€‚

åœ¨[store/index . js](https://github.com/ohansemmanuel/fake-medium/blob/master/src/store/index.js)T2ã€‘

```
import { createStore, applyMiddleware } from "redux";
import thunk from "redux-thunk";
const store = createStore(rootReducer, applyMiddleware(thunk)); 
```

ä¸Šé¢ä»£ç å—ä¸­çš„ç¬¬ä¸€è¡Œä» redux å¯¼å…¥ createStore å’Œ applyMiddleware å‡½æ•°ã€‚

ç¬¬ 2 è¡Œä» redux-thunk å¯¼å…¥ thunkã€‚

ç¬¬ 3 è¡Œåˆ›å»ºäº†å•†åº—ï¼Œä½†æ˜¯åº”ç”¨äº†ä¸­é—´ä»¶ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡å‘å‡ºä¸€ä¸ªå®é™…çš„ç½‘ç»œè¯·æ±‚ã€‚

æˆ‘å°†ä½¿ç”¨ [axios](https://github.com/axios/axios) åº“æ¥å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯å¯ä»¥è‡ªç”±åœ°ç”¨æ‚¨é€‰æ‹©çš„ä»»ä½• http å®¢æˆ·ç«¯æ¥æ›¿æ¢å®ƒã€‚

ä½¿ç”¨ redux-thunk å‘èµ·ç½‘ç»œè¯·æ±‚å®é™…ä¸Šéå¸¸å®¹æ˜“ã€‚ä½ åƒè¿™æ ·åˆ›å»ºä¸€ä¸ªåŠ¨ä½œåˆ›å»ºå™¨(å³è¿”å›ä¸€ä¸ªå‡½æ•°çš„åŠ¨ä½œåˆ›å»ºå™¨):

```
export function fetchArticleDetails() {
**return function** (dispatch) {
    return axios.get("https://api.myjson.com/bins/19dtxc")
      .then(({ data }) => {
      dispatch(setArticleDetails(data));
    });
  };
} 
```

åœ¨å®‰è£… App ç»„ä»¶æ—¶ï¼Œæ‚¨å°†åˆ†æ´¾è¿™ä¸ªåŠ¨ä½œåˆ›å»ºè€…:

```
componentDidMount() {
    this.props.fetchArticleDetails();
 } 
```

ä»…æ­¤è€Œå·²ã€‚è¯·åŠ¡å¿…æ£€æŸ¥[å®Œæ•´çš„ä»£ç å·®å¼‚](https://github.com/ohansemmanuel/fake-medium/commit/589c2e1fb429659ee20131ed1d7558b03c8bf3f9)ï¼Œå› ä¸ºæˆ‘åœ¨è¿™é‡Œåªçªå‡ºæ˜¾ç¤ºäº†å…³é”®è¡Œ:

[![](../Images/18be240ca78732d795799f03861478da.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--i79ZiDpW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AwTdkQD5secWJOuE0vURqlA.png) 

<figcaption>æ–‡ç« è¯¦æƒ…å·²æˆåŠŸä»æœåŠ¡å™¨è·å–ã€‚</figcaption>

è¿™æ ·ï¼Œæ–‡ç« çš„ç»†èŠ‚å°±è¢«æå–å‡ºæ¥å¹¶æ˜¾ç¤ºåœ¨åº”ç”¨ç¨‹åºä¸­ã€‚

è¿™ç§æ–¹æ³•åˆ°åº•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

å¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ªéå¸¸å°çš„åº”ç”¨ç¨‹åºï¼Œredux-thunk å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯èƒ½æ˜¯æœ€å®¹æ˜“ç›¸å¤„çš„ã€‚

ç„¶è€Œï¼Œæ˜“ç”¨æ€§æ˜¯æœ‰ä»£ä»·çš„ã€‚æˆ‘ä»¬æ¥è€ƒè™‘ä¸‰ä¸ªå¼Šç«¯ã€‚

**1ã€‚æ¯ä¸ªåŠ¨ä½œåˆ›å»ºè€…éƒ½æœ‰å¤„ç†é”™è¯¯å’Œè®¾ç½®æ ‡é¢˜çš„é‡å¤åŠŸèƒ½ã€‚**

è¿™æ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„åŠ¨ä½œåˆ›å»ºå™¨:

```
export function fetchArticleDetails() {
   return function(dispatch) {
     return axios.get("https://api.myjson.com/bins/19dtxc")
      .then(({ data }) => {
       dispatch(setArticleDetails(data));
     });
   };
} 
```

åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼Œä½ éœ€è¦ç”¨ä¸åŒçš„æ–¹æ³•å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚ GETã€POST ç­‰ç­‰ã€‚

å‡è®¾æ‚¨æœ‰å¦ä¸€ä¸ªåä¸º recommedArticle çš„åŠ¨ä½œåˆ›å»ºå™¨ã€‚ç°åœ¨çœ‹æ¥ä¹Ÿå¯èƒ½æ˜¯è¿™æ ·:

```
export function recommendArticle (id, amountOfRecommends) {
  return function (dispatch) {
   return axios.post("https://api.myjson.com/bins/19dtxc, {
       id,
      amountOfRecommends
}) 
```

å“¦ï¼Œå¦‚æœä½ æƒ³è·å–ä¸€ä¸ªç”¨æˆ·çš„ä¸ªäººèµ„æ–™ï¼Ÿ

```
export function fetchUserProfile() {
    return function(dispatch) {
      return axios.get("https://api.myjson.com/bins/19dtxc")
       .then(({ data }) => {
        dispatch(setUserProfile(data));
      });
    };
 } 
```

ä¸éœ€è¦å¾ˆé•¿æ—¶é—´å°±å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šé‡å¤çš„åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³æ•æ‰é”™è¯¯ï¼Œä½ åº”è¯¥ç»™æ¯ä¸ªåŠ¨ä½œåˆ›å»ºè€…æ·»åŠ ä¸€ä¸ª catch å—ï¼Ÿ

**2ã€‚éšç€å¼‚æ­¥åŠ¨ä½œåˆ›å»ºè€…è¶Šæ¥è¶Šå¤šï¼Œæµ‹è¯•å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚**

å¼‚æ­¥çš„ä¸œè¥¿é€šå¸¸æ›´éš¾æµ‹è¯•ã€‚æµ‹è¯•å¹¶éä¸å¯èƒ½æˆ–å›°éš¾ï¼Œåªæ˜¯è®©æµ‹è¯•å˜å¾—ç›¸å½“å›°éš¾ã€‚

å°½å¯èƒ½ä¿æŒåŠ¨ä½œåˆ›å»ºè€…çš„æ— çŠ¶æ€æ€§ï¼Œå¹¶ä½¿å®ƒä»¬æˆä¸ºç®€å•çš„å‡½æ•°ï¼Œè¿™æ ·æ›´å®¹æ˜“è°ƒè¯•å’Œæµ‹è¯•ã€‚

éšç€åº”ç”¨ç¨‹åºä¸­åŒ…å«çš„åŠ¨ä½œåˆ›å»ºå™¨è¶Šæ¥è¶Šå¤šï¼Œæµ‹è¯•å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚

**3ã€‚æ”¹å˜æœåŠ¡å™¨é€šä¿¡ç­–ç•¥å˜å¾—æ›´åŠ å›°éš¾ã€‚**

å¦‚æœä¸€ä¸ªæ–°çš„é«˜çº§å¼€å‘äººå‘˜æ¥åˆ°è¿™é‡Œï¼Œå†³å®šå›¢é˜Ÿå¿…é¡»ä» [axios](https://github.com/axios/axios) è½¬ç§»åˆ°å¦ä¸€ä¸ª http å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚è¯´ [superagent](https://github.com/visionmedia/superagent) ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿç°åœ¨ï¼Œä½ å¿…é¡»å»æ”¹å˜ä¸åŒçš„(å¤šä¸ª)åŠ¨ä½œåˆ›å»ºè€…ã€‚

ä¸å¤ªå®¹æ˜“ï¼Œæ˜¯å—ï¼Ÿ

### [](#redux-saga-and-reduxobservable)Redux ä¼ å¥‡å’Œ Redux-å¯è§‚å¯Ÿ

è¿™äº›æ¯” redux-thunk æˆ– redux-promise ç¨å¾®å¤æ‚ä¸€äº›ã€‚

redux -saga å’Œ redux-observable æ— ç–‘å¯ä»¥æ›´å¥½åœ°æ‰©å±•ï¼Œä½†æ˜¯å®ƒä»¬éœ€è¦ä¸€ä¸ªå­¦ä¹ æ›²çº¿ã€‚åƒ sagas å’Œ RxJS è¿™æ ·çš„æ¦‚å¿µæ˜¯å¿…é¡»å­¦ä¹ çš„ï¼Œè¿™å–å†³äºå›¢é˜Ÿä¸­çš„å·¥ç¨‹å¸ˆæœ‰å¤šå°‘ç»éªŒï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚

æ‰€ä»¥ï¼Œå¦‚æœ redux-thunk å’Œ redux-promise å¯¹äºä½ çš„é¡¹ç›®æ¥è¯´å¤ªç®€å•äº†ï¼Œè€Œ redux-saga å’Œ redux-observable ä¼šå¼•å…¥ä¸€å±‚ä½ æƒ³ä»ä½ çš„å›¢é˜Ÿä¸­æŠ½è±¡å‡ºæ¥çš„å¤æ‚æ€§ï¼Œä½ ä¼šè½¬å‘å“ªé‡Œï¼Ÿ

**å®šåˆ¶ä¸­é—´ä»¶ï¼**

åƒ redux-thunkã€redux-promise å’Œ redux-saga è¿™æ ·çš„å¤§å¤šæ•°è§£å†³æ–¹æ¡ˆéƒ½ä½¿ç”¨äº†ä¸€ä¸ªä¸­é—´ä»¶ã€‚ä¸ºä»€ä¹ˆä½ ä¸èƒ½åˆ›é€ ä½ çš„å‘¢ï¼Ÿ

ä½ åˆšæ‰æ˜¯ä¸æ˜¯è¯´â€œä¸ºä»€ä¹ˆè¦é‡æ–°å‘æ˜è½®å­ï¼Ÿâ€

### [](#is-this-the-perfect-solution)è¿™æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

è™½ç„¶é‡æ–°å‘æ˜è½®å­å¬èµ·æ¥ç¡®å®åƒæ˜¯ä¸€ä»¶åäº‹ï¼Œä½†è¿˜æ˜¯ç»™å®ƒä¸€ä¸ªæœºä¼šã€‚

æ— è®ºå¦‚ä½•ï¼Œè®¸å¤šå…¬å¸å·²ç»å»ºç«‹äº†å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆæ¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ã€‚äº‹å®ä¸Šï¼Œå¾ˆå¤šå¼€æºé¡¹ç›®å°±æ˜¯è¿™æ ·å¼€å§‹çš„ã€‚

é‚£ä¹ˆï¼Œæ‚¨å¯¹è¿™ç§å®šåˆ¶è§£å†³æ–¹æ¡ˆæœ‰ä»€ä¹ˆæœŸæœ›ï¼Ÿ

1.  é›†ä¸­è§£å†³æ–¹æ¡ˆï¼Œå³åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ã€‚
2.  **å¯ä»¥å¤„ç†å„ç§ http æ–¹æ³•ï¼Œ** **GETï¼Œ** **POSTï¼Œ** **DELETE å’Œ**** PUT**
3.  **å¯ä»¥å¤„ç†è®¾ç½®è‡ªå®šä¹‰æ ‡é¢˜**
4.  **æ”¯æŒè‡ªå®šä¹‰é”™è¯¯å¤„ç†ï¼Œä¾‹å¦‚å‘é€åˆ°å¤–éƒ¨æ—¥å¿—æœåŠ¡ï¼Œæˆ–å¤„ç†æˆæƒé”™è¯¯ã€‚**
5.  **å…è®¸** **æˆåŠŸï¼Œ** **å¤±è´¥æ—¶å›è°ƒ**
6.  **æ”¯æŒå¤„ç†è£…è½½çŠ¶æ€çš„æ ‡ç­¾**

åŒæ ·ï¼Œæ ¹æ®æ‚¨çš„å…·ä½“éœ€æ±‚ï¼Œæ‚¨å¯èƒ½æœ‰ä¸€ä¸ªæ›´å¤§çš„åˆ—è¡¨ã€‚

ç°åœ¨ï¼Œè®©æˆ‘å¸¦ä½ èµ°è¿‡ä¸€ä¸ªä½“é¢çš„èµ·ç‚¹ã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å…·ä½“ä½¿ç”¨æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚

redux ä¸­é—´ä»¶æ€»æ˜¯è¿™æ ·å¼€å§‹:

```
const apiMiddleware = ({dispatch}) => next => action => {
 next (action)
} 
```

è¿™é‡Œæ˜¯å®šåˆ¶ api ä¸­é—´ä»¶çš„å®Œæ•´ä»£ç ã€‚ä¸€å¼€å§‹å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†æˆ‘ä¼šå¾ˆå¿«è§£é‡Šæ¯ä¸€è¡Œã€‚

ç»™ä½ :

```
import axios from "axios";
import { API } from "../actions/types";
import { accessDenied, apiError, apiStart, apiEnd } from "../actions/api";

const BASE\_URL = process.env.REACT\_APP\_BASE\_URL || "";

const defaultHeaders = {};
let headers = { ...defaultHeaders };

const apiMiddleware = ({ dispatch }) => next => action => {
  next(action);

  if (action.type !== API) return;

  const {
    url,
    method,
    data,
    accessToken,
    onSuccess,
    onFailure,
    label,
    headersOverride
  } = action.payload;

  const dataOrParams = ["GET", "DELETE"].includes(method) ? 
  "params" : "data";

  if (accessToken) {
    headers = {
      ...headers,
      Authorization: `Bearer ${accessToken}`
    };
  }

  if (headersOverride) {
    headers = {
      ...headers,
      ...headersOverride
    };
  }

  if (label) {
    dispatch(apiStart(label));
  }

  axios
    .request({
      url: `${BASE_URL}${url}`,
      method,
      headers,
      [dataOrParams]: data
    })
    .then(({ data }) => {
      if (label) {
        dispatch(apiEnd(label));
      }
      dispatch(onSuccess(data));
    })
    .catch(error => {
      if (label) {
        dispatch(apiEnd(label));
      }
      dispatch(apiError(error));
      dispatch(onFailure(error));

      if (error.response && error.response.status === 403) {
        dispatch(accessDenied(window.location.pathname));
      }
    });
};

export default apiMiddleware; 
```

ä½ å¯ä»¥ä» GitHub è·å¾—ä¸åˆ° 100 è¡Œä»£ç ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªå®šåˆ¶çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒçš„æµç¨‹å¾ˆå®¹æ˜“ç†è§£ã€‚

æˆ‘ç­”åº”è§£é‡Šæ¯ä¸€è¡Œï¼Œæ‰€ä»¥é¦–å…ˆï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¸­é—´ä»¶å¦‚ä½•å·¥ä½œçš„æ¦‚è¿°:

[![](../Images/da60cc5c7622e885ea7e94c1379fe241.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--YPzfbYAS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/600/1%2AeHmu5cXTCSbbTbbPIJ1c-g%402x.png)T3ã€‘è‡ªå®šä¹‰ä¸­é—´ä»¶çš„ä¸€èˆ¬æµç¨‹

é¦–å…ˆï¼Œä½ åšäº†ä¸€äº›é‡è¦çš„å¯¼å…¥ï¼Œä½ å¾ˆå¿«å°±ä¼šçœ‹åˆ°å®ƒä»¬çš„ç”¨æ³•ã€‚

1.  **æå–åŸºç¡€ URL**

å¯¼å…¥åçš„ä¸‹ä¸€è¡Œä»æŸä¸ªç¯å¢ƒå˜é‡ä¸­è·å– BASE_URLã€‚æ ¹æ®æ‚¨çš„è®¾ç½®ï¼Œè·å–ç¯å¢ƒå˜é‡çš„æ–¹å¼å¯èƒ½ç•¥æœ‰ä¸åŒã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨ react åº”ç”¨ç¨‹åºä¸­çš„é»˜è®¤æ–¹å¼æ¥å®Œæˆã€‚

ä¸ºä»€ä¹ˆè¦æå–åŸºæœ¬ url å‘¢ï¼Ÿ

ç›¸å¯¹äºå®Œæ•´çš„ URLï¼Œåœ¨åŠ¨ä½œåˆ›å»ºå™¨ä¸­åªåŒ…å«ç‰¹å®šçš„ç«¯ç‚¹æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚

ä¾‹å¦‚/åŠ¨ç‰©è€Œä¸æ˜¯[https://facebook-api.com/animals](https://facebook-api.com/animals)

ä¸å¯¹è¯¥å€¼è¿›è¡Œç¡¬ç¼–ç ä¼šå¸¦æ¥æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶ä¸”ä¾¿äºå°†æ¥è¿›è¡Œæ›´æ”¹ã€‚

**2ã€‚é©³å›æ— å…³åŠ¨ä½œç±»å‹**

```
if (action.type !== API) return; 
```

ä¸Šè¿°æ¡ä»¶å¯¹äºé˜²æ­¢é™¤ API ç±»å‹ä»¥å¤–çš„ä»»ä½•æ“ä½œè§¦å‘ç½‘ç»œè¯·æ±‚éå¸¸é‡è¦ã€‚

**3ã€‚ä»è¡ŒåŠ¨è½½è·ä¸­æå–é‡è¦å˜é‡**

```
const {
    url,
    method,
    data,
    accessToken,
    onSuccess,
    onFailure,
    label,
    headersOverride
  } = action.payload; 
```

ä¸ºäº†å‘å‡ºæˆåŠŸçš„è¯·æ±‚ï¼Œéœ€è¦ä» action æœ‰æ•ˆè´Ÿè½½ä¸­æå–ä»¥ä¸‹å†…å®¹ã€‚

url è¡¨ç¤ºè¦ç‚¹å‡»çš„ç«¯ç‚¹ï¼Œmethod è¡¨ç¤ºè¯·æ±‚çš„ HTTP æ–¹æ³•ï¼Œdata è¡¨ç¤ºè¦å‘é€åˆ°æœåŠ¡å™¨æˆ–æŸ¥è¯¢å‚æ•°çš„ä»»ä½•æ•°æ®ï¼Œåœ¨ GET æˆ– DELETE è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒaccessToken è¡¨ç¤ºæˆæƒä»¤ç‰Œï¼Œåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºåŒ…æ‹¬æˆæƒå±‚çš„æƒ…å†µä¸‹ï¼ŒonSuccess å’Œ onFailure è¡¨ç¤ºæ‚¨å¸Œæœ›åœ¨è¯·æ±‚æˆåŠŸæˆ–å¤±è´¥æ—¶è°ƒåº¦çš„ä»»ä½•æ“ä½œåˆ›å»ºè€…ï¼Œlabel è¡¨ç¤ºè¯·æ±‚çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œæœ€åï¼ŒheadersOverride è¡¨ç¤ºè¦†ç›–ä»»ä½•é»˜è®¤å€¼çš„ä»»ä½•è‡ªå®šä¹‰å¤´ã€‚

æ‚¨å°†å¾ˆå¿«åœ¨ä¸€ä¸ªå®é™…ä¾‹å­ä¸­çœ‹åˆ°è¿™äº›å†…å®¹ã€‚

**4ã€‚å¤„ç†ä»»ä½• HTTP æ–¹æ³•**

```
const dataOrParams = ["GET", "DELETE"].includes(method) ? "params" : "data"; 
```

å› ä¸ºè¿™ä¸ªè§£å†³æ–¹æ¡ˆä½¿ç”¨ axiosï¼Œè€Œä¸”æˆ‘è®¤ä¸ºå¤§å¤šæ•° HTTP å®¢æˆ·ç«¯éƒ½æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œæ‰€ä»¥ GET å’Œ DELETE æ–¹æ³•ä½¿ç”¨ paramsï¼Œè€Œå…¶ä»–æ–¹æ³•å¯èƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€ä¸€äº›æ•°æ®ã€‚

å› æ­¤ï¼Œå˜é‡ dataOrParams å°†æ ¹æ®è¯·æ±‚çš„æ–¹æ³•ä¿å­˜ä»»ä½•å€¼ã€å‚æ•°æˆ–æ•°æ®ã€‚

å¦‚æœä½ æœ‰ä¸€äº›ç½‘ç»œå¼€å‘çš„ç»éªŒï¼Œè¿™åº”è¯¥ä¸ä¼šå¥‡æ€ªã€‚

**5ã€‚å¡«å……æ ‡é¢˜å¯¹è±¡**

```
if (accessToken) {
    headers = {
      ...headers,
      Authorization: `Bearer ${accessToken}`
    };
  }

  if (headersOverride) {
    headers = {
      ...headers,
      ...headersOverride
    };
  } 
```

å¤§å¤šæ•°åƒæ ·çš„åº”ç”¨ç¨‹åºéƒ½ä¼šæœ‰ä¸€äº›æˆæƒå±‚ã€‚è¿™æ˜¯ç”¨åŠ¨ä½œæœ‰æ•ˆè½½è·ä¸­çš„ä»»ä½•ç‰¹æ®Šå¤´å¡«å……å¤´å¯¹è±¡çš„å¥½åœ°æ–¹ï¼Œä¹Ÿæ˜¯è®¾ç½®é»˜è®¤å€¼çš„å¥½åœ°æ–¹ï¼Œä¾‹å¦‚ä¸Šé¢çœ‹åˆ°çš„æˆæƒå¤´ã€‚

ç¬¬äºŒä¸ªæ¡ä»¶ä»£è¡¨äº†ä¸€ç§è¾¹ç¼˜æƒ…å†µï¼Œå³æ‚¨éœ€è¦åœ¨æŸä¸ªè¯·æ±‚ä¸­è¦†ç›–ä¸€äº›å¤´çš„æƒ…å†µã€‚åªéœ€åœ¨ action æœ‰æ•ˆè´Ÿè½½ä¸­åŒ…å«ä¸€ä¸ª headersOverride å­—æ®µï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¼šå¾—åˆ°å¾ˆå¥½çš„è§£å†³ã€‚

**6ã€‚å¤„ç†è£…è½½çŠ¶æ€**

```
if (label) {
    dispatch(apiStart(label));
} 
```

æ ‡ç­¾åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæ ‡è¯†æŸä¸ªç½‘ç»œè¯·æ±‚åŠ¨ä½œã€‚å°±åƒä¸€ä¸ªåŠ¨ä½œçš„ç±»å‹ã€‚

å¦‚æœæ ‡ç­¾å­˜åœ¨ï¼Œä¸­é—´ä»¶å°†åˆ†æ´¾ä¸€ä¸ª apiStart åŠ¨ä½œåˆ›å»ºå™¨ã€‚

ä¸‹é¢æ˜¯ apiStart åŠ¨ä½œåˆ›å»ºå™¨çš„æ ·å­:

```
export const apiStart = label => ({
  type: API\_START,
  payload: label
}); 
```

æ´»åŠ¨ç±»å‹ä¸º API_STARTã€‚

ç°åœ¨ï¼Œåœ¨ä½ çš„ reducers ä¸­ï¼Œä½ å¯ä»¥å¤„ç†è¿™ä¸ªåŠ¨ä½œç±»å‹ï¼ŒçŸ¥é“ä¸€ä¸ªè¯·æ±‚ä½•æ—¶å¼€å§‹ã€‚æˆ‘å°†å¾ˆå¿«å±•ç¤ºä¸€ä¸ªä¾‹å­ã€‚

æ­¤å¤–ï¼Œåœ¨ç½‘ç»œè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥æ—¶ï¼Œä¹Ÿå°†è°ƒåº¦ API_END æ“ä½œã€‚è¿™éå¸¸é€‚åˆå¤„ç†åŠ è½½çŠ¶æ€ï¼Œå› ä¸ºæ‚¨ç¡®åˆ‡åœ°çŸ¥é“è¯·æ±‚å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ã€‚

æˆ‘å°†å†æ¬¡å±•ç¤ºä¸€ä¸ªä¾‹å­ã€‚

7 .**ã€‚å‘å‡ºå®é™…çš„ç½‘ç»œè¯·æ±‚ï¼Œå¤„ç†é”™è¯¯ï¼Œå¹¶è°ƒç”¨å›è°ƒ**

```
axios
    .request({
      url: `${BASE_URL}${url}`,
      method,
      headers,
      [dataOrParams]: data
    })
    .then(({ data }) => {
      if (label) {
        dispatch(apiEnd(label));
      }
      dispatch(onSuccess(data));
    })
    .catch(error => {
      if (label) {
        dispatch(apiEnd(label));
      }
      dispatch(apiError(error));
      dispatch(onFailure(error));

      if (error.response && error.response.status === 403) {
        dispatch(accessDenied(window.location.pathname));
      }
    }); 
```

å®ƒå¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆå¤æ‚ã€‚

axios.request è´Ÿè´£å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªå¯¹è±¡é…ç½®ã€‚è¿™åŒ…æ‹¬ urlã€æ–¹æ³•ã€å¤´å’Œæ•°æ®æˆ–å‚æ•°å­—æ®µï¼Œå…·ä½“å–å†³äºè¯·æ±‚æ˜¯å¦æ˜¯ GETã€DELETE è¯·æ±‚ã€‚è¿™äº›æ˜¯æ‚¨ä¹‹å‰ä» action æœ‰æ•ˆè´Ÿè½½ä¸­æå–çš„å˜é‡ã€‚

å½“è¯·æ±‚æˆåŠŸæ—¶ï¼Œå¦‚ then å—æ‰€ç¤ºï¼Œåˆ†æ´¾ä¸€ä¸ª apiEnd åŠ¨ä½œåˆ›å»ºå™¨ã€‚

çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
export const apiEnd = label => ({
  type: API\_END,
  payload: label
}); 
```

åœ¨æ‚¨çš„ reducer ä¸­ï¼Œæ‚¨å¯ä»¥ç›‘å¬è¿™ä¸ªæ¶ˆæ¯ï¼Œå¹¶åœ¨è¯·æ±‚ç»“æŸæ—¶ç»ˆæ­¢ä»»ä½•åŠ è½½çŠ¶æ€ã€‚

å®Œæˆä¹‹åï¼Œè°ƒåº¦ onSuccess å›è°ƒã€‚

onSuccess å›è°ƒåœ¨ç½‘ç»œè¯·æ±‚æˆåŠŸåè¿”å›æ‚¨æƒ³è¦è°ƒåº¦çš„ä»»ä½•æ“ä½œã€‚åœ¨æˆåŠŸçš„ç½‘ç»œè¯·æ±‚ä¹‹åï¼Œå‡ ä¹æ€»ä¼šæœ‰åˆ†æ´¾åŠ¨ä½œçš„æƒ…å†µï¼Œä¾‹å¦‚å°†æå–çš„æ•°æ®ä¿å­˜åˆ° redux å­˜å‚¨ä¸­ã€‚

å¦‚æœå‡ºç°é”™è¯¯ï¼Œå¦‚ catch å—ä¸­æ‰€ç¤ºï¼Œä¹Ÿè§¦å‘ apiEnd æ“ä½œåˆ›å»ºå™¨ï¼Œè°ƒåº¦ä¸€ä¸ª apiError æ“ä½œåˆ›å»ºå™¨ï¼Œå¹¶è¿”å›å¤±è´¥çš„é”™è¯¯:

```
export const apiError = error => ({
  type: API\_ERROR,
  error
}); 
```

æ‚¨å¯èƒ½æœ‰å¦ä¸€ä¸ªä¸­é—´ä»¶æ¥ç›‘å¬è¿™ç§åŠ¨ä½œç±»å‹ï¼Œå¹¶ç¡®ä¿é”™è¯¯åˆ°è¾¾æ‚¨çš„å¤–éƒ¨æ—¥å¿—æœåŠ¡ã€‚

æ‚¨è¿˜è°ƒåº¦äº†ä¸€ä¸ª onFailure å›è°ƒã€‚ä»¥é˜²ä¸‡ä¸€ï¼Œä½ éœ€è¦å‘ç”¨æˆ·å±•ç¤ºä¸€äº›è§†è§‰åé¦ˆã€‚è¿™ä¹Ÿé€‚ç”¨äº toast é€šçŸ¥ã€‚

æœ€åï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªå¤„ç†è®¤è¯é”™è¯¯çš„ä¾‹å­:

```
if (error.response && error.response.status === 403) {
     dispatch(accessDenied(window.location.pathname));
  }
}); 
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åˆ†æ´¾äº†ä¸€ä¸ª accessDenied action creatorï¼Œå®ƒæ¥æ”¶ç”¨æˆ·æ‰€åœ¨çš„ä½ç½®ã€‚

ç„¶åï¼Œæˆ‘å¯ä»¥åœ¨å¦ä¸€ä¸ªä¸­é—´ä»¶ä¸­å¤„ç†è¿™ä¸ª accessDenied æ“ä½œã€‚

ä½ çœŸçš„ä¸éœ€è¦åœ¨å¦ä¸€ä¸ªä¸­é—´ä»¶ä¸­å¤„ç†è¿™äº›ã€‚å®ƒä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªä»£ç å—ä¸­å®Œæˆï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä»”ç»†æŠ½è±¡ï¼Œå°†è¿™äº›å…³æ³¨ç‚¹åˆ†å¼€å¯èƒ½å¯¹æ‚¨çš„é¡¹ç›®æ›´æœ‰æ„ä¹‰ã€‚

å°±æ˜¯è¿™æ ·ï¼

### [](#the-custom-middleware-in-action)è‡ªå®šä¹‰ä¸­é—´ä»¶åœ¨è¡ŒåŠ¨

æˆ‘ç°åœ¨å°†é‡æ„è¿™ä¸ªå‡çš„ä¸­å‹åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿ç”¨è¿™ä¸ªå®šåˆ¶çš„ä¸­é—´ä»¶ã€‚å”¯ä¸€è¦åšçš„æ”¹å˜æ˜¯åŒ…å«è¿™ä¸ªä¸­é—´ä»¶:

```
import apiMiddleware from "../middleware/api";

const store = **createStore** (rootReducer, **applyMiddleware** (apiMiddleware)); 
```

ç„¶åç¼–è¾‘ fetchArticleDetails æ“ä½œä»¥è¿”å›ä¸€ä¸ªæ™®é€šå¯¹è±¡ã€‚

```
export function fetchArticleDetails() {
**return {**
    type: API,
    payload: {
      url: "https://api.myjson.com/bins/19dtxc",
      method: "GET",
      data: null,
      accessToken: null,
      onSuccess: setArticleDetails,
      onFailure: () => {
        console.log("Error occured loading articles");
      },
      label: FETCH\_ARTICLE\_DETAILS,
      headersOverride: null
    }
**}** ;
}

function setArticleDetails(data) {
  return {
    type: SET\_ARTICLE\_DETAILS,
    payload: data
  };
} 
```

è¯·æ³¨æ„ fetchArticleDetails çš„æœ‰æ•ˆè´Ÿè½½å¦‚ä½•åŒ…å«ä¸­é—´ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚

ä½†æ˜¯æœ‰ä¸€ä¸ªå°é—®é¢˜ã€‚

ä¸€æ—¦ä½ è¶…è¶Šäº†ä¸€ä¸ªåŠ¨ä½œåˆ›å»ºè€…ï¼Œæ¯æ¬¡éƒ½ç¼–å†™æœ‰æ•ˆè´Ÿè½½å¯¹è±¡å°±å˜å¾—å¾ˆç—›è‹¦ã€‚å°¤å…¶æ˜¯å½“ä¸€äº›å€¼ä¸ºç©ºæˆ–è€…æœ‰ä¸€äº›é»˜è®¤å€¼æ—¶ã€‚

ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæ‚¨å¯ä»¥å°†åŠ¨ä½œå¯¹è±¡çš„åˆ›å»ºæŠ½è±¡ä¸ºä¸€ä¸ªæ–°çš„åŠ¨ä½œåˆ›å»ºå™¨ï¼Œåä¸º apiAction

```
function **apiAction** ({
  url = "",
  method = "GET",
  data = null,
  accessToken = null,
  onSuccess = () => {},
  onFailure = () => {},
  label = "",
  headersOverride = null
}) {
  return {
    type: API,
    payload: {
      url,
      method,
      data,
      accessToken,
      onSuccess,
      onFailure,
      label,
      headersOverride
    }
  };
} 
```

ä½¿ç”¨ ES6 ç¼ºçœå‚æ•°ï¼Œæ³¨æ„ apiAction å·²ç»è®¾ç½®äº†ä¸€äº›åˆç†çš„ç¼ºçœå€¼ã€‚

ç°åœ¨ï¼Œåœ¨ fetchArticleDetails ä¸­ä½ å¯ä»¥è¿™æ ·åš:

```
function **fetchArticleDetails** () {
  return apiAction({
    url: "https://api.myjson.com/bins/19dtxc",
    onSuccess: setArticleDetails,
    onFailure: console.log("Error occured loading articles"),
    label: FETCH\_ARTICLE\_DETAILS
  });
} 
```

ä½¿ç”¨ ES6:
è¿™ç”šè‡³ä¼šæ›´ç®€å•

```
const **fetchArticleDetails** = () => ({
   url: "https://api.myjson.com/bins/19dtxc",
   onSuccess: setArticleDetails,
   onFailure: console. **log** ("Error occured loading articles"),
   label: FETCH\_ARTICLE\_DETAILS
}); 
```

ç®€å•å¾ˆå¤šï¼

è€Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªå·¥ä½œåº”ç”¨ï¼

[![](../Images/1eff2c64489573b574ab0b56cf202352.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--znpUQvRN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AfQgSEbxV076FnykmnseC1g.gif) 

<figcaption>æŸå·¥ä½œç”³è¯·:)</figcaption>

ä¸ºäº†äº†è§£æ ‡ç­¾å¦‚ä½•å¯¹åŠ è½½çŠ¶æ€æœ‰ç”¨ï¼Œæˆ‘å°†ç»§ç»­å¤„ç† reducer ä¸­çš„ API_START å’Œ API_END åŠ¨ä½œç±»å‹ã€‚

```
case API\_START:
  if (action.payload === FETCH\_ARTICLE\_DETAILS) {
     return {
        ...state,
**isLoadingData: true**
     };
}

case API\_END:
   if (action.payload === FETCH\_ARTICLE\_DETAILS) {
      return {
        ...state,
**isLoadingData: false**
      };
 } 
```

ç°åœ¨ï¼Œæˆ‘åŸºäº API_START å’Œ API_END è¿™ä¸¤ç§åŠ¨ä½œç±»å‹åœ¨çŠ¶æ€å¯¹è±¡ä¸­è®¾ç½®ä¸€ä¸ª isLoadingData æ ‡å¿—

åŸºäºæ­¤ï¼Œæˆ‘å¯ä»¥åœ¨åº”ç”¨ç¨‹åºç»„ä»¶ä¸­è®¾ç½®åŠ è½½çŠ¶æ€ã€‚

ç»“æœå¦‚ä¸‹:

[![](../Images/f5285330934d92f406d09eda9fc8650f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Xu0ZjMjs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2ARj-xm8IPKBsLJAvbIX1-yA.gif) 

<figcaption>è§â€œè£…è½½â€¦.â€æ–‡å­—ï¼Ÿ</figcaption>

æˆåŠŸäº†ï¼

è¯·è®°ä½ï¼Œæˆ‘åœ¨è¿™é‡Œåˆ†äº«çš„å®šåˆ¶ä¸­é—´ä»¶åªæ˜¯ä½œä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªè‰¯å¥½èµ·ç‚¹ã€‚è¯„ä¼°ä»¥ç¡®ä¿è¿™é€‚åˆä½ çš„å…·ä½“æƒ…å†µã€‚æ ¹æ®æ‚¨çš„å…·ä½“ä½¿ç”¨æƒ…å†µï¼Œæ‚¨å¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›è°ƒæ•´ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘å·²ç»åœ¨ç›¸å½“å¤§çš„é¡¹ç›®ä¸­ä»¥æ­¤ä¸ºèµ·ç‚¹ï¼Œå¹¶ä¸åæ‚”è¿™ä¸ªå†³å®šã€‚

### [](#conclusion)ç»“è®º

æˆ‘å¼ºçƒˆå»ºè®®æ‚¨åœ¨åšå‡ºä»»ä½•æ‰¿è¯ºä¹‹å‰ï¼Œåœ¨ redux åº”ç”¨ç¨‹åºä¸­å°è¯•å„ç§å¯ç”¨çš„ç½‘ç»œè¯·æ±‚é€‰é¡¹ã€‚

å¯æ‚²çš„æ˜¯ï¼Œåœ¨ä¸ºä¸€ä¸ªæˆç†Ÿçš„åº”ç”¨ç¨‹åºé€‰æ‹©äº†ç­–ç•¥ä¹‹åï¼Œé‡æ„å°±å˜å¾—å¾ˆå›°éš¾äº†ã€‚

æœ€ç»ˆï¼Œè¿™æ˜¯æ‚¨çš„å›¢é˜Ÿã€æ‚¨çš„åº”ç”¨ç¨‹åºã€æ‚¨çš„æ—¶é—´ï¼Œæœ€ç»ˆï¼Œæ‚¨å¯ä»¥è‡ªå·±åšå‡ºé€‰æ‹©ã€‚

ä¸è¦å¿˜è®°æŸ¥çœ‹ Github ä¸Šçš„[ä»£ç åº“ã€‚](https://github.com/ohansemmanuel/fake-medium)

å›å¤´è§ï¼

### [](#plug-logrocket-a-dvr-for-web-apps)Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![](../Images/d56be9e9e36d8fa98c6959f7097b7787.png)](https://logrocket.com/signup/)

<figcaption>[https://logrocket.com/signup/](https://logrocket.com/signup/)</figcaption>

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

å…è´¹è¯•ç”¨ã€‚

* * *