# 在中添加分层编译。网络核心 2.1

> 原文：<https://dev.to/andrewcahill/adding-tiered-compilation-in-net-core-2-1-325j>

的众多特性之一。网芯是它的性能，这当然是它擅长的。

几周前，我看到了一个新的性能功能，以及预览功能。net Core 2.1——称为“分层编译”。

**什么事**

你可以说，它的核心不仅使应用程序启动更快，而且运行更快。这与 JIT(**J**ust**I**n**T**ime)编译过程有很大关系——首先让我解释一下 JIT。

**JIT**

暂时撇开 AOT 汇编不谈。Net CLR 通常使用 JIT 编译器根据 CLR 编译 MSIL，使用 CIL 元数据为目标机器体系结构加工本机代码。

它要么在加载完整程序集编译时启动，要么在运行时调用特定方法时按需执行此过程——这里发生的事情基本上是，当第一次调用方法时，它得到 JIT 编译，然后在后续调用中，调用代码实际上只是引用内存中该方法的本机 JIT 版本。

通常，在 JIT 中，每个方法都会被 JIT 编译一次，要么在启动时使用激进的优化，牺牲启动时间，但受益于稳态运行时性能，要么在启动时使用简单的优化，牺牲整个运行时的稳态性能。通常只有一个选择。

**回到分层编译**

有了分层编译，你可以不止一次地 JIT 编译同一个方法，根据它的用途产生一个更优化的版本，它在运行时自动热交换，为你做决定。

在启动时，它执行一个基本的编译(第 0 层)，但是如果该方法被频繁使用，该方法将在后台线程上被重新编译，从而为您产生一个更优化的版本(第 1 层)，以提高运行时性能。这有时被称为适应性优化。

这实际上产生了快速启动和快速稳态性能。

分层编译的另一个好处是，使用框架代码附带的预编译映像的应用程序可以更快地达到稳定状态。net 核心，通过分层编译，它可以在运行时产生更优化的代码版本。

**如何**

为了亲自尝试，有几个选择

1.  假设您有权访问或正在构建源代码，那么只需添加 MSBuild 属性，就可以对 csproj 文件进行简单的更改: