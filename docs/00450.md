# ç¼–å†™æœ‰æ„ä¹‰çš„æäº¤æ¶ˆæ¯

> åŸæ–‡:[https://dev . to/kewah/writing-a-meanified-commit-message-57j 0](https://dev.to/kewah/writing-a-meaningful-commit-message-57j0)

*ç…§ç‰‡ç”± [@kaitlynbaker](https://unsplash.com/@kaitlynbaker) åœ¨[Unsplash](https://unsplash.com)T5 æ‹æ‘„*

å½“åœ¨ä¸€ä¸ªå¼€å‘å›¢é˜Ÿä¸­å·¥ä½œæ—¶ï¼Œåˆ†äº«ä½ ç”¨ä»£ç å®ç°äº†ä»€ä¹ˆä»¥åŠä½ ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯å¾ˆé‡è¦çš„ã€‚å¯ä»¥ä½¿ç”¨æ˜ç¡®çš„å˜é‡åã€æ³¨é‡Šâ€¦â€¦ä¹Ÿå¯ä»¥é€šè¿‡ Git æäº¤æ¶ˆæ¯æ¥å®Œæˆã€‚

æäº¤æ¶ˆæ¯é€‚ç”¨äº:

*   ä»£ç å®¡æŸ¥:å®ƒæœ‰åŠ©äºå®¡æŸ¥è€…è·Ÿè¸ªä½ çš„æ€è·¯ï¼Œç†è§£ä½ åœ¨ä½ çš„ PR ä¸­è§£å†³äº†ä»€ä¹ˆã€‚
*   å®ƒç»™ä»£ç è¡Œ/ä»£ç å—å¸¦æ¥äº†ä¸Šä¸‹æ–‡ã€‚
*   `git log`ã€`git rebase`ã€`git revert`æˆ–`git bisect`:å®ƒå¯ä»¥å¸®åŠ©ä½ ç†è§£å˜åŒ–æ˜¯ä»€ä¹ˆï¼Œè€Œä¸å¿…æ·±ç©¶æäº¤ä¸­åŒ…å«çš„æ¯ä¸€è¡Œä»£ç ã€‚

## [](#the-structure-of-a-commit-message)æäº¤æ¶ˆæ¯çš„ç»“æ„

æˆ‘éµå¾ª Chris Beams è‘—åçš„[æ–‡ç« ](https://chris.beams.io/posts/git-commit/#seven-rules)ä¸­è¯¦è¿°çš„è§„åˆ™ã€‚å®ƒä»¬æ˜¯æˆ‘åœ¨å·¥ä½œæˆ–å¼€æºé¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¸¸è§çš„ã€‚

1.  [ç”¨ç©ºè¡Œå°†ä¸»ä½“ä¸ä¸»ä½“åˆ†å¼€](https://chris.beams.io/posts/git-commit/#separate)
2.  [å°†ä¸»é¢˜è¡Œé™åˆ¶åœ¨ 50 ä¸ªå­—ç¬¦ä»¥å†…](https://chris.beams.io/posts/git-commit/#limit-50)
3.  [å¤§å†™ä¸»é¢˜è¡Œ](https://chris.beams.io/posts/git-commit/#capitalize)
4.  [ä¸è¦ä»¥å¥å·](https://chris.beams.io/posts/git-commit/#end)ç»“æŸä¸»é¢˜è¡Œ
5.  [åœ¨ä¸»é¢˜è¡Œä¸­ä½¿ç”¨ç¥ˆä½¿è¯­æ°”](https://chris.beams.io/posts/git-commit/#imperative)
6.  [åœ¨ 72 ä¸ªå­—ç¬¦å¤„æ¢è¡Œ](https://chris.beams.io/posts/git-commit/#wrap-72)
7.  [ç”¨èº«ä½“è§£é‡Š*ä»€ä¹ˆ*å’Œ*ä¸ºä»€ä¹ˆ*vs*å¦‚ä½•*](https://chris.beams.io/posts/git-commit/#why-not-how)

æˆ‘å–œæ¬¢æŒ‰ç…§ä»–çš„æ–¹æ³•å†™ä¸»é¢˜ã€‚åœ¨å†™ç•™è¨€çš„æ—¶å€™ï¼Œæˆ‘æƒ³åˆ°äº†ä¸‹é¢è¿™å¥è¯:

```
If applied, this commit will [your subject line] 
```

æˆ‘å¼ºçƒˆæ¨èä½ é˜…è¯»å®Œæ•´çš„æ–‡ç« [å¦‚ä½•ç¼–å†™ Git æäº¤æ¶ˆæ¯](https://chris.beams.io/posts/git-commit)ï¼Œå®ƒæœ‰å¾ˆå¤šå¾ˆå¥½çš„è§è§£å’ŒæŒ‡å¯¼ã€‚

## [](#when-things-dont-go-according-to-plan)å½“äº‹æƒ…ä¸æŒ‰è®¡åˆ’è¿›è¡Œæ—¶

### [](#git-commit-am-bunch-of-stuff)git commit -amâ€œä¸€å †ä¸œè¥¿â€

å°½å¯èƒ½é¢‘ç¹åœ°æäº¤æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå› ä¸ºå®ƒç®€åŒ–äº†ç¼–å†™æäº¤æ¶ˆæ¯çš„å·¥ä½œï¼Œå› æ­¤æœ‰ä¸€ä¸ªæ›´æ¸…æ™°çš„ Git å†å²ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶äº‹æƒ…å¹¶ä¸åƒè®¡åˆ’çš„é‚£æ ·å‘å±•ï¼Œæˆ‘ä»¬åšäº†å¤ªå¤šçš„æ”¹å˜å´æ²¡æœ‰æ‰¿è¯ºã€‚å¸Œæœ›å¯ä»¥ä½¿ç”¨`git add --path`åˆ†åˆ«å­˜æ”¾å’Œæäº¤ä»£ç è¡Œã€‚ä½ å¯ä»¥åœ¨[Git Add Patch Command](http://codefoster.com/addpatch/)çš„æ–‡ç« ä¸­è¯»åˆ°æ›´å¤šç›¸å…³å†…å®¹ï¼Œä½œè€…åœ¨æ–‡ç« ä¸­æè¿°äº†å¦‚ä½•ä½¿ç”¨å‘½ä»¤è¡Œæˆ–åœ¨ VSCode ä¸­å®ç°å®ƒã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ GUI æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå› ä¸ºæˆ‘å¯ä»¥æ›´å¥½åœ°äº†è§£æˆ‘æƒ³è¦å­˜æ”¾çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ CLI é€å—è¿›è¡Œã€‚è¿™å®é™…ä¸Šæ˜¯æˆ‘ä¸º Git æ‰“å¼€ GUI çš„å”¯ä¸€åŸå› ã€‚

### [](#git-commit-am-oops-forgot-a-semicolon)git commit -amâ€œå“å‘€å¿˜äº†åˆ†å·ã€‚â€

ç”±äºæŸç§åŸå›  <sup>[*](#footnote1)</sup> ï¼Œä¸€ä¸ªé”™è¯¯é€šè¿‡ linter ä¼ é€’å¹¶è¢«æäº¤ã€‚æˆ‘ä»¬åæ¥æ„è¯†åˆ°ï¼Œå½“ CI å¤±è´¥æ—¶ï¼ŒPR æ‹’ç»è¯´æˆ‘ä»¬å¿˜è®°äº†åˆ†å·ã€‚çœŸæ‰«å…´ã€‚å•ç‹¬æäº¤å¯¹è¯„å®¡è€…æ¥è¯´æ²¡æœ‰ä»»ä½•ä»·å€¼ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ¢å¤åˆ°ä»¥å‰çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¾—ä¸é‡åšä¿®å¤ã€‚å¹¸è¿çš„æ˜¯ï¼ŒPR ä»ç„¶æ˜¯å¼€æ”¾çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ­£ç¡®çš„æäº¤ä¸­æ·»åŠ ä¸¢å¤±çš„åˆ†å·ã€‚

å¦‚æœé”™è¯¯å‘ç”Ÿåœ¨æœ€åä¸€æ¬¡æäº¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`--amend`æ ‡å¿—ç¼–å†™ä¿®å¤ã€æš‚å­˜å’Œæäº¤ã€‚è¿™æ ·ï¼Œæ›´æ”¹æ˜¯ä¹‹å‰æäº¤çš„ä¸€éƒ¨åˆ†ï¼Œä¸å…¬å¼€ã€‚

```
git add -A
git commit --amend --no-edit
# Push the fix to the PR branch
git push origin --force-with-lease 
```

*ä½ å¯ä»¥[é˜…è¯»æ›´å¤šå…³äº](https://developer.atlassian.com/blog/2015/04/force-with-lease/)ä¸ºä»€ä¹ˆä½ åº”è¯¥ç”¨`--force-with-lease`è€Œä¸æ˜¯`--force`çš„å†…å®¹ã€‚*

å¦åˆ™ï¼Œå¦‚æœè¿™ä¸ªé—®é¢˜å‘ç”Ÿåœ¨ Git å†å²çš„æ—©æœŸï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¼ºå¤§çš„ [`git rebase`](https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase) å›åˆ°è¿‡å»ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å®ƒå‘ç”Ÿåœ¨å“ªé‡Œï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªé€‰æ‹©:

*   ä½¿ç”¨`git blame`æ£€æŸ¥é—®é¢˜æ‰€åœ¨è¡Œçš„å†å²è®°å½•ã€‚
*   ä½¿ç”¨`git log --oneline`æˆ–`git log -p`(æˆ–ä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„ GUI)æ£€æŸ¥æ—¥å¿—ä»¥é€šè¯»æ›´æ”¹ã€‚
*   å¦‚æœéƒ½ä¸è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ [`git bisect`](https://robots.thoughtbot.com/git-bisect) ã€‚

æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå› ä¸ºå®ƒä¸æˆ‘çš„ä¸€ä¸ªæäº¤ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ä½¿ç”¨æ—¥å¿—æ‰¾åˆ°å®ƒã€‚

æˆ‘ä»¬ç°åœ¨å·²ç»æ‰¾åˆ°äº†æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„ SHA æ•£åˆ—å¹¶å¯¹å®ƒè¿›è¡Œ rebase:

```
git rebase -i e39a40e39bc325cde31b71402a79afb7be7e31ef^ 
```

*   `e38a...`æ˜¯æ²™å“ˆå¸Œ
*   SHA æ•£åˆ—æœ«å°¾çš„`^`æŒ‡å®šæˆ‘ä»¬å¸Œæœ›ä»è¿™ä¸ªæäº¤å¼€å§‹ rebaseã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œå®ƒå°†åœ¨ä¸‹ä¸€æ¬¡æäº¤æ—¶å¼€å§‹ã€‚

Git æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ <sup>[**](#footnote2)</sup> ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šæ¯æ¬¡æäº¤è¦è¿è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†ç¬¬ä¸€è¡Œ
ä¸­çš„`pick`æ›¿æ¢ä¸º`edit`(æˆ–ç®€ç§°ä¸º`e`)

```
edit e39a40e The commit we want to update
pick 84da00a Another commit message

# Rebase e39a40e..84da00a onto e39a40e (2 commands)
#
# Commands:
# p, pick <commit> = use commit
# r, reword <commit> = use commit, but edit the commit message
# e, edit <commit> = use commit, but stop for amending
# s, squash <commit> = use commit, but meld into previous commit
# f, fixup <commit> = like "squash", but discard this commit's log message
# x, exec <command> = run command (the rest of the line) using shell
# d, drop <commit> = remove commit 
```

ä¿å­˜æ–‡ä»¶ï¼ŒGit å°†æˆ‘ä»¬å¸¦å›æäº¤ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æ·»åŠ ä¸¢å¤±çš„åˆ†å·ï¼Œè¿›è¡Œæ›´æ”¹ï¼Œç»§ç»­é‡å®šåŸºç¡€ï¼Œæœ€åå°†æ›´æ”¹æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ã€‚

```
git add -A
git rebase --continue
git push origin --force-with-lease 
```

*å¬è¯´ä½ å–œæ¬¢ç”¨`-n`æäº¤ï¼ŸğŸ‘€

**å¯ä»¥[é…ç½® Git](https://stackoverflow.com/a/2596835) ä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨ã€‚