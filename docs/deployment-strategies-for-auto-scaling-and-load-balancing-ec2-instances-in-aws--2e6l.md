# AWS 中自动伸缩和负载平衡 EC2 实例的部署策略

> 原文：<https://dev.to/ashanfernando/deployment-strategies-for-auto-scaling-and-load-balancing-ec2-instances-in-aws--2e6l>

可伸缩性是现代 web 应用程序部署要考虑的最重要的方面之一。随着云技术的进步，设计可扩展性解决方案变得前所未有的简单。云的弹性为设计实用的解决方案提供了基础和灵活性。

使用 AWS，可以提供 EC2 实例，并只为使用时间付费，还可以使用自动扩展配置、启动配置、负载平衡器、 [Amazon 机器映像](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html) (AMIs)等工具，根据需求自动向外扩展(创建更多实例)。

然而，在为您的应用程序部署构建可靠、高效的扩展平台时，有许多因素值得考虑。因此，需要适当地设计自动缩放以解决以下问题，

*   按需高效扩展(减少新实例供应时间)。
*   几乎零停机的新部署支持。
*   回滚支持。
*   灾难恢复。

# AWS 中的自动伸缩和负载平衡工具

自动扩展和负载平衡部署需要几项基本服务。这些服务中的大多数都可以作为 AWS 的托管服务轻松获得。

*   负载平衡器——需要平衡来自客户端的负载，并公平地分配给健康的 EC2 实例。它还需要识别不健康的实例并停止发送流量。在 AWS 中，有多种类型的负载平衡器(经典负载平衡器、应用程序负载平衡器和网络负载平衡器)可用于不同的目的。但是，应用程序负载平衡器通常用于一般的 Web 应用程序。
*   自动扩展工具——需要这些工具来确定现有容量的限制，触发新实例的供应(向外扩展),并在负载减少时终止实例(向内扩展)。AWS 提供了一系列工具来支持这一点，包括 CloudWatch(监控)、自动扩展配置、启动配置(引导新实例的指令)。

# 使用自定义 ami

一种常见的方法是创建一个 [AWS EC2](https://n2ws.com/how-to-guides/automate-amazon-ec2-instance-backup.html) 实例，其中包含所需的操作系统和应用程序，并创建一个自定义 AMI(虚拟机映像)。这允许在 AWS EC2 启动配置中定义 AMI 引用，以指示 AWS 自动缩放工具使用自定义 AMI 引导新实例。

## 优点

*   配置供应规则非常简单。
*   易于回滚和更新新实例(AWS 提供对滚动更新的支持)。
*   支持部署大量实例。
*   相对快速的自举过程。

## 弊

*   需要具有相对复杂的构建过程，并且需要为每次更新构建新的 ami。

但是，也可以使用自定义 AMI，并在 EC2 实例引导过程中进行较小的配置。

# 动态引导 EC2 实例

在这种方法中，可以使用 Amazon 提供的基本 AMI，它只包含操作系统和通用软件。有几种方法可以为应用程序部署实现动态引导 EC2 实例。

使用 Amazon 的基本 AMI，并在实例开始使用 AWS 启动配置时引导其应用程序。
创建一个自定义 AMI，它能够在引导时加载应用程序的指定版本。
也有可能使用带有 Docker 的基本 Amazon AMI，其中容器映像是在实例的自举时拉取或构建的。

## 优点

*   不要求每次部署都保留非盟驻苏特派团。
*   基本 AMI 软件修补可以独立于应用程序完成。
*   配置供应规则非常简单。
*   构建过程和部署非常简单(不需要 AMI 构建)。

## 弊

*   对于大型应用程序，引导会花费更多时间，从而导致峰值负载问题(花费太多时间来供应和处理额外的负载)。
*   支持回滚将是困难的，除非遵循一种方法来跟踪具有部署版本的引导代码(例如，将每个部署存储在 S3 中，并且引导过程将检索相关的版本)。

然而，使用 [Docker](https://en.wikipedia.org/wiki/Docker_(software)) 可以解决一些部署版本控制和回滚的问题，这需要将应用程序容器化，并有一个独特的 Docker 构建过程。